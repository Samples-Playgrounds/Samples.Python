,0
0,private readonly byte[][] _nestedArrays = new byte[8][];
1,private const int Iterations = 100_000;
2,
3,private static byte IterateAll(byte[] arr)
4,{
5,byte ret = default;
6,foreach (byte item in arr) ret = item;
7,return ret;
8,}
9,
10,[Benchmark(OperationsPerInvoke = Iterations)]
11,public async Task MultipleSerial()
12,{
13,for (int i = 0; i < Iterations; i++)
14,{
15,for (int j = 0; j < _nestedArrays.Length; j++)
16,{
17,_nestedArrays[j] = ArrayPool<byte>.Shared.Rent(4096);
18,_nestedArrays[j].AsSpan().Clear();
19,}
20,
21,await Task.Yield();
22,
23,for (int j = _nestedArrays.Length - 1; j >= 0; j--)
24,{
25,IterateAll(_nestedArrays[j]);
26,ArrayPool<byte>.Shared.Return(_nestedArrays[j]);
27,}
28,}
29,}
