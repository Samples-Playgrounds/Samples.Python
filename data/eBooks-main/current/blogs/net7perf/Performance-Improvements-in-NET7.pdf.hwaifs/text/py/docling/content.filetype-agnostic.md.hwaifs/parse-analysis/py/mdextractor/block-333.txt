private SslStream _sslClient, _sslServer; private readonly byte[] _buffer = new byte[1]; private readonly SslServerAuthenticationOptions _options = new SslServerAuthenticationOptions { ServerCertificateContext = SslStreamCertificateContext.Create(GetCertificate(), null), }; [GlobalSetup] public void Setup() { using var listener = new Socket(AddressFamily.InterNetwork, SocketType.Stream , ProtocolType.Tcp); listener.Bind(new IPEndPoint(IPAddress.Loopback , 0)); listener.Listen(1); var client = new Socket(AddressFamily.InterNetwork, SocketType.Stream , ProtocolType.Tcp); client.Connect(listener.LocalEndPoint); _sslClient = new SslStream(new NetworkStream(client, ownsSocket: true), leaveInnerStreamOpen: true , delegate { return true; }); _sslServer = new SslStream(new NetworkStream(listener.Accept(), ownsSocket: true), leaveInnerStreamOpen: true , delegate { return true; }); Task.WaitAll( _sslClient.AuthenticateAsClientAsync("localhost" , null, SslProtocols.None , checkCertificateRevocation: false), _sslServer.AuthenticateAsServerAsync(_options)); } [GlobalCleanup] public void Cleanup() { _sslClient.Dispose(); _sslServer.Dispose(); } [Benchmark] public async Task ReadWriteAsync() { for (int i = 0; i < 1000; i++) { ValueTask<int> read = _sslClient.ReadAsync(_buffer);