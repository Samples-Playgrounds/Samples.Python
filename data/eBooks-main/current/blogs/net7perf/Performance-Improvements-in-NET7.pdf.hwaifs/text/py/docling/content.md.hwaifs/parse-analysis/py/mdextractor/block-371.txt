private readonly Activity _activity; public Program() { using ActivitySource activitySource = new ActivitySource("Perf7Source"); ActivitySource.AddActivityListener( new ActivityListener { ShouldListenTo = s => s == activitySource, Sample = ( ref ActivityCreationOptions<ActivityContext> o) => ActivitySamplingResult.AllDataAndRecorded }); _activity = activitySource.StartActivity( "TestActivity", ActivityKind.Internal, parentContext: default , links: Enumerable.Range(0, 1024).Select(_ => new ActivityLink( default )).ToArray()); _activity.Stop(); } [Benchmark(Baseline = true )] public ActivityLink EnumerateActivityLinks() { ActivityLink last = default ; foreach (ActivityLink link in _activity.Links) last = link; return last; }