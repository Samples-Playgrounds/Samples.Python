static unsafe bool Contains(ReadOnlySpan<byte> haystack, byte needle) { if (Vector.IsHardwareAccelerated && haystack.Length >= Vector<byte>.Count) { fixed (byte* haystackPtr = &MemoryMarshal.GetReference(haystack)) { Vector<byte> target = new Vector<byte>(needle); byte* current = haystackPtr; byte* endMinusOneVector = haystackPtr + haystack.Length -Vector<byte>.Count; do { if (Vector.EqualsAny(target, *(Vector<byte>*)current)) { return true; } current += Vector<byte>.Count; } while (current < endMinusOneVector); if (Vector.EqualsAny(target, *(Vector<byte>*)endMinusOneVector)) { return true; } } } else { for (int i = 0; i < haystack.Length; i++) { if (haystack[i] == needle) { return true; } } } return false; }