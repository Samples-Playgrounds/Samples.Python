[
    null,
    null,
    "As with previous versions of .NET, performance is a key focus that pervades the entire stack, whether it",
    "As with previous versions of .NET, performance is a key focus that pervades the entire stack, whether it",
    "One thought before we dive in. In past years, I\u2019ve received the odd piece of negative feedback about",
    "One thought before we dive in. In past years, I\u2019ve received the odd piece of negative feedback about",
    "TL;DR: .NET 7 is fast. Really fast. A thousand performance-impacting PRs went into runtime and core",
    "TL;DR: .NET 7 is fast. Really fast. A thousand performance-impacting PRs went into runtime and core",
    "Or, if you prefer a slightly longer adventure, one filled with interesting nuggets of performancefocused data, consider skimming through the post, looking for the small code snippets and",
    "Or, if you prefer a slightly longer adventure, one filled with interesting nuggets of performancefocused data, consider skimming through the post, looking for the small code snippets and",
    "Both noted paths achieve one of my primary goals for spending the time to write these posts, to",
    "Both noted paths achieve one of my primary goals for spending the time to write these posts, to",
    "gnarly problem, think about looking at the source for the component they\u2019re using in order to better",
    "gnarly problem, think about looking at the source for the component they\u2019re using in order to better",
    null,
    null,
    null,
    null,
    "On-Stack Replacement .................................................................................................................................................. 13",
    "On-Stack Replacement .................................................................................................................................................. 13",
    "PGO ........................................................................................................................................................................................ 23",
    "PGO ........................................................................................................................................................................................ 23",
    "Bounds Check Elimination ............................................................................................................................................ 35",
    "Bounds Check Elimination ............................................................................................................................................ 35",
    "Loop Hoisting and Cloning .......................................................................................................................................... 45",
    "Loop Hoisting and Cloning .......................................................................................................................................... 45",
    "Folding, propagation, and substitution ................................................................................................................... 50",
    "Folding, propagation, and substitution ................................................................................................................... 50",
    "Vectorization ...................................................................................................................................................................... 54",
    "Vectorization ...................................................................................................................................................................... 54",
    "Inlining .................................................................................................................................................................................. 62",
    "Inlining .................................................................................................................................................................................. 62",
    "Arm64 ................................................................................................................................................................................... 64",
    "Arm64 ................................................................................................................................................................................... 64",
    "JIT helpers ........................................................................................................................................................................... 65",
    "JIT helpers ........................................................................................................................................................................... 65",
    "Grab Bag .............................................................................................................................................................................. 67",
    "Grab Bag .............................................................................................................................................................................. 67",
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    "RegexOptions.NonBacktracking............................................................................................................................... 128",
    "RegexOptions.NonBacktracking............................................................................................................................... 128",
    "New APIs ............................................................................................................................................................................ 133",
    "New APIs ............................................................................................................................................................................ 133",
    "TryFindNextPossibleStartingPosition ..................................................................................................................... 138",
    "TryFindNextPossibleStartingPosition ..................................................................................................................... 138",
    "Loops and Backtracking .............................................................................................................................................. 143",
    "Loops and Backtracking .............................................................................................................................................. 143",
    "Code generation ............................................................................................................................................................. 146",
    "Code generation ............................................................................................................................................................. 146",
    null,
    null,
    null,
    null,
    "i Contents",
    "i Contents",
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    "ii Contents",
    "ii Contents",
    null,
    null,
    null,
    null,
    "and the contents of ",
    "and the contents of ",
    "1 CHAPTER 1 | Setup",
    "1 CHAPTER 1 | Setup",
    "For each benchmark included in this write-up, you can then just copy and paste the code into this test",
    "For each benchmark included in this write-up, you can then just copy and paste the code into this test",
    "This command says \u201cbuild the benchmarks in release configuration targeting the .NET 6 surface area,",
    "This command says \u201cbuild the benchmarks in release configuration targeting the .NET 6 surface area,",
    "which instead builds targeting the .NET 7 surface area and then only runs once against .NET 7. You",
    "which instead builds targeting the .NET 7 surface area and then only runs once against .NET 7. You",
    "The release of the first .NET 7 release candidate is right around the corner. All of the measurements in",
    "The release of the first .NET 7 release candidate is right around the corner. All of the measurements in",
    "Also, my standard caveat: These are microbenchmarks. It is expected that different hardware, different",
    "Also, my standard caveat: These are microbenchmarks. It is expected that different hardware, different",
    "2 CHAPTER 1 | Setup",
    "2 CHAPTER 1 | Setup",
    null,
    null,
    "I\u2019d like to kick off a discussion of performance improvements in the Just-In-Time (JIT) compiler by",
    "I\u2019d like to kick off a discussion of performance improvements in the Just-In-Time (JIT) compiler by",
    null,
    null,
    "One common approach is to use the ",
    "One common approach is to use the ",
    "[DisassemblyDiagnoser]",
    "[DisassemblyDiagnoser]",
    "with:",
    "with:",
    "in addition to doing all of its normal test execution and timing, benchmarkdotnet also outputs a",
    "in addition to doing all of its normal test execution and timing, benchmarkdotnet also outputs a",
    "Program-asm.md",
    "Program-asm.md",
    "3 CHAPTER 2 | JIT",
    "3 CHAPTER 2 | JIT",
    null,
    null,
    "If you can get your hands on a \u201cdebug\u201d or \u201cchecked\u201d build of the .NET runtime (\u201cchecked\u201d is a build",
    "If you can get your hands on a \u201cdebug\u201d or \u201cchecked\u201d build of the .NET runtime (\u201cchecked\u201d is a build",
    null,
    null,
    "and building it (e.g. ",
    "and building it (e.g. ",
    "and then running the app. You should see code like this output to the console:",
    "and then running the app. You should see code like this output to the console:",
    "4 CHAPTER 2 | JIT",
    "4 CHAPTER 2 | JIT",
    "This is immeasurably helpful for performance analysis and tuning, even for questions as simple as \u201cdid",
    "This is immeasurably helpful for performance analysis and tuning, even for questions as simple as \u201cdid",
    "Note that it can sometimes be a little confusing figuring out what name to specify as the value for",
    "Note that it can sometimes be a little confusing figuring out what name to specify as the value for",
    "DOTNET_JitDisasm",
    "DOTNET_JitDisasm",
    "We can see for \u201chello, world\u201d there\u2019s only 5 methods that actually get JIT compiled. There are of",
    "We can see for \u201chello, world\u201d there\u2019s only 5 methods that actually get JIT compiled. There are of",
    "because they explicitly opted-out of R2R via use of the",
    "because they explicitly opted-out of R2R via use of the",
    "[MethodImpl(MethodImplOptions.AggressiveOptimization)]",
    "[MethodImpl(MethodImplOptions.AggressiveOptimization)]",
    "5 CHAPTER 2 | JIT",
    "5 CHAPTER 2 | JIT",
    "method, which doesn\u2019t have R2R code, either, due to using the variable-width ",
    "method, which doesn\u2019t have R2R code, either, due to using the variable-width ",
    "DOTNET_ReadyToRun",
    "DOTNET_ReadyToRun",
    "6 CHAPTER 2 | JIT",
    "6 CHAPTER 2 | JIT",
    "7 CHAPTER 2 | JIT",
    "7 CHAPTER 2 | JIT",
    "8 CHAPTER 2 | JIT",
    "8 CHAPTER 2 | JIT",
    "9 CHAPTER 2 | JIT",
    "9 CHAPTER 2 | JIT",
    "10 CHAPTER 2 | JIT",
    "10 CHAPTER 2 | JIT",
    "11 CHAPTER 2 | JIT",
    "11 CHAPTER 2 | JIT",
    "12 CHAPTER 2 | JIT",
    "12 CHAPTER 2 | JIT",
    "With that out of the way, let\u2019s move on to actual performance improvements, starting with on-stack",
    "With that out of the way, let\u2019s move on to actual performance improvements, starting with on-stack",
    null,
    null,
    "On-stack replacement (OSR) is one of the coolest features to hit the JIT in .NET 7. But to really",
    "On-stack replacement (OSR) is one of the coolest features to hit the JIT in .NET 7. But to really",
    "One of the issues a managed environment with a JIT compiler has to deal with is tradeoffs between",
    "One of the issues a managed environment with a JIT compiler has to deal with is tradeoffs between",
    "13 CHAPTER 2 | JIT",
    "13 CHAPTER 2 | JIT",
    "certain baseline instruction set (e.g. what vectorizing instructions are available) whereas the JIT can see",
    "certain baseline instruction set (e.g. what vectorizing instructions are available) whereas the JIT can see",
    "Tiered compilation enables the JIT to have its proverbial cake and eat it, too. The idea is simple: allow",
    "Tiered compilation enables the JIT to have its proverbial cake and eat it, too. The idea is simple: allow",
    "A problem, however, is methods that don\u2019t fit this mold. While it\u2019s certainly the case that many",
    "A problem, however, is methods that don\u2019t fit this mold. While it\u2019s certainly the case that many",
    "I get numbers printed out like:",
    "I get numbers printed out like:",
    "14 CHAPTER 2 | JIT",
    "14 CHAPTER 2 | JIT",
    "Now, try setting ",
    "Now, try setting ",
    "In other words, with ",
    "In other words, with ",
    "DOTNET_TC_QuickJitForLoops",
    "DOTNET_TC_QuickJitForLoops",
    "but importantly, this method was still participating in tiering. In fact, we can get confirmation of that",
    "but importantly, this method was still participating in tiering. In fact, we can get confirmation of that",
    "highlighting that ",
    "highlighting that ",
    "The idea behind on-stack replacement is a method can be replaced not just between invocations but",
    "The idea behind on-stack replacement is a method can be replaced not just between invocations but",
    "15 CHAPTER 2 | JIT",
    "15 CHAPTER 2 | JIT",
    "16 CHAPTER 2 | JIT",
    "16 CHAPTER 2 | JIT",
    "A few relevant things to notice here. First, the comments at the top highlight how this code was",
    "A few relevant things to notice here. First, the comments at the top highlight how this code was",
    "So, we know this is the initial version (\u201cTier-0\u201d) of the method compiled with minimal optimization",
    "So, we know this is the initial version (\u201cTier-0\u201d) of the method compiled with minimal optimization",
    "Our ",
    "Our ",
    "IsAsciiDigit",
    "IsAsciiDigit",
    "17 CHAPTER 2 | JIT",
    "17 CHAPTER 2 | JIT",
    "That ",
    "That ",
    "The generated code is loading that counter into the ",
    "The generated code is loading that counter into the ",
    "18 CHAPTER 2 | JIT",
    "18 CHAPTER 2 | JIT",
    "19 CHAPTER 2 | JIT",
    "19 CHAPTER 2 | JIT",
    "Here, again, we notice a few interesting things. First, in the header we see this:",
    "Here, again, we notice a few interesting things. First, in the header we see this:",
    "so we know this is both optimized \u201ctier-1\u201d code and is the \u201cOSR variant\u201d for this method. Second,",
    "so we know this is both optimized \u201ctier-1\u201d code and is the \u201cOSR variant\u201d for this method. Second,",
    "implementation ( ",
    "implementation ( ",
    "Great, so now in .NET 7, we can largely avoid the tradeoffs between startup and throughput, as OSR",
    "Great, so now in .NET 7, we can largely avoid the tradeoffs between startup and throughput, as OSR",
    "20 CHAPTER 2 | JIT",
    "20 CHAPTER 2 | JIT",
    "But, tiered compilation and OSR aren\u2019t just about startup (though they\u2019re of course very valuable",
    "But, tiered compilation and OSR aren\u2019t just about startup (though they\u2019re of course very valuable",
    "only have been initialized by the time the tier-1 code executes but their values won\u2019t ever change. And",
    "only have been initialized by the time the tier-1 code executes but their values won\u2019t ever change. And",
    "When I do so, I get this output:",
    "When I do so, I get this output:",
    "21 CHAPTER 2 | JIT",
    "21 CHAPTER 2 | JIT",
    "the \u201cTier-1\u201d code, where all of that overhead has vanished and is instead replaced simply by ",
    "the \u201cTier-1\u201d code, where all of that overhead has vanished and is instead replaced simply by ",
    "1",
    "1",
    "This is so useful that components are now written with tiering in mind. Consider the new ",
    "This is so useful that components are now written with tiering in mind. Consider the new ",
    "instances that don\u2019t explicitly set a timeout. That means, even though it\u2019s super rare for such a",
    "instances that don\u2019t explicitly set a timeout. That means, even though it\u2019s super rare for such a",
    "which it then uses at call sites like this:",
    "which it then uses at call sites like this:",
    "In tier-0, these checks will still be emitted in the assembly code, but in tier-1 where throughput",
    "In tier-0, these checks will still be emitted in the assembly code, but in tier-1 where throughput",
    "22 CHAPTER 2 | JIT",
    "22 CHAPTER 2 | JIT",
    "assembly code entirely as dead code.",
    "assembly code entirely as dead code.",
    "But, this is somewhat old news. The JIT has been able to do such an optimization since tiered",
    "But, this is somewhat old news. The JIT has been able to do such an optimization since tiered",
    null,
    null,
    null,
    null,
    "PGO has been around for a long time, in any number of languages and compilers. The basic idea is",
    "PGO has been around for a long time, in any number of languages and compilers. The basic idea is",
    "Dynamic PGO takes advantage of tiered compilation. I noted that the JIT instruments the tier-0 code",
    "Dynamic PGO takes advantage of tiered compilation. I noted that the JIT instruments the tier-0 code",
    "23 CHAPTER 2 | JIT",
    "23 CHAPTER 2 | JIT",
    "The tier-0 code for ",
    "The tier-0 code for ",
    "24 CHAPTER 2 | JIT",
    "24 CHAPTER 2 | JIT",
    "That first block is checking the concrete type of the ",
    "That first block is checking the concrete type of the ",
    "That all existed in .NET 6, so why are we talking about it now? Several things have improved. First,",
    "That all existed in .NET 6, so why are we talking about it now? Several things have improved. First,",
    "enabling dynamic PGO (note that it ",
    "enabling dynamic PGO (note that it ",
    "PGO already knew how to instrument virtual dispatch. Now in .NET 7, thanks in large part to",
    "PGO already knew how to instrument virtual dispatch. Now in .NET 7, thanks in large part to",
    "Without PGO enabled, I get generated optimized assembly like this:",
    "Without PGO enabled, I get generated optimized assembly like this:",
    "25 CHAPTER 2 | JIT",
    "25 CHAPTER 2 | JIT",
    "Note the ",
    "Note the ",
    "26 CHAPTER 2 | JIT",
    "26 CHAPTER 2 | JIT",
    "I chose the ",
    "I chose the ",
    "27 CHAPTER 2 | JIT",
    "27 CHAPTER 2 | JIT",
    "This is loading the target address from the delegate into ",
    "This is loading the target address from the delegate into ",
    "r15d, edx, 42",
    "r15d, edx, 42",
    "With PGO disabled, we get the same performance throughput for .NET 6 and .NET 7:",
    "With PGO disabled, we get the same performance throughput for .NET 6 and .NET 7:",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "But the picture changes when we enable dynamic PGO ( ",
    "But the picture changes when we enable dynamic PGO ( ",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    null,
    null,
    "28 CHAPTER 2 | JIT",
    "28 CHAPTER 2 | JIT",
    "The JIT doesn\u2019t know whether the passed in array is of sufficient length that all accesses to ",
    "The JIT doesn\u2019t know whether the passed in array is of sufficient length that all accesses to ",
    "That way, at the expense of some code duplication, we get our fast loop without bounds checks and",
    "That way, at the expense of some code duplication, we get our fast loop without bounds checks and",
    "29 CHAPTER 2 | JIT",
    "29 CHAPTER 2 | JIT",
    "That G",
    "That G",
    "30 CHAPTER 2 | JIT",
    "30 CHAPTER 2 | JIT",
    "with the bounds checks only showing up in the slow-path block:",
    "with the bounds checks only showing up in the slow-path block:",
    "That\u2019s \u201cloop cloning.\u201d What about \u201cinvariant hoisting\u201d? Hoisting means pulling something out of a",
    "That\u2019s \u201cloop cloning.\u201d What about \u201cinvariant hoisting\u201d? Hoisting means pulling something out of a",
    "Note that the value of ",
    "Note that the value of ",
    "31 CHAPTER 2 | JIT",
    "31 CHAPTER 2 | JIT",
    "r8d",
    "r8d",
    "Ok, so how does this apply to dynamic PGO? Remember that with the interface/virtual dispatch",
    "Ok, so how does this apply to dynamic PGO? Remember that with the interface/virtual dispatch",
    "When we look at the optimized assembly generated for this with dynamic PGO enabled, we see this:",
    "When we look at the optimized assembly generated for this with dynamic PGO enabled, we see this:",
    "32 CHAPTER 2 | JIT",
    "32 CHAPTER 2 | JIT",
    "33 CHAPTER 2 | JIT",
    "33 CHAPTER 2 | JIT",
    "Interestingly, improvements like this can bring with them their own challenges. PGO leads to a",
    "Interestingly, improvements like this can bring with them their own challenges. PGO leads to a",
    "On .NET 6, the JIT produced this assembly code:",
    "On .NET 6, the JIT produced this assembly code:",
    "Note the C# has four tests for ",
    "Note the C# has four tests for ",
    "MT_System.String",
    "MT_System.String",
    "34 CHAPTER 2 | JIT",
    "34 CHAPTER 2 | JIT",
    null,
    null,
    "One of the things that makes .NET attractive is its safety. The runtime guards access to arrays, strings,",
    "One of the things that makes .NET attractive is its safety. The runtime guards access to arrays, strings,",
    "results in:",
    "results in:",
    "The array is passed into this method in the ",
    "The array is passed into this method in the ",
    "35 CHAPTER 2 | JIT",
    "35 CHAPTER 2 | JIT",
    "of the array and comparing the length to 0; that makes sense, since the length can\u2019t be negative, and",
    "of the array and comparing the length to 0; that makes sense, since the length can\u2019t be negative, and",
    "ptr [rcx+10H]",
    "ptr [rcx+10H]",
    "While these bounds checks in and of themselves aren\u2019t super expensive, do a lot of them and their",
    "While these bounds checks in and of themselves aren\u2019t super expensive, do a lot of them and their",
    "[",
    "[",
    "It\u2019s validating that the input span is 16 bytes long and then creating a ",
    "It\u2019s validating that the input span is 16 bytes long and then creating a ",
    "ushort",
    "ushort",
    "where that G",
    "where that G",
    "36 CHAPTER 2 | JIT",
    "36 CHAPTER 2 | JIT",
    "No bounds checks, which is most easily seen by the lack of the telltale ",
    "No bounds checks, which is most easily seen by the lack of the telltale ",
    "CORINFO_HELP_RNGCHKFAIL",
    "CORINFO_HELP_RNGCHKFAIL",
    "to prove that the bounds checks aren\u2019t needed.",
    "to prove that the bounds checks aren\u2019t needed.",
    null,
    null,
    "37 CHAPTER 2 | JIT",
    "37 CHAPTER 2 | JIT",
    "On .NET 6, we get this assembly:",
    "On .NET 6, we get this assembly:",
    "The beginning of this makes sense: the JIT was obviously able to see that the length of ",
    "The beginning of this makes sense: the JIT was obviously able to see that the length of ",
    "So much nicer.",
    "So much nicer.",
    null,
    null,
    "38 CHAPTER 2 | JIT",
    "38 CHAPTER 2 | JIT",
    "The implementation is treating an 8-character string as a 128-bit lookup table. If the character is",
    "The implementation is treating an 8-character string as a 128-bit lookup table. If the character is",
    "The previously mentioned PR takes care of the length check. And this PR takes care of the bit shift. So",
    "The previously mentioned PR takes care of the length check. And this PR takes care of the bit shift. So",
    "39 CHAPTER 2 | JIT",
    "39 CHAPTER 2 | JIT",
    "Note the distinct lack of a ",
    "Note the distinct lack of a ",
    "Bounds checks are an obvious source of overhead when talking about array access, but they\u2019re not the",
    "Bounds checks are an obvious source of overhead when talking about array access, but they\u2019re not the",
    "assembly code like the following would be generated:",
    "assembly code like the following would be generated:",
    "This should look fairly familiar from our previous discussion; the JIT is loading the array\u2019s length",
    "This should look fairly familiar from our previous discussion; the JIT is loading the array\u2019s length",
    "of moving it, it\u2019s sign-extending it; that\u2019s the \u201csxd\u201d part of the instruction name (sign-extending means",
    "of moving it, it\u2019s sign-extending it; that\u2019s the \u201csxd\u201d part of the instruction name (sign-extending means",
    "also know that ",
    "also know that ",
    "[",
    "[",
    "40 CHAPTER 2 | JIT",
    "40 CHAPTER 2 | JIT",
    "That\u2019s not the only source of overhead with array access, though. In fact, there\u2019s a very large category",
    "That\u2019s not the only source of overhead with array access, though. In fact, there\u2019s a very large category",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "This previous example assumes you know the size of each dimension of the multidimensional array",
    "This previous example assumes you know the size of each dimension of the multidimensional array",
    "41 CHAPTER 2 | JIT",
    "41 CHAPTER 2 | JIT",
    "multidimensional arrays can have a non-zero lower bound, ",
    "multidimensional arrays can have a non-zero lower bound, ",
    null,
    null,
    "substitute the necessary assembly instructions to read directly from the memory location that houses",
    "substitute the necessary assembly instructions to read directly from the memory location that houses",
    "42 CHAPTER 2 | JIT",
    "42 CHAPTER 2 | JIT",
    "43 CHAPTER 2 | JIT",
    "43 CHAPTER 2 | JIT",
    "Now here\u2019s what it is for .NET 7:",
    "Now here\u2019s what it is for .NET 7:",
    "44 CHAPTER 2 | JIT",
    "44 CHAPTER 2 | JIT",
    "we get:",
    "we get:",
    "and it ends up being much faster:",
    "and it ends up being much faster:",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    null,
    null,
    "We previously saw how PGO interacts with loop hoisting and cloning, and those optimizations have",
    "We previously saw how PGO interacts with loop hoisting and cloning, and those optimizations have",
    "Historically, the JIT\u2019s support for hoisting has been limited to lifting an invariant out one level.",
    "Historically, the JIT\u2019s support for hoisting has been limited to lifting an invariant out one level.",
    "45 CHAPTER 2 | JIT",
    "45 CHAPTER 2 | JIT",
    "At first glance, you might look at this and say \u201cwhat could be hoisted, the computation of ",
    "At first glance, you might look at this and say \u201cwhat could be hoisted, the computation of ",
    "different levels, e.g. the tens computation can be hoisted out one level, the hundreds out two levels,",
    "different levels, e.g. the tens computation can be hoisted out one level, the hundreds out two levels,",
    "46 CHAPTER 2 | JIT",
    "46 CHAPTER 2 | JIT",
    "We can see that ",
    "We can see that ",
    "all of the unnecessary computation out of the inner loop, being left only with adding the ones",
    "all of the unnecessary computation out of the inner loop, being left only with adding the ones",
    "operations which could have been hoisted out further were left stuck in the next-to-innermost loop.",
    "operations which could have been hoisted out further were left stuck in the next-to-innermost loop.",
    "47 CHAPTER 2 | JIT",
    "47 CHAPTER 2 | JIT",
    "Notice now where those ",
    "Notice now where those ",
    "highlighting that these computations were hoisted out to the appropriate level (the tens and ones",
    "highlighting that these computations were hoisted out to the appropriate level (the tens and ones",
    "More improvements have gone in on the cloning side. Previously, loop cloning would only apply for",
    "More improvements have gone in on the cloning side. Previously, loop cloning would only apply for",
    "Without loop cloning, the JIT can\u2019t assume that ",
    "Without loop cloning, the JIT can\u2019t assume that ",
    "48 CHAPTER 2 | JIT",
    "48 CHAPTER 2 | JIT",
    "Notice how in the core loop, at label M00",
    "Notice how in the core loop, at label M00",
    "M00_L03",
    "M00_L03",
    "Notice how the code size is larger, and how there are now two variations of the loop: one at M00",
    "Notice how the code size is larger, and how there are now two variations of the loop: one at M00",
    "bounds.",
    "bounds.",
    null,
    null,
    "49 CHAPTER 2 | JIT",
    "49 CHAPTER 2 | JIT",
    "slowPath",
    "slowPath",
    null,
    null,
    "Constant folding is an optimization where a compiler computes the value of an expression involving",
    "Constant folding is an optimization where a compiler computes the value of an expression involving",
    "the C# compiler will generate IL for these methods like the following:",
    "the C# compiler will generate IL for these methods like the following:",
    "2;",
    "2;",
    "50 CHAPTER 2 | JIT",
    "50 CHAPTER 2 | JIT",
    "The assembly for method ",
    "The assembly for method ",
    "0x2e). Constant propagation is intricately linked to constant folding and is essentially just the idea that",
    "0x2e). Constant propagation is intricately linked to constant folding and is essentially just the idea that",
    "The JIT has long performed constant folding, but it improves further in .NET 7. One of the ways",
    "The JIT has long performed constant folding, but it improves further in .NET 7. One of the ways",
    "should consider being more aggressive about inlining, since exposing that constant to the body of the",
    "should consider being more aggressive about inlining, since exposing that constant to the body of the",
    "TimeSpan",
    "TimeSpan",
    "and, eschewing argument validation for the purposes of this example, ",
    "and, eschewing argument validation for the purposes of this example, ",
    "which if everything gets inlined means ",
    "which if everything gets inlined means ",
    "I\u2019ll spare you the .NET 6 assembly for this, but on .NET 7 with a benchmark like:",
    "I\u2019ll spare you the .NET 6 assembly for this, but on .NET 7 with a benchmark like:",
    "we now get the simple and clean:",
    "we now get the simple and clean:",
    "51 CHAPTER 2 | JIT",
    "51 CHAPTER 2 | JIT",
    null,
    null,
    null,
    null,
    "Color.DarkOrange",
    "Color.DarkOrange",
    "In .NET 6, the JIT generated this:",
    "In .NET 6, the JIT generated this:",
    "with direct assignment of these constant values into their destination locations ( ",
    "with direct assignment of these constant values into their destination locations ( ",
    "[rdx+12],1",
    "[rdx+12],1",
    "However, a large category of improvement came from an optimization related to propagation, that of",
    "However, a large category of improvement came from an optimization related to propagation, that of",
    "52 CHAPTER 2 | JIT",
    "52 CHAPTER 2 | JIT",
    "If we look at the assembly code generated for ",
    "If we look at the assembly code generated for ",
    "with this assembly code:",
    "with this assembly code:",
    "Rather than a single ",
    "Rather than a single ",
    "add eax, 10",
    "add eax, 10",
    "It turns out that many of the JIT\u2019s optimizations operate on the tree data structures created as part of",
    "It turns out that many of the JIT\u2019s optimizations operate on the tree data structures created as part of",
    "53 CHAPTER 2 | JIT",
    "53 CHAPTER 2 | JIT",
    null,
    null,
    "SIMD, or Single Instruction Multiple Data, is a kind of processing in which one instruction applies to",
    "SIMD, or Single Instruction Multiple Data, is a kind of processing in which one instruction applies to",
    ".NET has long had support for vectorization in the form of ",
    ".NET has long had support for vectorization in the form of ",
    "Vector<T>",
    "Vector<T>",
    "today; for example, the operations you can perform on a ",
    "today; for example, the operations you can perform on a ",
    "methods that was JIT compiled in a \u201chello, world\u201d console app, and that this was because it lacked R2R",
    "methods that was JIT compiled in a \u201chello, world\u201d console app, and that this was because it lacked R2R",
    "Starting in .NET Core 3.0, .NET gained literally thousands of new \u201chardware intrinsics\u201d methods, most",
    "Starting in .NET Core 3.0, .NET gained literally thousands of new \u201chardware intrinsics\u201d methods, most",
    ".NET 7 has introduced a middle ground. Previous releases saw the introduction of the ",
    ".NET 7 has introduced a middle ground. Previous releases saw the introduction of the ",
    "54 CHAPTER 2 | JIT",
    "54 CHAPTER 2 | JIT",
    null,
    null,
    "target one or more of these two types. Typically this would amount to a developer writing one code",
    "target one or more of these two types. Typically this would amount to a developer writing one code",
    "here\u2019s what the optimized tier-1 code for these looks like on my x64 Windows machine:",
    "here\u2019s what the optimized tier-1 code for these looks like on my x64 Windows machine:",
    "55 CHAPTER 2 | JIT",
    "55 CHAPTER 2 | JIT",
    "Notice anything? The code for the two methods is identical, both resulting in a ",
    "Notice anything? The code for the two methods is identical, both resulting in a ",
    "To explore this a bit more, let\u2019s take a simple example and vectorize it. We\u2019ll implement a ",
    "To explore this a bit more, let\u2019s take a simple example and vectorize it. We\u2019ll implement a ",
    "How would we vectorize this with ",
    "How would we vectorize this with ",
    "56 CHAPTER 2 | JIT",
    "56 CHAPTER 2 | JIT",
    "Now that we know we have enough data, we can get to coding our vectorized loop. In this loop, we\u2019ll",
    "Now that we know we have enough data, we can get to coding our vectorized loop. In this loop, we\u2019ll",
    "And we\u2019re almost done. The last issue to handle is we may still have a few elements at the end we",
    "And we\u2019re almost done. The last issue to handle is we may still have a few elements at the end we",
    "57 CHAPTER 2 | JIT",
    "57 CHAPTER 2 | JIT",
    "that might or might not overlap with elements we\u2019ve already looked at, but it won\u2019t hurt anything if it",
    "that might or might not overlap with elements we\u2019ve already looked at, but it won\u2019t hurt anything if it",
    "Congratulations, we\u2019ve vectorized this operation, and fairly decently at that. We can throw this into",
    "Congratulations, we\u2019ve vectorized this operation, and fairly decently at that. We can throw this into",
    "58 CHAPTER 2 | JIT",
    "58 CHAPTER 2 | JIT",
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    "A 24x speedup",
    "A 24x speedup",
    "You deploy this in your service, and you see ",
    "You deploy this in your service, and you see ",
    "One thing we can now do is switch from using ",
    "One thing we can now do is switch from using ",
    "pointer arithmetic on the span we fixed.",
    "pointer arithmetic on the span we fixed.",
    "59 CHAPTER 2 | JIT",
    "59 CHAPTER 2 | JIT",
    "With that in hand, we can now try it on our smaller 30 element data set:",
    "With that in hand, we can now try it on our smaller 30 element data set:",
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    "Woo hoo, victory, all your performance are belong to us\u2026 again",
    "Woo hoo, victory, all your performance are belong to us\u2026 again",
    "What about on the larger data set again? Previously with ",
    "What about on the larger data set again? Previously with ",
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    "\u2026 closer to 15x. Nothing to sneeze at, but it\u2019s not the 24x we previously saw. What if we want to have",
    "\u2026 closer to 15x. Nothing to sneeze at, but it\u2019s not the 24x we previously saw. What if we want to have",
    "are enough elements to utilize it.",
    "are enough elements to utilize it.",
    "60 CHAPTER 2 | JIT",
    "60 CHAPTER 2 | JIT",
    "And, boom, we\u2019re back:",
    "And, boom, we\u2019re back:",
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    "We now have an implementation that is vectorized on any platform with either 128-bit or 256-bit",
    "We now have an implementation that is vectorized on any platform with either 128-bit or 256-bit",
    "There are many factors that impact which path you go down, and I expect we\u2019ll have guidance",
    "There are many factors that impact which path you go down, and I expect we\u2019ll have guidance",
    "61 CHAPTER 2 | JIT",
    "61 CHAPTER 2 | JIT",
    "I already mentioned several PRs that exposed the new cross-platform vector support, but that only",
    "I already mentioned several PRs that exposed the new cross-platform vector support, but that only",
    "that add first-class knowledge of vector constants to the JIT\u2019s intermediate representation; and",
    "that add first-class knowledge of vector constants to the JIT\u2019s intermediate representation; and",
    null,
    null,
    "Inlining is one of the most important optimizations the JIT can do. The concept is simple: instead of",
    "Inlining is one of the most important optimizations the JIT can do. The concept is simple: instead of",
    "All that is to say, inlining is ",
    "All that is to say, inlining is ",
    null,
    null,
    "62 CHAPTER 2 | JIT",
    "62 CHAPTER 2 | JIT",
    "Pretty simple, right? You\u2019d expect something this trivial to be inlined. Alas, on .NET 6, this benchmark:",
    "Pretty simple, right? You\u2019d expect something this trivial to be inlined. Alas, on .NET 6, this benchmark:",
    "produces this assembly code:",
    "produces this assembly code:",
    "Note the ",
    "Note the ",
    "\"False\"",
    "\"False\"",
    "No more ",
    "No more ",
    null,
    null,
    null,
    null,
    "63 CHAPTER 2 | JIT",
    "63 CHAPTER 2 | JIT",
    "members on ",
    "members on ",
    "results in this assembly code on .NET 6:",
    "results in this assembly code on .NET 6:",
    "However, change the benchmark slightly:",
    "However, change the benchmark slightly:",
    "and it\u2019s no longer as simple:",
    "and it\u2019s no longer as simple:",
    "Effectively, as part of inlining the JIT loses the notion that the argument is a constant and fails to",
    "Effectively, as part of inlining the JIT loses the notion that the argument is a constant and fails to",
    null,
    null,
    "A huge amount of effort in .NET 7 went into making code gen for Arm64 as good or better than its",
    "A huge amount of effort in .NET 7 went into making code gen for Arm64 as good or better than its",
    null,
    null,
    "64 CHAPTER 2 | JIT",
    "64 CHAPTER 2 | JIT",
    null,
    null,
    null,
    null,
    "enables the JIT to recognize certain constant bit shift operations (either explicit in the code or",
    "enables the JIT to recognize certain constant bit shift operations (either explicit in the code or",
    null,
    null,
    null,
    null,
    "uxtw",
    "uxtw",
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    "While logically part of the runtime, the JIT is actually isolated from the rest of the runtime, only",
    "While logically part of the runtime, the JIT is actually isolated from the rest of the runtime, only",
    null,
    null,
    "65 CHAPTER 2 | JIT",
    "65 CHAPTER 2 | JIT",
    "single one it\u2019s cached, and if they\u2019re equal simply jumps to the right target. You know you\u2019re in the",
    "single one it\u2019s cached, and if they\u2019re equal simply jumps to the right target. You know you\u2019re in the",
    "For anyone familiar with generics and interested in performance, you may have heard the refrain that",
    "For anyone familiar with generics and interested in performance, you may have heard the refrain that",
    "results in:",
    "results in:",
    "66 CHAPTER 2 | JIT",
    "66 CHAPTER 2 | JIT",
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    null,
    null,
    "|employed:|Col2|Col3|Col4|",
    "|employed:|Col2|Col3|Col4|",
    "Not enough of an improvement for us to start recommending people use them, but a 5%",
    "Not enough of an improvement for us to start recommending people use them, but a 5%",
    null,
    null,
    "It\u2019s near impossible to cover every performance change that goes into the JIT, and I\u2019m not going to",
    "It\u2019s near impossible to cover every performance change that goes into the JIT, and I\u2019m not going to",
    "[",
    "[",
    "67 CHAPTER 2 | JIT",
    "67 CHAPTER 2 | JIT",
    "[",
    "[",
    "actually expressible without a following ",
    "actually expressible without a following ",
    "68 CHAPTER 2 | JIT",
    "68 CHAPTER 2 | JIT",
    null,
    null,
    "69 CHAPTER 2 | JIT",
    "69 CHAPTER 2 | JIT",
    null,
    null,
    "70 CHAPTER 2 | JIT",
    "70 CHAPTER 2 | JIT",
    null,
    null,
    "\u201cRegions\u201d is a feature of the garbage collector (GC) that\u2019s been in the works for multiple years. It\u2019s",
    "\u201cRegions\u201d is a feature of the garbage collector (GC) that\u2019s been in the works for multiple years. It\u2019s",
    "71 CHAPTER 3 | GC",
    "71 CHAPTER 3 | GC",
    null,
    null,
    "To many people, the word \u201cperformance\u201d in the context of software is about throughput. How fast",
    "To many people, the word \u201cperformance\u201d in the context of software is about throughput. How fast",
    ".NET has long had support for AOT code generation. For example, .NET Framework had it in the form",
    ".NET has long had support for AOT code generation. For example, .NET Framework had it in the form",
    "Too many PRs to mention have gone into bringing up the Native AOT stack, in part because it\u2019s been",
    "Too many PRs to mention have gone into bringing up the Native AOT stack, in part because it\u2019s been",
    "72 CHAPTER 4 | Native AOT",
    "72 CHAPTER 4 | Native AOT",
    "Today, Native AOT is focused on console applications, so let\u2019s create a console app:",
    "Today, Native AOT is focused on console applications, so let\u2019s create a console app:",
    "And then\u2026 actually, that\u2019s it. Our app is now fully configured to be able to target Native AOT. All that\u2019s",
    "And then\u2026 actually, that\u2019s it. Our app is now fully configured to be able to target Native AOT. All that\u2019s",
    "I now have my generated executable in the output publish directory:",
    "I now have my generated executable in the output publish directory:",
    "so 2M instead of 3.5MB. Of course, for that significant reduction I\u2019ve given up some things:",
    "so 2M instead of 3.5MB. Of course, for that significant reduction I\u2019ve given up some things:",
    "Setting ",
    "Setting ",
    "should I need to debug an exception.",
    "should I need to debug an exception.",
    "Setting ",
    "Setting ",
    "\u2026 you get the idea.",
    "\u2026 you get the idea.",
    "One of the potentially mind-boggling aspects of Native AOT for a developer used to .NET is that, as it",
    "One of the potentially mind-boggling aspects of Native AOT for a developer used to .NET is that, as it",
    "implementation of the specified pattern. But if you look at the implementation of the ",
    "implementation of the specified pattern. But if you look at the implementation of the ",
    "With the JIT, ",
    "With the JIT, ",
    "[GeneratedRegex(...)]",
    "[GeneratedRegex(...)]",
    "73 CHAPTER 4 | Native AOT",
    "73 CHAPTER 4 | Native AOT",
    "SDK, emits C# code into the assembly using it. That C# code takes the place of the reflection emit that",
    "SDK, emits C# code into the assembly using it. That C# code takes the place of the reflection emit that",
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    "So, yes, there are some constraints associated with Native AOT, but there are also solutions for",
    "So, yes, there are some constraints associated with Native AOT, but there are also solutions for",
    "This is a really exciting space, one we expect to see flourish in coming releases.",
    "This is a really exciting space, one we expect to see flourish in coming releases.",
    "74 CHAPTER 4 | Native AOT",
    "74 CHAPTER 4 | Native AOT",
    null,
    null,
    "Up until now I\u2019ve referred to \u201cthe JIT,\u201d \u201cthe GC,\u201d and \u201cthe runtime,\u201d but in reality there are actually",
    "Up until now I\u2019ve referred to \u201cthe JIT,\u201d \u201cthe GC,\u201d and \u201cthe runtime,\u201d but in reality there are actually",
    "Just as with coreclr (which can JIT compile, AOT compile partially with JIT fallback, and fully Native",
    "Just as with coreclr (which can JIT compile, AOT compile partially with JIT fallback, and fully Native",
    "75 CHAPTER 5 | Mono",
    "75 CHAPTER 5 | Mono",
    "The interpreter isn\u2019t just used for entire apps, though. Just as how coreclr can use the JIT when an R2R",
    "The interpreter isn\u2019t just used for entire apps, though. Just as how coreclr can use the JIT when an R2R",
    "interpreted.",
    "interpreted.",
    "Beyond such backend improvements, another class of improvement came from further unification",
    "Beyond such backend improvements, another class of improvement came from further unification",
    "(these statements means that the vast majority of the performance improvements discussed in the",
    "(these statements means that the vast majority of the performance improvements discussed in the",
    "One of the biggest categories of improvements, however, is in vectorization. This comes in two pieces.",
    "One of the biggest categories of improvements, however, is in vectorization. This comes in two pieces.",
    "76 CHAPTER 5 | Mono",
    "76 CHAPTER 5 | Mono",
    null,
    null,
    "anywhere else WASM might be executed.",
    "anywhere else WASM might be executed.",
    "77 CHAPTER 5 | Mono",
    "77 CHAPTER 5 | Mono",
    null,
    null,
    "Reflection is one of those areas you either love or hate (I find it a bit humorous to be writing this",
    "Reflection is one of those areas you either love or hate (I find it a bit humorous to be writing this",
    "One of the most impacted areas is reflection invoke. Available via ",
    "One of the most impacted areas is reflection invoke. Available via ",
    "gives developers most of the performance benefits of a custom reflection emit-based implementation",
    "gives developers most of the performance benefits of a custom reflection emit-based implementation",
    "78 CHAPTER 6 | Reflection",
    "78 CHAPTER 6 | Reflection",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "Reflection also involves lots of manipulation of objects that represent types, methods, properties, and",
    "Reflection also involves lots of manipulation of objects that represent types, methods, properties, and",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    null,
    null,
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "Other changes contributed to ",
    "Other changes contributed to ",
    "resulting in less allocation and faster throughput.",
    "resulting in less allocation and faster throughput.",
    "79 CHAPTER 6 | Reflection",
    "79 CHAPTER 6 | Reflection",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "And since we were talking about ",
    "And since we were talking about ",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "More reflection-related operations have also been turned into JIT intrinsics, as discussed earlier",
    "More reflection-related operations have also been turned into JIT intrinsics, as discussed earlier",
    "|Method|Runtime|Mean|Ratio|Code Size|",
    "|Method|Runtime|Mean|Ratio|Code Size|",
    "That the .NET 7 version is so close to zero is called out in a warning by benchmarkdotnet:",
    "That the .NET 7 version is so close to zero is called out in a warning by benchmarkdotnet:",
    "and it\u2019s so indistinguishable from an empty method because that\u2019s effectively what it is, as we can see",
    "and it\u2019s so indistinguishable from an empty method because that\u2019s effectively what it is, as we can see",
    "80 CHAPTER 6 | Reflection",
    "80 CHAPTER 6 | Reflection",
    "There are also improvements that are hard to see but that remove overheads as part of populating",
    "There are also improvements that are hard to see but that remove overheads as part of populating",
    "81 CHAPTER 6 | Reflection",
    "81 CHAPTER 6 | Reflection",
    null,
    null,
    ".NET has long had great support for interop, enabling .NET applications to consume huge amounts of",
    ".NET has long had great support for interop, enabling .NET applications to consume huge amounts of",
    "[DllImport(...)]",
    "[DllImport(...)]",
    "If I want to call this function from C#, I can declare a ",
    "If I want to call this function from C#, I can declare a ",
    "There are several interesting things to note here. Several of the arguments are directly blittable with",
    "There are several interesting things to note here. Several of the arguments are directly blittable with",
    "calling this managed method can\u2019t just directly invoke the native function somehow, as there needs to",
    "calling this managed method can\u2019t just directly invoke the native function somehow, as there needs to",
    "it\u2019s no longer being used). Some logic needs to take the output handles generated by the native",
    "it\u2019s no longer being used). Some logic needs to take the output handles generated by the native",
    "82 CHAPTER 7 | Interop",
    "82 CHAPTER 7 | Interop",
    "and some code somewhere needs to take any error produced by this method and ensure it\u2019s available",
    "and some code somewhere needs to take any error produced by this method and ensure it\u2019s available",
    "If there\u2019s no marshalling logic required, such that the managed signature and native signature are for",
    "If there\u2019s no marshalling logic required, such that the managed signature and native signature are for",
    "[DllImport(...)]",
    "[DllImport(...)]",
    "There are a variety of downsides to this. First, it takes time to generate all that marshalling code, time",
    "There are a variety of downsides to this. First, it takes time to generate all that marshalling code, time",
    "But what if that logic could all be generated at build time rather than at run time? The cost of",
    "But what if that logic could all be generated at build time rather than at run time? The cost of",
    ".NET 6 included several source generators in the .NET SDK, and .NET 7 doubles down on this effort",
    ".NET 6 included several source generators in the .NET SDK, and .NET 7 doubles down on this effort",
    "Now if you\u2019re following along at home in Visual Studio, try right-clicking on CreatePipe and selecting",
    "Now if you\u2019re following along at home in Visual Studio, try right-clicking on CreatePipe and selecting",
    "83 CHAPTER 7 | Interop",
    "83 CHAPTER 7 | Interop",
    "opt-in to having it persisted on disk by adding a",
    "opt-in to having it persisted on disk by adding a",
    "<EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>",
    "<EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>",
    "84 CHAPTER 7 | Interop",
    "84 CHAPTER 7 | Interop",
    "With this, you can read exactly the marshalling work that\u2019s being performed. Two ",
    "With this, you can read exactly the marshalling work that\u2019s being performed. Two ",
    "Marshal.InitHandle",
    "Marshal.InitHandle",
    "any stub to be generated by the runtime, as all that work has been handled in this C# code.",
    "any stub to be generated by the runtime, as all that work has been handled in this C# code.",
    null,
    null,
    null,
    null,
    "In .NET 6, there were almost 3000 ",
    "In .NET 6, there were almost 3000 ",
    "Such porting is significantly easier when there\u2019s a tool to help automate it.",
    "Such porting is significantly easier when there\u2019s a tool to help automate it.",
    "85 CHAPTER 7 | Interop",
    "85 CHAPTER 7 | Interop",
    ":::",
    ":::",
    "There were plenty of other PRs that went into making the LibraryImport generator a reality for .NET 7.",
    "There were plenty of other PRs that went into making the LibraryImport generator a reality for .NET 7.",
    "the runtime\u2019s built-in marshalling; at that point, the only marshalling performed as part of interop is",
    "the runtime\u2019s built-in marshalling; at that point, the only marshalling performed as part of interop is",
    "marshaling is performed (the generator is pattern-based and allows for customization of marshalling",
    "marshaling is performed (the generator is pattern-based and allows for customization of marshalling",
    null,
    null,
    "One more category of interop-related changes that I think are worth talking about are to do with",
    "One more category of interop-related changes that I think are worth talking about are to do with",
    "SafeHandle",
    "SafeHandle",
    "its finalizer eventually run. ",
    "its finalizer eventually run. ",
    "SafeHandle",
    "SafeHandle",
    "86 CHAPTER 7 | Interop",
    "86 CHAPTER 7 | Interop",
    "and ",
    "and ",
    null,
    null,
    "ensure they\u2019re being disposed of. As is probably evident from that PR touching over 150 files and",
    "ensure they\u2019re being disposed of. As is probably evident from that PR touching over 150 files and",
    "and code that uses it like:",
    "and code that uses it like:",
    "Seems straightforward enough. Except this code will actually leave a ",
    "Seems straightforward enough. Except this code will actually leave a ",
    "That way, this ",
    "That way, this ",
    "close the resource, which typically involves making another P/Invoke. And if that P/Invoke has",
    "close the resource, which typically involves making another P/Invoke. And if that P/Invoke has",
    "SetLastError=true",
    "SetLastError=true",
    "the earlier mentioned PR).",
    "the earlier mentioned PR).",
    "87 CHAPTER 7 | Interop",
    "87 CHAPTER 7 | Interop",
    null,
    null,
    null,
    null,
    "Marshal.GetDelegateForFunctionPointer",
    "Marshal.GetDelegateForFunctionPointer",
    "|Method|Runtime|Mean|Ratio|Code Size|",
    "|Method|Runtime|Mean|Ratio|Code Size|",
    "88 CHAPTER 7 | Interop",
    "88 CHAPTER 7 | Interop",
    null,
    null,
    "Threading is one of those cross-cutting concerns that impacts every application, such that changes in",
    "Threading is one of those cross-cutting concerns that impacts every application, such that changes in",
    null,
    null,
    null,
    null,
    "ArrayPool",
    "ArrayPool",
    "doing \u201creal work\u201d that competes for CPU cycles with thread pool threads all racing to get their next",
    "doing \u201creal work\u201d that competes for CPU cycles with thread pool threads all racing to get their next",
    "89 CHAPTER 8 | Threading",
    "89 CHAPTER 8 | Threading",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "returning whatever data it finds, or in the case of a setter, creating a new ",
    "returning whatever data it finds, or in the case of a setter, creating a new ",
    "instances is really common, especially in ASP.NET where ASP.NET infrastructure itself uses a couple.",
    "instances is really common, especially in ASP.NET where ASP.NET infrastructure itself uses a couple.",
    "90 CHAPTER 8 | Threading",
    "90 CHAPTER 8 | Threading",
    "So, this PR took the complexity hit to add a dedicated type for four key/value pairs, in order to",
    "So, this PR took the complexity hit to add a dedicated type for four key/value pairs, in order to",
    "|Method|Runtime|Mean|Ratio|Code Size|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Code Size|Allocated|Alloc Ratio|",
    null,
    null,
    "91 CHAPTER 8 | Threading",
    "91 CHAPTER 8 | Threading",
    "This is simply spinning up 100 tasks, each of which enters and exits a read-write lock, waits for them",
    "This is simply spinning up 100 tasks, each of which enters and exits a read-write lock, waits for them",
    "Thread.SpinWait",
    "Thread.SpinWait",
    null,
    null,
    "92 CHAPTER 8 | Threading",
    "92 CHAPTER 8 | Threading",
    null,
    null,
    "We\u2019ve looked at code generation and GC, at threading and vectorization, at interop\u2026 let\u2019s turn our",
    "We\u2019ve looked at code generation and GC, at threading and vectorization, at interop\u2026 let\u2019s turn our",
    null,
    null,
    null,
    null,
    "93 CHAPTER 9 | Primitive Types and Numerics",
    "93 CHAPTER 9 | Primitive Types and Numerics",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "of ",
    "of ",
    "which requires four writes, it can instead implement the same operation in a single write by doing:",
    "which requires four writes, it can instead implement the same operation in a single write by doing:",
    "That ",
    "That ",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "values defined on the enum. This cache includes the string name and the value for every defined",
    "values defined on the enum. This cache includes the string name and the value for every defined",
    "94 CHAPTER 9 | Primitive Types and Numerics",
    "94 CHAPTER 9 | Primitive Types and Numerics",
    "and arrays), and for enums with more than that, it does a ",
    "and arrays), and for enums with more than that, it does a ",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "implementation choosing from a multitude of different internal implementations, for example a",
    "implementation choosing from a multitude of different internal implementations, for example a",
    "play nicely with enums. The results highlight just how much unnecessary overhead there was",
    "play nicely with enums. The results highlight just how much unnecessary overhead there was",
    "95 CHAPTER 9 | Primitive Types and Numerics",
    "95 CHAPTER 9 | Primitive Types and Numerics",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "four 32-bit values and performed 4 ",
    "four 32-bit values and performed 4 ",
    "|Method|Runtime|Mean|Ratio|Code Size|",
    "|Method|Runtime|Mean|Ratio|Code Size|",
    "of the bits store a ticks offset from 1/1/0001 12:00am and where each tick is 100 nanoseconds, and",
    "of the bits store a ticks offset from 1/1/0001 12:00am and where each tick is 100 nanoseconds, and",
    "difference in such tiny operations, but you can see it simply from the number of instructions involved,",
    "difference in such tiny operations, but you can see it simply from the number of instructions involved,",
    "and on .NET 7 this produces:",
    "and on .NET 7 this produces:",
    "96 CHAPTER 9 | Primitive Types and Numerics",
    "96 CHAPTER 9 | Primitive Types and Numerics",
    "so instead of a ",
    "so instead of a ",
    "Other operations on ",
    "Other operations on ",
    "[",
    "[",
    null,
    null,
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "So, we\u2019ve touched on improvements to a few types, but the pi\u00e8ce de r\u00e9sistance around primitive types",
    "So, we\u2019ve touched on improvements to a few types, but the pi\u00e8ce de r\u00e9sistance around primitive types",
    null,
    null,
    "97 CHAPTER 9 | Primitive Types and Numerics",
    "97 CHAPTER 9 | Primitive Types and Numerics",
    "code applied to any types that implement the interfaces\u2026 which all of the numerical types in .NET 7",
    "code applied to any types that implement the interfaces\u2026 which all of the numerical types in .NET 7",
    null,
    null,
    "While this support is all primarily intended for external consumers, the core libraries do consume",
    "While this support is all primarily intended for external consumers, the core libraries do consume",
    "diffs tells the story on how much code was able to be deleted:",
    "diffs tells the story on how much code was able to be deleted:",
    "Another simple example comes from the new ",
    "Another simple example comes from the new ",
    "INumber<T>",
    "INumber<T>",
    "interface contains these methods:",
    "interface contains these methods:",
    "98 CHAPTER 9 | Primitive Types and Numerics",
    "98 CHAPTER 9 | Primitive Types and Numerics",
    "and the compiler will pick the appropriate one based on the context.",
    "and the compiler will pick the appropriate one based on the context.",
    "In addition to all the existing types that get these interfaces, there are also new types.",
    "In addition to all the existing types that get these interfaces, there are also new types.",
    "Several PRs moved native implementations of these kinds of math operations to managed code.",
    "Several PRs moved native implementations of these kinds of math operations to managed code.",
    null,
    null,
    "|Method|Runtime|arg|Mean|Ratio|",
    "|Method|Runtime|arg|Mean|Ratio|",
    "Other math operations were also improved in various ways. ",
    "Other math operations were also improved in various ways. ",
    null,
    null,
    "while a larger algorithmic complexity than we\u2019d normally like, it has a low constant overhead and so is",
    "while a larger algorithmic complexity than we\u2019d normally like, it has a low constant overhead and so is",
    "99 CHAPTER 9 | Primitive Types and Numerics",
    "99 CHAPTER 9 | Primitive Types and Numerics",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "spans rather than arrays. That in turn enabled a fair amount of use of stack allocation and slicing to",
    "spans rather than arrays. That in turn enabled a fair amount of use of stack allocation and slicing to",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "100 CHAPTER 9 | Primitive Types and Numerics",
    "100 CHAPTER 9 | Primitive Types and Numerics",
    null,
    null,
    "While there are many forms of computation that can consume resources in applications, some of the",
    "While there are many forms of computation that can consume resources in applications, some of the",
    "Let\u2019s start with some new APIs that can help make writing more efficient code easier. When examining",
    "Let\u2019s start with some new APIs that can help make writing more efficient code easier. When examining",
    "or that are ASCII letters:",
    "or that are ASCII letters:",
    "or other such groups. Interestingly, there\u2019s wide-spread variation in how such checks are coded, often",
    "or other such groups. Interestingly, there\u2019s wide-spread variation in how such checks are coded, often",
    "which while more \u201cintense\u201d is also much more concise and more efficient. It\u2019s taking advantage of a",
    "which while more \u201cintense\u201d is also much more concise and more efficient. It\u2019s taking advantage of a",
    "101 CHAPTER 10 | Arrays, Strings, and Spans",
    "101 CHAPTER 10 | Arrays, Strings, and Spans",
    "than ",
    "than ",
    "lowercase, such that for the low cost of a bit twiddle, we can achieve both the lowercase and",
    "lowercase, such that for the low cost of a bit twiddle, we can achieve both the lowercase and",
    "IsDigit",
    "IsDigit",
    "IsAsciiDigit",
    "IsAsciiDigit",
    "IsAsciiHexDigit",
    "IsAsciiHexDigit",
    "IsAsciiHexDigitLower",
    "IsAsciiHexDigitLower",
    "IsAsciiHexDigitUpper",
    "IsAsciiHexDigitUpper",
    "IsAsciiLetter",
    "IsAsciiLetter",
    "IsAsciiLetterLower",
    "IsAsciiLetterLower",
    "IsAsciiLetterUpper",
    "IsAsciiLetterUpper",
    "IsAsciiLetterOrDigit",
    "IsAsciiLetterOrDigit",
    null,
    null,
    "Another new API focused on encapsulating a common pattern is the new",
    "Another new API focused on encapsulating a common pattern is the new",
    "each input span. This is useful when you want to know the first place that two inputs differ.",
    "each input span. This is useful when you want to know the first place that two inputs differ.",
    "Yet another new set of APIs are the ",
    "Yet another new set of APIs are the ",
    "102 CHAPTER 10 | Arrays, Strings, and Spans",
    "102 CHAPTER 10 | Arrays, Strings, and Spans",
    "You can now write that as:",
    "You can now write that as:",
    null,
    null,
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    "Of course, while new \u201cindex of\u201d variations are helpful, we already have a bunch of such methods, and",
    "Of course, while new \u201cindex of\u201d variations are helpful, we already have a bunch of such methods, and",
    "do the equivalent of repeatedly searching for the \u2018h\u2019, and when an \u2018h\u2019 was found, then performing a",
    "do the equivalent of repeatedly searching for the \u2018h\u2019, and when an \u2018h\u2019 was found, then performing a",
    "SequenceEqual",
    "SequenceEqual",
    "103 CHAPTER 10 | Arrays, Strings, and Spans",
    "103 CHAPTER 10 | Arrays, Strings, and Spans",
    "\u2018h\u2019 than it is to find an \u2018h\u2019 followed four characters later by an \u2018o\u2019, and thus this implementation is able",
    "\u2018h\u2019 than it is to find an \u2018h\u2019 followed four characters later by an \u2018o\u2019, and thus this implementation is able",
    "This is pulling down the text to \u201cThe Adventures of Sherlock Holmes\u201d from Project Gutenberg and",
    "This is pulling down the text to \u201cThe Adventures of Sherlock Holmes\u201d from Project Gutenberg and",
    "|Method|Runtime|needle|Mean|Ratio|",
    "|Method|Runtime|needle|Mean|Ratio|",
    "For \u201cSherlock\u201d, the performance is actually a bit worse in .NET 7 than in .NET 6; not much, but a",
    "For \u201cSherlock\u201d, the performance is actually a bit worse in .NET 7 than in .NET 6; not much, but a",
    "10% of the source. In that case, .NET 7 is 20x faster than .NET 6, taking 53us on .NET 7 to count all the",
    "10% of the source. In that case, .NET 7 is 20x faster than .NET 6, taking 53us on .NET 7 to count all the",
    "'e'",
    "'e'",
    "104 CHAPTER 10 | Arrays, Strings, and Spans",
    "104 CHAPTER 10 | Arrays, Strings, and Spans",
    "StringComparison.OrdinalIgnoreCase)",
    "StringComparison.OrdinalIgnoreCase)",
    "Here, both words are about 4x faster on .NET 7 than they were on .NET 6:",
    "Here, both words are about 4x faster on .NET 7 than they were on .NET 6:",
    "|Method|Runtime|needle|Mean|Ratio|",
    "|Method|Runtime|needle|Mean|Ratio|",
    "as we\u2019re now doing a vectorized ",
    "as we\u2019re now doing a vectorized ",
    "leftover elements at the end of vectorized operation: process one last vector\u2019s worth of data, even if it",
    "leftover elements at the end of vectorized operation: process one last vector\u2019s worth of data, even if it",
    "105 CHAPTER 10 | Arrays, Strings, and Spans",
    "105 CHAPTER 10 | Arrays, Strings, and Spans",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "types, but this PR extends it as well to four and eight-byte sized primitives. As with most of the other",
    "types, but this PR extends it as well to four and eight-byte sized primitives. As with most of the other",
    "Char",
    "Char",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "added to provide extension methods for spans and friends, including such",
    "added to provide extension methods for spans and friends, including such",
    null,
    null,
    "106 CHAPTER 10 | Arrays, Strings, and Spans",
    "106 CHAPTER 10 | Arrays, Strings, and Spans",
    null,
    null,
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "That same PR also cleans up uses of the ",
    "That same PR also cleans up uses of the ",
    "generated for comparisons against 0 is ever so slightly more efficient than comparisons generated",
    "generated for comparisons against 0 is ever so slightly more efficient than comparisons generated",
    "107 CHAPTER 10 | Arrays, Strings, and Spans",
    "107 CHAPTER 10 | Arrays, Strings, and Spans",
    "Speaking of call sites, one of the great things about having highly optimized ",
    "Speaking of call sites, one of the great things about having highly optimized ",
    "StringBuilder.Replace",
    "StringBuilder.Replace",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "substantial throughput gains even with the allocation and copy that is inherent to the method\u2019s",
    "substantial throughput gains even with the allocation and copy that is inherent to the method\u2019s",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    null,
    null,
    "Finally on the ",
    "Finally on the ",
    "108 CHAPTER 10 | Arrays, Strings, and Spans",
    "108 CHAPTER 10 | Arrays, Strings, and Spans",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "recognized by the JIT, which can now automatically unroll the comparison and compare more than",
    "recognized by the JIT, which can now automatically unroll the comparison and compare more than",
    "long",
    "long",
    "employs the same trick as part of this unrolling, so if you do that same",
    "employs the same trick as part of this unrolling, so if you do that same",
    "and will OR in the appropriate mask on both the comparison constant and on the read data from the",
    "and will OR in the appropriate mask on both the comparison constant and on the read data from the",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "Interestingly, since .NET 5 the code generated by ",
    "Interestingly, since .NET 5 the code generated by ",
    "RegexOptions.Compiled",
    "RegexOptions.Compiled",
    "109 CHAPTER 10 | Arrays, Strings, and Spans",
    "109 CHAPTER 10 | Arrays, Strings, and Spans",
    "regex being compiled.)",
    "regex being compiled.)",
    "StartsWith",
    "StartsWith",
    "_firstChar",
    "_firstChar",
    "string\u2019s length generally needn\u2019t be consulted. Now, consider a method like ",
    "string\u2019s length generally needn\u2019t be consulted. Now, consider a method like ",
    "StartsWith(char value)",
    "StartsWith(char value)",
    "which given what I just described makes sense: if the ",
    "which given what I just described makes sense: if the ",
    "fine\u2026 unless the target character is itself ",
    "fine\u2026 unless the target character is itself ",
    "IsKnownConstant",
    "IsKnownConstant",
    "If the ",
    "If the ",
    "110 CHAPTER 10 | Arrays, Strings, and Spans",
    "110 CHAPTER 10 | Arrays, Strings, and Spans",
    "and we\u2019ve saved ourselves a read of the string\u2019s length, a comparison, and a branch.",
    "and we\u2019ve saved ourselves a read of the string\u2019s length, a comparison, and a branch.",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "explicitly specify the enum value as a constant, which then allows the JIT to specialize the code",
    "explicitly specify the enum value as a constant, which then allows the JIT to specialize the code",
    "Math.Round(..., MidpointRounding.AwayFromZero)",
    "Math.Round(..., MidpointRounding.AwayFromZero)",
    "helper method was used to implement this method, taking advantage of one that is sufficient for the",
    "helper method was used to implement this method, taking advantage of one that is sufficient for the",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "but here for ",
    "but here for ",
    "111 CHAPTER 10 | Arrays, Strings, and Spans",
    "111 CHAPTER 10 | Arrays, Strings, and Spans",
    "Another method that\u2019s seem some attention in .NET 7 is ",
    "Another method that\u2019s seem some attention in .NET 7 is ",
    "Array.Reverse",
    "Array.Reverse",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "String.Split",
    "String.Split",
    null,
    null,
    "Converting various formats of strings is something many applications and services do, whether that\u2019s",
    "Converting various formats of strings is something many applications and services do, whether that\u2019s",
    null,
    null,
    null,
    null,
    "Vector128<T>",
    "Vector128<T>",
    "Then, then they \u201cwiden\u201d those bytes into chars (remember, Base64-encoded data is a set of ASCII",
    "Then, then they \u201cwiden\u201d those bytes into chars (remember, Base64-encoded data is a set of ASCII",
    "112 CHAPTER 10 | Arrays, Strings, and Spans",
    "112 CHAPTER 10 | Arrays, Strings, and Spans",
    "Base64 characters (there\u2019s a formula), and the implementation can either allocate that final space",
    "Base64 characters (there\u2019s a formula), and the implementation can either allocate that final space",
    "char",
    "char",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "Just as widening can be used to go from bytes to chars, narrowing can be used to go from chars to",
    "Just as widening can be used to go from bytes to chars, narrowing can be used to go from chars to",
    null,
    null,
    null,
    null,
    null,
    null,
    "automatically providing an Arm64 implementation.)",
    "automatically providing an Arm64 implementation.)",
    "calls.",
    "calls.",
    "113 CHAPTER 10 | Arrays, Strings, and Spans",
    "113 CHAPTER 10 | Arrays, Strings, and Spans",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "Arguably the biggest improvement around UTF8 in .NET 7 is the new C# 11 support for UTF8 literals.",
    "Arguably the biggest improvement around UTF8 in .NET 7 is the new C# 11 support for UTF8 literals.",
    "the C# compiler will compile that equivalent to if you wrote:",
    "the C# compiler will compile that equivalent to if you wrote:",
    "In other words, the compiler is doing the equivalent of ",
    "In other words, the compiler is doing the equivalent of ",
    "This means we not only save on the encoding costs at run-time, and we not only avoid whatever",
    "This means we not only save on the encoding costs at run-time, and we not only avoid whatever",
    "for which the JIT produces:",
    "for which the JIT produces:",
    "114 CHAPTER 10 | Arrays, Strings, and Spans",
    "114 CHAPTER 10 | Arrays, Strings, and Spans",
    "The JIT inlines the property access, sees that the span is being constructed with a length of ",
    "The JIT inlines the property access, sees that the span is being constructed with a length of ",
    null,
    null,
    "|Method|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Mean|Ratio|Allocated|Alloc Ratio|",
    "Like I said, not fair, but it proves the point :)",
    "Like I said, not fair, but it proves the point :)",
    "Encoding",
    "Encoding",
    "int.ToString",
    "int.ToString",
    "the next interpolation hole that needs to be filled in, and if the non-hole-character to hole ratio is high",
    "the next interpolation hole that needs to be filled in, and if the non-hole-character to hole ratio is high",
    "115 CHAPTER 10 | Arrays, Strings, and Spans",
    "115 CHAPTER 10 | Arrays, Strings, and Spans",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "things. The first was to remove pinning as part of formatting operations. As an example,",
    "things. The first was to remove pinning as part of formatting operations. As an example,",
    "int count)",
    "int count)",
    "That ",
    "That ",
    "Unsafe.AreSame",
    "Unsafe.AreSame",
    "now akin to",
    "now akin to",
    "bounds checking and the like can continue to do so, but now also does so without pinning all of the",
    "bounds checking and the like can continue to do so, but now also does so without pinning all of the",
    "116 CHAPTER 10 | Arrays, Strings, and Spans",
    "116 CHAPTER 10 | Arrays, Strings, and Spans",
    "put in place to optimize for this input and specifically for the case where there\u2019s already enough room",
    "put in place to optimize for this input and specifically for the case where there\u2019s already enough room",
    "helper, such that it not only helps out ",
    "helper, such that it not only helps out ",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "One of the great things about improving things low in the stack is they have a multiplicative effect;",
    "One of the great things about improving things low in the stack is they have a multiplicative effect;",
    "DateTimeOffset.ToString",
    "DateTimeOffset.ToString",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "if there\u2019s not enough room remaining do they then take the old path as a fallback. ",
    "if there\u2019s not enough room remaining do they then take the old path as a fallback. ",
    "117 CHAPTER 10 | Arrays, Strings, and Spans",
    "117 CHAPTER 10 | Arrays, Strings, and Spans",
    "previously discussed PR to insert the resulting characters at the right location (it also falls back to",
    "previously discussed PR to insert the resulting characters at the right location (it also falls back to",
    "ToString",
    "ToString",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "possible implementation for that operation (and if we ever found a better way, that method would be",
    "possible implementation for that operation (and if we ever found a better way, that method would be",
    "Note that I\u2019ve expressed that concatenation via an interpolated string, but the C# compiler will \u201clower\u201d",
    "Note that I\u2019ve expressed that concatenation via an interpolated string, but the C# compiler will \u201clower\u201d",
    "118 CHAPTER 10 | Arrays, Strings, and Spans",
    "118 CHAPTER 10 | Arrays, Strings, and Spans",
    "As an aside, the expanded ",
    "As an aside, the expanded ",
    "but this doesn\u2019t meaningfully affect performance and here clarity and maintainability was more",
    "but this doesn\u2019t meaningfully affect performance and here clarity and maintainability was more",
    "|Method|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Mean|Ratio|Allocated|Alloc Ratio|",
    "There are also places where ",
    "There are also places where ",
    "cached; attempts to cache ones longer than that result in them being thrown away. It\u2019d be better",
    "cached; attempts to cache ones longer than that result in them being thrown away. It\u2019d be better",
    "119 CHAPTER 10 | Arrays, Strings, and Spans",
    "119 CHAPTER 10 | Arrays, Strings, and Spans",
    "In the same vein of not doing unnecessary work, there\u2019s a fairly common pattern that shows up with",
    "In the same vein of not doing unnecessary work, there\u2019s a fairly common pattern that shows up with",
    "The relevant thing to recognize here is these methods have overloads that take just the starting offset.",
    "The relevant thing to recognize here is these methods have overloads that take just the starting offset.",
    "which is not only more readable and maintainable, it has some small efficiency benefits, e.g. on 64-bit",
    "which is not only more readable and maintainable, it has some small efficiency benefits, e.g. on 64-bit",
    null,
    null,
    "discussed how they\u2019re essentially managed pointers, i.e. pointers that the runtime can update at any",
    "discussed how they\u2019re essentially managed pointers, i.e. pointers that the runtime can update at any",
    "Later versions of C# added the ability to have local ",
    "Later versions of C# added the ability to have local ",
    "and even to have ",
    "and even to have ",
    "120 CHAPTER 10 | Arrays, Strings, and Spans",
    "120 CHAPTER 10 | Arrays, Strings, and Spans",
    "These facilities are more advanced, but they\u2019re used liberally throughout higher-performance code",
    "These facilities are more advanced, but they\u2019re used liberally throughout higher-performance code",
    "ref",
    "ref",
    "Span<T>",
    "Span<T>",
    "But not span. ",
    "But not span. ",
    "Note there\u2019s only a getter and no setter; that\u2019s because it returns a ",
    "Note there\u2019s only a getter and no setter; that\u2019s because it returns a ",
    "but rather than that being equivalent to calling some setter:",
    "but rather than that being equivalent to calling some setter:",
    "it\u2019s actually equivalent to using the getter to retrieve the ",
    "it\u2019s actually equivalent to using the getter to retrieve the ",
    "ref",
    "ref",
    "That\u2019s all well and good, but what\u2019s that ",
    "That\u2019s all well and good, but what\u2019s that ",
    "defined as follows:",
    "defined as follows:",
    "121 CHAPTER 10 | Arrays, Strings, and Spans",
    "121 CHAPTER 10 | Arrays, Strings, and Spans",
    "The rollout of ",
    "The rollout of ",
    "ref",
    "ref",
    null,
    null,
    "equivalent to calling those methods with a length of 1. The answer is: safety.",
    "equivalent to calling those methods with a length of 1. The answer is: safety.",
    "Imagine if you could willy-nilly call this constructor. You\u2019d be able to write code like this:",
    "Imagine if you could willy-nilly call this constructor. You\u2019d be able to write code like this:",
    "At this point the caller of this method is handed a span that refers to garbage; that\u2019s bad in code",
    "At this point the caller of this method is handed a span that refers to garbage; that\u2019s bad in code",
    "but at that point you\u2019ve taken on the risk of using unsafe code and pointers and any resulting",
    "but at that point you\u2019ve taken on the risk of using unsafe code and pointers and any resulting",
    "122 CHAPTER 10 | Arrays, Strings, and Spans",
    "122 CHAPTER 10 | Arrays, Strings, and Spans",
    "of the method, which is bad. Hence how this relates to ",
    "of the method, which is bad. Hence how this relates to ",
    "As is often the case, addressing one issue kicks the can down the road a bit and exposes another. The",
    "As is often the case, addressing one issue kicks the can down the road a bit and exposes another. The",
    "ref structs",
    "ref structs",
    "struct",
    "struct",
    "We have a ",
    "We have a ",
    "Straightforward. Except, this doesn\u2019t compile:",
    "Straightforward. Except, this doesn\u2019t compile:",
    "123 CHAPTER 10 | Arrays, Strings, and Spans",
    "123 CHAPTER 10 | Arrays, Strings, and Spans",
    "If ",
    "If ",
    "But as it\u2019s not trying to do so, everything now compiles successfully. You can see examples of how this",
    "But as it\u2019s not trying to do so, everything now compiles successfully. You can see examples of how this",
    "There\u2019s also the other direction: there are some things that are implicitly ",
    "There\u2019s also the other direction: there are some things that are implicitly ",
    "This produces a compiler error:",
    "This produces a compiler error:",
    "Effectively, that\u2019s because ",
    "Effectively, that\u2019s because ",
    "and now the code will compile successfully. Of course, this also places demands on callers of this",
    "and now the code will compile successfully. Of course, this also places demands on callers of this",
    "124 CHAPTER 10 | Arrays, Strings, and Spans",
    "124 CHAPTER 10 | Arrays, Strings, and Spans",
    "implementation for producing high-quality hash codes. In its current incarnation, it incorporates a",
    "implementation for producing high-quality hash codes. In its current incarnation, it incorporates a",
    "xxHash32 algorithm works by accumulating 4 32-bit unsigned integers and then combining them",
    "xxHash32 algorithm works by accumulating 4 32-bit unsigned integers and then combining them",
    "to deal with the possibility that previous calls to ",
    "to deal with the possibility that previous calls to ",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    null,
    null,
    "and replaced it with code like:",
    "and replaced it with code like:",
    "125 CHAPTER 10 | Arrays, Strings, and Spans",
    "125 CHAPTER 10 | Arrays, Strings, and Spans",
    "This has a variety of benefits. There\u2019s the usability benefit of keeping the tokens being searched close",
    "This has a variety of benefits. There\u2019s the usability benefit of keeping the tokens being searched close",
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    "Another example from that PR took code along the lines of:",
    "Another example from that PR took code along the lines of:",
    "and replaced it with code like:",
    "and replaced it with code like:",
    "In this case, not only have we avoided the ",
    "In this case, not only have we avoided the ",
    "ReadOnlySpan<char>",
    "ReadOnlySpan<char>",
    "[",
    "[",
    "Of course, in some cases the arrays are entirely unnecessary. In that same PR, there were several cases",
    "Of course, in some cases the arrays are entirely unnecessary. In that same PR, there were several cases",
    "126 CHAPTER 10 | Arrays, Strings, and Spans",
    "126 CHAPTER 10 | Arrays, Strings, and Spans",
    "By switching to use spans, again, we can instead write it like this:",
    "By switching to use spans, again, we can instead write it like this:",
    "MemoryExtensions.IndexOfAny",
    "MemoryExtensions.IndexOfAny",
    "[",
    "[",
    null,
    null,
    "[",
    "[",
    "127 CHAPTER 10 | Arrays, Strings, and Spans",
    "127 CHAPTER 10 | Arrays, Strings, and Spans",
    null,
    null,
    null,
    null,
    "Welcome back. With that context, I\u2019ll avoid duplicating content here, and instead focus on how exactly",
    "Welcome back. With that context, I\u2019ll avoid duplicating content here, and instead focus on how exactly",
    null,
    null,
    "processing of ",
    "processing of ",
    "NonBacktracking",
    "NonBacktracking",
    "A significant number of years of development went into the ",
    "A significant number of years of development went into the ",
    "This implementation is based on the notion of regular expression derivatives, a concept that\u2019s been",
    "This implementation is based on the notion of regular expression derivatives, a concept that\u2019s been",
    "128 CHAPTER 11 | Regex",
    "128 CHAPTER 11 | Regex",
    "to match three word characters, if you apply this to the next input character \u2018a\u2019, well, that will strip off",
    "to match three word characters, if you apply this to the next input character \u2018a\u2019, well, that will strip off",
    "derivative would be nothing, which we\u2019ll express here as an empty character class, giving us",
    "derivative would be nothing, which we\u2019ll express here as an empty character class, giving us",
    ".*(the|he)|he|[]",
    ".*(the|he)|he|[]",
    "or ",
    "or ",
    "129 CHAPTER 11 | Regex",
    "129 CHAPTER 11 | Regex",
    "130 CHAPTER 11 | Regex",
    "130 CHAPTER 11 | Regex",
    "Looks an awful lot like a DFA, doesn\u2019t it? It should. And that\u2019s exactly how ",
    "Looks an awful lot like a DFA, doesn\u2019t it? It should. And that\u2019s exactly how ",
    "Of course, the devil is in the details and there\u2019s a ton of complication and engineering smarts that go",
    "Of course, the devil is in the details and there\u2019s a ton of complication and engineering smarts that go",
    "As noted, the non-backtracking engine is linear in the length of the input. But that doesn\u2019t mean it",
    "As noted, the non-backtracking engine is linear in the length of the input. But that doesn\u2019t mean it",
    null,
    null,
    "131 CHAPTER 11 | Regex",
    "131 CHAPTER 11 | Regex",
    "implementation simply doesn\u2019t support, such that attempting to use any of those will fail when trying",
    "implementation simply doesn\u2019t support, such that attempting to use any of those will fail when trying",
    "Even after its progress as a standalone library from MSR, more than 100 PRs went into making",
    "Even after its progress as a standalone library from MSR, more than 100 PRs went into making",
    "RegexOptions.NonBacktracking",
    "RegexOptions.NonBacktracking",
    "There\u2019s one more set of PRs of performance interest for ",
    "There\u2019s one more set of PRs of performance interest for ",
    "the recursive algorithm as well as being able to use stack space and thus avoid additional allocation in",
    "the recursive algorithm as well as being able to use stack space and thus avoid additional allocation in",
    "on the stack, it forks off continued execution into another thread. Hitting this condition is expensive,",
    "on the stack, it forks off continued execution into another thread. Hitting this condition is expensive,",
    "As was mentioned in my previous blog post about regular expressions, both the backtracking",
    "As was mentioned in my previous blog post about regular expressions, both the backtracking",
    "RegexOptions.NonBacktracking",
    "RegexOptions.NonBacktracking",
    "132 CHAPTER 11 | Regex",
    "132 CHAPTER 11 | Regex",
    null,
    null,
    "Regex",
    "Regex",
    "relied on in .NET Framework ( ",
    "relied on in .NET Framework ( ",
    "challenge to support spans, but the problem is even more deeply rooted. All of the regex engines rely",
    "challenge to support spans, but the problem is even more deeply rooted. All of the regex engines rely",
    "functionally correct, but would have completely defeated the purpose of accepting spans, and worse,",
    "functionally correct, but would have completely defeated the purpose of accepting spans, and worse,",
    "First, we made ",
    "First, we made ",
    "133 CHAPTER 11 | Regex",
    "133 CHAPTER 11 | Regex",
    "span; they no longer need to access the protected ",
    "span; they no longer need to access the protected ",
    "int length)",
    "int length)",
    "That will result in the JIT generating assembly code along the lines of this:",
    "That will result in the JIT generating assembly code along the lines of this:",
    "In contrast, if we\u2019re dealing with a span, which already factors in the bounds, then we can write a more",
    "In contrast, if we\u2019re dealing with a span, which already factors in the bounds, then we can write a more",
    "134 CHAPTER 11 | Regex",
    "134 CHAPTER 11 | Regex",
    "And when it comes to compilers, something in a canonical form is really good, because the more",
    "And when it comes to compilers, something in a canonical form is really good, because the more",
    "So even without all the other benefits that come from operating in terms of span, we immediately get",
    "So even without all the other benefits that come from operating in terms of span, we immediately get",
    "current position is a word character and whether the character before it is a word character (factoring",
    "current position is a word character and whether the character before it is a word character (factoring",
    "and here\u2019s what the span version looks like:",
    "and here\u2019s what the span version looks like:",
    "135 CHAPTER 11 | Regex",
    "135 CHAPTER 11 | Regex",
    "And here\u2019s the resulting assembly:",
    "And here\u2019s the resulting assembly:",
    "136 CHAPTER 11 | Regex",
    "136 CHAPTER 11 | Regex",
    "The most interesting thing to notice here is the:",
    "The most interesting thing to notice here is the:",
    "at the end of the first version that doesn\u2019t exist at the end of the second. As we saw earlier, this is",
    "at the end of the first version that doesn\u2019t exist at the end of the second. As we saw earlier, this is",
    "span accesses are always in bound. As such, it doesn\u2019t need to emit any bounds checks in the method,",
    "span accesses are always in bound. As such, it doesn\u2019t need to emit any bounds checks in the method,",
    "137 CHAPTER 11 | Regex",
    "137 CHAPTER 11 | Regex",
    "Ok, so the engines are now able to be handed span inputs and process them, great, what can we do",
    "Ok, so the engines are now able to be handed span inputs and process them, great, what can we do",
    "additional information into the engines to let them know how much information they actually need to",
    "additional information into the engines to let them know how much information they actually need to",
    "So, ",
    "So, ",
    "Being a ",
    "Being a ",
    "ValueMatch",
    "ValueMatch",
    null,
    null,
    "As noted earlier, the core of all of the engines is a ",
    "As noted earlier, the core of all of the engines is a ",
    "138 CHAPTER 11 | Regex",
    "138 CHAPTER 11 | Regex",
    "when it either finds the location of the next match or exhausts the input without finding another. For",
    "when it either finds the location of the next match or exhausts the input without finding another. For",
    "We try to match the input at the current position, and if we\u2019re successful in doing so, that\u2019s it, we exit.",
    "We try to match the input at the current position, and if we\u2019re successful in doing so, that\u2019s it, we exit.",
    "As with ",
    "As with ",
    "be fast.",
    "be fast.",
    "In .NET 6, the interpreter engine had effectively two ways of implementing",
    "In .NET 6, the interpreter engine had effectively two ways of implementing",
    "TryFindNextPossibleStartingPosition",
    "TryFindNextPossibleStartingPosition",
    "RegexOptions.RightToLeft",
    "RegexOptions.RightToLeft",
    "139 CHAPTER 11 | Regex",
    "139 CHAPTER 11 | Regex",
    "and precomputing which strategy to use when the interpreter was constructed. This not only made",
    "and precomputing which strategy to use when the interpreter was constructed. This not only made",
    "being significantly better than Boyer-Moore in all but the most corner of corner cases. So this PR",
    "being significantly better than Boyer-Moore in all but the most corner of corner cases. So this PR",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    null,
    null,
    "implementation handily in real-world cases. This PR goes further than that, such that it doesn\u2019t just",
    "implementation handily in real-world cases. This PR goes further than that, such that it doesn\u2019t just",
    "140 CHAPTER 11 | Regex",
    "140 CHAPTER 11 | Regex",
    "check akin to ",
    "check akin to ",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "The previous PR started turning ",
    "The previous PR started turning ",
    null,
    null,
    "enabled strategies for finding a next good location, as it\u2019s guaranteed to begin with a \u201cword",
    "enabled strategies for finding a next good location, as it\u2019s guaranteed to begin with a \u201cword",
    "141 CHAPTER 11 | Regex",
    "141 CHAPTER 11 | Regex",
    "find it, we can match backwards through as many ",
    "find it, we can match backwards through as many ",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "Of course, as has been talked about elsewhere, the best optimizations aren\u2019t ones that make",
    "Of course, as has been talked about elsewhere, the best optimizations aren\u2019t ones that make",
    "TryFindNextPossibleStartingPosition",
    "TryFindNextPossibleStartingPosition",
    "that a pattern has an ending anchor like ",
    "that a pattern has an ending anchor like ",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    null,
    null,
    "142 CHAPTER 11 | Regex",
    "142 CHAPTER 11 | Regex",
    "By this point, the engines are able to use ",
    "By this point, the engines are able to use ",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    null,
    null,
    "Loop handling in the compiled and source generated engines has been significantly improved, both",
    "Loop handling in the compiled and source generated engines has been significantly improved, both",
    "With regular greedy loops (e.g. ",
    "With regular greedy loops (e.g. ",
    "the forward direction of that loop entails consuming every character until the next newline, which we",
    "the forward direction of that loop entails consuming every character until the next newline, which we",
    "possibly match the remainder of the pattern. Or for example, in a pattern like ",
    "possibly match the remainder of the pattern. Or for example, in a pattern like ",
    "IndexOfAnyExcept('a', 'b', 'c')",
    "IndexOfAnyExcept('a', 'b', 'c')",
    "143 CHAPTER 11 | Regex",
    "143 CHAPTER 11 | Regex",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    null,
    null,
    "TryMatchAtCurrentPosition",
    "TryMatchAtCurrentPosition",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "As mentioned elsewhere, the best optimizations are those that make work entirely vanish rather than",
    "As mentioned elsewhere, the best optimizations are those that make work entirely vanish rather than",
    "try to match ",
    "try to match ",
    "a*?b",
    "a*?b",
    "144 CHAPTER 11 | Regex",
    "144 CHAPTER 11 | Regex",
    "(Note that those comments aren\u2019t ones I added for this blog post; the source generator itself is",
    "(Note that those comments aren\u2019t ones I added for this blog post; the source generator itself is",
    "When a regular expression is input, it\u2019s parsed into a tree-based form. The \u201cauto-atomicity\u201d analysis",
    "When a regular expression is input, it\u2019s parsed into a tree-based form. The \u201cauto-atomicity\u201d analysis",
    "(?!)",
    "(?!)",
    "145 CHAPTER 11 | Regex",
    "145 CHAPTER 11 | Regex",
    "as it will produce a ",
    "as it will produce a ",
    null,
    null,
    "axy|axz|bxy|bxz",
    "axy|axz|bxy|bxz",
    null,
    null,
    "The .NET 7 regex implementation has no fewer than four engines: the interpreter (what you get if you",
    "The .NET 7 regex implementation has no fewer than four engines: the interpreter (what you get if you",
    "engine don\u2019t require any kind of code generation; they\u2019re both based on creating in-memory data",
    "engine don\u2019t require any kind of code generation; they\u2019re both based on creating in-memory data",
    null,
    null,
    "146 CHAPTER 11 | Regex",
    "146 CHAPTER 11 | Regex",
    "series of instructions, would just emit the IL for processing each. It had some opportunity for being",
    "series of instructions, would just emit the IL for processing each. It had some opportunity for being",
    "RegexOptions.RightToLeft",
    "RegexOptions.RightToLeft",
    "One of the great things about the source generator emitting idiomatic C# is it makes it easy to iterate.",
    "One of the great things about the source generator emitting idiomatic C# is it makes it easy to iterate.",
    "147 CHAPTER 11 | Regex",
    "147 CHAPTER 11 | Regex",
    "The compiler and source generator were also updated to take advantage of newer features.",
    "The compiler and source generator were also updated to take advantage of newer features.",
    "zero\u2019ing being necessary. Then there\u2019s the issue of where the code is generated; we want helper",
    "zero\u2019ing being necessary. Then there\u2019s the issue of where the code is generated; we want helper",
    "One last and interesting code generation aspect is in optimizations around character class matching.",
    "One last and interesting code generation aspect is in optimizations around character class matching.",
    "optimizations around the handling of \u201cmatch anything\u201d can kick in.",
    "optimizations around the handling of \u201cmatch anything\u201d can kick in.",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "about, in the generated output; for example this:",
    "about, in the generated output; for example this:",
    "now produces this in the core matching logic emitted by the source generator:",
    "now produces this in the core matching logic emitted by the source generator:",
    "148 CHAPTER 11 | Regex",
    "148 CHAPTER 11 | Regex",
    null,
    null,
    "Finally, with all of these improvements to ",
    "Finally, with all of these improvements to ",
    "expensive phases in the non-backtracking engine to compute exact bounds and capture information.",
    "expensive phases in the non-backtracking engine to compute exact bounds and capture information.",
    "in a way as to try to make it as trimmmer friendly as possible. If you only ever do ",
    "in a way as to try to make it as trimmmer friendly as possible. If you only ever do ",
    "Regex(pattern)",
    "Regex(pattern)",
    "options, we increase the chances that no code in the app is using this constructor, which would in turn",
    "options, we increase the chances that no code in the app is using this constructor, which would in turn",
    "149 CHAPTER 11 | Regex",
    "149 CHAPTER 11 | Regex",
    null,
    null,
    "System.Collections",
    "System.Collections",
    "Dictionary<,>",
    "Dictionary<,>",
    "shows a measurable improvement in throughput between .NET 6 and .NET 7:",
    "shows a measurable improvement in throughput between .NET 6 and .NET 7:",
    "|Method|Runtime|Mean|Ratio|Code Size|",
    "|Method|Runtime|Mean|Ratio|Code Size|",
    "that array can\u2019t be mutated, but if there are mutable reference types stored in the array, those",
    "that array can\u2019t be mutated, but if there are mutable reference types stored in the array, those",
    "150 CHAPTER 12 | Collections",
    "150 CHAPTER 12 | Collections",
    "allocation, while also speeding up the sort itself by removing several layers of indirection from every",
    "allocation, while also speeding up the sort itself by removing several layers of indirection from every",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "perspective because it means if you have your data in a span, you can get it into an",
    "perspective because it means if you have your data in a span, you can get it into an",
    "ImmutableArray<T>",
    "ImmutableArray<T>",
    "SortedSet<T>",
    "SortedSet<T>",
    "streamlining how the iteration through the nodes in the tree is handled.",
    "streamlining how the iteration through the nodes in the tree is handled.",
    "151 CHAPTER 12 | Collections",
    "151 CHAPTER 12 | Collections",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    null,
    null,
    "152 CHAPTER 12 | Collections",
    "152 CHAPTER 12 | Collections",
    null,
    null,
    "Let\u2019s move on to Language-Integrated Query (LINQ). LINQ is a productivity feature that practically",
    "Let\u2019s move on to Language-Integrated Query (LINQ). LINQ is a productivity feature that practically",
    "System.Linq.Enumerable",
    "System.Linq.Enumerable",
    "Length",
    "Length",
    "arrays, but still improved performance even for short arrays (because the implementation is now able",
    "arrays, but still improved performance even for short arrays (because the implementation is now able",
    "153 CHAPTER 13 | LINQ",
    "153 CHAPTER 13 | LINQ",
    "|Method|Runtime|Length|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Length|Mean|Ratio|Allocated|Alloc Ratio|",
    "One of the more interesting aspects of the PR, however, is one line that\u2019s meant to help with the nonarray cases. In performance optimization, and in particular when adding \u201cfast paths\u201d to better handle",
    "One of the more interesting aspects of the PR, however, is one line that\u2019s meant to help with the nonarray cases. In performance optimization, and in particular when adding \u201cfast paths\u201d to better handle",
    "However, if you look at the PR, you\u2019ll see the ",
    "However, if you look at the PR, you\u2019ll see the ",
    "How come? Well at this point in the code flow, we know that source isn\u2019t null, so we don\u2019t need the",
    "How come? Well at this point in the code flow, we know that source isn\u2019t null, so we don\u2019t need the",
    "language disagree on aspects of the type system. If you change that",
    "language disagree on aspects of the type system. If you change that",
    "work as part of the type check than just a simple comparison against the known type identity of",
    "work as part of the type check than just a simple comparison against the known type identity of",
    "154 CHAPTER 13 | LINQ",
    "154 CHAPTER 13 | LINQ",
    "int[]",
    "int[]",
    "This results in:",
    "This results in:",
    "Note the former involves a method call to the JIT\u2019s ",
    "Note the former involves a method call to the JIT\u2019s ",
    "|Method|Mean|Ratio|Code Size|",
    "|Method|Mean|Ratio|Code Size|",
    "Of course, these two operations aren\u2019t semantically equivalent, so if this was for something that",
    "Of course, these two operations aren\u2019t semantically equivalent, so if this was for something that",
    "155 CHAPTER 13 | LINQ",
    "155 CHAPTER 13 | LINQ",
    null,
    null,
    "form to avoid significantly penalizing other inputs. Both of these types enable extracting a",
    "form to avoid significantly penalizing other inputs. Both of these types enable extracting a",
    "can do a few interesting things. This PR:",
    "can do a few interesting things. This PR:",
    "The effect of that is evident in microbenchmarks, e.g.",
    "The effect of that is evident in microbenchmarks, e.g.",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "156 CHAPTER 13 | LINQ",
    "156 CHAPTER 13 | LINQ",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "The previous LINQ PRs were examples from making existing operations faster. But sometimes",
    "The previous LINQ PRs were examples from making existing operations faster. But sometimes",
    "spirit of pairs like ",
    "spirit of pairs like ",
    "x => x",
    "x => x",
    "157 CHAPTER 13 | LINQ",
    "157 CHAPTER 13 | LINQ",
    "|Method|Length|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Length|Mean|Ratio|Allocated|Alloc Ratio|",
    "158 CHAPTER 13 | LINQ",
    "158 CHAPTER 13 | LINQ",
    null,
    null,
    ".NET 6 saw some huge file I/O improvements, in particular a complete rewrite of ",
    ".NET 6 saw some huge file I/O improvements, in particular a complete rewrite of ",
    "One form of performance improvement that also masquerades as a reliability improvement is",
    "One form of performance improvement that also masquerades as a reliability improvement is",
    "In some cases, it comes from adding cancelable overloads where things weren\u2019t previously cancelable",
    "In some cases, it comes from adding cancelable overloads where things weren\u2019t previously cancelable",
    null,
    null,
    null,
    null,
    "fully cancelable.",
    "fully cancelable.",
    "From my perspective, though, a more interesting form of this is when an existing overload is",
    "From my perspective, though, a more interesting form of this is when an existing overload is",
    "up-front check for cancellation, such that if cancellation was requested prior to the call being made, it",
    "up-front check for cancellation, such that if cancellation was requested prior to the call being made, it",
    "between handles opened for synchronous I/O from handles opened for overlapped I/O (aka",
    "between handles opened for synchronous I/O from handles opened for overlapped I/O (aka",
    "159 CHAPTER 14 | File I/O",
    "159 CHAPTER 14 | File I/O",
    "Unix, named pipes, contrary to their naming, are actually implemented on top of Unix domain sockets.",
    "Unix, named pipes, contrary to their naming, are actually implemented on top of Unix domain sockets.",
    ".NET Framework 4.8: No cancellation support. The pipe ",
    ".NET Framework 4.8: No cancellation support. The pipe ",
    ".NET Core 1.0: On Windows, with a named pipe opened for asynchronous I/O, cancellation was",
    ".NET Core 1.0: On Windows, with a named pipe opened for asynchronous I/O, cancellation was",
    "asynchronous operation. On Unix, with named pipes implemented in terms of sockets, if the pipe",
    "asynchronous operation. On Unix, with named pipes implemented in terms of sockets, if the pipe",
    "token, and then looping around to do it again until either the ",
    "token, and then looping around to do it again until either the ",
    ".NET Core 2.1: On Unix, the implementation was improved to avoid the polling loop, but it still",
    ".NET Core 2.1: On Unix, the implementation was improved to avoid the polling loop, but it still",
    "actually consuming it. The Unix implementation for asynchronous named pipe streams then",
    "actually consuming it. The Unix implementation for asynchronous named pipe streams then",
    ".NET Core 3.0: On Unix, ",
    ".NET Core 3.0: On Unix, ",
    "anonymous and named pipes, regardless of how they were opened.",
    "anonymous and named pipes, regardless of how they were opened.",
    "So by .NET 5, the problem was addressed on Unix, but still an issue on Windows. Until now. In .NET 7,",
    "So by .NET 5, the problem was addressed on Unix, but still an issue on Windows. Until now. In .NET 7,",
    "160 CHAPTER 14 | File I/O",
    "160 CHAPTER 14 | File I/O",
    "So, there\u2019s a small spin loop employed, where if cancellation is requested between the time",
    "So, there\u2019s a small spin loop employed, where if cancellation is requested between the time",
    "CancellationTokenRegistration.Dispose",
    "CancellationTokenRegistration.Dispose",
    "161 CHAPTER 14 | File I/O",
    "161 CHAPTER 14 | File I/O",
    "|Method|Runtime|Cancelable|Named|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Cancelable|Named|Mean|Ratio|Allocated|Alloc Ratio|",
    "The rest of the performance-focused changes around I/O in .NET 7 were primarily focused on one of",
    "The rest of the performance-focused changes around I/O in .NET 7 were primarily focused on one of",
    "Several PRs went into reducing syscalls on Unix as part of copying files, e.g. ",
    "Several PRs went into reducing syscalls on Unix as part of copying files, e.g. ",
    "FileInfo.CopyTo",
    "FileInfo.CopyTo",
    "now also extracts from the results of that single ",
    "now also extracts from the results of that single ",
    "copy_file_range",
    "copy_file_range",
    "162 CHAPTER 14 | File I/O",
    "162 CHAPTER 14 | File I/O",
    "some issues the function had in previous releases). Unlike a typical read/write loop that reads the data",
    "some issues the function had in previous releases). Unlike a typical read/write loop that reads the data",
    "data from a file, and hints to OS caching to expect data to be read from the file sequentially rather",
    "data from a file, and hints to OS caching to expect data to be read from the file sequentially rather",
    "benefiting from it. This situation is akin to the famous Henny Youngman joke: \u201cThe patient says,",
    "benefiting from it. This situation is akin to the famous Henny Youngman joke: \u201cThe patient says,",
    "Directory handling has seen reduced syscalls across the directory lifecycle, especially on Unix.",
    "Directory handling has seen reduced syscalls across the directory lifecycle, especially on Unix.",
    "mkdir",
    "mkdir",
    null,
    null,
    "rename",
    "rename",
    "163 CHAPTER 14 | File I/O",
    "163 CHAPTER 14 | File I/O",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "[",
    "[",
    "to determine whether the specified file already exists; that\u2019s because later in the method as part of",
    "to determine whether the specified file already exists; that\u2019s because later in the method as part of",
    "than ",
    "than ",
    "the superfluous ",
    "the superfluous ",
    "but the practical implication of this is that closing either needn\u2019t bother flushing, since that view",
    "but the practical implication of this is that closing either needn\u2019t bother flushing, since that view",
    "Dispose",
    "Dispose",
    "164 CHAPTER 14 | File I/O",
    "164 CHAPTER 14 | File I/O",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "Beyond system calls, there have also been a plethora of improvements around reducing allocation.",
    "Beyond system calls, there have also been a plethora of improvements around reducing allocation.",
    "things: one, that these operations are common enough that it\u2019s worth avoiding the small-butmeasurable overhead of going through a ",
    "things: one, that these operations are common enough that it\u2019s worth avoiding the small-butmeasurable overhead of going through a ",
    "StreamWriter",
    "StreamWriter",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "165 CHAPTER 14 | File I/O",
    "165 CHAPTER 14 | File I/O",
    "additional syscall can measure up to 10% of the total cost (and for larger files, modern kernels are",
    "additional syscall can measure up to 10% of the total cost (and for larger files, modern kernels are",
    "wrapped each string in a span and delegated to the span-based overloads. However, in the event that",
    "wrapped each string in a span and delegated to the span-based overloads. However, in the event that",
    "string",
    "string",
    null,
    null,
    null,
    null,
    null,
    null,
    "In fairness, these are more about usability than they are about performance, but in this case there\u2019s a",
    "In fairness, these are more about usability than they are about performance, but in this case there\u2019s a",
    "166 CHAPTER 14 | File I/O",
    "166 CHAPTER 14 | File I/O",
    "that negatively impact performance, such as by using a ",
    "that negatively impact performance, such as by using a ",
    "167 CHAPTER 14 | File I/O",
    "167 CHAPTER 14 | File I/O",
    null,
    null,
    "on top of. For the most part, these types just provide wrappers around a native C implementation",
    "on top of. For the most part, these types just provide wrappers around a native C implementation",
    "As with many compression algorithms, Brotli provides a knob that allows for a quintessential tradeoff",
    "As with many compression algorithms, Brotli provides a knob that allows for a quintessential tradeoff",
    "value when one is.",
    "value when one is.",
    "For better or worse (and I\u2019m about to argue \u201cmuch worse\u201d), the native C implementation itself defines",
    "For better or worse (and I\u2019m about to argue \u201cmuch worse\u201d), the native C implementation itself defines",
    "value is poorly named. It\u2019s intended to represent a good default that\u2019s a balanced tradeoff between",
    "value is poorly named. It\u2019s intended to represent a good default that\u2019s a balanced tradeoff between",
    "default, you\u2019re getting the dial turned all the way up to 11.",
    "default, you\u2019re getting the dial turned all the way up to 11.",
    "Is that so bad? Maybe compression quality is the most important thing? For example, reducing the",
    "Is that so bad? Maybe compression quality is the most important thing? For example, reducing the",
    "The problem is just how much this extra effort costs. Compression speed and ratio are highly",
    "The problem is just how much this extra effort costs. Compression speed and ratio are highly",
    "168 CHAPTER 15 | Compression",
    "168 CHAPTER 15 | Compression",
    "uses ",
    "uses ",
    "169 CHAPTER 15 | Compression",
    "169 CHAPTER 15 | Compression",
    "The code is measuring how long it takes to compress the input data at each of the levels (doing a",
    "The code is measuring how long it takes to compress the input data at each of the levels (doing a",
    "|Level|Size (bytes)|",
    "|Level|Size (bytes)|",
    "That\u2019s a fairly liner progression from least to most compression. That\u2019s not the problem. This is the",
    "That\u2019s a fairly liner progression from least to most compression. That\u2019s not the problem. This is the",
    "170 CHAPTER 15 | Compression",
    "170 CHAPTER 15 | Compression",
    "|Level|Time",
    "|Level|Time",
    "This chart shows an almost exponential increase in processing time as we near the upper end of the",
    "This chart shows an almost exponential increase in processing time as we near the upper end of the",
    "represent a fairly balanced trade-off between size and speed.",
    "represent a fairly balanced trade-off between size and speed.",
    "171 CHAPTER 15 | Compression",
    "171 CHAPTER 15 | Compression",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "System.IO.Packaging",
    "System.IO.Packaging",
    "172 CHAPTER 15 | Compression",
    "172 CHAPTER 15 | Compression",
    null,
    null,
    "Networking is the life-blood of almost every service, with performance being critical to success. In",
    "Networking is the life-blood of almost every service, with performance being critical to success. In",
    "That said, there were some interesting performance improvements in sockets itself for .NET 7. One of",
    "That said, there were some interesting performance improvements in sockets itself for .NET 7. One of",
    "complicated to use well, it\u2019s relatively inefficient, resulting in allocation for every single operation",
    "complicated to use well, it\u2019s relatively inefficient, resulting in allocation for every single operation",
    "SocketsAsyncEventArgs",
    "SocketsAsyncEventArgs",
    "covers, and so while most code these days isn\u2019t written to use ",
    "covers, and so while most code these days isn\u2019t written to use ",
    "SocketAsyncEventArgs",
    "SocketAsyncEventArgs",
    "was introduced in earlier releases of .NET Core, and it enables a significant number of socket",
    "was introduced in earlier releases of .NET Core, and it enables a significant number of socket",
    "173 CHAPTER 16 | Networking",
    "173 CHAPTER 16 | Networking",
    "a potential race condition, where our code that\u2019s still setting up the asynchronous operation is racing",
    "a potential race condition, where our code that\u2019s still setting up the asynchronous operation is racing",
    "comparing spans, doing it byte-by-byte is also much less efficient than the vectorized implementation",
    "comparing spans, doing it byte-by-byte is also much less efficient than the vectorized implementation",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "174 CHAPTER 16 | Networking",
    "174 CHAPTER 16 | Networking",
    "Let\u2019s move up to some more interesting changes in the layers above ",
    "Let\u2019s move up to some more interesting changes in the layers above ",
    "SslStream",
    "SslStream",
    "One of the more impactful changes to ",
    "One of the more impactful changes to ",
    "175 CHAPTER 16 | Networking",
    "175 CHAPTER 16 | Networking",
    "176 CHAPTER 16 | Networking",
    "176 CHAPTER 16 | Networking",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "Another significant improvement for ",
    "Another significant improvement for ",
    "177 CHAPTER 16 | Networking",
    "177 CHAPTER 16 | Networking",
    "the OCSP responder, the server itself contacts the OCSP responder and gets a signed ticket from the",
    "the OCSP responder, the server itself contacts the OCSP responder and gets a signed ticket from the",
    "The aforementioned changes are primarily about the performance of opening a connection.",
    "The aforementioned changes are primarily about the performance of opening a connection.",
    "And then some code in the same implementation comes along and wants to read the contents of",
    "And then some code in the same implementation comes along and wants to read the contents of",
    "but the very act of accessing ",
    "but the very act of accessing ",
    "Count",
    "Count",
    "It can save that unnecessary collection allocation. The approach is made even simpler with C# pattern",
    "It can save that unnecessary collection allocation. The approach is made even simpler with C# pattern",
    "This is one of those things that\u2019s incredibly obvious once you \u201csee\u201d it and realize what\u2019s happening,",
    "This is one of those things that\u2019s incredibly obvious once you \u201csee\u201d it and realize what\u2019s happening,",
    null,
    null,
    "178 CHAPTER 16 | Networking",
    "178 CHAPTER 16 | Networking",
    "by far the most common byte sequences are equivalent to \u201chttp/1.1\u201d for HTTP/1.1, \u201ch2\u201d for HTTP/2,",
    "by far the most common byte sequences are equivalent to \u201chttp/1.1\u201d for HTTP/1.1, \u201ch2\u201d for HTTP/2,",
    "byte[]",
    "byte[]",
    "SslStream",
    "SslStream",
    "Everything discussed thus far was about establishing connections. What about the performance of",
    "Everything discussed thus far was about establishing connections. What about the performance of",
    "When ",
    "When ",
    "MemoryStream.ReadAsync",
    "MemoryStream.ReadAsync",
    "actual native call with its own much larger buffer, which by default is 4K. The first time you issue your",
    "actual native call with its own much larger buffer, which by default is 4K. The first time you issue your",
    "devised to minimize this, e.g. if the ",
    "devised to minimize this, e.g. if the ",
    "ValueTask<TResult>",
    "ValueTask<TResult>",
    "179 CHAPTER 16 | Networking",
    "179 CHAPTER 16 | Networking",
    "them. ",
    "them. ",
    "allocation overhead for the synchronously-completing case. Yay, everyone\u2019s happy. Well, almost",
    "allocation overhead for the synchronously-completing case. Yay, everyone\u2019s happy. Well, almost",
    "can implement this interface with whatever behaviors they want, although we codified the typical",
    "can implement this interface with whatever behaviors they want, although we codified the typical",
    "allocation-free (there is another instance used for ",
    "allocation-free (there is another instance used for ",
    "can be changed to be:",
    "can be changed to be:",
    "which will cause the C# compiler to emit the implementation of this method using",
    "which will cause the C# compiler to emit the implementation of this method using",
    null,
    null,
    "180 CHAPTER 16 | Networking",
    "180 CHAPTER 16 | Networking",
    "tradeoffs involved in its usage, and while it can make microbenchmarks look really good, it can also",
    "tradeoffs involved in its usage, and while it can make microbenchmarks look really good, it can also",
    "Such is the case with ",
    "Such is the case with ",
    "SslStream",
    "SslStream",
    "await",
    "await",
    "181 CHAPTER 16 | Networking",
    "181 CHAPTER 16 | Networking",
    "|Method|Runtime|Mean|Ratio|Code Size|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Code Size|Allocated|Alloc Ratio|",
    "One final change related to reading and writing performance on an ",
    "One final change related to reading and writing performance on an ",
    "at the leaves, e.g.",
    "at the leaves, e.g.",
    "This way most of the logic and code is shared, and when useAsync is false, everything completes",
    "This way most of the logic and code is shared, and when useAsync is false, everything completes",
    "182 CHAPTER 16 | Networking",
    "182 CHAPTER 16 | Networking",
    "We can then declare two implementations of this interface:",
    "We can then declare two implementations of this interface:",
    "Then we can redeclare our earlier example as:",
    "Then we can redeclare our earlier example as:",
    "Note that the generic constraint on the ",
    "Note that the generic constraint on the ",
    "This latter generic approach is how ",
    "This latter generic approach is how ",
    "our types as (note the ",
    "our types as (note the ",
    "183 CHAPTER 16 | Networking",
    "183 CHAPTER 16 | Networking",
    "and our consuming methods as (note the removal of the parameter and the switch to calling static",
    "and our consuming methods as (note the removal of the parameter and the switch to calling static",
    "Not only is this cleaner, but from a performance perspective we no longer need to pass around the",
    "Not only is this cleaner, but from a performance perspective we no longer need to pass around the",
    "way to abstract over DFA and NFA-based operations using the same code (this technique was since",
    "way to abstract over DFA and NFA-based operations using the same code (this technique was since",
    "functionality: searching forward or backwards, and with equality or inequality. While more challenging",
    "functionality: searching forward or backwards, and with equality or inequality. While more challenging",
    "optimizations of the non- ",
    "optimizations of the non- ",
    "184 CHAPTER 16 | Networking",
    "184 CHAPTER 16 | Networking",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "Let\u2019s move up the stack to HTTP. Most of the folks focusing on networking in .NET 7 were focused on",
    "Let\u2019s move up the stack to HTTP. Most of the folks focusing on networking in .NET 7 were focused on",
    "One aspect of ",
    "One aspect of ",
    "that can be sent with an HTTP request or response (though in order to mitigate possible denial of",
    "that can be sent with an HTTP request or response (though in order to mitigate possible denial of",
    null,
    null,
    "HeaderDescriptor",
    "HeaderDescriptor",
    "185 CHAPTER 16 | Networking",
    "185 CHAPTER 16 | Networking",
    "need to look up information from that field, we cut the number of fields in half. And while this",
    "need to look up information from that field, we cut the number of fields in half. And while this",
    "HeaderDescriptor",
    "HeaderDescriptor",
    "HeaderDescriptor",
    "HeaderDescriptor",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "implementation of this type were overly flexible, with a mechanism for custom validation of values,",
    "implementation of this type were overly flexible, with a mechanism for custom validation of values,",
    "parsed host information, but only some of the callers needed this. Rather than making everyone pay",
    "parsed host information, but only some of the callers needed this. Rather than making everyone pay",
    "Other small allocation improvements were also made outside of headers. For example, when new",
    "Other small allocation improvements were also made outside of headers. For example, when new",
    "just be eaten, and the lambda being passed to ",
    "just be eaten, and the lambda being passed to ",
    "both superfluous allocations.",
    "both superfluous allocations.",
    "186 CHAPTER 16 | Networking",
    "186 CHAPTER 16 | Networking",
    "Folks using HTTP often need to go through a proxy server, and in .NET the ability to go through an",
    "Folks using HTTP often need to go through a proxy server, and in .NET the ability to go through an",
    "bypassed is determined by two things (assuming a non-null proxy ",
    "bypassed is determined by two things (assuming a non-null proxy ",
    null,
    null,
    "Regex",
    "Regex",
    "Regex",
    "Regex",
    "improvements:",
    "improvements:",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "Also related to HTTP, ",
    "Also related to HTTP, ",
    "187 CHAPTER 16 | Networking",
    "187 CHAPTER 16 | Networking",
    "IndexOfAny",
    "IndexOfAny",
    "|Method|Runtime|Mean|Ratio|",
    "|Method|Runtime|Mean|Ratio|",
    "There have been a myriad of other performance-related improvements in networking as well, such as",
    "There have been a myriad of other performance-related improvements in networking as well, such as",
    "used and the runtime needs to be involved in the conversion, it\u2019s also much more heavyweight than",
    "used and the runtime needs to be involved in the conversion, it\u2019s also much more heavyweight than",
    "188 CHAPTER 16 | Networking",
    "188 CHAPTER 16 | Networking",
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    "For folks using ",
    "For folks using ",
    null,
    null,
    "handshake by reusing a buffer rather than reallocating a new buffer for each of multiple phases of the",
    "handshake by reusing a buffer rather than reallocating a new buffer for each of multiple phases of the",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "189 CHAPTER 16 | Networking",
    "189 CHAPTER 16 | Networking",
    null,
    null,
    "System.Text.Json",
    "System.Text.Json",
    "One of the biggest performance pitfalls we\u2019ve seen developers face with ",
    "One of the biggest performance pitfalls we\u2019ve seen developers face with ",
    "190 CHAPTER 17 | JSON",
    "190 CHAPTER 17 | JSON",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    null,
    null,
    "reflection emit, those are also cached at the global level (with appropriate removal when no longer",
    "reflection emit, those are also cached at the global level (with appropriate removal when no longer",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "As can be seen here, it\u2019s still more expensive to create a new ",
    "As can be seen here, it\u2019s still more expensive to create a new ",
    "Another change to ",
    "Another change to ",
    "few extra objects and an extra couple of hundred bytes just for these helper data structures. To",
    "few extra objects and an extra couple of hundred bytes just for these helper data structures. To",
    "191 CHAPTER 17 | JSON",
    "191 CHAPTER 17 | JSON",
    "Serialize",
    "Serialize",
    "making use of the pool, not sequestered off in this cached ",
    "making use of the pool, not sequestered off in this cached ",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "Utf8JsonWriter",
    "Utf8JsonWriter",
    "192 CHAPTER 17 | JSON",
    "192 CHAPTER 17 | JSON",
    null,
    null,
    "System.Xml is used by a huge number of applications and services, but ever since JSON hit the scene",
    "System.Xml is used by a huge number of applications and services, but ever since JSON hit the scene",
    "Sometimes a performance fix is as easy as changing a single number. That\u2019s the case with",
    "Sometimes a performance fix is as easy as changing a single number. That\u2019s the case with",
    "much memory needs to be zero\u2019d, etc). While it\u2019s still a very large allocation, and in the future we",
    "much memory needs to be zero\u2019d, etc). While it\u2019s still a very large allocation, and in the future we",
    "193 CHAPTER 18 | XML",
    "193 CHAPTER 18 | XML",
    "|Method|Runtime|ItemCount|Mean|Ratio|Allocated|Alloc",
    "|Method|Runtime|ItemCount|Mean|Ratio|Allocated|Alloc",
    "these cases were stylistic, converting something like ",
    "these cases were stylistic, converting something like ",
    "$\"{string1}:{string2}\"",
    "$\"{string1}:{string2}\"",
    "Concat",
    "Concat",
    "where ",
    "where ",
    "which while shorter is also more efficient, avoiding the intermediate string allocations, as the custom",
    "which while shorter is also more efficient, avoiding the intermediate string allocations, as the custom",
    "using reflection emit to dynamically generate IL at run-time that are tuned to the specific shape of the",
    "using reflection emit to dynamically generate IL at run-time that are tuned to the specific shape of the",
    "194 CHAPTER 18 | XML",
    "194 CHAPTER 18 | XML",
    "generators we love today). In both cases, when deserializing, the generated code wants to track which",
    "generators we love today). In both cases, when deserializing, the generated code wants to track which",
    "into a ",
    "into a ",
    "Here\u2019s what I see when I run this under .NET 6:",
    "Here\u2019s what I see when I run this under .NET 6:",
    "195 CHAPTER 18 | XML",
    "195 CHAPTER 18 | XML",
    "We\u2019re running a thousand deserializations, each of which will deserialize 10 ",
    "We\u2019re running a thousand deserializations, each of which will deserialize 10 ",
    "bool[]",
    "bool[]",
    "Other allocation reduction went into the creation of the serializer/deserializer itself, such as with",
    "Other allocation reduction went into the creation of the serializer/deserializer itself, such as with",
    null,
    null,
    null,
    null,
    "this is a fairly common performance-focused replacement to do, but you need to be careful as",
    "this is a fairly common performance-focused replacement to do, but you need to be careful as",
    "Hashtable",
    "Hashtable",
    null,
    null,
    "196 CHAPTER 18 | XML",
    "196 CHAPTER 18 | XML",
    "avoid temporary string allocation in the implementation of the internal ",
    "avoid temporary string allocation in the implementation of the internal ",
    "XsdDuration",
    "XsdDuration",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "XML pops up in other areas as well, as in the ",
    "XML pops up in other areas as well, as in the ",
    "System.Diagnostics.Trace",
    "System.Diagnostics.Trace",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "197 CHAPTER 18 | XML",
    "197 CHAPTER 18 | XML",
    null,
    null,
    "Some fairly significant new features came to ",
    "Some fairly significant new features came to ",
    null,
    null,
    "System.Security.Cryptography",
    "System.Security.Cryptography",
    "shared framework folder for a previous release, e.g. here\u2019s mine for .NET 6:",
    "shared framework folder for a previous release, e.g. here\u2019s mine for .NET 6:",
    "These PRs move all of that code into a single ",
    "These PRs move all of that code into a single ",
    "198 CHAPTER 19 | Cryptography",
    "198 CHAPTER 19 | Cryptography",
    "requiring multiple (or even most) of these assemblies. Every assembly that\u2019s loaded adds overhead.",
    "requiring multiple (or even most) of these assemblies. Every assembly that\u2019s loaded adds overhead.",
    "Interesting, you still see a bunch of assemblies there, but all except for",
    "Interesting, you still see a bunch of assemblies there, but all except for",
    "System.Security.Cryptography.dll",
    "System.Security.Cryptography.dll",
    null,
    null,
    "199 CHAPTER 19 | Cryptography",
    "199 CHAPTER 19 | Cryptography",
    "In addition to the startup and maintenance wins this provides, this has also enabled further",
    "In addition to the startup and maintenance wins this provides, this has also enabled further",
    "public types.",
    "public types.",
    "In terms of actual code improvements, there are many. One category of improvements is around",
    "In terms of actual code improvements, there are many. One category of improvements is around",
    "200 CHAPTER 19 | Cryptography",
    "200 CHAPTER 19 | Cryptography",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "In addition to making one-shots lighterweight, other PRs have then used these one-shot operations in",
    "In addition to making one-shots lighterweight, other PRs have then used these one-shot operations in",
    "[",
    "[",
    "[",
    "[",
    null,
    null,
    "There\u2019s also a large number of PRs that have focused on removing allocations from around the crypto",
    "There\u2019s also a large number of PRs that have focused on removing allocations from around the crypto",
    null,
    null,
    "[",
    "[",
    "[",
    "[",
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    "201 CHAPTER 19 | Cryptography",
    "201 CHAPTER 19 | Cryptography",
    "Rfc2898DeriveBytes",
    "Rfc2898DeriveBytes",
    "complexity is misleading. Yes, these provide very efficient searching, but there\u2019s still overhead",
    "complexity is misleading. Yes, these provide very efficient searching, but there\u2019s still overhead",
    "structure may not even be needed at all: the search can just be open-coded as a waterfall of",
    "structure may not even be needed at all: the search can just be open-coded as a waterfall of",
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    "call (again a defensive copy to avoid having to deal with the possiblity that the consumer",
    "call (again a defensive copy to avoid having to deal with the possiblity that the consumer",
    "enables accessing this data freely without additional allocation.",
    "enables accessing this data freely without additional allocation.",
    "202 CHAPTER 19 | Cryptography",
    "202 CHAPTER 19 | Cryptography",
    null,
    null,
    "Let\u2019s turn our attention to System.Diagnostics, which encompasses types ranging from process",
    "Let\u2019s turn our attention to System.Diagnostics, which encompasses types ranging from process",
    "The ",
    "The ",
    "for each. It turns out that previous releases of .NET were loading the full information (e.g. all of its",
    "for each. It turns out that previous releases of .NET were loading the full information (e.g. all of its",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "a single member of one of those lazy-loaded ",
    "a single member of one of those lazy-loaded ",
    "NtQuerySystemInformation",
    "NtQuerySystemInformation",
    "203 CHAPTER 20 | Diagnostics",
    "203 CHAPTER 20 | Diagnostics",
    "process\u2019 name, it\u2019s a huge boost in throughput, and even if you subsequently go on to read additional",
    "process\u2019 name, it\u2019s a huge boost in throughput, and even if you subsequently go on to read additional",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "Interestingly, this PR had a small deficiency we didn\u2019t initially catch, which is that the",
    "Interestingly, this PR had a small deficiency we didn\u2019t initially catch, which is that the",
    "QueryFullProcessImageName",
    "QueryFullProcessImageName",
    null,
    null,
    null,
    null,
    "ArrayPool",
    "ArrayPool",
    "Another area of performance investment has been in ",
    "Another area of performance investment has been in ",
    "204 CHAPTER 20 | Diagnostics",
    "204 CHAPTER 20 | Diagnostics",
    "enumerator returned when enumerating ",
    "enumerator returned when enumerating ",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "[",
    "[",
    "205 CHAPTER 20 | Diagnostics",
    "205 CHAPTER 20 | Diagnostics",
    "|Method|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Mean|Ratio|Allocated|Alloc Ratio|",
    "Of course, when it comes to diagnostics, anyone who\u2019s ever done anything with regards to timing and",
    "Of course, when it comes to diagnostics, anyone who\u2019s ever done anything with regards to timing and",
    "is easy, but allocates a new object just to measure. To address this, ",
    "is easy, but allocates a new object just to measure. To address this, ",
    "that last mile of performance can write:",
    "that last mile of performance can write:",
    "which avoids the allocation and saves a few cycles:",
    "which avoids the allocation and saves a few cycles:",
    "206 CHAPTER 20 | Diagnostics",
    "206 CHAPTER 20 | Diagnostics",
    "|Method|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Mean|Ratio|Allocated|Alloc Ratio|",
    "207 CHAPTER 20 | Diagnostics",
    "207 CHAPTER 20 | Diagnostics",
    null,
    null,
    "It might be odd to see the subject of \u201cexceptions\u201d in a post on performance improvements. After all,",
    "It might be odd to see the subject of \u201cexceptions\u201d in a post on performance improvements. After all,",
    "Instead, one of the things we ",
    "Instead, one of the things we ",
    "Because of all of that, high-performance libraries often come up with custom \u201cthrow helpers\u201d they use",
    "Because of all of that, high-performance libraries often come up with custom \u201cthrow helpers\u201d they use",
    "This keeps the IL associated with the throwing out of the calling function, minimizing the impact of",
    "This keeps the IL associated with the throwing out of the calling function, minimizing the impact of",
    "Other times, libraries will encapsulate both the checking and throwing. This is exactly what the",
    "Other times, libraries will encapsulate both the checking and throwing. This is exactly what the",
    "208 CHAPTER 21 | Exceptions",
    "208 CHAPTER 21 | Exceptions",
    "With that, callers benefit from the concise call site:",
    "With that, callers benefit from the concise call site:",
    "the IL remains concise, and the assembly generated for the JIT will include the streamlined condition",
    "the IL remains concise, and the assembly generated for the JIT will include the streamlined condition",
    "Whenever we introduce new public APIs in .NET, I\u2019m particularly keen on seeing them used as widely",
    "Whenever we introduce new public APIs in .NET, I\u2019m particularly keen on seeing them used as widely",
    "For those unaware, the ",
    "For those unaware, the ",
    "The C# compiler then compiled that as equivalent to:",
    "The C# compiler then compiled that as equivalent to:",
    "(albeit using its own ",
    "(albeit using its own ",
    "from Kung Fu Panda, \u201cOne often meets his destiny on the road he takes to avoid it\u201d? The presence of",
    "from Kung Fu Panda, \u201cOne often meets his destiny on the road he takes to avoid it\u201d? The presence of",
    "209 CHAPTER 21 | Exceptions",
    "209 CHAPTER 21 | Exceptions",
    "APIs internally. Interestingly, while we expected a peanut-buttery effect of slight perf improvements in",
    "APIs internally. Interestingly, while we expected a peanut-buttery effect of slight perf improvements in",
    "With the success of ",
    "With the success of ",
    null,
    null,
    "210 CHAPTER 21 | Exceptions",
    "210 CHAPTER 21 | Exceptions",
    null,
    null,
    "On Windows, the Registry is a database provided by the OS for applications and the system itself to",
    "On Windows, the Registry is a database provided by the OS for applications and the system itself to",
    "built it as release, and then ran the resulting .exe. That execution alone triggered 64 ",
    "built it as release, and then ran the resulting .exe. That execution alone triggered 64 ",
    "It\u2019s thus beneficial to streamline access to registry data on Windows, in particular for reducing",
    "It\u2019s thus beneficial to streamline access to registry data on Windows, in particular for reducing",
    "required in order to store the value for the key. The implementation would then allocate a buffer of",
    "required in order to store the value for the key. The implementation would then allocate a buffer of",
    "was sufficiently large, we no longer have to make a second system call to retrieve the actual data: we",
    "was sufficiently large, we no longer have to make a second system call to retrieve the actual data: we",
    "the resulting string.",
    "the resulting string.",
    "211 CHAPTER 22 | Registry",
    "211 CHAPTER 22 | Registry",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Runtime|Mean|Ratio|Allocated|Alloc Ratio|",
    "212 CHAPTER 22 | Registry",
    "212 CHAPTER 22 | Registry",
    null,
    null,
    "The ability to easily plug custom code, whether for analyzers or source generators, into the Roslyn",
    "The ability to easily plug custom code, whether for analyzers or source generators, into the Roslyn",
    null,
    null,
    "[",
    "[",
    "Virtual calls are more expensive than regular non-virtual invocation and generally can\u2019t be",
    "Virtual calls are more expensive than regular non-virtual invocation and generally can\u2019t be",
    "helper method in Corelib that not only checks for null and for direct equality with the specified",
    "helper method in Corelib that not only checks for null and for direct equality with the specified",
    "additional validation may need to be performed to ensure the reference being written is",
    "additional validation may need to be performed to ensure the reference being written is",
    "Spans shift this covariance check to their constructor; rather than performing the covariance",
    "Spans shift this covariance check to their constructor; rather than performing the covariance",
    "213 CHAPTER 23 | Analyzers",
    "213 CHAPTER 23 | Analyzers",
    "It effectively would be impossible for an analyzer to be able to safely recommend sealing public types.",
    "It effectively would be impossible for an analyzer to be able to safely recommend sealing public types.",
    "In .NET 6, we sealed over 2300 types, but even with that, this analyzer ended up finding more to seal.",
    "In .NET 6, we sealed over 2300 types, but even with that, this analyzer ended up finding more to seal.",
    null,
    null,
    "ContainsKey",
    "ContainsKey",
    "Dictionary\u2019s ",
    "Dictionary\u2019s ",
    "A benefit of this, in addition to arguably being simpler, is that it\u2019s also faster. While ",
    "A benefit of this, in addition to arguably being simpler, is that it\u2019s also faster. While ",
    "TValue>",
    "TValue>",
    "214 CHAPTER 23 | Analyzers",
    "214 CHAPTER 23 | Analyzers",
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    "Somewhat ironically, even as I write this example, the analyzer and its auto-fixer are helpfully trying to",
    "Somewhat ironically, even as I write this example, the analyzer and its auto-fixer are helpfully trying to",
    "215 CHAPTER 23 | Analyzers",
    "215 CHAPTER 23 | Analyzers",
    "it\u2019s fairly natural for developers to only call ",
    "it\u2019s fairly natural for developers to only call ",
    "which the analyzer flagged and which it\u2019s auto-fixer replaced with just:",
    "which the analyzer flagged and which it\u2019s auto-fixer replaced with just:",
    "Nice and simple. And faster, since as with the TryGetValue case, this is now doing a single dictionary",
    "Nice and simple. And faster, since as with the TryGetValue case, this is now doing a single dictionary",
    "216 CHAPTER 23 | Analyzers",
    "216 CHAPTER 23 | Analyzers",
    ":::",
    ":::",
    null,
    null,
    "The method\u2019s purpose is to convert the enumerable into an array to be stored, but also to validate",
    "The method\u2019s purpose is to convert the enumerable into an array to be stored, but also to validate",
    "217 CHAPTER 23 | Analyzers",
    "217 CHAPTER 23 | Analyzers",
    "with this. First, it\u2019s incurring the expense of interating through the enumerable twice, once for the",
    "with this. First, it\u2019s incurring the expense of interating through the enumerable twice, once for the",
    "actually ensuring there aren\u2019t nulls in the resulting array, for example. Since the expectation of the",
    "actually ensuring there aren\u2019t nulls in the resulting array, for example. Since the expectation of the",
    "With that, we only ever iterate it once (and possibly 0 times if ",
    "With that, we only ever iterate it once (and possibly 0 times if ",
    null,
    null,
    null,
    null,
    "However, .NET 5 introduced new \u201cone-shot\u201d hashing methods, which obviates the need to create a",
    "However, .NET 5 introduced new \u201cone-shot\u201d hashing methods, which obviates the need to create a",
    "CA1850 finds occurrences of the former pattern and recommends changing them to the latter.",
    "CA1850 finds occurrences of the former pattern and recommends changing them to the latter.",
    "218 CHAPTER 23 | Analyzers",
    "218 CHAPTER 23 | Analyzers",
    "The result is not only simpler, it\u2019s also faster:",
    "The result is not only simpler, it\u2019s also faster:",
    "|Method|Mean|Ratio|Allocated|Alloc Ratio|",
    "|Method|Mean|Ratio|Allocated|Alloc Ratio|",
    "The .NET 7 SDK also includes new analyzers around ",
    "The .NET 7 SDK also includes new analyzers around ",
    "219 CHAPTER 23 | Analyzers",
    "219 CHAPTER 23 | Analyzers",
    null,
    null,
    "Let\u2019s start with IDE0200, which is about removing unnecessary lambdas. Consider a setup like this:",
    "Let\u2019s start with IDE0200, which is about removing unnecessary lambdas. Consider a setup like this:",
    "passes it off to some static functionality. For this code, the C# compiler is going to generate",
    "passes it off to some static functionality. For this code, the C# compiler is going to generate",
    "the lambda and store it into that field. For all subsequent invocations, however, it\u2019ll find the field is",
    "the lambda and store it into that field. For all subsequent invocations, however, it\u2019ll find the field is",
    "220 CHAPTER 23 | Analyzers",
    "220 CHAPTER 23 | Analyzers",
    "non-null and will just reuse the same delegate. Thus, this lambda only ever results in a single",
    "non-null and will just reuse the same delegate. Thus, this lambda only ever results in a single",
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    "So, the compiler is able to cache references to lambdas, great. What about method groups, i.e. where",
    "So, the compiler is able to cache references to lambdas, great. What about method groups, i.e. where",
    "the compiler would generate the equivalent of:",
    "the compiler would generate the equivalent of:",
    "221 CHAPTER 23 | Analyzers",
    "221 CHAPTER 23 | Analyzers",
    "which has the unfortunate effect of allocating a new delegate on every invocation, even though we\u2019re",
    "which has the unfortunate effect of allocating a new delegate on every invocation, even though we\u2019re",
    null,
    null,
    "Note we again have a caching field that\u2019s used to enable allocating the delegate once and caching it.",
    "Note we again have a caching field that\u2019s used to enable allocating the delegate once and caching it.",
    "And that brings us to IDE0200, which recognizes lambda expressions that can be removed.",
    "And that brings us to IDE0200, which recognizes lambda expressions that can be removed.",
    "That delegate closes over the ",
    "That delegate closes over the ",
    "222 CHAPTER 23 | Analyzers",
    "222 CHAPTER 23 | Analyzers",
    "We still get a delegate allocation, but we avoid the display class allocation, and as a bonus we save on",
    "We still get a delegate allocation, but we avoid the display class allocation, and as a bonus we save on",
    "IDE0020 is another good example of an analyzer that is primarily focused on making code cleaner,",
    "IDE0020 is another good example of an analyzer that is primarily focused on making code cleaner,",
    "to instead be like:",
    "to instead be like:",
    "In addition to being cleaner, this ends up saving a cast operation, which can add measurable",
    "In addition to being cleaner, this ends up saving a cast operation, which can add measurable",
    "|Method|Mean|Ratio|",
    "|Method|Mean|Ratio|",
    "Then there\u2019s IDE0031, which promotes using null propagation features of C#. This analyzer typically",
    "Then there\u2019s IDE0031, which promotes using null propagation features of C#. This analyzer typically",
    "into code that\u2019s instead like:",
    "into code that\u2019s instead like:",
    "223 CHAPTER 23 | Analyzers",
    "223 CHAPTER 23 | Analyzers",
    "Nice, concise, and primarily about cleaning up the code and making it simpler and more maintainable",
    "Nice, concise, and primarily about cleaning up the code and making it simpler and more maintainable",
    "The C# compiler lowers these expressions to the equivalent of this:",
    "The C# compiler lowers these expressions to the equivalent of this:",
    "for which the JIT then generates:",
    "for which the JIT then generates:",
    "224 CHAPTER 23 | Analyzers",
    "224 CHAPTER 23 | Analyzers",
    "the local means the JIT doesn\u2019t need to add an additional null check on the second use of the local,",
    "the local means the JIT doesn\u2019t need to add an additional null check on the second use of the local,",
    "Another interesting example is IDE0060, which finds unused parameters and recommends removing",
    "Another interesting example is IDE0060, which finds unused parameters and recommends removing",
    "bool[] GmtTime",
    "bool[] GmtTime",
    "TZif_ParseRaw",
    "TZif_ParseRaw",
    "One final example of peanut-buttery performance improvements from applying an analyzer comes",
    "One final example of peanut-buttery performance improvements from applying an analyzer comes",
    "and recommending it be converted to:",
    "and recommending it be converted to:",
    "As with some of the previous rules discussed, that in and of itself doesn\u2019t make a meaningful",
    "As with some of the previous rules discussed, that in and of itself doesn\u2019t make a meaningful",
    "which is rewritten to:",
    "which is rewritten to:",
    "This avoids an unnecessary re-access to an array. Or again from those PRs the expression:",
    "This avoids an unnecessary re-access to an array. Or again from those PRs the expression:",
    "225 CHAPTER 23 | Analyzers",
    "225 CHAPTER 23 | Analyzers",
    "being changed to:",
    "being changed to:",
    "and avoiding an unnecessary table lookup.",
    "and avoiding an unnecessary table lookup.",
    "226 CHAPTER 23 | Analyzers",
    "226 CHAPTER 23 | Analyzers",
    null,
    null,
    "Whew",
    "Whew",
    "The next step is on you. Download the latest .NET 7 bits and take them for a spin. Upgrade your apps.",
    "The next step is on you. Download the latest .NET 7 bits and take them for a spin. Upgrade your apps.",
    "Until next time\u2026",
    "Until next time\u2026",
    "Happy coding",
    "Happy coding",
    "227 CHAPTER 24 | What\u2019s Next?",
    "227 CHAPTER 24 | What\u2019s Next?"
]