|    | 0                                                                             |
|---:|:------------------------------------------------------------------------------|
|  0 | var builder = WebApplication.CreateBuilder(args);                             |
|  1 | var serverCert = ObtainServerCertificate();                                   |
|  2 | builder.WebHost.UseKestrel(kestrelServerOptions => {                          |
|  3 | kestrelServerOptions.ConfigureHttpsDefaults(opt =>                            |
|  4 | {                                                                             |
|  5 | opt.ClientCertificateMode = ClientCertificateMode.RequireCertificate;         |
|  6 |                                                                               |
|  7 | // Verify that client certificate was issued by same CA as server certificate |
|  8 | opt.ClientCertificateValidation = (certificate, chain, errors) =>             |
|  9 | certificate.Issuer == serverCert.Issuer;                                      |
| 10 | });                                                                           |
| 11 |                                                                               |
| 12 | });                                                                           |