,0
0,namespace Grpc.Core;
1,
2,public class GrpcStreamObservable<T> : IObservable<T>
3,{
4,private readonly IAsyncStreamReader<T> _reader;
5,private readonly CancellationToken _token;
6,private int _used;
7,
8,"public GrpcStreamObservable(IAsyncStreamReader<T> reader, CancellationToken token ="
9,default)
10,{
11,_reader = reader ?? throw new ArgumentNullException(nameof(reader));
12,_token = token;
13,_used = 0;
14,}
15,
16,public IDisposable Subscribe(IObserver<T> observer) =>
17,"Interlocked.Exchange(ref _used, 1) == 0"
18,"? new GrpcStreamSubscription<T>(_reader, observer, _token)"
19,": throw new InvalidOperationException(""Subscribe can only be called once."");"
20,
21,}
22,
23,
