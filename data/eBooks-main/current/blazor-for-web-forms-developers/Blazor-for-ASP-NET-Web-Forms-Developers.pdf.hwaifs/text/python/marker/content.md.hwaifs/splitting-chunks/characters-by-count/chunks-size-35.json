"[\"![](_page_0_Picture_0.jpeg)\\n\\n# Blazor for ASP.NET Web Forms Developers\\n\\n![](_page_0_Picture_2.jpeg)\\n\", \"\\nDaniel Roth\\nJeff Fritz\\nTaylor Southwick\\n\\n**EDITION v8.0** - Updated to .NET 8\\n\\nRefer to [changelog]\", \"(https://aka.ms/blazor-ebook-changelog) for the book updates and community contributions.\\n\\nPUBLISHED\", \" BY\\n\\nMicrosoft Developer Division, .NET, and Visual Studio product teams\\n\\nA division of Microsoft Co\", \"rporation\\n\\nOne Microsoft Way\\n\\nRedmond, Washington 98052-6399\\n\\nCopyright \\u00a9 2023 by Microsoft Corporat\", \"ion\\n\\nAll rights reserved. No part of the contents of this book may be reproduced or transmitted in a\", \"ny form or by any means without the written permission of the publisher.\\n\\nThis book is provided \\\"as-\", \"is\\\" and expresses the author's views and opinions. The views, opinions, and information expressed in\", \" this book, including URL and other Internet website references, may change without notice.\\n\\nSome ex\", \"amples depicted herein are provided for illustration only and are fictitious. No real association or\", \" connection is intended or should be inferred.\\n\\nMicrosoft and the trademarks listed at [https://www.\", \"microsoft.com](https://www.microsoft.com/) on the \\\"Trademarks\\\" webpage are trademarks of the Microso\", \"ft group of companies.\\n\\nMac and macOS are trademarks of Apple Inc.\\n\\nAll other marks and logos are pr\", \"operty of their respective owners.\\n\\nAuthors:\\n\\n**[Daniel Roth](https://github.com/danroth27)**, Princ\", \"ipal Program Manager, Microsoft Corp.\\n\\n**[Jeff Fritz](https://github.com/csharpfritz)**, Senior Prog\", \"ram Manager, Microsoft Corp.\\n\\n**[Taylor Southwick](https://github.com/twsouthwick)**, Senior Softwar\", \"e Engineer, Microsoft Corp.\\n\\n**[Scott Addie](https://github.com/scottaddie)**, Senior Content Develo\", \"per, Microsoft Corp.\\n\\n**[Steve \\\"@ardalis\\\" Smith](https://github.com/ardalis)**, Software Architect a\", \"nd Trainer, NimblePros.com\\n\\n#### Introduction\\n\\n.NET has long supported web app development through A\", \"SP.NET, a comprehensive set of frameworks and tools for building any kind of web app. ASP.NET has it\", \"s own lineage of web frameworks and technologies starting all the way back with classic Active Serve\", \"r Pages (ASP). Frameworks like ASP.NET Web Forms, ASP.NET MVC, ASP.NET Web Pages, and more recently \", \"ASP.NET Core, provide a productive and powerful way to build *server-rendered* web apps, where UI co\", \"ntent is dynamically generated on the server in response to HTTP requests. Each ASP.NET framework ca\", \"ters to a different audience and app building philosophy. ASP.NET Web Forms shipped with the origina\", \"l release of the .NET Framework and enabled web development using many of the patterns familiar to d\", \"esktop\\n\\ndevelopers, like reusable UI controls with simple event handling. However, none of the ASP.N\", \"ET offerings provide a way to run code that executed in the user's browser. To do that requires writ\", \"ing JavaScript and using any of the many JavaScript frameworks and tools that have phased in and out\", \" of popularity over the years: jQuery, Knockout, Angular, React, and so on.\\n\\n[Blazor](https://blazor\", \".net/) is a new web framework that changes what is possible when building web apps with .NET. Blazor\", \" is a client-side web UI framework based on C# instead of JavaScript. With Blazor you can write your\", \" client-side logic and UI components in C#, compile them into normal .NET assemblies, and then run t\", \"hem directly in the browser using a new open web standard called WebAssembly. Or alternatively, Blaz\", \"or can run your .NET UI components on the server and handle all UI interactions fluidly over a real-\", \"time connection with the browser. When paired with .NET running on the server, Blazor enables full-s\", \"tack web development with .NET. While Blazor shares many commonalities with ASP.NET Web Forms, like \", \"having a reusable component model and a simple way to handle user events, it also builds on the foun\", \"dations of .NET to provide a modern and high-performance web development experience.\\n\\nThis book intr\", \"oduces ASP.NET Web Forms developers to Blazor in a way that is familiar and convenient. It introduce\", \"s Blazor concepts in parallel with analogous concepts in ASP.NET Web Forms while also explaining new\", \" concepts that may be less familiar. It covers a broad range of topics and concerns including compon\", \"ent authoring, routing, layout, configuration, and security. And while the content of this book is p\", \"rimarily for enabling new development, it also covers guidelines and strategies for migrating existi\", \"ng ASP.NET Web Forms to Blazor for when you want to modernize an existing app.\\n\\n#### Who should use \", \"the book\\n\\nThis book is for ASP.NET Web Forms developers looking for an introduction to Blazor that r\", \"elates to their existing knowledge and skills. This book can help with quickly getting started on a \", \"new Blazorbased project or to help chart a roadmap for modernizing an existing ASP.NET Web Forms app\", \"lication.\\n\\n#### How to use the book\\n\\nThe first part of this book covers what Blazor is and compares \", \"it to web app development with ASP.NET Web Forms. The book then covers a variety of Blazor topics, c\", \"hapter by chapter, and relates each Blazor concept to the corresponding concept in ASP.NET Web Forms\", \", or explains fully any completely new concepts. The book also refers regularly to a complete sample\", \" app implemented in both ASP.NET Web Forms and Blazor to demonstrate Blazor features and to provide \", \"a case study for migrating from ASP.NET Web Forms to Blazor. You can find both implementations of th\", \"e sample app (ASP.NET Web Forms and Blazor versions) on [GitHub.](https://github.com/dotnet-architec\", \"ture/eshoponblazor)\\n\\n#### What this book doesn't cover\\n\\nThis book is an introduction to Blazor, not \", \"a comprehensive migration guide. While it does include guidance on how to approach migrating a proje\", \"ct from ASP.NET Web Forms to Blazor, it does not\\n\\nattempt to cover every nuance and detail. For more\", \" general guidance on migrating from ASP.NET to ASP.NET Core, refer to the [migration guidance](https\", \"://docs.microsoft.com/aspnet/core/migration/proper-to-2x/) in the ASP.NET Core documentation.\\n\\n#### \", \"**Additional resources**\\n\\nYou can find the official Blazor home page and documentation at [https://b\", \"lazor.net.](https://blazor.net/)\\n\\n# Contents\\n\\n| An introduction to Blazor for ASP.NET Web Forms deve\", \"lopers | 1  |\\n|------------------------------------------------------------|----|\\n| An open-source a\", \"nd cross-platform .NET                     | 2  |\\n| Client-side web development                     \", \"           | 3  |\\n| WebAssembly fulfills a need                                | 3  |\\n| Blazor: full\", \"-stack web development with .NET               | 4  |\\n| Get started with Blazor                     \", \"               | 4  |\\n| Architecture comparison of ASP.NET Web Forms and Blazor    | 5  |\\n| ASP.NET \", \"Web Forms                                          | 5  |\\n| Blazor                                  \", \"                   | 6  |\\n| Blazor app hosting models                                  | 8  |\\n| Blaz\", \"or WebAssembly apps                                    | 8  |\\n| Blazor Server apps                  \", \"                       | 9  |\\n| How to choose the right Blazor hosting model               | 10 |\\n| \", \"Deploy your app                                            | 11 |\\n| Project structure for Blazor app\", \"s                          | 12 |\\n| Project file                                               | 12 \", \"|\\n| Entry point                                                | 13 |\\n| Static files                \", \"                               | 15 |\\n| Configuration                                              |\", \" 15 |\\n| Razor components                                           | 15 |\\n| Pages                   \", \"                                   | 16 |\\n| Layout                                                  \", \"   | 16 |\\n| Bootstrap Blazor                                           | 16 |\\n| Build output        \", \"                                       | 18 |\\n| Run the app with Hot Reload                         \", \"       | 18 |\\n| App startup                                                | 21 |\\n| Application_Star\", \"t and Web Forms                            | 21 |\\n| Blazor Server Startup Structure                 \", \"           | 21 |\\n\\n| Upgrading the BundleConfig Process       | 23 |\\n|------------------------------\", \"------------|----|\\n| Build reusable UI components with Blazor | 24 |\\n| An introduction to Razor     \", \"            | 24 |\\n| Use components                           | 28 |\\n| Modify page title from compon\", \"ents        | 28 |\\n| Component parameters                     | 29 |\\n| Query string parameters      \", \"            | 29 |\\n| Components and error boundaries          | 30 |\\n| Event handlers               \", \"            | 30 |\\n| Data binding                             | 32 |\\n| State changes                \", \"            | 33 |\\n| Component lifecycle                      | 34 |\\n| OnInitialized                \", \"            | 34 |\\n| On Parameters Set                        | 35 |\\n| On After Render              \", \"            | 35 |\\n| IDisposable                              | 35 |\\n| Capture component references \", \"            | 36 |\\n| Capture element references               | 36 |\\n| Templated components         \", \"            | 36 |\\n| Child content                            | 37 |\\n| Template parameters          \", \"            | 37 |\\n| Code-behind                              | 38 |\\n| Additional resources         \", \"            | 39 |\\n| Pages, routing, and layouts              | 40 |\\n| Create pages                 \", \"            | 41 |\\n| Router component                         | 42 |\\n| Navigation                   \", \"            | 42 |\\n| Base URLs                                | 43 |\\n| Page layout                  \", \"            | 43 |\\n| State management                         | 46 |\\n| Request state management with\", \" ViewState  | 46 |\\n\\n| Maintain state with Session                                   | 47            \", \"    |\\n|---------------------------------------------------------------|-------------------|\\n| Applic\", \"ation state                                             | 47                |\\n| In the browser      \", \"                                          | 48                |\\n| Forms and validation              \", \"                            | 49                |\\n| Additional resources                            \", \"              | 51                |\\n| Work with data                                                \", \"| 52                |\\n| Entity Framework                                              | 52          \", \"      |\\n| EF Code First                                                 | 53                |\\n| EF D\", \"atabase First                                             | 54                |\\n| Interact with web \", \"services                                    | 54                |\\n| Modules, handlers, and middlewar\", \"e                             | 56                |\\n| Overview                                      \", \"                | 56                |\\n| Katana                                                      \", \"  | 57                |\\n| Common middleware                                             | 57        \", \"        |\\n| Custom middleware                                             | 58                |\\n| Ap\", \"p configuration                                             | 60                |\\n| Configuration so\", \"urces                                         | 60                |\\n| appsettings.json format and ac\", \"cess                            | 61                |\\n| User secrets                                \", \"                  | 61                |\\n| Environment variables                                     \", \"    | 61                |\\n| Command-line arguments                                        | 62      \", \"          |\\n| The return of web.config                                      | 62                |\\n| \", \"Read configuration in the app                                 | 63                |\\n| Strongly typed\", \" configuration                                  | 63                |\\n| Security: Authentication and\", \" Authorization in ASP.NET Web For | rms and Blazor 65 |\\n| ASP.NET universal providers               \", \"                    | 65                |\\n| Authorization configuration in Web Forms                \", \"      | 66                |\\n| Authorization code in Web Forms                               | 67    \", \"            |\\n| ASP.NET Core Identity                                         | 68                |\\n\", \"| Roles, claims, and policies                                   | 68                |\\n| Migration gu\", \"ide                                               | 70                |\\n\\n| Creating the ASP.NET Core\", \" Identity schema                           | 70 |\\n|-------------------------------------------------\", \"--------------------|----|\\n| Migrating data from universal providers to ASP.NET Core Identity    | 7\", \"3 |\\n| Migrating security settings from web.config to app startup          | 74 |\\n| Updating individu\", \"al pages to use ASP.NET Core Identity abstractions | 75 |\\n| Summary                                 \", \"                            | 76 |\\n| References                                                     \", \"     | 77 |\\n| Migrate from ASP.NET Web Forms to Blazor                            | 78 |\\n| Server-si\", \"de versus client-side hosting                              | 78 |\\n| Create a new project            \", \"                                    | 79 |\\n| Enable startup process                                 \", \"             | 80 |\\n| Migrate HTTP modules and handlers to middleware                     | 83 |\\n| M\", \"igrate static files                                                | 84 |\\n| Migrate runtime bundling\", \" and minification setup                     | 84 |\\n| Migrate ASPX pages                             \", \"                     | 84 |\\n| Model validation in Blazor                                          | \", \"88 |\\n| Migrate configuration                                               | 89 |\\n| Migrate data acc\", \"ess                                                 | 91 |\\n| Architectural changes                  \", \"                             | 91 |\\n| Migration conclusion                                          \", \"      | 92 |\\n\\n**CHAPTER** 1\\n\\n# <span id=\\\"page-8-0\\\"></span>An introduction to Blazor for ASP.NET Web \", \"Forms developers\\n\\nThe ASP.NET Web Forms framework has been a staple of .NET web development since th\", \"e .NET Framework first shipped in 2002. Back when the Web was still largely in its infancy, ASP.NET \", \"Web Forms made building web apps simple and productive by adopting many of the patterns that were us\", \"ed for desktop development. In ASP.NET Web Forms, web pages can be quickly composed from reusable UI\", \" controls. User interactions are handled naturally as events. There's a rich ecosystem of Web Forms \", \"UI controls provided by Microsoft and control vendors. The controls ease the efforts of connecting t\", \"o data sources and displaying rich data visualizations. For the visually inclined, the Web Forms des\", \"igner provides a simple drag-and-drop interface for managing controls.\\n\\nOver the years, Microsoft ha\", \"s introduced new ASP.NET-based web frameworks to address web development trends. Some such web frame\", \"works include ASP.NET MVC, ASP.NET Web Pages, and more recently ASP.NET Core. With each new framewor\", \"k, some have predicted the imminent decline of ASP.NET Web Forms and criticized it as an outdated, o\", \"utmoded web framework. Despite these predictions, many .NET web developers continue to find ASP.NET \", \"Web Forms a simple, stable, and productive way to get their work done.\\n\\nAt the time of writing, almo\", \"st half a million web developers use ASP.NET Web Forms every month. The ASP.NET Web Forms framework \", \"is stable to the point that docs, samples, books, and blog posts from a decade ago remain useful and\", \" relevant. For many .NET web developers, \\\"ASP.NET\\\" is still synonymous with \\\"ASP.NET Web Forms\\\" as i\", \"t was when .NET was first conceived. Arguments on the pros and cons of ASP.NET Web Forms compared to\", \" the other new .NET web frameworks may rage on. ASP.NET Web Forms remains a popular framework for cr\", \"eating web apps.\\n\\nEven so, innovations in software development aren't slowing. All software develope\", \"rs need to stay abreast of new technologies and trends. Two trends in particular are worth consideri\", \"ng:\\n\\n- 1. The shift to open-source and cross-platform\\n- 2. The shift of app logic to the client\\n\\n###\", \"# <span id=\\\"page-9-0\\\"></span>An open-source and cross-platform .NET\\n\\nWhen .NET and ASP.NET Web Forms\", \" first shipped, the platform ecosystem looked much different than it does today. The desktop and ser\", \"ver markets were dominated by Windows. Alternative platforms like macOS and Linux were still struggl\", \"ing to gain traction. ASP.NET Web Forms ships with the .NET Framework as a Windows-only component, w\", \"hich means ASP.NET Web Forms apps can only run on Windows Server machines. Many modern environments \", \"now use different kinds of platforms for servers and development machines such that cross-platform s\", \"upport for many users is an absolute requirement.\\n\\nMost modern web frameworks are now also open-sour\", \"ce, which has a number of benefits. Users aren't beheld to a single project owner to fix bugs and ad\", \"d features. Open-source projects provide improved transparency on development progress and upcoming \", \"changes. Open-source projects enjoy contributions from an entire community, and they foster a suppor\", \"tive open-source ecosystem. Despite the risks of open-source, many consumers and contributors have f\", \"ound suitable mitigations that enable them to enjoy the benefits of an open-source ecosystem in a sa\", \"fe and reasonable way. Examples of such mitigations include contributor license agreements, friendly\", \" licenses, pedigree scans, and supporting foundations.\\n\\nThe .NET community has embraced both cross-p\", \"latform support and open-source. .NET Core is an open-source and cross-platform implementation of .N\", \"ET that runs on a plethora of platforms, including Windows, macOS, and various Linux distributions. \", \"Xamarin provides Mono, an open-source version of .NET. Mono runs on Android, iOS, and a variety of o\", \"ther form factors, including watches and smart TVs. In 2020, Microsoft released [.NET 5](https://dev\", \"blogs.microsoft.com/dotnet/announcing-net-5-0/) that reconciled .NET Core and Mono into \\\"a single .N\", \"ET runtime and framework that can be used everywhere and that has uniform runtime behaviors and deve\", \"loper experiences.\\\"\\n\\nWill ASP.NET Web Forms benefit from the move to open-source and cross-platform \", \"support? The answer, unfortunately, is no, or at least not to the same extent as the rest of the pla\", \"tform. The .NET team [made it clear](https://devblogs.microsoft.com/dotnet/net-core-is-the-future-of\", \"-net/) that ASP.NET Web Forms won't be ported to .NET Core or .NET 8. Why is that?\\n\\nThere were effor\", \"ts in the early days of .NET Core to port ASP.NET Web Forms. The number of breaking changes required\", \" were found to be too drastic. There's also an admission here that even for Microsoft, there's a lim\", \"it to the number of web frameworks that it can support simultaneously. Perhaps someone in the commun\", \"ity will take up the cause of creating an open-source and cross-platform version of ASP.NET Web Form\", \"s. The [source code for ASP.NET Web Forms](https://github.com/microsoft/referencesource) has been ma\", \"de available publicly in reference form. But for the time being, it seems ASP.NET Web Forms will rem\", \"ain Windows-only and without an open-source contribution model. If cross-platform support or open-so\", \"urce become important for your scenarios, then you'll need to look for something new.\\n\\nDoes this mea\", \"n ASP.NET Web Forms is *dead* and should no longer be used? Of course not! As long as the .NET Frame\", \"work ships as part of Windows, ASP.NET Web Forms will be a supported framework. For many Web Forms d\", \"evelopers, the lack of cross-platform and open-source support is a non-issue. If you don't have a re\", \"quirement for cross-platform support, open-source, or any of the other new features in .NET Core or \", \".NET 8, then sticking with ASP.NET Web Forms on Windows is fine. ASP.NET Web Forms will continue to \", \"be a productive way to write web apps for many years to come.\\n\\nBut there's another trend worth consi\", \"dering, and that's the shift to the client.\\n\\n#### <span id=\\\"page-10-0\\\"></span>Client-side web develo\", \"pment\\n\\nAll of the .NET-based web frameworks, including ASP.NET Web Forms, have historically had one \", \"thing in common: they're *server-rendered*. In server-rendered web apps, the browser makes a request\", \" to the server, which executes some code (.NET code in ASP.NET apps) to produce a response. That res\", \"ponse is sent back to the browser to handle. In this model, the browser is used as a thin rendering \", \"engine. The hard work of producing the UI, running the business logic, and managing state occurs on \", \"the server.\\n\\nHowever, browsers have become versatile platforms. They implement an ever-increasing nu\", \"mber of open web standards that grant access to the capabilities of the user's machine. Why not take\", \" advantage of the compute power, storage, memory, and other resources of the client device? UI inter\", \"actions in particular can benefit from a richer and more interactive feel when handled at least part\", \"ially or completely client-side. Logic and data that should be handled on the server can still be ha\", \"ndled server-side. Web API calls or even real-time protocols, like WebSockets, can be used. These be\", \"nefits are available to web developers for free if they're willing to write JavaScript. Client-side \", \"UI frameworks, such as Angular, React, and Vue, simplify client-side web development and have grown \", \"in popularity. ASP.NET Web Forms developers can also benefit from leveraging the client, and even ha\", \"ve some out-of-the-box support with integrated JavaScript frameworks like ASP.NET AJAX.\\n\\nBut bridgin\", \"g two different platforms and ecosystems (.NET and JavaScript) comes with a cost. Expertise is requi\", \"red in two parallel worlds with different languages, frameworks, and tools. Code and logic can't be \", \"easily shared between client and server, resulting in duplication and engineering overhead. It can a\", \"lso be difficult to keep up with the JavaScript ecosystem, which has a history of evolving at breakn\", \"eck speed. Front-end framework and build tool preferences change quickly. The industry has observed \", \"the progression from Grunt to Gulp to Webpack, and so on. The same restless churn has occurred with \", \"front-end frameworks such as jQuery, Knockout, Angular, React, and Vue. But given JavaScript's brows\", \"er monopoly, there was little choice in the matter. That is, until the web community got together an\", \"d caused a *miracle* to happen!\\n\\n#### <span id=\\\"page-10-1\\\"></span>WebAssembly fulfills a need\\n\\nIn 20\", \"15, the major browser vendors joined forces in a W3C Community Group to create a new open web standa\", \"rd called WebAssembly. WebAssembly is a byte code for the Web. If you can compile your code to WebAs\", \"sembly, it can then run on any browser on any platform at near native speed. Initial efforts focused\", \" on C/C++. The result was a dramatic demonstration of running native 3D graphics engines directly in\", \" the browser without plugins. WebAssembly has since been standardized and implemented by all major b\", \"rowsers.\\n\\nWork on running .NET on WebAssembly was announced in late 2017 and released in 2020, inclu\", \"ding support in .NET 5 and beyond. The ability to run .NET code directly in the browser enables full\", \"-stack web development with .NET.\\n\\n#### <span id=\\\"page-11-0\\\"></span>Blazor: full-stack web developme\", \"nt with .NET\\n\\nOn its own, the ability to run .NET code in a browser doesn't provide an end-to-end ex\", \"perience for creating client-side web apps. That's where Blazor comes in. Blazor is a client-side we\", \"b UI framework based on C# instead of JavaScript. Blazor can run directly in the browser via WebAsse\", \"mbly. No browser plugins are required. Alternatively, Blazor apps can run server-side on .NET and ha\", \"ndle all user interactions over a real-time connection with the browser.\\n\\nBlazor has great tooling s\", \"upport in Visual Studio and Visual Studio Code. The framework also includes a full UI component mode\", \"l and has built-in facilities for:\\n\\n- Forms and validation\\n- Dependency injection\\n- Client-side rout\", \"ing\\n- Layouts\\n- In-browser debugging\\n- JavaScript interop\\n\\nBlazor has a lot in common with ASP.NET W\", \"eb Forms. Both frameworks offer component-based, event-driven, stateful UI programming models. The m\", \"ain architectural difference is that ASP.NET Web Forms runs only on the server. Blazor can run on th\", \"e client in the browser. But if you're coming from an ASP.NET Web Forms background, there's a lot in\", \" Blazor that will feel familiar. Blazor is a natural solution for ASP.NET Web Forms developers looki\", \"ng for a way to take advantage of client-side development and the open-source, cross-platform future\", \" of .NET.\\n\\nThis book provides an introduction to Blazor that is catered specifically to ASP.NET Web \", \"Forms developers. Each Blazor concept is presented in the context of analogous ASP.NET Web Forms fea\", \"tures and practices. By the end of this book, you'll have an understanding of:\\n\\n- How to build Blazo\", \"r apps.\\n- How Blazor works.\\n- How Blazor relates to .NET.\\n- Reasonable strategies for migrating exis\", \"ting ASP.NET Web Forms apps to Blazor where appropriate.\\n\\n#### <span id=\\\"page-11-1\\\"></span>Get start\", \"ed with Blazor\\n\\nGetting started with Blazor is easy. Go to [https://blazor.net](https://blazor.net/)\", \" and follow the links to install the appropriate .NET SDK and Blazor project templates. You'll also \", \"find instructions for setting up the Blazor tooling in Visual Studio or Visual Studio Code.\\n\\n# <span\", \" id=\\\"page-12-0\\\"></span>Architecture comparison of ASP.NET Web Forms and Blazor\\n\\nWhile ASP.NET Web Fo\", \"rms and Blazor have many similar concepts, there are differences in how they work. This chapter exam\", \"ines the inner workings and architectures of ASP.NET Web Forms and Blazor.\\n\\n#### <span id=\\\"page-12-1\", \"\\\"></span>ASP.NET Web Forms\\n\\nThe ASP.NET Web Forms framework is based on a page-centric architecture.\", \" Each HTTP request for a location in the app is a separate page with which ASP.NET responds. As page\", \"s are requested, the contents of the browser are replaced with the results of the page requested.\\n\\nP\", \"ages consist of the following components:\\n\\n- HTML markup\\n- C# or Visual Basic code\\n- A code-behind c\", \"lass containing logic and event-handling capabilities\\n- Controls\\n\\nControls are reusable units of web\", \" UI that can be programmatically placed and interacted with on a page. Pages are composed of files t\", \"hat end with *.aspx* containing markup, controls, and some code. The code-behind classes are in file\", \"s with the same base name and an *.aspx.cs* or *.aspx.vb* extension, depending on the programming la\", \"nguage used. Interestingly, the web server interprets contents of the *.aspx* files and compiles the\", \"m whenever they change. This recompilation occurs even if the web server is already running.\\n\\nContro\", \"ls can be built with markup and delivered as user controls. A user control derives from the UserCont\", \"rol class and has a similar structure to the Page. Markup for user controls is stored in an *.ascx* \", \"file. An accompanying code-behind class resides in an *.ascx.cs* or *.ascx.vb* file. Controls can al\", \"so be built completely with code, by inheriting from either the WebControl or CompositeControl base \", \"class.\\n\\nPages also have an extensive event lifecycle. Each page raises events for the initialization\", \", load, prerender, and unload events that occur as the ASP.NET runtime executes the page's code for \", \"each request.\\n\\nControls on a Page typically post-back to the same page that presented the control, a\", \"nd carry along with them a payload from a hidden form field called ViewState. The ViewState field co\", \"ntains information about the state of the controls at the time they were rendered and presented on t\", \"he page, allowing the ASP.NET runtime to compare and identify changes in the content submitted to th\", \"e server.\\n\\n#### <span id=\\\"page-13-0\\\"></span>Blazor\\n\\nBlazor is a client-side web UI framework similar\", \" in nature to JavaScript front-end frameworks like Angular or React. Blazor handles user interaction\", \"s and renders the necessary UI updates. Blazor *isn't* based on a request-reply model. User interact\", \"ions are handled as events that aren't in the context of any particular HTTP request.\\n\\nBlazor apps c\", \"onsist of one or more root components that are rendered on an HTML page.\\n\\n![](_page_13_Figure_4.jpeg\", \")\\n\\nHow the user specifies where components should render and how the components are then wired up fo\", \"r user interactions is [hosting model](#page-15-0) specific.\\n\\nBlazor [components](#page-31-0) are .N\", \"ET classes that represent a reusable piece of UI. Each component maintains its own state and specifi\", \"es its own rendering logic, which can include rendering other components. Components specify event h\", \"andlers for specific user interactions to update the component's state.\\n\\nAfter a component handles a\", \"n event, Blazor renders the component and keeps track of what changed in the rendered output. Compon\", \"ents don't render directly to the Document Object Model (DOM). They instead render to an in-memory r\", \"epresentation of the DOM called a RenderTree so that Blazor can track the changes. Blazor compares t\", \"he newly rendered output with the previous output to calculate a UI diff that it then applies effici\", \"ently to the DOM.\\n\\n![](_page_14_Picture_0.jpeg)\\n\\nComponents can also manually indicate that they sho\", \"uld be rendered if their state changes outside of a normal UI event. Blazor uses a SynchronizationCo\", \"ntext to enforce a single logical thread of execution. A component's lifecycle methods and any event\", \" callbacks that are raised by Blazor are executed on this SynchronizationContext.\\n\\n**CHAPTER** 3\\n\\n# \", \"<span id=\\\"page-15-0\\\"></span>Blazor app hosting models\\n\\nBlazor apps can be hosted in one of the follo\", \"wing ways:\\n\\n- Client-side in the browser on WebAssembly.\\n- <span id=\\\"page-15-1\\\"></span>\\u2022 Server-side\", \" in an ASP.NET Core app.\\n\\n# Blazor WebAssembly apps\\n\\nBlazor WebAssembly apps execute directly in the\", \" browser on a WebAssembly-based .NET runtime. Blazor WebAssembly apps function in a similar way to f\", \"ront-end JavaScript frameworks like Angular or React. However, instead of writing JavaScript you wri\", \"te C#. The .NET runtime is downloaded with the app along with the app assembly and any required depe\", \"ndencies. No browser plugins or extensions are required.\\n\\nThe downloaded assemblies are normal .NET \", \"assemblies, like you would use in any other .NET app. Because the runtime supports .NET Standard, yo\", \"u can use existing .NET Standard libraries with your Blazor WebAssembly app. However, these assembli\", \"es will still execute in the browser security sandbox. Some functionality may throw a [PlatformNotSu\", \"pportedException,](https://docs.microsoft.com/dotnet/api/system.platformnotsupportedexception) like \", \"trying to access the file system or opening arbitrary network connections.\\n\\nWhen the app loads, the \", \".NET runtime is started and pointed at the app assembly. The app startup logic runs, and the root co\", \"mponents are rendered. Blazor calculates the UI updates based on the rendered output from the compon\", \"ents. The DOM updates are then applied.\\n\\n![](_page_16_Picture_0.jpeg)\\n\\nBlazor WebAssembly apps run p\", \"urely client-side. Such apps can be deployed to static site hosting solutions like GitHub Pages or A\", \"zure Static Website Hosting. .NET isn't required on the server at all. Deep linking to parts of the \", \"app typically requires a routing solution on the server. The routing solution redirects requests to \", \"the root of the app. For example, this redirection can be handled using URL rewrite rules in IIS.\\n\\nT\", \"o get all the benefits of Blazor and full-stack .NET web development, host your Blazor WebAssembly a\", \"pp with ASP.NET Core. By using .NET on both the client and server, you can easily share code and bui\", \"ld your app using one consistent set of languages, frameworks, and tools. Blazor provides convenient\", \" templates for setting up a solution that contains both a Blazor WebAssembly app and an ASP.NET Core\", \" host project. When the solution is built, the built static files from the Blazor app are hosted by \", \"the ASP.NET Core app with fallback routing already setup.\\n\\n### <span id=\\\"page-16-0\\\"></span>Blazor Se\", \"rver apps\\n\\nRecall from the [Blazor architecture](#page-13-0) discussion that Blazor components rende\", \"r their output to an intermediate abstraction called a RenderTree. The Blazor framework then compare\", \"s what was rendered with what was previously rendered. The differences are applied to the DOM. Blazo\", \"r components are decoupled from how their rendered output is applied. Consequently, the components t\", \"hemselves don't have to run in the same process as the process updating the UI. In fact, they don't \", \"even have to run on the same machine.\\n\\nIn Blazor Server apps, the components run on the server inste\", \"ad of client-side in the browser. UI events that occur in the browser are sent to the server over a \", \"real-time connection. The events are dispatched to the correct component instances. The components r\", \"ender, and the calculated UI diff is serialized and sent to the browser where it's applied to the DO\", \"M.\\n\\n![](_page_17_Picture_0.jpeg)\\n\\nThe Blazor Server hosting model may sound familiar if you've used \", \"ASP.NET AJAX and the [UpdatePanel](https://docs.microsoft.com/dotnet/api/system.web.ui.updatepanel) \", \"control. The UpdatePanel control handles applying partial page updates in response to trigger events\", \" on the page. When triggered, the UpdatePanel requests a partial update and then applies it without \", \"needing to refresh the page. The state of the UI is managed using ViewState. Blazor Server apps are \", \"slightly different in that the app requires an active connection with the client. Additionally, all \", \"UI state is maintained on the server. Aside from those differences, the two models are conceptually \", \"similar.\\n\\n### <span id=\\\"page-17-0\\\"></span>How to choose the right Blazor hosting model\\n\\nAs described\", \" in the [Blazor hosting model docs,](https://docs.microsoft.com/aspnet/core/blazor/hosting-models) t\", \"he different Blazor hosting models have different tradeoffs.\\n\\nThe Blazor WebAssembly hosting model h\", \"as the following benefits:\\n\\n- There's no .NET server-side dependency. The app is fully functioning a\", \"fter downloaded to the client.\\n- Client resources and capabilities are fully leveraged.\\n- Work is of\", \"floaded from the server to the client.\\n- An ASP.NET Core web server isn't required to host the app. \", \"Serverless deployment scenarios are possible (for example, serving the app from a CDN).\\n\\nThe downsid\", \"es of the Blazor WebAssembly hosting model are:\\n\\n- Browser capabilities restrict the app.\\n- Capable \", \"client hardware and software (for example, WebAssembly support) is required.\\n- Download size is larg\", \"er, and apps take longer to load.\\n\\n\\u2022 .NET runtime and tooling support is less mature. For example, t\", \"here are limitations in [.NET](https://docs.microsoft.com/en-us/dotnet/standard/net-standard)  [Stan\", \"dard](https://docs.microsoft.com/en-us/dotnet/standard/net-standard) support and debugging.\\n\\nConvers\", \"ely, the Blazor Server hosting model offers the following benefits:\\n\\n- Download size is much smaller\", \" than a client-side app, and the app loads much faster.\\n- The app takes full advantage of server cap\", \"abilities, including use of any .NET compatible APIs.\\n- .NET on the server is used to run the app, s\", \"o existing .NET tooling, such as debugging, works as expected.\\n- Thin clients are supported. For exa\", \"mple, server-side apps work with browsers that don't support WebAssembly and on resource-constrained\", \" devices.\\n- The app's .NET/C# code base, including the app's component code, isn't served to clients\", \".\\n\\nThe downsides to the Blazor Server hosting model are:\\n\\n- Higher UI latency. Every user interactio\", \"n involves a network hop.\\n- There's no offline support. If the client connection fails, the app stop\", \"s working.\\n- Scalability is challenging for apps with many users. The server must manage multiple cl\", \"ient connections and handle client state.\\n- An ASP.NET Core server is required to serve the app. Ser\", \"verless deployment scenarios aren't possible. For example, you can't serve the app from a CDN.\\n\\nThe \", \"preceding list of trade-offs may be intimidating, but your hosting model can be changed later. Regar\", \"dless of the Blazor hosting model selected, the component model is *the same*. In principle, the sam\", \"e components can be used with either hosting model. Your app code doesn't change; however, it's a go\", \"od practice to introduce abstractions so that your components stay hosting model-agnostic. The abstr\", \"actions allow your app to more easily adopt a different hosting model.\\n\\n# <span id=\\\"page-18-0\\\"></spa\", \"n>Deploy your app\\n\\nASP.NET Web Forms apps are typically hosted on IIS on a Windows Server machine or\", \" cluster. Blazor apps can also:\\n\\n- Be hosted on IIS, either as static files or as an ASP.NET Core ap\", \"p.\\n- Leverage ASP.NET Core's flexibility to be hosted on various platforms and server infrastructure\", \"s. For example, you can host a Blazor App using [Nginx](https://docs.microsoft.com/aspnet/core/host-\", \"and-deploy/linux-nginx) or [Apache](https://docs.microsoft.com/aspnet/core/host-and-deploy/linux-apa\", \"che) on Linux. For more information about how to publish and deploy Blazor apps, see the Blazor [Hos\", \"ting and](https://docs.microsoft.com/aspnet/core/host-and-deploy/blazor/)  [deployment](https://docs\", \".microsoft.com/aspnet/core/host-and-deploy/blazor/) documentation.\\n\\nIn the next section, we'll look \", \"at how the projects for Blazor WebAssembly and Blazor Server apps are set up.\\n\\n# <span id=\\\"page-19-0\", \"\\\"></span>Project structure for Blazor apps\\n\\nDespite their significant project structure differences,\", \" ASP.NET Web Forms and Blazor share many similar concepts. Here, we'll look at the structure of a Bl\", \"azor project and compare it to an ASP.NET Web Forms project.\\n\\nTo create your first Blazor app, follo\", \"w the instructions in the [Blazor getting started steps.](https://docs.microsoft.com/aspnet/core/bla\", \"zor/get-started) You can follow the instructions to create either a Blazor Server app or a Blazor We\", \"bAssembly app hosted in ASP.NET Core. Except for the hosting model-specific logic, most of the code \", \"in both projects is the same.\\n\\n#### <span id=\\\"page-19-1\\\"></span>Project file\\n\\nBlazor Server apps are\", \" .NET projects. The project file for the Blazor Server app is about as simple as it can get:\\n\\n```\\n<P\", \"roject Sdk=\\\"Microsoft.NET.Sdk.Web\\\">\\n <PropertyGroup>\\n <TargetFramework>net8.0</TargetFramework>\\n </P\", \"ropertyGroup>\\n</Project>\\nThe project file for a Blazor WebAssembly app looks slightly more involved \", \"(exact version \\nnumbers may vary):\\n<Project Sdk=\\\"Microsoft.NET.Sdk.BlazorWebAssembly\\\">\\n <PropertyGro\", \"up>\\n <TargetFramework>net8.0</TargetFramework>\\n <ImplicitUsings>enable</ImplicitUsings>\\n </PropertyG\", \"roup>\\n <ItemGroup>\\n <PackageReference Include=\\\"Microsoft.AspNetCore.Components.WebAssembly\\\" Version=\", \"\\\"8.0.0\\\"\\n/>\\n <PackageReference Include=\\\"Microsoft.AspNetCore.Components.WebAssembly.DevServer\\\"\\nVersio\", \"n=\\\"8.0.0\\\" PrivateAssets=\\\"all\\\" />\\n </ItemGroup>\\n</Project>\\n```\\n\\nBlazor WebAssembly project targets Mi\", \"crosoft.NET.Sdk.BlazorWebAssembly instead of Microsoft.NET.Sdk.Web sdk because they run in the brows\", \"er on a WebAssembly-based .NET runtime. You can't install .NET into a web browser like you can on a \", \"server or developer machine. Consequently, the project references the Blazor framework using individ\", \"ual package references.\\n\\nBy comparison, a default ASP.NET Web Forms project includes almost 300 line\", \"s of XML in its *.csproj* file, most of which is explicitly listing the various code and content fil\", \"es in the project. Since the release of .NET 5, both Blazor Server and Blazor WebAssembly apps can e\", \"asily share one unified runtime.\\n\\nAlthough they're supported, individual assembly references are les\", \"s common in .NET projects. Most project dependencies are handled as NuGet package references. You on\", \"ly need to reference top-level package dependencies in .NET projects. Transitive dependencies are in\", \"cluded automatically. Instead of using the *packages.config* file commonly found in ASP.NET Web Form\", \"s projects to reference packages, package references are added to the project file using the <Packag\", \"eReference> element.\\n\\n```\\n<ItemGroup>\\n <PackageReference Include=\\\"Newtonsoft.Json\\\" Version=\\\"13.0.2\\\" \", \"/>\\n</ItemGroup>\\n```\\n\\n# <span id=\\\"page-20-0\\\"></span>Entry point\\n\\nThe Blazor Server app's entry point \", \"is defined in the *Program.cs* file, as you would see in a Console app. When the app executes, it cr\", \"eates and runs a web host instance using defaults specific to web apps. The web host manages the Bla\", \"zor Server app's lifecycle and sets up host-level services. Examples of such services are configurat\", \"ion, logging, dependency injection, and the HTTP server. This code is mostly boilerplate and is ofte\", \"n left unchanged.\\n\\n```\\nusing BlazorApp3.Areas.Identity;\\nusing BlazorApp3.Data;\\nusing Microsoft.AspNe\", \"tCore.Components.Authorization;\\nusing Microsoft.AspNetCore.Identity;\\nusing Microsoft.EntityFramework\", \"Core;\\nvar builder = WebApplication.CreateBuilder(args);\\n// Add services to the container.\\nvar connec\", \"tionString = builder.Configuration.GetConnectionString(\\\"DefaultConnection\\\");\\nbuilder.Services.AddDbC\", \"ontext<ApplicationDbContext>(options =>\\n options.UseSqlServer(connectionString));\\nbuilder.Services.A\", \"ddDatabaseDeveloperPageExceptionFilter();\\nbuilder.Services.AddDefaultIdentity<IdentityUser>(options \", \"=>\\noptions.SignIn.RequireConfirmedAccount = true)\\n .AddEntityFrameworkStores<ApplicationDbContext>()\", \";\\nbuilder.Services.AddRazorPages();\\nbuilder.Services.AddServerSideBlazor();\\nbuilder.Services.AddScop\", \"ed<AuthenticationStateProvider,\\nRevalidatingIdentityAuthenticationStateProvider<IdentityUser>>();\\nbu\", \"ilder.Services.AddSingleton<WeatherForecastService>();\\nvar app = builder.Build();\\n// Configure the H\", \"TTP request pipeline.\\n```\\n\\n```\\nif (app.Environment.IsDevelopment())\\n{\\n app.UseMigrationsEndPoint();\\n\", \"}\\nelse\\n{\\n app.UseExceptionHandler(\\\"/Error\\\");\\n // The default HSTS value is 30 days. You may want to \", \"change this for production \\nscenarios, see https://aka.ms/aspnetcore-hsts.\\n app.UseHsts();\\n}\\napp.Use\", \"HttpsRedirection();\\napp.UseStaticFiles();\\napp.UseRouting();\\napp.UseAuthorization();\\napp.MapControlle\", \"rs();\\napp.MapBlazorHub();\\napp.MapFallbackToPage(\\\"/_Host\\\");\\napp.Run();\\n```\\n\\nBlazor WebAssembly apps a\", \"lso define an entry point in *Program.cs*. The code looks slightly different. The code is similar in\", \" that it's setting up the app host to provide the same host-level services to the app. The WebAssemb\", \"ly app host doesn't, however, set up an HTTP server because it executes directly in the browser.\\n\\nBl\", \"azor apps don't use a *Global.asax* file to define the startup logic for the app. Instead, this logi\", \"c is contained in *Program.cs* or in a related Startup class that is referenced from *Program.cs*. E\", \"ither way, this code is used to configure the app and any app-specific services.\\n\\nIn a Blazor Server\", \" app, the *Program.cs* file shown is used to set up the endpoint for the real-time connection used b\", \"y Blazor between the client browsers and the server.\\n\\nIn a Blazor WebAssembly app, the *Program.cs* \", \"file defines the root components for the app and where they should be rendered:\\n\\n```\\nusing BlazorApp\", \"1;\\nusing Microsoft.AspNetCore.Components.Web;\\nusing Microsoft.AspNetCore.Components.WebAssembly.Host\", \"ing;\\nvar builder = WebAssemblyHostBuilder.CreateDefault(args);\\nbuilder.RootComponents.Add<App>(\\\"#app\", \"\\\");\\nbuilder.RootComponents.Add<HeadOutlet>(\\\"head::after\\\");\\nbuilder.Services.AddScoped(sp => new Http\", \"Client { BaseAddress = new\\nUri(builder.HostEnvironment.BaseAddress) });\\nawait builder.Build().RunAsy\", \"nc();\\n```\\n\\n#### <span id=\\\"page-22-0\\\"></span>Static files\\n\\nUnlike ASP.NET Web Forms projects, not all\", \" files in a Blazor project can be requested as static files. Only the files in the *wwwroot* folder \", \"are web-addressable. This folder is referred to as the app's \\\"web root\\\". Anything outside of the app\", \"'s web root *isn't* web-addressable. This setup provides an additional level of security that preven\", \"ts accidental exposure of project files over the web.\\n\\n#### <span id=\\\"page-22-1\\\"></span>Configuratio\", \"n\\n\\nConfiguration in ASP.NET Web Forms apps is typically handled using one or more *web.config* files\", \". Blazor apps don't typically have *web.config* files. If they do, the file is only used to configur\", \"e IISspecific settings when hosted on IIS. Instead, Blazor Server apps use the ASP.NET Core configur\", \"ation abstractions. (Blazor WebAssembly apps don't currently support the same configuration abstract\", \"ions, but that may be a feature added in the future.) For example, the default Blazor Server app sto\", \"res some settings in *appsettings.json*.\\n\\n```\\n{\\n \\\"Logging\\\": {\\n \\\"LogLevel\\\": {\\n \\\"Default\\\": \\\"Informatio\", \"n\\\",\\n \\\"Microsoft\\\": \\\"Warning\\\",\\n \\\"Microsoft.Hosting.Lifetime\\\": \\\"Information\\\"\\n }\\n },\\n \\\"AllowedHosts\\\": \\\"*\", \"\\\"\\n}\\n```\\n\\nYou'll learn more about configuration in ASP.NET Core projects in the [Configuration](#page\", \"-67-0) section.\\n\\n#### <span id=\\\"page-22-2\\\"></span>Razor components\\n\\nMost files in Blazor projects ar\", \"e *.razor* files. Razor is a templating language based on HTML and C# that is used to dynamically ge\", \"nerate web UI. The *.razor* files define components that make up the UI of the app. For the most par\", \"t, the components are identical for both the Blazor Server and Blazor WebAssembly apps. Components i\", \"n Blazor are analogous to user controls in ASP.NET Web Forms.\\n\\nEach Razor component file is compiled\", \" into a .NET class when the project is built. The generated class captures the component's state, re\", \"ndering logic, lifecycle methods, event handlers, and other logic. You'll learn more about authoring\", \" components in the [Building reusable UI components with Blazor](#page-31-0) section.\\n\\nThe \\\\*\\\\_Impor\", \"ts.razor\\\\* files aren't Razor component files. Instead, they define a set of Razor directives to imp\", \"ort into other *.razor* files within the same folder and in its subfolders. For example, a\\n\\n\\\\*\\\\_Impo\", \"rts.razor\\\\* file is a conventional way to add using directives for commonly used namespaces:\\n\\n```\\n@u\", \"sing System.Net.Http\\n@using System.Net.Http.Json\\n@using Microsoft.AspNetCore.Components.Forms\\n@using\", \" Microsoft.AspNetCore.Components.Routing\\n```\\n\\n```\\n@using Microsoft.AspNetCore.Components.Web\\n@using \", \"Microsoft.AspNetCore.Components.Web.Virtualization\\n@using Microsoft.AspNetCore.Components.WebAssembl\", \"y.Http\\n@using Microsoft.JSInterop\\n@using BlazorApp1\\n@using BlazorApp1.Shared\\n```\\n\\n#### <span id=\\\"pag\", \"e-23-0\\\"></span>Pages\\n\\nWhere are the pages in the Blazor apps? Blazor doesn't define a separate file \", \"extension for addressable pages, like the *.aspx* files in ASP.NET Web Forms apps. Instead, pages ar\", \"e defined by assigning routes to components. A route is typically assigned using the @page Razor dir\", \"ective. For example, the Counter component authored in the *Pages/Counter.razor* file defines the fo\", \"llowing route:\\n\\n```\\n@page \\\"/counter\\\"\\n```\\n\\nRouting in Blazor is handled client-side, not on the serve\", \"r. As the user navigates in the browser, Blazor intercepts the navigation and then renders the compo\", \"nent with the matching route.\\n\\nThe component routes aren't currently inferred by the component's fil\", \"e location like they are with *.aspx* pages or ASP.NET Core Razor Pages. This feature may be added i\", \"n the future. Each route must be specified explicitly on the component. Storing routable components \", \"in a *Pages* folder has no special meaning and is purely a convention.\\n\\n<span id=\\\"page-23-1\\\"></span>\", \"You'll learn more about routing in Blazor in the Pages, routing, and layouts section.\\n\\n#### Layout\\n\\n\", \"In ASP.NET Web Forms apps, a common page layout is handled using master pages (*Site.Master*). In Bl\", \"azor apps, the page layout is handled using layout components (*Shared/MainLayout.razor*). Layout co\", \"mponents are discussed in more detail in the Page, routing, and layouts section.\\n\\n#### <span id=\\\"pag\", \"e-23-2\\\"></span>Bootstrap Blazor\\n\\nTo bootstrap Blazor, the app must:\\n\\n- Specify where on the page the\", \" root component (*App.Razor*) should be rendered.\\n- Add the corresponding Blazor framework script.\\n\\n\", \"In the Blazor Server app, the root component's host page is defined in the \\\\*\\\\_Host.cshtml\\\\* file. T\", \"his file defines a Razor Page, not a component. Razor Pages use Razor syntax to define a server-addr\", \"essable page, very much like an *.aspx* page.\\n\\n```\\n@page \\\"/\\\"\\n@namespace BlazorApp3.Pages\\n@addTagHelp\", \"er *, Microsoft.AspNetCore.Mvc.TagHelpers\\n@{\\n Layout = \\\"_Layout\\\";\\n}\\n```\\n\\n```\\n<component type=\\\"typeof\", \"(App)\\\" render-mode=\\\"ServerPrerendered\\\" />\\n```\\n\\nThe render-mode attribute is used to define where a r\", \"oot-level component should be rendered. The RenderMode option indicates the manner in which the comp\", \"onent should be rendered. The following table outlines the supported RenderMode options.\\n\\n| Option  \", \"                     | Description                                                                  \", \"  |\\n|------------------------------|----------------------------------------------------------------\", \"----------------|\\n| RenderMode.Server            | Rendered interactively once a<br>connection with \", \"the browser is<br>established |\\n| RenderMode.ServerPrerendered | First prerendered and then rendered\", \"<br>interactively                           |\\n| RenderMode.Static            | Rendered as static co\", \"ntent                                                     |\\n\\nThe \\\\*\\\\_Layout.cshtml\\\\* file includes t\", \"he default HTML for the app and its components.\\n\\n```\\n@using Microsoft.AspNetCore.Components.Web\\n@nam\", \"espace BlazorApp3.Pages\\n@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers\\n<!DOCTYPE html>\\n<html l\", \"ang=\\\"en\\\">\\n<head>\\n <meta charset=\\\"utf-8\\\" />\\n <meta name=\\\"viewport\\\" content=\\\"width=device-width, initi\", \"al-scale=1.0\\\" />\\n <base href=\\\"~/\\\" />\\n <link rel=\\\"stylesheet\\\" href=\\\"css/bootstrap/bootstrap.min.css\\\" \", \"/>\\n <link href=\\\"css/site.css\\\" rel=\\\"stylesheet\\\" />\\n <link href=\\\"BlazorApp3.styles.css\\\" rel=\\\"styleshee\", \"t\\\" />\\n <component type=\\\"typeof(HeadOutlet)\\\" render-mode=\\\"ServerPrerendered\\\" />\\n</head>\\n<body>\\n @Rend\", \"erBody()\\n <div id=\\\"blazor-error-ui\\\">\\n <environment include=\\\"Staging,Production\\\">\\n An error has occur\", \"red. This application may no longer respond until reloaded.\\n </environment>\\n <environment include=\\\"D\", \"evelopment\\\">\\n An unhandled exception has occurred. See browser dev tools for details.\\n </environment\", \">\\n <a href=\\\"\\\" class=\\\"reload\\\">Reload</a>\\n <a class=\\\"dismiss\\\"></a>\\n </div>\\n <script src=\\\"_framework/bl\", \"azor.server.js\\\"></script>\\n</body>\\n</html>\\n```\\n\\nThe script reference to \\\\*\\\\_framework/blazor.server.j\", \"s\\\\* establishes the real-time connection with the server and then deals with all user interactions a\", \"nd UI updates.\\n\\nIn the Blazor WebAssembly app, the host page is a simple static HTML file under *www\", \"root/index.html*. The <div> element with id named app is used to indicate where the root component s\", \"hould be rendered.\\n\\n```\\n<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n<head>\\n <meta charset=\\\"utf-8\\\" />\\n <meta nam\", \"e=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maximum-\\nscale=1.0, user-scalable=no\\\" /\", \">\\n <title>BlazorApp1</title>\\n <base href=\\\"/\\\" />\\n <link href=\\\"css/bootstrap/bootstrap.min.css\\\" rel=\\\"s\", \"tylesheet\\\" />\\n <link href=\\\"css/app.css\\\" rel=\\\"stylesheet\\\" />\\n <link href=\\\"BlazorApp1.styles.css\\\" rel=\", \"\\\"stylesheet\\\" />\\n</head>\\n<body>\\n <div id=\\\"app\\\">Loading...</div>\\n <div id=\\\"blazor-error-ui\\\">\\n An unhan\", \"dled error has occurred.\\n <a href=\\\"\\\" class=\\\"reload\\\">Reload</a>\\n <a class=\\\"dismiss\\\"></a>\\n </div>\\n <sc\", \"ript src=\\\"_framework/blazor.webassembly.js\\\"></script>\\n</body>\\n</html>\\n```\\n\\nThe root component to ren\", \"der is specified in the app's *Program.cs* file with the flexibility to register services through de\", \"pendency injection. For more information, see [ASP.NET Core Blazor dependency](https://docs.microsof\", \"t.com/aspnet/core/blazor/fundamentals/dependency-injection?pivots=webassembly)  [injection.](https:/\", \"/docs.microsoft.com/aspnet/core/blazor/fundamentals/dependency-injection?pivots=webassembly)\\n\\n```\\nva\", \"r builder = WebAssemblyHostBuilder.CreateDefault(args);\\nbuilder.RootComponents.Add<App>(\\\"#app\\\");\\nbui\", \"lder.RootComponents.Add<HeadOutlet>(\\\"head::after\\\");\\n```\\n\\n### <span id=\\\"page-25-0\\\"></span>Build outpu\", \"t\\n\\nWhen a Blazor project is built, all Razor component and code files are compiled into a single ass\", \"embly. Unlike ASP.NET Web Forms projects, Blazor doesn't support runtime compilation of the UI logic\", \".\\n\\n#### <span id=\\\"page-25-1\\\"></span>Run the app with Hot Reload\\n\\nTo run the Blazor Server app, press\", \" F5 in Visual Studio to run with the debugger attached, or Ctrl + F5 to run without the debugger att\", \"ached.\\n\\nTo run the Blazor WebAssembly app, choose one of the following approaches:\\n\\n\\u2022 Run the client\", \" project directly using the development server.\\n\\n\\u2022 Run the server project when hosting the app with \", \"ASP.NET Core.\\n\\nBlazor WebAssembly apps can be debugged in both browser and Visual Studio. See [Debug\", \" ASP.NET](https://docs.microsoft.com/aspnet/core/blazor/debug)  [Core Blazor WebAssembly](https://do\", \"cs.microsoft.com/aspnet/core/blazor/debug) for details.\\n\\nBoth Blazor Server and Blazor WebAssembly a\", \"pps support Hot Reload in Visual Studio. Hot Reload is a feature that automatically updates changes \", \"made to a Blazor app live, in the browser. You can toggle whether Hot Reload is enabled from its ico\", \"n in the toolbar:\\n\\n![](_page_26_Figure_3.jpeg)\\n\\nSelecting the caret beside the icon reveals addition\", \"al options. You can toggle Hot Reload on or off, restart the application, and toggle whether Hot Rel\", \"oad should occur whenever a file is saved.\\n\\n![](_page_26_Picture_5.jpeg)\\n\\nYou can also access additi\", \"onal configuration options. The configuration dialog lets you specify whether Hot Reload should be e\", \"nabled when debugging (along with Edit and Continue), when starting without debugging, or when a fil\", \"e is saved.\\n\\n![](_page_27_Figure_0.jpeg)\\n\\nThe \\\"developer inner loop\\\" has been greatly streamlined wi\", \"th Hot Reload. Without Hot Reload, a Blazor developer would typically need to restart and rerun the \", \"app after every change, navigating to the appropriate part of the app as required. With Hot Reload, \", \"changes can be made to the running app without the need to restart in most cases. Hot Reload even re\", \"tains the state of pages, so there's no need to have to re-enter form values or otherwise get the ap\", \"p back where you need it.\\n\\n# <span id=\\\"page-28-0\\\"></span>App startup\\n\\nApplications that are written \", \"for ASP.NET typically have a global.asax.cs file that defines the Application\\\\_Start event that cont\", \"rols which services are configured and made available for both HTML rendering and .NET processing. T\", \"his chapter looks at how things are slightly different with ASP.NET Core and Blazor Server.\\n\\n#### <s\", \"pan id=\\\"page-28-1\\\"></span>Application\\\\_Start and Web Forms\\n\\nThe default web forms Application\\\\_Start\", \" method has grown in purpose over years to handle many configuration tasks. A fresh web forms projec\", \"t with the default template in Visual Studio 2022 now contains the following configuration logic:\\n\\n-\", \" RouteConfig Application URL routing\\n- BundleConfig CSS and JavaScript bundling and minification\\n\\nEa\", \"ch of these individual files resides in the App\\\\_Start folder and run only once at the start of our \", \"application. RouteConfig in the default project template adds the FriendlyUrlSettings for web forms \", \"to allow application URLs to omit the .ASPX file extension. The default template also contains a dir\", \"ective that provides permanent HTTP redirect status codes (HTTP 301) for the .ASPX pages to the frie\", \"ndly URL with the file name that omits the extension.\\n\\nWith ASP.NET Core and Blazor, these methods a\", \"re either simplified and consolidated into the Startup class or they are eliminated in favor of comm\", \"on web technologies.\\n\\n#### <span id=\\\"page-28-2\\\"></span>Blazor Server Startup Structure\\n\\nBlazor Serve\", \"r applications reside on top of an ASP.NET Core 3.0 or later version. ASP.NET Core web applications \", \"are configured in *Program.cs*, or through a pair of methods in the Startup.cs class. A sample *Prog\", \"ram.cs* file is shown below:\\n\\n```\\nusing BlazorApp1.Data;\\nusing Microsoft.AspNetCore.Components;\\nusin\", \"g Microsoft.AspNetCore.Components.Web;\\nvar builder = WebApplication.CreateBuilder(args);\\n// Add serv\", \"ices to the container.\\nbuilder.Services.AddRazorPages();\\nbuilder.Services.AddServerSideBlazor();\\nbui\", \"lder.Services.AddSingleton<WeatherForecastService>();\\n```\\n\\n```\\nvar app = builder.Build();\\n// Configu\", \"re the HTTP request pipeline.\\nif (!app.Environment.IsDevelopment())\\n{\\n app.UseExceptionHandler(\\\"/Err\", \"or\\\");\\n // The default HSTS value is 30 days. You may want to change this for production \\nscenarios, \", \"see https://aka.ms/aspnetcore-hsts.\\n app.UseHsts();\\n}\\napp.UseHttpsRedirection();\\napp.UseStaticFiles(\", \");\\napp.UseRouting();\\napp.MapBlazorHub();\\napp.MapFallbackToPage(\\\"/_Host\\\");\\napp.Run();\\n```\\n\\nThe app's \", \"required services are added to the WebApplicationBuilder instance's Services collection. This is how\", \" the various ASP.NET Core framework services are configured with the framework's built-in dependency\", \" injection container. The various builder.Services.Add\\\\* methods add services that enable features s\", \"uch as authentication, razor pages, MVC controller routing, SignalR, and Blazor Server interactions \", \"among many others. This method was not needed in web forms, as the parsing and handling of the ASPX,\", \" ASCX, ASHX, and ASMX files were defined by referencing ASP.NET in the web.config configuration file\", \". More information about dependency injection in ASP.NET Core is available in the [online documentat\", \"ion.](https://docs.microsoft.com/aspnet/core/fundamentals/dependency-injection)\\n\\nAfter the app has b\", \"een built by the builder, the rest of the calls on app configure its HTTP pipeline. With these calls\", \", we declare from top to bottom the Middleware that will handle every request sent to our applicatio\", \"n. Most of these features in the default configuration were scattered across the web forms configura\", \"tion files and are now in one place for ease of reference.\\n\\nNo longer is the configuration of the cu\", \"stom error page placed in a web.config file, but now is configured to always be shown if the applica\", \"tion environment is not labeled Development. Additionally, ASP.NET Core applications are now configu\", \"red to serve secure pages with TLS by default with the UseHttpsRedirection method call.\\n\\nNext, an un\", \"expected configuration method call is made to UseStaticFiles. In ASP.NET Core, support for requests \", \"for static files (like JavaScript, CSS, and image files) must be explicitly enabled, and only files \", \"in the app's *wwwroot* folder are publicly addressable by default.\\n\\nThe next line is the first that \", \"replicates one of the configuration options from web forms: UseRouting. This method adds the ASP.NET\", \" Core router to the pipeline and it can be either configured here or in the individual files that it\", \" can consider routing to. More information about routing configuration can be found in the Routing s\", \"ection.\\n\\nThe final app.Map\\\\* calls in this section define the endpoints that ASP.NET Core is listeni\", \"ng on. These routes are the web accessible locations that you can access on the web server and recei\", \"ve some content handled by .NET and returned to you. The first entry, MapBlazorHub configures a Sign\", \"alR hub for use in providing the real-time and persistent connection to the server where the state a\", \"nd rendering of Blazor components is handled. The MapFallbackToPage method call indicates the webacc\", \"essible location of the page that starts the Blazor application and also configures the application \", \"to handle deep-linking requests from the client-side. You will see this feature at work if you open \", \"a browser and navigate directly to Blazor handled route in your application, such as /counter in the\", \" default project template. The request gets handled by the \\\\*\\\\_Host.cshtml\\\\* fallback page, which th\", \"en runs the Blazor router and renders the counter page.\\n\\nThe very last line starts the application, \", \"something that wasn't required in web forms (since it relied on IIS to be running).\\n\\n# <span id=\\\"pag\", \"e-30-0\\\"></span>Upgrading the BundleConfig Process\\n\\nTechnologies for bundling assets like CSS stylesh\", \"eets and JavaScript files have changed significantly, with other technologies providing quickly evol\", \"ving tools and techniques for managing these resources. To this end, we recommend using a Node comma\", \"nd-line tool such as Grunt / Gulp / WebPack to package your static assets.\\n\\nThe Grunt, Gulp, and Web\", \"Pack command-line tools and their associated configurations can be added to your application and ASP\", \".NET Core will quietly ignore those files during the application build process. You can add a call t\", \"o run their tasks by adding a Target inside your project file with syntax similar to the following t\", \"hat would trigger a gulp script and the min target inside that script:\\n\\n```\\n<Target Name=\\\"MyPreCompi\", \"leTarget\\\" BeforeTargets=\\\"Build\\\">\\n <Exec Command=\\\"gulp min\\\" />\\n</Target>\\n```\\n\\nMore details about both\", \" strategies to manage your CSS and JavaScript files are available in the [Bundle](https://docs.micro\", \"soft.com/aspnet/core/client-side/bundling-and-minification)  [and minify static assets in ASP.NET Co\", \"re](https://docs.microsoft.com/aspnet/core/client-side/bundling-and-minification) documentation.\\n\\n# \", \"<span id=\\\"page-31-0\\\"></span>Build reusable UI components with Blazor\\n\\nOne of the beautiful things ab\", \"out ASP.NET Web Forms is how it enables encapsulation of reusable pieces of user interface (UI) code\", \" into reusable UI controls. Custom user controls can be defined in markup using *.ascx* files. You c\", \"an also build elaborate server controls in code with full designer support.\\n\\nBlazor also supports UI\", \" encapsulation through *components*. A component:\\n\\n- Is a self-contained chunk of UI.\\n- Maintains it\", \"s own state and rendering logic.\\n- Can define UI event handlers, bind to input data, and manage its \", \"own lifecycle.\\n- Is typically defined in a *.razor* file using Razor syntax.\\n\\n#### <span id=\\\"page-31\", \"-1\\\"></span>An introduction to Razor\\n\\nRazor is a light-weight markup templating language based on HTM\", \"L and C#. With Razor, you can seamlessly transition between markup and C# code to define your compon\", \"ent rendering logic. When the *.razor* file is compiled, the rendering logic is captured in a struct\", \"ured way in a .NET class. The name of the compiled class is taken from the *.razor* file name. The n\", \"amespace is taken from the default namespace for the project and the folder path, or you can explici\", \"tly specify the namespace using the @namespace directive (more on Razor directives below).\\n\\nA compon\", \"ent's rendering logic is authored using normal HTML markup with dynamic logic added using C#. The @ \", \"character is used to transition to C#. Razor is typically smart about figuring out when you've switc\", \"hed back to HTML. For example, the following component renders a <p> tag with the current time:\\n\\n###\", \"# <p>@DateTime.Now</p>\\n\\nTo explicitly specify the beginning and ending of a C# expression, use paren\", \"theses:\\n\\n#### <p>@(DateTime.Now)</p>\\n\\nRazor also makes it easy to use C# control flow in your render\", \"ing logic. For example, you can conditionally render some HTML like this:\\n\\n```\\n@if (value % 2 == 0)\\n\", \"{\\n <p>The value was even.</p>\\n}\\n```\\n\\nOr you can generate a list of items using a normal C# foreach l\", \"oop like this:\\n\\n```\\n<ul>\\n@foreach (var item in items)\\n{\\n <li>@item.Text</li>\\n}\\n</ul>\\n```\\n\\nRazor dire\", \"ctives, like directives in ASP.NET Web Forms, control many aspects of how a Razor component is compi\", \"led. Examples include the component's:\\n\\n- Namespace\\n- Base class\\n- Implemented interfaces\\n- Generic \", \"parameters\\n- Imported namespaces\\n- Routes\\n\\nRazor directives start with the @ character and are typic\", \"ally used at the start of a new line at the start of the file. For example, the @namespace directive\", \" defines the component's namespace:\\n\\n#### @namespace MyComponentNamespace\\n\\nThe following table summa\", \"rizes the various Razor directives used in Blazor and their ASP.NET Web Forms equivalents, if they e\", \"xist.\\n\\n| Directive   | Description                                         | Example                \", \"          | Web Forms equivalent                           |\\n|-------------|------------------------\", \"-----------------------------|----------------------------------|-----------------------------------\", \"-------------|\\n| @attribute  | Adds a class-level<br>attribute to the<br>component | @attribute<br>[\", \"Authorize]        | None                                           |\\n| @code       | Adds class<br>m\", \"embers to the<br>component           | @code { }                        | <script runat=\\\"server\\\"></s\", \"cript>               |\\n| @implements | Implements the<br>specified interface               | @implem\", \"e<br>nts<br>IDisposable   | Use code-behind                                |\\n| @inherits   | Inherit\", \"s from the<br>specified base class           | @inherits<br>MyCompon<br>entBase | <%@ Control<br>Inh\", \"erits=\\\"MyUserControlBase\\\" %> |\\n| @inject     | Injects a service<br>into the component             |\", \" @inject<br>IJSRuntime<br>JS      | None                                           |\\n\\n| Directive  |\", \" Description                                                | Example                               \", \" | Web Forms equivalent                          |\\n|------------|-----------------------------------\", \"-------------------------|----------------------------------------|---------------------------------\", \"--------------|\\n| @layout    | Specifies a layout<br>component for the<br>component       | @layout<\", \"br>MainLayout                  | <%@ Page<br>MasterPageFile=\\\"~/Site.Master\\\" %> |\\n| @namespace | Sets\", \" the namespace<br>for the component                    | @namespa<br>ce<br>MyNamesp<br>ace      | No\", \"ne                                          |\\n| @page      | Specifies the route<br>for the componen\", \"t                   | @page<br>\\\"/product/{i<br>d}\\\"           | <%@ Page %>                          \", \"         |\\n| @typeparam | Specifies a generic<br>type parameter for<br>the component | @typepara<br>\", \"m TItem                   | Use code-behind                               |\\n| @using     | Specifies\", \" a<br>namespace to bring<br>into scope            | @using<br>MyCompon<br>entNamesp<br>ace | Add nam\", \"espace in web.config                   |\\n\\nRazor components also make extensive use of *directive att\", \"ributes* on elements to control various aspects of how components get compiled (event handling, data\", \" binding, component & element references, and so on). Directive attributes all follow a common gener\", \"ic syntax where the values in parenthesis are optional:\\n\\n#### @directive(-suffix(:name))(=\\\"value\\\")\\n\\n\", \"The following table summarizes the various attributes for Razor directives used in Blazor.\\n\\n| Attrib\", \"ute   | Description                                                                                 \", \"      | Example                                                                                    |\", \"\\n|-------------|------------------------------------------------------------------------------------\", \"---------------|------------------------------------------------------------------------------------\", \"--------|\\n| @attributes | Renders a dictionary of attributes                                        \", \"                        | <input<br>@attributes=\\\"ExtraA<br/>ttributes\\\" /&gt;</input<br>             \", \"                 |\\n| @bind       | Creates a two-way data binding                                   \", \"                                 | <input<br>@bind=\\\"username\\\"<br/>@bind:event=\\\"oninp<br/>ut\\\" /&gt;</\", \"input<br>                 |\\n| @on{event}  | Adds an event handler for the<br>specified event        \", \"                                          | <button<br>@onclick=\\\"Incremen<br/>tCount\\\"&gt;Click<br/>m\", \"e!</button<br>                     |\\n| @key        | Specifies a key to be used by the<br>diffing al\", \"gorithm for preserving<br>elements in a collection | <detailseditor<br>@key=\\\"person\\\"<br/>Details=\\\"pe\", \"rson.Det<br/>ails\\\" /&gt;</detailseditor<br> |\\n\\n| Attribute | Description                            \", \"                  | Example                                          |  |\\n|-----------|-------------\", \"---------------------------------------------|--------------------------------------------------|--|\", \"\\n| @ref      | Captures a reference to the<br>component or HTML element | <mydialog<br>@ref=\\\"myDialo\", \"g\\\" /&gt;</mydialog<br> |  |\\n\\nThe various directive attributes used by Blazor (@onclick, @bind, @ref,\", \" and so on) are covered in the sections below and later chapters.\\n\\nMany of the syntaxes used in *.as\", \"px* and *.ascx* files have parallel syntaxes in Razor. Below is a simple comparison of the syntaxes \", \"for ASP.NET Web Forms and Razor.\\n\\n| Feature                       | Web Forms          | Syntax     \", \"            | Razor                        | Synt<br>ax                                             \", \"           |\\n|-------------------------------|--------------------|------------------------|--------\", \"----------------------|-------------------------------------------------------------------|\\n| Direct\", \"ives                    | <%@ [directive] %> | <%@ Page %>            | @[directive]                \", \" | @pa<br>ge                                                         |\\n| Code blocks                \", \"   | <% %>              | <% int x = 123; %>     | @{ }                         | @{<br>int x<br>=<b\", \"r>123; }                                        |\\n| Expressions<br>(HTML-encoded) | <%: %>          \", \"   | <%:DateTime.Now<br>%>  | Implicit: @<br>Explicit: @() | @Da<br>teTi<br>me.N<br>ow<br>@(Da<br>te\", \"Ti<br>me.N<br>ow)          |\\n| Comments                      | <%<br>%>           | <%<br>Commented<\", \"br>%>  | @* *@                        | @*<br>Com<br>ment<br>ed<br>*@                               \", \"      |\\n| Data binding                  | <%# %>             | <%# Bind(\\\"Name\\\")<br>%> | @bind       \", \"                 | <inp<br>ut<br/>@bin<br/>d=\\\"u<br/>serna<br/>me\\\"<br/>/&gt;</inp<br> |\\n\\nTo add membe\", \"rs to the Razor component class, use the @code directive. This technique is similar to using a <scri\", \"pt runat=\\\"server\\\">...</script> block in an ASP.NET Web Forms user control or page.\\n\\n```\\n@code {\\n int\", \" count = 0;\\n void IncrementCount()\\n {\\n count++;\\n```\\n\\n```\\n }\\n}\\n```\\n\\nBecause Razor is based on C#, it \", \"must be compiled from within a C# project (*.csproj*). You can't compile *.razor* files from a Visua\", \"l Basic project (*.vbproj*). You can still reference Visual Basic projects from your Blazor project.\", \" The opposite is true too.\\n\\n<span id=\\\"page-35-0\\\"></span>For a full Razor syntax reference, see [Razo\", \"r syntax reference for ASP.NET Core.](https://docs.microsoft.com/aspnet/core/mvc/views/razor)\\n\\n### U\", \"se components\\n\\nAside from normal HTML, components can also use other components as part of their ren\", \"dering logic. The syntax for using a component in Razor is similar to using a user control in an ASP\", \".NET Web Forms app. Components are specified using an element tag that matches the type name of the \", \"component. For example, you can add a Counter component like this:\\n\\n```\\n<Counter />\\n```\\n\\nUnlike ASP.\", \"NET Web Forms, components in Blazor:\\n\\n- Don't use an element prefix (for example, asp:).\\n- Don't req\", \"uire registration on the page or in the *web.config*.\\n\\nThink of Razor components like you would .NET\", \" types, because that's exactly what they are. If the assembly containing the component is referenced\", \", then the component is available for use. To bring the component's namespace into scope, apply the \", \"@using directive:\\n\\n```\\n@using MyComponentLib\\n<Counter />\\n```\\n\\nAs seen in the default Blazor projects\", \", it's common to put @using directives into a \\\\*\\\\_Imports.razor\\\\* file so that they're imported into\", \" all *.razor* files in the same directory and in child directories.\\n\\nIf the namespace for a componen\", \"t isn't in scope, you can specify a component using its full type name, as you can in C#:\\n\\n<MyCompon\", \"entLib.Counter />\\n\\n# <span id=\\\"page-35-1\\\"></span>Modify page title from components\\n\\nWhen building SP\", \"A-style apps, it's common for parts of a page to reload without reloading the entire page. Even so, \", \"it can be useful to have the title of the page change based on which component is currently loaded. \", \"This can be accomplished by including the <PageTitle> tag in the component's Razor page:\\n\\n```\\n@page \", \"\\\"/\\\"\\n<PageTitle>Home</PageTitle>\\n```\\n\\nThe contents of this element can be dynamic, for instance showi\", \"ng the current count of messages:\\n\\n```\\n<PageTitle>@MessageCount messages</PageTitle>\\n```\\n\\nNote that \", \"if several components on a particular page include <PageTitle> tags, only the last one will be displ\", \"ayed (since each one will overwrite the previous one).\\n\\n### <span id=\\\"page-36-0\\\"></span>Component pa\", \"rameters\\n\\nIn ASP.NET Web Forms, you can flow parameters and data to controls using public properties\", \". These properties can be set in markup using attributes or set directly in code. Razor components w\", \"ork in a similar fashion, although the component properties must also be marked with the [Parameter]\", \" attribute to be considered component parameters.\\n\\nThe following Counter component defines a compone\", \"nt parameter called IncrementAmount that can be used to specify the amount that the Counter should b\", \"e incremented each time the button is clicked.\\n\\n```\\n<h1>Counter</h1>\\n<p>Current count: @currentCount\", \"</p>\\n<button class=\\\"btn btn-primary\\\" @onclick=\\\"IncrementCount\\\">Click me</button>\\n@code {\\n int curren\", \"tCount = 0;\\n [Parameter]\\n public int IncrementAmount { get; set; } = 1;\\n void IncrementCount()\\n {\\n c\", \"urrentCount+=IncrementAmount;\\n }\\n}\\n```\\n\\nTo specify a component parameter in Blazor, use an attribute\", \" as you would in ASP.NET Web Forms:\\n\\n```\\n<Counter IncrementAmount=\\\"10\\\" />\\n```\\n\\n#### <span id=\\\"page-3\", \"6-1\\\"></span>**Query string parameters**\\n\\nRazor components can also leverage values from the query st\", \"ring of the page they're rendered on as a parameter source. To enable this, add the [SupplyParameter\", \"FromQuery] attribute to the parameter. For example, the following parameter definition would get its\", \" value from the request in the form ?IncBy=2:\\n\\n```\\n[Parameter]\\n[SupplyParameterFromQuery(Name = \\\"Inc\", \"By\\\")]\\npublic int IncrementAmount { get; set; } = 1;\\n```\\n\\nIf you don't supply a custom Name in the [S\", \"upplyParameterFromQuery] attribute, by default it will match the property name (IncrementAmount in t\", \"his case).\\n\\n#### <span id=\\\"page-37-0\\\"></span>Components and error boundaries\\n\\nBy default, Blazor app\", \"s will detect unhandled exceptions and show an error message at the bottom of the page with no addit\", \"ional detail. To constrain the parts of the app that are impacted by an unhandled error, for instanc\", \"e to limit the impact to a single component, the <ErrorBoundary> tag can be wrapped around component\", \" declarations.\\n\\nFor example, to protect against possible exceptions thrown from the Counter componen\", \"t, declare it within an <ErrorBoundary> and optionally specify a message to display if there is an e\", \"xception:\\n\\n```\\n<ErrorBoundary>\\n <ChildContent>\\n <Counter />\\n </ChildContent>\\n <ErrorContent>\\n Oops! \", \"The counter isn't working right now; please try again later.\\n </ErrorContent>\\n</ErrorBoundary>\\nIf yo\", \"u don't need to specify custom error content, you can just wrap the component \\ndirectly:\\n<ErrorBound\", \"ary>\\n <Counter />\\n</ErrorBoundary>\\n```\\n\\nA default message stating \\\"An error as occurred.\\\" will be di\", \"splayed if an unhandled exception occurs in the wrapped component.\\n\\n### <span id=\\\"page-37-1\\\"></span>\", \"Event handlers\\n\\nBoth ASP.NET Web Forms and Blazor provide an event-based programming model for handl\", \"ing UI events. Examples of such events include button clicks and text input. In ASP.NET Web Forms, y\", \"ou use HTML server controls to handle UI events exposed by the DOM, or you can handle events exposed\", \" by web server controls. The events are surfaced on the server through form post-back requests. Cons\", \"ider the following Web Forms button click example:\\n\\n#### *Counter.ascx*\\n\\n```\\n<asp:Button ID=\\\"ClickMe\", \"Button\\\" runat=\\\"server\\\" Text=\\\"Click me!\\\" \\nOnClick=\\\"ClickMeButton_Click\\\" />\\nCounter.ascx.cs\\npublic par\", \"tial class Counter : System.Web.UI.UserControl\\n{\\n protected void ClickMeButton_Click(object sender, \", \"EventArgs e)\\n {\\n Console.WriteLine(\\\"The button was clicked!\\\");\\n }\\n}\\n```\\n\\nIn Blazor, you can register\", \" handlers for DOM UI events directly using directive attributes of the form @on{event}. The {event} \", \"placeholder represents the name of the event. For example, you can listen for button clicks like thi\", \"s:\\n\\n```\\n<button @onclick=\\\"OnClick\\\">Click me!</button>\\n@code {\\n void OnClick()\\n {\\n Console.WriteLine(\", \"\\\"The button was clicked!\\\");\\n }\\n}\\n```\\n\\nEvent handlers can accept an optional, event-specific argument\", \" to provide more information about the event. For example, mouse events can take a MouseEventArgs ar\", \"gument, but it isn't required.\\n\\n```\\n<button @onclick=\\\"OnClick\\\">Click me!</button>\\n@code {\\n void OnCl\", \"ick(MouseEventArgs e)\\n {\\n Console.WriteLine($\\\"Mouse clicked at {e.ScreenX}, {e.ScreenY}.\\\");\\n }\\n}\\n```\", \"\\n\\nInstead of referring to a method group for an event handler, you can use a lambda expression. A la\", \"mbda expression allows you to close over other in-scope values.\\n\\n```\\n@foreach (var buttonLabel in bu\", \"ttonLabels)\\n{\\n <button @onclick=\\\"() => Console.WriteLine($\\\"The {buttonLabel} button was \\nclicked!\\\")\\\"\", \">@buttonLabel</button>\\n}\\n```\\n\\nEvent handlers can execute synchronously or asynchronously. For exampl\", \"e, the following OnClick event handler executes asynchronously:\\n\\n```\\n<button @onclick=\\\"OnClick\\\">Clic\", \"k me!</button>\\n@code {\\n async Task OnClick()\\n {\\n var result = await Http.GetAsync(\\\"api/values\\\");\\n }\\n\", \"}\\n```\\n\\nAfter an event is handled, the component is rendered to account for any component state chang\", \"es. With asynchronous event handlers, the component is rendered immediately after the handler execut\", \"ion completes. The component is rendered *again* after the asynchronous Task completes. This asynchr\", \"onous execution mode provides an opportunity to render some appropriate UI while the asynchronous Ta\", \"sk is still in progress.\\n\\n```\\n<button @onclick=\\\"ShowMessage\\\">Get message</button>\\n@if (showMessage)\\n\", \"{\\n @if (message == null)\\n {\\n <p><em>Loading...</em></p>\\n }\\n else\\n```\\n\\n```\\n {\\n <p>The message is: @me\", \"ssage</p>\\n }\\n}\\n@code\\n{\\n bool showMessage = false;\\n string message;\\n public async Task ShowMessage()\\n\", \" {\\n showMessage = true;\\n message = await MessageService.GetMessageAsync();\\n }\\n}\\n```\\n\\nComponents can \", \"also define their own events by defining a component parameter of type EventCallback<TValue>. Event \", \"callbacks support all the variations of DOM UI event handlers: optional arguments, synchronous or as\", \"ynchronous, method groups, or lambda expressions.\\n\\n```\\n<button class=\\\"btn btn-primary\\\" @onclick=\\\"OnC\", \"lick\\\">Click me!</button>\\n@code {\\n [Parameter]\\n public EventCallback<MouseEventArgs> OnClick { get; s\", \"et; }\\n}\\n```\\n\\n# <span id=\\\"page-39-0\\\"></span>Data binding\\n\\nBlazor provides a simple mechanism to bind \", \"data from a UI component to the component's state. This approach differs from the features in ASP.NE\", \"T Web Forms for binding data from data sources to UI controls. We'll cover handling data from differ\", \"ent data sources in the [Dealing with data](#page-59-0) section.\\n\\nTo create a two-way data binding f\", \"rom a UI component to the component's state, use the @bind directive attribute. In the following exa\", \"mple, the value of the check box is bound to the isChecked field.\\n\\n```\\n<input type=\\\"checkbox\\\" @bind=\", \"\\\"isChecked\\\" />\\n@code {\\n bool isChecked;\\n}\\n```\\n\\nWhen the component is rendered, the value of the chec\", \"kbox is set to the value of the isChecked field. When the user toggles the checkbox, the onchange ev\", \"ent is fired and the isChecked field is set to the new value. The @bind syntax in this case is equiv\", \"alent to the following markup:\\n\\n```\\n<input value=\\\"@isChecked\\\" @onchange=\\\"(UIChangeEventArgs e) => is\", \"Checked = e.Value\\\" />\\n```\\n\\nTo change the event used for the bind, use the @bind:event attribute.\\n\\n``\", \"`\\n<input @bind=\\\"text\\\" @bind:event=\\\"oninput\\\" />\\n<p>@text</p>\\n```\\n\\n```\\n@code {\\n string text;\\n}\\n```\\n\\nCo\", \"mponents can also support data binding to their parameters. To data bind, define an event callback p\", \"arameter with the same name as the bindable parameter. The \\\"Changed\\\" suffix is added to the name.\\n\\n*\", \"PasswordBox.razor*\\n\\n```\\nPassword: <input\\n value=\\\"@Password\\\"\\n @oninput=\\\"OnPasswordChanged\\\"\\n type=\\\"@(s\", \"howPassword ? \\\"text\\\" : \\\"password\\\")\\\" />\\n<label><input type=\\\"checkbox\\\" @bind=\\\"showPassword\\\" />Show pas\", \"sword</label>\\n@code {\\n private bool showPassword;\\n [Parameter]\\n public string Password { get; set; }\", \"\\n [Parameter]\\n public EventCallback<string> PasswordChanged { get; set; }\\n private Task OnPasswordCh\", \"anged(ChangeEventArgs e)\\n {\\n Password = e.Value.ToString();\\n return PasswordChanged.InvokeAsync(Pass\", \"word);\\n }\\n}\\n```\\n\\nTo chain a data binding to an underlying UI element, set the value and handle the e\", \"vent directly on the UI element instead of using the @bind attribute.\\n\\nTo bind to a component parame\", \"ter, use a @bind-{Parameter} attribute to specify the parameter to which you want to bind.\\n\\n```\\n<Pas\", \"swordBox @bind-Password=\\\"password\\\" />\\n@code {\\n string password;\\n}\\n```\\n\\n# <span id=\\\"page-40-0\\\"></span\", \">State changes\\n\\nIf the component's state has changed outside of a normal UI event or event callback,\", \" then the component must manually signal that it needs to be rendered again. To signal that a compon\", \"ent's state has changed, call the StateHasChanged method on the component.\\n\\nIn the example below, a \", \"component displays a message from an AppState service that can be updated by other parts of the app.\", \" The component registers its StateHasChanged method with the AppState.OnChange event so that the com\", \"ponent is rendered whenever the message gets updated.\\n\\n```\\npublic class AppState\\n{\\n public string Me\", \"ssage { get; }\\n // Lets components receive change notifications\\n public event Action OnChange;\\n publ\", \"ic void UpdateMessage(string message)\\n {\\n Message = message;\\n NotifyStateChanged();\\n }\\n private void\", \" NotifyStateChanged() => OnChange?.Invoke();\\n}\\n@inject AppState AppState\\n<p>App message: @AppState.M\", \"essage</p>\\n@code {\\n protected override void OnInitialized()\\n {\\n AppState.OnChange += StateHasChanged\", \"\\n }\\n}\\n```\\n\\n#### <span id=\\\"page-41-0\\\"></span>Component lifecycle\\n\\nThe ASP.NET Web Forms framework has\", \" well-defined lifecycle methods for modules, pages, and controls. For example, the following control\", \" implements event handlers for the Init, Load, and UnLoad lifecycle events:\\n\\n*Counter.ascx.cs*\\n\\n```\\n\", \"public partial class Counter : System.Web.UI.UserControl\\n{\\n protected void Page_Init(object sender, \", \"EventArgs e) { ... }\\n protected void Page_Load(object sender, EventArgs e) { ... }\\n protected void P\", \"age_UnLoad(object sender, EventArgs e) { ... }\\n}\\n```\\n\\nRazor components also have a well-defined life\", \"cycle. A component's lifecycle can be used to initialize component state and implement advanced comp\", \"onent behaviors.\\n\\nAll of Blazor's component lifecycle methods have both synchronous and asynchronous\", \" versions. Component rendering is synchronous. You can't run asynchronous logic as part of the compo\", \"nent rendering. All asynchronous logic must execute as part of an async lifecycle method.\\n\\n#### <spa\", \"n id=\\\"page-41-1\\\"></span>**OnInitialized**\\n\\nThe OnInitialized and OnInitializedAsync methods are used\", \" to initialize the component. A component is typically initialized after it's first rendered. After \", \"a component is initialized, it may be rendered\\n\\nmultiple times before it's eventually disposed. The \", \"OnInitialized method is similar to the Page\\\\_Load event in ASP.NET Web Forms pages and controls.\\n\\n``\", \"`\\nprotected override void OnInitialized() { ... }\\nprotected override async Task OnInitializedAsync()\", \" { await ... }\\n```\\n\\n#### <span id=\\\"page-42-0\\\"></span>**OnParametersSet**\\n\\nThe OnParametersSet and On\", \"ParametersSetAsync methods are called when a component has received parameters from its parent and t\", \"he value are assigned to properties. These methods are executed after component initialization and *\", \"each time the component is rendered*.\\n\\n```\\nprotected override void OnParametersSet() { ... }\\nprotect\", \"ed override async Task OnParametersSetAsync() { await ... }\\n```\\n\\n#### <span id=\\\"page-42-1\\\"></span>**\", \"OnAfterRender**\\n\\nThe OnAfterRender and OnAfterRenderAsync methods are called after a component has f\", \"inished rendering. Element and component references are populated at this point (more on these conce\", \"pts below). Interactivity with the browser is enabled at this point. Interactions with the DOM and J\", \"avaScript execution can safely take place.\\n\\n```\\nprotected override void OnAfterRender(bool firstRend\", \"er)\\n{\\n if (firstRender)\\n {\\n ...\\n }\\n}\\nprotected override async Task OnAfterRenderAsync(bool firstRend\", \"er)\\n{\\n if (firstRender)\\n {\\n await ...\\n }\\n}\\n```\\n\\nOnAfterRender and OnAfterRenderAsync *aren't called \", \"when prerendering on the server*.\\n\\nThe firstRender parameter is true the first time the component is\", \" rendered; otherwise, its value is false.\\n\\n#### <span id=\\\"page-42-2\\\"></span>**IDisposable**\\n\\nRazor c\", \"omponents can implement IDisposable to dispose of resources when the component is removed from the U\", \"I. A Razor component can implement IDispose by using the @implements directive:\\n\\n```\\n@using System\\n@\", \"implements IDisposable\\n...\\n@code {\\n public void Dispose()\\n```\\n\\n```\\n {\\n ...\\n }\\n}\\n```\\n\\n#### <span id=\\\"\", \"page-43-0\\\"></span>Capture component references\\n\\nIn ASP.NET Web Forms, it's common to manipulate a co\", \"ntrol instance directly in code by referring to its ID. In Blazor, it's also possible to capture and\", \" manipulate a reference to a component, although it's much less common.\\n\\nTo capture a component refe\", \"rence in Blazor, use the @ref directive attribute. The value of the attribute should match the name \", \"of a settable field with the same type as the referenced component.\\n\\n```\\n<MyLoginDialog @ref=\\\"loginD\", \"ialog\\\" ... />\\n@code {\\n MyLoginDialog loginDialog = default!;\\n void OnSomething()\\n {\\n loginDialog.Sho\", \"w();\\n }\\n}\\n```\\n\\nWhen the parent component is rendered, the field is populated with the child componen\", \"t instance. You can then call methods on, or otherwise manipulate, the component instance.\\n\\nManipula\", \"ting component state directly using component references isn't recommended. Doing so prevents the co\", \"mponent from being rendered automatically at the correct times.\\n\\n#### <span id=\\\"page-43-1\\\"></span>Ca\", \"pture element references\\n\\nRazor components can capture references to an element. Unlike HTML server \", \"controls in ASP.NET Web Forms, you can't manipulate the DOM directly using an element reference in B\", \"lazor. Blazor handles most DOM interactions for you using its DOM diffing algorithm. Captured elemen\", \"t references in Blazor are opaque. However, they're used to pass a specific element reference in a J\", \"avaScript interop call. For more information about JavaScript interop, see [ASP.NET Core Blazor Java\", \"Script](https://docs.microsoft.com/aspnet/core/blazor/javascript-interop)  [interop.](https://docs.m\", \"icrosoft.com/aspnet/core/blazor/javascript-interop)\\n\\n# <span id=\\\"page-43-2\\\"></span>Templated compone\", \"nts\\n\\nIn ASP.NET Web Forms, you can create *templated controls*. Templated controls enable the develo\", \"per to specify a portion of the HTML used to render a container control. The mechanics of building t\", \"emplated server controls are complex, but they enable powerful scenarios for rendering data in a use\", \"r customizable way. Examples of templated controls include Repeater and DataList.\\n\\nRazor components \", \"can also be templated by defining component parameters of type RenderFragment or RenderFragment<T>. \", \"A RenderFragment represents a chunk of Razor markup that can then be rendered by the component. A Re\", \"nderFragment<T> is a chunk of Razor markup that takes a parameter that can be specified when the ren\", \"der fragment is rendered.\\n\\n#### <span id=\\\"page-44-0\\\"></span>**Child content**\\n\\nRazor components can \", \"capture their child content as a RenderFragment and render that content as part of the component ren\", \"dering. To capture child content, define a component parameter of type RenderFragment and name it Ch\", \"ildContent.\\n\\n*ChildContentComponent.razor*\\n\\n```\\n<h1>Component with child content</h1>\\n<div>@ChildCon\", \"tent</div>\\n@code {\\n [Parameter]\\n public RenderFragment ChildContent { get; set; }\\n}\\nA parent compone\", \"nt can then supply child content using normal Razor syntax.\\n<ChildContentComponent>\\n <ChildContent>\\n\", \" <p>The time is @DateTime.Now</p>\\n </ChildContent>\\n</ChildContentComponent>\\n```\\n\\n#### <span id=\\\"page\", \"-44-1\\\"></span>**Template parameters**\\n\\nA templated Razor component can also define multiple componen\", \"t parameters of type RenderFragment or RenderFragment<T>. The parameter for a RenderFragment<T> can \", \"be specified when it's invoked. To specify a generic type parameter for a component, use the @typepa\", \"ram Razor directive.\\n\\n*SimpleListView.razor*\\n\\n```\\n@typeparam TItem\\n@Heading\\n<ul>\\n@foreach (var item \", \"in Items)\\n{\\n <li>@ItemTemplate(item)</li>\\n}\\n</ul>\\n@code {\\n [Parameter]\\n public RenderFragment Headin\", \"g { get; set; }\\n [Parameter]\\n public RenderFragment<TItem> ItemTemplate { get; set; }\\n [Parameter]\\n \", \"public IEnumerable<TItem> Items { get; set; }\\n}\\n```\\n\\nWhen using a templated component, the template \", \"parameters can be specified using child elements that match the names of the parameters. Component a\", \"rguments of type RenderFragment<T> passed as elements have an implicit parameter named context. You \", \"can change the name of this implement parameter using the Context attribute on the child element. An\", \"y generic type parameters can be specified using an attribute that matches the name of the type para\", \"meter. The type parameter will be inferred if possible:\\n\\n```\\n<SimpleListView Items=\\\"messages\\\" TItem=\", \"\\\"string\\\">\\n <Heading>\\n <h1>My list</h1>\\n </Heading>\\n <ItemTemplate Context=\\\"message\\\">\\n <p>The message\", \" is: @message</p>\\n </ItemTemplate>\\n</SimpleListView>\\nThe output of this component looks like this:\\n<\", \"h1>My list</h1>\\n<ul>\\n <li><p>The message is: message1</p></li>\\n <li><p>The message is: message2</p><\", \"/li>\\n<ul>\\n```\\n\\n#### <span id=\\\"page-45-0\\\"></span>Code-behind\\n\\nA Razor component is typically authored\", \" in a single *.razor* file. However, it's also possible to separate the code and markup using a code\", \"-behind file. To use a component file, add a C# file that matches the file name of the component fil\", \"e but with a *.cs* extension added (*Counter.razor.cs*). Use the C# file to define a base class for \", \"the component. You can name the base class anything you'd like, but it's common to name the class th\", \"e same as the component class, but with a Base extension added (CounterBase). The component-based cl\", \"ass must also derive from ComponentBase. Then, in the Razor component file, add the @inherits direct\", \"ive to specify the base class for the component (@inherits CounterBase).\\n\\n#### *Counter.razor*\\n\\n```\\n\", \"@inherits CounterBase\\n<h1>Counter</h1>\\n<p>Current count: @currentCount</p>\\n<button @onclick=\\\"Increme\", \"ntCount\\\">Click me</button>\\nCounter.razor.cs\\npublic class CounterBase : ComponentBase\\n{\\n protected in\", \"t currentCount = 0;\\n protected void IncrementCount()\\n {\\n currentCount++;\\n }\\n}\\n```\\n\\nThe visibility of\", \" the component's members in the base class must be protected or public to be visible to the componen\", \"t class.\\n\\n#### <span id=\\\"page-46-0\\\"></span>Additional resources\\n\\nThe preceding isn't an exhaustive t\", \"reatment of all aspects of Razor components. For more information on how to [Create and use ASP.NET \", \"Core Razor components,](https://docs.microsoft.com/aspnet/core/blazor/components) see the Blazor doc\", \"umentation.\\n\\n# <span id=\\\"page-47-0\\\"></span>Pages, routing, and layouts\\n\\nASP.NET Web Forms apps are c\", \"omposed of pages defined in *.aspx* files. Each page's address is based on its physical file path in\", \" the project. When a browser makes a request to the page, the contents of the page are dynamically r\", \"endered on the server. The rendering accounts for both the page's HTML markup and its server control\", \"s.\\n\\nIn Blazor, each page in the app is a component, typically defined in a *.razor* file, with one o\", \"r more specified routes. Routing mostly happens client-side without involving a specific server requ\", \"est. The browser first makes a request to the root address of the app. A root Router component in th\", \"e Blazor app then handles intercepting navigation requests and forwards them to the correct componen\", \"t.\\n\\nBlazor also supports *deep linking*. Deep linking occurs when the browser makes a request to a s\", \"pecific route other than the root of the app. Requests for deep links sent to the server are routed \", \"to the Blazor app, which then routes the request client-side to the correct component.\\n\\nA simple pag\", \"e in ASP.NET Web Forms might contain the following markup:\\n\\n*Name.aspx*\\n\\n```\\n<%@ Page Title=\\\"Name\\\" L\", \"anguage=\\\"C#\\\" MasterPageFile=\\\"~/Site.Master\\\" AutoEventWireup=\\\"true\\\" \\nCodeBehind=\\\"Name.aspx.cs\\\" Inheri\", \"ts=\\\"WebApplication1.Name\\\" %>\\n<asp:Content ID=\\\"BodyContent\\\" ContentPlaceHolderID=\\\"MainContent\\\" runat=\", \"\\\"server\\\">\\n <div>\\n What is your name?<br />\\n <asp:TextBox ID=\\\"TextBox1\\\" runat=\\\"server\\\"></asp:TextBox>\", \"\\n <asp:Button ID=\\\"Button1\\\" runat=\\\"server\\\" Text=\\\"Submit\\\" OnClick=\\\"Button1_Click\\\" />\\n </div>\\n <div>\\n <\", \"asp:Literal ID=\\\"Literal1\\\" runat=\\\"server\\\" />\\n </div>\\n</asp:Content>\\n```\\n\\n*Name.aspx.cs*\\n\\n```\\npublic p\", \"artial class Name : System.Web.UI.Page\\n{\\n protected void Button1_Click1(object sender, EventArgs e)\\n\", \" {\\n Literal1.Text = \\\"Hello \\\" + TextBox1.Text;\\n }\\n}\\n```\\n\\nThe equivalent page in a Blazor app would lo\", \"ok like this:\\n\\n*Name.razor*\\n\\n```\\n@page \\\"/Name\\\"\\n@layout MainLayout\\n<div>\\n What is your name?<br />\\n <\", \"input @bind=\\\"text\\\" />\\n <button @onclick=\\\"OnClick\\\">Submit</button>\\n</div>\\n<div>\\n @if (name != null)\\n \", \"{\\n @:Hello @name\\n }\\n</div>\\n@code {\\n string text;\\n string name;\\n void OnClick() {\\n name = text;\\n }\\n}\\n\", \"```\\n\\n### <span id=\\\"page-48-0\\\"></span>Create pages\\n\\nTo create a page in Blazor, create a component an\", \"d add the @page Razor directive to specify the route for the component. The @page directive takes a \", \"single parameter, which is the route template to add to that component.\\n\\n```\\n@page \\\"/counter\\\"\\n```\\n\\nT\", \"he route template parameter is required. Unlike ASP.NET Web Forms, the route to a Blazor component *\", \"isn't* inferred from its file location (although that may be a feature added in the future).\\n\\nThe ro\", \"ute template syntax is the same basic syntax used for routing in ASP.NET Web Forms. Route parameters\", \" are specified in the template using braces. Blazor will bind route values to component parameters w\", \"ith the same name (case-insensitive).\\n\\n```\\n@page \\\"/product/{id}\\\"\\n<h1>Product @Id</h1>\\n@code {\\n [Para\", \"meter]\\n public string Id { get; set; }\\n}\\n```\\n\\nYou can also specify constraints on the value of the r\", \"oute parameter. For example, to constrain the product ID to be an int:\\n\\n```\\n@page \\\"/product/{id:int}\", \"\\\"\\n<h1>Product @Id</h1>\\n@code {\\n [Parameter]\\n public int Id { get; set; }\\n}\\n```\\n\\nFor a full list of t\", \"he route constraints supported by Blazor, see [Route constraints.](https://docs.microsoft.com/aspnet\", \"/core/blazor/routing#route-constraints)\\n\\n#### <span id=\\\"page-49-0\\\"></span>Router component\\n\\nRouting \", \"in Blazor is handled by the Router component. The Router component is typically used in the app's ro\", \"ot component (*App.razor*).\\n\\n```\\n<Router AppAssembly=\\\"@typeof(Program).Assembly\\\">\\n <Found Context=\\\"r\", \"outeData\\\">\\n <RouteView RouteData=\\\"@routeData\\\" DefaultLayout=\\\"@typeof(MainLayout)\\\" />\\n </Found>\\n <Not\", \"Found>\\n <LayoutView Layout=\\\"@typeof(MainLayout)\\\">\\n <p>Sorry, there's nothing at this address.</p>\\n <\", \"/LayoutView>\\n </NotFound>\\n</Router>\\n```\\n\\nThe Router component discovers the routable components in t\", \"he specified AppAssembly and in the optionally specified AdditionalAssemblies. When the browser navi\", \"gates, the Router intercepts the navigation and renders the contents of its Found parameter with the\", \" extracted RouteData if a route matches the address, otherwise the Router renders its NotFound param\", \"eter.\\n\\nThe RouteView component handles rendering the matched component specified by the RouteData wi\", \"th its layout if it has one. If the matched component doesn't have a layout, then the optionally spe\", \"cified DefaultLayout is used.\\n\\nThe LayoutView component renders its child content within the specifi\", \"ed layout. We'll look at layouts more in detail later in this chapter.\\n\\n# <span id=\\\"page-49-1\\\"></spa\", \"n>Navigation\\n\\nIn ASP.NET Web Forms, you trigger navigation to a different page by returning a redire\", \"ct response to the browser. For example:\\n\\n```\\nprotected void NavigateButton_Click(object sender, Eve\", \"ntArgs e)\\n{\\n Response.Redirect(\\\"Counter\\\");\\n}\\n```\\n\\nReturning a redirect response isn't typically poss\", \"ible in Blazor. Blazor doesn't use a request-reply model. You can, however, trigger browser navigati\", \"ons directly, as you can with JavaScript.\\n\\nBlazor provides a NavigationManager service that can be u\", \"sed to:\\n\\n- Get the current browser address\\n- Get the base address\\n- Trigger navigations\\n- Get notifi\", \"ed when the address changes\\n\\nTo navigate to a different address, use the NavigateTo method:\\n\\n```\\n@pa\", \"ge \\\"/\\\"\\n@inject NavigationManager NavigationManager\\n<button @onclick=\\\"Navigate\\\">Navigate</button>\\n@co\", \"de {\\n void Navigate() {\\n NavigationManager.NavigateTo(\\\"counter\\\");\\n }\\n}\\n```\\n\\nFor a description of all\", \" NavigationManager members, see [URI and navigation state helpers.](https://docs.microsoft.com/aspne\", \"t/core/blazor/routing#uri-and-navigation-state-helpers)\\n\\n#### <span id=\\\"page-50-0\\\"></span>Base URLs\\n\", \"\\nIf your Blazor app is deployed under a base path, then you need to specify the base URL in the page\", \" metadata using the <base> tag for routing to work property. If the host page for the app is serverr\", \"endered using Razor, then you can use the ~/ syntax to specify the app's base address. If the host p\", \"age is static HTML, then you need to specify the base URL explicitly.\\n\\n```\\n<base href=\\\"~/\\\" />\\n```\\n\\n#\", \"### <span id=\\\"page-50-1\\\"></span>Page layout\\n\\nPage layout in ASP.NET Web Forms is handled by Master P\", \"ages. Master Pages define a template with one or more content placeholders that can then be supplied\", \" by individual pages. Master Pages are defined in *.master* files and start with the <%@ Master %> d\", \"irective. The content of the *.master* files is coded as you would an *.aspx* page, but with the add\", \"ition of <asp:ContentPlaceHolder> controls to mark where pages can supply content.\\n\\n*Site.master*\\n\\n`\", \"``\\n<%@ Master Language=\\\"C#\\\" AutoEventWireup=\\\"true\\\" CodeBehind=\\\"Site.master.cs\\\" \\nInherits=\\\"WebApplica\", \"tion1.SiteMaster\\\" %>\\n<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n<head runat=\\\"server\\\">\\n <meta charset=\\\"utf-8\\\" /\", \">\\n <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\" />\\n <title><%: Page.Title %\", \"> - My ASP.NET Application</title>\\n <link href=\\\"~/favicon.ico\\\" rel=\\\"shortcut icon\\\" type=\\\"image/x-ico\", \"n\\\" />\\n</head>\\n```\\n\\n```\\n<body>\\n <form runat=\\\"server\\\">\\n <div class=\\\"container body-content\\\">\\n <asp:Con\", \"tentPlaceHolder ID=\\\"MainContent\\\" runat=\\\"server\\\">\\n </asp:ContentPlaceHolder>\\n <hr />\\n <footer>\\n <p>&c\", \"opy; <%: DateTime.Now.Year %> - My ASP.NET Application</p>\\n </footer>\\n </div>\\n </form>\\n</body>\\n</htm\", \"l>\\n```\\n\\nIn Blazor, you handle page layout using layout components. Layout components inherit from La\", \"youtComponentBase, which defines a single Body property of type RenderFragment, which can be used to\", \" render the contents of the page.\\n\\n*MainLayout.razor*\\n\\n```\\n@inherits LayoutComponentBase\\n<h1>Main la\", \"yout</h1>\\n<div>\\n @Body\\n</div>\\n```\\n\\nWhen the page with a layout is rendered, the page is rendered wit\", \"hin the contents of the specified layout at the location where the layout renders its Body property.\", \"\\n\\nTo apply a layout to a page, use the @layout directive:\\n\\n```\\n@layout MainLayout\\n```\\n\\nYou can speci\", \"fy the layout for all components in a folder and subfolders using an \\\\*\\\\_Imports.razor\\\\* file. You c\", \"an also specify a default layout for all your pages using the [Router component.](#page-49-0)\\n\\nMaste\", \"r Pages can define multiple content placeholders, but layouts in Blazor only have a single Body prop\", \"erty. This limitation of Blazor layout components will hopefully be addressed in a future release.\\n\\n\", \"Master Pages in ASP.NET Web Forms can be nested. That is, a Master Page may also use a Master Page. \", \"Layout components in Blazor may be nested too. You can apply a layout component to a layout componen\", \"t. The contents of the inner layout will be rendered within the outer layout.\\n\\n*ChildLayout.razor*\\n\\n\", \"```\\n@layout MainLayout\\n<h2>Child layout</h2>\\n<div>\\n @Body\\n</div>\\n```\\n\\n*Index.razor*\\n\\n```\\n@page \\\"/\\\"\\n@\", \"layout ChildLayout\\n<p>I'm in a nested layout!</p>\\n```\\n\\nThe rendered output for the page would then b\", \"e:\\n\\n```\\n<h1>Main layout</h1>\\n<div>\\n <h2>Child layout</h2>\\n <div>\\n <p>I'm in a nested layout!</p>\\n </\", \"div>\\n</div>\\n```\\n\\nLayouts in Blazor don't typically define the root HTML elements for a page (<html>,\", \" <body>, <head>, and so on). The root HTML elements are instead defined in a Blazor app's host page,\", \" which is used to render the initial HTML content for the app (see [Bootstrap Blazor\\\\)](#page-23-2).\", \" The host page can render multiple root components for the app with surrounding markup.\\n\\nComponents \", \"in Blazor, including pages, can't render <script> tags. This rendering restriction exists because <s\", \"cript> tags get loaded once and then can't be changed. Unexpected behavior may occur if you try to r\", \"ender the tags dynamically using Razor syntax. Instead, all <script> tags should be added to the app\", \"'s host page.\\n\\n**CHAPTER** 8\\n\\n# <span id=\\\"page-53-0\\\"></span>State management\\n\\nState management is a \", \"key concept of Web Forms applications, facilitated through ViewState, Session State, Application Sta\", \"te, and Postback features. These stateful features of the framework helped to hide the state managem\", \"ent required for an application and allow application developers to focus on delivering their functi\", \"onality. With ASP.NET Core and Blazor, some of these features have been relocated and some have been\", \" removed altogether. This chapter reviews how to maintain state and deliver the same functionality w\", \"ith the new features in Blazor.\\n\\n### <span id=\\\"page-53-1\\\"></span>Request state management with ViewS\", \"tate\\n\\nWhen discussing state management in Web Forms application, many developers will immediately th\", \"ink of ViewState. In Web Forms, ViewState manages the state of the content between HTTP requests by \", \"sending a large encoded block of text back and forth to the browser. The ViewState field could be ov\", \"erwhelmed with content from a page containing many elements, potentially expanding to several megaby\", \"tes in size.\\n\\nWith Blazor Server, the app maintains an ongoing connection with the server. The app's\", \" state, called a *circuit*, is held in server memory while the connection is considered active. Stat\", \"e will only be disposed when the user navigates away from the app or a particular page in the app. A\", \"ll members of the active components are available between interactions with the server.\\n\\nThere are s\", \"everal advantages of this feature:\\n\\n- Component state is readily available and not rebuilt between i\", \"nteractions.\\n- State isn't transmitted to the browser.\\n\\nHowever, there are some disadvantages to in-\", \"memory component state persistence to be aware of:\\n\\n- If the server restarts between request, state \", \"is lost.\\n- Your application web server load-balancing solution must include sticky sessions to ensur\", \"e that all requests from the same browser return to the same server. If a request goes to a differen\", \"t server, state will be lost.\\n- Persistence of component state on the server can lead to memory pres\", \"sure on the web server.\\n\\nFor the preceding reasons, don't rely on just the state of the component to\", \" reside in-memory on the server. Your application should also include some backing data store for da\", \"ta between requests. Some simple examples of this strategy:\\n\\n\\u2022 In a shopping cart application, persi\", \"st the content of new items added to the cart in a database record. If the state on the server is lo\", \"st, you can reconstitute it from the database records.\\n\\n\\u2022 In a multi-part web form, your users will \", \"expect your application to remember values between each request. Write the data between each of your\", \" user's posts to a data store so that they can be fetched and assembled into the final form response\", \" structure when the multi-part form is completed.\\n\\nFor additional details on managing state in Blazo\", \"r apps, see [ASP.NET Core Blazor state management.](https://docs.microsoft.com/aspnet/core/blazor/st\", \"ate-management)\\n\\n#### <span id=\\\"page-54-0\\\"></span>Maintain state with Session\\n\\nWeb Forms developers \", \"could maintain information about the currently acting user with the [Microsoft.AspNetCore.Http.ISess\", \"ion](https://docs.microsoft.com/dotnet/api/microsoft.aspnetcore.http.isession) dictionary object. It\", \"'s easy enough to add an object with a string key to the Session, and that object would be available\", \" at a later time during the user's interactions with the application. In an attempt to eliminate man\", \"aging interacting with HTTP, the Session object made it easy to maintain state.\\n\\nThe signature of th\", \"e .NET Framework Session object isn't the same as the ASP.NET Core Session object. Consider [the doc\", \"umentation for the new ASP.NET Core Session](https://docs.microsoft.com/dotnet/api/microsoft.aspnetc\", \"ore.http.isession) before deciding to migrate and use the new session state feature.\\n\\nSession is ava\", \"ilable in ASP.NET Core and Blazor Server, but is discouraged from use in favor of storing data in a \", \"data repository appropriately. Session state is also not functional if visitors decline the use HTTP\", \" cookies in your application due to privacy concerns.\\n\\nConfiguration for ASP.NET Core and Session st\", \"ate is available in the [Session and state management in](https://docs.microsoft.com/aspnet/core/fun\", \"damentals/app-state#session-state)  [ASP.NET Core article.](https://docs.microsoft.com/aspnet/core/f\", \"undamentals/app-state#session-state)\\n\\n#### <span id=\\\"page-54-1\\\"></span>Application state\\n\\nThe Applic\", \"ation object in the Web Forms framework provides a massive, cross-request repository for interacting\", \" with application-scope configuration and state. Application state was an ideal place to store vario\", \"us application configuration properties that would be referenced by all requests, regardless of the \", \"user making the request. The problem with the Application object was that data didn't persist across\", \" multiple servers. The state of the application object was lost between restarts.\\n\\nAs with Session, \", \"it's recommended that data move to a persistent backing store that could be accessed by multiple ser\", \"ver instances. If there is volatile data that you would like to be able to access across requests an\", \"d users, you could easily store it in a singleton service that can be injected into components that \", \"require this information or interaction.\\n\\nThe construction of an object to maintain application stat\", \"e and its consumption could resemble the following implementation:\\n\\n```\\npublic class MyApplicationSt\", \"ate\\n{\\n public int VisitorCounter { get; private set; } = 0;\\n public void IncrementCounter() => Visit\", \"orCounter += 1;\\n}\\n```\\n\\n```\\napp.AddSingleton<MyApplicationState>();\\n@inject MyApplicationState AppSta\", \"te\\n<label>Total Visitors: @AppState.VisitorCounter</label>\\n```\\n\\nThe MyApplicationState object is cre\", \"ated only once on the server, and the value VisitorCounter is fetched and output in the component's \", \"label. The VisitorCounter value should be persisted and retrieved from a backing data store for dura\", \"bility and scalability.\\n\\n#### <span id=\\\"page-55-0\\\"></span>In the browser\\n\\nApplication data can also \", \"be stored client-side on the user's device so that is available later. There are two browser feature\", \"s that allow for persistence of data in different scopes of the user's browser:\\n\\n- localStorage scop\", \"ed to the user's entire browser. If the page is reloaded, the browser is closed and reopened, or ano\", \"ther tab is opened with the same URL then the same localStorage is provided by the browser\\n- session\", \"Storage scoped to the user's current browser tab. If the tab is reloaded, the state persists. Howeve\", \"r, if the user opens another tab to your application or closes and reopens the browser the state is \", \"lost.\\n\\nYou can write some custom JavaScript code to interact with these features, or there are a num\", \"ber of NuGet packages that you can use that provide this functionality. One such package is [Microso\", \"ft.AspNetCore.ProtectedBrowserStorage.](https://www.nuget.org/packages/Microsoft.AspNetCore.Protecte\", \"dBrowserStorage)\\n\\nFor instructions on utilizing this package to interact with localStorage and sessi\", \"onStorage, see the [Blazor State Management](https://docs.microsoft.com/aspnet/core/blazor/state-man\", \"agement#protected-browser-storage-experimental-package) article.\\n\\n# <span id=\\\"page-56-0\\\"></span>Form\", \"s and validation\\n\\nThe ASP.NET Web Forms framework includes a set of validation server controls that \", \"handle validating user input entered into a form (RequiredFieldValidator, CompareValidator, RangeVal\", \"idator, and so on). The ASP.NET Web Forms framework also supports model binding and validating the m\", \"odel based on data annotations ([Required], [StringLength], [Range], and so on). The validation logi\", \"c can be enforced both on the server and on the client using unobtrusive JavaScript-based validation\", \". The ValidationSummary server control is used to display a summary of the validation errors to the \", \"user.\\n\\nBlazor supports the sharing of validation logic between both the client and the server. ASP.N\", \"ET provides pre-built JavaScript implementations of many common server validations. In many cases, t\", \"he developer still has to write JavaScript to fully implement their app-specific validation logic. T\", \"he same model types, data annotations, and validation logic can be used on both the server and clien\", \"t.\\n\\nBlazor provides a set of input components. The input components handle binding field data to a m\", \"odel and validating the user input when the form is submitted.\\n\\n| Input component | Rendered HTML el\", \"ement                                                   |  |  |\\n|-----------------|-----------------\", \"--------------------------------------------------------|--|--|\\n| InputCheckbox   | <input type=\\\"che\", \"ckbox\\\"/>                                                |  |  |\\n| InputDate       | <input type=\\\"dat\", \"e\\\"/>                                                    |  |  |\\n| InputNumber     | <input type=\\\"num\", \"ber\\\"/>                                                  |  |  |\\n| InputSelect     | <select></select\", \">                                                       |  |  |\\n| InputText       | <input/>        \", \"                                                        |  |  |\\n| InputTextArea   | <textarea>&lt;/t\", \"d&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;</textarea> |  |  |\\n\\nThe EditForm component wraps these \", \"input components and orchestrates the validation process through an EditContext. When creating an Ed\", \"itForm, you specify what model instance to bind to using the Model parameter. Validation is typicall\", \"y done using data annotations, and it's extensible. To enable data annotation-based validation, add \", \"the DataAnnotationsValidator component as a child of the EditForm. The EditForm component provides a\", \" convenient event for handling valid (OnValidSubmit) and invalid (OnInvalidSubmit) submissions. Ther\", \"e's also a more generic OnSubmit event that lets you trigger and handle the validation yourself.\\n\\nTo\", \" display a validation error summary, use the ValidationSummary component. To display validation mess\", \"ages for a specific input field, use the ValidationMessage component, specifying a lambda expression\", \" for the For parameter that points to the appropriate model member.\\n\\nThe following model type define\", \"s several validation rules using data annotations:\\n\\n```\\nusing System;\\nusing System.ComponentModel.Da\", \"taAnnotations;\\npublic class Starship\\n{\\n [Required]\\n [StringLength(16,\\n ErrorMessage = \\\"Identifier to\", \"o long (16 character limit).\\\")]\\n public string Identifier { get; set; }\\n public string Description {\", \" get; set; }\\n [Required]\\n public string Classification { get; set; }\\n [Range(1, 100000,\\n ErrorMessag\", \"e = \\\"Accommodation invalid (1-100000).\\\")]\\n public int MaximumAccommodation { get; set; }\\n [Required]\", \"\\n [Range(typeof(bool), \\\"true\\\", \\\"true\\\",\\n ErrorMessage = \\\"This form disallows unapproved ships.\\\")]\\n pu\", \"blic bool IsValidatedDesign { get; set; }\\n [Required]\\n public DateTime ProductionDate { get; set; }\\n\", \"}\\n```\\n\\nThe following component demonstrates building a form in Blazor based on the Starship model ty\", \"pe:\\n\\n```\\n<h1>New Ship Entry Form</h1>\\n<EditForm Model=\\\"@starship\\\" OnValidSubmit=\\\"@HandleValidSubmit\\\"\", \">\\n <DataAnnotationsValidator />\\n <ValidationSummary />\\n <p>\\n <label for=\\\"identifier\\\">Identifier: </l\", \"abel>\\n <InputText id=\\\"identifier\\\" @bind-Value=\\\"starship.Identifier\\\" />\\n <ValidationMessage For=\\\"() =\", \"> starship.Identifier\\\" />\\n </p>\\n <p>\\n <label for=\\\"description\\\">Description (optional): </label>\\n <In\", \"putTextArea id=\\\"description\\\" @bind-Value=\\\"starship.Description\\\" />\\n </p>\\n <p>\\n <label for=\\\"classific\", \"ation\\\">Primary Classification: </label>\\n <InputSelect id=\\\"classification\\\" @bind-Value=\\\"starship.Clas\", \"sification\\\">\\n <option value=\\\"\\\">Select classification ...</option>\\n <option value=\\\"Exploration\\\">Explo\", \"ration</option>\\n <option value=\\\"Diplomacy\\\">Diplomacy</option>\\n <option value=\\\"Defense\\\">Defense</opti\", \"on>\\n </InputSelect>\\n <ValidationMessage For=\\\"() => starship.Classification\\\" />\\n </p>\\n <p>\\n <label fo\", \"r=\\\"accommodation\\\">Maximum Accommodation: </label>\\n <InputNumber id=\\\"accommodation\\\" @bind-Value=\\\"star\", \"ship.MaximumAccommodation\\\" />\\n <ValidationMessage For=\\\"() => starship.MaximumAccommodation\\\" />\\n </p>\", \"\\n```\\n\\n```\\n <p>\\n <label for=\\\"valid\\\">Engineering Approval: </label>\\n <InputCheckbox id=\\\"valid\\\" @bind-V\", \"alue=\\\"starship.IsValidatedDesign\\\" />\\n <ValidationMessage For=\\\"() => starship.IsValidatedDesign\\\" />\\n \", \"</p>\\n <p>\\n <label for=\\\"productionDate\\\">Production Date: </label>\\n <InputDate id=\\\"productionDate\\\" @bi\", \"nd-Value=\\\"starship.ProductionDate\\\" />\\n <ValidationMessage For=\\\"() => starship.ProductionDate\\\" />\\n </\", \"p>\\n <button type=\\\"submit\\\">Submit</button>\\n</EditForm>\\n@code {\\n private Starship starship = new Stars\", \"hip();\\n private void HandleValidSubmit()\\n {\\n // Save the data\\n }\\n}\\n```\\n\\nAfter the form submission, t\", \"he model-bound data hasn't been saved to any data store, like a database. In a Blazor WebAssembly ap\", \"p, the data must be sent to the server. For example, using an HTTP POST request. In a Blazor Server \", \"app, the data is already on the server, but it must be persisted. Handling data access in Blazor app\", \"s is the subject of the [Dealing with data](#page-59-0) section.\\n\\n#### <span id=\\\"page-58-0\\\"></span>A\", \"dditional resources\\n\\nFor more information on [forms and validation](https://docs.microsoft.com/aspne\", \"t/core/blazor/forms-validation) in Blazor apps, see the Blazor documentation.\\n\\n# <span id=\\\"page-59-0\", \"\\\"></span>Work with data\\n\\nData access is the backbone of an ASP.NET Web Forms app. If you're building\", \" forms for the web, what happens to that data? With Web Forms, there were multiple data access techn\", \"iques you could use to interact with a database:\\n\\n- Data Sources\\n- ADO.NET\\n- Entity Framework\\n\\nData \", \"Sources were controls that you could place on a Web Forms page and configure like other controls. Vi\", \"sual Studio provided a friendly set of dialogs to configure and bind the controls to your Web Forms \", \"pages. Developers who enjoy a \\\"low code\\\" or \\\"no code\\\" approach preferred this technique when Web For\", \"ms was first released.\\n\\n| SqlDataSource | - CustomersData |           |           |                 \", \"    |\\n|---------------|-----------------|-----------|-----------|---------------------|\\n| CustomerID\", \"    | CompanyName     | FirstName | LastName  |                     |\\n| Databound     | Databound   \", \"    | Databound | Databound | Click Me! Databound |\\n| Databound     | Databound       | Databound | \", \"Databound | Click Me! Databound |\\n| Databound     | Databound       | Databound | Databound | Click \", \"Me! Databound |\\n| Databound     | Databound       | Databound | Databound | Click Me! Databound |\\n| \", \"Databound     | Databound       | Databound | Databound | Click Me! Databound |\\n\\nADO.NET is the low-\", \"level approach to interacting with a database. Your apps could create a connection to the database w\", \"ith Commands, Datatables, and Datasets for interacting. The results could then be bound to fields on\", \" screen without much code. The drawback of this approach was that each set of ADO.NET objects (Conne\", \"ction, Command, and DataTable) was bound to libraries provided by a database vendor. Use of these co\", \"mponents made the code rigid and difficult to migrate to a different database.\\n\\n#### <span id=\\\"page-\", \"59-1\\\"></span>Entity Framework\\n\\nEntity Framework (EF) is the open source object-relational mapping fr\", \"amework maintained by the .NET Foundation. Initially released with .NET Framework, EF allows for gen\", \"erating code for the database connections, storage schemas, and interactions. With this abstraction,\", \" you can focus on your app's business rules and allow the database to be managed by a trusted databa\", \"se administrator. In .NET, you can use an updated version of EF called EF Core. EF Core helps genera\", \"te and maintain the interactions between your code and the database with a series of commands that a\", \"re available for you using the dotnet ef command-line tool. Let's take a look at a few samples to ge\", \"t you working with a database.\\n\\n#### <span id=\\\"page-60-0\\\"></span>**EF Code First**\\n\\nA quick way to g\", \"et started building your database interactions is to start with the class objects you want to work w\", \"ith. EF provides a tool to help generate the appropriate database code for your classes. This approa\", \"ch is called \\\"Code First\\\" development. Consider the following Product class for a sample storefront \", \"app that we want to store in a relational database like Microsoft SQL Server.\\n\\n```\\npublic class Prod\", \"uct\\n{\\n public int Id { get; set; }\\n [Required]\\n public string Name { get; set; }\\n [MaxLength(4000)]\\n\", \" public string Description { get; set; }\\n [Range(0, 99999,99)]\\n [DataType(DataType.Currency)]\\n publi\", \"c decimal Price { get; set; }\\n}\\n```\\n\\nProduct has a primary key and three additional fields that woul\", \"d be created in our database:\\n\\n- EF will identify the Id property as a primary key by convention.\\n- \", \"Name will be stored in a column configured for text storage. The [Required] attribute decorating thi\", \"s property will add a not null constraint to help enforce this declared behavior of the property.\\n- \", \"Description will be stored in a column configured for text storage, and have a maximum length config\", \"ured of 4000 characters as dictated by the [MaxLength] attribute. The database schema will be config\", \"ured with a column named MaxLength using data type varchar(4000).\\n- The Price property will be store\", \"d as currency. The [Range] attribute will generate appropriate constraints to prevent data storage o\", \"utside of the minimum and maximum values declared.\\n\\nWe need to add this Product class to a database \", \"context class that defines the connection and translation operations with our database.\\n\\n```\\npublic \", \"class MyDbContext : DbContext\\n{\\n public DbSet<Product> Products { get; set; }\\n}\\n```\\n\\nThe MyDbContext\", \" class provides the one property that defines the access and translation for the Product class. Your\", \" application configures this class for interaction with the database using the following entries in \", \"the Startup class's ConfigureServices method (or appropriate location in *Program.cs* using the buil\", \"der.Services property instead of services):\\n\\n```\\nservices.AddDbContext<MyDbContext>(options =>\\n opti\", \"ons.UseSqlServer(\\\"MY DATABASE CONNECTION STRING\\\"));\\n```\\n\\nThe preceding code will connect to a SQL Se\", \"rver database with the specified connection string. You can place the connection string in your *app\", \"settings.json* file, environment variables, or other configuration storage locations and replace thi\", \"s embedded string appropriately.\\n\\nYou can then generate the database table appropriate for this clas\", \"s using the following commands:\\n\\n```\\ndotnet ef migrations add 'Create Product table'\\ndotnet ef datab\", \"ase update\\n```\\n\\nThe first command defines the changes you're making to the database schema as a new \", \"EF Migration called Create Product table. A Migration defines how to apply and remove your new datab\", \"ase changes.\\n\\nOnce applied, you have a simple Product table in your database and some new classes ad\", \"ded to the project that help manage the database schema. You can find these generated classes, by de\", \"fault, in a new folder called *Migrations*. When you make changes to the Product class or add more r\", \"elated classes you would like interacting with your database, you need to run the command-line comma\", \"nds again with a new name of the migration. This command will generate another set of migration clas\", \"ses to update your database schema.\\n\\n#### <span id=\\\"page-61-0\\\"></span>**EF Database First**\\n\\nFor exi\", \"sting databases, you can generate the classes for EF Core by using the .NET command-line tools. To s\", \"caffold the classes, use a variation of the following command:\\n\\n```\\ndotnet ef dbcontext scaffold \\\"CO\", \"NNECTION STRING\\\" Microsoft.EntityFrameworkCore.SqlServer -c \\nMyDbContext -t Product -t Customer\\n```\\n\", \"\\nThe preceding command connects to the database using the specified connection string and the Micros\", \"oft.EntityFrameworkCore.SqlServer provider. Once connected, a database context class named MyDbConte\", \"xt is created. Additionally, supporting classes are created for the Product and Customer tables that\", \" were specified with the -t options. There are many configuration options for this command to genera\", \"te the class hierarchy appropriate for your database. For a complete reference, see [the](https://do\", \"cs.microsoft.com/ef/core/miscellaneous/cli/dotnet#dotnet-ef-dbcontext-scaffold)  [command's document\", \"ation](https://docs.microsoft.com/ef/core/miscellaneous/cli/dotnet#dotnet-ef-dbcontext-scaffold).\\n\\n<\", \"span id=\\\"page-61-1\\\"></span>More information about [EF Core](https://docs.microsoft.com/ef/core/) can\", \" be found on the Microsoft Docs site.\\n\\n#### Interact with web services\\n\\nWhen ASP.NET was first relea\", \"sed, SOAP services were the preferred way for web servers and clients to exchange data. Much has cha\", \"nged since that time, and the preferred interactions with services have shifted to direct HTTP clien\", \"t interactions. With ASP.NET Core and Blazor, you can register the configuration of your HttpClient \", \"in *Program.cs* or in the Startup class's ConfigureServices method. Use that configuration when you \", \"need to interact with the HTTP endpoint. Consider the following configuration code:\\n\\n```\\n// in Progr\", \"am.cs\\nbuilder.Services.AddHttpClient(\\\"github\\\", client =>\\n{\\n client.BaseAddress = new Uri(\\\"http://api\", \".github.com/\\\");\\n // Github API versioning\\n client.DefaultRequestHeaders.Add(\\\"Accept\\\", \\\"application/v\", \"nd.github.v3+json\\\");\\n // Github requires a user-agent\\n client.DefaultRequestHeaders.Add(\\\"User-Agent\\\"\", \", \\\"BlazorWebForms-Sample\\\");\\n});\\n```\\n\\nWhenever you need to access data from GitHub, create a client w\", \"ith a name of github. The client is configured with the base address, and the request headers are se\", \"t appropriately. Inject the IHttpClientFactory into your Blazor components with the @inject directiv\", \"e or an [Inject] attribute on a property. Create your named client and interact with services using \", \"the following syntax:\\n\\n```\\n@inject IHttpClientFactory factory\\n...\\n@code {\\n protected override async \", \"Task OnInitializedAsync()\\n {\\n var client = factory.CreateClient(\\\"github\\\");\\n var response = await cli\", \"ent.GetAsync(\\\"repos/dotnet/docs/issues\\\");\\n response.EnsureStatusCode();\\n var content = await respons\", \"e.Content.ReadAsStringAsync();\\n }\\n}\\n```\\n\\nThis method returns the string describing the collection of\", \" issues in the *dotnet/docs* GitHub repository. It returns content in JSON format and is deserialize\", \"d into appropriate GitHub issue objects. There are many ways that you can configure the HttpClientFa\", \"ctory to deliver preconfigured HttpClient objects. Try configuring multiple HttpClient instances wit\", \"h different names and endpoints for the various web services you work with. This approach will make \", \"your interactions with those services easier to work with on each page. For more information, see [M\", \"ake HTTP requests using IHttpClientFactory.](https://docs.microsoft.com/aspnet/core/fundamentals/htt\", \"p-requests)\\n\\n**CHAPTER** 11\\n\\n# <span id=\\\"page-63-0\\\"></span>Modules, handlers, and middleware\\n\\nAn ASP\", \".NET Core app is built upon a series of *middleware*. Middleware is handlers that are arranged into \", \"a pipeline to handle requests and responses. In a Web Forms app, HTTP handlers and modules solve sim\", \"ilar problems. In ASP.NET Core, modules, handlers, *Global.asax.cs*, and the app life cycle are repl\", \"aced with middleware. In this chapter, you'll learn about middleware in the context of a Blazor app.\", \"\\n\\n#### <span id=\\\"page-63-1\\\"></span>Overview\\n\\nThe ASP.NET Core request pipeline consists of a sequenc\", \"e of request delegates, called one after the other. The following diagram demonstrates the concept. \", \"The thread of execution follows the black arrows.\\n\\n![](_page_64_Figure_0.jpeg)\\n\\nThe preceding diagra\", \"m lacks a concept of lifecycle events. This concept is foundational to how ASP.NET Web Forms request\", \"s are handled. This system makes it easier to reason about what process is occurring and allows midd\", \"leware to be inserted at any point. Middleware executes in the order in which it's added to the requ\", \"est pipeline. They're also added in code instead of configuration files, usually in *Startup.cs*.\\n\\n#\", \"### <span id=\\\"page-64-0\\\"></span>Katana\\n\\nReaders familiar with Katana will feel comfortable in ASP.NE\", \"T Core. In fact, Katana is a framework from which ASP.NET Core derives. It introduced similar middle\", \"ware and pipeline patterns for ASP.NET 4.x. Middleware designed for Katana can be adapted to work wi\", \"th the ASP.NET Core pipeline.\\n\\n#### <span id=\\\"page-64-1\\\"></span>Common middleware\\n\\nASP.NET 4.x inclu\", \"des many modules. In a similar fashion, ASP.NET Core has many middleware components available as wel\", \"l. IIS modules may be used in some cases with ASP.NET Core. In other cases, native ASP.NET Core midd\", \"leware may be available.\\n\\nThe following table lists replacement middleware and components in ASP.NET\", \" Core.\\n\\n| Module      | ASP.NET 4.x module | ASP.NET Core option             |\\n|-------------|------\", \"--------------|---------------------------------|\\n| HTTP errors | CustomErrorModule  | Status Code P\", \"ages<br>Middleware |\\n\\n| Module                  | ASP.NET 4.x module          | ASP.NET Core option \", \"               |\\n|-------------------------|-----------------------------|--------------------------\", \"----------|\\n| Default document        | DefaultDocumentModule       | Default Files Middleware      \", \"     |\\n| Directory browsing      | DirectoryListingModule      | Directory Browsing<br>Middleware   \", \"|\\n| Dynamic compression     | DynamicCompressionModule    | Response Compression<br>Middleware |\\n| F\", \"ailed requests tracing | FailedRequestsTracingModule | ASP.NET Core Logging               |\\n| File c\", \"aching            | FileCacheModule             | Response Caching<br>Middleware     |\\n| HTTP cachin\", \"g            | HttpCacheModule             | Response Caching<br>Middleware     |\\n| HTTP logging    \", \"        | HttpLoggingModule           | ASP.NET Core Logging               |\\n| HTTP redirection     \", \"   | HttpRedirectionModule       | URL Rewriting<br>Middleware        |\\n| ISAPI filters           | \", \"IsapiFilterModule           | Middleware                         |\\n| ISAPI                   | Isapi\", \"Module                 | Middleware                         |\\n| Request filtering       | RequestFil\", \"teringModule      | URL Rewriting<br>Middleware IRule  |\\n| URL rewriting\\u2020          | RewriteModule  \", \"             | URL Rewriting<br>Middleware        |\\n| Static compression      | StaticCompressionMod\", \"ule     | Response Compression<br>Middleware |\\n| Static content          | StaticFileModule         \", \"   | Static File Middleware             |\\n| URL authorization       | UrlAuthorizationModule      | \", \"ASP.NET Core Identity              |\\n\\nThis list isn't exhaustive but should give an idea of what map\", \"ping exists between the two frameworks. For a more detailed list, see [IIS modules with ASP.NET Core\", \".](https://docs.microsoft.com/aspnet/core/host-and-deploy/iis/modules)\\n\\n#### <span id=\\\"page-65-0\\\"></\", \"span>Custom middleware\\n\\nBuilt-in middleware may not handle all scenarios needed for an app. In such \", \"cases, it makes sense to create your own middleware. There are multiple ways of defining middleware,\", \" with the simplest being a simple delegate. Consider the following middleware, which accepts a cultu\", \"re request from a query string:\\n\\n```\\npublic class Startup\\n{\\n public void Configure(IApplicationBuild\", \"er app)\\n {\\n app.Use(async (context, next) =>\\n {\\n var cultureQuery = context.Request.Query[\\\"culture\\\"]\", \";\\n```\\n\\n```\\n if (!string.IsNullOrWhiteSpace(cultureQuery))\\n {\\n var culture = new CultureInfo(cultureQ\", \"uery);\\n CultureInfo.CurrentCulture = culture;\\n CultureInfo.CurrentUICulture = culture;\\n }\\n // Call t\", \"he next delegate/middleware in the pipeline\\n await next();\\n });\\n app.Run(async (context) =>\\n await c\", \"ontext.Response.WriteAsync(\\n $\\\"Hello {CultureInfo.CurrentCulture.DisplayName}\\\"));\\n }\\n}\\n```\\n\\nMiddlewa\", \"re can also be defined as class, either by implementing the IMiddleware interface or by following mi\", \"ddleware convention. For more information, see [Write custom ASP.NET Core middleware.](https://docs.\", \"microsoft.com/aspnet/core/fundamentals/middleware/write)\\n\\n# <span id=\\\"page-67-0\\\"></span>App configur\", \"ation\\n\\nThe primary way to load app configuration in Web Forms is with entries in the *web.config* fi\", \"le\\u2014either on the server or a related configuration file referenced by *web.config*. You can use the \", \"static ConfigurationManager object to interact with app settings, data repository connection strings\", \", and other extended configuration providers that are added into the app. It's typical to see intera\", \"ctions with app configuration as seen in the following code:\\n\\n```\\nvar configurationValue = Configura\", \"tionManager.AppSettings[\\\"ConfigurationSettingName\\\"];\\nvar connectionString =\\nConfigurationManager.Con\", \"nectionStrings[\\\"MyDatabaseConnectionName\\\"].ConnectionString;\\n```\\n\\nWith ASP.NET Core and server-side \", \"Blazor, the *web.config* file MAY be present if your app is hosted on a Windows IIS server. However,\", \" there's no ConfigurationManager interaction with this configuration, and you can receive more struc\", \"tured app configuration from other sources. Let's take a look at how configuration is gathered and h\", \"ow you can still access configuration information from a *web.config* file.\\n\\n#### <span id=\\\"page-67-\", \"1\\\"></span>Configuration sources\\n\\nASP.NET Core recognizes there are many configuration sources you ma\", \"y want to use for your app. The framework attempts to offer you the best of these features by defaul\", \"t. Configuration is read and aggregated from these various sources by ASP.NET Core. Later loaded val\", \"ues for the same configuration key take precedence over earlier values.\\n\\nASP.NET Core was designed t\", \"o be cloud-aware and to make the configuration of apps easier for both operators and developers. ASP\", \".NET Core is environment-aware and knows if it's running in your Production or Development environme\", \"nt. The environment indicator is set in the ASPNETCORE\\\\_ENVIRONMENT system environment variable. If \", \"no value is configured, the app defaults to running in the Production environment.\\n\\nYour app can tri\", \"gger and add configuration from several sources based on the environment's name. By default, the con\", \"figuration is loaded from the following resources in the order listed:\\n\\n- 1. *appsettings.json* file\", \", if present\\n- 2. *appsettings.{ENVIRONMENT\\\\_NAME}.json* file, if present\\n- 3. User secrets file on \", \"disk, if present\\n- 4. Environment variables\\n- 5. Command-line arguments\\n\\n# <span id=\\\"page-68-0\\\"></sp\", \"an>appsettings.json format and access\\n\\nThe *appsettings.json* file can be hierarchical with values s\", \"tructured like the following JSON:\\n\\n```\\n{\\n \\\"section0\\\": {\\n \\\"key0\\\": \\\"value\\\",\\n \\\"key1\\\": \\\"value\\\"\\n },\\n \\\"se\", \"ction1\\\": {\\n \\\"key0\\\": \\\"value\\\",\\n \\\"key1\\\": \\\"value\\\"\\n }\\n}\\n```\\n\\nWhen presented with the preceding JSON, the \", \"configuration system flattens child values and references their fully qualified hierarchical paths. \", \"A colon (:) character separates each property in the hierarchy. For example, the configuration key s\", \"ection1:key0 accesses the section1 object literal's key0 value.\\n\\n#### <span id=\\\"page-68-1\\\"></span>Us\", \"er secrets\\n\\nUser secrets are:\\n\\n- Configuration values that are stored in a JSON file on the develope\", \"r's workstation, outside of the app development folder.\\n- Only loaded when running in the Developmen\", \"t environment.\\n- Associated with a specific app.\\n- Managed with the .NET CLI's user-secrets command.\", \"\\n\\nConfigure your app for secrets storage by executing the user-secrets command:\\n\\n```\\ndotnet user-sec\", \"rets init\\n```\\n\\nThe preceding command adds a UserSecretsId element to the project file. The element c\", \"ontains a GUID, which is used to associate secrets with the app. You can then define a secret with t\", \"he set command. For example:\\n\\n```\\ndotnet user-secrets set \\\"Parent:ApiKey\\\" \\\"12345\\\"\\n```\\n\\nThe preceding\", \" command makes the Parent:ApiKey configuration key available on a developer's workstation with the v\", \"alue 12345.\\n\\nFor more information about creating, storing, and managing user secrets, see the [Safe \", \"storage of app](https://docs.microsoft.com/aspnet/core/security/app-secrets)  [secrets in developmen\", \"t in ASP.NET Core](https://docs.microsoft.com/aspnet/core/security/app-secrets) document.\\n\\n#### <spa\", \"n id=\\\"page-68-2\\\"></span>Environment variables\\n\\nThe next set of values loaded into your app configura\", \"tion is the system's environment variables. All of your system's environment variable settings are n\", \"ow accessible to you through the configuration API.\\n\\nHierarchical values are flattened and separated\", \" by colon characters when read inside your app. However, some operating systems don't allow the colo\", \"n character environment variable names. ASP.NET Core addresses this limitation by converting values \", \"that have double-underscores (\\\\_\\\\_) into a colon when they're accessed. The Parent:ApiKey value from\", \" the user secrets section above can be overridden with the environment variable Parent\\\\_\\\\_ApiKey.\\n\\n#\", \"### <span id=\\\"page-69-0\\\"></span>Command-line arguments\\n\\nConfiguration can also be provided as comman\", \"d-line arguments when your app is started. Use the double-dash (--) or forward-slash (/) notation to\", \" indicate the name of the configuration value to set and the value to be configured. The syntax rese\", \"mbles the following commands:\\n\\n```\\ndotnet run CommandLineKey1=value1 --CommandLineKey2=value2 /Comma\", \"ndLineKey3=value3\\ndotnet run --CommandLineKey1 value1 /CommandLineKey2 value2\\ndotnet run Parent:ApiK\", \"ey=67890\\n```\\n\\n# <span id=\\\"page-69-1\\\"></span>The return of web.config\\n\\nIf you've deployed your app to\", \" Windows on IIS, the *web.config* file still configures IIS to manage your app. By default, IIS adds\", \" a reference to the ASP.NET Core Module (ANCM). ANCM is a native IIS module that hosts your app in p\", \"lace of the Kestrel web server. This *web.config* section resembles the following XML markup:\\n\\n```\\n<\", \"?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<configuration>\\n <location path=\\\".\\\" inheritInChildApplications\", \"=\\\"false\\\">\\n <system.webServer>\\n <handlers>\\n <add name=\\\"aspNetCore\\\" path=\\\"*\\\" verb=\\\"*\\\" modules=\\\"AspNetC\", \"oreModuleV2\\\"\\nresourceType=\\\"Unspecified\\\" />\\n </handlers>\\n <aspNetCore processPath=\\\".\\\\MyApp.exe\\\"\\n stdo\", \"utLogEnabled=\\\"false\\\"\\n stdoutLogFile=\\\".\\\\logs\\\\stdout\\\"\\n hostingModel=\\\"inprocess\\\" />\\n </system.webServer\", \">\\n </location>\\n</configuration>\\n```\\n\\nApp-specific configuration can be defined by nesting an environ\", \"mentVariables element in the aspNetCore element. The values defined in this section are presented to\", \" the ASP.NET Core app as environment variables. The environment variables load appropriately during \", \"that segment of app startup.\\n\\n```\\n<aspNetCore processPath=\\\"dotnet\\\"\\n arguments=\\\".\\\\MyApp.dll\\\"\\n stdoutL\", \"ogEnabled=\\\"false\\\"\\n stdoutLogFile=\\\".\\\\logs\\\\stdout\\\"\\n hostingModel=\\\"inprocess\\\">\\n <environmentVariables>\\n\", \" <environmentVariable name=\\\"ASPNETCORE_ENVIRONMENT\\\" value=\\\"Development\\\" />\\n```\\n\\n```\\n <environmentVar\", \"iable name=\\\"Parent:ApiKey\\\" value=\\\"67890\\\" />\\n </environmentVariables>\\n</aspNetCore>\\n```\\n\\n### <span id\", \"=\\\"page-70-0\\\"></span>Read configuration in the app\\n\\nASP.NET Core provides app configuration through t\", \"he [IConfiguration](https://docs.microsoft.com/dotnet/api/microsoft.extensions.configuration.iconfig\", \"uration) interface. This configuration interface should be requested by your Blazor components, Blaz\", \"or pages, and any other ASP.NET Coremanaged class that needs access to configuration. The ASP.NET Co\", \"re framework will automatically populate this interface with the resolved configuration configured e\", \"arlier. On a Blazor page or a component's Razor markup, you can inject the IConfiguration object wit\", \"h an @inject directive at the top of the *.razor* file like this:\\n\\n```\\n@inject IConfiguration Config\", \"uration\\n```\\n\\nThis preceding statement makes the IConfiguration object available as the Configuration\", \" variable throughout the rest of the Razor template.\\n\\nIndividual configuration settings can be read \", \"by specifying the configuration setting hierarchy sought as an indexer parameter:\\n\\n```\\nvar mySetting\", \" = Configuration[\\\"section1:key0\\\"];\\n```\\n\\nYou can fetch entire configuration sections by using the [Ge\", \"tSection](https://docs.microsoft.com/dotnet/api/microsoft.extensions.configuration.iconfiguration.ge\", \"tsection) method to retrieve a collection of keys at a specific location with a syntax similar to Ge\", \"tSection(\\\"section1\\\") to retrieve the configuration for section1 from the earlier example.\\n\\n# <span i\", \"d=\\\"page-70-1\\\"></span>Strongly typed configuration\\n\\nWith Web Forms, it was possible to create a stron\", \"gly typed configuration type that inherited from the [ConfigurationSection](https://docs.microsoft.c\", \"om/dotnet/api/system.configuration.configurationsection) type and associated types. A ConfigurationS\", \"ection allowed you to configure some business rules and processing for those configuration values.\\n\\n\", \"In ASP.NET Core, you can specify a class hierarchy that will receive the configuration values. These\", \" classes:\\n\\n- Don't need to inherit from a parent class.\\n- Should include public properties that matc\", \"h the properties and type references for the configuration structure you wish to capture.\\n\\nFor the e\", \"arlier *appsettings.json* sample, you could define the following classes to capture the values:\\n\\n```\", \"\\npublic class MyConfig\\n{\\n public MyConfigSection section0 { get; set;}\\n public MyConfigSection secti\", \"on1 { get; set;}\\n}\\npublic class MyConfigSection\\n{\\n```\\n\\n```\\n public string key0 { get; set; }\\n public\", \" string key1 { get; set; }\\n}\\n```\\n\\nThis class hierarchy can be populated by adding the following line\", \" to the Startup.ConfigureServices method (or appropriate location in *Program.cs* using the builder.\", \"Services property instead of services):\\n\\n```\\nservices.Configure<MyConfig>(Configuration);\\n```\\n\\nIn th\", \"e rest of the app, you can add an input parameter to classes or an @inject directive in Razor templa\", \"tes of type IOptions<MyConfig> to receive the strongly typed configuration settings. The IOptions<My\", \"Config>.Value property will yield the MyConfig value populated from the configuration settings.\\n\\n```\", \"\\n@inject IOptions<MyConfig> options\\n@code {\\n var MyConfiguration = options.Value;\\n var theSetting = \", \"MyConfiguration.section1.key0;\\n}\\n```\\n\\nMore information about the Options feature can be found in the\", \" [Options pattern in ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/configuration\", \"/options#options-interfaces) document.\\n\\n# <span id=\\\"page-72-0\\\"></span>Security: Authentication and A\", \"uthorization in ASP.NET Web Forms and Blazor\\n\\nMigrating from an ASP.NET Web Forms application to Bla\", \"zor will almost certainly require updating how authentication and authorization are performed, assum\", \"ing the application had authentication configured. This chapter will cover how to migrate from the A\", \"SP.NET Web Forms universal provider model (for membership, roles, and user profiles) and how to work\", \" with ASP.NET Core Identity from Blazor apps. While this chapter will cover the high-level steps and\", \" considerations, the detailed steps and scripts may be found in the referenced documentation.\\n\\n# <sp\", \"an id=\\\"page-72-1\\\"></span>ASP.NET universal providers\\n\\nSince ASP.NET 2.0, the ASP.NET Web Forms platf\", \"orm has supported a provider model for a variety of features, including membership. The universal me\", \"mbership provider, along with the optional role provider, is commonly deployed with ASP.NET Web Form\", \"s applications. It offers a robust and secure way to manage authentication and authorization that co\", \"ntinues to work well today. The most recent offering of these universal providers is available as a \", \"NuGet package, [Microsoft.AspNet.Providers.](https://www.nuget.org/packages/Microsoft.AspNet.Provide\", \"rs)\\n\\nThe Universal Providers work with a SQL database schema that includes tables like aspnet\\\\_Appli\", \"cations, aspnet\\\\_Membership, aspnet\\\\_Roles, and aspnet\\\\_Users. When configured by running the [aspne\", \"t\\\\\\\\_regsql.exe command,](https://docs.microsoft.com/previous-versions/ms229862(v=vs.140)) the provid\", \"ers install tables and stored procedures that provide all of the necessary queries and commands to w\", \"ork with the underlying data. The database schema and these stored procedures are not compatible wit\", \"h newer ASP.NET Identity and ASP.NET Core Identity systems, so existing data must be migrated into t\", \"he new system. Figure 1 shows an example table schema configured for universal providers.\\n\\nThe unive\", \"rsal provider handles users, membership, roles, and profiles. Users are assigned globally unique ide\", \"ntifiers and basic information like userId, userName etc. are stored in the aspnet\\\\_Users table. Aut\", \"hentication information, such as password, password format, password salt, lockout counters and deta\", \"ils, etc. are stored in the aspnet\\\\_Membership table. Roles consist simply of names and unique ident\", \"ifiers, which are assigned to users via the aspnet\\\\_UsersInRoles association table, providing a many\", \"-to-many relationship.\\n\\nIf your existing system is using roles in addition to membership, you will n\", \"eed to migrate the user accounts, the associated passwords, the roles, and the role membership into \", \"ASP.NET Core Identity. You will also most likely need to update your code where you're currently per\", \"forming role checks using if statements to instead leverage declarative filters, attributes, and/or \", \"tag helpers. We will review migration considerations in greater detail at the end of this chapter.\\n\\n\", \"#### <span id=\\\"page-73-0\\\"></span>**Authorization configuration in Web Forms**\\n\\nTo configure authoriz\", \"ed access to certain pages in an ASP.NET Web Forms application, typically you specify that certain p\", \"ages or folders are inaccessible to anonymous users. This configuration is done in the web.config fi\", \"le:\\n\\n```\\n<?xml version=\\\"1.0\\\"?>\\n<configuration>\\n <system.web>\\n <authentication mode=\\\"Forms\\\">\\n <forms \", \"defaultUrl=\\\"~/home.aspx\\\" loginUrl=\\\"~/login.aspx\\\"\\n slidingExpiration=\\\"true\\\" timeout=\\\"2880\\\"></forms>\\n \", \"</authentication>\\n <authorization>\\n <deny users=\\\"?\\\" />\\n </authorization>\\n </system.web>\\n</configurat\", \"ion>\\n```\\n\\nThe authentication configuration section sets up the forms authentication for the applicat\", \"ion. The authorization section is used to disallow anonymous users for the entire application. Howev\", \"er, you can provide more granular authorization rules on a per-location basis as well as apply role-\", \"based authorization checks.\\n\\n```\\n<location path=\\\"login.aspx\\\">\\n <system.web>\\n```\\n\\n```\\n <authorization\", \">\\n <allow users=\\\"*\\\" />\\n </authorization>\\n </system.web>\\n</location>\\n```\\n\\nThe above configuration, wh\", \"en combined with the first one, would allow anonymous users to access the login page, overriding the\", \" site-wide restriction on non-authenticated users.\\n\\n```\\n<location path=\\\"/admin\\\">\\n <system.web>\\n <aut\", \"horization>\\n <allow roles=\\\"Administrators\\\" />\\n <deny users=\\\"*\\\" />\\n </authorization>\\n </system.web>\\n<\", \"/location>\\n```\\n\\nThe above configuration, when combined with the others, restricts access to the /adm\", \"in folder and all resources within it to members of the \\\"Administrators\\\" role. This restriction coul\", \"d also be applied by placing a separate web.config file within the /admin folder root.\\n\\n#### <span i\", \"d=\\\"page-74-0\\\"></span>**Authorization code in Web Forms**\\n\\nIn addition to configuring access using we\", \"b.config, you can also programmatically configure access and behavior in your Web Forms application.\", \" For instance, you can restrict the ability to perform certain operations or view certain data based\", \" on the user's role.\\n\\nThis code can be used both in code-behind logic as well as in the page itself:\", \"\\n\\n```\\n<% if (HttpContext.Current.User.IsInRole(\\\"Administrators\\\")) { %>\\n <a href=\\\"/admin\\\">Go To Admin\", \"</a>\\n<% } %>\\n```\\n\\nIn addition to checking user role membership, you can also determine if they are a\", \"uthenticated (though often this is better done using the location-based configuration covered above)\", \". Below is an example of this approach.\\n\\n```\\nprotected void Page_Load(object sender, EventArgs e)\\n{\\n\", \" if (!User.Identity.IsAuthenticated)\\n {\\n FormsAuthentication.RedirectToLoginPage();\\n }\\n if (!Roles.I\", \"sUserInRole(User.Identity.Name, \\\"Administrators\\\"))\\n {\\n MessageLabel.Text = \\\"Only administrators can \", \"view this.\\\";\\n SecretPanel.Visible = false;\\n }\\n}\\n```\\n\\nIn the code above, role-based access control (R\", \"BAC) is used to determine whether certain elements of the page, such as a SecretPanel, are visible b\", \"ased on the current user's role.\\n\\nTypically, ASP.NET Web Forms applications configure security withi\", \"n the web.config file and then add additional checks where needed in .aspx pages and their related .\", \"aspx.cs code-behind files. Most applications leverage the universal membership provider, frequently \", \"with the additional role provider.\\n\\n# <span id=\\\"page-75-0\\\"></span>ASP.NET Core Identity\\n\\nAlthough st\", \"ill tasked with authentication and authorization, ASP.NET Core Identity uses a different set of abst\", \"ractions and assumptions when compared to the universal providers. For example, the new Identity mod\", \"el supports third party authentication, allowing users to authenticate using a social media account \", \"or other trusted authentication provider. ASP.NET Core Identity supports UI for commonly needed page\", \"s like login, logout, and register. It leverages EF Core for its data access, and uses EF Core migra\", \"tions to generate the necessary schema required to support its data model. This [introduction to](ht\", \"tps://docs.microsoft.com/aspnet/core/security/authentication/identity)  [Identity on ASP.NET Core](h\", \"ttps://docs.microsoft.com/aspnet/core/security/authentication/identity) provides a good overview of \", \"what is included with ASP.NET Core Identity and how to get started working with it. If you haven't a\", \"lready set up ASP.NET Core Identity in your application and its database, it will help you get start\", \"ed.\\n\\n#### <span id=\\\"page-75-1\\\"></span>**Roles, claims, and policies**\\n\\nBoth the universal providers \", \"and ASP.NET Core Identity support the concept of roles. You can create roles for users and assign us\", \"ers to roles. Users can belong to any number of roles, and you can verify role membership as part of\", \" your authorization implementation.\\n\\nIn addition to roles, ASP.NET Core identity supports the concep\", \"ts of claims and policies. While a role should specifically correspond to a set of resources a user \", \"in that role should be able to access, a claim is simply part of a user's identity. A claim is a nam\", \"e value pair that represents what the subject is, not what the subject can do.\\n\\nIt is possible to di\", \"rectly inspect a user's claims and determine based on these values whether a user should be given ac\", \"cess to a resource. However, such checks are often repetitive and scattered throughout the system. A\", \" better approach is to define a *policy*.\\n\\nAn authorization policy consists of one or more requireme\", \"nts. Policies are registered as part of the authorization service configuration in the ConfigureServ\", \"ices method of Startup.cs. For example, the following code snippet configures a policy called \\\"Canad\", \"iansOnly\\\", which has the requirement that the user has the Country claim with the value of \\\"Canada\\\".\", \"\\n\\n```\\nservices.AddAuthorization(options =>\\n{\\n options.AddPolicy(\\\"CanadiansOnly\\\", policy => policy.Re\", \"quireClaim(ClaimTypes.Country,\\n\\\"Canada\\\"));\\n});\\n```\\n\\nYou can [learn more about how to create custom p\", \"olicies in the documentation.](https://docs.microsoft.com/aspnet/core/security/authorization/policie\", \"s)\\n\\nWhether you're using policies or roles, you can specify that a particular page in your Blazor ap\", \"plication requires that role or policy with the [Authorize] attribute, applied with the @attribute d\", \"irective.\\n\\nRequiring a role:\\n\\n```\\n@attribute [Authorize(Roles =\\\"administrators\\\")]\\n```\\n\\nRequiring a p\", \"olicy be satisfied:\\n\\n```\\n@attribute [Authorize(Policy =\\\"CanadiansOnly\\\")]\\n```\\n\\nIf you need access to \", \"a user's authentication state, roles, or claims in your code, there are two primary ways to achieve \", \"this functionality. The first is to receive the authentication state as a cascading parameter. The s\", \"econd is to access the state using an injected AuthenticationStateProvider. The details of each of t\", \"hese approaches are described in the [Blazor Security documentation.](https://docs.microsoft.com/asp\", \"net/core/blazor/security/)\\n\\nThe following code shows how to receive the AuthenticationState as a cas\", \"cading parameter:\\n\\n```\\n[CascadingParameter]\\nprivate Task<AuthenticationState> authenticationStateTas\", \"k { get; set; }\\n```\\n\\nWith this parameter in place, you can get the user using this code:\\n\\n```\\nvar au\", \"thState = await authenticationStateTask;\\nvar user = authState.User;\\n```\\n\\nThe following code shows ho\", \"w to inject the AuthenticationStateProvider:\\n\\n```\\n@using Microsoft.AspNetCore.Components.Authorizati\", \"on\\n@inject AuthenticationStateProvider AuthenticationStateProvider\\n```\\n\\nWith the provider in place, \", \"you can gain access to the user with the following code:\\n\\n```\\nAuthenticationState authState = await \", \"\\nAuthenticationStateProvider.GetAuthenticationStateAsync();\\nClaimsPrincipal user = authState.User;\\ni\", \"f (user.Identity.IsAuthenticated)\\n{\\n // work with user.Claims and/or user.Roles\\n}\\n```\\n\\n**Note:** The\", \" AuthorizeView component, covered later in this chapter, provides a declarative way to control what \", \"a user sees on a page or component.\\n\\nTo work with users and claims (in Blazor Server applications) y\", \"ou may also need to inject a UserManager<T> (use IdentityUser for default) which you can use to enum\", \"erate and modify claims for a user. First inject the type and assign it to a property:\\n\\n```\\n@inject \", \"UserManager<IdentityUser> MyUserManager\\n```\\n\\nThen use it to work with the user's claims. The followi\", \"ng sample shows how to add and persist a claim on a user:\\n\\n```\\nprivate async Task AddCountryClaim()\\n\", \"{\\n var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();\\n var user = auth\", \"State.User;\\n var identityUser = await MyUserManager.FindByNameAsync(user.Identity.Name);\\n if (!user.\", \"HasClaim(c => c.Type == ClaimTypes.Country))\\n {\\n```\\n\\n```\\n // stores the claim in the cookie\\n ClaimsI\", \"dentity id = new ClaimsIdentity();\\n id.AddClaim(new Claim(ClaimTypes.Country, \\\"Canada\\\"));\\n user.AddI\", \"dentity(id);\\n // save the claim in the database\\n await MyUserManager.AddClaimAsync(identityUser, new\", \" Claim(ClaimTypes.Country,\\n\\\"Canada\\\"));\\n }\\n}\\n```\\n\\nIf you need to work with roles, follow the same app\", \"roach. You may need to inject a RoleManager<T> (use IdentityRole for default type) to list and manag\", \"e the roles themselves.\\n\\n**Note:** In Blazor WebAssembly projects, you will need to provide server A\", \"PIs to perform these operations (instead of using UserManager<T> or RoleManager<T> directly). A Blaz\", \"or WebAssembly client application would manage claims and/or roles by securely calling API endpoints\", \" exposed for this purpose.\\n\\n#### <span id=\\\"page-77-0\\\"></span>**Migration guide**\\n\\nMigrating from ASP\", \".NET Web Forms and universal providers to ASP.NET Core Identity requires several steps:\\n\\n- 1. Create\", \" ASP.NET Core Identity database schema in the destination database\\n- 2. Migrate data from universal \", \"provider schema to ASP.NET Core Identity schema\\n- 3. Migrate configuration from the web.config to mi\", \"ddleware and services, typically in *Program.cs* (or a Startup class)\\n- 4. Update individual pages u\", \"sing controls and conditionals to use tag helpers and new identity APIs.\\n\\nEach of these steps is des\", \"cribed in detail in the following sections.\\n\\n#### <span id=\\\"page-77-1\\\"></span>**Creating the ASP.NET\", \" Core Identity schema**\\n\\nThere are several ways to create the necessary table structure used for ASP\", \".NET Core Identity. The simplest is to create a new ASP.NET Core Web application. Choose Web Applica\", \"tion and then change Authentication type to use Individual Accounts.\\n\\n![](_page_78_Figure_0.jpeg)\\n\\nF\", \"rom the command line, you can do the same thing by running dotnet new webapp -au Individual. Once th\", \"e app has been created, run it and register on the site. You should trigger a page like the one show\", \"n below:\\n\\n![](_page_79_Figure_0.jpeg)\\n\\n#### A database operation failed while processing the request\", \".\\n\\nSqlException: Cannot open database \\\"aspnet-WebApplication10-53bc9b9d-9d6a-45d4-8429-2a2761773502\\\"\", \" requested by the login. The login failed. Login failed for user 'NIGHTKING\\\\steve'.\\n\\n#### Applying e\", \"xisting migrations for ApplicationDbContext may resolve this issue\\n\\nThere are migrations for Applica\", \"tionDbContext that have not been applied to the database\\n\\n\\u2022 00000000000000\\\\_CreateIdentitySchema\\n\\n##\", \"## Apply Migrations\\n\\nIn Visual Studio, you can use the Package Manager Console to apply pending migr\", \"ations to the database:\\n\\nPM> Update-Database\\n\\nAlternatively, you can apply pending migrations from a\", \" command prompt at your project directory:\\n\\n> dotnet ef database update\\n\\nClick on the \\\"Apply Migrati\", \"ons\\\" button and the necessary database tables should be created for you. In addition, the migration \", \"files should appear in your project, as shown:\\n\\n![](_page_80_Figure_0.jpeg)\\n\\nYou can run the migrati\", \"on yourself, without running the web application, using this command-line tool:\\n\\n#### dotnet ef data\", \"base update\\n\\nIf you would rather run a script to apply the new schema to an existing database, you c\", \"an script these migrations from the command-line. Run this command to generate the script:\\n\\n```\\ndotn\", \"et ef migrations script -o auth.sql\\n```\\n\\nThe above command will produce a SQL script in the output f\", \"ile auth.sql, which can then be run against whatever database you like. If you have any trouble runn\", \"ing dotnet ef commands, [make sure](https://docs.microsoft.com/ef/core/miscellaneous/cli/dotnet)  [y\", \"ou have the EF Core tools installed on your system.](https://docs.microsoft.com/ef/core/miscellaneou\", \"s/cli/dotnet)\\n\\nIn the event you have additional columns on your source tables, you will need to iden\", \"tify the best location for these columns in the new schema. Generally, columns found on the aspnet\\\\_\", \"Membership table should be mapped to the AspNetUsers table. Columns on aspnet\\\\_Roles should be mappe\", \"d to AspNetRoles. Any additional columns on the aspnet\\\\_UsersInRoles table would be added to the Asp\", \"NetUserRoles table.\\n\\nIt's also worth considering putting any additional columns on separate tables. \", \"So that future migrations won't need to take into account such customizations of the default identit\", \"y schema.\\n\\n#### <span id=\\\"page-80-0\\\"></span>**Migrating data from universal providers to ASP.NET Cor\", \"e Identity**\\n\\nOnce you have the destination table schema in place, the next step is to migrate your \", \"user and role records to the new schema. A complete list of the schema differences, including which \", \"columns map to which new columns, can be found [here.](https://docs.microsoft.com/aspnet/core/migrat\", \"ion/proper-to-2x/membership-to-core-identity)\\n\\nTo migrate your users from membership to the new iden\", \"tity tables, you should [follow the steps](https://docs.microsoft.com/aspnet/core/migration/proper-t\", \"o-2x/membership-to-core-identity)  [described in the documentation.](https://docs.microsoft.com/aspn\", \"et/core/migration/proper-to-2x/membership-to-core-identity) After following these steps and the scri\", \"pt provided, your users will need to change their password the next time they log in.\\n\\nIt is possibl\", \"e to migrate user passwords but the process is much more involved. Requiring users to update their p\", \"asswords as part of the migration process, and encouraging them to use new, unique passwords, is lik\", \"ely to enhance the overall security of the application.\\n\\n#### <span id=\\\"page-81-0\\\"></span>**Migratin\", \"g security settings from web.config to app startup**\\n\\nAs noted above, ASP.NET membership and role pr\", \"oviders are configured in the application's web.config file. Since ASP.NET Core apps are not tied to\", \" IIS and use a separate system for configuration, these settings must be configured elsewhere. For t\", \"he most part, ASP.NET Core Identity is configured in the *Program.cs* file. Open the web project tha\", \"t was created earlier (to generate the identity table schema) and review its *Program.cs* (or *Start\", \"up.cs*) file.\\n\\nThis code adds support for EF Core and Identity:\\n\\n```\\n// Add services to the containe\", \"r.\\nvar connectionString = builder.Configuration.GetConnectionString(\\\"DefaultConnection\\\");\\nbuilder.Se\", \"rvices.AddDbContext<ApplicationDbContext>(options =>\\n options.UseSqlServer(connectionString));\\nbuild\", \"er.Services.AddDatabaseDeveloperPageExceptionFilter();\\nbuilder.Services.AddDefaultIdentity<IdentityU\", \"ser>(options =>\\n options.SignIn.RequireConfirmedAccount = true)\\n .AddEntityFrameworkStores<Applicati\", \"onDbContext>();\\n```\\n\\nThe AddDefaultIdentity extension method is used to configure Identity to use th\", \"e default ApplicationDbContext and the framework's IdentityUser type. If you're using a custom Ident\", \"ityUser, be sure to specify its type here. If these extension methods aren't working in your applica\", \"tion, check that you have the appropriate using statements and that you have the necessary NuGet pac\", \"kage references. For example, your project should have some version of the Microsoft.AspNetCore.Iden\", \"tity.EntityFrameworkCore and Microsoft.AspNetCore.Identity.UI packages referenced.\\n\\nAlso in *Program\", \".cs* you should see the necessary middleware configured for the site. Specifically, UseAuthenticatio\", \"n and UseAuthorization should be set up, and in the proper location.\\n\\n```\\n// Configure the HTTP requ\", \"est pipeline.\\nif (app.Environment.IsDevelopment())\\n{\\n app.UseMigrationsEndPoint();\\n}\\nelse\\n{\\n app.Use\", \"ExceptionHandler(\\\"/Error\\\");\\n // The default HSTS value is 30 days. You may want to change this for p\", \"roduction \\nscenarios, see https://aka.ms/aspnetcore-hsts.\\n app.UseHsts();\\n}\\napp.UseHttpsRedirection(\", \");\\napp.UseStaticFiles();\\n```\\n\\n```\\napp.UseRouting();\\napp.UseAuthentication();\\napp.UseAuthorization();\", \"\\n//app.MapControllers();\\napp.MapBlazorHub();\\napp.MapFallbackToPage(\\\"/_Host\\\");\\n```\\n\\nASP.NET Identity \", \"does not configure anonymous or role-based access to locations from *Program.cs*. You will need to m\", \"igrate any location-specific authorization configuration data to filters in ASP.NET Core. Make note \", \"of which folders and pages will require such updates. You will make these changes in the next sectio\", \"n.\\n\\n#### <span id=\\\"page-82-0\\\"></span>**Updating individual pages to use ASP.NET Core Identity abstra\", \"ctions**\\n\\nIn your ASP.NET Web Forms application, if you had web.config settings to deny access to ce\", \"rtain pages or folders to anonymous users, you would migrate these changes by adding the [Authorize]\", \" attribute to such pages:\\n\\n```\\n@attribute [Authorize]\\n```\\n\\nIf you further had denied access except t\", \"o those users belonging to a certain role, you would likewise migrate this behavior by adding an att\", \"ribute specifying a role:\\n\\n```\\n@attribute [Authorize(Roles =\\\"administrators\\\")]\\n```\\n\\nThe [Authorize] \", \"attribute only works on @page components that are reached via the Blazor Router. The attribute does \", \"not work with child components, which should instead use AuthorizeView.\\n\\nIf you have logic within pa\", \"ge markup for determining whether to display some code to a certain user, you can replace this with \", \"the AuthorizeView component. The [AuthorizeView component](https://docs.microsoft.com/aspnet/core/bl\", \"azor/security#authorizeview-component) selectively displays UI depending on whether the user is auth\", \"orized to see it. It also exposes a context variable that can be used to access user information.\\n\\n`\", \"``\\n<AuthorizeView>\\n <Authorized>\\n <h1>Hello, @context.User.Identity.Name!</h1>\\n <p>You can only see \", \"this content if you are authenticated.</p>\\n </Authorized>\\n <NotAuthorized>\\n <h1>Authentication Failu\", \"re!</h1>\\n <p>You are not signed in.</p>\\n </NotAuthorized>\\n</AuthorizeView>\\n```\\n\\nYou can access the a\", \"uthentication state within procedural logic by accessing the user from a Task<AuthenticationState co\", \"nfigured with the [CascadingParameter] attribute. This configuration will get you access to the user\", \", which can let you determine if they are authenticated and if they belong to a particular role. If \", \"you need to evaluate a policy procedurally, you can inject an instance of the IAuthorizationService \", \"and calls the AuthorizeAsync method on it. The following sample code demonstrates how to get user in\", \"formation and allow an authorized user to perform a task restricted by the content-editor policy.\\n\\n`\", \"``\\n@using Microsoft.AspNetCore.Authorization\\n@inject IAuthorizationService AuthorizationService\\n<but\", \"ton @onclick=\\\"@DoSomething\\\">Do something important</button>\\n@code {\\n [CascadingParameter]\\n private T\", \"ask<AuthenticationState> authenticationStateTask { get; set; }\\n private async Task DoSomething()\\n {\\n\", \" var user = (await authenticationStateTask).User;\\n if (user.Identity.IsAuthenticated)\\n {\\n // Perform\", \" an action only available to authenticated (signed-in) users.\\n }\\n if (user.IsInRole(\\\"admin\\\"))\\n {\\n //\", \" Perform an action only available to users in the 'admin' role.\\n }\\n if ((await AuthorizationService.\", \"AuthorizeAsync(user, \\\"content-editor\\\"))\\n .Succeeded)\\n {\\n // Perform an action only available to user\", \"s satisfying the\\n // 'content-editor' policy.\\n }\\n }\\n}\\n```\\n\\nThe AuthenticationState first need to be \", \"set up as a cascading value before it can be bound to a cascading parameter like this. That's typica\", \"lly done using the CascadingAuthenticationState component. This configuration is typically done in A\", \"pp.razor:\\n\\n```\\n<CascadingAuthenticationState>\\n <Router AppAssembly=\\\"@typeof(Program).Assembly\\\">\\n <Fo\", \"und Context=\\\"routeData\\\">\\n <AuthorizeRouteView RouteData=\\\"@routeData\\\"\\n DefaultLayout=\\\"@typeof(MainLay\", \"out)\\\" />\\n </Found>\\n <NotFound>\\n <LayoutView Layout=\\\"@typeof(MainLayout)\\\">\\n <p>Sorry, there's nothing\", \" at this address.</p>\\n </LayoutView>\\n </NotFound>\\n </Router>\\n</CascadingAuthenticationState>\\n```\\n\\n##\", \"# <span id=\\\"page-83-0\\\"></span>Summary\\n\\nBlazor uses the same security model as ASP.NET Core, which is\", \" ASP.NET Core Identity. Migrating from universal providers to ASP.NET Core Identity is relatively st\", \"raightforward, assuming not too much customization was applied to the original data schema. Once the\", \" data has been migrated, working\\n\\nwith authentication and authorization in Blazor apps is well docum\", \"ented, with configurable as well as programmatic support for most security requirements.\\n\\n#### <span\", \" id=\\\"page-84-0\\\"></span>References\\n\\n- [Introduction to Identity on ASP.NET Core](https://docs.microso\", \"ft.com/aspnet/core/security/authentication/identity)\\n- [Migrate from ASP.NET Membership authenticati\", \"on to ASP.NET Core 2.0 Identity](https://docs.microsoft.com/aspnet/core/migration/proper-to-2x/membe\", \"rship-to-core-identity)\\n- [Migrate Authentication and Identity to ASP.NET Core](https://docs.microso\", \"ft.com/aspnet/core/migration/identity)\\n- [ASP.NET Core Blazor authentication and authorization](http\", \"s://docs.microsoft.com/aspnet/core/blazor/security/)\\n\\n# <span id=\\\"page-85-0\\\"></span>Migrate from ASP\", \".NET Web Forms to Blazor\\n\\nMigrating a code base from ASP.NET Web Forms to Blazor is a time-consuming\", \" task that requires planning. This chapter outlines the process. Something that can ease the transit\", \"ion is to ensure the app adheres to an *N-tier* architecture, wherein the app model (in this case, W\", \"eb Forms) is separate from the business logic. This logical separation of layers makes it clear what\", \" needs to move to .NET Core and Blazor.\\n\\nFor this example, the eShop app available on [GitHub](https\", \"://github.com/dotnet-architecture/eShopOnBlazor) is used. eShop is a catalog service that provides C\", \"RUD capabilities via form entry and validation.\\n\\nWhy should a working app be migrated to Blazor? Man\", \"y times, there's no need. ASP.NET Web Forms will continue to be supported for many years. However, m\", \"any of the features that Blazor provides are only supported on a migrated app. Such features include\", \":\\n\\n- Performance improvements in the framework such as Span<T>\\n- Ability to run as WebAssembly\\n- Cro\", \"ss-platform support for Linux and macOS\\n- App-local deployment or shared framework deployment withou\", \"t impacting other apps\\n\\nIf these or other new features are compelling enough, there may be value in \", \"migrating the app. The migration can take different shapes; it can be the entire app, or only certai\", \"n endpoints that require the changes. The decision to migrate is ultimately based on the business pr\", \"oblems to be solved by the developer.\\n\\n#### <span id=\\\"page-85-1\\\"></span>Server-side versus client-si\", \"de hosting\\n\\nAs described in the [hosting models](#page-15-0) chapter, a Blazor app can be hosted in \", \"two different ways: serverside and client-side. The server-side model uses ASP.NET Core SignalR conn\", \"ections to manage the DOM updates while running any actual code on the server. The client-side model\", \" runs as WebAssembly within a browser and requires no server connections. There are a number of diff\", \"erences that may affect which is best for a specific app:\\n\\n- Running as WebAssembly doesn't support \", \"all features (such as threading) at the current time\\n- Chatty communication between the client and s\", \"erver may cause latency issues in server-side mode\\n\\n\\u2022 Access to databases and internal or protected \", \"services require a separate service with clientside hosting\\n\\nAt the time of writing, the server-side\", \" model more closely resembles Web Forms. Most of this chapter focuses on the server-side hosting mod\", \"el, as it's production-ready.\\n\\n# <span id=\\\"page-86-0\\\"></span>Create a new project\\n\\nThis initial migr\", \"ation step is to create a new project. This project type is based on the SDK style projects of .NET \", \"and simplifies much of the boilerplate that was used in previous project formats. For more detail, p\", \"lease see the chapter on [Project Structure.](#page-19-0)\\n\\nOnce the project has been created, instal\", \"l the libraries that were used in the previous project. In older Web Forms projects, you may have us\", \"ed the *packages.config* file to list the required NuGet packages. In the new SDK-style project, *pa\", \"ckages.config* has been replaced with <PackageReference> elements in the project file. A benefit to \", \"this approach is that all dependencies are installed transitively. You only list the top-level depen\", \"dencies you care about.\\n\\nMany of the dependencies you're using are available for .NET, including Ent\", \"ity Framework 6 and log4net. If there's no .NET or .NET Standard version available, the .NET Framewo\", \"rk version can often be used. Your mileage may vary. Any API used that isn't available in .NET cause\", \"s a runtime error. Visual Studio notifies you of such packages. A yellow icon appears on the project\", \"'s **References** node in **Solution Explorer**.\\n\\nIn the Blazor-based eShop project, you can see the\", \" packages that are installed. Previously, the *packages.config* file listed every package used in th\", \"e project, resulting in a file almost 50 lines long. A snippet of *packages.config* is:\\n\\n```\\n<?xml v\", \"ersion=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<packages>\\n ...\\n <package id=\\\"Microsoft.ApplicationInsights.Agent.In\", \"tercept\\\" version=\\\"2.4.0\\\"\\ntargetFramework=\\\"net472\\\" />\\n <package id=\\\"Microsoft.ApplicationInsights.Dep\", \"endencyCollector\\\" version=\\\"2.9.1\\\"\\ntargetFramework=\\\"net472\\\" />\\n <package id=\\\"Microsoft.ApplicationIns\", \"ights.PerfCounterCollector\\\" version=\\\"2.9.1\\\"\\ntargetFramework=\\\"net472\\\" />\\n <package id=\\\"Microsoft.Appl\", \"icationInsights.Web\\\" version=\\\"2.9.1\\\" targetFramework=\\\"net472\\\"\\n/>\\n <package id=\\\"Microsoft.Application\", \"Insights.WindowsServer\\\" version=\\\"2.9.1\\\"\\ntargetFramework=\\\"net472\\\" />\\n  <package id=\\\"Microsoft.Applica\", \"tionInsights.WindowsServer.TelemetryChannel\\\"\\nversion=\\\"2.9.1\\\" targetFramework=\\\"net472\\\" />\\n <package i\", \"d=\\\"Microsoft.AspNet.FriendlyUrls\\\" version=\\\"1.0.2\\\" targetFramework=\\\"net472\\\" />\\n <package id=\\\"Microsof\", \"t.AspNet.FriendlyUrls.Core\\\" version=\\\"1.0.2\\\" targetFramework=\\\"net472\\\"\\n/>\\n <package id=\\\"Microsoft.AspN\", \"et.ScriptManager.MSAjax\\\" version=\\\"5.0.0\\\"\\ntargetFramework=\\\"net472\\\" />\\n <package id=\\\"Microsoft.AspNet.\", \"ScriptManager.WebForms\\\" version=\\\"5.0.0\\\"\\ntargetFramework=\\\"net472\\\" />\\n ...\\n <package id=\\\"System.Memory\", \"\\\" version=\\\"4.5.1\\\" targetFramework=\\\"net472\\\" />\\n <package id=\\\"System.Numerics.Vectors\\\" version=\\\"4.4.0\\\"\", \" targetFramework=\\\"net472\\\" />\\n <package id=\\\"System.Runtime.CompilerServices.Unsafe\\\" version=\\\"4.5.0\\\"\\n`\", \"``\\n\\n```\\ntargetFramework=\\\"net472\\\" />\\n <package id=\\\"System.Threading.Channels\\\" version=\\\"4.5.0\\\" targetF\", \"ramework=\\\"net472\\\" />\\n <package id=\\\"System.Threading.Tasks.Extensions\\\" version=\\\"4.5.1\\\" targetFramewor\", \"k=\\\"net472\\\"\\n/>\\n <package id=\\\"WebGrease\\\" version=\\\"1.6.0\\\" targetFramework=\\\"net472\\\" />\\n</packages>\\n```\\n\\n\", \"The <packages> element includes all necessary dependencies. It's difficult to identify which of thes\", \"e packages are included because you require them. Some <package> elements are listed simply to satis\", \"fy the needs of dependencies you require.\\n\\nThe Blazor project lists the dependencies you require wit\", \"hin an <ItemGroup> element in the project file:\\n\\n```\\n<ItemGroup>\\n <PackageReference Include=\\\"Autofac\", \"\\\" Version=\\\"4.9.3\\\" />\\n <PackageReference Include=\\\"EntityFramework\\\" Version=\\\"6.4.4\\\" />\\n <PackageRefere\", \"nce Include=\\\"log4net\\\" Version=\\\"2.0.12\\\" />\\n <PackageReference Include=\\\"Microsoft.Extensions.Logging.L\", \"og4Net.AspNetCore\\\"\\nVersion=\\\"2.2.12\\\" />\\n</ItemGroup>\\n```\\n\\nOne NuGet package that simplifies the life \", \"of Web Forms developers is the [Windows Compatibility](https://docs.microsoft.com/en-us/dotnet/core/\", \"porting/windows-compat-pack)  [Pack.](https://docs.microsoft.com/en-us/dotnet/core/porting/windows-c\", \"ompat-pack) Although .NET is cross-platform, some features are only available on Windows. Windowsspe\", \"cific features are made available by installing the compatibility pack. Examples of such features in\", \"clude the Registry, WMI, and Directory Services. The package adds around 20,000 APIs and activates m\", \"any services with which you may already be familiar. The eShop project doesn't require the compatibi\", \"lity pack; but if your projects use Windows-specific features, the package eases the migration effor\", \"ts.\\n\\n### <span id=\\\"page-87-0\\\"></span>Enable startup process\\n\\nThe startup process for Blazor has chan\", \"ged from Web Forms and follows a similar setup for other ASP.NET Core services. When hosted server-s\", \"ide, Razor components are run as part of a normal ASP.NET Core app. When hosted in the browser with \", \"WebAssembly, Razor components use a similar hosting model. The difference is the components are run \", \"as a separate service from any of the backend processes. Either way, the startup is similar.\\n\\nThe *G\", \"lobal.asax.cs* file is the default startup page for Web Forms projects. In the eShop project, this f\", \"ile configures the Inversion of Control (IoC) container and handles the various lifecycle events of \", \"the app or request. Some of these events are handled with middleware (such as Application\\\\_BeginRequ\", \"est). Other events require the overriding of specific services via dependency injection (DI).\\n\\nBy wa\", \"y of example, the *Global.asax.cs* file for eShop, contains the following code:\\n\\n```\\npublic class Gl\", \"obal : HttpApplication, IContainerProviderAccessor\\n{\\n private static readonly ILog _log =\\nLogManager\", \".GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);\\n static IContainerProvide\", \"r _containerProvider;\\n IContainer container;\\n```\\n\\n```\\n public IContainerProvider ContainerProvider\\n \", \"{\\n get { return _containerProvider; }\\n }\\n protected void Application_Start(object sender, EventArgs \", \"e)\\n {\\n // Code that runs on app startup\\n RouteConfig.RegisterRoutes(RouteTable.Routes);\\n BundleConfi\", \"g.RegisterBundles(BundleTable.Bundles);\\n ConfigureContainer();\\n ConfigDataBase();\\n }\\n /// <summary>\\n\", \" /// Track the machine name and the start time for the session inside the current \\nsession\\n /// </su\", \"mmary>\\n protected void Session_Start(Object sender, EventArgs e)\\n {\\n HttpContext.Current.Session[\\\"Ma\", \"chineName\\\"] = Environment.MachineName;\\n HttpContext.Current.Session[\\\"SessionStartTime\\\"] = DateTime.N\", \"ow;\\n }\\n /// <summary>\\n /// https://autofaccn.readthedocs.io/en/latest/integration/webforms.html\\n ///\", \" </summary>\\n private void ConfigureContainer()\\n {\\n var builder = new ContainerBuilder();\\n var mockDa\", \"ta = bool.Parse(ConfigurationManager.AppSettings[\\\"UseMockData\\\"]);\\n builder.RegisterModule(new Applic\", \"ationModule(mockData));\\n container = builder.Build();\\n _containerProvider = new ContainerProvider(co\", \"ntainer);\\n }\\n private void ConfigDataBase()\\n {\\n var mockData = bool.Parse(ConfigurationManager.AppSe\", \"ttings[\\\"UseMockData\\\"]);\\n if (!mockData)\\n {\\nDatabase.SetInitializer<CatalogDBContext>(container.Resol\", \"ve<CatalogDBInitializer>());\\n }\\n }\\n protected void Application_BeginRequest(object sender, EventArgs\", \" e)\\n {\\n //set the property to our new object\\n LogicalThreadContext.Properties[\\\"activityid\\\"] = new Ac\", \"tivityIdHelper();\\n LogicalThreadContext.Properties[\\\"requestinfo\\\"] = new WebRequestInfo();\\n _log.Debu\", \"g(\\\"Application_BeginRequest\\\");\\n }\\n}\\n```\\n\\nThe preceding file becomes the *Program.cs* file in server-\", \"side Blazor:\\n\\n```\\nusing eShopOnBlazor.Models;\\nusing eShopOnBlazor.Models.Infrastructure;\\nusing eShop\", \"OnBlazor.Services;\\nusing log4net;\\nusing System.Data.Entity;\\nusing eShopOnBlazor;\\nvar builder = WebAp\", \"plication.CreateBuilder(args);\\n// add services\\nbuilder.Services.AddRazorPages();\\nbuilder.Services.Ad\", \"dServerSideBlazor();\\nif (builder.Configuration.GetValue<bool>(\\\"UseMockData\\\"))\\n{\\n builder.Services.Ad\", \"dSingleton<ICatalogService, CatalogServiceMock>();\\n}\\nelse\\n{\\n builder.Services.AddScoped<ICatalogServ\", \"ice, CatalogService>();\\n builder.Services.AddScoped<IDatabaseInitializer<CatalogDBContext>,\\nCatalogD\", \"BInitializer>();\\n builder.Services.AddSingleton<CatalogItemHiLoGenerator>();\\n builder.Services.AddSc\", \"oped(_ => new\\nCatalogDBContext(builder.Configuration.GetConnectionString(\\\"CatalogDBContext\\\")));\\n}\\nva\", \"r app = builder.Build();\\nnew LoggerFactory().AddLog4Net(\\\"log4Net.xml\\\");\\nif (app.Environment.IsDevelo\", \"pment())\\n{\\n app.UseDeveloperExceptionPage();\\n}\\nelse\\n{\\n app.UseExceptionHandler(\\\"/Home/Error\\\");\\n}\\n// \", \"Middleware for Application_BeginRequest\\napp.Use((ctx, next) =>\\n{\\n LogicalThreadContext.Properties[\\\"a\", \"ctivityid\\\"] = new ActivityIdHelper(ctx);\\n LogicalThreadContext.Properties[\\\"requestinfo\\\"] = new WebRe\", \"questInfo(ctx);\\n return next();\\n});\\napp.UseStaticFiles();\\napp.UseRouting();\\napp.UseEndpoints(endpoin\", \"ts =>\\n{\\n endpoints.MapBlazorHub();\\n endpoints.MapFallbackToPage(\\\"/_Host\\\");\\n});\\nConfigDataBase(app);\\n\", \"```\\n\\n```\\nvoid ConfigDataBase(IApplicationBuilder app)\\n{\\n using (var scope = app.ApplicationServices.\", \"CreateScope())\\n {\\n var initializer =\\nscope.ServiceProvider.GetService<IDatabaseInitializer<CatalogDB\", \"Context>>();\\n if (initializer != null)\\n {\\n Database.SetInitializer(initializer);\\n }\\n }\\n}\\napp.Run();\\n\", \"```\\n\\nOne significant change you may notice from Web Forms is the prominence of dependency injection \", \"(DI). DI has been a guiding principle in the ASP.NET Core design. It supports customization of almos\", \"t all aspects of the ASP.NET Core framework. There's even a built-in service provider that can be us\", \"ed for many scenarios. If more customization is required, it can be supported by many community proj\", \"ects. For example, you can carry forward your third-party DI library investment.\\n\\nIn the original eS\", \"hop app, there's some configuration for session management. Since server-side Blazor uses ASP.NET Co\", \"re SignalR for communication, the session state isn't supported as the connections may occur indepen\", \"dent of an HTTP context. An app that uses the session state requires rearchitecting before running a\", \"s a Blazor app.\\n\\nFor more information about app startup, see [App startup.](#page-28-0)\\n\\n#### <span \", \"id=\\\"page-90-0\\\"></span>Migrate HTTP modules and handlers to middleware\\n\\nHTTP modules and handlers are\", \" common patterns in Web Forms to control the HTTP request pipeline. Classes that implement IHttpModu\", \"le or IHttpHandler could be registered and process incoming requests. Web Forms configure modules an\", \"d handlers in the *web.config* file. Web Forms is also heavily based on app lifecycle event handling\", \". ASP.NET Core uses middleware instead. Middleware is registered in the Configure method of the Star\", \"tup class. Middleware execution order is determined by the registration order.\\n\\nIn the [Enable start\", \"up process](#page-87-0) section, a lifecycle event was raised by Web Forms as the Application\\\\_Begin\", \"Request method. This event isn't available in ASP.NET Core. One way to achieve this behavior is to i\", \"mplement middleware as seen in the *Startup.cs* file example. This middleware does the same logic an\", \"d then transfers control to the next handler in the middleware pipeline.\\n\\nFor more information on mi\", \"grating modules and handlers, see [Migrate HTTP handlers and modules to](https://docs.microsoft.com/\", \"aspnet/core/migration/http-modules)  [ASP.NET Core middleware.](https://docs.microsoft.com/aspnet/co\", \"re/migration/http-modules)\\n\\n# <span id=\\\"page-91-0\\\"></span>Migrate static files\\n\\nTo serve static file\", \"s (for example, HTML, CSS, images, and JavaScript), the files must be exposed by middleware. Calling\", \" the UseStaticFiles method enables the serving of static files from the web root path. The default w\", \"eb root directory is *wwwroot*, but it can be customized. As included in the *Program.cs* file:\\n\\n```\", \"\\n...\\napp.UseStaticFiles();\\n...\\n```\\n\\nThe eShop project enables basic static file access. There are ma\", \"ny customizations available for static file access. For information on enabling default files or a f\", \"ile browser, see [Static files in ASP.NET Core.](https://docs.microsoft.com/aspnet/core/fundamentals\", \"/static-files)\\n\\n### <span id=\\\"page-91-1\\\"></span>Migrate runtime bundling and minification setup\\n\\nBun\", \"dling and minification are performance optimization techniques for reducing the number and size of s\", \"erver requests to retrieve certain file types. JavaScript and CSS often undergo some form of bundlin\", \"g or minification before being sent to the client. In ASP.NET Web Forms, these optimizations are han\", \"dled at run time. The optimization conventions are defined an *App\\\\_Start/BundleConfig.cs* file. In \", \"ASP.NET Core, a more declarative approach is adopted. A file lists the files to be minified, along w\", \"ith specific minification settings.\\n\\nFor more information on bundling and minification, see [Bundle \", \"and minify static assets in ASP.NET](https://docs.microsoft.com/aspnet/core/client-side/bundling-and\", \"-minification)  [Core.](https://docs.microsoft.com/aspnet/core/client-side/bundling-and-minification\", \")\\n\\n# <span id=\\\"page-91-2\\\"></span>Migrate ASPX pages\\n\\nA page in a Web Forms app is a file with the *.\", \"aspx* extension. A Web Forms page can often be mapped to a component in Blazor. A Razor component is\", \" authored in a file with the *.razor* extension. For the eShop project, five pages are converted to \", \"a Razor page.\\n\\nFor example, the details view comprises three files in the Web Forms project: *Detail\", \"s.aspx*, *Details.aspx.cs*, and *Details.aspx.designer.cs*. When converting to Blazor, the code-behi\", \"nd and markup are combined into *Details.razor*. Razor compilation (equivalent to what's in *.design\", \"er.cs* files) is stored in the *obj* directory and isn't, by default, viewable in **Solution Explore\", \"r**. The Web Forms page consists of the following markup:\\n\\n```\\n<%@ Page Title=\\\"Details\\\" Language=\\\"C#\", \"\\\" MasterPageFile=\\\"~/Site.Master\\\" \\nAutoEventWireup=\\\"true\\\" CodeBehind=\\\"Details.aspx.cs\\\" \\nInherits=\\\"eSh\", \"opLegacyWebForms.Catalog.Details\\\" %>\\n<asp:Content ID=\\\"Details\\\" ContentPlaceHolderID=\\\"MainContent\\\" ru\", \"nat=\\\"server\\\">\\n <h2 class=\\\"esh-body-title\\\">Details</h2>\\n <div class=\\\"container\\\">\\n <div class=\\\"row\\\">\\n`\", \"``\\n\\n```\\n <asp:Image runat=\\\"server\\\" CssClass=\\\"col-md-6 esh-picture\\\" ImageUrl='<%#\\\"/Pics/\\\" \\n+ product.\", \"PictureFileName%>' />\\n <dl class=\\\"col-md-6 dl-horizontal\\\">\\n <dt>Name\\n </dt>\\n <dd>\\n <asp:Label runat=\", \"\\\"server\\\" Text='<%#product.Name%>' />\\n </dd>\\n <dt>Description\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"server\\\"\", \" Text='<%#product.Description%>' />\\n </dd>\\n <dt>Brand\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"server\\\" Text='\", \"<%#product.CatalogBrand.Brand%>' />\\n </dd>\\n <dt>Type\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"server\\\" Text='<\", \"%#product.CatalogType.Type%>' />\\n </dd>\\n <dt>Price\\n </dt>\\n <dd>\\n <asp:Label CssClass=\\\"esh-price\\\" run\", \"at=\\\"server\\\" \\nText='<%#product.Price%>' />\\n </dd>\\n <dt>Picture name\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"s\", \"erver\\\" Text='<%#product.PictureFileName%>' />\\n </dd>\\n <dt>Stock\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"serv\", \"er\\\" Text='<%#product.AvailableStock%>' />\\n </dd>\\n <dt>Restock\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"server\", \"\\\" Text='<%#product.RestockThreshold%>' />\\n </dd>\\n <dt>Max stock\\n </dt>\\n```\\n\\n```\\n <dd>\\n <asp:Label ru\", \"nat=\\\"server\\\" Text='<%#product.MaxStockThreshold%>' />\\n </dd>\\n </dl>\\n </div>\\n <div class=\\\"form-action\", \"s no-color esh-link-list\\\">\\n <a runat=\\\"server\\\" href='<%# GetRouteUrl(\\\"EditProductRoute\\\", new {id \\n=pr\", \"oduct.Id}) %>' class=\\\"esh-link-item\\\">Edit\\n </a>\\n |\\n <a runat=\\\"server\\\" href=\\\"~\\\" class=\\\"esh-link-item\\\"\", \">Back to list\\n </a>\\n </div>\\n </div>\\n</asp:Content>\\n```\\n\\nThe preceding markup's code-behind includes \", \"the following code:\\n\\n```\\nusing eShopLegacyWebForms.Models;\\nusing eShopLegacyWebForms.Services;\\nusing\", \" log4net;\\nusing System;\\nusing System.Web.UI;\\nnamespace eShopLegacyWebForms.Catalog\\n{\\n public partial\", \" class Details : System.Web.UI.Page\\n {\\n private static readonly ILog _log =\\nLogManager.GetLogger(Sys\", \"tem.Reflection.MethodBase.GetCurrentMethod().DeclaringType);\\n protected CatalogItem product;\\n public\", \" ICatalogService CatalogService { get; set; }\\n protected void Page_Load(object sender, EventArgs e)\\n\", \" {\\n var productId = Convert.ToInt32(Page.RouteData.Values[\\\"id\\\"]);\\n _log.Info($\\\"Now loading... /Catal\", \"og/Details.aspx?id={productId}\\\");\\n product = CatalogService.FindCatalogItem(productId);\\n this.DataBi\", \"nd();\\n }\\n }\\n}\\n```\\n\\nWhen converted to Blazor, the Web Forms page translates to the following code:\\n\\n`\", \"``\\n@page \\\"/Catalog/Details/{id:int}\\\"\\n@inject ICatalogService CatalogService\\n@inject ILogger<Details>\", \" Logger\\n<h2 class=\\\"esh-body-title\\\">Details</h2>\\n<div class=\\\"container\\\">\\n <div class=\\\"row\\\">\\n```\\n\\n```\\n\", \" <img class=\\\"col-md-6 esh-picture\\\" src=\\\"@($\\\"/Pics/{_item.PictureFileName}\\\")\\\">\\n <dl class=\\\"col-md-6 d\", \"l-horizontal\\\">\\n <dt>\\n Name\\n </dt>\\n <dd>\\n @_item.Name\\n </dd>\\n <dt>\\n Description\\n </dt>\\n <dd>\\n @_item.\", \"Description\\n </dd>\\n <dt>\\n Brand\\n </dt>\\n <dd>\\n @_item.CatalogBrand.Brand\\n </dd>\\n <dt>\\n Type\\n </dt>\\n <\", \"dd>\\n @_item.CatalogType.Type\\n </dd>\\n <dt>\\n Price\\n </dt>\\n <dd>\\n @_item.Price\\n </dd>\\n <dt>\\n Picture na\", \"me\\n </dt>\\n <dd>\\n @_item.PictureFileName\\n </dd>\\n <dt>\\n Stock\\n </dt>\\n <dd>\\n @_item.AvailableStock\\n </d\", \"d>\\n <dt>\\n Restock\\n </dt>\\n```\\n\\n```\\n <dd>\\n @_item.RestockThreshold\\n </dd>\\n <dt>\\n Max stock\\n </dt>\\n <dd\", \">\\n @_item.MaxStockThreshold\\n </dd>\\n </dl>\\n </div>\\n <div class=\\\"form-actions no-color esh-link-list\\\">\", \"\\n <a href=\\\"@($\\\"/Catalog/Edit/{_item.Id}\\\")\\\" class=\\\"esh-link-item\\\">\\n Edit\\n </a>\\n |\\n <a href=\\\"/\\\" class=\", \"\\\"esh-link-item\\\">\\n Back to list\\n </a>\\n </div>\\n</div>\\n@code {\\n private CatalogItem _item;\\n [Parameter]\", \"\\n public int Id { get; set; }\\n protected override void OnInitialized()\\n {\\n Logger.LogInformation(\\\"No\", \"w loading... /Catalog/Details/{Id}\\\", Id);\\n _item = CatalogService.FindCatalogItem(Id);\\n }\\n}\\n```\\n\\nNot\", \"ice that the code and markup are in the same file. Any required services are made accessible with th\", \"e @inject attribute. Per the @page directive, this page can be accessed at the Catalog/Details/{id} \", \"route. The value of the route's {id} placeholder has been constrained to an integer. As described in\", \" the routing section, unlike Web Forms, a Razor component explicitly states its route and any parame\", \"ters that are included. Many Web Forms controls may not have exact counterparts in Blazor. There's o\", \"ften an equivalent HTML snippet that will serve the same purpose. For example, the <asp:Label /> con\", \"trol can be replaced with an HTML <label> element.\\n\\n#### <span id=\\\"page-95-0\\\"></span>**Model validat\", \"ion in Blazor**\\n\\nIf your Web Forms code includes validation, you can transfer much of what you have \", \"with little-to-no changes. A benefit to running in Blazor is that the same validation logic can be r\", \"un without needing custom JavaScript. Data annotations enable easy model validation.\\n\\nFor example, t\", \"he *Create.aspx* page has a data entry form with validation. An example snippet would look like this\", \":\\n\\n```\\n<div class=\\\"form-group\\\">\\n <label class=\\\"control-label col-md-2\\\">Name</label>\\n <div class=\\\"col\", \"-md-3\\\">\\n <asp:TextBox ID=\\\"Name\\\" runat=\\\"server\\\" CssClass=\\\"form-control\\\"></asp:TextBox>\\n <asp:Required\", \"FieldValidator runat=\\\"server\\\" ControlToValidate=\\\"Name\\\"\\nDisplay=\\\"Dynamic\\\"\\n CssClass=\\\"field-validation\", \"-valid text-danger\\\" ErrorMessage=\\\"The Name field is \\nrequired.\\\" />\\n </div>\\n</div>\\n```\\n\\nIn Blazor, th\", \"e equivalent markup is provided in a *Create.razor* file:\\n\\n```\\n<EditForm Model=\\\"_item\\\" OnValidSubmit\", \"=\\\"@...\\\">\\n <DataAnnotationsValidator />\\n <div class=\\\"form-group\\\">\\n <label class=\\\"control-label col-md\", \"-2\\\">Name</label>\\n <div class=\\\"col-md-3\\\">\\n <InputText class=\\\"form-control\\\" @bind-Value=\\\"_item.Name\\\" /\", \">\\n <ValidationMessage For=\\\"(() => _item.Name)\\\" />\\n </div>\\n </div>\\n ...\\n</EditForm>\\n```\\n\\nThe EditForm\", \" context includes validation support and can be wrapped around an input. Data annotations are a comm\", \"on way to add validation. Such validation support can be added via the DataAnnotationsValidator comp\", \"onent. For more information on this mechanism, see [ASP.NET Core](https://docs.microsoft.com/aspnet/\", \"core/blazor/forms-validation)  [Blazor forms and validation.](https://docs.microsoft.com/aspnet/core\", \"/blazor/forms-validation)\\n\\n# <span id=\\\"page-96-0\\\"></span>Migrate configuration\\n\\nIn a Web Forms proje\", \"ct, configuration data is most commonly stored in the *web.config* file. The configuration data is a\", \"ccessed with ConfigurationManager. Services were often required to parse objects. With .NET Framewor\", \"k 4.7.2, composability was added to the configuration via ConfigurationBuilders. These builders allo\", \"wed developers to add various sources for the configuration that was then composed at run time to re\", \"trieve the necessary values.\\n\\nASP.NET Core introduced a flexible configuration system that allows yo\", \"u to define the configuration source or sources used by your app and deployment. The ConfigurationBu\", \"ilder infrastructure that you may be using in your Web Forms app was modeled after the concepts used\", \" in the ASP.NET Core configuration system.\\n\\nThe following snippet demonstrates how the Web Forms eSh\", \"op project uses *web.config* to store configuration values:\\n\\n```\\n<configuration>\\n <configSections>\\n \", \"<section name=\\\"entityFramework\\\"\\n```\\n\\n```\\ntype=\\\"System.Data.Entity.Internal.ConfigFile.EntityFramewor\", \"kSection, EntityFramework, \\nVersion=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\\\"\\nrequi\", \"rePermission=\\\"false\\\" />\\n </configSections>\\n <connectionStrings>\\n <add name=\\\"CatalogDBContext\\\" connec\", \"tionString=\\\"Data Source=(localdb)\\\\MSSQLLocalDB; \\nInitial Catalog=Microsoft.eShopOnContainers.Service\", \"s.CatalogDb; Integrated Security=True; \\nMultipleActiveResultSets=True;\\\" providerName=\\\"System.Data.Sq\", \"lClient\\\" />\\n </connectionStrings>\\n <appSettings>\\n <add key=\\\"UseMockData\\\" value=\\\"true\\\" />\\n <add key=\\\"\", \"UseCustomizationData\\\" value=\\\"false\\\" />\\n </appSettings>\\n</configuration>\\n```\\n\\nIt's common for secrets\", \", such as database connection strings, to be stored within the *web.config*. The secrets are inevita\", \"bly persisted in unsecure locations, such as source control. With Blazor on ASP.NET Core, the preced\", \"ing XML-based configuration is replaced with the following JSON:\\n\\n```\\n{\\n \\\"ConnectionStrings\\\": {\\n \\\"Ca\", \"talogDBContext\\\": \\\"Data Source=(localdb)\\\\\\\\MSSQLLocalDB; Initial \\nCatalog=Microsoft.eShopOnContainers.\", \"Services.CatalogDb; Integrated Security=True; \\nMultipleActiveResultSets=True;\\\"\\n },\\n \\\"UseMockData\\\": t\", \"rue,\\n \\\"UseCustomizationData\\\": false\\n}\\n```\\n\\nJSON is the default configuration format; however, ASP.NE\", \"T Core supports many other formats, including XML. There are also several community-supported format\", \"s.\\n\\nYou can access configuration values from the builder in *Program.cs*:\\n\\n```\\nif (builder.Configura\", \"tion.GetValue<bool>(\\\"UseMockData\\\"))\\n{\\n builder.Services.AddSingleton<ICatalogService, CatalogService\", \"Mock>();\\n}\\nelse\\n{\\n builder.Services.AddScoped<ICatalogService, CatalogService>();\\n builder.Services.\", \"AddScoped<IDatabaseInitializer<CatalogDBContext>,\\nCatalogDBInitializer>();\\n builder.Services.AddSing\", \"leton<CatalogItemHiLoGenerator>();\\n builder.Services.AddScoped(_ => new\\nCatalogDBContext(builder.Con\", \"figuration.GetConnectionString(\\\"CatalogDBContext\\\")));\\n}\\n```\\n\\nBy default, environment variables, JSON\", \" files (*appsettings.json* and *appsettings.{Environment}.json*), and command-line options are regis\", \"tered as valid configuration sources in the configuration object. The configuration sources can be a\", \"ccessed via Configuration[key]. A more advanced technique is to bind the configuration data to objec\", \"ts using the options pattern. For more information on configuration and the options pattern, see [Co\", \"nfiguration in ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/configuration/) and\", \" [Options pattern in ASP.NET Core,](https://docs.microsoft.com/aspnet/core/fundamentals/configuratio\", \"n/options)  respectively.\\n\\n# <span id=\\\"page-98-0\\\"></span>Migrate data access\\n\\nData access is an impo\", \"rtant aspect of any app. The eShop project stores catalog information in a database and retrieves th\", \"e data with Entity Framework (EF) 6. Since EF 6 is supported in .NET 5, the project can continue to \", \"use it.\\n\\nThe following EF-related changes were necessary to eShop:\\n\\n- In .NET Framework, the DbConte\", \"xt object accepts a string of the form *name=ConnectionString* and uses the connection string from C\", \"onfigurationManager.AppSettings[ConnectionString] to connect. In .NET Core, this isn't supported. Th\", \"e connection string must be supplied.\\n- The database was accessed in a synchronous way. Though this \", \"works, scalability may suffer. This logic should be moved to an asynchronous pattern.\\n\\nAlthough ther\", \"e isn't the same native support for dataset binding, Blazor provides flexibility and power with its \", \"C# support in a Razor page. For example, you can perform calculations and display the result. For mo\", \"re information on data patterns in Blazor, see the [Data access](#page-59-0) chapter.\\n\\n#### <span id\", \"=\\\"page-98-1\\\"></span>Architectural changes\\n\\nFinally, there are some important architectural differenc\", \"es to consider when migrating to Blazor. Many of these changes are applicable to anything based on .\", \"NET Core or ASP.NET Core.\\n\\nBecause Blazor is built on .NET Core, there are considerations in ensurin\", \"g support on .NET Core. Some of the major changes include the removal of the following features:\\n\\n- \", \"Multiple AppDomains\\n- Remoting\\n- Code Access Security (CAS)\\n- Security Transparency\\n\\nFor more inform\", \"ation on techniques to identify necessary changes to support running on .NET Core, see [Port your co\", \"de from .NET Framework to .NET Core.](https://docs.microsoft.com/en-us/dotnet/core/porting/)\\n\\nASP.NE\", \"T Core is a reimagined version of ASP.NET and has some changes that may not initially seem obvious. \", \"The main changes are:\\n\\n- No synchronization context, which means there's no HttpContext.Current, Thr\", \"ead.CurrentPrincipal, or other static accessors\\n- No shadow copying\\n- No request queue\\n\\nMany operati\", \"ons in ASP.NET Core are asynchronous, which allows easier off-loading of I/O-bound tasks. It's impor\", \"tant to never block by using Task.Wait() or Task.GetResult(), which can quickly exhaust thread pool \", \"resources.\\n\\n# <span id=\\\"page-99-0\\\"></span>Migration conclusion\\n\\nAt this point, you've seen many exam\", \"ples of what it takes to move a Web Forms project to Blazor. For a full example, see the [eShopOnBla\", \"zor](https://github.com/dotnet-architecture/eShopOnBlazor) project.\"]"