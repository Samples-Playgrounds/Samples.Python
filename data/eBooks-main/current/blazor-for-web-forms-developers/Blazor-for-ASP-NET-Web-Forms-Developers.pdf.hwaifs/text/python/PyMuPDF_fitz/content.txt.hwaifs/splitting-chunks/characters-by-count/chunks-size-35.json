"[\" \\nEDITION v8.0 - Updated to .NET 8 \\nRefer to changelog for the book updates and community contributi\", \"ons. \\nPUBLISHED BY \\nMicrosoft Developer Division, .NET, and Visual Studio product teams \\nA division \", \"of Microsoft Corporation \\nOne Microsoft Way \\nRedmond, Washington 98052-6399 \\nCopyright \\u00a9 2023 by Mic\", \"rosoft Corporation \\nAll rights reserved. No part of the contents of this book may be reproduced or t\", \"ransmitted in any \\nform or by any means without the written permission of the publisher. \\nThis book \", \"is provided \\u201cas-is\\u201d and expresses the author\\u2019s views and opinions. The views, opinions, and \\ninforma\", \"tion expressed in this book, including URL and other Internet website references, may change \\nwithou\", \"t notice. \\nSome examples depicted herein are provided for illustration only and are fictitious. No r\", \"eal association \\nor connection is intended or should be inferred. \\nMicrosoft and the trademarks list\", \"ed at https://www.microsoft.com on the \\u201cTrademarks\\u201d webpage are \\ntrademarks of the Microsoft group o\", \"f companies. \\nMac and macOS are trademarks of Apple Inc. \\nAll other marks and logos are property of \", \"their respective owners. \\nAuthors: \\nDaniel Roth, Principal Program Manager, Microsoft Corp. \\nJeff Fr\", \"itz, Senior Program Manager, Microsoft Corp. \\nTaylor Southwick, Senior Software Engineer, Microsoft \", \"Corp. \\nScott Addie, Senior Content Developer, Microsoft Corp. \\nSteve \\u201c@ardalis\\u201d Smith, Software Arch\", \"itect and Trainer, NimblePros.com \\nIntroduction \\n.NET has long supported web app development through\", \" ASP.NET, a comprehensive set of frameworks \\nand tools for building any kind of web app. ASP.NET has\", \" its own lineage of web frameworks and \\ntechnologies starting all the way back with classic Active S\", \"erver Pages (ASP). Frameworks like ASP.NET \\nWeb Forms, ASP.NET MVC, ASP.NET Web Pages, and more rece\", \"ntly ASP.NET Core, provide a \\nproductive and powerful way to build server-rendered web apps, where U\", \"I content is dynamically \\ngenerated on the server in response to HTTP requests. Each ASP.NET framewo\", \"rk caters to a different \\naudience and app building philosophy. ASP.NET Web Forms shipped with the o\", \"riginal release of the \\n.NET Framework and enabled web development using many of the patterns famili\", \"ar to desktop \\ndevelopers, like reusable UI controls with simple event handling. However, none of th\", \"e ASP.NET \\nofferings provide a way to run code that executed in the user\\u2019s browser. To do that requi\", \"res writing \\nJavaScript and using any of the many JavaScript frameworks and tools that have phased i\", \"n and out of \\npopularity over the years: jQuery, Knockout, Angular, React, and so on. \\nBlazor is a n\", \"ew web framework that changes what is possible when building web apps with .NET. \\nBlazor is a client\", \"-side web UI framework based on C# instead of JavaScript. With Blazor you can write \\nyour client-sid\", \"e logic and UI components in C#, compile them into normal .NET assemblies, and then \\nrun them direct\", \"ly in the browser using a new open web standard called WebAssembly. Or \\nalternatively, Blazor can ru\", \"n your .NET UI components on the server and handle all UI interactions \\nfluidly over a real-time con\", \"nection with the browser. When paired with .NET running on the server, \\nBlazor enables full-stack we\", \"b development with .NET. While Blazor shares many commonalities with \\nASP.NET Web Forms, like having\", \" a reusable component model and a simple way to handle user \\nevents, it also builds on the foundatio\", \"ns of .NET to provide a modern and high-performance web \\ndevelopment experience. \\nThis book introduc\", \"es ASP.NET Web Forms developers to Blazor in a way that is familiar and \\nconvenient. It introduces B\", \"lazor concepts in parallel with analogous concepts in ASP.NET Web Forms \\nwhile also explaining new c\", \"oncepts that may be less familiar. It covers a broad range of topics and \\nconcerns including compone\", \"nt authoring, routing, layout, configuration, and security. And while the \\ncontent of this book is p\", \"rimarily for enabling new development, it also covers guidelines and \\nstrategies for migrating exist\", \"ing ASP.NET Web Forms to Blazor for when you want to modernize an \\nexisting app. \\nWho should use the\", \" book \\nThis book is for ASP.NET Web Forms developers looking for an introduction to Blazor that rela\", \"tes to \\ntheir existing knowledge and skills. This book can help with quickly getting started on a ne\", \"w Blazor-\\nbased project or to help chart a roadmap for modernizing an existing ASP.NET Web Forms \\nap\", \"plication. \\nHow to use the book \\nThe first part of this book covers what Blazor is and compares it t\", \"o web app development with \\nASP.NET Web Forms. The book then covers a variety of Blazor topics, chap\", \"ter by chapter, and relates \\neach Blazor concept to the corresponding concept in ASP.NET Web Forms, \", \"or explains fully any \\ncompletely new concepts. The book also refers regularly to a complete sample \", \"app implemented in \\nboth ASP.NET Web Forms and Blazor to demonstrate Blazor features and to provide \", \"a case study for \\nmigrating from ASP.NET Web Forms to Blazor. You can find both implementations of t\", \"he sample app \\n(ASP.NET Web Forms and Blazor versions) on GitHub. \\nWhat this book doesn\\u2019t cover \\nThi\", \"s book is an introduction to Blazor, not a comprehensive migration guide. While it does include \\ngui\", \"dance on how to approach migrating a project from ASP.NET Web Forms to Blazor, it does not \\nattempt \", \"to cover every nuance and detail. For more general guidance on migrating from ASP.NET to \\nASP.NET Co\", \"re, refer to the migration guidance in the ASP.NET Core documentation. \\nAdditional resources \\nYou ca\", \"n find the official Blazor home page and documentation at https://blazor.net. \\n \\ni \\nContents \\n \\nCont\", \"ents \\nAn introduction to Blazor for ASP.NET Web Forms developers ...................................\", \"..... 1 \\nAn open-source and cross-platform .NET ....................................................\", \"................................................................. 2 \\nClient-side web development ...\", \"....................................................................................................\", \"...................................... 3 \\nWebAssembly fulfills a need ..............................\", \"....................................................................................................\", \"............. 3 \\nBlazor: full-stack web development with .NET ......................................\", \"....................................................................... 4 \\nGet started with Blazor .\", \"....................................................................................................\", \"..................................................... 4 \\nArchitecture comparison of ASP.NET Web Form\", \"s and Blazor ............................................ 5 \\nASP.NET Web Forms .....................\", \"....................................................................................................\", \"...................................... 5 \\nBlazor ...................................................\", \"....................................................................................................\", \"..................................... 6 \\nBlazor app hosting models .................................\", \".................................................................... 8 \\nBlazor WebAssembly apps ....\", \"....................................................................................................\", \"........................................... 8 \\nBlazor Server apps ..................................\", \"....................................................................................................\", \"............................. 9 \\nHow to choose the right Blazor hosting model ......................\", \"................................................................................. 10 \\nDeploy your ap\", \"p ..................................................................................................\", \".................................................................. 11 \\nProject structure for Blazor \", \"apps ......................................................................................... 12 \\nP\", \"roject file ........................................................................................\", \"........................................................................................ 12 \\nEntry p\", \"oint ...............................................................................................\", \"................................................................................ 13 \\nStatic files ..\", \"....................................................................................................\", \"........................................................................... 15 \\nConfiguration.......\", \"....................................................................................................\", \"............................................................... 15 \\nRazor components ...............\", \"....................................................................................................\", \"............................................ 15 \\nPages .............................................\", \"....................................................................................................\", \"......................................... 16 \\nLayout ...............................................\", \"....................................................................................................\", \"..................................... 16 \\nBootstrap Blazor .........................................\", \"....................................................................................................\", \"....................... 16 \\nBuild output ...........................................................\", \"....................................................................................................\", \"............. 18 \\nRun the app with Hot Reload.......................................................\", \".................................................................................... 18 \\nApp startup\", \" ...................................................................................................\", \"......................... 21 \\nApplication_Start and Web Forms ......................................\", \"........................................................................................... 21 \\nBlaz\", \"or Server Startup Structure ........................................................................\", \"............................................................... 21 \\n \\nii \\nContents \\nUpgrading the Bu\", \"ndleConfig Process .................................................................................\", \"......................................... 23 \\nBuild reusable UI components with Blazor..............\", \"........................................................... 24 \\nAn introduction to Razor ...........\", \"....................................................................................................\", \".................................... 24 \\nUse components ............................................\", \"....................................................................................................\", \"................... 28 \\nModify page title from components ..........................................\", \"................................................................................... 28 \\nComponent pa\", \"rameters ...........................................................................................\", \".......................................................... 29 \\nQuery string parameters .............\", \"....................................................................................................\", \".............................. 29 \\nComponents and error boundaries .................................\", \".............................................................................................. 30 \\nE\", \"vent handlers ......................................................................................\", \".................................................................................. 30 \\nData binding \", \"....................................................................................................\", \"....................................................................... 32 \\nState changes ..........\", \"....................................................................................................\", \"........................................................... 33 \\nComponent lifecycle ................\", \"....................................................................................................\", \"........................................ 34 \\nOnInitialized .........................................\", \"....................................................................................................\", \".......................... 34 \\nOnParametersSet .....................................................\", \"....................................................................................................\", \".... 35 \\nOnAfterRender .............................................................................\", \"..................................................................................... 35 \\nIDisposabl\", \"e ..................................................................................................\", \"....................................................................... 35 \\nCapture component refere\", \"nces ...............................................................................................\", \"....................................... 36 \\nCapture element references .............................\", \"....................................................................................................\", \"............ 36 \\nTemplated components ..............................................................\", \"....................................................................................... 36 \\nChild co\", \"ntent...............................................................................................\", \"....................................................................... 37 \\nTemplate parameters ....\", \"....................................................................................................\", \".............................................. 37 \\nCode-behind .....................................\", \"....................................................................................................\", \".................................. 38 \\nAdditional resources ........................................\", \"....................................................................................................\", \"................ 39 \\nPages, routing, and layouts ...................................................\", \"............................................... 40 \\nCreate pages ...................................\", \"....................................................................................................\", \".................................... 41 \\nRouter component ..........................................\", \"....................................................................................................\", \"................. 42 \\nNavigation ...................................................................\", \"....................................................................................................\", \"........ 42 \\nBase URLs .............................................................................\", \"....................................................................................................\", \" 43 \\nPage layout ...................................................................................\", \"........................................................................................... 43 \\nStat\", \"e management .......................................................................................\", \"......................... 46 \\nRequest state management with ViewState ..............................\", \"................................................................................ 46 \\n \\niii \\nContents\", \" \\nMaintain state with Session ......................................................................\", \"........................................................................ 47 \\nApplication state .....\", \"....................................................................................................\", \".......................................................... 47 \\nIn the browser ......................\", \"....................................................................................................\", \".............................................. 48 \\nForms and validation ............................\", \"................................................................................ 49 \\nAdditional reso\", \"urces ..............................................................................................\", \".............................................................. 51 \\nWork with data ..................\", \"....................................................................................................\", \" 52 \\nEntity Framework ..............................................................................\", \".................................................................................... 52 \\nEF Code Fir\", \"st..................................................................................................\", \"..................................................................... 53 \\nEF Database First ........\", \"....................................................................................................\", \".................................................. 54 \\nInteract with web services ..................\", \"....................................................................................................\", \"........................... 54 \\nModules, handlers, and middleware ..................................\", \"................................................. 56 \\nOverview .....................................\", \"....................................................................................................\", \".......................................... 56 \\nKatana ..............................................\", \"....................................................................................................\", \"...................................... 57 \\nCommon middleware .......................................\", \"....................................................................................................\", \"............... 57 \\nCustom middleware ..............................................................\", \"............................................................................................... 58 \\n\", \"App configuration ..................................................................................\", \"............................... 60 \\nConfiguration sources ..........................................\", \"....................................................................................................\", \"........... 60 \\nappsettings.json format and access .................................................\", \"............................................................................. 61 \\nUser secrets .....\", \"....................................................................................................\", \".................................................................... 61 \\nEnvironment variables .....\", \"....................................................................................................\", \"................................................ 61 \\nCommand-line arguments ........................\", \"....................................................................................................\", \".................... 62 \\nThe return of web.config ..................................................\", \"................................................................................................. 62\", \" \\nRead configuration in the app ....................................................................\", \"..................................................................... 63 \\nStrongly typed configurati\", \"on .................................................................................................\", \".......................................... 63 \\nSecurity: Authentication and Authorization in ASP.NET\", \" Web Forms and Blazor ........... 65 \\nASP.NET universal providers ..................................\", \"....................................................................................................\", \"....... 65 \\nAuthorization configuration in Web Forms ...............................................\", \"............................................................ 66 \\nAuthorization code in Web Forms ...\", \"....................................................................................................\", \"..................... 67 \\nASP.NET Core Identity ....................................................\", \"....................................................................................................\", \". 68 \\nRoles, claims, and policies ..................................................................\", \".......................................................................... 68 \\nMigration guide .....\", \"....................................................................................................\", \"....................................................... 70 \\n \\niv \\nContents \\nCreating the ASP.NET Cor\", \"e Identity schema ..................................................................................\", \"....................... 70 \\nMigrating data from universal providers to ASP.NET Core Identity .......\", \"..................................................... 73 \\nMigrating security settings from web.confi\", \"g to app startup .......................................................................... 74 \\nUpda\", \"ting individual pages to use ASP.NET Core Identity abstractions ....................................\", \"................. 75 \\nSummary ......................................................................\", \"....................................................................................................\", \"........ 76 \\nReferences ............................................................................\", \"................................................................................................... \", \"77 \\nMigrate from ASP.NET Web Forms to Blazor .......................................................\", \".............. 78 \\nServer-side versus client-side hosting ..........................................\", \"................................................................................ 78 \\nCreate a new pr\", \"oject...............................................................................................\", \"............................................................. 79 \\nEnable startup process ...........\", \"....................................................................................................\", \"......................................... 80 \\nMigrate HTTP modules and handlers to middleware ......\", \"...................................................................................... 83 \\nMigrate s\", \"tatic files ........................................................................................\", \"........................................................................ 84 \\nMigrate runtime bundlin\", \"g and minification setup ...........................................................................\", \"....................... 84 \\nMigrate ASPX pages .....................................................\", \"....................................................................................................\", \"... 84 \\nModel validation in Blazor .................................................................\", \"........................................................................... 88 \\nMigrate configuratio\", \"n ..................................................................................................\", \"....................................................... 89 \\nMigrate data access ....................\", \"....................................................................................................\", \"..................................... 91 \\nArchitectural changes ....................................\", \"....................................................................................................\", \".................. 91 \\nMigration conclusion ........................................................\", \"................................................................................................... \", \"92 \\n \\n1 \\nCHAPTER 1 | An introduction to Blazor for ASP.NET Web Forms developers \\n \\nCHAPTER 1 \\nAn int\", \"roduction to Blazor \\nfor ASP.NET Web Forms \\ndevelopers \\nThe ASP.NET Web Forms framework has been a s\", \"taple of .NET web development since the .NET \\nFramework first shipped in 2002. Back when the Web was\", \" still largely in its infancy, ASP.NET Web \\nForms made building web apps simple and productive by ad\", \"opting many of the patterns that were \\nused for desktop development. In ASP.NET Web Forms, web pages\", \" can be quickly composed from \\nreusable UI controls. User interactions are handled naturally as even\", \"ts. There\\u2019s a rich ecosystem of \\nWeb Forms UI controls provided by Microsoft and control vendors. Th\", \"e controls ease the efforts of \\nconnecting to data sources and displaying rich data visualizations. \", \"For the visually inclined, the Web \\nForms designer provides a simple drag-and-drop interface for man\", \"aging controls. \\nOver the years, Microsoft has introduced new ASP.NET-based web frameworks to addres\", \"s web \\ndevelopment trends. Some such web frameworks include ASP.NET MVC, ASP.NET Web Pages, and \\nmor\", \"e recently ASP.NET Core. With each new framework, some have predicted the imminent decline of \\nASP.N\", \"ET Web Forms and criticized it as an outdated, outmoded web framework. Despite these \\npredictions, m\", \"any .NET web developers continue to find ASP.NET Web Forms a simple, stable, and \\nproductive way to \", \"get their work done. \\nAt the time of writing, almost half a million web developers use ASP.NET Web F\", \"orms every month. The \\nASP.NET Web Forms framework is stable to the point that docs, samples, books,\", \" and blog posts from \\na decade ago remain useful and relevant. For many .NET web developers, \\u201cASP.NE\", \"T\\u201d is still \\nsynonymous with \\u201cASP.NET Web Forms\\u201d as it was when .NET was first conceived. Arguments \", \"on the \\npros and cons of ASP.NET Web Forms compared to the other new .NET web frameworks may rage on\", \". \\nASP.NET Web Forms remains a popular framework for creating web apps. \\nEven so, innovations in sof\", \"tware development aren\\u2019t slowing. All software developers need to stay \\nabreast of new technologies \", \"and trends. Two trends in particular are worth considering: \\n1. \\nThe shift to open-source and cross-\", \"platform \\n2. \\nThe shift of app logic to the client \\n \\n2 \\nCHAPTER 1 | An introduction to Blazor for A\", \"SP.NET Web Forms developers \\n \\nAn open-source and cross-platform .NET \\nWhen .NET and ASP.NET Web For\", \"ms first shipped, the platform ecosystem looked much different than \\nit does today. The desktop and \", \"server markets were dominated by Windows. Alternative platforms like \\nmacOS and Linux were still str\", \"uggling to gain traction. ASP.NET Web Forms ships with the .NET \\nFramework as a Windows-only compone\", \"nt, which means ASP.NET Web Forms apps can only run on \\nWindows Server machines. Many modern environ\", \"ments now use different kinds of platforms for \\nservers and development machines such that cross-pla\", \"tform support for many users is an absolute \\nrequirement. \\nMost modern web frameworks are now also o\", \"pen-source, which has a number of benefits. Users \\naren\\u2019t beheld to a single project owner to fix bu\", \"gs and add features. Open-source projects provide \\nimproved transparency on development progress and\", \" upcoming changes. Open-source projects enjoy \\ncontributions from an entire community, and they fost\", \"er a supportive open-source ecosystem. \\nDespite the risks of open-source, many consumers and contrib\", \"utors have found suitable mitigations \\nthat enable them to enjoy the benefits of an open-source ecos\", \"ystem in a safe and reasonable way. \\nExamples of such mitigations include contributor license agreem\", \"ents, friendly licenses, pedigree scans, \\nand supporting foundations. \\nThe .NET community has embrac\", \"ed both cross-platform support and open-source. .NET Core is an \\nopen-source and cross-platform impl\", \"ementation of .NET that runs on a plethora of platforms, \\nincluding Windows, macOS, and various Linu\", \"x distributions. Xamarin provides Mono, an open-source \\nversion of .NET. Mono runs on Android, iOS, \", \"and a variety of other form factors, including watches \\nand smart TVs. In 2020, Microsoft released .\", \"NET 5 that reconciled .NET Core and Mono into \\u201ca single \\n.NET runtime and framework that can be used\", \" everywhere and that has uniform runtime behaviors \\nand developer experiences.\\u201d \\nWill ASP.NET Web Fo\", \"rms benefit from the move to open-source and cross-platform support? The \\nanswer, unfortunately, is \", \"no, or at least not to the same extent as the rest of the platform. The .NET \\nteam made it clear tha\", \"t ASP.NET Web Forms won\\u2019t be ported to .NET Core or .NET 8. Why is that? \\nThere were efforts in the \", \"early days of .NET Core to port ASP.NET Web Forms. The number of breaking \\nchanges required were fou\", \"nd to be too drastic. There\\u2019s also an admission here that even for Microsoft, \\nthere\\u2019s a limit to th\", \"e number of web frameworks that it can support simultaneously. Perhaps someone \\nin the community wil\", \"l take up the cause of creating an open-source and cross-platform version of \\nASP.NET Web Forms. The\", \" source code for ASP.NET Web Forms has been made available publicly in \\nreference form. But for the \", \"time being, it seems ASP.NET Web Forms will remain Windows-only and \\nwithout an open-source contribu\", \"tion model. If cross-platform support or open-source become \\nimportant for your scenarios, then you\\u2019\", \"ll need to look for something new. \\nDoes this mean ASP.NET Web Forms is dead and should no longer be\", \" used? Of course not! As long as \\nthe .NET Framework ships as part of Windows, ASP.NET Web Forms wil\", \"l be a supported framework. \\nFor many Web Forms developers, the lack of cross-platform and open-sour\", \"ce support is a non-issue. \\nIf you don\\u2019t have a requirement for cross-platform support, open-source,\", \" or any of the other new \\nfeatures in .NET Core or .NET 8, then sticking with ASP.NET Web Forms on W\", \"indows is fine. ASP.NET \\nWeb Forms will continue to be a productive way to write web apps for many y\", \"ears to come. \\nBut there\\u2019s another trend worth considering, and that\\u2019s the shift to the client. \\n \\n3\", \" \\nCHAPTER 1 | An introduction to Blazor for ASP.NET Web Forms developers \\n \\nClient-side web developm\", \"ent \\nAll of the .NET-based web frameworks, including ASP.NET Web Forms, have historically had one th\", \"ing \\nin common: they\\u2019re server-rendered. In server-rendered web apps, the browser makes a request to\", \" the \\nserver, which executes some code (.NET code in ASP.NET apps) to produce a response. That respo\", \"nse \\nis sent back to the browser to handle. In this model, the browser is used as a thin rendering e\", \"ngine. \\nThe hard work of producing the UI, running the business logic, and managing state occurs on \", \"the \\nserver. \\nHowever, browsers have become versatile platforms. They implement an ever-increasing n\", \"umber of \\nopen web standards that grant access to the capabilities of the user\\u2019s machine. Why not ta\", \"ke \\nadvantage of the compute power, storage, memory, and other resources of the client device? UI \\ni\", \"nteractions in particular can benefit from a richer and more interactive feel when handled at least \", \"\\npartially or completely client-side. Logic and data that should be handled on the server can still \", \"be \\nhandled server-side. Web API calls or even real-time protocols, like WebSockets, can be used. Th\", \"ese \\nbenefits are available to web developers for free if they\\u2019re willing to write JavaScript. Clien\", \"t-side UI \\nframeworks, such as Angular, React, and Vue, simplify client-side web development and hav\", \"e grown in \\npopularity. ASP.NET Web Forms developers can also benefit from leveraging the client, an\", \"d even have \\nsome out-of-the-box support with integrated JavaScript frameworks like ASP.NET AJAX. \\nB\", \"ut bridging two different platforms and ecosystems (.NET and JavaScript) comes with a cost. \\nExperti\", \"se is required in two parallel worlds with different languages, frameworks, and tools. Code and \\nlog\", \"ic can\\u2019t be easily shared between client and server, resulting in duplication and engineering \\noverh\", \"ead. It can also be difficult to keep up with the JavaScript ecosystem, which has a history of \\nevol\", \"ving at breakneck speed. Front-end framework and build tool preferences change quickly. The \\nindustr\", \"y has observed the progression from Grunt to Gulp to Webpack, and so on. The same restless \\nchurn ha\", \"s occurred with front-end frameworks such as jQuery, Knockout, Angular, React, and Vue. But \\ngiven J\", \"avaScript\\u2019s browser monopoly, there was little choice in the matter. That is, until the web \\ncommuni\", \"ty got together and caused a miracle to happen! \\nWebAssembly fulfills a need \\nIn 2015, the major bro\", \"wser vendors joined forces in a W3C Community Group to create a new open \\nweb standard called WebAss\", \"embly. WebAssembly is a byte code for the Web. If you can compile your \\ncode to WebAssembly, it can \", \"then run on any browser on any platform at near native speed. Initial \\nefforts focused on C/C++. The\", \" result was a dramatic demonstration of running native 3D graphics \\nengines directly in the browser \", \"without plugins. WebAssembly has since been standardized and \\nimplemented by all major browsers. \\nWo\", \"rk on running .NET on WebAssembly was announced in late 2017 and released in 2020, including \\nsuppor\", \"t in .NET 5 and beyond. The ability to run .NET code directly in the browser enables full-stack \\nweb\", \" development with .NET. \\n \\n4 \\nCHAPTER 1 | An introduction to Blazor for ASP.NET Web Forms developers\", \" \\n \\nBlazor: full-stack web development with .NET \\nOn its own, the ability to run .NET code in a brow\", \"ser doesn\\u2019t provide an end-to-end experience for \\ncreating client-side web apps. That\\u2019s where Blazor\", \" comes in. Blazor is a client-side web UI framework \\nbased on C# instead of JavaScript. Blazor can r\", \"un directly in the browser via WebAssembly. No \\nbrowser plugins are required. Alternatively, Blazor \", \"apps can run server-side on .NET and handle all \\nuser interactions over a real-time connection with \", \"the browser. \\nBlazor has great tooling support in Visual Studio and Visual Studio Code. The framewor\", \"k also includes \\na full UI component model and has built-in facilities for: \\n\\u2022 \\nForms and validation\", \" \\n\\u2022 \\nDependency injection \\n\\u2022 \\nClient-side routing \\n\\u2022 \\nLayouts \\n\\u2022 \\nIn-browser debugging \\n\\u2022 \\nJavaScrip\", \"t interop \\nBlazor has a lot in common with ASP.NET Web Forms. Both frameworks offer component-based,\", \" \\nevent-driven, stateful UI programming models. The main architectural difference is that ASP.NET We\", \"b \\nForms runs only on the server. Blazor can run on the client in the browser. But if you\\u2019re coming \", \"from \\nan ASP.NET Web Forms background, there\\u2019s a lot in Blazor that will feel familiar. Blazor is a \", \"natural \\nsolution for ASP.NET Web Forms developers looking for a way to take advantage of client-sid\", \"e \\ndevelopment and the open-source, cross-platform future of .NET. \\nThis book provides an introducti\", \"on to Blazor that is catered specifically to ASP.NET Web Forms \\ndevelopers. Each Blazor concept is p\", \"resented in the context of analogous ASP.NET Web Forms \\nfeatures and practices. By the end of this b\", \"ook, you\\u2019ll have an understanding of: \\n\\u2022 \\nHow to build Blazor apps. \\n\\u2022 \\nHow Blazor works. \\n\\u2022 \\nHow Bl\", \"azor relates to .NET. \\n\\u2022 \\nReasonable strategies for migrating existing ASP.NET Web Forms apps to Bla\", \"zor where \\nappropriate. \\nGet started with Blazor \\nGetting started with Blazor is easy. Go to https:/\", \"/blazor.net and follow the links to install the \\nappropriate .NET SDK and Blazor project templates. \", \"You\\u2019ll also find instructions for setting up the \\nBlazor tooling in Visual Studio or Visual Studio C\", \"ode. \\n \\n5 \\nCHAPTER 2 | Architecture comparison of ASP.NET Web Forms and Blazor \\n \\nCHAPTER 2 \\nArchite\", \"cture comparison \\nof ASP.NET Web Forms \\nand Blazor \\nWhile ASP.NET Web Forms and Blazor have many sim\", \"ilar concepts, there are differences in how they \\nwork. This chapter examines the inner workings and\", \" architectures of ASP.NET Web Forms and Blazor. \\nASP.NET Web Forms \\nThe ASP.NET Web Forms framework \", \"is based on a page-centric architecture. Each HTTP request for a \\nlocation in the app is a separate \", \"page with which ASP.NET responds. As pages are requested, the \\ncontents of the browser are replaced \", \"with the results of the page requested. \\nPages consist of the following components: \\n\\u2022 \\nHTML markup \", \"\\n\\u2022 \\nC# or Visual Basic code \\n\\u2022 \\nA code-behind class containing logic and event-handling capabilities\", \" \\n\\u2022 \\nControls \\nControls are reusable units of web UI that can be programmatically placed and interac\", \"ted with on a \\npage. Pages are composed of files that end with .aspx containing markup, controls, an\", \"d some code. \\nThe code-behind classes are in files with the same base name and an .aspx.cs or .aspx.\", \"vb extension, \\ndepending on the programming language used. Interestingly, the web server interprets \", \"contents of \\nthe .aspx files and compiles them whenever they change. This recompilation occurs even \", \"if the web \\nserver is already running. \\nControls can be built with markup and delivered as user cont\", \"rols. A user control derives from the \\nUserControl class and has a similar structure to the Page. Ma\", \"rkup for user controls is stored in an .ascx \\nfile. An accompanying code-behind class resides in an \", \".ascx.cs or .ascx.vb file. Controls can also be \\nbuilt completely with code, by inheriting from eith\", \"er the WebControl or CompositeControl base class. \\nPages also have an extensive event lifecycle. Eac\", \"h page raises events for the initialization, load, \\nprerender, and unload events that occur as the A\", \"SP.NET runtime executes the page\\u2019s code for each \\nrequest. \\n \\n6 \\nCHAPTER 2 | Architecture comparison\", \" of ASP.NET Web Forms and Blazor \\n \\nControls on a Page typically post-back to the same page that pre\", \"sented the control, and carry along \\nwith them a payload from a hidden form field called ViewState. \", \"The ViewState field contains \\ninformation about the state of the controls at the time they were rend\", \"ered and presented on the \\npage, allowing the ASP.NET runtime to compare and identify changes in the\", \" content submitted to the \\nserver. \\nBlazor \\nBlazor is a client-side web UI framework similar in natu\", \"re to JavaScript front-end frameworks like \\nAngular or React. Blazor handles user interactions and r\", \"enders the necessary UI updates. Blazor isn\\u2019t \\nbased on a request-reply model. User interactions are\", \" handled as events that aren\\u2019t in the context of \\nany particular HTTP request. \\nBlazor apps consist \", \"of one or more root components that are rendered on an HTML page. \\n \\nHow the user specifies where co\", \"mponents should render and how the components are then wired up \\nfor user interactions is hosting mo\", \"del specific. \\nBlazor components are .NET classes that represent a reusable piece of UI. Each compon\", \"ent maintains \\nits own state and specifies its own rendering logic, which can include rendering othe\", \"r components. \\nComponents specify event handlers for specific user interactions to update the compon\", \"ent\\u2019s state. \\nAfter a component handles an event, Blazor renders the component and keeps track of wh\", \"at changed \\nin the rendered output. Components don\\u2019t render directly to the Document Object Model (D\", \"OM). \\nThey instead render to an in-memory representation of the DOM called a RenderTree so that Blaz\", \"or \\ncan track the changes. Blazor compares the newly rendered output with the previous output to \\nca\", \"lculate a UI diff that it then applies efficiently to the DOM. \\n \\n7 \\nCHAPTER 2 | Architecture compar\", \"ison of ASP.NET Web Forms and Blazor \\n \\n \\nComponents can also manually indicate that they should be \", \"rendered if their state changes outside of \\na normal UI event. Blazor uses a SynchronizationContext \", \"to enforce a single logical thread of \\nexecution. A component\\u2019s lifecycle methods and any event call\", \"backs that are raised by Blazor are \\nexecuted on this SynchronizationContext. \\n \\n8 \\nCHAPTER 3 | Blaz\", \"or app hosting models \\n \\nCHAPTER 3 \\nBlazor app hosting models \\nBlazor apps can be hosted in one of t\", \"he following ways: \\n\\u2022 \\nClient-side in the browser on WebAssembly. \\n\\u2022 \\nServer-side in an ASP.NET Core\", \" app. \\nBlazor WebAssembly apps \\nBlazor WebAssembly apps execute directly in the browser on a WebAsse\", \"mbly-based .NET runtime. \\nBlazor WebAssembly apps function in a similar way to front-end JavaScript \", \"frameworks like Angular or \\nReact. However, instead of writing JavaScript you write C#. The .NET run\", \"time is downloaded with the \\napp along with the app assembly and any required dependencies. No brows\", \"er plugins or extensions \\nare required. \\nThe downloaded assemblies are normal .NET assemblies, like \", \"you would use in any other .NET app. \\nBecause the runtime supports .NET Standard, you can use existi\", \"ng .NET Standard libraries with your \\nBlazor WebAssembly app. However, these assemblies will still e\", \"xecute in the browser security \\nsandbox. Some functionality may throw a PlatformNotSupportedExceptio\", \"n, like trying to access the \\nfile system or opening arbitrary network connections. \\nWhen the app lo\", \"ads, the .NET runtime is started and pointed at the app assembly. The app startup \\nlogic runs, and t\", \"he root components are rendered. Blazor calculates the UI updates based on the \\nrendered output from\", \" the components. The DOM updates are then applied. \\n \\n9 \\nCHAPTER 3 | Blazor app hosting models \\n \\n \\n\", \"Blazor WebAssembly apps run purely client-side. Such apps can be deployed to static site hosting \\nso\", \"lutions like GitHub Pages or Azure Static Website Hosting. .NET isn\\u2019t required on the server at all.\", \" \\nDeep linking to parts of the app typically requires a routing solution on the server. The routing \", \"\\nsolution redirects requests to the root of the app. For example, this redirection can be handled us\", \"ing \\nURL rewrite rules in IIS. \\nTo get all the benefits of Blazor and full-stack .NET web developmen\", \"t, host your Blazor WebAssembly \\napp with ASP.NET Core. By using .NET on both the client and server,\", \" you can easily share code and \\nbuild your app using one consistent set of languages, frameworks, an\", \"d tools. Blazor provides \\nconvenient templates for setting up a solution that contains both a Blazor\", \" WebAssembly app and an \\nASP.NET Core host project. When the solution is built, the built static fil\", \"es from the Blazor app are \\nhosted by the ASP.NET Core app with fallback routing already setup. \\nBla\", \"zor Server apps \\nRecall from the Blazor architecture discussion that Blazor components render their \", \"output to an \\nintermediate abstraction called a RenderTree. The Blazor framework then compares what \", \"was \\nrendered with what was previously rendered. The differences are applied to the DOM. Blazor \\ncom\", \"ponents are decoupled from how their rendered output is applied. Consequently, the \\ncomponents thems\", \"elves don\\u2019t have to run in the same process as the process updating the UI. In fact, \\nthey don\\u2019t eve\", \"n have to run on the same machine. \\nIn Blazor Server apps, the components run on the server instead \", \"of client-side in the browser. UI \\nevents that occur in the browser are sent to the server over a re\", \"al-time connection. The events are \\ndispatched to the correct component instances. The components re\", \"nder, and the calculated UI diff is \\nserialized and sent to the browser where it\\u2019s applied to the DO\", \"M. \\n \\n10 \\nCHAPTER 3 | Blazor app hosting models \\n \\n \\nThe Blazor Server hosting model may sound famil\", \"iar if you\\u2019ve used ASP.NET AJAX and the \\nUpdatePanel control. The UpdatePanel control handles applyi\", \"ng partial page updates in response to \\ntrigger events on the page. When triggered, the UpdatePanel \", \"requests a partial update and then \\napplies it without needing to refresh the page. The state of the\", \" UI is managed using ViewState. Blazor \\nServer apps are slightly different in that the app requires \", \"an active connection with the client. \\nAdditionally, all UI state is maintained on the server. Aside\", \" from those differences, the two models are \\nconceptually similar. \\nHow to choose the right Blazor h\", \"osting model \\nAs described in the Blazor hosting model docs, the different Blazor hosting models hav\", \"e different \\ntradeoffs. \\nThe Blazor WebAssembly hosting model has the following benefits: \\n\\u2022 \\nThere\\u2019\", \"s no .NET server-side dependency. The app is fully functioning after downloaded to the \\nclient. \\n\\u2022 \\n\", \"Client resources and capabilities are fully leveraged. \\n\\u2022 \\nWork is offloaded from the server to the \", \"client. \\n\\u2022 \\nAn ASP.NET Core web server isn\\u2019t required to host the app. Serverless deployment scenari\", \"os \\nare possible (for example, serving the app from a CDN). \\nThe downsides of the Blazor WebAssembly\", \" hosting model are: \\n\\u2022 \\nBrowser capabilities restrict the app. \\n\\u2022 \\nCapable client hardware and softw\", \"are (for example, WebAssembly support) is required. \\n\\u2022 \\nDownload size is larger, and apps take longe\", \"r to load. \\n \\n11 \\nCHAPTER 3 | Blazor app hosting models \\n \\n\\u2022 \\n.NET runtime and tooling support is le\", \"ss mature. For example, there are limitations in .NET \\nStandard support and debugging. \\nConversely, \", \"the Blazor Server hosting model offers the following benefits: \\n\\u2022 \\nDownload size is much smaller tha\", \"n a client-side app, and the app loads much faster. \\n\\u2022 \\nThe app takes full advantage of server capab\", \"ilities, including use of any .NET compatible APIs. \\n\\u2022 \\n.NET on the server is used to run the app, s\", \"o existing .NET tooling, such as debugging, works \\nas expected. \\n\\u2022 \\nThin clients are supported. For \", \"example, server-side apps work with browsers that don\\u2019t \\nsupport WebAssembly and on resource-constra\", \"ined devices. \\n\\u2022 \\nThe app\\u2019s .NET/C# code base, including the app\\u2019s component code, isn\\u2019t served to c\", \"lients. \\nThe downsides to the Blazor Server hosting model are: \\n\\u2022 \\nHigher UI latency. Every user int\", \"eraction involves a network hop. \\n\\u2022 \\nThere\\u2019s no offline support. If the client connection fails, the\", \" app stops working. \\n\\u2022 \\nScalability is challenging for apps with many users. The server must manage \", \"multiple client \\nconnections and handle client state. \\n\\u2022 \\nAn ASP.NET Core server is required to serv\", \"e the app. Serverless deployment scenarios aren\\u2019t \\npossible. For example, you can\\u2019t serve the app fr\", \"om a CDN. \\nThe preceding list of trade-offs may be intimidating, but your hosting model can be chang\", \"ed later. \\nRegardless of the Blazor hosting model selected, the component model is the same. In prin\", \"ciple, the \\nsame components can be used with either hosting model. Your app code doesn\\u2019t change; how\", \"ever, \\nit\\u2019s a good practice to introduce abstractions so that your components stay hosting model-agn\", \"ostic. \\nThe abstractions allow your app to more easily adopt a different hosting model. \\nDeploy your\", \" app \\nASP.NET Web Forms apps are typically hosted on IIS on a Windows Server machine or cluster. Bla\", \"zor \\napps can also: \\n\\u2022 \\nBe hosted on IIS, either as static files or as an ASP.NET Core app. \\n\\u2022 \\nLeve\", \"rage ASP.NET Core\\u2019s flexibility to be hosted on various platforms and server \\ninfrastructures. For e\", \"xample, you can host a Blazor App using Nginx or Apache on Linux. For \\nmore information about how to\", \" publish and deploy Blazor apps, see the Blazor Hosting and \\ndeployment documentation. \\nIn the next \", \"section, we\\u2019ll look at how the projects for Blazor WebAssembly and Blazor Server apps are \\nset up. \\n\", \" \\n12 \\nCHAPTER 4 | Project structure for Blazor apps \\n \\nCHAPTER 4 \\nProject structure for Blazor \\napps\", \" \\nDespite their significant project structure differences, ASP.NET Web Forms and Blazor share many \\n\", \"similar concepts. Here, we\\u2019ll look at the structure of a Blazor project and compare it to an ASP.NET\", \" \\nWeb Forms project. \\nTo create your first Blazor app, follow the instructions in the Blazor getting\", \" started steps. You can \\nfollow the instructions to create either a Blazor Server app or a Blazor We\", \"bAssembly app hosted in \\nASP.NET Core. Except for the hosting model-specific logic, most of the code\", \" in both projects is the \\nsame. \\nProject file \\nBlazor Server apps are .NET projects. The project fil\", \"e for the Blazor Server app is about as simple as it \\ncan get: \\n<Project Sdk=\\\"Microsoft.NET.Sdk.Web\\\"\", \"> \\n \\n  <PropertyGroup> \\n    <TargetFramework>net8.0</TargetFramework> \\n  </PropertyGroup> \\n \\n</Proje\", \"ct> \\nThe project file for a Blazor WebAssembly app looks slightly more involved (exact version \\nnumb\", \"ers may vary): \\n<Project Sdk=\\\"Microsoft.NET.Sdk.BlazorWebAssembly\\\"> \\n \\n  <PropertyGroup> \\n    <Targe\", \"tFramework>net8.0</TargetFramework> \\n    <ImplicitUsings>enable</ImplicitUsings> \\n  </PropertyGroup>\", \" \\n \\n  <ItemGroup> \\n    <PackageReference Include=\\\"Microsoft.AspNetCore.Components.WebAssembly\\\" Versi\", \"on=\\\"8.0.0\\\" \\n/> \\n    <PackageReference Include=\\\"Microsoft.AspNetCore.Components.WebAssembly.DevServer\", \"\\\" \\nVersion=\\\"8.0.0\\\" PrivateAssets=\\\"all\\\" /> \\n  </ItemGroup> \\n \\n</Project> \\n \\n13 \\nCHAPTER 4 | Project s\", \"tructure for Blazor apps \\n \\nBlazor WebAssembly project targets Microsoft.NET.Sdk.BlazorWebAssembly i\", \"nstead of \\nMicrosoft.NET.Sdk.Web sdk because they run in the browser on a WebAssembly-based .NET run\", \"time. \\nYou can\\u2019t install .NET into a web browser like you can on a server or developer machine. \\nCon\", \"sequently, the project references the Blazor framework using individual package references. \\nBy comp\", \"arison, a default ASP.NET Web Forms project includes almost 300 lines of XML in its .csproj \\nfile, m\", \"ost of which is explicitly listing the various code and content files in the project. Since the \\nrel\", \"ease of .NET 5, both Blazor Server and Blazor WebAssembly apps can easily share one unified \\nruntime\", \". \\nAlthough they\\u2019re supported, individual assembly references are less common in .NET projects. Most\", \" \\nproject dependencies are handled as NuGet package references. You only need to reference top-level\", \" \\npackage dependencies in .NET projects. Transitive dependencies are included automatically. Instead\", \" of \\nusing the packages.config file commonly found in ASP.NET Web Forms projects to reference packag\", \"es, \\npackage references are added to the project file using the <PackageReference> element. \\n<ItemGr\", \"oup> \\n  <PackageReference Include=\\\"Newtonsoft.Json\\\" Version=\\\"13.0.2\\\" /> \\n</ItemGroup> \\nEntry point \\n\", \"The Blazor Server app\\u2019s entry point is defined in the Program.cs file, as you would see in a Console\", \" \\napp. When the app executes, it creates and runs a web host instance using defaults specific to web\", \" \\napps. The web host manages the Blazor Server app\\u2019s lifecycle and sets up host-level services. \\nExa\", \"mples of such services are configuration, logging, dependency injection, and the HTTP server. This \\n\", \"code is mostly boilerplate and is often left unchanged. \\nusing BlazorApp3.Areas.Identity; \\nusing Bla\", \"zorApp3.Data; \\nusing Microsoft.AspNetCore.Components.Authorization; \\nusing Microsoft.AspNetCore.Iden\", \"tity; \\nusing Microsoft.EntityFrameworkCore; \\n \\nvar builder = WebApplication.CreateBuilder(args); \\n \\n\", \"// Add services to the container. \\nvar connectionString = builder.Configuration.GetConnectionString(\", \"\\\"DefaultConnection\\\"); \\nbuilder.Services.AddDbContext<ApplicationDbContext>(options => \\n    options.U\", \"seSqlServer(connectionString)); \\nbuilder.Services.AddDatabaseDeveloperPageExceptionFilter(); \\nbuilde\", \"r.Services.AddDefaultIdentity<IdentityUser>(options => \\noptions.SignIn.RequireConfirmedAccount = tru\", \"e) \\n    .AddEntityFrameworkStores<ApplicationDbContext>(); \\nbuilder.Services.AddRazorPages(); \\nbuild\", \"er.Services.AddServerSideBlazor(); \\nbuilder.Services.AddScoped<AuthenticationStateProvider, \\nRevalid\", \"atingIdentityAuthenticationStateProvider<IdentityUser>>(); \\nbuilder.Services.AddSingleton<WeatherFor\", \"ecastService>(); \\n \\nvar app = builder.Build(); \\n \\n// Configure the HTTP request pipeline. \\n \\n14 \\nCHA\", \"PTER 4 | Project structure for Blazor apps \\n \\nif (app.Environment.IsDevelopment()) \\n{ \\n    app.UseMi\", \"grationsEndPoint(); \\n} \\nelse \\n{ \\n    app.UseExceptionHandler(\\\"/Error\\\"); \\n    // The default HSTS val\", \"ue is 30 days. You may want to change this for production \\nscenarios, see https://aka.ms/aspnetcore-\", \"hsts. \\n    app.UseHsts(); \\n} \\n \\napp.UseHttpsRedirection(); \\n \\napp.UseStaticFiles(); \\n \\napp.UseRoutin\", \"g(); \\n \\napp.UseAuthorization(); \\n \\napp.MapControllers(); \\napp.MapBlazorHub(); \\napp.MapFallbackToPage\", \"(\\\"/_Host\\\"); \\n \\napp.Run(); \\nBlazor WebAssembly apps also define an entry point in Program.cs. The cod\", \"e looks slightly different. \\nThe code is similar in that it\\u2019s setting up the app host to provide the\", \" same host-level services to the \\napp. The WebAssembly app host doesn\\u2019t, however, set up an HTTP ser\", \"ver because it executes directly \\nin the browser. \\nBlazor apps don\\u2019t use a Global.asax file to defin\", \"e the startup logic for the app. Instead, this logic is \\ncontained in Program.cs or in a related Sta\", \"rtup class that is referenced from Program.cs. Either way, \\nthis code is used to configure the app a\", \"nd any app-specific services. \\nIn a Blazor Server app, the Program.cs file shown is used to set up t\", \"he endpoint for the real-time \\nconnection used by Blazor between the client browsers and the server.\", \" \\nIn a Blazor WebAssembly app, the Program.cs file defines the root components for the app and where\", \" \\nthey should be rendered: \\nusing BlazorApp1; \\nusing Microsoft.AspNetCore.Components.Web; \\nusing Mic\", \"rosoft.AspNetCore.Components.WebAssembly.Hosting; \\n \\nvar builder = WebAssemblyHostBuilder.CreateDefa\", \"ult(args); \\nbuilder.RootComponents.Add<App>(\\\"#app\\\"); \\nbuilder.RootComponents.Add<HeadOutlet>(\\\"head::\", \"after\\\"); \\n \\nbuilder.Services.AddScoped(sp => new HttpClient { BaseAddress = new \\nUri(builder.HostEnv\", \"ironment.BaseAddress) }); \\n \\nawait builder.Build().RunAsync(); \\n \\n15 \\nCHAPTER 4 | Project structure \", \"for Blazor apps \\n \\nStatic files \\nUnlike ASP.NET Web Forms projects, not all files in a Blazor projec\", \"t can be requested as static files. \\nOnly the files in the wwwroot folder are web-addressable. This \", \"folder is referred to as the app\\u2019s \\u201cweb \\nroot\\u201d. Anything outside of the app\\u2019s web root isn\\u2019t web-add\", \"ressable. This setup provides an additional \\nlevel of security that prevents accidental exposure of \", \"project files over the web. \\nConfiguration \\nConfiguration in ASP.NET Web Forms apps is typically han\", \"dled using one or more web.config files. \\nBlazor apps don\\u2019t typically have web.config files. If they\", \" do, the file is only used to configure IIS-\\nspecific settings when hosted on IIS. Instead, Blazor S\", \"erver apps use the ASP.NET Core configuration \\nabstractions. (Blazor WebAssembly apps don\\u2019t currentl\", \"y support the same configuration abstractions, \\nbut that may be a feature added in the future.) For \", \"example, the default Blazor Server app stores some \\nsettings in appsettings.json. \\n{ \\n  \\\"Logging\\\": {\", \" \\n    \\\"LogLevel\\\": { \\n      \\\"Default\\\": \\\"Information\\\", \\n      \\\"Microsoft\\\": \\\"Warning\\\", \\n      \\\"Microsof\", \"t.Hosting.Lifetime\\\": \\\"Information\\\" \\n    } \\n  }, \\n  \\\"AllowedHosts\\\": \\\"*\\\" \\n} \\nYou\\u2019ll learn more about c\", \"onfiguration in ASP.NET Core projects in the Configuration section. \\nRazor components \\nMost files in\", \" Blazor projects are .razor files. Razor is a templating language based on HTML and C# \\nthat is used\", \" to dynamically generate web UI. The .razor files define components that make up the UI \\nof the app.\", \" For the most part, the components are identical for both the Blazor Server and Blazor \\nWebAssembly \", \"apps. Components in Blazor are analogous to user controls in ASP.NET Web Forms. \\nEach Razor componen\", \"t file is compiled into a .NET class when the project is built. The generated class \\ncaptures the co\", \"mponent\\u2019s state, rendering logic, lifecycle methods, event handlers, and other logic. \\nYou\\u2019ll learn \", \"more about authoring components in the Building reusable UI components with Blazor \\nsection. \\nThe *_\", \"Imports.razor* files aren\\u2019t Razor component files. Instead, they define a set of Razor directives to\", \" \\nimport into other .razor files within the same folder and in its subfolders. For example, a \\n*_Imp\", \"orts.razor* file is a conventional way to add using directives for commonly used namespaces: \\n@using\", \" System.Net.Http \\n@using System.Net.Http.Json \\n@using Microsoft.AspNetCore.Components.Forms \\n@using \", \"Microsoft.AspNetCore.Components.Routing \\n \\n16 \\nCHAPTER 4 | Project structure for Blazor apps \\n \\n@usi\", \"ng Microsoft.AspNetCore.Components.Web \\n@using Microsoft.AspNetCore.Components.Web.Virtualization \\n@\", \"using Microsoft.AspNetCore.Components.WebAssembly.Http \\n@using Microsoft.JSInterop \\n@using BlazorApp\", \"1 \\n@using BlazorApp1.Shared \\nPages \\nWhere are the pages in the Blazor apps? Blazor doesn\\u2019t define a \", \"separate file extension for \\naddressable pages, like the .aspx files in ASP.NET Web Forms apps. Inst\", \"ead, pages are defined by \\nassigning routes to components. A route is typically assigned using the @\", \"page Razor directive. For \\nexample, the Counter component authored in the Pages/Counter.razor file d\", \"efines the following route: \\n@page \\\"/counter\\\" \\nRouting in Blazor is handled client-side, not on the \", \"server. As the user navigates in the browser, Blazor \\nintercepts the navigation and then renders the\", \" component with the matching route. \\nThe component routes aren\\u2019t currently inferred by the component\", \"\\u2019s file location like they are with \\n.aspx pages or ASP.NET Core Razor Pages. This feature may be ad\", \"ded in the future. Each route must \\nbe specified explicitly on the component. Storing routable compo\", \"nents in a Pages folder has no \\nspecial meaning and is purely a convention. \\nYou\\u2019ll learn more about\", \" routing in Blazor in the Pages, routing, and layouts section. \\nLayout \\nIn ASP.NET Web Forms apps, a\", \" common page layout is handled using master pages (Site.Master). In \\nBlazor apps, the page layout is\", \" handled using layout components (Shared/MainLayout.razor). Layout \\ncomponents are discussed in more\", \" detail in the Page, routing, and layouts section. \\nBootstrap Blazor \\nTo bootstrap Blazor, the app m\", \"ust: \\n\\u2022 \\nSpecify where on the page the root component (App.Razor) should be rendered. \\n\\u2022 \\nAdd the co\", \"rresponding Blazor framework script. \\nIn the Blazor Server app, the root component\\u2019s host page is de\", \"fined in the *_Host.cshtml* file. This file \\ndefines a Razor Page, not a component. Razor Pages use \", \"Razor syntax to define a server-addressable \\npage, very much like an .aspx page. \\n@page \\\"/\\\" \\n@namesp\", \"ace BlazorApp3.Pages \\n@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers \\n@{ \\n    Layout = \\\"_Layou\", \"t\\\"; \\n} \\n \\n17 \\nCHAPTER 4 | Project structure for Blazor apps \\n \\n \\n<component type=\\\"typeof(App)\\\" rende\", \"r-mode=\\\"ServerPrerendered\\\" /> \\nThe render-mode attribute is used to define where a root-level compon\", \"ent should be rendered. The \\nRenderMode option indicates the manner in which the component should be\", \" rendered. The following \\ntable outlines the supported RenderMode options. \\nOption \\nDescription \\nRen\", \"derMode.Server \\nRendered interactively once a \\nconnection with the browser is \\nestablished \\nRenderMo\", \"de.ServerPrerendered \\nFirst prerendered and then rendered \\ninteractively \\nRenderMode.Static \\nRendere\", \"d as static content \\nThe *_Layout.cshtml* file includes the default HTML for the app and its compone\", \"nts. \\n@using Microsoft.AspNetCore.Components.Web \\n@namespace BlazorApp3.Pages \\n@addTagHelper *, Micr\", \"osoft.AspNetCore.Mvc.TagHelpers \\n \\n<!DOCTYPE html> \\n<html lang=\\\"en\\\"> \\n<head> \\n    <meta charset=\\\"utf\", \"-8\\\" /> \\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\" /> \\n    <base href\", \"=\\\"~/\\\" /> \\n    <link rel=\\\"stylesheet\\\" href=\\\"css/bootstrap/bootstrap.min.css\\\" /> \\n    <link href=\\\"css/\", \"site.css\\\" rel=\\\"stylesheet\\\" /> \\n    <link href=\\\"BlazorApp3.styles.css\\\" rel=\\\"stylesheet\\\" /> \\n    <comp\", \"onent type=\\\"typeof(HeadOutlet)\\\" render-mode=\\\"ServerPrerendered\\\" /> \\n</head> \\n<body> \\n    @RenderBody\", \"() \\n \\n    <div id=\\\"blazor-error-ui\\\"> \\n        <environment include=\\\"Staging,Production\\\"> \\n          \", \"  An error has occurred. This application may no longer respond until reloaded. \\n        </environme\", \"nt> \\n        <environment include=\\\"Development\\\"> \\n            An unhandled exception has occurred. S\", \"ee browser dev tools for details. \\n        </environment> \\n        <a href=\\\"\\\" class=\\\"reload\\\">Reload<\", \"/a> \\n        <a class=\\\"dismiss\\\">\\ud83d\\uddd9</a> \\n    </div> \\n \\n    <script src=\\\"_framework/blazor.server.js\\\"><\", \"/script> \\n</body> \\n</html> \\nThe script reference to *_framework/blazor.server.js* establishes the re\", \"al-time connection with the \\nserver and then deals with all user interactions and UI updates. \\n \\n18 \", \"\\nCHAPTER 4 | Project structure for Blazor apps \\n \\nIn the Blazor WebAssembly app, the host page is a \", \"simple static HTML file under wwwroot/index.html. \\nThe <div> element with id named app is used to in\", \"dicate where the root component should be \\nrendered. \\n<!DOCTYPE html> \\n<html lang=\\\"en\\\"> \\n \\n<head> \\n \", \"   <meta charset=\\\"utf-8\\\" /> \\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.\", \"0, maximum-\\nscale=1.0, user-scalable=no\\\" /> \\n    <title>BlazorApp1</title> \\n    <base href=\\\"/\\\" /> \\n \", \"   <link href=\\\"css/bootstrap/bootstrap.min.css\\\" rel=\\\"stylesheet\\\" /> \\n    <link href=\\\"css/app.css\\\" re\", \"l=\\\"stylesheet\\\" /> \\n    <link href=\\\"BlazorApp1.styles.css\\\" rel=\\\"stylesheet\\\" /> \\n</head> \\n \\n<body> \\n  \", \"  <div id=\\\"app\\\">Loading...</div> \\n \\n    <div id=\\\"blazor-error-ui\\\"> \\n        An unhandled error has o\", \"ccurred. \\n        <a href=\\\"\\\" class=\\\"reload\\\">Reload</a> \\n        <a class=\\\"dismiss\\\">\\ud83d\\uddd9</a> \\n    </div>\", \" \\n    <script src=\\\"_framework/blazor.webassembly.js\\\"></script> \\n</body> \\n \\n</html> \\nThe root compone\", \"nt to render is specified in the app\\u2019s Program.cs file with the flexibility to register \\nservices th\", \"rough dependency injection. For more information, see ASP.NET Core Blazor dependency \\ninjection. \\nva\", \"r builder = WebAssemblyHostBuilder.CreateDefault(args); \\nbuilder.RootComponents.Add<App>(\\\"#app\\\"); \\nb\", \"uilder.RootComponents.Add<HeadOutlet>(\\\"head::after\\\"); \\nBuild output \\nWhen a Blazor project is built,\", \" all Razor component and code files are compiled into a single \\nassembly. Unlike ASP.NET Web Forms p\", \"rojects, Blazor doesn\\u2019t support runtime compilation of the UI \\nlogic. \\nRun the app with Hot Reload \\n\", \"To run the Blazor Server app, press F5 in Visual Studio to run with the debugger attached, or Ctrl +\", \" F5 \\nto run without the debugger attached. \\nTo run the Blazor WebAssembly app, choose one of the fol\", \"lowing approaches: \\n\\u2022 \\nRun the client project directly using the development server. \\n \\n19 \\nCHAPTER \", \"4 | Project structure for Blazor apps \\n \\n\\u2022 \\nRun the server project when hosting the app with ASP.NET\", \" Core. \\nBlazor WebAssembly apps can be debugged in both browser and Visual Studio. See Debug ASP.NET\", \" \\nCore Blazor WebAssembly for details. \\nBoth Blazor Server and Blazor WebAssembly apps support Hot R\", \"eload in Visual Studio. Hot Reload is \\na feature that automatically updates changes made to a Blazor\", \" app live, in the browser. You can \\ntoggle whether Hot Reload is enabled from its icon in the toolba\", \"r: \\n \\nSelecting the caret beside the icon reveals additional options. You can toggle Hot Reload on o\", \"r off, \\nrestart the application, and toggle whether Hot Reload should occur whenever a file is saved\", \". \\n \\nYou can also access additional configuration options. The configuration dialog lets you specify\", \" \\nwhether Hot Reload should be enabled when debugging (along with Edit and Continue), when \\nstarting\", \" without debugging, or when a file is saved. \\n \\n20 \\nCHAPTER 4 | Project structure for Blazor apps \\n \", \"\\n \\nThe \\u201cdeveloper inner loop\\u201d has been greatly streamlined with Hot Reload. Without Hot Reload, a \\nB\", \"lazor developer would typically need to restart and rerun the app after every change, navigating to \", \"\\nthe appropriate part of the app as required. With Hot Reload, changes can be made to the running \\na\", \"pp without the need to restart in most cases. Hot Reload even retains the state of pages, so there\\u2019s\", \" \\nno need to have to re-enter form values or otherwise get the app back where you need it. \\n \\n21 \\nCH\", \"APTER 5 | App startup \\n \\nCHAPTER 5 \\nApp startup \\nApplications that are written for ASP.NET typically\", \" have a global.asax.cs file that defines the \\nApplication_Start event that controls which services a\", \"re configured and made available for both HTML \\nrendering and .NET processing. This chapter looks at\", \" how things are slightly different with ASP.NET \\nCore and Blazor Server. \\nApplication_Start and Web \", \"Forms \\nThe default web forms Application_Start method has grown in purpose over years to handle many\", \" \\nconfiguration tasks. A fresh web forms project with the default template in Visual Studio 2022 now\", \" \\ncontains the following configuration logic: \\n\\u2022 \\nRouteConfig - Application URL routing \\n\\u2022 \\nBundleCo\", \"nfig - CSS and JavaScript bundling and minification \\nEach of these individual files resides in the A\", \"pp_Start folder and run only once at the start of our \\napplication. RouteConfig in the default proje\", \"ct template adds the FriendlyUrlSettings for web forms to \\nallow application URLs to omit the .ASPX \", \"file extension. The default template also contains a directive \\nthat provides permanent HTTP redirec\", \"t status codes (HTTP 301) for the .ASPX pages to the friendly \\nURL with the file name that omits the\", \" extension. \\nWith ASP.NET Core and Blazor, these methods are either simplified and consolidated into\", \" the Startup \\nclass or they are eliminated in favor of common web technologies. \\nBlazor Server Start\", \"up Structure \\nBlazor Server applications reside on top of an ASP.NET Core 3.0 or later version. ASP.\", \"NET Core web \\napplications are configured in Program.cs, or through a pair of methods in the Startup\", \".cs class. A \\nsample Program.cs file is shown below: \\nusing BlazorApp1.Data; \\nusing Microsoft.AspNet\", \"Core.Components; \\nusing Microsoft.AspNetCore.Components.Web; \\n \\nvar builder = WebApplication.CreateB\", \"uilder(args); \\n \\n// Add services to the container. \\nbuilder.Services.AddRazorPages(); \\nbuilder.Servi\", \"ces.AddServerSideBlazor(); \\nbuilder.Services.AddSingleton<WeatherForecastService>(); \\n \\n \\n22 \\nCHAPTE\", \"R 5 | App startup \\n \\nvar app = builder.Build(); \\n \\n// Configure the HTTP request pipeline. \\nif (!app\", \".Environment.IsDevelopment()) \\n{ \\n    app.UseExceptionHandler(\\\"/Error\\\"); \\n    // The default HSTS va\", \"lue is 30 days. You may want to change this for production \\nscenarios, see https://aka.ms/aspnetcore\", \"-hsts. \\n    app.UseHsts(); \\n} \\n \\napp.UseHttpsRedirection(); \\napp.UseStaticFiles(); \\napp.UseRouting()\", \"; \\napp.MapBlazorHub(); \\napp.MapFallbackToPage(\\\"/_Host\\\"); \\n \\napp.Run(); \\nThe app\\u2019s required services \", \"are added to the WebApplicationBuilder instance\\u2019s Services collection. \\nThis is how the various ASP.\", \"NET Core framework services are configured with the framework\\u2019s built-in \\ndependency injection conta\", \"iner. The various builder.Services.Add* methods add services that enable \\nfeatures such as authentic\", \"ation, razor pages, MVC controller routing, SignalR, and Blazor Server \\ninteractions among many othe\", \"rs. This method was not needed in web forms, as the parsing and \\nhandling of the ASPX, ASCX, ASHX, a\", \"nd ASMX files were defined by referencing ASP.NET in the \\nweb.config configuration file. More inform\", \"ation about dependency injection in ASP.NET Core is \\navailable in the online documentation. \\nAfter t\", \"he app has been built by the builder, the rest of the calls on app configure its HTTP pipeline. \\nWit\", \"h these calls, we declare from top to bottom the Middleware that will handle every request sent to \\n\", \"our application. Most of these features in the default configuration were scattered across the web \\n\", \"forms configuration files and are now in one place for ease of reference. \\nNo longer is the configur\", \"ation of the custom error page placed in a web.config file, but now is \\nconfigured to always be show\", \"n if the application environment is not labeled Development. \\nAdditionally, ASP.NET Core application\", \"s are now configured to serve secure pages with TLS by default \\nwith the UseHttpsRedirection method \", \"call. \\nNext, an unexpected configuration method call is made to UseStaticFiles. In ASP.NET Core, sup\", \"port for \\nrequests for static files (like JavaScript, CSS, and image files) must be explicitly enabl\", \"ed, and only files \\nin the app\\u2019s wwwroot folder are publicly addressable by default. \\nThe next line \", \"is the first that replicates one of the configuration options from web forms: UseRouting. \\nThis meth\", \"od adds the ASP.NET Core router to the pipeline and it can be either configured here or in \\nthe indi\", \"vidual files that it can consider routing to. More information about routing configuration can \\nbe f\", \"ound in the Routing section. \\nThe final app.Map* calls in this section define the endpoints that ASP\", \".NET Core is listening on. These \\nroutes are the web accessible locations that you can access on the\", \" web server and receive some \\ncontent handled by .NET and returned to you. The first entry, MapBlazo\", \"rHub configures a SignalR hub \\nfor use in providing the real-time and persistent connection to the s\", \"erver where the state and \\nrendering of Blazor components is handled. The MapFallbackToPage method c\", \"all indicates the web-\\naccessible location of the page that starts the Blazor application and also c\", \"onfigures the application to \\n \\n23 \\nCHAPTER 5 | App startup \\n \\nhandle deep-linking requests from the\", \" client-side. You will see this feature at work if you open a \\nbrowser and navigate directly to Blaz\", \"or handled route in your application, such as /counter in the \\ndefault project template. The request\", \" gets handled by the *_Host.cshtml* fallback page, which then \\nruns the Blazor router and renders th\", \"e counter page. \\nThe very last line starts the application, something that wasn\\u2019t required in web fo\", \"rms (since it relied on \\nIIS to be running). \\nUpgrading the BundleConfig Process \\nTechnologies for b\", \"undling assets like CSS stylesheets and JavaScript files have changed significantly, \\nwith other tec\", \"hnologies providing quickly evolving tools and techniques for managing these \\nresources. To this end\", \", we recommend using a Node command-line tool such as Grunt / Gulp / \\nWebPack to package your static\", \" assets. \\nThe Grunt, Gulp, and WebPack command-line tools and their associated configurations can be\", \" added \\nto your application and ASP.NET Core will quietly ignore those files during the application \", \"build \\nprocess. You can add a call to run their tasks by adding a Target inside your project file wi\", \"th syntax \\nsimilar to the following that would trigger a gulp script and the min target inside that \", \"script: \\n<Target Name=\\\"MyPreCompileTarget\\\" BeforeTargets=\\\"Build\\\"> \\n  <Exec Command=\\\"gulp min\\\" /> \\n</\", \"Target> \\nMore details about both strategies to manage your CSS and JavaScript files are available in\", \" the Bundle \\nand minify static assets in ASP.NET Core documentation. \\n \\n24 \\nCHAPTER 6 | Build reusab\", \"le UI components with Blazor \\n \\nCHAPTER 6 \\nBuild reusable UI \\ncomponents with Blazor \\nOne of the bea\", \"utiful things about ASP.NET Web Forms is how it enables encapsulation of reusable \\npieces of user in\", \"terface (UI) code into reusable UI controls. Custom user controls can be defined in \\nmarkup using .a\", \"scx files. You can also build elaborate server controls in code with full designer \\nsupport. \\nBlazor\", \" also supports UI encapsulation through components. A component: \\n\\u2022 \\nIs a self-contained chunk of UI\", \". \\n\\u2022 \\nMaintains its own state and rendering logic. \\n\\u2022 \\nCan define UI event handlers, bind to input d\", \"ata, and manage its own lifecycle. \\n\\u2022 \\nIs typically defined in a .razor file using Razor syntax. \\nAn\", \" introduction to Razor \\nRazor is a light-weight markup templating language based on HTML and C#. Wit\", \"h Razor, you can \\nseamlessly transition between markup and C# code to define your component renderin\", \"g logic. When \\nthe .razor file is compiled, the rendering logic is captured in a structured way in a\", \" .NET class. The name \\nof the compiled class is taken from the .razor file name. The namespace is ta\", \"ken from the default \\nnamespace for the project and the folder path, or you can explicitly specify t\", \"he namespace using the \\n@namespace directive (more on Razor directives below). \\nA component\\u2019s render\", \"ing logic is authored using normal HTML markup with dynamic logic added \\nusing C#. The @ character i\", \"s used to transition to C#. Razor is typically smart about figuring out when \\nyou\\u2019ve switched back t\", \"o HTML. For example, the following component renders a <p> tag with the \\ncurrent time: \\n<p>@DateTime\", \".Now</p> \\nTo explicitly specify the beginning and ending of a C# expression, use parentheses: \\n<p>@(\", \"DateTime.Now)</p> \\nRazor also makes it easy to use C# control flow in your rendering logic. For exam\", \"ple, you can \\nconditionally render some HTML like this: \\n \\n25 \\nCHAPTER 6 | Build reusable UI compone\", \"nts with Blazor \\n \\n@if (value % 2 == 0) \\n{ \\n    <p>The value was even.</p> \\n} \\nOr you can generate a\", \" list of items using a normal C# foreach loop like this: \\n<ul> \\n@foreach (var item in items) \\n{ \\n   \", \" <li>@item.Text</li> \\n} \\n</ul> \\nRazor directives, like directives in ASP.NET Web Forms, control many\", \" aspects of how a Razor \\ncomponent is compiled. Examples include the component\\u2019s: \\n\\u2022 \\nNamespace \\n\\u2022 \\n\", \"Base class \\n\\u2022 \\nImplemented interfaces \\n\\u2022 \\nGeneric parameters \\n\\u2022 \\nImported namespaces \\n\\u2022 \\nRoutes \\nRaz\", \"or directives start with the @ character and are typically used at the start of a new line at the st\", \"art \\nof the file. For example, the @namespace directive defines the component\\u2019s namespace: \\n@namespa\", \"ce MyComponentNamespace  \\nThe following table summarizes the various Razor directives used in Blazor\", \" and their ASP.NET Web \\nForms equivalents, if they exist. \\nDirective \\nDescription \\nExample \\nWeb Form\", \"s equivalent \\n@attribute \\nAdds a class-level \\nattribute to the \\ncomponent \\n@attribute \\n[Authorize] \\n\", \"None \\n@code \\nAdds class \\nmembers to the \\ncomponent \\n@code { ... } \\n<script runat=\\\"server\\\">...</scrip\", \"t> \\n@implements \\nImplements the \\nspecified interface \\n@impleme\\nnts \\nIDisposable \\nUse code-behind \\n@i\", \"nherits \\nInherits from the \\nspecified base class \\n@inherits \\nMyCompon\\nentBase \\n<%@ Control \\nInherits\", \"=\\\"MyUserControlBase\\\" %> \\n@inject \\nInjects a service \\ninto the component \\n@inject \\nIJSRuntime \\nJS \\nNo\", \"ne \\n \\n26 \\nCHAPTER 6 | Build reusable UI components with Blazor \\n \\nDirective \\nDescription \\nExample \\nW\", \"eb Forms equivalent \\n@layout \\nSpecifies a layout \\ncomponent for the \\ncomponent \\n@layout \\nMainLayout \", \"\\n<%@ Page \\nMasterPageFile=\\\"~/Site.Master\\\" %> \\n@namespace \\nSets the namespace \\nfor the component \\n@na\", \"mespa\\nce \\nMyNamesp\\nace \\nNone \\n@page \\nSpecifies the route \\nfor the component \\n@page \\n\\\"/product/{i\\nd}\\\"\", \" \\n<%@ Page %> \\n@typeparam \\nSpecifies a generic \\ntype parameter for \\nthe component \\n@typepara\\nm TItem\", \" \\nUse code-behind \\n@using \\nSpecifies a \\nnamespace to bring \\ninto scope \\n@using \\nMyCompon\\nentNamesp\\na\", \"ce \\nAdd namespace in web.config \\nRazor components also make extensive use of directive attributes on\", \" elements to control various \\naspects of how components get compiled (event handling, data binding, \", \"component & element \\nreferences, and so on). Directive attributes all follow a common generic syntax\", \" where the values in \\nparenthesis are optional: \\n@directive(-suffix(:name))(=\\\"value\\\") \\nThe following\", \" table summarizes the various attributes for Razor directives used in Blazor. \\nAttribute \\nDescriptio\", \"n \\nExample \\n@attributes \\nRenders a dictionary of attributes \\n<input \\n@attributes=\\\"ExtraA\\nttributes\\\" \", \"/> \\n@bind \\nCreates a two-way data binding \\n<input \\n@bind=\\\"username\\\" \\n@bind:event=\\\"oninp\\nut\\\" /> \\n@on{\", \"event} \\nAdds an event handler for the \\nspecified event \\n<button \\n@onclick=\\\"Incremen\\ntCount\\\">Click \\nm\", \"e!</button> \\n@key \\nSpecifies a key to be used by the \\ndiffing algorithm for preserving \\nelements in \", \"a collection \\n<DetailsEditor \\n@key=\\\"person\\\" \\nDetails=\\\"person.Det\\nails\\\" /> \\n \\n27 \\nCHAPTER 6 | Build r\", \"eusable UI components with Blazor \\n \\nAttribute \\nDescription \\nExample \\n@ref \\nCaptures a reference to \", \"the \\ncomponent or HTML element \\n<MyDialog \\n@ref=\\\"myDialog\\\" /> \\nThe various directive attributes used\", \" by Blazor (@onclick, @bind, @ref, and so on) are covered in the \\nsections below and later chapters.\", \" \\nMany of the syntaxes used in .aspx and .ascx files have parallel syntaxes in Razor. Below is a sim\", \"ple \\ncomparison of the syntaxes for ASP.NET Web Forms and Razor. \\nFeature \\nWeb Forms \\nSyntax \\nRazor \", \"\\nSynt\\nax \\nDirectives \\n<%@ [directive] %> \\n<%@ Page %> \\n@[directive] \\n@pa\\nge \\nCode blocks \\n<% %> \\n<% \", \"int x = 123; %> \\n@{ } \\n@{ \\nint x \\n= \\n123; } \\nExpressions \\n(HTML-encoded) \\n<%: %> \\n<%:DateTime.Now \\n%\", \"> \\nImplicit: @ \\nExplicit: @() \\n@Da\\nteTi\\nme.N\\now \\n@(Da\\nteTi\\nme.N\\now) \\nComments \\n<%-- --%> \\n<%-- Comme\", \"nted --\\n%> \\n@* *@ \\n@* \\nCom\\nment\\ned \\n*@ \\nData binding \\n<%# %> \\n<%# Bind(\\\"Name\\\") \\n%> \\n@bind \\n<inp\\nut \\n\", \"@bin\\nd=\\\"u\\nserna\\nme\\\" \\n/> \\nTo add members to the Razor component class, use the @code directive. This \", \"technique is similar to \\nusing a <script runat=\\\"server\\\">...</script> block in an ASP.NET Web Forms u\", \"ser control or page. \\n@code { \\n    int count = 0; \\n \\n    void IncrementCount() \\n    { \\n        count\", \"++; \\n \\n28 \\nCHAPTER 6 | Build reusable UI components with Blazor \\n \\n    } \\n} \\nBecause Razor is based \", \"on C#, it must be compiled from within a C# project (.csproj). You can\\u2019t \\ncompile .razor files from \", \"a Visual Basic project (.vbproj). You can still reference Visual Basic projects \\nfrom your Blazor pr\", \"oject. The opposite is true too. \\nFor a full Razor syntax reference, see Razor syntax reference for \", \"ASP.NET Core. \\nUse components \\nAside from normal HTML, components can also use other components as p\", \"art of their rendering logic. \\nThe syntax for using a component in Razor is similar to using a user \", \"control in an ASP.NET Web Forms \\napp. Components are specified using an element tag that matches the\", \" type name of the component. \\nFor example, you can add a Counter component like this: \\n<Counter /> \\n\", \"Unlike ASP.NET Web Forms, components in Blazor: \\n\\u2022 \\nDon\\u2019t use an element prefix (for example, asp:).\", \" \\n\\u2022 \\nDon\\u2019t require registration on the page or in the web.config. \\nThink of Razor components like yo\", \"u would .NET types, because that\\u2019s exactly what they are. If the \\nassembly containing the component \", \"is referenced, then the component is available for use. To bring \\nthe component\\u2019s namespace into sco\", \"pe, apply the @using directive: \\n@using MyComponentLib \\n \\n<Counter /> \\nAs seen in the default Blazor\", \" projects, it\\u2019s common to put @using directives into a *_Imports.razor* file \\nso that they\\u2019re import\", \"ed into all .razor files in the same directory and in child directories. \\nIf the namespace for a com\", \"ponent isn\\u2019t in scope, you can specify a component using its full type \\nname, as you can in C#: \\n<My\", \"ComponentLib.Counter /> \\nModify page title from components \\nWhen building SPA-style apps, it\\u2019s commo\", \"n for parts of a page to reload without reloading the entire \\npage. Even so, it can be useful to hav\", \"e the title of the page change based on which component is \\ncurrently loaded. This can be accomplish\", \"ed by including the <PageTitle> tag in the component\\u2019s \\nRazor page: \\n@page \\\"/\\\" \\n<PageTitle>Home</Pag\", \"eTitle> \\nThe contents of this element can be dynamic, for instance showing the current count of mess\", \"ages: \\n \\n29 \\nCHAPTER 6 | Build reusable UI components with Blazor \\n \\n<PageTitle>@MessageCount messag\", \"es</PageTitle> \\nNote that if several components on a particular page include <PageTitle> tags, only \", \"the last one will \\nbe displayed (since each one will overwrite the previous one). \\nComponent paramet\", \"ers \\nIn ASP.NET Web Forms, you can flow parameters and data to controls using public properties. The\", \"se \\nproperties can be set in markup using attributes or set directly in code. Razor components work \", \"in a \\nsimilar fashion, although the component properties must also be marked with the [Parameter] \\na\", \"ttribute to be considered component parameters. \\nThe following Counter component defines a component\", \" parameter called IncrementAmount that can \\nbe used to specify the amount that the Counter should be\", \" incremented each time the button is \\nclicked. \\n<h1>Counter</h1> \\n \\n<p>Current count: @currentCount<\", \"/p> \\n \\n<button class=\\\"btn btn-primary\\\" @onclick=\\\"IncrementCount\\\">Click me</button> \\n \\n@code { \\n    i\", \"nt currentCount = 0; \\n \\n    [Parameter] \\n    public int IncrementAmount { get; set; } = 1; \\n \\n    vo\", \"id IncrementCount() \\n    { \\n        currentCount+=IncrementAmount; \\n    } \\n} \\nTo specify a component\", \" parameter in Blazor, use an attribute as you would in ASP.NET Web Forms: \\n<Counter IncrementAmount=\", \"\\\"10\\\" /> \\nQuery string parameters \\nRazor components can also leverage values from the query string of\", \" the page they\\u2019re rendered on as \\na parameter source. To enable this, add the [SupplyParameterFromQu\", \"ery] attribute to the parameter. \\nFor example, the following parameter definition would get its valu\", \"e from the request in the form \\n?IncBy=2: \\n[Parameter] \\n[SupplyParameterFromQuery(Name = \\\"IncBy\\\")] \\n\", \"public int IncrementAmount { get; set; } = 1; \\nIf you don\\u2019t supply a custom Name in the [SupplyParam\", \"eterFromQuery] attribute, by default it will \\nmatch the property name (IncrementAmount in this case)\", \". \\n \\n30 \\nCHAPTER 6 | Build reusable UI components with Blazor \\n \\nComponents and error boundaries \\nBy\", \" default, Blazor apps will detect unhandled exceptions and show an error message at the bottom of \\nt\", \"he page with no additional detail. To constrain the parts of the app that are impacted by an \\nunhand\", \"led error, for instance to limit the impact to a single component, the <ErrorBoundary> tag can \\nbe w\", \"rapped around component declarations. \\nFor example, to protect against possible exceptions thrown fr\", \"om the Counter component, declare it \\nwithin an <ErrorBoundary> and optionally specify a message to \", \"display if there is an exception: \\n<ErrorBoundary> \\n    <ChildContent> \\n        <Counter /> \\n    </C\", \"hildContent> \\n    <ErrorContent> \\n        Oops! The counter isn't working right now; please try agai\", \"n later. \\n    </ErrorContent> \\n</ErrorBoundary> \\nIf you don\\u2019t need to specify custom error content, \", \"you can just wrap the component \\ndirectly: \\n<ErrorBoundary> \\n  <Counter /> \\n</ErrorBoundary> \\nA defa\", \"ult message stating \\u201cAn error as occurred.\\u201d will be displayed if an unhandled exception occurs \\nin t\", \"he wrapped component. \\nEvent handlers \\nBoth ASP.NET Web Forms and Blazor provide an event-based prog\", \"ramming model for handling UI \\nevents. Examples of such events include button clicks and text input.\", \" In ASP.NET Web Forms, you use \\nHTML server controls to handle UI events exposed by the DOM, or you \", \"can handle events exposed by \\nweb server controls. The events are surfaced on the server through for\", \"m post-back requests. Consider \\nthe following Web Forms button click example: \\nCounter.ascx \\n<asp:Bu\", \"tton ID=\\\"ClickMeButton\\\" runat=\\\"server\\\" Text=\\\"Click me!\\\" \\nOnClick=\\\"ClickMeButton_Click\\\" /> \\nCounter.a\", \"scx.cs \\npublic partial class Counter : System.Web.UI.UserControl \\n{ \\n    protected void ClickMeButto\", \"n_Click(object sender, EventArgs e) \\n    { \\n        Console.WriteLine(\\\"The button was clicked!\\\"); \\n \", \"   } \\n} \\nIn Blazor, you can register handlers for DOM UI events directly using directive attributes \", \"of the form \\n@on{event}. The {event} placeholder represents the name of the event. For example, you \", \"can listen for \\nbutton clicks like this: \\n \\n31 \\nCHAPTER 6 | Build reusable UI components with Blazor\", \" \\n \\n<button @onclick=\\\"OnClick\\\">Click me!</button> \\n \\n@code { \\n    void OnClick() \\n    { \\n        Con\", \"sole.WriteLine(\\\"The button was clicked!\\\"); \\n    } \\n} \\nEvent handlers can accept an optional, event-s\", \"pecific argument to provide more information about \\nthe event. For example, mouse events can take a \", \"MouseEventArgs argument, but it isn\\u2019t required. \\n<button @onclick=\\\"OnClick\\\">Click me!</button> \\n \\n@c\", \"ode { \\n    void OnClick(MouseEventArgs e) \\n    { \\n        Console.WriteLine($\\\"Mouse clicked at {e.Sc\", \"reenX}, {e.ScreenY}.\\\"); \\n    } \\n} \\nInstead of referring to a method group for an event handler, you \", \"can use a lambda expression. A \\nlambda expression allows you to close over other in-scope values. \\n@\", \"foreach (var buttonLabel in buttonLabels) \\n{ \\n    <button @onclick=\\\"() => Console.WriteLine($\\\"The {b\", \"uttonLabel} button was \\nclicked!\\\")\\\">@buttonLabel</button> \\n} \\nEvent handlers can execute synchronous\", \"ly or asynchronously. For example, the following OnClick \\nevent handler executes asynchronously: \\n<b\", \"utton @onclick=\\\"OnClick\\\">Click me!</button> \\n \\n@code { \\n    async Task OnClick() \\n    { \\n        var\", \" result = await Http.GetAsync(\\\"api/values\\\"); \\n    } \\n} \\nAfter an event is handled, the component is \", \"rendered to account for any component state changes. \\nWith asynchronous event handlers, the componen\", \"t is rendered immediately after the handler \\nexecution completes. The component is rendered again af\", \"ter the asynchronous Task completes. This \\nasynchronous execution mode provides an opportunity to re\", \"nder some appropriate UI while the \\nasynchronous Task is still in progress. \\n<button @onclick=\\\"ShowM\", \"essage\\\">Get message</button> \\n \\n@if (showMessage) \\n{ \\n    @if (message == null) \\n    { \\n        <p><\", \"em>Loading...</em></p> \\n    } \\n    else \\n \\n32 \\nCHAPTER 6 | Build reusable UI components with Blazor \", \"\\n \\n    { \\n        <p>The message is: @message</p> \\n    } \\n} \\n \\n@code \\n{ \\n    bool showMessage = fals\", \"e; \\n    string message; \\n \\n    public async Task ShowMessage() \\n    { \\n        showMessage = true; \\n\", \"        message = await MessageService.GetMessageAsync(); \\n    } \\n} \\nComponents can also define thei\", \"r own events by defining a component parameter of type \\nEventCallback<TValue>. Event callbacks suppo\", \"rt all the variations of DOM UI event handlers: optional \\narguments, synchronous or asynchronous, me\", \"thod groups, or lambda expressions. \\n<button class=\\\"btn btn-primary\\\" @onclick=\\\"OnClick\\\">Click me!</b\", \"utton> \\n \\n@code { \\n    [Parameter] \\n    public EventCallback<MouseEventArgs> OnClick { get; set; } \\n\", \"} \\nData binding \\nBlazor provides a simple mechanism to bind data from a UI component to the componen\", \"t\\u2019s state. This \\napproach differs from the features in ASP.NET Web Forms for binding data from data \", \"sources to UI \\ncontrols. We\\u2019ll cover handling data from different data sources in the Dealing with d\", \"ata section. \\nTo create a two-way data binding from a UI component to the component\\u2019s state, use the\", \" @bind \\ndirective attribute. In the following example, the value of the check box is bound to the is\", \"Checked \\nfield. \\n<input type=\\\"checkbox\\\" @bind=\\\"isChecked\\\" /> \\n \\n@code { \\n    bool isChecked; \\n} \\nWhe\", \"n the component is rendered, the value of the checkbox is set to the value of the isChecked field. \\n\", \"When the user toggles the checkbox, the onchange event is fired and the isChecked field is set to th\", \"e \\nnew value. The @bind syntax in this case is equivalent to the following markup: \\n<input value=\\\"@i\", \"sChecked\\\" @onchange=\\\"(UIChangeEventArgs e) => isChecked = e.Value\\\" /> \\nTo change the event used for \", \"the bind, use the @bind:event attribute. \\n<input @bind=\\\"text\\\" @bind:event=\\\"oninput\\\" /> \\n<p>@text</p>\", \" \\n \\n \\n33 \\nCHAPTER 6 | Build reusable UI components with Blazor \\n \\n@code { \\n    string text; \\n} \\nComp\", \"onents can also support data binding to their parameters. To data bind, define an event callback \\npa\", \"rameter with the same name as the bindable parameter. The \\u201cChanged\\u201d suffix is added to the \\nname. \\nP\", \"asswordBox.razor \\nPassword: <input \\n    value=\\\"@Password\\\" \\n    @oninput=\\\"OnPasswordChanged\\\" \\n    typ\", \"e=\\\"@(showPassword ? \\\"text\\\" : \\\"password\\\")\\\" /> \\n \\n<label><input type=\\\"checkbox\\\" @bind=\\\"showPassword\\\" /\", \">Show password</label> \\n \\n@code { \\n    private bool showPassword; \\n \\n    [Parameter] \\n    public str\", \"ing Password { get; set; } \\n \\n    [Parameter] \\n    public EventCallback<string> PasswordChanged { ge\", \"t; set; } \\n \\n    private Task OnPasswordChanged(ChangeEventArgs e) \\n    { \\n        Password = e.Valu\", \"e.ToString(); \\n        return PasswordChanged.InvokeAsync(Password); \\n    } \\n} \\nTo chain a data bind\", \"ing to an underlying UI element, set the value and handle the event directly on \\nthe UI element inst\", \"ead of using the @bind attribute. \\nTo bind to a component parameter, use a @bind-{Parameter} attribu\", \"te to specify the parameter to \\nwhich you want to bind. \\n<PasswordBox @bind-Password=\\\"password\\\" /> \\n\", \" \\n@code { \\n    string password; \\n} \\nState changes \\nIf the component\\u2019s state has changed outside of a\", \" normal UI event or event callback, then the \\ncomponent must manually signal that it needs to be ren\", \"dered again. To signal that a component\\u2019s \\nstate has changed, call the StateHasChanged method on the\", \" component. \\nIn the example below, a component displays a message from an AppState service that can \", \"be updated \\nby other parts of the app. The component registers its StateHasChanged method with the \\n\", \"AppState.OnChange event so that the component is rendered whenever the message gets updated. \\n \\n34 \\n\", \"CHAPTER 6 | Build reusable UI components with Blazor \\n \\npublic class AppState \\n{ \\n    public string \", \"Message { get; } \\n \\n    // Lets components receive change notifications \\n    public event Action OnC\", \"hange; \\n \\n    public void UpdateMessage(string message) \\n    { \\n        Message = message; \\n        \", \"NotifyStateChanged(); \\n    } \\n \\n    private void NotifyStateChanged() => OnChange?.Invoke(); \\n} \\n \\n \", \"\\n@inject AppState AppState \\n \\n<p>App message: @AppState.Message</p> \\n \\n@code { \\n    protected overri\", \"de void OnInitialized() \\n    { \\n        AppState.OnChange += StateHasChanged \\n    } \\n} \\nComponent li\", \"fecycle \\nThe ASP.NET Web Forms framework has well-defined lifecycle methods for modules, pages, and \", \"\\ncontrols. For example, the following control implements event handlers for the Init, Load, and UnLo\", \"ad \\nlifecycle events: \\nCounter.ascx.cs \\npublic partial class Counter : System.Web.UI.UserControl \\n{ \", \"\\n    protected void Page_Init(object sender, EventArgs e) { ... } \\n    protected void Page_Load(obje\", \"ct sender, EventArgs e) { ... } \\n    protected void Page_UnLoad(object sender, EventArgs e) { ... } \", \"\\n} \\nRazor components also have a well-defined lifecycle. A component\\u2019s lifecycle can be used to init\", \"ialize \\ncomponent state and implement advanced component behaviors. \\nAll of Blazor\\u2019s component lifec\", \"ycle methods have both synchronous and asynchronous versions. \\nComponent rendering is synchronous. Y\", \"ou can\\u2019t run asynchronous logic as part of the component \\nrendering. All asynchronous logic must exe\", \"cute as part of an async lifecycle method. \\nOnInitialized \\nThe OnInitialized and OnInitializedAsync \", \"methods are used to initialize the component. A component \\nis typically initialized after it\\u2019s first\", \" rendered. After a component is initialized, it may be rendered \\n \\n35 \\nCHAPTER 6 | Build reusable UI\", \" components with Blazor \\n \\nmultiple times before it\\u2019s eventually disposed. The OnInitialized method \", \"is similar to the Page_Load \\nevent in ASP.NET Web Forms pages and controls. \\nprotected override void\", \" OnInitialized() { ... } \\nprotected override async Task OnInitializedAsync() { await ... } \\nOnParame\", \"tersSet \\nThe OnParametersSet and OnParametersSetAsync methods are called when a component has \\nrecei\", \"ved parameters from its parent and the value are assigned to properties. These methods are \\nexecuted\", \" after component initialization and each time the component is rendered. \\nprotected override void On\", \"ParametersSet() { ... } \\nprotected override async Task OnParametersSetAsync() { await ... } \\nOnAfter\", \"Render \\nThe OnAfterRender and OnAfterRenderAsync methods are called after a component has finished \\n\", \"rendering. Element and component references are populated at this point (more on these concepts \\nbel\", \"ow). Interactivity with the browser is enabled at this point. Interactions with the DOM and \\nJavaScr\", \"ipt execution can safely take place. \\nprotected override void OnAfterRender(bool firstRender) \\n{ \\n  \", \"  if (firstRender) \\n    { \\n        ... \\n    } \\n} \\nprotected override async Task OnAfterRenderAsync(b\", \"ool firstRender) \\n{ \\n    if (firstRender) \\n    { \\n        await ... \\n    } \\n} \\nOnAfterRender and OnA\", \"fterRenderAsync aren\\u2019t called when prerendering on the server. \\nThe firstRender parameter is true th\", \"e first time the component is rendered; otherwise, its value is false. \\nIDisposable \\nRazor component\", \"s can implement IDisposable to dispose of resources when the component is \\nremoved from the UI. A Ra\", \"zor component can implement IDispose by using the @implements \\ndirective: \\n@using System \\n@implement\", \"s IDisposable \\n \\n... \\n \\n@code { \\n    public void Dispose() \\n \\n36 \\nCHAPTER 6 | Build reusable UI comp\", \"onents with Blazor \\n \\n    { \\n        ... \\n    } \\n} \\nCapture component references \\nIn ASP.NET Web For\", \"ms, it\\u2019s common to manipulate a control instance directly in code by referring to \\nits ID. In Blazor\", \", it\\u2019s also possible to capture and manipulate a reference to a component, although it\\u2019s \\nmuch less \", \"common. \\nTo capture a component reference in Blazor, use the @ref directive attribute. The value of \", \"the \\nattribute should match the name of a settable field with the same type as the referenced compon\", \"ent. \\n<MyLoginDialog @ref=\\\"loginDialog\\\" ... /> \\n \\n@code { \\n    MyLoginDialog loginDialog = default!;\", \" \\n \\n    void OnSomething() \\n    { \\n        loginDialog.Show(); \\n    } \\n} \\nWhen the parent component \", \"is rendered, the field is populated with the child component instance. \\nYou can then call methods on\", \", or otherwise manipulate, the component instance. \\nManipulating component state directly using comp\", \"onent references isn\\u2019t recommended. Doing so \\nprevents the component from being rendered automatical\", \"ly at the correct times. \\nCapture element references \\nRazor components can capture references to an \", \"element. Unlike HTML server controls in ASP.NET \\nWeb Forms, you can\\u2019t manipulate the DOM directly us\", \"ing an element reference in Blazor. Blazor \\nhandles most DOM interactions for you using its DOM diff\", \"ing algorithm. Captured element references \\nin Blazor are opaque. However, they\\u2019re used to pass a sp\", \"ecific element reference in a JavaScript \\ninterop call. For more information about JavaScript intero\", \"p, see ASP.NET Core Blazor JavaScript \\ninterop. \\nTemplated components \\nIn ASP.NET Web Forms, you can\", \" create templated controls. Templated controls enable the developer \\nto specify a portion of the HTM\", \"L used to render a container control. The mechanics of building \\ntemplated server controls are compl\", \"ex, but they enable powerful scenarios for rendering data in a \\nuser customizable way. Examples of t\", \"emplated controls include Repeater and DataList. \\nRazor components can also be templated by defining\", \" component parameters of type \\nRenderFragment or RenderFragment<T>. A RenderFragment represents a ch\", \"unk of Razor markup \\n \\n37 \\nCHAPTER 6 | Build reusable UI components with Blazor \\n \\nthat can then be \", \"rendered by the component. A RenderFragment<T> is a chunk of Razor markup that \\ntakes a parameter th\", \"at can be specified when the render fragment is rendered. \\nChild content \\nRazor components can captu\", \"re their child content as a RenderFragment and render that content as \\npart of the component renderi\", \"ng. To capture child content, define a component parameter of type \\nRenderFragment and name it Child\", \"Content. \\nChildContentComponent.razor \\n<h1>Component with child content</h1> \\n \\n<div>@ChildContent</\", \"div> \\n \\n@code { \\n    [Parameter] \\n    public RenderFragment ChildContent { get; set; } \\n} \\nA parent \", \"component can then supply child content using normal Razor syntax. \\n<ChildContentComponent> \\n    <Ch\", \"ildContent> \\n        <p>The time is @DateTime.Now</p> \\n    </ChildContent> \\n</ChildContentComponent>\", \" \\nTemplate parameters \\nA templated Razor component can also define multiple component parameters of \", \"type \\nRenderFragment or RenderFragment<T>. The parameter for a RenderFragment<T> can be specified \\nw\", \"hen it\\u2019s invoked. To specify a generic type parameter for a component, use the @typeparam Razor \\ndir\", \"ective. \\nSimpleListView.razor \\n@typeparam TItem \\n \\n@Heading \\n \\n<ul> \\n@foreach (var item in Items) \\n{\", \" \\n    <li>@ItemTemplate(item)</li> \\n} \\n</ul> \\n \\n@code { \\n    [Parameter] \\n    public RenderFragment \", \"Heading { get; set; } \\n \\n    [Parameter] \\n    public RenderFragment<TItem> ItemTemplate { get; set; \", \"} \\n \\n    [Parameter] \\n    public IEnumerable<TItem> Items { get; set; } \\n} \\n \\n38 \\nCHAPTER 6 | Build \", \"reusable UI components with Blazor \\n \\nWhen using a templated component, the template parameters can \", \"be specified using child elements \\nthat match the names of the parameters. Component arguments of ty\", \"pe RenderFragment<T> passed \\nas elements have an implicit parameter named context. You can change th\", \"e name of this implement \\nparameter using the Context attribute on the child element. Any generic ty\", \"pe parameters can be \\nspecified using an attribute that matches the name of the type parameter. The \", \"type parameter will be \\ninferred if possible: \\n<SimpleListView Items=\\\"messages\\\" TItem=\\\"string\\\"> \\n   \", \" <Heading> \\n        <h1>My list</h1> \\n    </Heading> \\n    <ItemTemplate Context=\\\"message\\\"> \\n        \", \"<p>The message is: @message</p> \\n    </ItemTemplate> \\n</SimpleListView> \\nThe output of this componen\", \"t looks like this: \\n<h1>My list</h1> \\n<ul> \\n    <li><p>The message is: message1</p></li> \\n    <li><p\", \">The message is: message2</p></li> \\n<ul> \\nCode-behind \\nA Razor component is typically authored in a \", \"single .razor file. However, it\\u2019s also possible to separate \\nthe code and markup using a code-behind\", \" file. To use a component file, add a C# file that matches \\nthe file name of the component file but \", \"with a .cs extension added (Counter.razor.cs). Use the C# file \\nto define a base class for the compo\", \"nent. You can name the base class anything you\\u2019d like, but it\\u2019s \\ncommon to name the class the same a\", \"s the component class, but with a Base extension added \\n(CounterBase). The component-based class mus\", \"t also derive from ComponentBase. Then, in the Razor \\ncomponent file, add the @inherits directive to\", \" specify the base class for the component (@inherits \\nCounterBase). \\nCounter.razor \\n@inherits Counte\", \"rBase \\n \\n<h1>Counter</h1> \\n \\n<p>Current count: @currentCount</p> \\n \\n<button @onclick=\\\"IncrementCount\", \"\\\">Click me</button> \\nCounter.razor.cs \\npublic class CounterBase : ComponentBase \\n{ \\n    protected in\", \"t currentCount = 0; \\n \\n    protected void IncrementCount() \\n    { \\n        currentCount++; \\n    } \\n}\", \" \\n \\n39 \\nCHAPTER 6 | Build reusable UI components with Blazor \\n \\nThe visibility of the component\\u2019s me\", \"mbers in the base class must be protected or public to be visible \\nto the component class. \\nAddition\", \"al resources \\nThe preceding isn\\u2019t an exhaustive treatment of all aspects of Razor components. For mo\", \"re information \\non how to Create and use ASP.NET Core Razor components, see the Blazor documentation\", \". \\n \\n40 \\nCHAPTER 7 | Pages, routing, and layouts \\n \\nCHAPTER 7 \\nPages, routing, and \\nlayouts \\nASP.NET\", \" Web Forms apps are composed of pages defined in .aspx files. Each page\\u2019s address is based \\non its p\", \"hysical file path in the project. When a browser makes a request to the page, the contents of \\nthe p\", \"age are dynamically rendered on the server. The rendering accounts for both the page\\u2019s HTML \\nmarkup \", \"and its server controls. \\nIn Blazor, each page in the app is a component, typically defined in a .ra\", \"zor file, with one or more \\nspecified routes. Routing mostly happens client-side without involving a\", \" specific server request. The \\nbrowser first makes a request to the root address of the app. A root \", \"Router component in the Blazor \\napp then handles intercepting navigation requests and forwards them \", \"to the correct component. \\nBlazor also supports deep linking. Deep linking occurs when the browser m\", \"akes a request to a specific \\nroute other than the root of the app. Requests for deep links sent to \", \"the server are routed to the \\nBlazor app, which then routes the request client-side to the correct c\", \"omponent. \\nA simple page in ASP.NET Web Forms might contain the following markup: \\nName.aspx \\n<%@ Pa\", \"ge Title=\\\"Name\\\" Language=\\\"C#\\\" MasterPageFile=\\\"~/Site.Master\\\" AutoEventWireup=\\\"true\\\" \\nCodeBehind=\\\"Nam\", \"e.aspx.cs\\\" Inherits=\\\"WebApplication1.Name\\\" %> \\n \\n<asp:Content ID=\\\"BodyContent\\\" ContentPlaceHolderID=\", \"\\\"MainContent\\\" runat=\\\"server\\\"> \\n    <div> \\n        What is your name?<br /> \\n        <asp:TextBox ID=\", \"\\\"TextBox1\\\" runat=\\\"server\\\"></asp:TextBox> \\n        <asp:Button ID=\\\"Button1\\\" runat=\\\"server\\\" Text=\\\"Subm\", \"it\\\" OnClick=\\\"Button1_Click\\\" /> \\n    </div> \\n    <div> \\n        <asp:Literal ID=\\\"Literal1\\\" runat=\\\"ser\", \"ver\\\" /> \\n    </div> \\n</asp:Content> \\nName.aspx.cs \\npublic partial class Name : System.Web.UI.Page \\n{\", \" \\n    protected void Button1_Click1(object sender, EventArgs e) \\n    { \\n        Literal1.Text = \\\"Hel\", \"lo \\\" + TextBox1.Text; \\n    } \\n} \\n \\n41 \\nCHAPTER 7 | Pages, routing, and layouts \\n \\nThe equivalent pag\", \"e in a Blazor app would look like this: \\nName.razor \\n@page \\\"/Name\\\" \\n@layout MainLayout \\n \\n<div> \\n   \", \" What is your name?<br /> \\n    <input @bind=\\\"text\\\" /> \\n    <button @onclick=\\\"OnClick\\\">Submit</button\", \"> \\n</div> \\n<div> \\n    @if (name != null) \\n    { \\n        @:Hello @name \\n    } \\n</div> \\n \\n@code { \\n  \", \"  string text; \\n    string name; \\n \\n    void OnClick() { \\n        name = text; \\n    } \\n} \\nCreate pag\", \"es \\nTo create a page in Blazor, create a component and add the @page Razor directive to specify the \", \"\\nroute for the component. The @page directive takes a single parameter, which is the route template \", \"\\nto add to that component. \\n@page \\\"/counter\\\" \\nThe route template parameter is required. Unlike ASP.N\", \"ET Web Forms, the route to a Blazor \\ncomponent isn\\u2019t inferred from its file location (although that \", \"may be a feature added in the future). \\nThe route template syntax is the same basic syntax used for \", \"routing in ASP.NET Web Forms. Route \\nparameters are specified in the template using braces. Blazor w\", \"ill bind route values to component \\nparameters with the same name (case-insensitive). \\n@page \\\"/produ\", \"ct/{id}\\\" \\n \\n<h1>Product @Id</h1> \\n \\n@code { \\n    [Parameter] \\n    public string Id { get; set; } \\n} \", \"\\nYou can also specify constraints on the value of the route parameter. For example, to constrain the\", \" \\nproduct ID to be an int: \\n \\n42 \\nCHAPTER 7 | Pages, routing, and layouts \\n \\n@page \\\"/product/{id:int\", \"}\\\" \\n \\n<h1>Product @Id</h1> \\n \\n@code { \\n    [Parameter] \\n    public int Id { get; set; } \\n} \\nFor a fu\", \"ll list of the route constraints supported by Blazor, see Route constraints. \\nRouter component \\nRout\", \"ing in Blazor is handled by the Router component. The Router component is typically used in the \\napp\", \"\\u2019s root component (App.razor). \\n<Router AppAssembly=\\\"@typeof(Program).Assembly\\\"> \\n    <Found Context\", \"=\\\"routeData\\\"> \\n        <RouteView RouteData=\\\"@routeData\\\" DefaultLayout=\\\"@typeof(MainLayout)\\\" /> \\n   \", \" </Found> \\n    <NotFound> \\n        <LayoutView Layout=\\\"@typeof(MainLayout)\\\"> \\n            <p>Sorry, \", \"there's nothing at this address.</p> \\n        </LayoutView> \\n    </NotFound> \\n</Router> \\nThe Router \", \"component discovers the routable components in the specified AppAssembly and in the \\noptionally spec\", \"ified AdditionalAssemblies. When the browser navigates, the Router intercepts the \\nnavigation and re\", \"nders the contents of its Found parameter with the extracted RouteData if a route \\nmatches the addre\", \"ss, otherwise the Router renders its NotFound parameter. \\nThe RouteView component handles rendering \", \"the matched component specified by the RouteData \\nwith its layout if it has one. If the matched comp\", \"onent doesn\\u2019t have a layout, then the optionally \\nspecified DefaultLayout is used. \\nThe LayoutView c\", \"omponent renders its child content within the specified layout. We\\u2019ll look at layouts \\nmore in detai\", \"l later in this chapter. \\nNavigation \\nIn ASP.NET Web Forms, you trigger navigation to a different pa\", \"ge by returning a redirect response to \\nthe browser. For example: \\nprotected void NavigateButton_Cli\", \"ck(object sender, EventArgs e) \\n{ \\n    Response.Redirect(\\\"Counter\\\"); \\n} \\nReturning a redirect respon\", \"se isn\\u2019t typically possible in Blazor. Blazor doesn\\u2019t use a request-reply \\nmodel. You can, however, \", \"trigger browser navigations directly, as you can with JavaScript. \\n \\n43 \\nCHAPTER 7 | Pages, routing,\", \" and layouts \\n \\nBlazor provides a NavigationManager service that can be used to: \\n\\u2022 \\nGet the current\", \" browser address \\n\\u2022 \\nGet the base address \\n\\u2022 \\nTrigger navigations \\n\\u2022 \\nGet notified when the address \", \"changes \\nTo navigate to a different address, use the NavigateTo method: \\n@page \\\"/\\\" \\n@inject Navigati\", \"onManager NavigationManager \\n \\n<button @onclick=\\\"Navigate\\\">Navigate</button> \\n \\n@code { \\n    void Na\", \"vigate() { \\n        NavigationManager.NavigateTo(\\\"counter\\\"); \\n    } \\n} \\nFor a description of all Nav\", \"igationManager members, see URI and navigation state helpers. \\nBase URLs \\nIf your Blazor app is depl\", \"oyed under a base path, then you need to specify the base URL in the page \\nmetadata using the <base>\", \" tag for routing to work property. If the host page for the app is server-\\nrendered using Razor, the\", \"n you can use the ~/ syntax to specify the app\\u2019s base address. If the host \\npage is static HTML, the\", \"n you need to specify the base URL explicitly. \\n<base href=\\\"~/\\\" /> \\nPage layout \\nPage layout in ASP.\", \"NET Web Forms is handled by Master Pages. Master Pages define a template with \\none or more content p\", \"laceholders that can then be supplied by individual pages. Master Pages are \\ndefined in .master file\", \"s and start with the <%@ Master %> directive. The content of the .master files is \\ncoded as you woul\", \"d an .aspx page, but with the addition of <asp:ContentPlaceHolder> controls to \\nmark where pages can\", \" supply content. \\nSite.master \\n<%@ Master Language=\\\"C#\\\" AutoEventWireup=\\\"true\\\" CodeBehind=\\\"Site.mast\", \"er.cs\\\" \\nInherits=\\\"WebApplication1.SiteMaster\\\" %> \\n \\n<!DOCTYPE html> \\n<html lang=\\\"en\\\"> \\n<head runat=\\\"\", \"server\\\"> \\n    <meta charset=\\\"utf-8\\\" /> \\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initi\", \"al-scale=1.0\\\" /> \\n    <title><%: Page.Title %> - My ASP.NET Application</title> \\n    <link href=\\\"~/f\", \"avicon.ico\\\" rel=\\\"shortcut icon\\\" type=\\\"image/x-icon\\\" /> \\n</head> \\n \\n44 \\nCHAPTER 7 | Pages, routing, a\", \"nd layouts \\n \\n<body> \\n    <form runat=\\\"server\\\"> \\n        <div class=\\\"container body-content\\\"> \\n     \", \"       <asp:ContentPlaceHolder ID=\\\"MainContent\\\" runat=\\\"server\\\"> \\n            </asp:ContentPlaceHolde\", \"r> \\n            <hr /> \\n            <footer> \\n                <p>&copy; <%: DateTime.Now.Year %> - M\", \"y ASP.NET Application</p> \\n            </footer> \\n        </div> \\n    </form> \\n</body> \\n</html> \\nIn \", \"Blazor, you handle page layout using layout components. Layout components inherit from \\nLayoutCompon\", \"entBase, which defines a single Body property of type RenderFragment, which can be \\nused to render t\", \"he contents of the page. \\nMainLayout.razor \\n@inherits LayoutComponentBase \\n<h1>Main layout</h1> \\n<di\", \"v> \\n    @Body \\n</div> \\nWhen the page with a layout is rendered, the page is rendered within the cont\", \"ents of the specified \\nlayout at the location where the layout renders its Body property. \\nTo apply \", \"a layout to a page, use the @layout directive: \\n@layout MainLayout \\nYou can specify the layout for a\", \"ll components in a folder and subfolders using an *_Imports.razor* file. \\nYou can also specify a def\", \"ault layout for all your pages using the Router component. \\nMaster Pages can define multiple content\", \" placeholders, but layouts in Blazor only have a single Body \\nproperty. This limitation of Blazor la\", \"yout components will hopefully be addressed in a future release. \\nMaster Pages in ASP.NET Web Forms \", \"can be nested. That is, a Master Page may also use a Master \\nPage. Layout components in Blazor may b\", \"e nested too. You can apply a layout component to a layout \\ncomponent. The contents of the inner lay\", \"out will be rendered within the outer layout. \\nChildLayout.razor \\n@layout MainLayout \\n<h2>Child layo\", \"ut</h2> \\n<div> \\n    @Body \\n</div> \\nIndex.razor \\n@page \\\"/\\\" \\n@layout ChildLayout \\n<p>I'm in a nested l\", \"ayout!</p> \\nThe rendered output for the page would then be: \\n \\n45 \\nCHAPTER 7 | Pages, routing, and l\", \"ayouts \\n \\n<h1>Main layout</h1> \\n<div> \\n    <h2>Child layout</h2> \\n    <div> \\n        <p>I'm in a nes\", \"ted layout!</p> \\n    </div> \\n</div> \\nLayouts in Blazor don\\u2019t typically define the root HTML elements\", \" for a page (<html>, <body>, <head>, \\nand so on). The root HTML elements are instead defined in a Bl\", \"azor app\\u2019s host page, which is used to \\nrender the initial HTML content for the app (see Bootstrap B\", \"lazor). The host page can render multiple \\nroot components for the app with surrounding markup. \\nCom\", \"ponents in Blazor, including pages, can\\u2019t render <script> tags. This rendering restriction exists \\nb\", \"ecause <script> tags get loaded once and then can\\u2019t be changed. Unexpected behavior may occur if \\nyo\", \"u try to render the tags dynamically using Razor syntax. Instead, all <script> tags should be added \", \"\\nto the app\\u2019s host page. \\n \\n46 \\nCHAPTER 8 | State management \\n \\nCHAPTER 8 \\nState management \\nState m\", \"anagement is a key concept of Web Forms applications, facilitated through ViewState, Session \\nState,\", \" Application State, and Postback features. These stateful features of the framework helped to \\nhide \", \"the state management required for an application and allow application developers to focus on \\ndeliv\", \"ering their functionality. With ASP.NET Core and Blazor, some of these features have been \\nrelocated\", \" and some have been removed altogether. This chapter reviews how to maintain state and \\ndeliver the \", \"same functionality with the new features in Blazor. \\nRequest state management with ViewState \\nWhen d\", \"iscussing state management in Web Forms application, many developers will immediately \\nthink of View\", \"State. In Web Forms, ViewState manages the state of the content between HTTP requests \\nby sending a \", \"large encoded block of text back and forth to the browser. The ViewState field could be \\noverwhelmed\", \" with content from a page containing many elements, potentially expanding to several \\nmegabytes in s\", \"ize. \\nWith Blazor Server, the app maintains an ongoing connection with the server. The app\\u2019s state, \", \"called a \\ncircuit, is held in server memory while the connection is considered active. State will on\", \"ly be disposed \\nwhen the user navigates away from the app or a particular page in the app. All membe\", \"rs of the active \\ncomponents are available between interactions with the server. \\nThere are several \", \"advantages of this feature: \\n\\u2022 \\nComponent state is readily available and not rebuilt between interac\", \"tions. \\n\\u2022 \\nState isn\\u2019t transmitted to the browser. \\nHowever, there are some disadvantages to in-memo\", \"ry component state persistence to be aware of: \\n\\u2022 \\nIf the server restarts between request, state is \", \"lost. \\n\\u2022 \\nYour application web server load-balancing solution must include sticky sessions to ensure\", \" \\nthat all requests from the same browser return to the same server. If a request goes to a \\ndiffere\", \"nt server, state will be lost. \\n\\u2022 \\nPersistence of component state on the server can lead to memory p\", \"ressure on the web server. \\nFor the preceding reasons, don\\u2019t rely on just the state of the component\", \" to reside in-memory on the \\nserver. Your application should also include some backing data store fo\", \"r data between requests. Some \\nsimple examples of this strategy: \\n\\u2022 \\nIn a shopping cart application,\", \" persist the content of new items added to the cart in a \\ndatabase record. If the state on the serve\", \"r is lost, you can reconstitute it from the database \\nrecords. \\n \\n47 \\nCHAPTER 8 | State management \\n\", \" \\n\\u2022 \\nIn a multi-part web form, your users will expect your application to remember values between \\ne\", \"ach request. Write the data between each of your user\\u2019s posts to a data store so that they \\ncan be f\", \"etched and assembled into the final form response structure when the multi-part \\nform is completed. \", \"\\nFor additional details on managing state in Blazor apps, see ASP.NET Core Blazor state management. \", \"\\nMaintain state with Session \\nWeb Forms developers could maintain information about the currently ac\", \"ting user with the \\nMicrosoft.AspNetCore.Http.ISession dictionary object. It\\u2019s easy enough to add an\", \" object with a string \\nkey to the Session, and that object would be available at a later time during\", \" the user\\u2019s interactions \\nwith the application. In an attempt to eliminate managing interacting with\", \" HTTP, the Session object \\nmade it easy to maintain state. \\nThe signature of the .NET Framework Sess\", \"ion object isn\\u2019t the same as the ASP.NET Core Session \\nobject. Consider the documentation for the ne\", \"w ASP.NET Core Session before deciding to migrate \\nand use the new session state feature. \\nSession i\", \"s available in ASP.NET Core and Blazor Server, but is discouraged from use in favor of storing \\ndata\", \" in a data repository appropriately. Session state is also not functional if visitors decline the us\", \"e \\nHTTP cookies in your application due to privacy concerns. \\nConfiguration for ASP.NET Core and Ses\", \"sion state is available in the Session and state management in \\nASP.NET Core article. \\nApplication s\", \"tate \\nThe Application object in the Web Forms framework provides a massive, cross-request repository\", \" for \\ninteracting with application-scope configuration and state. Application state was an ideal pla\", \"ce to \\nstore various application configuration properties that would be referenced by all requests, \", \"regardless \\nof the user making the request. The problem with the Application object was that data di\", \"dn\\u2019t persist \\nacross multiple servers. The state of the application object was lost between restarts\", \". \\nAs with Session, it\\u2019s recommended that data move to a persistent backing store that could be \\nacc\", \"essed by multiple server instances. If there is volatile data that you would like to be able to acce\", \"ss \\nacross requests and users, you could easily store it in a singleton service that can be injected\", \" into \\ncomponents that require this information or interaction. \\nThe construction of an object to ma\", \"intain application state and its consumption could resemble the \\nfollowing implementation: \\npublic c\", \"lass MyApplicationState \\n{ \\n    public int VisitorCounter { get; private set; } = 0; \\n \\n    public v\", \"oid IncrementCounter() => VisitorCounter += 1; \\n} \\n \\n \\n \\n48 \\nCHAPTER 8 | State management \\n \\napp.Add\", \"Singleton<MyApplicationState>(); \\n \\n \\n@inject MyApplicationState AppState \\n \\n<label>Total Visitors: \", \"@AppState.VisitorCounter</label> \\nThe MyApplicationState object is created only once on the server, \", \"and the value VisitorCounter is \\nfetched and output in the component\\u2019s label. The VisitorCounter val\", \"ue should be persisted and \\nretrieved from a backing data store for durability and scalability. \\nIn \", \"the browser \\nApplication data can also be stored client-side on the user\\u2019s device so that is availab\", \"le later. There are \\ntwo browser features that allow for persistence of data in different scopes of \", \"the user\\u2019s browser: \\n\\u2022 \\nlocalStorage - scoped to the user\\u2019s entire browser. If the page is reloaded,\", \" the browser is \\nclosed and reopened, or another tab is opened with the same URL then the same \\nloca\", \"lStorage is provided by the browser \\n\\u2022 \\nsessionStorage - scoped to the user\\u2019s current browser tab. I\", \"f the tab is reloaded, the state \\npersists. However, if the user opens another tab to your applicati\", \"on or closes and reopens the \\nbrowser the state is lost. \\nYou can write some custom JavaScript code \", \"to interact with these features, or there are a number of \\nNuGet packages that you can use that prov\", \"ide this functionality. One such package is \\nMicrosoft.AspNetCore.ProtectedBrowserStorage. \\nFor inst\", \"ructions on utilizing this package to interact with localStorage and sessionStorage, see the \\nBlazor\", \" State Management article. \\n \\n49 \\nCHAPTER 9 | Forms and validation \\n \\nCHAPTER 9 \\nForms and validatio\", \"n \\nThe ASP.NET Web Forms framework includes a set of validation server controls that handle validati\", \"ng \\nuser input entered into a form (RequiredFieldValidator, CompareValidator, RangeValidator, and so\", \" on). \\nThe ASP.NET Web Forms framework also supports model binding and validating the model based on\", \" \\ndata annotations ([Required], [StringLength], [Range], and so on). The validation logic can be enf\", \"orced \\nboth on the server and on the client using unobtrusive JavaScript-based validation. The \\nVali\", \"dationSummary server control is used to display a summary of the validation errors to the user. \\nBla\", \"zor supports the sharing of validation logic between both the client and the server. ASP.NET \\nprovid\", \"es pre-built JavaScript implementations of many common server validations. In many cases, the \\ndevel\", \"oper still has to write JavaScript to fully implement their app-specific validation logic. The same \", \"\\nmodel types, data annotations, and validation logic can be used on both the server and client. \\nBla\", \"zor provides a set of input components. The input components handle binding field data to a \\nmodel a\", \"nd validating the user input when the form is submitted. \\nInput component \\nRendered HTML element \\nIn\", \"putCheckbox \\n<input type=\\\"checkbox\\\"> \\nInputDate \\n<input type=\\\"date\\\"> \\nInputNumber \\n<input type=\\\"numb\", \"er\\\"> \\nInputSelect \\n<select> \\nInputText \\n<input> \\nInputTextArea \\n<textarea> \\nThe EditForm component w\", \"raps these input components and orchestrates the validation process \\nthrough an EditContext. When cr\", \"eating an EditForm, you specify what model instance to bind to using \\nthe Model parameter. Validatio\", \"n is typically done using data annotations, and it\\u2019s extensible. To \\nenable data annotation-based va\", \"lidation, add the DataAnnotationsValidator component as a child of \\nthe EditForm. The EditForm compo\", \"nent provides a convenient event for handling valid \\n(OnValidSubmit) and invalid (OnInvalidSubmit) s\", \"ubmissions. There\\u2019s also a more generic OnSubmit \\nevent that lets you trigger and handle the validat\", \"ion yourself. \\nTo display a validation error summary, use the ValidationSummary component. To displa\", \"y validation \\nmessages for a specific input field, use the ValidationMessage component, specifying a\", \" lambda \\nexpression for the For parameter that points to the appropriate model member. \\nThe followin\", \"g model type defines several validation rules using data annotations: \\n \\n50 \\nCHAPTER 9 | Forms and v\", \"alidation \\n \\nusing System; \\nusing System.ComponentModel.DataAnnotations; \\n \\npublic class Starship \\n{\", \" \\n    [Required] \\n    [StringLength(16, \\n        ErrorMessage = \\\"Identifier too long (16 character l\", \"imit).\\\")] \\n    public string Identifier { get; set; } \\n \\n    public string Description { get; set; }\", \" \\n \\n    [Required] \\n    public string Classification { get; set; } \\n \\n    [Range(1, 100000, \\n       \", \" ErrorMessage = \\\"Accommodation invalid (1-100000).\\\")] \\n    public int MaximumAccommodation { get; se\", \"t; } \\n \\n    [Required] \\n    [Range(typeof(bool), \\\"true\\\", \\\"true\\\", \\n        ErrorMessage = \\\"This form \", \"disallows unapproved ships.\\\")] \\n    public bool IsValidatedDesign { get; set; } \\n \\n    [Required] \\n \", \"   public DateTime ProductionDate { get; set; } \\n} \\nThe following component demonstrates building a \", \"form in Blazor based on the Starship model type: \\n<h1>New Ship Entry Form</h1> \\n \\n<EditForm Model=\\\"@\", \"starship\\\" OnValidSubmit=\\\"@HandleValidSubmit\\\"> \\n    <DataAnnotationsValidator /> \\n    <ValidationSumm\", \"ary /> \\n \\n    <p> \\n        <label for=\\\"identifier\\\">Identifier: </label> \\n        <InputText id=\\\"iden\", \"tifier\\\" @bind-Value=\\\"starship.Identifier\\\" /> \\n        <ValidationMessage For=\\\"() => starship.Identif\", \"ier\\\" /> \\n    </p> \\n    <p> \\n        <label for=\\\"description\\\">Description (optional): </label> \\n     \", \"   <InputTextArea id=\\\"description\\\" @bind-Value=\\\"starship.Description\\\" /> \\n    </p> \\n    <p> \\n       \", \" <label for=\\\"classification\\\">Primary Classification: </label> \\n        <InputSelect id=\\\"classificati\", \"on\\\" @bind-Value=\\\"starship.Classification\\\"> \\n            <option value=\\\"\\\">Select classification ...</\", \"option> \\n            <option value=\\\"Exploration\\\">Exploration</option> \\n            <option value=\\\"Di\", \"plomacy\\\">Diplomacy</option> \\n            <option value=\\\"Defense\\\">Defense</option> \\n        </InputSe\", \"lect> \\n        <ValidationMessage For=\\\"() => starship.Classification\\\" /> \\n    </p> \\n    <p> \\n       \", \" <label for=\\\"accommodation\\\">Maximum Accommodation: </label> \\n        <InputNumber id=\\\"accommodation\\\"\", \" @bind-Value=\\\"starship.MaximumAccommodation\\\" /> \\n        <ValidationMessage For=\\\"() => starship.Maxi\", \"mumAccommodation\\\" /> \\n    </p> \\n \\n51 \\nCHAPTER 9 | Forms and validation \\n \\n    <p> \\n        <label fo\", \"r=\\\"valid\\\">Engineering Approval: </label> \\n        <InputCheckbox id=\\\"valid\\\" @bind-Value=\\\"starship.Is\", \"ValidatedDesign\\\" /> \\n        <ValidationMessage For=\\\"() => starship.IsValidatedDesign\\\" /> \\n    </p> \", \"\\n    <p> \\n        <label for=\\\"productionDate\\\">Production Date: </label> \\n        <InputDate id=\\\"prod\", \"uctionDate\\\" @bind-Value=\\\"starship.ProductionDate\\\" /> \\n        <ValidationMessage For=\\\"() => starship\", \".ProductionDate\\\" /> \\n    </p> \\n \\n    <button type=\\\"submit\\\">Submit</button> \\n</EditForm> \\n \\n@code { \\n\", \"    private Starship starship = new Starship(); \\n \\n    private void HandleValidSubmit() \\n    { \\n    \", \"    // Save the data \\n    } \\n} \\nAfter the form submission, the model-bound data hasn\\u2019t been saved to\", \" any data store, like a \\ndatabase. In a Blazor WebAssembly app, the data must be sent to the server.\", \" For example, using an \\nHTTP POST request. In a Blazor Server app, the data is already on the server\", \", but it must be persisted. \\nHandling data access in Blazor apps is the subject of the Dealing with \", \"data section. \\nAdditional resources \\nFor more information on forms and validation in Blazor apps, se\", \"e the Blazor documentation. \\n \\n52 \\nCHAPTER 10 | Work with data \\n \\nCHAPTER 10 \\nWork with data \\nData a\", \"ccess is the backbone of an ASP.NET Web Forms app. If you\\u2019re building forms for the web, what \\nhappe\", \"ns to that data? With Web Forms, there were multiple data access techniques you could use to \\nintera\", \"ct with a database: \\n\\u2022 \\nData Sources \\n\\u2022 \\nADO.NET \\n\\u2022 \\nEntity Framework \\nData Sources were controls th\", \"at you could place on a Web Forms page and configure like other \\ncontrols. Visual Studio provided a \", \"friendly set of dialogs to configure and bind the controls to your \\nWeb Forms pages. Developers who \", \"enjoy a \\u201clow code\\u201d or \\u201cno code\\u201d approach preferred this \\ntechnique when Web Forms was first released\", \". \\n \\nADO.NET is the low-level approach to interacting with a database. Your apps could create a \\ncon\", \"nection to the database with Commands, Datatables, and Datasets for interacting. The results \\ncould \", \"then be bound to fields on screen without much code. The drawback of this approach was that \\neach se\", \"t of ADO.NET objects (Connection, Command, and DataTable) was bound to libraries provided \\nby a data\", \"base vendor. Use of these components made the code rigid and difficult to migrate to a \\ndifferent da\", \"tabase. \\nEntity Framework \\nEntity Framework (EF) is the open source object-relational mapping framew\", \"ork maintained by the \\n.NET Foundation. Initially released with .NET Framework, EF allows for genera\", \"ting code for the \\ndatabase connections, storage schemas, and interactions. With this abstraction, y\", \"ou can focus on your \\n \\n53 \\nCHAPTER 10 | Work with data \\n \\napp\\u2019s business rules and allow the databa\", \"se to be managed by a trusted database administrator. In \\n.NET, you can use an updated version of EF\", \" called EF Core. EF Core helps generate and maintain the \\ninteractions between your code and the dat\", \"abase with a series of commands that are available for you \\nusing the dotnet ef command-line tool. L\", \"et\\u2019s take a look at a few samples to get you working with a \\ndatabase. \\nEF Code First \\nA quick way t\", \"o get started building your database interactions is to start with the class objects you \\nwant to wo\", \"rk with. EF provides a tool to help generate the appropriate database code for your classes. \\nThis a\", \"pproach is called \\u201cCode First\\u201d development. Consider the following Product class for a sample \\nstore\", \"front app that we want to store in a relational database like Microsoft SQL Server. \\npublic class Pr\", \"oduct \\n{ \\n    public int Id { get; set; } \\n \\n    [Required] \\n    public string Name { get; set; } \\n \", \"\\n    [MaxLength(4000)] \\n    public string Description { get; set; } \\n \\n    [Range(0, 99999,99)] \\n   \", \" [DataType(DataType.Currency)] \\n    public decimal Price { get; set; } \\n} \\nProduct has a primary key\", \" and three additional fields that would be created in our database: \\n\\u2022 \\nEF will identify the Id prop\", \"erty as a primary key by convention. \\n\\u2022 \\nName will be stored in a column configured for text storage\", \". The [Required] attribute \\ndecorating this property will add a not null constraint to help enforce \", \"this declared behavior \\nof the property. \\n\\u2022 \\nDescription will be stored in a column configured for t\", \"ext storage, and have a maximum \\nlength configured of 4000 characters as dictated by the [MaxLength]\", \" attribute. The database \\nschema will be configured with a column named MaxLength using data type va\", \"rchar(4000). \\n\\u2022 \\nThe Price property will be stored as currency. The [Range] attribute will generate \", \"appropriate \\nconstraints to prevent data storage outside of the minimum and maximum values declared.\", \" \\nWe need to add this Product class to a database context class that defines the connection and \\ntra\", \"nslation operations with our database. \\npublic class MyDbContext : DbContext \\n{ \\n    public DbSet<Pr\", \"oduct> Products { get; set; } \\n} \\nThe MyDbContext class provides the one property that defines the a\", \"ccess and translation for the \\nProduct class. Your application configures this class for interaction\", \" with the database using the \\nfollowing entries in the Startup class\\u2019s ConfigureServices method (or \", \"appropriate location in \\nProgram.cs using the builder.Services property instead of services): \\n \\n54 \", \"\\nCHAPTER 10 | Work with data \\n \\nservices.AddDbContext<MyDbContext>(options => \\n    options.UseSqlSer\", \"ver(\\\"MY DATABASE CONNECTION STRING\\\")); \\nThe preceding code will connect to a SQL Server database wit\", \"h the specified connection string. You \\ncan place the connection string in your appsettings.json fil\", \"e, environment variables, or other \\nconfiguration storage locations and replace this embedded string\", \" appropriately. \\nYou can then generate the database table appropriate for this class using the follo\", \"wing commands: \\ndotnet ef migrations add 'Create Product table' \\ndotnet ef database update \\nThe firs\", \"t command defines the changes you\\u2019re making to the database schema as a new EF Migration \\ncalled Cre\", \"ate Product table. A Migration defines how to apply and remove your new database \\nchanges. \\nOnce app\", \"lied, you have a simple Product table in your database and some new classes added to the \\nproject th\", \"at help manage the database schema. You can find these generated classes, by default, in a \\nnew fold\", \"er called Migrations. When you make changes to the Product class or add more related \\nclasses you wo\", \"uld like interacting with your database, you need to run the command-line commands \\nagain with a new\", \" name of the migration. This command will generate another set of migration classes \\nto update your \", \"database schema. \\nEF Database First \\nFor existing databases, you can generate the classes for EF Cor\", \"e by using the .NET command-line \\ntools. To scaffold the classes, use a variation of the following c\", \"ommand: \\ndotnet ef dbcontext scaffold \\\"CONNECTION STRING\\\" Microsoft.EntityFrameworkCore.SqlServer -c\", \" \\nMyDbContext -t Product -t Customer \\nThe preceding command connects to the database using the speci\", \"fied connection string and the \\nMicrosoft.EntityFrameworkCore.SqlServer provider. Once connected, a \", \"database context class named \\nMyDbContext is created. Additionally, supporting classes are created f\", \"or the Product and Customer \\ntables that were specified with the -t options. There are many configur\", \"ation options for this command \\nto generate the class hierarchy appropriate for your database. For a\", \" complete reference, see the \\ncommand\\u2019s documentation. \\nMore information about EF Core can be found \", \"on the Microsoft Docs site. \\nInteract with web services \\nWhen ASP.NET was first released, SOAP servi\", \"ces were the preferred way for web servers and clients to \\nexchange data. Much has changed since tha\", \"t time, and the preferred interactions with services have \\nshifted to direct HTTP client interaction\", \"s. With ASP.NET Core and Blazor, you can register the \\nconfiguration of your HttpClient in Program.c\", \"s or in the Startup class\\u2019s ConfigureServices method. Use \\nthat configuration when you need to inter\", \"act with the HTTP endpoint. Consider the following \\nconfiguration code: \\n \\n55 \\nCHAPTER 10 | Work wit\", \"h data \\n \\n// in Program.cs \\nbuilder.Services.AddHttpClient(\\\"github\\\", client => \\n{ \\n    client.BaseAd\", \"dress = new Uri(\\\"http://api.github.com/\\\"); \\n    // Github API versioning \\n    client.DefaultRequestH\", \"eaders.Add(\\\"Accept\\\", \\\"application/vnd.github.v3+json\\\"); \\n    // Github requires a user-agent \\n    cl\", \"ient.DefaultRequestHeaders.Add(\\\"User-Agent\\\", \\\"BlazorWebForms-Sample\\\"); \\n}); \\nWhenever you need to ac\", \"cess data from GitHub, create a client with a name of github. The client is \\nconfigured with the bas\", \"e address, and the request headers are set appropriately. Inject the \\nIHttpClientFactory into your B\", \"lazor components with the @inject directive or an [Inject] attribute on a \\nproperty. Create your nam\", \"ed client and interact with services using the following syntax: \\n@inject IHttpClientFactory factory\", \" \\n \\n... \\n \\n@code { \\n    protected override async Task OnInitializedAsync() \\n    { \\n        var clien\", \"t = factory.CreateClient(\\\"github\\\"); \\n        var response = await client.GetAsync(\\\"repos/dotnet/docs\", \"/issues\\\"); \\n        response.EnsureStatusCode(); \\n        var content = await response.Content.ReadA\", \"sStringAsync(); \\n    } \\n} \\nThis method returns the string describing the collection of issues in the\", \" dotnet/docs GitHub repository. \\nIt returns content in JSON format and is deserialized into appropri\", \"ate GitHub issue objects. There are \\nmany ways that you can configure the HttpClientFactory to deliv\", \"er preconfigured HttpClient objects. \\nTry configuring multiple HttpClient instances with different n\", \"ames and endpoints for the various web \\nservices you work with. This approach will make your interac\", \"tions with those services easier to work \\nwith on each page. For more information, see Make HTTP req\", \"uests using IHttpClientFactory. \\n \\n56 \\nCHAPTER 11 | Modules, handlers, and middleware \\n \\nCHAPTER 11 \", \"\\nModules, handlers, and \\nmiddleware \\nAn ASP.NET Core app is built upon a series of middleware. Middl\", \"eware is handlers that are arranged \\ninto a pipeline to handle requests and responses. In a Web Form\", \"s app, HTTP handlers and modules \\nsolve similar problems. In ASP.NET Core, modules, handlers, Global\", \".asax.cs, and the app life cycle are \\nreplaced with middleware. In this chapter, you\\u2019ll learn about \", \"middleware in the context of a Blazor \\napp. \\nOverview \\nThe ASP.NET Core request pipeline consists of\", \" a sequence of request delegates, called one after the \\nother. The following diagram demonstrates th\", \"e concept. The thread of execution follows the black \\narrows. \\n \\n57 \\nCHAPTER 11 | Modules, handlers,\", \" and middleware \\n \\n \\nThe preceding diagram lacks a concept of lifecycle events. This concept is foun\", \"dational to how \\nASP.NET Web Forms requests are handled. This system makes it easier to reason about\", \" what process \\nis occurring and allows middleware to be inserted at any point. Middleware executes i\", \"n the order in \\nwhich it\\u2019s added to the request pipeline. They\\u2019re also added in code instead of conf\", \"iguration files, \\nusually in Startup.cs. \\nKatana \\nReaders familiar with Katana will feel comfortable\", \" in ASP.NET Core. In fact, Katana is a framework from \\nwhich ASP.NET Core derives. It introduced sim\", \"ilar middleware and pipeline patterns for ASP.NET 4.x. \\nMiddleware designed for Katana can be adapte\", \"d to work with the ASP.NET Core pipeline. \\nCommon middleware \\nASP.NET 4.x includes many modules. In \", \"a similar fashion, ASP.NET Core has many middleware \\ncomponents available as well. IIS modules may b\", \"e used in some cases with ASP.NET Core. In other \\ncases, native ASP.NET Core middleware may be avail\", \"able. \\nThe following table lists replacement middleware and components in ASP.NET Core. \\nModule \\nASP\", \".NET 4.x module \\nASP.NET Core option \\nHTTP errors \\nCustomErrorModule \\nStatus Code Pages \\nMiddleware \", \"\\n \\n58 \\nCHAPTER 11 | Modules, handlers, and middleware \\n \\nModule \\nASP.NET 4.x module \\nASP.NET Core op\", \"tion \\nDefault document \\nDefaultDocumentModule \\nDefault Files Middleware \\nDirectory browsing \\nDirecto\", \"ryListingModule \\nDirectory Browsing \\nMiddleware \\nDynamic compression \\nDynamicCompressionModule \\nResp\", \"onse Compression \\nMiddleware \\nFailed requests tracing \\nFailedRequestsTracingModule \\nASP.NET Core Log\", \"ging \\nFile caching \\nFileCacheModule \\nResponse Caching \\nMiddleware \\nHTTP caching \\nHttpCacheModule \\nRe\", \"sponse Caching \\nMiddleware \\nHTTP logging \\nHttpLoggingModule \\nASP.NET Core Logging \\nHTTP redirection \", \"\\nHttpRedirectionModule \\nURL Rewriting \\nMiddleware \\nISAPI filters \\nIsapiFilterModule \\nMiddleware \\nISA\", \"PI \\nIsapiModule \\nMiddleware \\nRequest filtering \\nRequestFilteringModule \\nURL Rewriting \\nMiddleware IR\", \"ule \\nURL rewriting\\u2020 \\nRewriteModule \\nURL Rewriting \\nMiddleware \\nStatic compression \\nStaticCompression\", \"Module \\nResponse Compression \\nMiddleware \\nStatic content \\nStaticFileModule \\nStatic File Middleware \\n\", \"URL authorization \\nUrlAuthorizationModule \\nASP.NET Core Identity \\nThis list isn\\u2019t exhaustive but sho\", \"uld give an idea of what mapping exists between the two frameworks. \\nFor a more detailed list, see I\", \"IS modules with ASP.NET Core. \\nCustom middleware \\nBuilt-in middleware may not handle all scenarios n\", \"eeded for an app. In such cases, it makes sense to \\ncreate your own middleware. There are multiple w\", \"ays of defining middleware, with the simplest being \\na simple delegate. Consider the following middl\", \"eware, which accepts a culture request from a query \\nstring: \\npublic class Startup \\n{ \\n    public vo\", \"id Configure(IApplicationBuilder app) \\n    { \\n        app.Use(async (context, next) => \\n        { \\n \", \"           var cultureQuery = context.Request.Query[\\\"culture\\\"]; \\n \\n59 \\nCHAPTER 11 | Modules, handler\", \"s, and middleware \\n \\n \\n            if (!string.IsNullOrWhiteSpace(cultureQuery)) \\n            { \\n   \", \"             var culture = new CultureInfo(cultureQuery); \\n \\n                CultureInfo.CurrentCult\", \"ure = culture; \\n                CultureInfo.CurrentUICulture = culture; \\n            } \\n \\n          \", \"  // Call the next delegate/middleware in the pipeline \\n            await next(); \\n        }); \\n \\n  \", \"      app.Run(async (context) => \\n            await context.Response.WriteAsync( \\n                $\\\"\", \"Hello {CultureInfo.CurrentCulture.DisplayName}\\\")); \\n    } \\n} \\nMiddleware can also be defined as clas\", \"s, either by implementing the IMiddleware interface or by \\nfollowing middleware convention. For more\", \" information, see Write custom ASP.NET Core middleware. \\n \\n60 \\nCHAPTER 12 | App configuration \\n \\nCHA\", \"PTER 12 \\nApp configuration \\nThe primary way to load app configuration in Web Forms is with entries i\", \"n the web.config file\\u2014either \\non the server or a related configuration file referenced by web.config\", \". You can use the static \\nConfigurationManager object to interact with app settings, data repository\", \" connection strings, and \\nother extended configuration providers that are added into the app. It\\u2019s t\", \"ypical to see interactions \\nwith app configuration as seen in the following code: \\nvar configuration\", \"Value = ConfigurationManager.AppSettings[\\\"ConfigurationSettingName\\\"]; \\nvar connectionString = \\nConfi\", \"gurationManager.ConnectionStrings[\\\"MyDatabaseConnectionName\\\"].ConnectionString; \\nWith ASP.NET Core a\", \"nd server-side Blazor, the web.config file MAY be present if your app is hosted on \\na Windows IIS se\", \"rver. However, there\\u2019s no ConfigurationManager interaction with this configuration, \\nand you can rec\", \"eive more structured app configuration from other sources. Let\\u2019s take a look at how \\nconfiguration i\", \"s gathered and how you can still access configuration information from a web.config \\nfile. \\nConfigur\", \"ation sources \\nASP.NET Core recognizes there are many configuration sources you may want to use for \", \"your app. The \\nframework attempts to offer you the best of these features by default. Configuration \", \"is read and \\naggregated from these various sources by ASP.NET Core. Later loaded values for the same\", \" \\nconfiguration key take precedence over earlier values. \\nASP.NET Core was designed to be cloud-awar\", \"e and to make the configuration of apps easier for both \\noperators and developers. ASP.NET Core is e\", \"nvironment-aware and knows if it\\u2019s running in your \\nProduction or Development environment. The envir\", \"onment indicator is set in the \\nASPNETCORE_ENVIRONMENT system environment variable. If no value is c\", \"onfigured, the app defaults \\nto running in the Production environment. \\nYour app can trigger and add\", \" configuration from several sources based on the environment\\u2019s name. \\nBy default, the configuration \", \"is loaded from the following resources in the order listed: \\n1. \\nappsettings.json file, if present \\n\", \"2. \\nappsettings.{ENVIRONMENT_NAME}.json file, if present \\n3. \\nUser secrets file on disk, if present \", \"\\n4. \\nEnvironment variables \\n5. \\nCommand-line arguments \\n \\n61 \\nCHAPTER 12 | App configuration \\n \\napps\", \"ettings.json format and access \\nThe appsettings.json file can be hierarchical with values structured\", \" like the following JSON: \\n{ \\n  \\\"section0\\\": { \\n    \\\"key0\\\": \\\"value\\\", \\n    \\\"key1\\\": \\\"value\\\" \\n  }, \\n  \\\"s\", \"ection1\\\": { \\n    \\\"key0\\\": \\\"value\\\", \\n    \\\"key1\\\": \\\"value\\\" \\n  } \\n} \\nWhen presented with the preceding JS\", \"ON, the configuration system flattens child values and \\nreferences their fully qualified hierarchica\", \"l paths. A colon (:) character separates each property in the \\nhierarchy. For example, the configura\", \"tion key section1:key0 accesses the section1 object literal\\u2019s key0 \\nvalue. \\nUser secrets \\nUser secre\", \"ts are: \\n\\u2022 \\nConfiguration values that are stored in a JSON file on the developer\\u2019s workstation, outs\", \"ide of \\nthe app development folder. \\n\\u2022 \\nOnly loaded when running in the Development environment. \\n\\u2022 \", \"\\nAssociated with a specific app. \\n\\u2022 \\nManaged with the .NET CLI\\u2019s user-secrets command. \\nConfigure yo\", \"ur app for secrets storage by executing the user-secrets command: \\ndotnet user-secrets init \\nThe pre\", \"ceding command adds a UserSecretsId element to the project file. The element contains a \\nGUID, which\", \" is used to associate secrets with the app. You can then define a secret with the set \\ncommand. For \", \"example: \\ndotnet user-secrets set \\\"Parent:ApiKey\\\" \\\"12345\\\" \\nThe preceding command makes the Parent:Ap\", \"iKey configuration key available on a developer\\u2019s \\nworkstation with the value 12345. \\nFor more infor\", \"mation about creating, storing, and managing user secrets, see the Safe storage of app \\nsecrets in d\", \"evelopment in ASP.NET Core document. \\nEnvironment variables \\nThe next set of values loaded into your\", \" app configuration is the system\\u2019s environment variables. All of \\nyour system\\u2019s environment variable\", \" settings are now accessible to you through the configuration API. \\n \\n62 \\nCHAPTER 12 | App configura\", \"tion \\n \\nHierarchical values are flattened and separated by colon characters when read inside your ap\", \"p. \\nHowever, some operating systems don\\u2019t allow the colon character environment variable names. \\nASP\", \".NET Core addresses this limitation by converting values that have double-underscores (__) into a \\nc\", \"olon when they\\u2019re accessed. The Parent:ApiKey value from the user secrets section above can be \\nover\", \"ridden with the environment variable Parent__ApiKey. \\nCommand-line arguments \\nConfiguration can also\", \" be provided as command-line arguments when your app is started. Use the \\ndouble-dash (--) or forwar\", \"d-slash (/) notation to indicate the name of the configuration value to set \\nand the value to be con\", \"figured. The syntax resembles the following commands: \\ndotnet run CommandLineKey1=value1 --CommandLi\", \"neKey2=value2 /CommandLineKey3=value3 \\ndotnet run --CommandLineKey1 value1 /CommandLineKey2 value2 \\n\", \"dotnet run Parent:ApiKey=67890 \\nThe return of web.config \\nIf you\\u2019ve deployed your app to Windows on \", \"IIS, the web.config file still configures IIS to manage your \\napp. By default, IIS adds a reference \", \"to the ASP.NET Core Module (ANCM). ANCM is a native IIS \\nmodule that hosts your app in place of the \", \"Kestrel web server. This web.config section resembles the \\nfollowing XML markup: \\n<?xml version=\\\"1.0\", \"\\\" encoding=\\\"utf-8\\\"?> \\n<configuration> \\n  <location path=\\\".\\\" inheritInChildApplications=\\\"false\\\"> \\n   \", \" <system.webServer> \\n      <handlers> \\n        <add name=\\\"aspNetCore\\\" path=\\\"*\\\" verb=\\\"*\\\" modules=\\\"Asp\", \"NetCoreModuleV2\\\" \\nresourceType=\\\"Unspecified\\\" /> \\n      </handlers> \\n      <aspNetCore processPath=\\\".\", \"\\\\MyApp.exe\\\" \\n                  stdoutLogEnabled=\\\"false\\\" \\n                  stdoutLogFile=\\\".\\\\logs\\\\std\", \"out\\\" \\n                  hostingModel=\\\"inprocess\\\" /> \\n    </system.webServer> \\n  </location> \\n</confi\", \"guration> \\nApp-specific configuration can be defined by nesting an environmentVariables element in t\", \"he \\naspNetCore element. The values defined in this section are presented to the ASP.NET Core app as \", \"\\nenvironment variables. The environment variables load appropriately during that segment of app \\nsta\", \"rtup. \\n<aspNetCore processPath=\\\"dotnet\\\" \\n      arguments=\\\".\\\\MyApp.dll\\\" \\n      stdoutLogEnabled=\\\"fals\", \"e\\\" \\n      stdoutLogFile=\\\".\\\\logs\\\\stdout\\\" \\n      hostingModel=\\\"inprocess\\\"> \\n  <environmentVariables> \\n\", \"    <environmentVariable name=\\\"ASPNETCORE_ENVIRONMENT\\\" value=\\\"Development\\\" /> \\n \\n63 \\nCHAPTER 12 | Ap\", \"p configuration \\n \\n    <environmentVariable name=\\\"Parent:ApiKey\\\" value=\\\"67890\\\" /> \\n  </environmentVa\", \"riables> \\n</aspNetCore> \\nRead configuration in the app \\nASP.NET Core provides app configuration thro\", \"ugh the IConfiguration interface. This configuration \\ninterface should be requested by your Blazor c\", \"omponents, Blazor pages, and any other ASP.NET Core-\\nmanaged class that needs access to configuratio\", \"n. The ASP.NET Core framework will automatically \\npopulate this interface with the resolved configur\", \"ation configured earlier. On a Blazor page or a \\ncomponent\\u2019s Razor markup, you can inject the IConfi\", \"guration object with an @inject directive at the \\ntop of the .razor file like this: \\n@inject IConfig\", \"uration Configuration \\nThis preceding statement makes the IConfiguration object available as the Con\", \"figuration variable \\nthroughout the rest of the Razor template. \\nIndividual configuration settings c\", \"an be read by specifying the configuration setting hierarchy sought \\nas an indexer parameter: \\nvar m\", \"ySetting = Configuration[\\\"section1:key0\\\"]; \\nYou can fetch entire configuration sections by using the\", \" GetSection method to retrieve a collection of \\nkeys at a specific location with a syntax similar to\", \" GetSection(\\\"section1\\\") to retrieve the configuration \\nfor section1 from the earlier example. \\nStron\", \"gly typed configuration \\nWith Web Forms, it was possible to create a strongly typed configuration ty\", \"pe that inherited from the \\nConfigurationSection type and associated types. A ConfigurationSection a\", \"llowed you to configure \\nsome business rules and processing for those configuration values. \\nIn ASP.\", \"NET Core, you can specify a class hierarchy that will receive the configuration values. These \\nclass\", \"es: \\n\\u2022 \\nDon\\u2019t need to inherit from a parent class. \\n\\u2022 \\nShould include public properties that match t\", \"he properties and type references for the \\nconfiguration structure you wish to capture. \\nFor the ear\", \"lier appsettings.json sample, you could define the following classes to capture the values: \\npublic \", \"class MyConfig \\n{ \\n    public MyConfigSection section0 { get; set;} \\n \\n    public MyConfigSection se\", \"ction1 { get; set;} \\n} \\n \\npublic class MyConfigSection \\n{ \\n \\n64 \\nCHAPTER 12 | App configuration \\n \\n \", \"   public string key0 { get; set; } \\n \\n    public string key1 { get; set; } \\n} \\nThis class hierarchy\", \" can be populated by adding the following line to the Startup.ConfigureServices \\nmethod (or appropri\", \"ate location in Program.cs using the builder.Services property instead of services): \\nservices.Confi\", \"gure<MyConfig>(Configuration); \\nIn the rest of the app, you can add an input parameter to classes or\", \" an @inject directive in Razor \\ntemplates of type IOptions<MyConfig> to receive the strongly typed c\", \"onfiguration settings. The \\nIOptions<MyConfig>.Value property will yield the MyConfig value populate\", \"d from the configuration \\nsettings. \\n@inject IOptions<MyConfig> options \\n@code { \\n    var MyConfigur\", \"ation = options.Value; \\n    var theSetting = MyConfiguration.section1.key0; \\n} \\nMore information abo\", \"ut the Options feature can be found in the Options pattern in ASP.NET Core \\ndocument. \\n \\n65 \\nCHAPTER\", \" 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor \\n \\nCHAPTER 13 \\nSecu\", \"rity: Authentication \\nand Authorization in \\nASP.NET Web Forms and \\nBlazor \\nMigrating from an ASP.NET\", \" Web Forms application to Blazor will almost certainly require updating \\nhow authentication and auth\", \"orization are performed, assuming the application had authentication \\nconfigured. This chapter will \", \"cover how to migrate from the ASP.NET Web Forms universal provider \\nmodel (for membership, roles, an\", \"d user profiles) and how to work with ASP.NET Core Identity from \\nBlazor apps. While this chapter wi\", \"ll cover the high-level steps and considerations, the detailed steps \\nand scripts may be found in th\", \"e referenced documentation. \\nASP.NET universal providers \\nSince ASP.NET 2.0, the ASP.NET Web Forms p\", \"latform has supported a provider model for a variety of \\nfeatures, including membership. The univers\", \"al membership provider, along with the optional role \\nprovider, is commonly deployed with ASP.NET We\", \"b Forms applications. It offers a robust and secure \\nway to manage authentication and authorization \", \"that continues to work well today. The most recent \\noffering of these universal providers is availab\", \"le as a NuGet package, Microsoft.AspNet.Providers. \\nThe Universal Providers work with a SQL database\", \" schema that includes tables like \\naspnet_Applications, aspnet_Membership, aspnet_Roles, and aspnet_\", \"Users. When configured by \\nrunning the aspnet_regsql.exe command, the providers install tables and s\", \"tored procedures that \\nprovide all of the necessary queries and commands to work with the underlying\", \" data. The database \\nschema and these stored procedures are not compatible with newer ASP.NET Identi\", \"ty and ASP.NET \\nCore Identity systems, so existing data must be migrated into the new system. Figure\", \" 1 shows an \\nexample table schema configured for universal providers. \\n \\n66 \\nCHAPTER 13 | Security: \", \"Authentication and Authorization in ASP.NET Web Forms and Blazor \\n \\n \\nThe universal provider handles\", \" users, membership, roles, and profiles. Users are assigned globally \\nunique identifiers and basic i\", \"nformation like userId, userName etc. are stored in the aspnet_Users \\ntable. Authentication informat\", \"ion, such as password, password format, password salt, lockout counters \\nand details, etc. are store\", \"d in the aspnet_Membership table. Roles consist simply of names and unique \\nidentifiers, which are a\", \"ssigned to users via the aspnet_UsersInRoles association table, providing a \\nmany-to-many relationsh\", \"ip. \\nIf your existing system is using roles in addition to membership, you will need to migrate the \", \"user \\naccounts, the associated passwords, the roles, and the role membership into ASP.NET Core Ident\", \"ity. \\nYou will also most likely need to update your code where you\\u2019re currently performing role chec\", \"ks \\nusing if statements to instead leverage declarative filters, attributes, and/or tag helpers. We \", \"will review \\nmigration considerations in greater detail at the end of this chapter. \\nAuthorization c\", \"onfiguration in Web Forms \\nTo configure authorized access to certain pages in an ASP.NET Web Forms a\", \"pplication, typically you \\nspecify that certain pages or folders are inaccessible to anonymous users\", \". This configuration is done in \\nthe web.config file: \\n<?xml version=\\\"1.0\\\"?> \\n<configuration> \\n    <\", \"system.web> \\n      <authentication mode=\\\"Forms\\\"> \\n        <forms defaultUrl=\\\"~/home.aspx\\\" loginUrl=\\\"\", \"~/login.aspx\\\" \\n          slidingExpiration=\\\"true\\\" timeout=\\\"2880\\\"></forms> \\n      </authentication> \\n\", \" \\n      <authorization> \\n        <deny users=\\\"?\\\" /> \\n      </authorization> \\n    </system.web> \\n</co\", \"nfiguration> \\nThe authentication configuration section sets up the forms authentication for the appl\", \"ication. The \\nauthorization section is used to disallow anonymous users for the entire application. \", \"However, you \\ncan provide more granular authorization rules on a per-location basis as well as apply\", \" role-based \\nauthorization checks. \\n<location path=\\\"login.aspx\\\"> \\n  <system.web> \\n \\n67 \\nCHAPTER 13 |\", \" Security: Authentication and Authorization in ASP.NET Web Forms and Blazor \\n \\n    <authorization> \\n\", \"      <allow users=\\\"*\\\" /> \\n    </authorization> \\n  </system.web> \\n</location> \\nThe above configurati\", \"on, when combined with the first one, would allow anonymous users to access \\nthe login page, overrid\", \"ing the site-wide restriction on non-authenticated users. \\n<location path=\\\"/admin\\\"> \\n  <system.web> \", \"\\n    <authorization> \\n      <allow roles=\\\"Administrators\\\" /> \\n      <deny users=\\\"*\\\" /> \\n    </author\", \"ization> \\n  </system.web> \\n</location> \\nThe above configuration, when combined with the others, rest\", \"ricts access to the /admin folder and all \\nresources within it to members of the \\u201cAdministrators\\u201d ro\", \"le. This restriction could also be applied by \\nplacing a separate web.config file within the /admin \", \"folder root. \\nAuthorization code in Web Forms \\nIn addition to configuring access using web.config, y\", \"ou can also programmatically configure access \\nand behavior in your Web Forms application. For insta\", \"nce, you can restrict the ability to perform \\ncertain operations or view certain data based on the u\", \"ser\\u2019s role. \\nThis code can be used both in code-behind logic as well as in the page itself: \\n<% if (\", \"HttpContext.Current.User.IsInRole(\\\"Administrators\\\")) { %> \\n  <a href=\\\"/admin\\\">Go To Admin</a> \\n<% } \", \"%> \\nIn addition to checking user role membership, you can also determine if they are authenticated \\n\", \"(though often this is better done using the location-based configuration covered above). Below is an\", \" \\nexample of this approach. \\nprotected void Page_Load(object sender, EventArgs e) \\n{ \\n    if (!User.\", \"Identity.IsAuthenticated) \\n    { \\n        FormsAuthentication.RedirectToLoginPage(); \\n    } \\n    if \", \"(!Roles.IsUserInRole(User.Identity.Name, \\\"Administrators\\\")) \\n    { \\n        MessageLabel.Text = \\\"Onl\", \"y administrators can view this.\\\"; \\n        SecretPanel.Visible = false; \\n    } \\n} \\nIn the code above\", \", role-based access control (RBAC) is used to determine whether certain elements of \\nthe page, such \", \"as a SecretPanel, are visible based on the current user\\u2019s role. \\n \\n68 \\nCHAPTER 13 | Security: Authen\", \"tication and Authorization in ASP.NET Web Forms and Blazor \\n \\nTypically, ASP.NET Web Forms applicati\", \"ons configure security within the web.config file and then add \\nadditional checks where needed in .a\", \"spx pages and their related .aspx.cs code-behind files. Most \\napplications leverage the universal me\", \"mbership provider, frequently with the additional role provider. \\nASP.NET Core Identity \\nAlthough st\", \"ill tasked with authentication and authorization, ASP.NET Core Identity uses a different set \\nof abs\", \"tractions and assumptions when compared to the universal providers. For example, the new \\nIdentity m\", \"odel supports third party authentication, allowing users to authenticate using a social media \\naccou\", \"nt or other trusted authentication provider. ASP.NET Core Identity supports UI for commonly \\nneeded \", \"pages like login, logout, and register. It leverages EF Core for its data access, and uses EF Core \\n\", \"migrations to generate the necessary schema required to support its data model. This introduction to\", \" \\nIdentity on ASP.NET Core provides a good overview of what is included with ASP.NET Core Identity \\n\", \"and how to get started working with it. If you haven\\u2019t already set up ASP.NET Core Identity in your \", \"\\napplication and its database, it will help you get started. \\nRoles, claims, and policies \\nBoth the \", \"universal providers and ASP.NET Core Identity support the concept of roles. You can create \\nroles fo\", \"r users and assign users to roles. Users can belong to any number of roles, and you can verify \\nrole\", \" membership as part of your authorization implementation. \\nIn addition to roles, ASP.NET Core identi\", \"ty supports the concepts of claims and policies. While a role \\nshould specifically correspond to a s\", \"et of resources a user in that role should be able to access, a \\nclaim is simply part of a user\\u2019s id\", \"entity. A claim is a name value pair that represents what the subject \\nis, not what the subject can \", \"do. \\nIt is possible to directly inspect a user\\u2019s claims and determine based on these values whether \", \"a user \\nshould be given access to a resource. However, such checks are often repetitive and scattere\", \"d \\nthroughout the system. A better approach is to define a policy. \\nAn authorization policy consists\", \" of one or more requirements. Policies are registered as part of the \\nauthorization service configur\", \"ation in the ConfigureServices method of Startup.cs. For example, the \\nfollowing code snippet config\", \"ures a policy called \\u201cCanadiansOnly\\u201d, which has the requirement that the \\nuser has the Country claim\", \" with the value of \\u201cCanada\\u201d. \\nservices.AddAuthorization(options => \\n{ \\n    options.AddPolicy(\\\"Canadi\", \"ansOnly\\\", policy => policy.RequireClaim(ClaimTypes.Country, \\n\\\"Canada\\\")); \\n}); \\nYou can learn more ab\", \"out how to create custom policies in the documentation. \\nWhether you\\u2019re using policies or roles, you\", \" can specify that a particular page in your Blazor \\napplication requires that role or policy with th\", \"e [Authorize] attribute, applied with the @attribute \\ndirective. \\nRequiring a role: \\n \\n69 \\nCHAPTER 1\", \"3 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor \\n \\n@attribute [Author\", \"ize(Roles =\\\"administrators\\\")] \\nRequiring a policy be satisfied: \\n@attribute [Authorize(Policy =\\\"Cana\", \"diansOnly\\\")] \\nIf you need access to a user\\u2019s authentication state, roles, or claims in your code, th\", \"ere are two primary \\nways to achieve this functionality. The first is to receive the authentication \", \"state as a cascading \\nparameter. The second is to access the state using an injected AuthenticationS\", \"tateProvider. The \\ndetails of each of these approaches are described in the Blazor Security document\", \"ation. \\nThe following code shows how to receive the AuthenticationState as a cascading parameter: \\n[\", \"CascadingParameter] \\nprivate Task<AuthenticationState> authenticationStateTask { get; set; } \\nWith t\", \"his parameter in place, you can get the user using this code: \\nvar authState = await authenticationS\", \"tateTask; \\nvar user = authState.User; \\nThe following code shows how to inject the AuthenticationStat\", \"eProvider: \\n@using Microsoft.AspNetCore.Components.Authorization \\n@inject AuthenticationStateProvide\", \"r AuthenticationStateProvider \\nWith the provider in place, you can gain access to the user with the \", \"following code: \\nAuthenticationState authState = await \\nAuthenticationStateProvider.GetAuthenticatio\", \"nStateAsync(); \\nClaimsPrincipal user = authState.User; \\n \\nif (user.Identity.IsAuthenticated) \\n{ \\n  /\", \"/ work with user.Claims and/or user.Roles \\n} \\nNote: The AuthorizeView component, covered later in th\", \"is chapter, provides a declarative way to \\ncontrol what a user sees on a page or component. \\nTo work\", \" with users and claims (in Blazor Server applications) you may also need to inject a \\nUserManager<T>\", \" (use IdentityUser for default) which you can use to enumerate and modify claims \\nfor a user. First \", \"inject the type and assign it to a property: \\n@inject UserManager<IdentityUser> MyUserManager \\nThen \", \"use it to work with the user\\u2019s claims. The following sample shows how to add and persist a claim \\non\", \" a user: \\nprivate async Task AddCountryClaim() \\n{ \\n    var authState = await AuthenticationStateProv\", \"ider.GetAuthenticationStateAsync(); \\n    var user = authState.User; \\n    var identityUser = await My\", \"UserManager.FindByNameAsync(user.Identity.Name); \\n \\n    if (!user.HasClaim(c => c.Type == ClaimTypes\", \".Country)) \\n    { \\n \\n70 \\nCHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Form\", \"s and Blazor \\n \\n        // stores the claim in the cookie \\n        ClaimsIdentity id = new ClaimsIde\", \"ntity(); \\n        id.AddClaim(new Claim(ClaimTypes.Country, \\\"Canada\\\")); \\n        user.AddIdentity(id\", \"); \\n \\n        // save the claim in the database \\n        await MyUserManager.AddClaimAsync(identityU\", \"ser, new Claim(ClaimTypes.Country, \\n\\\"Canada\\\")); \\n    } \\n} \\nIf you need to work with roles, follow th\", \"e same approach. You may need to inject a RoleManager<T> \\n(use IdentityRole for default type) to lis\", \"t and manage the roles themselves. \\nNote: In Blazor WebAssembly projects, you will need to provide s\", \"erver APIs to perform these \\noperations (instead of using UserManager<T> or RoleManager<T> directly)\", \". A Blazor WebAssembly \\nclient application would manage claims and/or roles by securely calling API \", \"endpoints exposed for \\nthis purpose. \\nMigration guide \\nMigrating from ASP.NET Web Forms and universa\", \"l providers to ASP.NET Core Identity requires several \\nsteps: \\n1. \\nCreate ASP.NET Core Identity data\", \"base schema in the destination database \\n2. \\nMigrate data from universal provider schema to ASP.NET \", \"Core Identity schema \\n3. \\nMigrate configuration from the web.config to middleware and services, typi\", \"cally in Program.cs \\n(or a Startup class) \\n4. \\nUpdate individual pages using controls and conditiona\", \"ls to use tag helpers and new identity \\nAPIs. \\nEach of these steps is described in detail in the fol\", \"lowing sections. \\nCreating the ASP.NET Core Identity schema \\nThere are several ways to create the ne\", \"cessary table structure used for ASP.NET Core Identity. The \\nsimplest is to create a new ASP.NET Cor\", \"e Web application. Choose Web Application and then change \\nAuthentication type to use Individual Acc\", \"ounts. \\n \\n71 \\nCHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazo\", \"r \\n \\n \\nFrom the command line, you can do the same thing by running dotnet new webapp -au Individual.\", \" \\nOnce the app has been created, run it and register on the site. You should trigger a page like the\", \" one \\nshown below: \\n \\n72 \\nCHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web For\", \"ms and Blazor \\n \\n \\nClick on the \\u201cApply Migrations\\u201d button and the necessary database tables should b\", \"e created for you. \\nIn addition, the migration files should appear in your project, as shown: \\n \\n73 \", \"\\nCHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor \\n \\n \\nYou ca\", \"n run the migration yourself, without running the web application, using this command-line \\ntool: \\nd\", \"otnet ef database update \\nIf you would rather run a script to apply the new schema to an existing da\", \"tabase, you can script these \\nmigrations from the command-line. Run this command to generate the scr\", \"ipt: \\ndotnet ef migrations script -o auth.sql \\nThe above command will produce a SQL script in the ou\", \"tput file auth.sql, which can then be run \\nagainst whatever database you like. If you have any troub\", \"le running dotnet ef commands, make sure \\nyou have the EF Core tools installed on your system. \\nIn t\", \"he event you have additional columns on your source tables, you will need to identify the best \\nloca\", \"tion for these columns in the new schema. Generally, columns found on the aspnet_Membership \\ntable s\", \"hould be mapped to the AspNetUsers table. Columns on aspnet_Roles should be mapped to \\nAspNetRoles. \", \"Any additional columns on the aspnet_UsersInRoles table would be added to the \\nAspNetUserRoles table\", \". \\nIt\\u2019s also worth considering putting any additional columns on separate tables. So that future \\nmi\", \"grations won\\u2019t need to take into account such customizations of the default identity schema. \\nMigrat\", \"ing data from universal providers to ASP.NET Core Identity \\nOnce you have the destination table sche\", \"ma in place, the next step is to migrate your user and role \\nrecords to the new schema. A complete l\", \"ist of the schema differences, including which columns map \\nto which new columns, can be found here.\", \" \\n \\n74 \\nCHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor \\n \\nT\", \"o migrate your users from membership to the new identity tables, you should follow the steps \\ndescri\", \"bed in the documentation. After following these steps and the script provided, your users will \\nneed\", \" to change their password the next time they log in. \\nIt is possible to migrate user passwords but t\", \"he process is much more involved. Requiring users to \\nupdate their passwords as part of the migratio\", \"n process, and encouraging them to use new, unique \\npasswords, is likely to enhance the overall secu\", \"rity of the application. \\nMigrating security settings from web.config to app startup \\nAs noted above\", \", ASP.NET membership and role providers are configured in the application\\u2019s \\nweb.config file. Since \", \"ASP.NET Core apps are not tied to IIS and use a separate system for \\nconfiguration, these settings m\", \"ust be configured elsewhere. For the most part, ASP.NET Core Identity \\nis configured in the Program.\", \"cs file. Open the web project that was created earlier (to generate the \\nidentity table schema) and \", \"review its Program.cs (or Startup.cs) file. \\nThis code adds support for EF Core and Identity: \\n// Ad\", \"d services to the container. \\nvar connectionString = builder.Configuration.GetConnectionString(\\\"Defa\", \"ultConnection\\\"); \\nbuilder.Services.AddDbContext<ApplicationDbContext>(options => \\n    options.UseSql\", \"Server(connectionString)); \\nbuilder.Services.AddDatabaseDeveloperPageExceptionFilter(); \\nbuilder.Ser\", \"vices.AddDefaultIdentity<IdentityUser>(options => \\n    options.SignIn.RequireConfirmedAccount = true\", \") \\n    .AddEntityFrameworkStores<ApplicationDbContext>(); \\nThe AddDefaultIdentity extension method i\", \"s used to configure Identity to use the default \\nApplicationDbContext and the framework\\u2019s IdentityUs\", \"er type. If you\\u2019re using a custom IdentityUser, be \\nsure to specify its type here. If these extensio\", \"n methods aren\\u2019t working in your application, check that \\nyou have the appropriate using statements \", \"and that you have the necessary NuGet package \\nreferences. For example, your project should have som\", \"e version of the \\nMicrosoft.AspNetCore.Identity.EntityFrameworkCore and Microsoft.AspNetCore.Identit\", \"y.UI packages \\nreferenced. \\nAlso in Program.cs you should see the necessary middleware configured fo\", \"r the site. Specifically, \\nUseAuthentication and UseAuthorization should be set up, and in the prope\", \"r location. \\n// Configure the HTTP request pipeline. \\nif (app.Environment.IsDevelopment()) \\n{ \\n    a\", \"pp.UseMigrationsEndPoint(); \\n} \\nelse \\n{ \\n    app.UseExceptionHandler(\\\"/Error\\\"); \\n    // The default \", \"HSTS value is 30 days. You may want to change this for production \\nscenarios, see https://aka.ms/asp\", \"netcore-hsts. \\n    app.UseHsts(); \\n} \\n \\napp.UseHttpsRedirection(); \\n \\napp.UseStaticFiles(); \\n \\n75 \\nC\", \"HAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor \\n \\n \\napp.UseR\", \"outing(); \\n \\napp.UseAuthentication(); \\napp.UseAuthorization(); \\n \\n//app.MapControllers(); \\napp.MapBl\", \"azorHub(); \\napp.MapFallbackToPage(\\\"/_Host\\\"); \\nASP.NET Identity does not configure anonymous or role-\", \"based access to locations from Program.cs. \\nYou will need to migrate any location-specific authoriza\", \"tion configuration data to filters in ASP.NET \\nCore. Make note of which folders and pages will requi\", \"re such updates. You will make these changes in \\nthe next section. \\nUpdating individual pages to use\", \" ASP.NET Core Identity abstractions \\nIn your ASP.NET Web Forms application, if you had web.config se\", \"ttings to deny access to certain \\npages or folders to anonymous users, you would migrate these chang\", \"es by adding the [Authorize] \\nattribute to such pages: \\n@attribute [Authorize] \\nIf you further had d\", \"enied access except to those users belonging to a certain role, you would likewise \\nmigrate this beh\", \"avior by adding an attribute specifying a role: \\n@attribute [Authorize(Roles =\\\"administrators\\\")] \\nTh\", \"e [Authorize] attribute only works on @page components that are reached via the Blazor Router. \\nThe \", \"attribute does not work with child components, which should instead use AuthorizeView. \\nIf you have \", \"logic within page markup for determining whether to display some code to a certain user, \\nyou can re\", \"place this with the AuthorizeView component. The AuthorizeView component selectively \\ndisplays UI de\", \"pending on whether the user is authorized to see it. It also exposes a context variable \\nthat can be\", \" used to access user information. \\n<AuthorizeView> \\n    <Authorized> \\n        <h1>Hello, @context.Us\", \"er.Identity.Name!</h1> \\n        <p>You can only see this content if you are authenticated.</p> \\n    \", \"</Authorized> \\n    <NotAuthorized> \\n        <h1>Authentication Failure!</h1> \\n        <p>You are not\", \" signed in.</p> \\n    </NotAuthorized> \\n</AuthorizeView> \\nYou can access the authentication state wit\", \"hin procedural logic by accessing the user from a \\nTask<AuthenticationState configured with the [Cas\", \"cadingParameter] attribute. This configuration will \\nget you access to the user, which can let you d\", \"etermine if they are authenticated and if they belong to \\na particular role. If you need to evaluate\", \" a policy procedurally, you can inject an instance of the \\nIAuthorizationService and calls the Autho\", \"rizeAsync method on it. The following sample code \\ndemonstrates how to get user information and allo\", \"w an authorized user to perform a task restricted \\nby the content-editor policy. \\n \\n76 \\nCHAPTER 13 |\", \" Security: Authentication and Authorization in ASP.NET Web Forms and Blazor \\n \\n@using Microsoft.AspN\", \"etCore.Authorization \\n@inject IAuthorizationService AuthorizationService \\n \\n<button @onclick=\\\"@DoSom\", \"ething\\\">Do something important</button> \\n \\n@code { \\n    [CascadingParameter] \\n    private Task<Authe\", \"nticationState> authenticationStateTask { get; set; } \\n \\n    private async Task DoSomething() \\n    {\", \" \\n        var user = (await authenticationStateTask).User; \\n \\n        if (user.Identity.IsAuthentica\", \"ted) \\n        { \\n            // Perform an action only available to authenticated (signed-in) users.\", \" \\n        } \\n \\n        if (user.IsInRole(\\\"admin\\\")) \\n        { \\n            // Perform an action only\", \" available to users in the 'admin' role. \\n        } \\n \\n        if ((await AuthorizationService.Autho\", \"rizeAsync(user, \\\"content-editor\\\")) \\n            .Succeeded) \\n        { \\n            // Perform an ac\", \"tion only available to users satisfying the \\n            // 'content-editor' policy. \\n        } \\n   \", \" } \\n} \\nThe AuthenticationState first need to be set up as a cascading value before it can be bound t\", \"o a \\ncascading parameter like this. That\\u2019s typically done using the CascadingAuthenticationState \\nco\", \"mponent. This configuration is typically done in App.razor: \\n<CascadingAuthenticationState> \\n    <Ro\", \"uter AppAssembly=\\\"@typeof(Program).Assembly\\\"> \\n        <Found Context=\\\"routeData\\\"> \\n            <Aut\", \"horizeRouteView RouteData=\\\"@routeData\\\" \\n                DefaultLayout=\\\"@typeof(MainLayout)\\\" /> \\n    \", \"    </Found> \\n        <NotFound> \\n            <LayoutView Layout=\\\"@typeof(MainLayout)\\\"> \\n           \", \"     <p>Sorry, there's nothing at this address.</p> \\n            </LayoutView> \\n        </NotFound> \", \"\\n    </Router> \\n</CascadingAuthenticationState> \\nSummary \\nBlazor uses the same security model as ASP\", \".NET Core, which is ASP.NET Core Identity. Migrating from \\nuniversal providers to ASP.NET Core Ident\", \"ity is relatively straightforward, assuming not too much \\ncustomization was applied to the original \", \"data schema. Once the data has been migrated, working \\n \\n77 \\nCHAPTER 13 | Security: Authentication a\", \"nd Authorization in ASP.NET Web Forms and Blazor \\n \\nwith authentication and authorization in Blazor \", \"apps is well documented, with configurable as well as \\nprogrammatic support for most security requir\", \"ements. \\nReferences \\n\\u2022 \\nIntroduction to Identity on ASP.NET Core \\n\\u2022 \\nMigrate from ASP.NET Membership\", \" authentication to ASP.NET Core 2.0 Identity \\n\\u2022 \\nMigrate Authentication and Identity to ASP.NET Core\", \" \\n\\u2022 \\nASP.NET Core Blazor authentication and authorization \\n \\n78 \\nCHAPTER 14 | Migrate from ASP.NET W\", \"eb Forms to Blazor \\n \\nCHAPTER 14 \\nMigrate from ASP.NET \\nWeb Forms to Blazor \\nMigrating a code base f\", \"rom ASP.NET Web Forms to Blazor is a time-consuming task that requires \\nplanning. This chapter outli\", \"nes the process. Something that can ease the transition is to ensure the \\napp adheres to an N-tier a\", \"rchitecture, wherein the app model (in this case, Web Forms) is separate \\nfrom the business logic. T\", \"his logical separation of layers makes it clear what needs to move to .NET \\nCore and Blazor. \\nFor th\", \"is example, the eShop app available on GitHub is used. eShop is a catalog service that provides \\nCRU\", \"D capabilities via form entry and validation. \\nWhy should a working app be migrated to Blazor? Many \", \"times, there\\u2019s no need. ASP.NET Web Forms \\nwill continue to be supported for many years. However, ma\", \"ny of the features that Blazor provides are \\nonly supported on a migrated app. Such features include\", \": \\n\\u2022 \\nPerformance improvements in the framework such as Span<T> \\n\\u2022 \\nAbility to run as WebAssembly \\n\\u2022\", \" \\nCross-platform support for Linux and macOS \\n\\u2022 \\nApp-local deployment or shared framework deployment\", \" without impacting other apps \\nIf these or other new features are compelling enough, there may be va\", \"lue in migrating the app. The \\nmigration can take different shapes; it can be the entire app, or onl\", \"y certain endpoints that require the \\nchanges. The decision to migrate is ultimately based on the bu\", \"siness problems to be solved by the \\ndeveloper. \\nServer-side versus client-side hosting \\nAs describe\", \"d in the hosting models chapter, a Blazor app can be hosted in two different ways: server-\\nside and \", \"client-side. The server-side model uses ASP.NET Core SignalR connections to manage the \\nDOM updates \", \"while running any actual code on the server. The client-side model runs as \\nWebAssembly within a bro\", \"wser and requires no server connections. There are a number of differences \\nthat may affect which is\", \" best for a specific app: \\n\\u2022 \\nRunning as WebAssembly doesn\\u2019t support all features (such as threading\", \") at the current time \\n\\u2022 \\nChatty communication between the client and server may cause latency issue\", \"s in server-side \\nmode \\n \\n79 \\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor \\n \\n\\u2022 \\nAccess to \", \"databases and internal or protected services require a separate service with client-\\nside hosting \\nA\", \"t the time of writing, the server-side model more closely resembles Web Forms. Most of this chapter \", \"\\nfocuses on the server-side hosting model, as it\\u2019s production-ready. \\nCreate a new project \\nThis ini\", \"tial migration step is to create a new project. This project type is based on the SDK style \\nproject\", \"s of .NET and simplifies much of the boilerplate that was used in previous project formats. For \\nmor\", \"e detail, please see the chapter on Project Structure. \\nOnce the project has been created, install t\", \"he libraries that were used in the previous project. In older \\nWeb Forms projects, you may have used\", \" the packages.config file to list the required NuGet packages. \\nIn the new SDK-style project, packag\", \"es.config has been replaced with <PackageReference> elements \\nin the project file. A benefit to this\", \" approach is that all dependencies are installed transitively. You only \\nlist the top-level dependen\", \"cies you care about. \\nMany of the dependencies you\\u2019re using are available for .NET, including Entity\", \" Framework 6 and \\nlog4net. If there\\u2019s no .NET or .NET Standard version available, the .NET Framework\", \" version can often \\nbe used. Your mileage may vary. Any API used that isn\\u2019t available in .NET causes\", \" a runtime error. Visual \\nStudio notifies you of such packages. A yellow icon appears on the project\", \"\\u2019s References node in \\nSolution Explorer. \\nIn the Blazor-based eShop project, you can see the packag\", \"es that are installed. Previously, the \\npackages.config file listed every package used in the projec\", \"t, resulting in a file almost 50 lines long. A \\nsnippet of packages.config is: \\n<?xml version=\\\"1.0\\\" \", \"encoding=\\\"utf-8\\\"?> \\n<packages> \\n  ... \\n  <package id=\\\"Microsoft.ApplicationInsights.Agent.Intercept\\\"\", \" version=\\\"2.4.0\\\" \\ntargetFramework=\\\"net472\\\" /> \\n  <package id=\\\"Microsoft.ApplicationInsights.Dependen\", \"cyCollector\\\" version=\\\"2.9.1\\\" \\ntargetFramework=\\\"net472\\\" /> \\n  <package id=\\\"Microsoft.ApplicationInsig\", \"hts.PerfCounterCollector\\\" version=\\\"2.9.1\\\" \\ntargetFramework=\\\"net472\\\" /> \\n  <package id=\\\"Microsoft.App\", \"licationInsights.Web\\\" version=\\\"2.9.1\\\" targetFramework=\\\"net472\\\" \\n/> \\n  <package id=\\\"Microsoft.Applica\", \"tionInsights.WindowsServer\\\" version=\\\"2.9.1\\\" \\ntargetFramework=\\\"net472\\\" /> \\n  <package id=\\\"Microsoft.A\", \"pplicationInsights.WindowsServer.TelemetryChannel\\\" \\nversion=\\\"2.9.1\\\" targetFramework=\\\"net472\\\" /> \\n  <\", \"package id=\\\"Microsoft.AspNet.FriendlyUrls\\\" version=\\\"1.0.2\\\" targetFramework=\\\"net472\\\" /> \\n  <package i\", \"d=\\\"Microsoft.AspNet.FriendlyUrls.Core\\\" version=\\\"1.0.2\\\" targetFramework=\\\"net472\\\" \\n/> \\n  <package id=\\\"\", \"Microsoft.AspNet.ScriptManager.MSAjax\\\" version=\\\"5.0.0\\\" \\ntargetFramework=\\\"net472\\\" /> \\n  <package id=\\\"\", \"Microsoft.AspNet.ScriptManager.WebForms\\\" version=\\\"5.0.0\\\" \\ntargetFramework=\\\"net472\\\" /> \\n  ... \\n  <pac\", \"kage id=\\\"System.Memory\\\" version=\\\"4.5.1\\\" targetFramework=\\\"net472\\\" /> \\n  <package id=\\\"System.Numerics.\", \"Vectors\\\" version=\\\"4.4.0\\\" targetFramework=\\\"net472\\\" /> \\n  <package id=\\\"System.Runtime.CompilerServices\", \".Unsafe\\\" version=\\\"4.5.0\\\" \\n \\n80 \\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor \\n \\ntargetFrame\", \"work=\\\"net472\\\" /> \\n  <package id=\\\"System.Threading.Channels\\\" version=\\\"4.5.0\\\" targetFramework=\\\"net472\\\"\", \" /> \\n  <package id=\\\"System.Threading.Tasks.Extensions\\\" version=\\\"4.5.1\\\" targetFramework=\\\"net472\\\" \\n/> \", \"\\n  <package id=\\\"WebGrease\\\" version=\\\"1.6.0\\\" targetFramework=\\\"net472\\\" /> \\n</packages> \\nThe <packages> \", \"element includes all necessary dependencies. It\\u2019s difficult to identify which of these \\npackages are\", \" included because you require them. Some <package> elements are listed simply to \\nsatisfy the needs \", \"of dependencies you require. \\nThe Blazor project lists the dependencies you require within an <ItemG\", \"roup> element in the project \\nfile: \\n<ItemGroup> \\n    <PackageReference Include=\\\"Autofac\\\" Version=\\\"4\", \".9.3\\\" /> \\n    <PackageReference Include=\\\"EntityFramework\\\" Version=\\\"6.4.4\\\" /> \\n    <PackageReference \", \"Include=\\\"log4net\\\" Version=\\\"2.0.12\\\" /> \\n    <PackageReference Include=\\\"Microsoft.Extensions.Logging.L\", \"og4Net.AspNetCore\\\" \\nVersion=\\\"2.2.12\\\" /> \\n</ItemGroup> \\nOne NuGet package that simplifies the life of\", \" Web Forms developers is the Windows Compatibility \\nPack. Although .NET is cross-platform, some feat\", \"ures are only available on Windows. Windows-\\nspecific features are made available by installing the \", \"compatibility pack. Examples of such features \\ninclude the Registry, WMI, and Directory Services. Th\", \"e package adds around 20,000 APIs and activates \\nmany services with which you may already be familia\", \"r. The eShop project doesn\\u2019t require the \\ncompatibility pack; but if your projects use Windows-speci\", \"fic features, the package eases the \\nmigration efforts. \\nEnable startup process \\nThe startup process\", \" for Blazor has changed from Web Forms and follows a similar setup for other \\nASP.NET Core services.\", \" When hosted server-side, Razor components are run as part of a normal \\nASP.NET Core app. When hoste\", \"d in the browser with WebAssembly, Razor components use a similar \\nhosting model. The difference is \", \"the components are run as a separate service from any of the \\nbackend processes. Either way, the sta\", \"rtup is similar. \\nThe Global.asax.cs file is the default startup page for Web Forms projects. In the\", \" eShop project, this file \\nconfigures the Inversion of Control (IoC) container and handles the vario\", \"us lifecycle events of the app \\nor request. Some of these events are handled with middleware (such a\", \"s Application_BeginRequest). \\nOther events require the overriding of specific services via dependenc\", \"y injection (DI). \\nBy way of example, the Global.asax.cs file for eShop, contains the following code\", \": \\npublic class Global : HttpApplication, IContainerProviderAccessor \\n{ \\n    private static readonly\", \" ILog _log = \\nLogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType); \\n\", \" \\n    static IContainerProvider _containerProvider; \\n    IContainer container; \\n \\n \\n81 \\nCHAPTER 14 |\", \" Migrate from ASP.NET Web Forms to Blazor \\n \\n    public IContainerProvider ContainerProvider \\n    { \", \"\\n        get { return _containerProvider; } \\n    } \\n \\n    protected void Application_Start(object se\", \"nder, EventArgs e) \\n    { \\n        // Code that runs on app startup \\n        RouteConfig.RegisterRou\", \"tes(RouteTable.Routes); \\n        BundleConfig.RegisterBundles(BundleTable.Bundles); \\n        Configu\", \"reContainer(); \\n        ConfigDataBase(); \\n    } \\n \\n    /// <summary> \\n    /// Track the machine nam\", \"e and the start time for the session inside the current \\nsession \\n    /// </summary> \\n    protected \", \"void Session_Start(Object sender, EventArgs e) \\n    { \\n        HttpContext.Current.Session[\\\"MachineN\", \"ame\\\"] = Environment.MachineName; \\n        HttpContext.Current.Session[\\\"SessionStartTime\\\"] = DateTime\", \".Now; \\n    } \\n \\n    /// <summary> \\n    /// https://autofaccn.readthedocs.io/en/latest/integration/we\", \"bforms.html \\n    /// </summary> \\n    private void ConfigureContainer() \\n    { \\n        var builder =\", \" new ContainerBuilder(); \\n        var mockData = bool.Parse(ConfigurationManager.AppSettings[\\\"UseMoc\", \"kData\\\"]); \\n        builder.RegisterModule(new ApplicationModule(mockData)); \\n        container = bui\", \"lder.Build(); \\n        _containerProvider = new ContainerProvider(container); \\n    } \\n \\n    private \", \"void ConfigDataBase() \\n    { \\n        var mockData = bool.Parse(ConfigurationManager.AppSettings[\\\"Us\", \"eMockData\\\"]); \\n \\n        if (!mockData) \\n        { \\n            \\nDatabase.SetInitializer<CatalogDBCo\", \"ntext>(container.Resolve<CatalogDBInitializer>()); \\n        } \\n    } \\n \\n    protected void Applicati\", \"on_BeginRequest(object sender, EventArgs e) \\n    { \\n        //set the property to our new object \\n  \", \"      LogicalThreadContext.Properties[\\\"activityid\\\"] = new ActivityIdHelper(); \\n \\n        LogicalThre\", \"adContext.Properties[\\\"requestinfo\\\"] = new WebRequestInfo(); \\n \\n        _log.Debug(\\\"Application_Begin\", \"Request\\\"); \\n    } \\n} \\nThe preceding file becomes the Program.cs file in server-side Blazor: \\n \\n82 \\nC\", \"HAPTER 14 | Migrate from ASP.NET Web Forms to Blazor \\n \\nusing eShopOnBlazor.Models; \\nusing eShopOnBl\", \"azor.Models.Infrastructure; \\nusing eShopOnBlazor.Services; \\nusing log4net; \\nusing System.Data.Entity\", \"; \\nusing eShopOnBlazor; \\n \\nvar builder = WebApplication.CreateBuilder(args); \\n \\n// add services \\n \\nb\", \"uilder.Services.AddRazorPages(); \\nbuilder.Services.AddServerSideBlazor(); \\n \\nif (builder.Configurati\", \"on.GetValue<bool>(\\\"UseMockData\\\")) \\n{ \\n    builder.Services.AddSingleton<ICatalogService, CatalogServ\", \"iceMock>(); \\n} \\nelse \\n{ \\n    builder.Services.AddScoped<ICatalogService, CatalogService>(); \\n    bui\", \"lder.Services.AddScoped<IDatabaseInitializer<CatalogDBContext>, \\nCatalogDBInitializer>(); \\n    build\", \"er.Services.AddSingleton<CatalogItemHiLoGenerator>(); \\n    builder.Services.AddScoped(_ => new \\nCata\", \"logDBContext(builder.Configuration.GetConnectionString(\\\"CatalogDBContext\\\"))); \\n} \\n \\nvar app = builde\", \"r.Build(); \\n \\nnew LoggerFactory().AddLog4Net(\\\"log4Net.xml\\\"); \\n \\nif (app.Environment.IsDevelopment())\", \" \\n{ \\n    app.UseDeveloperExceptionPage(); \\n} \\nelse \\n{ \\n    app.UseExceptionHandler(\\\"/Home/Error\\\"); \\n\", \"} \\n \\n// Middleware for Application_BeginRequest \\napp.Use((ctx, next) => \\n{ \\n    LogicalThreadContext\", \".Properties[\\\"activityid\\\"] = new ActivityIdHelper(ctx); \\n    LogicalThreadContext.Properties[\\\"request\", \"info\\\"] = new WebRequestInfo(ctx); \\n    return next(); \\n}); \\n \\napp.UseStaticFiles(); \\n \\napp.UseRoutin\", \"g(); \\n \\napp.UseEndpoints(endpoints => \\n{ \\n    endpoints.MapBlazorHub(); \\n    endpoints.MapFallbackTo\", \"Page(\\\"/_Host\\\"); \\n}); \\n \\nConfigDataBase(app); \\n \\n83 \\nCHAPTER 14 | Migrate from ASP.NET Web Forms to B\", \"lazor \\n \\n \\nvoid ConfigDataBase(IApplicationBuilder app) \\n{ \\n    using (var scope = app.ApplicationSe\", \"rvices.CreateScope()) \\n    { \\n        var initializer = \\nscope.ServiceProvider.GetService<IDatabaseI\", \"nitializer<CatalogDBContext>>(); \\n \\n        if (initializer != null) \\n        { \\n            Databas\", \"e.SetInitializer(initializer); \\n        } \\n    } \\n} \\n \\napp.Run(); \\nOne significant change you may no\", \"tice from Web Forms is the prominence of dependency injection \\n(DI). DI has been a guiding principle\", \" in the ASP.NET Core design. It supports customization of almost \\nall aspects of the ASP.NET Core fr\", \"amework. There\\u2019s even a built-in service provider that can be used \\nfor many scenarios. If more cust\", \"omization is required, it can be supported by many community \\nprojects. For example, you can carry f\", \"orward your third-party DI library investment. \\nIn the original eShop app, there\\u2019s some configuratio\", \"n for session management. Since server-side \\nBlazor uses ASP.NET Core SignalR for communication, the\", \" session state isn\\u2019t supported as the \\nconnections may occur independent of an HTTP context. An app \", \"that uses the session state requires \\nrearchitecting before running as a Blazor app. \\nFor more infor\", \"mation about app startup, see App startup. \\nMigrate HTTP modules and handlers to middleware \\nHTTP mo\", \"dules and handlers are common patterns in Web Forms to control the HTTP request pipeline. \\nClasses t\", \"hat implement IHttpModule or IHttpHandler could be registered and process incoming \\nrequests. Web Fo\", \"rms configure modules and handlers in the web.config file. Web Forms is also heavily \\nbased on app l\", \"ifecycle event handling. ASP.NET Core uses middleware instead. Middleware is \\nregistered in the Conf\", \"igure method of the Startup class. Middleware execution order is determined by \\nthe registration ord\", \"er. \\nIn the Enable startup process section, a lifecycle event was raised by Web Forms as the \\nApplic\", \"ation_BeginRequest method. This event isn\\u2019t available in ASP.NET Core. One way to achieve this \\nbeha\", \"vior is to implement middleware as seen in the Startup.cs file example. This middleware does the \\nsa\", \"me logic and then transfers control to the next handler in the middleware pipeline. \\nFor more inform\", \"ation on migrating modules and handlers, see Migrate HTTP handlers and modules to \\nASP.NET Core midd\", \"leware. \\n \\n84 \\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor \\n \\nMigrate static files \\nTo ser\", \"ve static files (for example, HTML, CSS, images, and JavaScript), the files must be exposed by \\nmidd\", \"leware. Calling the UseStaticFiles method enables the serving of static files from the web root \\npat\", \"h. The default web root directory is wwwroot, but it can be customized. As included in the \\nProgram.\", \"cs file: \\n... \\n \\napp.UseStaticFiles(); \\n \\n... \\nThe eShop project enables basic static file access. T\", \"here are many customizations available for static \\nfile access. For information on enabling default \", \"files or a file browser, see Static files in ASP.NET Core. \\nMigrate runtime bundling and minificatio\", \"n setup \\nBundling and minification are performance optimization techniques for reducing the number a\", \"nd size \\nof server requests to retrieve certain file types. JavaScript and CSS often undergo some fo\", \"rm of \\nbundling or minification before being sent to the client. In ASP.NET Web Forms, these optimiz\", \"ations \\nare handled at run time. The optimization conventions are defined an App_Start/BundleConfig.\", \"cs file. \\nIn ASP.NET Core, a more declarative approach is adopted. A file lists the files to be mini\", \"fied, along \\nwith specific minification settings. \\nFor more information on bundling and minification\", \", see Bundle and minify static assets in ASP.NET \\nCore. \\nMigrate ASPX pages \\nA page in a Web Forms a\", \"pp is a file with the .aspx extension. A Web Forms page can often be mapped \\nto a component in Blazo\", \"r. A Razor component is authored in a file with the .razor extension. For the \\neShop project, five p\", \"ages are converted to a Razor page. \\nFor example, the details view comprises three files in the Web \", \"Forms project: Details.aspx, \\nDetails.aspx.cs, and Details.aspx.designer.cs. When converting to Blaz\", \"or, the code-behind and markup \\nare combined into Details.razor. Razor compilation (equivalent to wh\", \"at\\u2019s in .designer.cs files) is stored \\nin the obj directory and isn\\u2019t, by default, viewable in Solut\", \"ion Explorer. The Web Forms page consists \\nof the following markup: \\n<%@ Page Title=\\\"Details\\\" Langua\", \"ge=\\\"C#\\\" MasterPageFile=\\\"~/Site.Master\\\" \\nAutoEventWireup=\\\"true\\\" CodeBehind=\\\"Details.aspx.cs\\\" \\nInherit\", \"s=\\\"eShopLegacyWebForms.Catalog.Details\\\" %> \\n \\n<asp:Content ID=\\\"Details\\\" ContentPlaceHolderID=\\\"MainCo\", \"ntent\\\" runat=\\\"server\\\"> \\n    <h2 class=\\\"esh-body-title\\\">Details</h2> \\n \\n    <div class=\\\"container\\\"> \\n\", \"        <div class=\\\"row\\\"> \\n \\n85 \\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor \\n \\n          \", \"  <asp:Image runat=\\\"server\\\" CssClass=\\\"col-md-6 esh-picture\\\" ImageUrl='<%#\\\"/Pics/\\\" \\n+ product.Picture\", \"FileName%>' /> \\n            <dl class=\\\"col-md-6 dl-horizontal\\\"> \\n                <dt>Name \\n         \", \"       </dt> \\n \\n                <dd> \\n                    <asp:Label runat=\\\"server\\\" Text='<%#product\", \".Name%>' /> \\n                </dd> \\n \\n                <dt>Description \\n                </dt> \\n \\n    \", \"            <dd> \\n                    <asp:Label runat=\\\"server\\\" Text='<%#product.Description%>' /> \\n\", \"                </dd> \\n \\n                <dt>Brand \\n                </dt> \\n \\n                <dd> \\n \", \"                   <asp:Label runat=\\\"server\\\" Text='<%#product.CatalogBrand.Brand%>' /> \\n            \", \"    </dd> \\n \\n                <dt>Type \\n                </dt> \\n \\n                <dd> \\n              \", \"      <asp:Label runat=\\\"server\\\" Text='<%#product.CatalogType.Type%>' /> \\n                </dd> \\n    \", \"            <dt>Price \\n                </dt> \\n \\n                <dd> \\n                    <asp:Label\", \" CssClass=\\\"esh-price\\\" runat=\\\"server\\\" \\nText='<%#product.Price%>' /> \\n                </dd> \\n \\n       \", \"         <dt>Picture name \\n                </dt> \\n \\n                <dd> \\n                    <asp:L\", \"abel runat=\\\"server\\\" Text='<%#product.PictureFileName%>' /> \\n                </dd> \\n \\n               \", \" <dt>Stock \\n                </dt> \\n \\n                <dd> \\n                    <asp:Label runat=\\\"ser\", \"ver\\\" Text='<%#product.AvailableStock%>' /> \\n                </dd> \\n \\n                <dt>Restock \\n  \", \"              </dt> \\n \\n                <dd> \\n                    <asp:Label runat=\\\"server\\\" Text='<%#\", \"product.RestockThreshold%>' /> \\n                </dd> \\n \\n                <dt>Max stock \\n            \", \"    </dt> \\n \\n86 \\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor \\n \\n \\n                <dd> \\n  \", \"                  <asp:Label runat=\\\"server\\\" Text='<%#product.MaxStockThreshold%>' /> \\n              \", \"  </dd> \\n \\n            </dl> \\n        </div> \\n \\n        <div class=\\\"form-actions no-color esh-link-l\", \"ist\\\"> \\n            <a runat=\\\"server\\\" href='<%# GetRouteUrl(\\\"EditProductRoute\\\", new {id \\n=product.Id}\", \") %>' class=\\\"esh-link-item\\\">Edit \\n            </a> \\n            | \\n            <a runat=\\\"server\\\" hre\", \"f=\\\"~\\\" class=\\\"esh-link-item\\\">Back to list \\n            </a> \\n        </div> \\n \\n    </div> \\n</asp:Cont\", \"ent> \\nThe preceding markup\\u2019s code-behind includes the following code: \\nusing eShopLegacyWebForms.Mod\", \"els; \\nusing eShopLegacyWebForms.Services; \\nusing log4net; \\nusing System; \\nusing System.Web.UI; \\n \\nna\", \"mespace eShopLegacyWebForms.Catalog \\n{ \\n    public partial class Details : System.Web.UI.Page \\n    {\", \" \\n        private static readonly ILog _log = \\nLogManager.GetLogger(System.Reflection.MethodBase.Get\", \"CurrentMethod().DeclaringType); \\n \\n        protected CatalogItem product; \\n \\n        public ICatalog\", \"Service CatalogService { get; set; } \\n \\n        protected void Page_Load(object sender, EventArgs e)\", \" \\n        { \\n            var productId = Convert.ToInt32(Page.RouteData.Values[\\\"id\\\"]); \\n            \", \"_log.Info($\\\"Now loading... /Catalog/Details.aspx?id={productId}\\\"); \\n            product = CatalogSer\", \"vice.FindCatalogItem(productId); \\n \\n            this.DataBind(); \\n        } \\n    } \\n} \\nWhen converte\", \"d to Blazor, the Web Forms page translates to the following code: \\n@page \\\"/Catalog/Details/{id:int}\\\"\", \" \\n@inject ICatalogService CatalogService \\n@inject ILogger<Details> Logger \\n \\n<h2 class=\\\"esh-body-tit\", \"le\\\">Details</h2> \\n \\n<div class=\\\"container\\\"> \\n    <div class=\\\"row\\\"> \\n \\n87 \\nCHAPTER 14 | Migrate from \", \"ASP.NET Web Forms to Blazor \\n \\n        <img class=\\\"col-md-6 esh-picture\\\" src=\\\"@($\\\"/Pics/{_item.Pictu\", \"reFileName}\\\")\\\"> \\n \\n        <dl class=\\\"col-md-6 dl-horizontal\\\"> \\n            <dt> \\n                Na\", \"me \\n            </dt> \\n \\n            <dd> \\n                @_item.Name \\n            </dd> \\n \\n       \", \"     <dt> \\n                Description \\n            </dt> \\n \\n            <dd> \\n                @_ite\", \"m.Description \\n            </dd> \\n \\n            <dt> \\n                Brand \\n            </dt> \\n \\n  \", \"          <dd> \\n                @_item.CatalogBrand.Brand \\n            </dd> \\n \\n            <dt> \\n  \", \"              Type \\n            </dt> \\n \\n            <dd> \\n                @_item.CatalogType.Type \\n\", \"            </dd> \\n            <dt> \\n                Price \\n            </dt> \\n \\n            <dd> \\n \", \"               @_item.Price \\n            </dd> \\n \\n            <dt> \\n                Picture name \\n  \", \"          </dt> \\n \\n            <dd> \\n                @_item.PictureFileName \\n            </dd> \\n \\n  \", \"          <dt> \\n                Stock \\n            </dt> \\n \\n            <dd> \\n                @_item\", \".AvailableStock \\n            </dd> \\n \\n            <dt> \\n                Restock \\n            </dt> \\n\", \" \\n88 \\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor \\n \\n \\n            <dd> \\n                @\", \"_item.RestockThreshold \\n            </dd> \\n \\n            <dt> \\n                Max stock \\n          \", \"  </dt> \\n \\n            <dd> \\n                @_item.MaxStockThreshold \\n            </dd> \\n \\n        \", \"</dl> \\n    </div> \\n \\n    <div class=\\\"form-actions no-color esh-link-list\\\"> \\n        <a href=\\\"@($\\\"/Ca\", \"talog/Edit/{_item.Id}\\\")\\\" class=\\\"esh-link-item\\\"> \\n            Edit \\n        </a> \\n        | \\n        \", \"<a href=\\\"/\\\" class=\\\"esh-link-item\\\"> \\n            Back to list \\n        </a> \\n    </div> \\n \\n</div> \\n \\n\", \"@code { \\n    private CatalogItem _item; \\n \\n    [Parameter] \\n    public int Id { get; set; } \\n \\n    p\", \"rotected override void OnInitialized() \\n    { \\n        Logger.LogInformation(\\\"Now loading... /Catalo\", \"g/Details/{Id}\\\", Id); \\n \\n        _item = CatalogService.FindCatalogItem(Id); \\n    } \\n} \\nNotice that \", \"the code and markup are in the same file. Any required services are made accessible with \\nthe @injec\", \"t attribute. Per the @page directive, this page can be accessed at the Catalog/Details/{id} \\nroute. \", \"The value of the route\\u2019s {id} placeholder has been constrained to an integer. As described in the \\nr\", \"outing section, unlike Web Forms, a Razor component explicitly states its route and any parameters \\n\", \"that are included. Many Web Forms controls may not have exact counterparts in Blazor. There\\u2019s often \", \"\\nan equivalent HTML snippet that will serve the same purpose. For example, the <asp:Label /> control\", \" \\ncan be replaced with an HTML <label> element. \\nModel validation in Blazor \\nIf your Web Forms code \", \"includes validation, you can transfer much of what you have with little-to-no \\nchanges. A benefit to\", \" running in Blazor is that the same validation logic can be run without needing \\ncustom JavaScript. \", \"Data annotations enable easy model validation. \\n \\n89 \\nCHAPTER 14 | Migrate from ASP.NET Web Forms to\", \" Blazor \\n \\nFor example, the Create.aspx page has a data entry form with validation. An example snipp\", \"et would \\nlook like this: \\n<div class=\\\"form-group\\\"> \\n    <label class=\\\"control-label col-md-2\\\">Name<\", \"/label> \\n    <div class=\\\"col-md-3\\\"> \\n        <asp:TextBox ID=\\\"Name\\\" runat=\\\"server\\\" CssClass=\\\"form-co\", \"ntrol\\\"></asp:TextBox> \\n        <asp:RequiredFieldValidator runat=\\\"server\\\" ControlToValidate=\\\"Name\\\" \\n\", \"Display=\\\"Dynamic\\\" \\n            CssClass=\\\"field-validation-valid text-danger\\\" ErrorMessage=\\\"The Name \", \"field is \\nrequired.\\\" /> \\n    </div> \\n</div> \\nIn Blazor, the equivalent markup is provided in a Creat\", \"e.razor file: \\n<EditForm Model=\\\"_item\\\" OnValidSubmit=\\\"@...\\\"> \\n    <DataAnnotationsValidator /> \\n \\n  \", \"  <div class=\\\"form-group\\\"> \\n        <label class=\\\"control-label col-md-2\\\">Name</label> \\n        <div\", \" class=\\\"col-md-3\\\"> \\n            <InputText class=\\\"form-control\\\" @bind-Value=\\\"_item.Name\\\" /> \\n       \", \"     <ValidationMessage For=\\\"(() => _item.Name)\\\" /> \\n        </div> \\n    </div> \\n \\n    ... \\n</EditFo\", \"rm> \\nThe EditForm context includes validation support and can be wrapped around an input. Data \\nanno\", \"tations are a common way to add validation. Such validation support can be added via the \\nDataAnnota\", \"tionsValidator component. For more information on this mechanism, see ASP.NET Core \\nBlazor forms and\", \" validation. \\nMigrate configuration \\nIn a Web Forms project, configuration data is most commonly sto\", \"red in the web.config file. The \\nconfiguration data is accessed with ConfigurationManager. Services \", \"were often required to parse \\nobjects. With .NET Framework 4.7.2, composability was added to the con\", \"figuration via \\nConfigurationBuilders. These builders allowed developers to add various sources for \", \"the configuration \\nthat was then composed at run time to retrieve the necessary values. \\nASP.NET Cor\", \"e introduced a flexible configuration system that allows you to define the configuration \\nsource or \", \"sources used by your app and deployment. The ConfigurationBuilder infrastructure that you \\nmay be us\", \"ing in your Web Forms app was modeled after the concepts used in the ASP.NET Core \\nconfiguration sys\", \"tem. \\nThe following snippet demonstrates how the Web Forms eShop project uses web.config to store \\nc\", \"onfiguration values: \\n<configuration> \\n  <configSections> \\n    <section name=\\\"entityFramework\\\" \\n \\n90\", \" \\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor \\n \\ntype=\\\"System.Data.Entity.Internal.ConfigF\", \"ile.EntityFrameworkSection, EntityFramework, \\nVersion=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5\", \"c561934e089\\\" \\nrequirePermission=\\\"false\\\" /> \\n  </configSections> \\n  <connectionStrings> \\n    <add nam\", \"e=\\\"CatalogDBContext\\\" connectionString=\\\"Data Source=(localdb)\\\\MSSQLLocalDB; \\nInitial Catalog=Microsof\", \"t.eShopOnContainers.Services.CatalogDb; Integrated Security=True; \\nMultipleActiveResultSets=True;\\\" p\", \"roviderName=\\\"System.Data.SqlClient\\\" /> \\n  </connectionStrings> \\n  <appSettings> \\n    <add key=\\\"UseMo\", \"ckData\\\" value=\\\"true\\\" /> \\n    <add key=\\\"UseCustomizationData\\\" value=\\\"false\\\" /> \\n  </appSettings> \\n</c\", \"onfiguration> \\nIt\\u2019s common for secrets, such as database connection strings, to be stored within the\", \" web.config. The \\nsecrets are inevitably persisted in unsecure locations, such as source control. Wi\", \"th Blazor on ASP.NET \\nCore, the preceding XML-based configuration is replaced with the following JSO\", \"N: \\n{ \\n  \\\"ConnectionStrings\\\": { \\n    \\\"CatalogDBContext\\\": \\\"Data Source=(localdb)\\\\\\\\MSSQLLocalDB; Initi\", \"al \\nCatalog=Microsoft.eShopOnContainers.Services.CatalogDb; Integrated Security=True; \\nMultipleActiv\", \"eResultSets=True;\\\" \\n  }, \\n  \\\"UseMockData\\\": true, \\n  \\\"UseCustomizationData\\\": false \\n} \\nJSON is the de\", \"fault configuration format; however, ASP.NET Core supports many other formats, \\nincluding XML. There\", \" are also several community-supported formats. \\nYou can access configuration values from the builder\", \" in Program.cs: \\nif (builder.Configuration.GetValue<bool>(\\\"UseMockData\\\")) \\n{ \\n    builder.Services.A\", \"ddSingleton<ICatalogService, CatalogServiceMock>(); \\n} \\nelse \\n{ \\n    builder.Services.AddScoped<ICat\", \"alogService, CatalogService>(); \\n    builder.Services.AddScoped<IDatabaseInitializer<CatalogDBContex\", \"t>, \\nCatalogDBInitializer>(); \\n    builder.Services.AddSingleton<CatalogItemHiLoGenerator>(); \\n    b\", \"uilder.Services.AddScoped(_ => new \\nCatalogDBContext(builder.Configuration.GetConnectionString(\\\"Cata\", \"logDBContext\\\"))); \\n} \\nBy default, environment variables, JSON files (appsettings.json and appsetting\", \"s.{Environment}.json), and \\ncommand-line options are registered as valid configuration sources in th\", \"e configuration object. The \\nconfiguration sources can be accessed via Configuration[key]. A more ad\", \"vanced technique is to bind \\nthe configuration data to objects using the options pattern. For more i\", \"nformation on configuration \\nand the options pattern, see Configuration in ASP.NET Core and Options \", \"pattern in ASP.NET Core, \\nrespectively. \\n \\n91 \\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\", \" \\n \\nMigrate data access \\nData access is an important aspect of any app. The eShop project stores cat\", \"alog information in a \\ndatabase and retrieves the data with Entity Framework (EF) 6. Since EF 6 is s\", \"upported in .NET 5, the \\nproject can continue to use it. \\nThe following EF-related changes were nece\", \"ssary to eShop: \\n\\u2022 \\nIn .NET Framework, the DbContext object accepts a string of the form name=Connec\", \"tionString \\nand uses the connection string from ConfigurationManager.AppSettings[ConnectionString] t\", \"o \\nconnect. In .NET Core, this isn\\u2019t supported. The connection string must be supplied. \\n\\u2022 \\nThe data\", \"base was accessed in a synchronous way. Though this works, scalability may suffer. \\nThis logic shoul\", \"d be moved to an asynchronous pattern. \\nAlthough there isn\\u2019t the same native support for dataset bin\", \"ding, Blazor provides flexibility and power \\nwith its C# support in a Razor page. For example, you c\", \"an perform calculations and display the result. \\nFor more information on data patterns in Blazor, se\", \"e the Data access chapter. \\nArchitectural changes \\nFinally, there are some important architectural d\", \"ifferences to consider when migrating to Blazor. Many \\nof these changes are applicable to anything b\", \"ased on .NET Core or ASP.NET Core. \\nBecause Blazor is built on .NET Core, there are considerations i\", \"n ensuring support on .NET Core. Some \\nof the major changes include the removal of the following fea\", \"tures: \\n\\u2022 \\nMultiple AppDomains \\n\\u2022 \\nRemoting \\n\\u2022 \\nCode Access Security (CAS) \\n\\u2022 \\nSecurity Transparency\", \" \\nFor more information on techniques to identify necessary changes to support running on .NET Core, \", \"\\nsee Port your code from .NET Framework to .NET Core. \\nASP.NET Core is a reimagined version of ASP.N\", \"ET and has some changes that may not initially seem \\nobvious. The main changes are: \\n\\u2022 \\nNo synchroni\", \"zation context, which means there\\u2019s no HttpContext.Current, \\nThread.CurrentPrincipal, or other stati\", \"c accessors \\n\\u2022 \\nNo shadow copying \\n\\u2022 \\nNo request queue \\nMany operations in ASP.NET Core are asynchro\", \"nous, which allows easier off-loading of I/O-bound \\ntasks. It\\u2019s important to never block by using Ta\", \"sk.Wait() or Task.GetResult(), which can quickly exhaust \\nthread pool resources. \\n \\n92 \\nCHAPTER 14 |\", \" Migrate from ASP.NET Web Forms to Blazor \\n \\nMigration conclusion \\nAt this point, you\\u2019ve seen many e\", \"xamples of what it takes to move a Web Forms project to Blazor. For \\na full example, see the eShopOn\", \"Blazor project. \\n\"]"