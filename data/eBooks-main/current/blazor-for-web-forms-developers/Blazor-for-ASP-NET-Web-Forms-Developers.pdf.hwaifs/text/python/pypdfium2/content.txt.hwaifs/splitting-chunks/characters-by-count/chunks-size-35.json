"[\"EDITION v8.0 - Updated to .NET 8\\nRefer to changelog for the book updates and community contributions\", \".\\nPUBLISHED BY\\nMicrosoft Developer Division, .NET, and Visual Studio product teams\\nA division of Mic\", \"rosoft Corporation\\nOne Microsoft Way\\nRedmond, Washington 98052-6399\\nCopyright \\u00a9 2023 by Microsoft Co\", \"rporation\\nAll rights reserved. No part of the contents of this book may be reproduced or transmitted\", \" in any \\nform or by any means without the written permission of the publisher.\\nThis book is provided\", \" \\u201cas-is\\u201d and expresses the author\\u2019s views and opinions. The views, opinions, and \\ninformation expres\", \"sed in this book, including URL and other Internet website references, may change \\nwithout notice.\\nS\", \"ome examples depicted herein are provided for illustration only and are fictitious. No real associat\", \"ion \\nor connection is intended or should be inferred.\\nMicrosoft and the trademarks listed at https:/\", \"/www.microsoft.com on the \\u201cTrademarks\\u201d webpage are \\ntrademarks of the Microsoft group of companies.\\n\", \"Mac and macOS are trademarks of Apple Inc.\\nAll other marks and logos are property of their respectiv\", \"e owners.\\nAuthors:\\nDaniel Roth, Principal Program Manager, Microsoft Corp.\\nJeff Fritz, Senior Progra\", \"m Manager, Microsoft Corp.\\nTaylor Southwick, Senior Software Engineer, Microsoft Corp.\\nScott Addie, \", \"Senior Content Developer, Microsoft Corp.\\nSteve \\u201c@ardalis\\u201d Smith, Software Architect and Trainer, Ni\", \"mblePros.com\\nIntroduction\\n.NET has long supported web app development through ASP.NET, a comprehensi\", \"ve set of frameworks \\nand tools for building any kind of web app. ASP.NET has its own lineage of web\", \" frameworks and \\ntechnologies starting all the way back with classic Active Server Pages (ASP). Fram\", \"eworks like ASP.NET \\nWeb Forms, ASP.NET MVC, ASP.NET Web Pages, and more recently ASP.NET Core, prov\", \"ide a \\nproductive and powerful way to build server-rendered web apps, where UI content is dynamicall\", \"y \\ngenerated on the server in response to HTTP requests. Each ASP.NET framework caters to a differen\", \"t \\naudience and app building philosophy. ASP.NET Web Forms shipped with the original release of the \", \"\\n.NET Framework and enabled web development using many of the patterns familiar to desktop developer\", \"s, like reusable UI controls with simple event handling. However, none of the ASP.NET \\nofferings pro\", \"vide a way to run code that executed in the user\\u2019s browser. To do that requires writing \\nJavaScript \", \"and using any of the many JavaScript frameworks and tools that have phased in and out of \\npopularity\", \" over the years: jQuery, Knockout, Angular, React, and so on.\\nBlazor is a new web framework that cha\", \"nges what is possible when building web apps with .NET. \\nBlazor is a client-side web UI framework ba\", \"sed on C# instead of JavaScript. With Blazor you can write \\nyour client-side logic and UI components\", \" in C#, compile them into normal .NET assemblies, and then \\nrun them directly in the browser using a\", \" new open web standard called WebAssembly. Or \\nalternatively, Blazor can run your .NET UI components\", \" on the server and handle all UI interactions \\nfluidly over a real-time connection with the browser.\", \" When paired with .NET running on the server, \\nBlazor enables full-stack web development with .NET. \", \"While Blazor shares many commonalities with \\nASP.NET Web Forms, like having a reusable component mod\", \"el and a simple way to handle user \\nevents, it also builds on the foundations of .NET to provide a m\", \"odern and high-performance web \\ndevelopment experience.\\nThis book introduces ASP.NET Web Forms devel\", \"opers to Blazor in a way that is familiar and \\nconvenient. It introduces Blazor concepts in parallel\", \" with analogous concepts in ASP.NET Web Forms \\nwhile also explaining new concepts that may be less f\", \"amiliar. It covers a broad range of topics and \\nconcerns including component authoring, routing, lay\", \"out, configuration, and security. And while the \\ncontent of this book is primarily for enabling new \", \"development, it also covers guidelines and \\nstrategies for migrating existing ASP.NET Web Forms to B\", \"lazor for when you want to modernize an \\nexisting app.\\nWho should use the book\\nThis book is for ASP.\", \"NET Web Forms developers looking for an introduction to Blazor that relates to \\ntheir existing knowl\", \"edge and skills. This book can help with quickly getting started on a new Blazor\\u0002based project or to\", \" help chart a roadmap for modernizing an existing ASP.NET Web Forms \\napplication.\\nHow to use the boo\", \"k\\nThe first part of this book covers what Blazor is and compares it to web app development with \\nASP\", \".NET Web Forms. The book then covers a variety of Blazor topics, chapter by chapter, and relates \\nea\", \"ch Blazor concept to the corresponding concept in ASP.NET Web Forms, or explains fully any \\ncomplete\", \"ly new concepts. The book also refers regularly to a complete sample app implemented in \\nboth ASP.NE\", \"T Web Forms and Blazor to demonstrate Blazor features and to provide a case study for \\nmigrating fro\", \"m ASP.NET Web Forms to Blazor. You can find both implementations of the sample app \\n(ASP.NET Web For\", \"ms and Blazor versions) on GitHub.\\nWhat this book doesn\\u2019t cover\\nThis book is an introduction to Blaz\", \"or, not a comprehensive migration guide. While it does include \\nguidance on how to approach migratin\", \"g a project from ASP.NET Web Forms to Blazor, it does not attempt to cover every nuance and detail. \", \"For more general guidance on migrating from ASP.NET to \\nASP.NET Core, refer to the migration guidanc\", \"e in the ASP.NET Core documentation.\\nAdditional resources\\nYou can find the official Blazor home page\", \" and documentation at https://blazor.net.i Contents\\nContents\\nAn introduction to Blazor for ASP.NET W\", \"eb Forms developers ........................................ 1\\nAn open-source and cross-platform .NE\", \"T ..................................................................................................\", \"...................2\\nClient-side web development....................................................\", \".........................................................................................3\\nWebAssemb\", \"ly fulfills a need .................................................................................\", \"..............................................................3\\nBlazor: full-stack web development w\", \"ith .NET............................................................................................\", \".................4\\nGet started with Blazor..........................................................\", \"................................................................................................4\\nAr\", \"chitecture comparison of ASP.NET Web Forms and Blazor............................................ 5\\n\", \"ASP.NET Web Forms...................................................................................\", \"............................................................................5\\nBlazor................\", \"....................................................................................................\", \"........................................................................6\\nBlazor app hosting models.\", \"....................................................................................................\", \" 8\\nBlazor WebAssembly apps .........................................................................\", \"..........................................................................8\\nBlazor Server apps .....\", \"....................................................................................................\", \"..........................................................9\\nHow to choose the right Blazor hosting m\", \"odel ...............................................................................................\", \"........ 10\\nDeploy your app.........................................................................\", \"........................................................................................... 11\\nProje\", \"ct structure for Blazor apps........................................................................\", \"................. 12\\nProject file...................................................................\", \"....................................................................................................\", \"......... 12\\nEntry point............................................................................\", \"................................................................................................... \", \"13\\nStatic files ....................................................................................\", \"............................................................................................. 15\\nCon\", \"figuration..........................................................................................\", \"................................................................................ 15\\nRazor components\", \" ...................................................................................................\", \"............................................................ 15\\nPages...............................\", \"....................................................................................................\", \"....................................................... 16\\nLayout...................................\", \"....................................................................................................\", \"................................................. 16\\nBootstrap Blazor...............................\", \"....................................................................................................\", \"................................. 16\\nBuild output ..................................................\", \"....................................................................................................\", \"...................... 18\\nRun the app with Hot Reload...............................................\", \"............................................................................................ 18\\nApp \", \"startup.............................................................................................\", \"............................... 21\\nApplication_Start and Web Forms .................................\", \"................................................................................................ 21\\n\", \"Blazor Server Startup Structure.....................................................................\", \".................................................................. 21ii Contents\\nUpgrading the Bundl\", \"eConfig Process ....................................................................................\", \"...................................... 23\\nBuild reusable UI components with Blazor..................\", \"....................................................... 24\\nAn introduction to Razor ................\", \"....................................................................................................\", \"............................... 24\\nUse components ..................................................\", \"....................................................................................................\", \"............. 28\\nModify page title from components .................................................\", \"............................................................................ 28\\nComponent parameters\", \" ...................................................................................................\", \".................................................. 29\\nQuery string parameters ......................\", \"....................................................................................................\", \"..................... 29\\nComponents and error boundaries ...........................................\", \".................................................................................... 30\\nEvent handle\", \"rs..................................................................................................\", \"...................................................................... 30\\nData binding .............\", \"....................................................................................................\", \".......................................................... 32\\nState changes ........................\", \"....................................................................................................\", \"............................................. 33\\nComponent lifecycle................................\", \"....................................................................................................\", \"........................ 34\\nOnInitialized ..........................................................\", \"....................................................................................................\", \"......... 34\\nOnParametersSet .......................................................................\", \"...................................................................................... 35\\nOnAfterRen\", \"der.................................................................................................\", \"................................................................. 35\\nIDisposable ...................\", \"....................................................................................................\", \".................................................. 35\\nCapture component references .................\", \"....................................................................................................\", \"................. 36\\nCapture element references ....................................................\", \"......................................................................................... 36\\nTemplat\", \"ed components ......................................................................................\", \"............................................................... 36\\nChild content....................\", \"....................................................................................................\", \".............................................. 37\\nTemplate parameters...............................\", \"....................................................................................................\", \"................... 37\\nCode-behind..................................................................\", \"....................................................................................................\", \"..... 38\\nAdditional resources.......................................................................\", \"..................................................................................... 39\\nPages, rout\", \"ing, and layouts....................................................................................\", \".............. 40\\nCreate pages......................................................................\", \"....................................................................................................\", \". 41\\nRouter component...............................................................................\", \"................................................................................ 42\\nNavigation .....\", \"....................................................................................................\", \"...................................................................... 42\\nBase URLs.................\", \"....................................................................................................\", \"............................................................ 43\\nPage layout.........................\", \"....................................................................................................\", \"................................................. 43\\nState management...............................\", \"................................................................................. 46\\nRequest state m\", \"anagement with ViewState ...........................................................................\", \"................................... 46iii Contents\\nMaintain state with Session .....................\", \"....................................................................................................\", \"..................... 47\\nApplication state .........................................................\", \"....................................................................................................\", \"...... 47\\nIn the browser............................................................................\", \"............................................................................................ 48\\nForm\", \"s and validation ...................................................................................\", \"......................... 49\\nAdditional resources...................................................\", \"....................................................................................................\", \"..... 51\\nWork with data.............................................................................\", \"......................................... 52\\nEntity Framework ......................................\", \"....................................................................................................\", \"........................ 52\\nEF Code First...........................................................\", \"....................................................................................................\", \"........ 53\\nEF Database First ......................................................................\", \"........................................................................................ 54\\nInteract\", \" with web services .................................................................................\", \"................................................................ 54\\nModules, handlers, and middlewar\", \"e ................................................................................... 56\\nOverview...\", \"....................................................................................................\", \"............................................................................ 56\\nKatana..............\", \"....................................................................................................\", \"...................................................................... 57\\nCommon middleware.........\", \"....................................................................................................\", \"............................................. 57\\nCustom middleware..................................\", \"....................................................................................................\", \"....................... 58\\nApp configuration........................................................\", \"......................................................... 60\\nConfiguration sources..................\", \"....................................................................................................\", \"................................... 60\\nappsettings.json format and access ..........................\", \"....................................................................................................\", \" 61\\nUser secrets ...................................................................................\", \".......................................................................................... 61\\nEnviro\", \"nment variables.....................................................................................\", \".................................................................... 61\\nCommand-line arguments .....\", \"....................................................................................................\", \"....................................... 62\\nThe return of web.config ................................\", \"....................................................................................................\", \"............... 62\\nRead configuration in the app....................................................\", \"..................................................................................... 63\\nStrongly ty\", \"ped configuration...................................................................................\", \"........................................................ 63\\nSecurity: Authentication and Authorizati\", \"on in ASP.NET Web Forms and Blazor........... 65\\nASP.NET universal providers........................\", \"....................................................................................................\", \"................. 65\\nAuthorization configuration in Web Forms ......................................\", \"..................................................................... 66\\nAuthorization code in Web F\", \"orms ...............................................................................................\", \"............................. 67\\nASP.NET Core Identity..............................................\", \"....................................................................................................\", \"....... 68\\nRoles, claims, and policies .............................................................\", \"............................................................................... 68\\nMigration guide..\", \"....................................................................................................\", \".......................................................... 70iv Contents\\nCreating the ASP.NET Core I\", \"dentity schema......................................................................................\", \"................... 70\\nMigrating data from universal providers to ASP.NET Core Identity ............\", \"................................................ 73\\nMigrating security settings from web.config to a\", \"pp startup.......................................................................... 74\\nUpdating ind\", \"ividual pages to use ASP.NET Core Identity abstractions ............................................\", \"......... 75\\nSummary ...............................................................................\", \"................................................................................................... \", \"76\\nReferences ......................................................................................\", \"......................................................................................... 77\\nMigrate\", \" from ASP.NET Web Forms to Blazor...................................................................\", \".. 78\\nServer-side versus client-side hosting........................................................\", \".................................................................. 78\\nCreate a new project..........\", \"....................................................................................................\", \".............................................. 79\\nEnable startup process............................\", \"....................................................................................................\", \"........................ 80\\nMigrate HTTP modules and handlers to middleware ........................\", \".................................................................... 83\\nMigrate static files .......\", \"....................................................................................................\", \"..................................................... 84\\nMigrate runtime bundling and minification s\", \"etup ...............................................................................................\", \"... 84\\nMigrate ASPX pages ..........................................................................\", \".................................................................................. 84\\nModel validati\", \"on in Blazor........................................................................................\", \".................................................... 88\\nMigrate configuration.......................\", \"....................................................................................................\", \".............................. 89\\nMigrate data access ..............................................\", \"....................................................................................................\", \"........... 91\\nArchitectural changes................................................................\", \".......................................................................................... 91\\nMigrat\", \"ion conclusion......................................................................................\", \"..................................................................... 921 CHAPTER 1 | An introductio\", \"n to Blazor for ASP.NET Web Forms developers\\nCHAPTER 1\\nAn introduction to Blazor \\nfor ASP.NET Web Fo\", \"rms \\ndevelopers\\nThe ASP.NET Web Forms framework has been a staple of .NET web development since the \", \".NET \\nFramework first shipped in 2002. Back when the Web was still largely in its infancy, ASP.NET W\", \"eb \\nForms made building web apps simple and productive by adopting many of the patterns that were \\nu\", \"sed for desktop development. In ASP.NET Web Forms, web pages can be quickly composed from \\nreusable \", \"UI controls. User interactions are handled naturally as events. There\\u2019s a rich ecosystem of \\nWeb For\", \"ms UI controls provided by Microsoft and control vendors. The controls ease the efforts of \\nconnecti\", \"ng to data sources and displaying rich data visualizations. For the visually inclined, the Web \\nForm\", \"s designer provides a simple drag-and-drop interface for managing controls.\\nOver the years, Microsof\", \"t has introduced new ASP.NET-based web frameworks to address web \\ndevelopment trends. Some such web \", \"frameworks include ASP.NET MVC, ASP.NET Web Pages, and \\nmore recently ASP.NET Core. With each new fr\", \"amework, some have predicted the imminent decline of \\nASP.NET Web Forms and criticized it as an outd\", \"ated, outmoded web framework. Despite these \\npredictions, many .NET web developers continue to find \", \"ASP.NET Web Forms a simple, stable, and \\nproductive way to get their work done.\\nAt the time of writi\", \"ng, almost half a million web developers use ASP.NET Web Forms every month. The \\nASP.NET Web Forms f\", \"ramework is stable to the point that docs, samples, books, and blog posts from \\na decade ago remain \", \"useful and relevant. For many .NET web developers, \\u201cASP.NET\\u201d is still \\nsynonymous with \\u201cASP.NET Web \", \"Forms\\u201d as it was when .NET was first conceived. Arguments on the \\npros and cons of ASP.NET Web Forms\", \" compared to the other new .NET web frameworks may rage on. \\nASP.NET Web Forms remains a popular fra\", \"mework for creating web apps.\\nEven so, innovations in software development aren\\u2019t slowing. All softw\", \"are developers need to stay \\nabreast of new technologies and trends. Two trends in particular are wo\", \"rth considering:\\n1. The shift to open-source and cross-platform\\n2. The shift of app logic to the cli\", \"ent2 CHAPTER 1 | An introduction to Blazor for ASP.NET Web Forms developers\\nAn open-source and cross\", \"-platform .NET\\nWhen .NET and ASP.NET Web Forms first shipped, the platform ecosystem looked much dif\", \"ferent than \\nit does today. The desktop and server markets were dominated by Windows. Alternative pl\", \"atforms like \\nmacOS and Linux were still struggling to gain traction. ASP.NET Web Forms ships with t\", \"he .NET \\nFramework as a Windows-only component, which means ASP.NET Web Forms apps can only run on \\n\", \"Windows Server machines. Many modern environments now use different kinds of platforms for \\nservers \", \"and development machines such that cross-platform support for many users is an absolute \\nrequirement\", \".\\nMost modern web frameworks are now also open-source, which has a number of benefits. Users \\naren\\u2019t\", \" beheld to a single project owner to fix bugs and add features. Open-source projects provide \\nimprov\", \"ed transparency on development progress and upcoming changes. Open-source projects enjoy \\ncontributi\", \"ons from an entire community, and they foster a supportive open-source ecosystem. \\nDespite the risks\", \" of open-source, many consumers and contributors have found suitable mitigations \\nthat enable them t\", \"o enjoy the benefits of an open-source ecosystem in a safe and reasonable way. \\nExamples of such mit\", \"igations include contributor license agreements, friendly licenses, pedigree scans, \\nand supporting \", \"foundations.\\nThe .NET community has embraced both cross-platform support and open-source. .NET Core \", \"is an \\nopen-source and cross-platform implementation of .NET that runs on a plethora of platforms, \\n\", \"including Windows, macOS, and various Linux distributions. Xamarin provides Mono, an open-source \\nve\", \"rsion of .NET. Mono runs on Android, iOS, and a variety of other form factors, including watches \\nan\", \"d smart TVs. In 2020, Microsoft released .NET 5 that reconciled .NET Core and Mono into \\u201ca single \\n.\", \"NET runtime and framework that can be used everywhere and that has uniform runtime behaviors \\nand de\", \"veloper experiences.\\u201d\\nWill ASP.NET Web Forms benefit from the move to open-source and cross-platform\", \" support? The \\nanswer, unfortunately, is no, or at least not to the same extent as the rest of the p\", \"latform. The .NET \\nteam made it clear that ASP.NET Web Forms won\\u2019t be ported to .NET Core or .NET 8.\", \" Why is that?\\nThere were efforts in the early days of .NET Core to port ASP.NET Web Forms. The numbe\", \"r of breaking \\nchanges required were found to be too drastic. There\\u2019s also an admission here that ev\", \"en for Microsoft, \\nthere\\u2019s a limit to the number of web frameworks that it can support simultaneousl\", \"y. Perhaps someone \\nin the community will take up the cause of creating an open-source and cross-pla\", \"tform version of \\nASP.NET Web Forms. The source code for ASP.NET Web Forms has been made available p\", \"ublicly in \\nreference form. But for the time being, it seems ASP.NET Web Forms will remain Windows-o\", \"nly and \\nwithout an open-source contribution model. If cross-platform support or open-source become \", \"\\nimportant for your scenarios, then you\\u2019ll need to look for something new.\\nDoes this mean ASP.NET We\", \"b Forms is dead and should no longer be used? Of course not! As long as \\nthe .NET Framework ships as\", \" part of Windows, ASP.NET Web Forms will be a supported framework. \\nFor many Web Forms developers, t\", \"he lack of cross-platform and open-source support is a non-issue. \\nIf you don\\u2019t have a requirement f\", \"or cross-platform support, open-source, or any of the other new \\nfeatures in .NET Core or .NET 8, th\", \"en sticking with ASP.NET Web Forms on Windows is fine. ASP.NET \\nWeb Forms will continue to be a prod\", \"uctive way to write web apps for many years to come.\\nBut there\\u2019s another trend worth considering, an\", \"d that\\u2019s the shift to the client.3 CHAPTER 1 | An introduction to Blazor for ASP.NET Web Forms devel\", \"opers\\nClient-side web development\\nAll of the .NET-based web frameworks, including ASP.NET Web Forms,\", \" have historically had one thing \\nin common: they\\u2019re server-rendered. In server-rendered web apps, t\", \"he browser makes a request to the \\nserver, which executes some code (.NET code in ASP.NET apps) to p\", \"roduce a response. That response \\nis sent back to the browser to handle. In this model, the browser \", \"is used as a thin rendering engine. \\nThe hard work of producing the UI, running the business logic, \", \"and managing state occurs on the \\nserver.\\nHowever, browsers have become versatile platforms. They im\", \"plement an ever-increasing number of \\nopen web standards that grant access to the capabilities of th\", \"e user\\u2019s machine. Why not take \\nadvantage of the compute power, storage, memory, and other resources\", \" of the client device? UI \\ninteractions in particular can benefit from a richer and more interactive\", \" feel when handled at least \\npartially or completely client-side. Logic and data that should be hand\", \"led on the server can still be \\nhandled server-side. Web API calls or even real-time protocols, like\", \" WebSockets, can be used. These \\nbenefits are available to web developers for free if they\\u2019re willin\", \"g to write JavaScript. Client-side UI \\nframeworks, such as Angular, React, and Vue, simplify client-\", \"side web development and have grown in \\npopularity. ASP.NET Web Forms developers can also benefit fr\", \"om leveraging the client, and even have \\nsome out-of-the-box support with integrated JavaScript fram\", \"eworks like ASP.NET AJAX.\\nBut bridging two different platforms and ecosystems (.NET and JavaScript) \", \"comes with a cost. \\nExpertise is required in two parallel worlds with different languages, framework\", \"s, and tools. Code and \\nlogic can\\u2019t be easily shared between client and server, resulting in duplica\", \"tion and engineering \\noverhead. It can also be difficult to keep up with the JavaScript ecosystem, w\", \"hich has a history of \\nevolving at breakneck speed. Front-end framework and build tool preferences c\", \"hange quickly. The \\nindustry has observed the progression from Grunt to Gulp to Webpack, and so on. \", \"The same restless \\nchurn has occurred with front-end frameworks such as jQuery, Knockout, Angular, R\", \"eact, and Vue. But \\ngiven JavaScript\\u2019s browser monopoly, there was little choice in the matter. That\", \" is, until the web \\ncommunity got together and caused a miracle to happen!\\nWebAssembly fulfills a ne\", \"ed\\nIn 2015, the major browser vendors joined forces in a W3C Community Group to create a new open \\nw\", \"eb standard called WebAssembly. WebAssembly is a byte code for the Web. If you can compile your \\ncod\", \"e to WebAssembly, it can then run on any browser on any platform at near native speed. Initial \\neffo\", \"rts focused on C/C++. The result was a dramatic demonstration of running native 3D graphics \\nengines\", \" directly in the browser without plugins. WebAssembly has since been standardized and \\nimplemented b\", \"y all major browsers.\\nWork on running .NET on WebAssembly was announced in late 2017 and released in\", \" 2020, including \\nsupport in .NET 5 and beyond. The ability to run .NET code directly in the browser\", \" enables full-stack \\nweb development with .NET.4 CHAPTER 1 | An introduction to Blazor for ASP.NET W\", \"eb Forms developers\\nBlazor: full-stack web development with .NET\\nOn its own, the ability to run .NET\", \" code in a browser doesn\\u2019t provide an end-to-end experience for \\ncreating client-side web apps. That\", \"\\u2019s where Blazor comes in. Blazor is a client-side web UI framework \\nbased on C# instead of JavaScrip\", \"t. Blazor can run directly in the browser via WebAssembly. No \\nbrowser plugins are required. Alterna\", \"tively, Blazor apps can run server-side on .NET and handle all \\nuser interactions over a real-time c\", \"onnection with the browser.\\nBlazor has great tooling support in Visual Studio and Visual Studio Code\", \". The framework also includes \\na full UI component model and has built-in facilities for:\\n\\u2022 Forms an\", \"d validation\\n\\u2022 Dependency injection\\n\\u2022 Client-side routing\\n\\u2022 Layouts\\n\\u2022 In-browser debugging\\n\\u2022 JavaScr\", \"ipt interop\\nBlazor has a lot in common with ASP.NET Web Forms. Both frameworks offer component-based\", \", \\nevent-driven, stateful UI programming models. The main architectural difference is that ASP.NET W\", \"eb \\nForms runs only on the server. Blazor can run on the client in the browser. But if you\\u2019re coming\", \" from \\nan ASP.NET Web Forms background, there\\u2019s a lot in Blazor that will feel familiar. Blazor is a\", \" natural \\nsolution for ASP.NET Web Forms developers looking for a way to take advantage of client-si\", \"de \\ndevelopment and the open-source, cross-platform future of .NET.\\nThis book provides an introducti\", \"on to Blazor that is catered specifically to ASP.NET Web Forms \\ndevelopers. Each Blazor concept is p\", \"resented in the context of analogous ASP.NET Web Forms \\nfeatures and practices. By the end of this b\", \"ook, you\\u2019ll have an understanding of:\\n\\u2022 How to build Blazor apps.\\n\\u2022 How Blazor works.\\n\\u2022 How Blazor r\", \"elates to .NET.\\n\\u2022 Reasonable strategies for migrating existing ASP.NET Web Forms apps to Blazor wher\", \"e \\nappropriate.\\nGet started with Blazor\\nGetting started with Blazor is easy. Go to https://blazor.ne\", \"t and follow the links to install the \\nappropriate .NET SDK and Blazor project templates. You\\u2019ll als\", \"o find instructions for setting up the \\nBlazor tooling in Visual Studio or Visual Studio Code.5 CHAP\", \"TER 2 | Architecture comparison of ASP.NET Web Forms and Blazor\\nCHAPTER 2\\nArchitecture comparison \\no\", \"f ASP.NET Web Forms \\nand Blazor\\nWhile ASP.NET Web Forms and Blazor have many similar concepts, there\", \" are differences in how they \\nwork. This chapter examines the inner workings and architectures of AS\", \"P.NET Web Forms and Blazor.\\nASP.NET Web Forms\\nThe ASP.NET Web Forms framework is based on a page-cen\", \"tric architecture. Each HTTP request for a \\nlocation in the app is a separate page with which ASP.NE\", \"T responds. As pages are requested, the \\ncontents of the browser are replaced with the results of th\", \"e page requested.\\nPages consist of the following components:\\n\\u2022 HTML markup\\n\\u2022 C# or Visual Basic code\", \"\\n\\u2022 A code-behind class containing logic and event-handling capabilities\\n\\u2022 Controls\\nControls are reus\", \"able units of web UI that can be programmatically placed and interacted with on a \\npage. Pages are c\", \"omposed of files that end with .aspx containing markup, controls, and some code. \\nThe code-behind cl\", \"asses are in files with the same base name and an .aspx.cs or .aspx.vb extension, \\ndepending on the \", \"programming language used. Interestingly, the web server interprets contents of \\nthe .aspx files and\", \" compiles them whenever they change. This recompilation occurs even if the web \\nserver is already ru\", \"nning.\\nControls can be built with markup and delivered as user controls. A user control derives from\", \" the \\nUserControl class and has a similar structure to the Page. Markup for user controls is stored \", \"in an .ascx\\nfile. An accompanying code-behind class resides in an .ascx.cs or .ascx.vb file. Control\", \"s can also be \\nbuilt completely with code, by inheriting from either the WebControl or CompositeCont\", \"rol base class.\\nPages also have an extensive event lifecycle. Each page raises events for the initia\", \"lization, load, \\nprerender, and unload events that occur as the ASP.NET runtime executes the page\\u2019s \", \"code for each \\nrequest.6 CHAPTER 2 | Architecture comparison of ASP.NET Web Forms and Blazor\\nControl\", \"s on a Page typically post-back to the same page that presented the control, and carry along \\nwith t\", \"hem a payload from a hidden form field called ViewState. The ViewState field contains \\ninformation a\", \"bout the state of the controls at the time they were rendered and presented on the \\npage, allowing t\", \"he ASP.NET runtime to compare and identify changes in the content submitted to the \\nserver.\\nBlazor\\nB\", \"lazor is a client-side web UI framework similar in nature to JavaScript front-end frameworks like \\nA\", \"ngular or React. Blazor handles user interactions and renders the necessary UI updates. Blazor isn\\u2019t\", \"\\nbased on a request-reply model. User interactions are handled as events that aren\\u2019t in the context \", \"of \\nany particular HTTP request.\\nBlazor apps consist of one or more root components that are rendere\", \"d on an HTML page.\\nHow the user specifies where components should render and how the components are \", \"then wired up \\nfor user interactions is hosting model specific.\\nBlazor components are .NET classes t\", \"hat represent a reusable piece of UI. Each component maintains \\nits own state and specifies its own \", \"rendering logic, which can include rendering other components. \\nComponents specify event handlers fo\", \"r specific user interactions to update the component\\u2019s state.\\nAfter a component handles an event, Bl\", \"azor renders the component and keeps track of what changed \\nin the rendered output. Components don\\u2019t\", \" render directly to the Document Object Model (DOM). \\nThey instead render to an in-memory representa\", \"tion of the DOM called a RenderTree so that Blazor \\ncan track the changes. Blazor compares the newly\", \" rendered output with the previous output to \\ncalculate a UI diff that it then applies efficiently t\", \"o the DOM.7 CHAPTER 2 | Architecture comparison of ASP.NET Web Forms and Blazor\\nComponents can also \", \"manually indicate that they should be rendered if their state changes outside of \\na normal UI event.\", \" Blazor uses a SynchronizationContext to enforce a single logical thread of \\nexecution. A component\\u2019\", \"s lifecycle methods and any event callbacks that are raised by Blazor are \\nexecuted on this Synchron\", \"izationContext.8 CHAPTER 3 | Blazor app hosting models\\nCHAPTER 3\\nBlazor app hosting models\\nBlazor ap\", \"ps can be hosted in one of the following ways:\\n\\u2022 Client-side in the browser on WebAssembly.\\n\\u2022 Server\", \"-side in an ASP.NET Core app.\\nBlazor WebAssembly apps\\nBlazor WebAssembly apps execute directly in th\", \"e browser on a WebAssembly-based .NET runtime. \\nBlazor WebAssembly apps function in a similar way to\", \" front-end JavaScript frameworks like Angular or \\nReact. However, instead of writing JavaScript you \", \"write C#. The .NET runtime is downloaded with the \\napp along with the app assembly and any required \", \"dependencies. No browser plugins or extensions \\nare required.\\nThe downloaded assemblies are normal .\", \"NET assemblies, like you would use in any other .NET app. \\nBecause the runtime supports .NET Standar\", \"d, you can use existing .NET Standard libraries with your \\nBlazor WebAssembly app. However, these as\", \"semblies will still execute in the browser security \\nsandbox. Some functionality may throw a Platfor\", \"mNotSupportedException, like trying to access the \\nfile system or opening arbitrary network connecti\", \"ons.\\nWhen the app loads, the .NET runtime is started and pointed at the app assembly. The app startu\", \"p \\nlogic runs, and the root components are rendered. Blazor calculates the UI updates based on the \\n\", \"rendered output from the components. The DOM updates are then applied.9 CHAPTER 3 | Blazor app hosti\", \"ng models\\nBlazor WebAssembly apps run purely client-side. Such apps can be deployed to static site h\", \"osting \\nsolutions like GitHub Pages or Azure Static Website Hosting. .NET isn\\u2019t required on the serv\", \"er at all. \\nDeep linking to parts of the app typically requires a routing solution on the server. Th\", \"e routing \\nsolution redirects requests to the root of the app. For example, this redirection can be \", \"handled using \\nURL rewrite rules in IIS.\\nTo get all the benefits of Blazor and full-stack .NET web d\", \"evelopment, host your Blazor WebAssembly \\napp with ASP.NET Core. By using .NET on both the client an\", \"d server, you can easily share code and \\nbuild your app using one consistent set of languages, frame\", \"works, and tools. Blazor provides \\nconvenient templates for setting up a solution that contains both\", \" a Blazor WebAssembly app and an \\nASP.NET Core host project. When the solution is built, the built s\", \"tatic files from the Blazor app are \\nhosted by the ASP.NET Core app with fallback routing already se\", \"tup.\\nBlazor Server apps\\nRecall from the Blazor architecture discussion that Blazor components render\", \" their output to an \\nintermediate abstraction called a RenderTree. The Blazor framework then compare\", \"s what was \\nrendered with what was previously rendered. The differences are applied to the DOM. Blaz\", \"or \\ncomponents are decoupled from how their rendered output is applied. Consequently, the \\ncomponent\", \"s themselves don\\u2019t have to run in the same process as the process updating the UI. In fact, \\nthey do\", \"n\\u2019t even have to run on the same machine.\\nIn Blazor Server apps, the components run on the server in\", \"stead of client-side in the browser. UI \\nevents that occur in the browser are sent to the server ove\", \"r a real-time connection. The events are \\ndispatched to the correct component instances. The compone\", \"nts render, and the calculated UI diff is \\nserialized and sent to the browser where it\\u2019s applied to \", \"the DOM.10 CHAPTER 3 | Blazor app hosting models\\nThe Blazor Server hosting model may sound familiar \", \"if you\\u2019ve used ASP.NET AJAX and the \\nUpdatePanel control. The UpdatePanel control handles applying p\", \"artial page updates in response to \\ntrigger events on the page. When triggered, the UpdatePanel requ\", \"ests a partial update and then \\napplies it without needing to refresh the page. The state of the UI \", \"is managed using ViewState. Blazor \\nServer apps are slightly different in that the app requires an a\", \"ctive connection with the client. \\nAdditionally, all UI state is maintained on the server. Aside fro\", \"m those differences, the two models are \\nconceptually similar.\\nHow to choose the right Blazor hostin\", \"g model\\nAs described in the Blazor hosting model docs, the different Blazor hosting models have diff\", \"erent \\ntradeoffs.\\nThe Blazor WebAssembly hosting model has the following benefits:\\n\\u2022 There\\u2019s no .NET\", \" server-side dependency. The app is fully functioning after downloaded to the \\nclient.\\n\\u2022 Client reso\", \"urces and capabilities are fully leveraged.\\n\\u2022 Work is offloaded from the server to the client.\\n\\u2022 An \", \"ASP.NET Core web server isn\\u2019t required to host the app. Serverless deployment scenarios \\nare possibl\", \"e (for example, serving the app from a CDN).\\nThe downsides of the Blazor WebAssembly hosting model a\", \"re:\\n\\u2022 Browser capabilities restrict the app.\\n\\u2022 Capable client hardware and software (for example, We\", \"bAssembly support) is required.\\n\\u2022 Download size is larger, and apps take longer to load.11 CHAPTER 3\", \" | Blazor app hosting models\\n\\u2022 .NET runtime and tooling support is less mature. For example, there a\", \"re limitations in .NET \\nStandard support and debugging.\\nConversely, the Blazor Server hosting model \", \"offers the following benefits:\\n\\u2022 Download size is much smaller than a client-side app, and the app l\", \"oads much faster.\\n\\u2022 The app takes full advantage of server capabilities, including use of any .NET c\", \"ompatible APIs.\\n\\u2022 .NET on the server is used to run the app, so existing .NET tooling, such as debug\", \"ging, works \\nas expected.\\n\\u2022 Thin clients are supported. For example, server-side apps work with brow\", \"sers that don\\u2019t \\nsupport WebAssembly and on resource-constrained devices.\\n\\u2022 The app\\u2019s .NET/C# code b\", \"ase, including the app\\u2019s component code, isn\\u2019t served to clients.\\nThe downsides to the Blazor Server\", \" hosting model are:\\n\\u2022 Higher UI latency. Every user interaction involves a network hop.\\n\\u2022 There\\u2019s no\", \" offline support. If the client connection fails, the app stops working.\\n\\u2022 Scalability is challengin\", \"g for apps with many users. The server must manage multiple client \\nconnections and handle client st\", \"ate.\\n\\u2022 An ASP.NET Core server is required to serve the app. Serverless deployment scenarios aren\\u2019t \\n\", \"possible. For example, you can\\u2019t serve the app from a CDN.\\nThe preceding list of trade-offs may be i\", \"ntimidating, but your hosting model can be changed later. \\nRegardless of the Blazor hosting model se\", \"lected, the component model is the same. In principle, the \\nsame components can be used with either \", \"hosting model. Your app code doesn\\u2019t change; however, \\nit\\u2019s a good practice to introduce abstraction\", \"s so that your components stay hosting model-agnostic. \\nThe abstractions allow your app to more easi\", \"ly adopt a different hosting model.\\nDeploy your app\\nASP.NET Web Forms apps are typically hosted on I\", \"IS on a Windows Server machine or cluster. Blazor \\napps can also:\\n\\u2022 Be hosted on IIS, either as stat\", \"ic files or as an ASP.NET Core app.\\n\\u2022 Leverage ASP.NET Core\\u2019s flexibility to be hosted on various pl\", \"atforms and server \\ninfrastructures. For example, you can host a Blazor App using Nginx or Apache on\", \" Linux. For \\nmore information about how to publish and deploy Blazor apps, see the Blazor Hosting an\", \"d \\ndeployment documentation.\\nIn the next section, we\\u2019ll look at how the projects for Blazor WebAssem\", \"bly and Blazor Server apps are \\nset up.12 CHAPTER 4 | Project structure for Blazor apps\\nCHAPTER 4\\nPr\", \"oject structure for Blazor \\napps\\nDespite their significant project structure differences, ASP.NET We\", \"b Forms and Blazor share many \\nsimilar concepts. Here, we\\u2019ll look at the structure of a Blazor proje\", \"ct and compare it to an ASP.NET \\nWeb Forms project.\\nTo create your first Blazor app, follow the inst\", \"ructions in the Blazor getting started steps. You can \\nfollow the instructions to create either a Bl\", \"azor Server app or a Blazor WebAssembly app hosted in \\nASP.NET Core. Except for the hosting model-sp\", \"ecific logic, most of the code in both projects is the \\nsame.\\nProject file\\nBlazor Server apps are .N\", \"ET projects. The project file for the Blazor Server app is about as simple as it \\ncan get:\\n<Project \", \"Sdk=\\\"Microsoft.NET.Sdk.Web\\\">\\n <PropertyGroup>\\n <TargetFramework>net8.0</TargetFramework>\\n </Property\", \"Group>\\n</Project>\\nThe project file for a Blazor WebAssembly app looks slightly more involved (exact \", \"version \\nnumbers may vary):\\n<Project Sdk=\\\"Microsoft.NET.Sdk.BlazorWebAssembly\\\">\\n <PropertyGroup>\\n <T\", \"argetFramework>net8.0</TargetFramework>\\n <ImplicitUsings>enable</ImplicitUsings>\\n </PropertyGroup>\\n \", \"<ItemGroup>\\n <PackageReference Include=\\\"Microsoft.AspNetCore.Components.WebAssembly\\\" Version=\\\"8.0.0\\\"\", \"\\n/>\\n <PackageReference Include=\\\"Microsoft.AspNetCore.Components.WebAssembly.DevServer\\\"\\nVersion=\\\"8.0.\", \"0\\\" PrivateAssets=\\\"all\\\" />\\n </ItemGroup>\\n</Project>13 CHAPTER 4 | Project structure for Blazor apps\\nB\", \"lazor WebAssembly project targets Microsoft.NET.Sdk.BlazorWebAssembly instead of \\nMicrosoft.NET.Sdk.\", \"Web sdk because they run in the browser on a WebAssembly-based .NET runtime. \\nYou can\\u2019t install .NET\", \" into a web browser like you can on a server or developer machine. \\nConsequently, the project refere\", \"nces the Blazor framework using individual package references.\\nBy comparison, a default ASP.NET Web \", \"Forms project includes almost 300 lines of XML in its .csproj\\nfile, most of which is explicitly list\", \"ing the various code and content files in the project. Since the \\nrelease of .NET 5, both Blazor Ser\", \"ver and Blazor WebAssembly apps can easily share one unified \\nruntime.\\nAlthough they\\u2019re supported, i\", \"ndividual assembly references are less common in .NET projects. Most \\nproject dependencies are handl\", \"ed as NuGet package references. You only need to reference top-level \\npackage dependencies in .NET p\", \"rojects. Transitive dependencies are included automatically. Instead of \\nusing the packages.config f\", \"ile commonly found in ASP.NET Web Forms projects to reference packages, \\npackage references are adde\", \"d to the project file using the <PackageReference> element.\\n<ItemGroup>\\n <PackageReference Include=\\\"\", \"Newtonsoft.Json\\\" Version=\\\"13.0.2\\\" />\\n</ItemGroup>\\nEntry point\\nThe Blazor Server app\\u2019s entry point is\", \" defined in the Program.cs file, as you would see in a Console \\napp. When the app executes, it creat\", \"es and runs a web host instance using defaults specific to web \\napps. The web host manages the Blazo\", \"r Server app\\u2019s lifecycle and sets up host-level services. \\nExamples of such services are configurati\", \"on, logging, dependency injection, and the HTTP server. This \\ncode is mostly boilerplate and is ofte\", \"n left unchanged.\\nusing BlazorApp3.Areas.Identity;\\nusing BlazorApp3.Data;\\nusing Microsoft.AspNetCore\", \".Components.Authorization;\\nusing Microsoft.AspNetCore.Identity;\\nusing Microsoft.EntityFrameworkCore;\", \"\\nvar builder = WebApplication.CreateBuilder(args);\\n// Add services to the container.\\nvar connectionS\", \"tring = builder.Configuration.GetConnectionString(\\\"DefaultConnection\\\");\\nbuilder.Services.AddDbContex\", \"t<ApplicationDbContext>(options =>\\n options.UseSqlServer(connectionString));\\nbuilder.Services.AddDat\", \"abaseDeveloperPageExceptionFilter();\\nbuilder.Services.AddDefaultIdentity<IdentityUser>(options =>\\nop\", \"tions.SignIn.RequireConfirmedAccount = true)\\n .AddEntityFrameworkStores<ApplicationDbContext>();\\nbui\", \"lder.Services.AddRazorPages();\\nbuilder.Services.AddServerSideBlazor();\\nbuilder.Services.AddScoped<Au\", \"thenticationStateProvider,\\nRevalidatingIdentityAuthenticationStateProvider<IdentityUser>>();\\nbuilder\", \".Services.AddSingleton<WeatherForecastService>();\\nvar app = builder.Build();\\n// Configure the HTTP r\", \"equest pipeline.14 CHAPTER 4 | Project structure for Blazor apps\\nif (app.Environment.IsDevelopment()\", \")\\n{\\n app.UseMigrationsEndPoint();\\n}\\nelse\\n{\\n app.UseExceptionHandler(\\\"/Error\\\");\\n // The default HSTS \", \"value is 30 days. You may want to change this for production \\nscenarios, see https://aka.ms/aspnetco\", \"re-hsts.\\n app.UseHsts();\\n}\\napp.UseHttpsRedirection();\\napp.UseStaticFiles();\\napp.UseRouting();\\napp.Us\", \"eAuthorization();\\napp.MapControllers();\\napp.MapBlazorHub();\\napp.MapFallbackToPage(\\\"/_Host\\\");\\napp.Run\", \"();\\nBlazor WebAssembly apps also define an entry point in Program.cs. The code looks slightly differ\", \"ent. \\nThe code is similar in that it\\u2019s setting up the app host to provide the same host-level servic\", \"es to the \\napp. The WebAssembly app host doesn\\u2019t, however, set up an HTTP server because it executes\", \" directly \\nin the browser.\\nBlazor apps don\\u2019t use a Global.asax file to define the startup logic for \", \"the app. Instead, this logic is \\ncontained in Program.cs or in a related Startup class that is refer\", \"enced from Program.cs. Either way, \\nthis code is used to configure the app and any app-specific serv\", \"ices.\\nIn a Blazor Server app, the Program.cs file shown is used to set up the endpoint for the real-\", \"time \\nconnection used by Blazor between the client browsers and the server.\\nIn a Blazor WebAssembly \", \"app, the Program.cs file defines the root components for the app and where \\nthey should be rendered:\", \"\\nusing BlazorApp1;\\nusing Microsoft.AspNetCore.Components.Web;\\nusing Microsoft.AspNetCore.Components.\", \"WebAssembly.Hosting;\\nvar builder = WebAssemblyHostBuilder.CreateDefault(args);\\nbuilder.RootComponent\", \"s.Add<App>(\\\"#app\\\");\\nbuilder.RootComponents.Add<HeadOutlet>(\\\"head::after\\\");\\nbuilder.Services.AddScope\", \"d(sp => new HttpClient { BaseAddress = new\\nUri(builder.HostEnvironment.BaseAddress) });\\nawait builde\", \"r.Build().RunAsync();15 CHAPTER 4 | Project structure for Blazor apps\\nStatic files\\nUnlike ASP.NET We\", \"b Forms projects, not all files in a Blazor project can be requested as static files. \\nOnly the file\", \"s in the wwwroot folder are web-addressable. This folder is referred to as the app\\u2019s \\u201cweb \\nroot\\u201d. An\", \"ything outside of the app\\u2019s web root isn\\u2019t web-addressable. This setup provides an additional \\nlevel\", \" of security that prevents accidental exposure of project files over the web.\\nConfiguration\\nConfigur\", \"ation in ASP.NET Web Forms apps is typically handled using one or more web.config files. \\nBlazor app\", \"s don\\u2019t typically have web.config files. If they do, the file is only used to configure IIS\\u0002specific\", \" settings when hosted on IIS. Instead, Blazor Server apps use the ASP.NET Core configuration \\nabstra\", \"ctions. (Blazor WebAssembly apps don\\u2019t currently support the same configuration abstractions, \\nbut t\", \"hat may be a feature added in the future.) For example, the default Blazor Server app stores some \\ns\", \"ettings in appsettings.json.\\n{\\n \\\"Logging\\\": {\\n \\\"LogLevel\\\": {\\n \\\"Default\\\": \\\"Information\\\",\\n \\\"Microsoft\\\":\", \" \\\"Warning\\\",\\n \\\"Microsoft.Hosting.Lifetime\\\": \\\"Information\\\"\\n }\\n },\\n \\\"AllowedHosts\\\": \\\"*\\\"\\n}\\nYou\\u2019ll learn \", \"more about configuration in ASP.NET Core projects in the Configuration section.\\nRazor components\\nMos\", \"t files in Blazor projects are .razor files. Razor is a templating language based on HTML and C# \\nth\", \"at is used to dynamically generate web UI. The .razor files define components that make up the UI \\no\", \"f the app. For the most part, the components are identical for both the Blazor Server and Blazor \\nWe\", \"bAssembly apps. Components in Blazor are analogous to user controls in ASP.NET Web Forms.\\nEach Razor\", \" component file is compiled into a .NET class when the project is built. The generated class \\ncaptur\", \"es the component\\u2019s state, rendering logic, lifecycle methods, event handlers, and other logic. \\nYou\\u2019\", \"ll learn more about authoring components in the Building reusable UI components with Blazor\\nsection.\", \"\\nThe *_Imports.razor* files aren\\u2019t Razor component files. Instead, they define a set of Razor direct\", \"ives to \\nimport into other .razor files within the same folder and in its subfolders. For example, a\", \" \\n*_Imports.razor* file is a conventional way to add using directives for commonly used namespaces:\\n\", \"@using System.Net.Http\\n@using System.Net.Http.Json\\n@using Microsoft.AspNetCore.Components.Forms\\n@usi\", \"ng Microsoft.AspNetCore.Components.Routing16 CHAPTER 4 | Project structure for Blazor apps\\n@using Mi\", \"crosoft.AspNetCore.Components.Web\\n@using Microsoft.AspNetCore.Components.Web.Virtualization\\n@using M\", \"icrosoft.AspNetCore.Components.WebAssembly.Http\\n@using Microsoft.JSInterop\\n@using BlazorApp1\\n@using \", \"BlazorApp1.Shared\\nPages\\nWhere are the pages in the Blazor apps? Blazor doesn\\u2019t define a separate fil\", \"e extension for \\naddressable pages, like the .aspx files in ASP.NET Web Forms apps. Instead, pages a\", \"re defined by \\nassigning routes to components. A route is typically assigned using the @page Razor d\", \"irective. For \\nexample, the Counter component authored in the Pages/Counter.razor file defines the f\", \"ollowing route:\\n@page \\\"/counter\\\"\\nRouting in Blazor is handled client-side, not on the server. As the\", \" user navigates in the browser, Blazor \\nintercepts the navigation and then renders the component wit\", \"h the matching route.\\nThe component routes aren\\u2019t currently inferred by the component\\u2019s file locatio\", \"n like they are with \\n.aspx pages or ASP.NET Core Razor Pages. This feature may be added in the futu\", \"re. Each route must \\nbe specified explicitly on the component. Storing routable components in a Page\", \"s folder has no \\nspecial meaning and is purely a convention.\\nYou\\u2019ll learn more about routing in Blaz\", \"or in the Pages, routing, and layouts section.\\nLayout\\nIn ASP.NET Web Forms apps, a common page layou\", \"t is handled using master pages (Site.Master). In \\nBlazor apps, the page layout is handled using lay\", \"out components (Shared/MainLayout.razor). Layout \\ncomponents are discussed in more detail in the Pag\", \"e, routing, and layouts section.\\nBootstrap Blazor\\nTo bootstrap Blazor, the app must:\\n\\u2022 Specify where\", \" on the page the root component (App.Razor) should be rendered.\\n\\u2022 Add the corresponding Blazor frame\", \"work script.\\nIn the Blazor Server app, the root component\\u2019s host page is defined in the *_Host.cshtm\", \"l* file. This file \\ndefines a Razor Page, not a component. Razor Pages use Razor syntax to define a \", \"server-addressable \\npage, very much like an .aspx page.\\n@page \\\"/\\\"\\n@namespace BlazorApp3.Pages\\n@addTa\", \"gHelper *, Microsoft.AspNetCore.Mvc.TagHelpers\\n@{\\n Layout = \\\"_Layout\\\";\\n}17 CHAPTER 4 | Project struc\", \"ture for Blazor apps\\n<component type=\\\"typeof(App)\\\" render-mode=\\\"ServerPrerendered\\\" />\\nThe render-mod\", \"e attribute is used to define where a root-level component should be rendered. The \\nRenderMode optio\", \"n indicates the manner in which the component should be rendered. The following \\ntable outlines the \", \"supported RenderMode options.\\nOption Description\\nRenderMode.Server Rendered interactively once a \\nco\", \"nnection with the browser is \\nestablished\\nRenderMode.ServerPrerendered First prerendered and then re\", \"ndered \\ninteractively\\nRenderMode.Static Rendered as static content\\nThe *_Layout.cshtml* file include\", \"s the default HTML for the app and its components.\\n@using Microsoft.AspNetCore.Components.Web\\n@names\", \"pace BlazorApp3.Pages\\n@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers\\n<!DOCTYPE html>\\n<html lan\", \"g=\\\"en\\\">\\n<head>\\n <meta charset=\\\"utf-8\\\" />\\n <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial\", \"-scale=1.0\\\" />\\n <base href=\\\"~/\\\" />\\n <link rel=\\\"stylesheet\\\" href=\\\"css/bootstrap/bootstrap.min.css\\\" />\", \"\\n <link href=\\\"css/site.css\\\" rel=\\\"stylesheet\\\" />\\n <link href=\\\"BlazorApp3.styles.css\\\" rel=\\\"stylesheet\\\"\", \" />\\n <component type=\\\"typeof(HeadOutlet)\\\" render-mode=\\\"ServerPrerendered\\\" />\\n</head>\\n<body>\\n @Render\", \"Body()\\n <div id=\\\"blazor-error-ui\\\">\\n <environment include=\\\"Staging,Production\\\">\\n An error has occurre\", \"d. This application may no longer respond until reloaded.\\n </environment>\\n <environment include=\\\"Dev\", \"elopment\\\">\\n An unhandled exception has occurred. See browser dev tools for details.\\n </environment>\\n\", \" <a href=\\\"\\\" class=\\\"reload\\\">Reload</a>\\n <a class=\\\"dismiss\\\">\\ud83d\\uddd9</a>\\n </div>\\n <script src=\\\"_framework/bla\", \"zor.server.js\\\"></script>\\n</body>\\n</html>\\nThe script reference to *_framework/blazor.server.js* estab\", \"lishes the real-time connection with the \\nserver and then deals with all user interactions and UI up\", \"dates.18 CHAPTER 4 | Project structure for Blazor apps\\nIn the Blazor WebAssembly app, the host page \", \"is a simple static HTML file under wwwroot/index.html. \\nThe <div> element with id named app is used \", \"to indicate where the root component should be \\nrendered.\\n<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n<head>\\n <\", \"meta charset=\\\"utf-8\\\" />\\n <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maxim\", \"um\\u0002scale=1.0, user-scalable=no\\\" />\\n <title>BlazorApp1</title>\\n <base href=\\\"/\\\" />\\n <link href=\\\"css/bo\", \"otstrap/bootstrap.min.css\\\" rel=\\\"stylesheet\\\" />\\n <link href=\\\"css/app.css\\\" rel=\\\"stylesheet\\\" />\\n <link \", \"href=\\\"BlazorApp1.styles.css\\\" rel=\\\"stylesheet\\\" />\\n</head>\\n<body>\\n <div id=\\\"app\\\">Loading...</div>\\n <di\", \"v id=\\\"blazor-error-ui\\\">\\n An unhandled error has occurred.\\n <a href=\\\"\\\" class=\\\"reload\\\">Reload</a>\\n <a \", \"class=\\\"dismiss\\\">\\ud83d\\uddd9</a>\\n </div>\\n <script src=\\\"_framework/blazor.webassembly.js\\\"></script>\\n</body>\\n</ht\", \"ml>\\nThe root component to render is specified in the app\\u2019s Program.cs file with the flexibility to r\", \"egister \\nservices through dependency injection. For more information, see ASP.NET Core Blazor depend\", \"ency \\ninjection.\\nvar builder = WebAssemblyHostBuilder.CreateDefault(args);\\nbuilder.RootComponents.Ad\", \"d<App>(\\\"#app\\\");\\nbuilder.RootComponents.Add<HeadOutlet>(\\\"head::after\\\");\\nBuild output\\nWhen a Blazor pr\", \"oject is built, all Razor component and code files are compiled into a single \\nassembly. Unlike ASP.\", \"NET Web Forms projects, Blazor doesn\\u2019t support runtime compilation of the UI \\nlogic.\\nRun the app wit\", \"h Hot Reload\\nTo run the Blazor Server app, press F5 in Visual Studio to run with the debugger attach\", \"ed, or Ctrl + F5 \\nto run without the debugger attached.\\nTo run the Blazor WebAssembly app, choose on\", \"e of the following approaches:\\n\\u2022 Run the client project directly using the development server.19 CHA\", \"PTER 4 | Project structure for Blazor apps\\n\\u2022 Run the server project when hosting the app with ASP.NE\", \"T Core.\\nBlazor WebAssembly apps can be debugged in both browser and Visual Studio. See Debug ASP.NET\", \" \\nCore Blazor WebAssembly for details.\\nBoth Blazor Server and Blazor WebAssembly apps support Hot Re\", \"load in Visual Studio. Hot Reload is \\na feature that automatically updates changes made to a Blazor \", \"app live, in the browser. You can \\ntoggle whether Hot Reload is enabled from its icon in the toolbar\", \":\\nSelecting the caret beside the icon reveals additional options. You can toggle Hot Reload on or of\", \"f, \\nrestart the application, and toggle whether Hot Reload should occur whenever a file is saved.\\nYo\", \"u can also access additional configuration options. The configuration dialog lets you specify \\nwheth\", \"er Hot Reload should be enabled when debugging (along with Edit and Continue), when \\nstarting withou\", \"t debugging, or when a file is saved.20 CHAPTER 4 | Project structure for Blazor apps\\nThe \\u201cdeveloper\", \" inner loop\\u201d has been greatly streamlined with Hot Reload. Without Hot Reload, a \\nBlazor developer w\", \"ould typically need to restart and rerun the app after every change, navigating to \\nthe appropriate \", \"part of the app as required. With Hot Reload, changes can be made to the running \\napp without the ne\", \"ed to restart in most cases. Hot Reload even retains the state of pages, so there\\u2019s \\nno need to have\", \" to re-enter form values or otherwise get the app back where you need it.21 CHAPTER 5 | App startup\\n\", \"CHAPTER 5\\nApp startup\\nApplications that are written for ASP.NET typically have a global.asax.cs file\", \" that defines the \\nApplication_Start event that controls which services are configured and made avai\", \"lable for both HTML \\nrendering and .NET processing. This chapter looks at how things are slightly di\", \"fferent with ASP.NET \\nCore and Blazor Server.\\nApplication_Start and Web Forms\\nThe default web forms \", \"Application_Start method has grown in purpose over years to handle many \\nconfiguration tasks. A fres\", \"h web forms project with the default template in Visual Studio 2022 now \\ncontains the following conf\", \"iguration logic:\\n\\u2022 RouteConfig - Application URL routing\\n\\u2022 BundleConfig - CSS and JavaScript bundlin\", \"g and minification\\nEach of these individual files resides in the App_Start folder and run only once \", \"at the start of our \\napplication. RouteConfig in the default project template adds the FriendlyUrlSe\", \"ttings for web forms to \\nallow application URLs to omit the .ASPX file extension. The default templa\", \"te also contains a directive \\nthat provides permanent HTTP redirect status codes (HTTP 301) for the \", \".ASPX pages to the friendly \\nURL with the file name that omits the extension.\\nWith ASP.NET Core and \", \"Blazor, these methods are either simplified and consolidated into the Startup \\nclass or they are eli\", \"minated in favor of common web technologies.\\nBlazor Server Startup Structure\\nBlazor Server applicati\", \"ons reside on top of an ASP.NET Core 3.0 or later version. ASP.NET Core web \\napplications are config\", \"ured in Program.cs, or through a pair of methods in the Startup.cs class. A \\nsample Program.cs file \", \"is shown below:\\nusing BlazorApp1.Data;\\nusing Microsoft.AspNetCore.Components;\\nusing Microsoft.AspNet\", \"Core.Components.Web;\\nvar builder = WebApplication.CreateBuilder(args);\\n// Add services to the contai\", \"ner.\\nbuilder.Services.AddRazorPages();\\nbuilder.Services.AddServerSideBlazor();\\nbuilder.Services.AddS\", \"ingleton<WeatherForecastService>();22 CHAPTER 5 | App startup\\nvar app = builder.Build();\\n// Configur\", \"e the HTTP request pipeline.\\nif (!app.Environment.IsDevelopment())\\n{\\n app.UseExceptionHandler(\\\"/Erro\", \"r\\\");\\n // The default HSTS value is 30 days. You may want to change this for production \\nscenarios, s\", \"ee https://aka.ms/aspnetcore-hsts.\\n app.UseHsts();\\n}\\napp.UseHttpsRedirection();\\napp.UseStaticFiles()\", \";\\napp.UseRouting();\\napp.MapBlazorHub();\\napp.MapFallbackToPage(\\\"/_Host\\\");\\napp.Run();\\nThe app\\u2019s requir\", \"ed services are added to the WebApplicationBuilder instance\\u2019s Services collection. \\nThis is how the \", \"various ASP.NET Core framework services are configured with the framework\\u2019s built-in \\ndependency inj\", \"ection container. The various builder.Services.Add* methods add services that enable \\nfeatures such \", \"as authentication, razor pages, MVC controller routing, SignalR, and Blazor Server \\ninteractions amo\", \"ng many others. This method was not needed in web forms, as the parsing and \\nhandling of the ASPX, A\", \"SCX, ASHX, and ASMX files were defined by referencing ASP.NET in the \\nweb.config configuration file.\", \" More information about dependency injection in ASP.NET Core is \\navailable in the online documentati\", \"on.\\nAfter the app has been built by the builder, the rest of the calls on app configure its HTTP pip\", \"eline. \\nWith these calls, we declare from top to bottom the Middleware that will handle every reques\", \"t sent to \\nour application. Most of these features in the default configuration were scattered acros\", \"s the web \\nforms configuration files and are now in one place for ease of reference.\\nNo longer is th\", \"e configuration of the custom error page placed in a web.config file, but now is \\nconfigured to alwa\", \"ys be shown if the application environment is not labeled Development. \\nAdditionally, ASP.NET Core a\", \"pplications are now configured to serve secure pages with TLS by default \\nwith the UseHttpsRedirecti\", \"on method call.\\nNext, an unexpected configuration method call is made to UseStaticFiles. In ASP.NET \", \"Core, support for \\nrequests for static files (like JavaScript, CSS, and image files) must be explici\", \"tly enabled, and only files \\nin the app\\u2019s wwwroot folder are publicly addressable by default.\\nThe ne\", \"xt line is the first that replicates one of the configuration options from web forms: UseRouting. \\nT\", \"his method adds the ASP.NET Core router to the pipeline and it can be either configured here or in \\n\", \"the individual files that it can consider routing to. More information about routing configuration c\", \"an \\nbe found in the Routing section.\\nThe final app.Map* calls in this section define the endpoints t\", \"hat ASP.NET Core is listening on. These \\nroutes are the web accessible locations that you can access\", \" on the web server and receive some \\ncontent handled by .NET and returned to you. The first entry, M\", \"apBlazorHub configures a SignalR hub \\nfor use in providing the real-time and persistent connection t\", \"o the server where the state and \\nrendering of Blazor components is handled. The MapFallbackToPage m\", \"ethod call indicates the web\\u0002accessible location of the page that starts the Blazor application and \", \"also configures the application to 23 CHAPTER 5 | App startup\\nhandle deep-linking requests from the \", \"client-side. You will see this feature at work if you open a \\nbrowser and navigate directly to Blazo\", \"r handled route in your application, such as /counter in the \\ndefault project template. The request \", \"gets handled by the *_Host.cshtml* fallback page, which then \\nruns the Blazor router and renders the\", \" counter page.\\nThe very last line starts the application, something that wasn\\u2019t required in web form\", \"s (since it relied on \\nIIS to be running).\\nUpgrading the BundleConfig Process\\nTechnologies for bundl\", \"ing assets like CSS stylesheets and JavaScript files have changed significantly, \\nwith other technol\", \"ogies providing quickly evolving tools and techniques for managing these \\nresources. To this end, we\", \" recommend using a Node command-line tool such as Grunt / Gulp / \\nWebPack to package your static ass\", \"ets.\\nThe Grunt, Gulp, and WebPack command-line tools and their associated configurations can be adde\", \"d \\nto your application and ASP.NET Core will quietly ignore those files during the application build\", \" \\nprocess. You can add a call to run their tasks by adding a Target inside your project file with sy\", \"ntax \\nsimilar to the following that would trigger a gulp script and the min target inside that scrip\", \"t:\\n<Target Name=\\\"MyPreCompileTarget\\\" BeforeTargets=\\\"Build\\\">\\n <Exec Command=\\\"gulp min\\\" />\\n</Target>\\nM\", \"ore details about both strategies to manage your CSS and JavaScript files are available in the Bundl\", \"e \\nand minify static assets in ASP.NET Core documentation.24 CHAPTER 6 | Build reusable UI component\", \"s with Blazor\\nCHAPTER 6\\nBuild reusable UI \\ncomponents with Blazor\\nOne of the beautiful things about \", \"ASP.NET Web Forms is how it enables encapsulation of reusable \\npieces of user interface (UI) code in\", \"to reusable UI controls. Custom user controls can be defined in \\nmarkup using .ascx files. You can a\", \"lso build elaborate server controls in code with full designer \\nsupport.\\nBlazor also supports UI enc\", \"apsulation through components. A component:\\n\\u2022 Is a self-contained chunk of UI.\\n\\u2022 Maintains its own s\", \"tate and rendering logic.\\n\\u2022 Can define UI event handlers, bind to input data, and manage its own lif\", \"ecycle.\\n\\u2022 Is typically defined in a .razor file using Razor syntax.\\nAn introduction to Razor\\nRazor i\", \"s a light-weight markup templating language based on HTML and C#. With Razor, you can \\nseamlessly tr\", \"ansition between markup and C# code to define your component rendering logic. When \\nthe .razor file \", \"is compiled, the rendering logic is captured in a structured way in a .NET class. The name \\nof the c\", \"ompiled class is taken from the .razor file name. The namespace is taken from the default \\nnamespace\", \" for the project and the folder path, or you can explicitly specify the namespace using the \\n@namesp\", \"ace directive (more on Razor directives below).\\nA component\\u2019s rendering logic is authored using norm\", \"al HTML markup with dynamic logic added \\nusing C#. The @ character is used to transition to C#. Razo\", \"r is typically smart about figuring out when \\nyou\\u2019ve switched back to HTML. For example, the followi\", \"ng component renders a <p> tag with the \\ncurrent time:\\n<p>@DateTime.Now</p>\\nTo explicitly specify th\", \"e beginning and ending of a C# expression, use parentheses:\\n<p>@(DateTime.Now)</p>\\nRazor also makes \", \"it easy to use C# control flow in your rendering logic. For example, you can \\nconditionally render s\", \"ome HTML like this:25 CHAPTER 6 | Build reusable UI components with Blazor\\n@if (value % 2 == 0)\\n{\\n <\", \"p>The value was even.</p>\\n}\\nOr you can generate a list of items using a normal C# foreach loop like \", \"this:\\n<ul>\\n@foreach (var item in items)\\n{\\n <li>@item.Text</li>\\n}\\n</ul>\\nRazor directives, like direct\", \"ives in ASP.NET Web Forms, control many aspects of how a Razor \\ncomponent is compiled. Examples incl\", \"ude the component\\u2019s:\\n\\u2022 Namespace\\n\\u2022 Base class\\n\\u2022 Implemented interfaces\\n\\u2022 Generic parameters\\n\\u2022 Import\", \"ed namespaces\\n\\u2022 Routes\\nRazor directives start with the @ character and are typically used at the sta\", \"rt of a new line at the start \\nof the file. For example, the @namespace directive defines the compon\", \"ent\\u2019s namespace:\\n@namespace MyComponentNamespace\\nThe following table summarizes the various Razor di\", \"rectives used in Blazor and their ASP.NET Web \\nForms equivalents, if they exist.\\nDirective Descripti\", \"on Example Web Forms equivalent\\n@attribute Adds a class-level \\nattribute to the \\ncomponent\\n@attribut\", \"e \\n[Authorize]\\nNone\\n@code Adds class \\nmembers to the \\ncomponent\\n@code { ... } <script runat=\\\"server\\\"\", \">...</script>\\n@implements Implements the \\nspecified interface\\n@impleme\\nnts \\nIDisposable\\nUse code-beh\", \"ind\\n@inherits Inherits from the \\nspecified base class\\n@inherits \\nMyCompon\\nentBase\\n<%@ Control \\nInher\", \"its=\\\"MyUserControlBase\\\" %>\\n@inject Injects a service \\ninto the component\\n@inject \\nIJSRuntime \\nJS\\nNon\", \"e26 CHAPTER 6 | Build reusable UI components with Blazor\\nDirective Description Example Web Forms equ\", \"ivalent\\n@layout Specifies a layout \\ncomponent for the \\ncomponent\\n@layout \\nMainLayout\\n<%@ Page \\nMaste\", \"rPageFile=\\\"~/Site.Master\\\" %>\\n@namespace Sets the namespace \\nfor the component\\n@namespa\\nce \\nMyNamesp\\n\", \"ace\\nNone\\n@page Specifies the route \\nfor the component\\n@page \\n\\\"/product/{i\\nd}\\\"\\n<%@ Page %>\\n@typeparam\", \" Specifies a generic \\ntype parameter for \\nthe component\\n@typepara\\nm TItem\\nUse code-behind\\n@using Spe\", \"cifies a \\nnamespace to bring \\ninto scope\\n@using \\nMyCompon\\nentNamesp\\nace\\nAdd namespace in web.config\\n\", \"Razor components also make extensive use of directive attributes on elements to control various \\nasp\", \"ects of how components get compiled (event handling, data binding, component & element \\nreferences, \", \"and so on). Directive attributes all follow a common generic syntax where the values in \\nparenthesis\", \" are optional:\\n@directive(-suffix(:name))(=\\\"value\\\")\\nThe following table summarizes the various attri\", \"butes for Razor directives used in Blazor.\\nAttribute Description Example\\n@attributes Renders a dicti\", \"onary of attributes <input \\n@attributes=\\\"ExtraA\\nttributes\\\" />\\n@bind Creates a two-way data binding <\", \"input \\n@bind=\\\"username\\\" \\n@bind:event=\\\"oninp\\nut\\\" />\\n@on{event} Adds an event handler for the \\nspecifi\", \"ed event\\n<button \\n@onclick=\\\"Incremen\\ntCount\\\">Click \\nme!</button>\\n@key Specifies a key to be used by \", \"the \\ndiffing algorithm for preserving \\nelements in a collection\\n<DetailsEditor \\n@key=\\\"person\\\" \\nDetai\", \"ls=\\\"person.Det\\nails\\\" />27 CHAPTER 6 | Build reusable UI components with Blazor\\nAttribute Description\", \" Example\\n@ref Captures a reference to the \\ncomponent or HTML element\\n<MyDialog \\n@ref=\\\"myDialog\\\" />\\nT\", \"he various directive attributes used by Blazor (@onclick, @bind, @ref, and so on) are covered in the\", \" \\nsections below and later chapters.\\nMany of the syntaxes used in .aspx and .ascx files have paralle\", \"l syntaxes in Razor. Below is a simple \\ncomparison of the syntaxes for ASP.NET Web Forms and Razor.\\n\", \"Feature Web Forms Syntax Razor Synt\\nax\\nDirectives <%@ [directive] %> <%@ Page %> @[directive] @pa\\nge\", \"\\nCode blocks <% %> <% int x = 123; %> @{ } @{ \\nint x \\n= \\n123; }\\nExpressions\\n(HTML-encoded)\\n<%: %> <%\", \":DateTime.Now \\n%>\\nImplicit: @\\nExplicit: @()\\n@Da\\nteTi\\nme.N\\now\\n@(Da\\nteTi\\nme.N\\now)\\nComments <%-- --%> <\", \"%-- Commented --\\n%>\\n@* *@ @* \\nCom\\nment\\ned \\n*@\\nData binding <%# %> <%# Bind(\\\"Name\\\") \\n%>\\n@bind <inp\\nut\", \" \\n@bin\\nd=\\\"u\\nserna\\nme\\\" \\n/>\\nTo add members to the Razor component class, use the @code directive. This\", \" technique is similar to \\nusing a <script runat=\\\"server\\\">...</script> block in an ASP.NET Web Forms \", \"user control or page.\\n@code {\\n int count = 0;\\n void IncrementCount()\\n {\\n count++;28 CHAPTER 6 | Buil\", \"d reusable UI components with Blazor\\n }\\n}\\nBecause Razor is based on C#, it must be compiled from wit\", \"hin a C# project (.csproj). You can\\u2019t \\ncompile .razor files from a Visual Basic project (.vbproj). Y\", \"ou can still reference Visual Basic projects \\nfrom your Blazor project. The opposite is true too.\\nFo\", \"r a full Razor syntax reference, see Razor syntax reference for ASP.NET Core.\\nUse components\\nAside f\", \"rom normal HTML, components can also use other components as part of their rendering logic. \\nThe syn\", \"tax for using a component in Razor is similar to using a user control in an ASP.NET Web Forms \\napp. \", \"Components are specified using an element tag that matches the type name of the component. \\nFor exam\", \"ple, you can add a Counter component like this:\\n<Counter />\\nUnlike ASP.NET Web Forms, components in \", \"Blazor:\\n\\u2022 Don\\u2019t use an element prefix (for example, asp:).\\n\\u2022 Don\\u2019t require registration on the page \", \"or in the web.config.\\nThink of Razor components like you would .NET types, because that\\u2019s exactly wh\", \"at they are. If the \\nassembly containing the component is referenced, then the component is availabl\", \"e for use. To bring \\nthe component\\u2019s namespace into scope, apply the @using directive:\\n@using MyComp\", \"onentLib\\n<Counter />\\nAs seen in the default Blazor projects, it\\u2019s common to put @using directives in\", \"to a *_Imports.razor* file \\nso that they\\u2019re imported into all .razor files in the same directory and\", \" in child directories.\\nIf the namespace for a component isn\\u2019t in scope, you can specify a component \", \"using its full type \\nname, as you can in C#:\\n<MyComponentLib.Counter />\\nModify page title from compo\", \"nents\\nWhen building SPA-style apps, it\\u2019s common for parts of a page to reload without reloading the \", \"entire \\npage. Even so, it can be useful to have the title of the page change based on which componen\", \"t is \\ncurrently loaded. This can be accomplished by including the <PageTitle> tag in the component\\u2019s\", \" \\nRazor page:\\n@page \\\"/\\\"\\n<PageTitle>Home</PageTitle>\\nThe contents of this element can be dynamic, for\", \" instance showing the current count of messages:29 CHAPTER 6 | Build reusable UI components with Bla\", \"zor\\n<PageTitle>@MessageCount messages</PageTitle>\\nNote that if several components on a particular pa\", \"ge include <PageTitle> tags, only the last one will \\nbe displayed (since each one will overwrite the\", \" previous one).\\nComponent parameters\\nIn ASP.NET Web Forms, you can flow parameters and data to contr\", \"ols using public properties. These \\nproperties can be set in markup using attributes or set directly\", \" in code. Razor components work in a \\nsimilar fashion, although the component properties must also b\", \"e marked with the [Parameter] \\nattribute to be considered component parameters.\\nThe following Counte\", \"r component defines a component parameter called IncrementAmount that can \\nbe used to specify the am\", \"ount that the Counter should be incremented each time the button is \\nclicked.\\n<h1>Counter</h1>\\n<p>Cu\", \"rrent count: @currentCount</p>\\n<button class=\\\"btn btn-primary\\\" @onclick=\\\"IncrementCount\\\">Click me</b\", \"utton>\\n@code {\\n int currentCount = 0;\\n [Parameter]\\n public int IncrementAmount { get; set; } = 1;\\n v\", \"oid IncrementCount()\\n {\\n currentCount+=IncrementAmount;\\n }\\n}\\nTo specify a component parameter in Bla\", \"zor, use an attribute as you would in ASP.NET Web Forms:\\n<Counter IncrementAmount=\\\"10\\\" />\\nQuery stri\", \"ng parameters\\nRazor components can also leverage values from the query string of the page they\\u2019re re\", \"ndered on as \\na parameter source. To enable this, add the [SupplyParameterFromQuery] attribute to th\", \"e parameter. \\nFor example, the following parameter definition would get its value from the request i\", \"n the form \\n?IncBy=2:\\n[Parameter]\\n[SupplyParameterFromQuery(Name = \\\"IncBy\\\")]\\npublic int IncrementAmo\", \"unt { get; set; } = 1;\\nIf you don\\u2019t supply a custom Name in the [SupplyParameterFromQuery] attribute\", \", by default it will \\nmatch the property name (IncrementAmount in this case).30 CHAPTER 6 | Build re\", \"usable UI components with Blazor\\nComponents and error boundaries\\nBy default, Blazor apps will detect\", \" unhandled exceptions and show an error message at the bottom of \\nthe page with no additional detail\", \". To constrain the parts of the app that are impacted by an \\nunhandled error, for instance to limit \", \"the impact to a single component, the <ErrorBoundary> tag can \\nbe wrapped around component declarati\", \"ons.\\nFor example, to protect against possible exceptions thrown from the Counter component, declare \", \"it \\nwithin an <ErrorBoundary> and optionally specify a message to display if there is an exception:\\n\", \"<ErrorBoundary>\\n <ChildContent>\\n <Counter />\\n </ChildContent>\\n <ErrorContent>\\n Oops! The counter isn\", \"'t working right now; please try again later.\\n </ErrorContent>\\n</ErrorBoundary>\\nIf you don\\u2019t need to\", \" specify custom error content, you can just wrap the component \\ndirectly:\\n<ErrorBoundary>\\n <Counter \", \"/>\\n</ErrorBoundary>\\nA default message stating \\u201cAn error as occurred.\\u201d will be displayed if an unhand\", \"led exception occurs \\nin the wrapped component.\\nEvent handlers\\nBoth ASP.NET Web Forms and Blazor pro\", \"vide an event-based programming model for handling UI \\nevents. Examples of such events include butto\", \"n clicks and text input. In ASP.NET Web Forms, you use \\nHTML server controls to handle UI events exp\", \"osed by the DOM, or you can handle events exposed by \\nweb server controls. The events are surfaced o\", \"n the server through form post-back requests. Consider \\nthe following Web Forms button click example\", \":\\nCounter.ascx\\n<asp:Button ID=\\\"ClickMeButton\\\" runat=\\\"server\\\" Text=\\\"Click me!\\\" \\nOnClick=\\\"ClickMeButto\", \"n_Click\\\" />\\nCounter.ascx.cs\\npublic partial class Counter : System.Web.UI.UserControl\\n{\\n protected vo\", \"id ClickMeButton_Click(object sender, EventArgs e)\\n {\\n Console.WriteLine(\\\"The button was clicked!\\\");\", \"\\n }\\n}\\nIn Blazor, you can register handlers for DOM UI events directly using directive attributes of \", \"the form \\n@on{event}. The {event} placeholder represents the name of the event. For example, you can\", \" listen for \\nbutton clicks like this:31 CHAPTER 6 | Build reusable UI components with Blazor\\n<button\", \" @onclick=\\\"OnClick\\\">Click me!</button>\\n@code {\\n void OnClick()\\n {\\n Console.WriteLine(\\\"The button was\", \" clicked!\\\");\\n }\\n}\\nEvent handlers can accept an optional, event-specific argument to provide more inf\", \"ormation about \\nthe event. For example, mouse events can take a MouseEventArgs argument, but it isn\\u2019\", \"t required.\\n<button @onclick=\\\"OnClick\\\">Click me!</button>\\n@code {\\n void OnClick(MouseEventArgs e)\\n {\", \"\\n Console.WriteLine($\\\"Mouse clicked at {e.ScreenX}, {e.ScreenY}.\\\");\\n }\\n}\\nInstead of referring to a m\", \"ethod group for an event handler, you can use a lambda expression. A \\nlambda expression allows you t\", \"o close over other in-scope values.\\n@foreach (var buttonLabel in buttonLabels)\\n{\\n <button @onclick=\\\"\", \"() => Console.WriteLine($\\\"The {buttonLabel} button was \\nclicked!\\\")\\\">@buttonLabel</button>\\n}\\nEvent ha\", \"ndlers can execute synchronously or asynchronously. For example, the following OnClick \\nevent handle\", \"r executes asynchronously:\\n<button @onclick=\\\"OnClick\\\">Click me!</button>\\n@code {\\n async Task OnClick\", \"()\\n {\\n var result = await Http.GetAsync(\\\"api/values\\\");\\n }\\n}\\nAfter an event is handled, the component\", \" is rendered to account for any component state changes. \\nWith asynchronous event handlers, the comp\", \"onent is rendered immediately after the handler \\nexecution completes. The component is rendered agai\", \"n after the asynchronous Task completes. This \\nasynchronous execution mode provides an opportunity t\", \"o render some appropriate UI while the \\nasynchronous Task is still in progress.\\n<button @onclick=\\\"Sh\", \"owMessage\\\">Get message</button>\\n@if (showMessage)\\n{\\n @if (message == null)\\n {\\n <p><em>Loading...</em\", \"></p>\\n }\\n else32 CHAPTER 6 | Build reusable UI components with Blazor\\n {\\n <p>The message is: @messag\", \"e</p>\\n }\\n}\\n@code\\n{\\n bool showMessage = false;\\n string message;\\n public async Task ShowMessage()\\n {\\n \", \"showMessage = true;\\n message = await MessageService.GetMessageAsync();\\n }\\n}\\nComponents can also defi\", \"ne their own events by defining a component parameter of type \\nEventCallback<TValue>. Event callback\", \"s support all the variations of DOM UI event handlers: optional \\narguments, synchronous or asynchron\", \"ous, method groups, or lambda expressions.\\n<button class=\\\"btn btn-primary\\\" @onclick=\\\"OnClick\\\">Click \", \"me!</button>\\n@code {\\n [Parameter]\\n public EventCallback<MouseEventArgs> OnClick { get; set; }\\n}\\nData\", \" binding\\nBlazor provides a simple mechanism to bind data from a UI component to the component\\u2019s stat\", \"e. This \\napproach differs from the features in ASP.NET Web Forms for binding data from data sources \", \"to UI \\ncontrols. We\\u2019ll cover handling data from different data sources in the Dealing with data sect\", \"ion.\\nTo create a two-way data binding from a UI component to the component\\u2019s state, use the @bind \\nd\", \"irective attribute. In the following example, the value of the check box is bound to the isChecked \\n\", \"field.\\n<input type=\\\"checkbox\\\" @bind=\\\"isChecked\\\" />\\n@code {\\n bool isChecked;\\n}\\nWhen the component is \", \"rendered, the value of the checkbox is set to the value of the isChecked field. \\nWhen the user toggl\", \"es the checkbox, the onchange event is fired and the isChecked field is set to the \\nnew value. The @\", \"bind syntax in this case is equivalent to the following markup:\\n<input value=\\\"@isChecked\\\" @onchange=\", \"\\\"(UIChangeEventArgs e) => isChecked = e.Value\\\" />\\nTo change the event used for the bind, use the @bi\", \"nd:event attribute.\\n<input @bind=\\\"text\\\" @bind:event=\\\"oninput\\\" />\\n<p>@text</p>33 CHAPTER 6 | Build re\", \"usable UI components with Blazor\\n@code {\\n string text;\\n}\\nComponents can also support data binding to\", \" their parameters. To data bind, define an event callback \\nparameter with the same name as the binda\", \"ble parameter. The \\u201cChanged\\u201d suffix is added to the \\nname.\\nPasswordBox.razor\\nPassword: <input\\n value\", \"=\\\"@Password\\\"\\n @oninput=\\\"OnPasswordChanged\\\"\\n type=\\\"@(showPassword ? \\\"text\\\" : \\\"password\\\")\\\" />\\n<label><\", \"input type=\\\"checkbox\\\" @bind=\\\"showPassword\\\" />Show password</label>\\n@code {\\n private bool showPasswor\", \"d;\\n [Parameter]\\n public string Password { get; set; }\\n [Parameter]\\n public EventCallback<string> Pas\", \"swordChanged { get; set; }\\n private Task OnPasswordChanged(ChangeEventArgs e)\\n {\\n Password = e.Value\", \".ToString();\\n return PasswordChanged.InvokeAsync(Password);\\n }\\n}\\nTo chain a data binding to an under\", \"lying UI element, set the value and handle the event directly on \\nthe UI element instead of using th\", \"e @bind attribute.\\nTo bind to a component parameter, use a @bind-{Parameter} attribute to specify th\", \"e parameter to \\nwhich you want to bind.\\n<PasswordBox @bind-Password=\\\"password\\\" />\\n@code {\\n string pa\", \"ssword;\\n}\\nState changes\\nIf the component\\u2019s state has changed outside of a normal UI event or event c\", \"allback, then the \\ncomponent must manually signal that it needs to be rendered again. To signal that\", \" a component\\u2019s \\nstate has changed, call the StateHasChanged method on the component.\\nIn the example \", \"below, a component displays a message from an AppState service that can be updated \\nby other parts o\", \"f the app. The component registers its StateHasChanged method with the \\nAppState.OnChange event so t\", \"hat the component is rendered whenever the message gets updated.34 CHAPTER 6 | Build reusable UI com\", \"ponents with Blazor\\npublic class AppState\\n{\\n public string Message { get; }\\n // Lets components rece\", \"ive change notifications\\n public event Action OnChange;\\n public void UpdateMessage(string message)\\n \", \"{\\n Message = message;\\n NotifyStateChanged();\\n }\\n private void NotifyStateChanged() => OnChange?.Invo\", \"ke();\\n}\\n@inject AppState AppState\\n<p>App message: @AppState.Message</p>\\n@code {\\n protected override \", \"void OnInitialized()\\n {\\n AppState.OnChange += StateHasChanged\\n }\\n}\\nComponent lifecycle\\nThe ASP.NET W\", \"eb Forms framework has well-defined lifecycle methods for modules, pages, and \\ncontrols. For example\", \", the following control implements event handlers for the Init, Load, and UnLoad \\nlifecycle events:\\n\", \"Counter.ascx.cs\\npublic partial class Counter : System.Web.UI.UserControl\\n{\\n protected void Page_Init\", \"(object sender, EventArgs e) { ... }\\n protected void Page_Load(object sender, EventArgs e) { ... }\\n \", \"protected void Page_UnLoad(object sender, EventArgs e) { ... }\\n}\\nRazor components also have a well-d\", \"efined lifecycle. A component\\u2019s lifecycle can be used to initialize \\ncomponent state and implement a\", \"dvanced component behaviors.\\nAll of Blazor\\u2019s component lifecycle methods have both synchronous and a\", \"synchronous versions. \\nComponent rendering is synchronous. You can\\u2019t run asynchronous logic as part \", \"of the component \\nrendering. All asynchronous logic must execute as part of an async lifecycle metho\", \"d.\\nOnInitialized\\nThe OnInitialized and OnInitializedAsync methods are used to initialize the compone\", \"nt. A component \\nis typically initialized after it\\u2019s first rendered. After a component is initialize\", \"d, it may be rendered 35 CHAPTER 6 | Build reusable UI components with Blazor\\nmultiple times before \", \"it\\u2019s eventually disposed. The OnInitialized method is similar to the Page_Load \\nevent in ASP.NET Web\", \" Forms pages and controls.\\nprotected override void OnInitialized() { ... }\\nprotected override async \", \"Task OnInitializedAsync() { await ... }\\nOnParametersSet\\nThe OnParametersSet and OnParametersSetAsync\", \" methods are called when a component has \\nreceived parameters from its parent and the value are assi\", \"gned to properties. These methods are \\nexecuted after component initialization and each time the com\", \"ponent is rendered.\\nprotected override void OnParametersSet() { ... }\\nprotected override async Task \", \"OnParametersSetAsync() { await ... }\\nOnAfterRender\\nThe OnAfterRender and OnAfterRenderAsync methods \", \"are called after a component has finished \\nrendering. Element and component references are populated\", \" at this point (more on these concepts \\nbelow). Interactivity with the browser is enabled at this po\", \"int. Interactions with the DOM and \\nJavaScript execution can safely take place.\\nprotected override v\", \"oid OnAfterRender(bool firstRender)\\n{\\n if (firstRender)\\n {\\n ...\\n }\\n}\\nprotected override async Task O\", \"nAfterRenderAsync(bool firstRender)\\n{\\n if (firstRender)\\n {\\n await ...\\n }\\n}\\nOnAfterRender and OnAfter\", \"RenderAsync aren\\u2019t called when prerendering on the server.\\nThe firstRender parameter is true the fir\", \"st time the component is rendered; otherwise, its value is false.\\nIDisposable\\nRazor components can i\", \"mplement IDisposable to dispose of resources when the component is \\nremoved from the UI. A Razor com\", \"ponent can implement IDispose by using the @implements \\ndirective:\\n@using System\\n@implements IDispos\", \"able\\n...\\n@code {\\n public void Dispose()36 CHAPTER 6 | Build reusable UI components with Blazor\\n {\\n .\", \"..\\n }\\n}\\nCapture component references\\nIn ASP.NET Web Forms, it\\u2019s common to manipulate a control insta\", \"nce directly in code by referring to \\nits ID. In Blazor, it\\u2019s also possible to capture and manipulat\", \"e a reference to a component, although it\\u2019s \\nmuch less common.\\nTo capture a component reference in B\", \"lazor, use the @ref directive attribute. The value of the \\nattribute should match the name of a sett\", \"able field with the same type as the referenced component.\\n<MyLoginDialog @ref=\\\"loginDialog\\\" ... />\\n\", \"@code {\\n MyLoginDialog loginDialog = default!;\\n void OnSomething()\\n {\\n loginDialog.Show();\\n }\\n}\\nWhen\", \" the parent component is rendered, the field is populated with the child component instance. \\nYou ca\", \"n then call methods on, or otherwise manipulate, the component instance.\\nManipulating component stat\", \"e directly using component references isn\\u2019t recommended. Doing so \\nprevents the component from being\", \" rendered automatically at the correct times.\\nCapture element references\\nRazor components can captur\", \"e references to an element. Unlike HTML server controls in ASP.NET \\nWeb Forms, you can\\u2019t manipulate \", \"the DOM directly using an element reference in Blazor. Blazor \\nhandles most DOM interactions for you\", \" using its DOM diffing algorithm. Captured element references \\nin Blazor are opaque. However, they\\u2019r\", \"e used to pass a specific element reference in a JavaScript \\ninterop call. For more information abou\", \"t JavaScript interop, see ASP.NET Core Blazor JavaScript \\ninterop.\\nTemplated components\\nIn ASP.NET W\", \"eb Forms, you can create templated controls. Templated controls enable the developer \\nto specify a p\", \"ortion of the HTML used to render a container control. The mechanics of building \\ntemplated server c\", \"ontrols are complex, but they enable powerful scenarios for rendering data in a \\nuser customizable w\", \"ay. Examples of templated controls include Repeater and DataList.\\nRazor components can also be templ\", \"ated by defining component parameters of type \\nRenderFragment or RenderFragment<T>. A RenderFragment\", \" represents a chunk of Razor markup 37 CHAPTER 6 | Build reusable UI components with Blazor\\nthat can\", \" then be rendered by the component. A RenderFragment<T> is a chunk of Razor markup that \\ntakes a par\", \"ameter that can be specified when the render fragment is rendered.\\nChild content\\nRazor components ca\", \"n capture their child content as a RenderFragment and render that content as \\npart of the component \", \"rendering. To capture child content, define a component parameter of type \\nRenderFragment and name i\", \"t ChildContent.\\nChildContentComponent.razor\\n<h1>Component with child content</h1>\\n<div>@ChildContent\", \"</div>\\n@code {\\n [Parameter]\\n public RenderFragment ChildContent { get; set; }\\n}\\nA parent component c\", \"an then supply child content using normal Razor syntax.\\n<ChildContentComponent>\\n <ChildContent>\\n <p>\", \"The time is @DateTime.Now</p>\\n </ChildContent>\\n</ChildContentComponent>\\nTemplate parameters\\nA templa\", \"ted Razor component can also define multiple component parameters of type \\nRenderFragment or RenderF\", \"ragment<T>. The parameter for a RenderFragment<T> can be specified \\nwhen it\\u2019s invoked. To specify a \", \"generic type parameter for a component, use the @typeparam Razor \\ndirective.\\nSimpleListView.razor\\n@t\", \"ypeparam TItem\\n@Heading\\n<ul>\\n@foreach (var item in Items)\\n{\\n <li>@ItemTemplate(item)</li>\\n}\\n</ul>\\n@c\", \"ode {\\n [Parameter]\\n public RenderFragment Heading { get; set; }\\n [Parameter]\\n public RenderFragment<\", \"TItem> ItemTemplate { get; set; }\\n [Parameter]\\n public IEnumerable<TItem> Items { get; set; }\\n}38 CH\", \"APTER 6 | Build reusable UI components with Blazor\\nWhen using a templated component, the template pa\", \"rameters can be specified using child elements \\nthat match the names of the parameters. Component ar\", \"guments of type RenderFragment<T> passed \\nas elements have an implicit parameter named context. You \", \"can change the name of this implement \\nparameter using the Context attribute on the child element. A\", \"ny generic type parameters can be \\nspecified using an attribute that matches the name of the type pa\", \"rameter. The type parameter will be \\ninferred if possible:\\n<SimpleListView Items=\\\"messages\\\" TItem=\\\"s\", \"tring\\\">\\n <Heading>\\n <h1>My list</h1>\\n </Heading>\\n <ItemTemplate Context=\\\"message\\\">\\n <p>The message i\", \"s: @message</p>\\n </ItemTemplate>\\n</SimpleListView>\\nThe output of this component looks like this:\\n<h1\", \">My list</h1>\\n<ul>\\n <li><p>The message is: message1</p></li>\\n <li><p>The message is: message2</p></l\", \"i>\\n<ul>\\nCode-behind\\nA Razor component is typically authored in a single .razor file. However, it\\u2019s a\", \"lso possible to separate \\nthe code and markup using a code-behind file. To use a component file, add\", \" a C# file that matches \\nthe file name of the component file but with a .cs extension added (Counter\", \".razor.cs). Use the C# file \\nto define a base class for the component. You can name the base class a\", \"nything you\\u2019d like, but it\\u2019s \\ncommon to name the class the same as the component class, but with a B\", \"ase extension added \\n(CounterBase). The component-based class must also derive from ComponentBase. T\", \"hen, in the Razor \\ncomponent file, add the @inherits directive to specify the base class for the com\", \"ponent (@inherits \\nCounterBase).\\nCounter.razor\\n@inherits CounterBase\\n<h1>Counter</h1>\\n<p>Current cou\", \"nt: @currentCount</p>\\n<button @onclick=\\\"IncrementCount\\\">Click me</button>\\nCounter.razor.cs\\npublic cl\", \"ass CounterBase : ComponentBase\\n{\\n protected int currentCount = 0;\\n protected void IncrementCount()\\n\", \" {\\n currentCount++;\\n }\\n}39 CHAPTER 6 | Build reusable UI components with Blazor\\nThe visibility of th\", \"e component\\u2019s members in the base class must be protected or public to be visible \\nto the component \", \"class.\\nAdditional resources\\nThe preceding isn\\u2019t an exhaustive treatment of all aspects of Razor comp\", \"onents. For more information \\non how to Create and use ASP.NET Core Razor components, see the Blazor\", \" documentation.40 CHAPTER 7 | Pages, routing, and layouts\\nCHAPTER 7\\nPages, routing, and \\nlayouts\\nASP\", \".NET Web Forms apps are composed of pages defined in .aspx files. Each page\\u2019s address is based \\non i\", \"ts physical file path in the project. When a browser makes a request to the page, the contents of \\nt\", \"he page are dynamically rendered on the server. The rendering accounts for both the page\\u2019s HTML \\nmar\", \"kup and its server controls.\\nIn Blazor, each page in the app is a component, typically defined in a \", \".razor file, with one or more \\nspecified routes. Routing mostly happens client-side without involvin\", \"g a specific server request. The \\nbrowser first makes a request to the root address of the app. A ro\", \"ot Router component in the Blazor \\napp then handles intercepting navigation requests and forwards th\", \"em to the correct component.\\nBlazor also supports deep linking. Deep linking occurs when the browser\", \" makes a request to a specific \\nroute other than the root of the app. Requests for deep links sent t\", \"o the server are routed to the \\nBlazor app, which then routes the request client-side to the correct\", \" component.\\nA simple page in ASP.NET Web Forms might contain the following markup:\\nName.aspx\\n<%@ Pag\", \"e Title=\\\"Name\\\" Language=\\\"C#\\\" MasterPageFile=\\\"~/Site.Master\\\" AutoEventWireup=\\\"true\\\" \\nCodeBehind=\\\"Name\", \".aspx.cs\\\" Inherits=\\\"WebApplication1.Name\\\" %>\\n<asp:Content ID=\\\"BodyContent\\\" ContentPlaceHolderID=\\\"Mai\", \"nContent\\\" runat=\\\"server\\\">\\n <div>\\n What is your name?<br />\\n <asp:TextBox ID=\\\"TextBox1\\\" runat=\\\"server\", \"\\\"></asp:TextBox>\\n <asp:Button ID=\\\"Button1\\\" runat=\\\"server\\\" Text=\\\"Submit\\\" OnClick=\\\"Button1_Click\\\" />\\n \", \"</div>\\n <div>\\n <asp:Literal ID=\\\"Literal1\\\" runat=\\\"server\\\" />\\n </div>\\n</asp:Content>\\nName.aspx.cs\\npubl\", \"ic partial class Name : System.Web.UI.Page\\n{\\n protected void Button1_Click1(object sender, EventArgs\", \" e)\\n {\\n Literal1.Text = \\\"Hello \\\" + TextBox1.Text;\\n }\\n}41 CHAPTER 7 | Pages, routing, and layouts\\nThe\", \" equivalent page in a Blazor app would look like this:\\nName.razor\\n@page \\\"/Name\\\"\\n@layout MainLayout\\n<\", \"div>\\n What is your name?<br />\\n <input @bind=\\\"text\\\" />\\n <button @onclick=\\\"OnClick\\\">Submit</button>\\n<\", \"/div>\\n<div>\\n @if (name != null)\\n {\\n @:Hello @name\\n }\\n</div>\\n@code {\\n string text;\\n string name;\\n voi\", \"d OnClick() {\\n name = text;\\n }\\n}\\nCreate pages\\nTo create a page in Blazor, create a component and add\", \" the @page Razor directive to specify the \\nroute for the component. The @page directive takes a sing\", \"le parameter, which is the route template \\nto add to that component.\\n@page \\\"/counter\\\"\\nThe route temp\", \"late parameter is required. Unlike ASP.NET Web Forms, the route to a Blazor \\ncomponent isn\\u2019t inferre\", \"d from its file location (although that may be a feature added in the future).\\nThe route template sy\", \"ntax is the same basic syntax used for routing in ASP.NET Web Forms. Route \\nparameters are specified\", \" in the template using braces. Blazor will bind route values to component \\nparameters with the same \", \"name (case-insensitive).\\n@page \\\"/product/{id}\\\"\\n<h1>Product @Id</h1>\\n@code {\\n [Parameter]\\n public str\", \"ing Id { get; set; }\\n}\\nYou can also specify constraints on the value of the route parameter. For exa\", \"mple, to constrain the \\nproduct ID to be an int:42 CHAPTER 7 | Pages, routing, and layouts\\n@page \\\"/p\", \"roduct/{id:int}\\\"\\n<h1>Product @Id</h1>\\n@code {\\n [Parameter]\\n public int Id { get; set; }\\n}\\nFor a full\", \" list of the route constraints supported by Blazor, see Route constraints.\\nRouter component\\nRouting \", \"in Blazor is handled by the Router component. The Router component is typically used in the \\napp\\u2019s r\", \"oot component (App.razor).\\n<Router AppAssembly=\\\"@typeof(Program).Assembly\\\">\\n <Found Context=\\\"routeDa\", \"ta\\\">\\n <RouteView RouteData=\\\"@routeData\\\" DefaultLayout=\\\"@typeof(MainLayout)\\\" />\\n </Found>\\n <NotFound>\", \"\\n <LayoutView Layout=\\\"@typeof(MainLayout)\\\">\\n <p>Sorry, there's nothing at this address.</p>\\n </Layou\", \"tView>\\n </NotFound>\\n</Router>\\nThe Router component discovers the routable components in the specifie\", \"d AppAssembly and in the \\noptionally specified AdditionalAssemblies. When the browser navigates, the\", \" Router intercepts the \\nnavigation and renders the contents of its Found parameter with the extracte\", \"d RouteData if a route \\nmatches the address, otherwise the Router renders its NotFound parameter.\\nTh\", \"e RouteView component handles rendering the matched component specified by the RouteData \\nwith its l\", \"ayout if it has one. If the matched component doesn\\u2019t have a layout, then the optionally \\nspecified \", \"DefaultLayout is used.\\nThe LayoutView component renders its child content within the specified layou\", \"t. We\\u2019ll look at layouts \\nmore in detail later in this chapter.\\nNavigation\\nIn ASP.NET Web Forms, you\", \" trigger navigation to a different page by returning a redirect response to \\nthe browser. For exampl\", \"e:\\nprotected void NavigateButton_Click(object sender, EventArgs e)\\n{\\n Response.Redirect(\\\"Counter\\\");\\n\", \"}\\nReturning a redirect response isn\\u2019t typically possible in Blazor. Blazor doesn\\u2019t use a request-rep\", \"ly \\nmodel. You can, however, trigger browser navigations directly, as you can with JavaScript.43 CHA\", \"PTER 7 | Pages, routing, and layouts\\nBlazor provides a NavigationManager service that can be used to\", \":\\n\\u2022 Get the current browser address\\n\\u2022 Get the base address\\n\\u2022 Trigger navigations\\n\\u2022 Get notified when\", \" the address changes\\nTo navigate to a different address, use the NavigateTo method:\\n@page \\\"/\\\"\\n@injec\", \"t NavigationManager NavigationManager\\n<button @onclick=\\\"Navigate\\\">Navigate</button>\\n@code {\\n void Na\", \"vigate() {\\n NavigationManager.NavigateTo(\\\"counter\\\");\\n }\\n}\\nFor a description of all NavigationManager\", \" members, see URI and navigation state helpers.\\nBase URLs\\nIf your Blazor app is deployed under a bas\", \"e path, then you need to specify the base URL in the page \\nmetadata using the <base> tag for routing\", \" to work property. If the host page for the app is server\\u0002rendered using Razor, then you can use the\", \" ~/ syntax to specify the app\\u2019s base address. If the host \\npage is static HTML, then you need to spe\", \"cify the base URL explicitly.\\n<base href=\\\"~/\\\" />\\nPage layout\\nPage layout in ASP.NET Web Forms is han\", \"dled by Master Pages. Master Pages define a template with \\none or more content placeholders that can\", \" then be supplied by individual pages. Master Pages are \\ndefined in .master files and start with the\", \" <%@ Master %> directive. The content of the .master files is \\ncoded as you would an .aspx page, but\", \" with the addition of <asp:ContentPlaceHolder> controls to \\nmark where pages can supply content.\\nSit\", \"e.master\\n<%@ Master Language=\\\"C#\\\" AutoEventWireup=\\\"true\\\" CodeBehind=\\\"Site.master.cs\\\" \\nInherits=\\\"WebA\", \"pplication1.SiteMaster\\\" %>\\n<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n<head runat=\\\"server\\\">\\n <meta charset=\\\"ut\", \"f-8\\\" />\\n <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\" />\\n <title><%: Page.T\", \"itle %> - My ASP.NET Application</title>\\n <link href=\\\"~/favicon.ico\\\" rel=\\\"shortcut icon\\\" type=\\\"image\", \"/x-icon\\\" />\\n</head>44 CHAPTER 7 | Pages, routing, and layouts\\n<body>\\n <form runat=\\\"server\\\">\\n <div cl\", \"ass=\\\"container body-content\\\">\\n <asp:ContentPlaceHolder ID=\\\"MainContent\\\" runat=\\\"server\\\">\\n </asp:Conte\", \"ntPlaceHolder>\\n <hr />\\n <footer>\\n <p>&copy; <%: DateTime.Now.Year %> - My ASP.NET Application</p>\\n <\", \"/footer>\\n </div>\\n </form>\\n</body>\\n</html>\\nIn Blazor, you handle page layout using layout components.\", \" Layout components inherit from \\nLayoutComponentBase, which defines a single Body property of type R\", \"enderFragment, which can be \\nused to render the contents of the page.\\nMainLayout.razor\\n@inherits Lay\", \"outComponentBase\\n<h1>Main layout</h1>\\n<div>\\n @Body\\n</div>\\nWhen the page with a layout is rendered, t\", \"he page is rendered within the contents of the specified \\nlayout at the location where the layout re\", \"nders its Body property.\\nTo apply a layout to a page, use the @layout directive:\\n@layout MainLayout\\n\", \"You can specify the layout for all components in a folder and subfolders using an *_Imports.razor* f\", \"ile. \\nYou can also specify a default layout for all your pages using the Router component.\\nMaster Pa\", \"ges can define multiple content placeholders, but layouts in Blazor only have a single Body \\npropert\", \"y. This limitation of Blazor layout components will hopefully be addressed in a future release.\\nMast\", \"er Pages in ASP.NET Web Forms can be nested. That is, a Master Page may also use a Master \\nPage. Lay\", \"out components in Blazor may be nested too. You can apply a layout component to a layout \\ncomponent.\", \" The contents of the inner layout will be rendered within the outer layout.\\nChildLayout.razor\\n@layou\", \"t MainLayout\\n<h2>Child layout</h2>\\n<div>\\n @Body\\n</div>\\nIndex.razor\\n@page \\\"/\\\"\\n@layout ChildLayout\\n<p>\", \"I'm in a nested layout!</p>\\nThe rendered output for the page would then be:45 CHAPTER 7 | Pages, rou\", \"ting, and layouts\\n<h1>Main layout</h1>\\n<div>\\n <h2>Child layout</h2>\\n <div>\\n <p>I'm in a nested layou\", \"t!</p>\\n </div>\\n</div>\\nLayouts in Blazor don\\u2019t typically define the root HTML elements for a page (<h\", \"tml>, <body>, <head>, \\nand so on). The root HTML elements are instead defined in a Blazor app\\u2019s host\", \" page, which is used to \\nrender the initial HTML content for the app (see Bootstrap Blazor). The hos\", \"t page can render multiple \\nroot components for the app with surrounding markup.\\nComponents in Blazo\", \"r, including pages, can\\u2019t render <script> tags. This rendering restriction exists \\nbecause <script> \", \"tags get loaded once and then can\\u2019t be changed. Unexpected behavior may occur if \\nyou try to render \", \"the tags dynamically using Razor syntax. Instead, all <script> tags should be added \\nto the app\\u2019s ho\", \"st page.46 CHAPTER 8 | State management\\nCHAPTER 8\\nState management\\nState management is a key concept\", \" of Web Forms applications, facilitated through ViewState, Session \\nState, Application State, and Po\", \"stback features. These stateful features of the framework helped to \\nhide the state management requi\", \"red for an application and allow application developers to focus on \\ndelivering their functionality.\", \" With ASP.NET Core and Blazor, some of these features have been \\nrelocated and some have been remove\", \"d altogether. This chapter reviews how to maintain state and \\ndeliver the same functionality with th\", \"e new features in Blazor.\\nRequest state management with ViewState\\nWhen discussing state management i\", \"n Web Forms application, many developers will immediately \\nthink of ViewState. In Web Forms, ViewSta\", \"te manages the state of the content between HTTP requests \\nby sending a large encoded block of text \", \"back and forth to the browser. The ViewState field could be \\noverwhelmed with content from a page co\", \"ntaining many elements, potentially expanding to several \\nmegabytes in size.\\nWith Blazor Server, the\", \" app maintains an ongoing connection with the server. The app\\u2019s state, called a \\ncircuit, is held in\", \" server memory while the connection is considered active. State will only be disposed \\nwhen the user\", \" navigates away from the app or a particular page in the app. All members of the active \\ncomponents \", \"are available between interactions with the server.\\nThere are several advantages of this feature:\\n\\u2022 \", \"Component state is readily available and not rebuilt between interactions.\\n\\u2022 State isn\\u2019t transmitted\", \" to the browser.\\nHowever, there are some disadvantages to in-memory component state persistence to b\", \"e aware of:\\n\\u2022 If the server restarts between request, state is lost.\\n\\u2022 Your application web server l\", \"oad-balancing solution must include sticky sessions to ensure \\nthat all requests from the same brows\", \"er return to the same server. If a request goes to a \\ndifferent server, state will be lost.\\n\\u2022 Persis\", \"tence of component state on the server can lead to memory pressure on the web server.\\nFor the preced\", \"ing reasons, don\\u2019t rely on just the state of the component to reside in-memory on the \\nserver. Your \", \"application should also include some backing data store for data between requests. Some \\nsimple exam\", \"ples of this strategy:\\n\\u2022 In a shopping cart application, persist the content of new items added to t\", \"he cart in a \\ndatabase record. If the state on the server is lost, you can reconstitute it from the \", \"database \\nrecords.47 CHAPTER 8 | State management\\n\\u2022 In a multi-part web form, your users will expect\", \" your application to remember values between \\neach request. Write the data between each of your user\", \"\\u2019s posts to a data store so that they \\ncan be fetched and assembled into the final form response str\", \"ucture when the multi-part \\nform is completed.\\nFor additional details on managing state in Blazor ap\", \"ps, see ASP.NET Core Blazor state management.\\nMaintain state with Session\\nWeb Forms developers could\", \" maintain information about the currently acting user with the \\nMicrosoft.AspNetCore.Http.ISession d\", \"ictionary object. It\\u2019s easy enough to add an object with a string \\nkey to the Session, and that obje\", \"ct would be available at a later time during the user\\u2019s interactions \\nwith the application. In an at\", \"tempt to eliminate managing interacting with HTTP, the Session object \\nmade it easy to maintain stat\", \"e.\\nThe signature of the .NET Framework Session object isn\\u2019t the same as the ASP.NET Core Session \\nob\", \"ject. Consider the documentation for the new ASP.NET Core Session before deciding to migrate \\nand us\", \"e the new session state feature.\\nSession is available in ASP.NET Core and Blazor Server, but is disc\", \"ouraged from use in favor of storing \\ndata in a data repository appropriately. Session state is also\", \" not functional if visitors decline the use \\nHTTP cookies in your application due to privacy concern\", \"s.\\nConfiguration for ASP.NET Core and Session state is available in the Session and state management\", \" in \\nASP.NET Core article.\\nApplication state\\nThe Application object in the Web Forms framework provi\", \"des a massive, cross-request repository for \\ninteracting with application-scope configuration and st\", \"ate. Application state was an ideal place to \\nstore various application configuration properties tha\", \"t would be referenced by all requests, regardless \\nof the user making the request. The problem with \", \"the Application object was that data didn\\u2019t persist \\nacross multiple servers. The state of the appli\", \"cation object was lost between restarts.\\nAs with Session, it\\u2019s recommended that data move to a persi\", \"stent backing store that could be \\naccessed by multiple server instances. If there is volatile data \", \"that you would like to be able to access \\nacross requests and users, you could easily store it in a \", \"singleton service that can be injected into \\ncomponents that require this information or interaction\", \".\\nThe construction of an object to maintain application state and its consumption could resemble the\", \" \\nfollowing implementation:\\npublic class MyApplicationState\\n{\\n public int VisitorCounter { get; priv\", \"ate set; } = 0;\\n public void IncrementCounter() => VisitorCounter += 1;\\n}48 CHAPTER 8 | State manage\", \"ment\\napp.AddSingleton<MyApplicationState>();\\n@inject MyApplicationState AppState\\n<label>Total Visito\", \"rs: @AppState.VisitorCounter</label>\\nThe MyApplicationState object is created only once on the serve\", \"r, and the value VisitorCounter is \\nfetched and output in the component\\u2019s label. The VisitorCounter \", \"value should be persisted and \\nretrieved from a backing data store for durability and scalability.\\nI\", \"n the browser\\nApplication data can also be stored client-side on the user\\u2019s device so that is availa\", \"ble later. There are \\ntwo browser features that allow for persistence of data in different scopes of\", \" the user\\u2019s browser:\\n\\u2022 localStorage - scoped to the user\\u2019s entire browser. If the page is reloaded, \", \"the browser is \\nclosed and reopened, or another tab is opened with the same URL then the same \\nlocal\", \"Storage is provided by the browser\\n\\u2022 sessionStorage - scoped to the user\\u2019s current browser tab. If t\", \"he tab is reloaded, the state \\npersists. However, if the user opens another tab to your application \", \"or closes and reopens the \\nbrowser the state is lost.\\nYou can write some custom JavaScript code to i\", \"nteract with these features, or there are a number of \\nNuGet packages that you can use that provide \", \"this functionality. One such package is \\nMicrosoft.AspNetCore.ProtectedBrowserStorage.\\nFor instructi\", \"ons on utilizing this package to interact with localStorage and sessionStorage, see the \\nBlazor Stat\", \"e Management article.49 CHAPTER 9 | Forms and validation\\nCHAPTER 9\\nForms and validation\\nThe ASP.NET \", \"Web Forms framework includes a set of validation server controls that handle validating \\nuser input \", \"entered into a form (RequiredFieldValidator, CompareValidator, RangeValidator, and so on). \\nThe ASP.\", \"NET Web Forms framework also supports model binding and validating the model based on \\ndata annotati\", \"ons ([Required], [StringLength], [Range], and so on). The validation logic can be enforced \\nboth on \", \"the server and on the client using unobtrusive JavaScript-based validation. The \\nValidationSummary s\", \"erver control is used to display a summary of the validation errors to the user.\\nBlazor supports the\", \" sharing of validation logic between both the client and the server. ASP.NET \\nprovides pre-built Jav\", \"aScript implementations of many common server validations. In many cases, the \\ndeveloper still has t\", \"o write JavaScript to fully implement their app-specific validation logic. The same \\nmodel types, da\", \"ta annotations, and validation logic can be used on both the server and client.\\nBlazor provides a se\", \"t of input components. The input components handle binding field data to a \\nmodel and validating the\", \" user input when the form is submitted.\\nInput component Rendered HTML element\\nInputCheckbox <input t\", \"ype=\\\"checkbox\\\">\\nInputDate <input type=\\\"date\\\">\\nInputNumber <input type=\\\"number\\\">\\nInputSelect <select>\", \"\\nInputText <input>\\nInputTextArea <textarea>\\nThe EditForm component wraps these input components and \", \"orchestrates the validation process \\nthrough an EditContext. When creating an EditForm, you specify \", \"what model instance to bind to using \\nthe Model parameter. Validation is typically done using data a\", \"nnotations, and it\\u2019s extensible. To \\nenable data annotation-based validation, add the DataAnnotation\", \"sValidator component as a child of \\nthe EditForm. The EditForm component provides a convenient event\", \" for handling valid \\n(OnValidSubmit) and invalid (OnInvalidSubmit) submissions. There\\u2019s also a more \", \"generic OnSubmit \\nevent that lets you trigger and handle the validation yourself.\\nTo display a valid\", \"ation error summary, use the ValidationSummary component. To display validation \\nmessages for a spec\", \"ific input field, use the ValidationMessage component, specifying a lambda \\nexpression for the For p\", \"arameter that points to the appropriate model member.\\nThe following model type defines several valid\", \"ation rules using data annotations:50 CHAPTER 9 | Forms and validation\\nusing System;\\nusing System.Co\", \"mponentModel.DataAnnotations;\\npublic class Starship\\n{\\n [Required]\\n [StringLength(16,\\n ErrorMessage =\", \" \\\"Identifier too long (16 character limit).\\\")]\\n public string Identifier { get; set; }\\n public strin\", \"g Description { get; set; }\\n [Required]\\n public string Classification { get; set; }\\n [Range(1, 10000\", \"0,\\n ErrorMessage = \\\"Accommodation invalid (1-100000).\\\")]\\n public int MaximumAccommodation { get; set\", \"; }\\n [Required]\\n [Range(typeof(bool), \\\"true\\\", \\\"true\\\",\\n ErrorMessage = \\\"This form disallows unapprove\", \"d ships.\\\")]\\n public bool IsValidatedDesign { get; set; }\\n [Required]\\n public DateTime ProductionDate\", \" { get; set; }\\n}\\nThe following component demonstrates building a form in Blazor based on the Starshi\", \"p model type:\\n<h1>New Ship Entry Form</h1>\\n<EditForm Model=\\\"@starship\\\" OnValidSubmit=\\\"@HandleValidSu\", \"bmit\\\">\\n <DataAnnotationsValidator />\\n <ValidationSummary />\\n <p>\\n <label for=\\\"identifier\\\">Identifier\", \": </label>\\n <InputText id=\\\"identifier\\\" @bind-Value=\\\"starship.Identifier\\\" />\\n <ValidationMessage For=\", \"\\\"() => starship.Identifier\\\" />\\n </p>\\n <p>\\n <label for=\\\"description\\\">Description (optional): </label>\", \"\\n <InputTextArea id=\\\"description\\\" @bind-Value=\\\"starship.Description\\\" />\\n </p>\\n <p>\\n <label for=\\\"clas\", \"sification\\\">Primary Classification: </label>\\n <InputSelect id=\\\"classification\\\" @bind-Value=\\\"starship\", \".Classification\\\">\\n <option value=\\\"\\\">Select classification ...</option>\\n <option value=\\\"Exploration\\\">\", \"Exploration</option>\\n <option value=\\\"Diplomacy\\\">Diplomacy</option>\\n <option value=\\\"Defense\\\">Defense<\", \"/option>\\n </InputSelect>\\n <ValidationMessage For=\\\"() => starship.Classification\\\" />\\n </p>\\n <p>\\n <lab\", \"el for=\\\"accommodation\\\">Maximum Accommodation: </label>\\n <InputNumber id=\\\"accommodation\\\" @bind-Value=\", \"\\\"starship.MaximumAccommodation\\\" />\\n <ValidationMessage For=\\\"() => starship.MaximumAccommodation\\\" />\\n\", \" </p>51 CHAPTER 9 | Forms and validation\\n <p>\\n <label for=\\\"valid\\\">Engineering Approval: </label>\\n <I\", \"nputCheckbox id=\\\"valid\\\" @bind-Value=\\\"starship.IsValidatedDesign\\\" />\\n <ValidationMessage For=\\\"() => s\", \"tarship.IsValidatedDesign\\\" />\\n </p>\\n <p>\\n <label for=\\\"productionDate\\\">Production Date: </label>\\n <In\", \"putDate id=\\\"productionDate\\\" @bind-Value=\\\"starship.ProductionDate\\\" />\\n <ValidationMessage For=\\\"() => \", \"starship.ProductionDate\\\" />\\n </p>\\n <button type=\\\"submit\\\">Submit</button>\\n</EditForm>\\n@code {\\n privat\", \"e Starship starship = new Starship();\\n private void HandleValidSubmit()\\n {\\n // Save the data\\n }\\n}\\nAf\", \"ter the form submission, the model-bound data hasn\\u2019t been saved to any data store, like a \\ndatabase.\", \" In a Blazor WebAssembly app, the data must be sent to the server. For example, using an \\nHTTP POST \", \"request. In a Blazor Server app, the data is already on the server, but it must be persisted. \\nHandl\", \"ing data access in Blazor apps is the subject of the Dealing with data section.\\nAdditional resources\", \"\\nFor more information on forms and validation in Blazor apps, see the Blazor documentation.52 CHAPTE\", \"R 10 | Work with data\\nCHAPTER 10\\nWork with data\\nData access is the backbone of an ASP.NET Web Forms \", \"app. If you\\u2019re building forms for the web, what \\nhappens to that data? With Web Forms, there were mu\", \"ltiple data access techniques you could use to \\ninteract with a database:\\n\\u2022 Data Sources\\n\\u2022 ADO.NET\\n\\u2022\", \" Entity Framework\\nData Sources were controls that you could place on a Web Forms page and configure \", \"like other \\ncontrols. Visual Studio provided a friendly set of dialogs to configure and bind the con\", \"trols to your \\nWeb Forms pages. Developers who enjoy a \\u201clow code\\u201d or \\u201cno code\\u201d approach preferred th\", \"is \\ntechnique when Web Forms was first released.\\nADO.NET is the low-level approach to interacting wi\", \"th a database. Your apps could create a \\nconnection to the database with Commands, Datatables, and D\", \"atasets for interacting. The results \\ncould then be bound to fields on screen without much code. The\", \" drawback of this approach was that \\neach set of ADO.NET objects (Connection, Command, and DataTable\", \") was bound to libraries provided \\nby a database vendor. Use of these components made the code rigid\", \" and difficult to migrate to a \\ndifferent database.\\nEntity Framework\\nEntity Framework (EF) is the op\", \"en source object-relational mapping framework maintained by the \\n.NET Foundation. Initially released\", \" with .NET Framework, EF allows for generating code for the \\ndatabase connections, storage schemas, \", \"and interactions. With this abstraction, you can focus on your 53 CHAPTER 10 | Work with data\\napp\\u2019s \", \"business rules and allow the database to be managed by a trusted database administrator. In \\n.NET, y\", \"ou can use an updated version of EF called EF Core. EF Core helps generate and maintain the \\ninterac\", \"tions between your code and the database with a series of commands that are available for you \\nusing\", \" the dotnet ef command-line tool. Let\\u2019s take a look at a few samples to get you working with a \\ndata\", \"base.\\nEF Code First\\nA quick way to get started building your database interactions is to start with \", \"the class objects you \\nwant to work with. EF provides a tool to help generate the appropriate databa\", \"se code for your classes. \\nThis approach is called \\u201cCode First\\u201d development. Consider the following \", \"Product class for a sample \\nstorefront app that we want to store in a relational database like Micro\", \"soft SQL Server.\\npublic class Product\\n{\\n public int Id { get; set; }\\n [Required]\\n public string Name\", \" { get; set; }\\n [MaxLength(4000)]\\n public string Description { get; set; }\\n [Range(0, 99999,99)]\\n [D\", \"ataType(DataType.Currency)]\\n public decimal Price { get; set; }\\n}\\nProduct has a primary key and thre\", \"e additional fields that would be created in our database:\\n\\u2022 EF will identify the Id property as a p\", \"rimary key by convention.\\n\\u2022 Name will be stored in a column configured for text storage. The [Requir\", \"ed] attribute \\ndecorating this property will add a not null constraint to help enforce this declared\", \" behavior \\nof the property.\\n\\u2022 Description will be stored in a column configured for text storage, an\", \"d have a maximum \\nlength configured of 4000 characters as dictated by the [MaxLength] attribute. The\", \" database \\nschema will be configured with a column named MaxLength using data type varchar(4000).\\n\\u2022 \", \"The Price property will be stored as currency. The [Range] attribute will generate appropriate \\ncons\", \"traints to prevent data storage outside of the minimum and maximum values declared.\\nWe need to add t\", \"his Product class to a database context class that defines the connection and \\ntranslation operation\", \"s with our database.\\npublic class MyDbContext : DbContext\\n{\\n public DbSet<Product> Products { get; s\", \"et; }\\n}\\nThe MyDbContext class provides the one property that defines the access and translation for \", \"the \\nProduct class. Your application configures this class for interaction with the database using t\", \"he \\nfollowing entries in the Startup class\\u2019s ConfigureServices method (or appropriate location in \\nP\", \"rogram.cs using the builder.Services property instead of services):54 CHAPTER 10 | Work with data\\nse\", \"rvices.AddDbContext<MyDbContext>(options =>\\n options.UseSqlServer(\\\"MY DATABASE CONNECTION STRING\\\"));\", \"\\nThe preceding code will connect to a SQL Server database with the specified connection string. You \", \"\\ncan place the connection string in your appsettings.json file, environment variables, or other \\ncon\", \"figuration storage locations and replace this embedded string appropriately.\\nYou can then generate t\", \"he database table appropriate for this class using the following commands:\\ndotnet ef migrations add \", \"'Create Product table'\\ndotnet ef database update\\nThe first command defines the changes you\\u2019re making\", \" to the database schema as a new EF Migration \\ncalled Create Product table. A Migration defines how \", \"to apply and remove your new database \\nchanges.\\nOnce applied, you have a simple Product table in you\", \"r database and some new classes added to the \\nproject that help manage the database schema. You can \", \"find these generated classes, by default, in a \\nnew folder called Migrations. When you make changes \", \"to the Product class or add more related \\nclasses you would like interacting with your database, you\", \" need to run the command-line commands \\nagain with a new name of the migration. This command will ge\", \"nerate another set of migration classes \\nto update your database schema.\\nEF Database First\\nFor exist\", \"ing databases, you can generate the classes for EF Core by using the .NET command-line \\ntools. To sc\", \"affold the classes, use a variation of the following command:\\ndotnet ef dbcontext scaffold \\\"CONNECTI\", \"ON STRING\\\" Microsoft.EntityFrameworkCore.SqlServer -c \\nMyDbContext -t Product -t Customer\\nThe preced\", \"ing command connects to the database using the specified connection string and the \\nMicrosoft.Entity\", \"FrameworkCore.SqlServer provider. Once connected, a database context class named \\nMyDbContext is cre\", \"ated. Additionally, supporting classes are created for the Product and Customer \\ntables that were sp\", \"ecified with the -t options. There are many configuration options for this command \\nto generate the \", \"class hierarchy appropriate for your database. For a complete reference, see the \\ncommand\\u2019s document\", \"ation.\\nMore information about EF Core can be found on the Microsoft Docs site.\\nInteract with web ser\", \"vices\\nWhen ASP.NET was first released, SOAP services were the preferred way for web servers and clie\", \"nts to \\nexchange data. Much has changed since that time, and the preferred interactions with service\", \"s have \\nshifted to direct HTTP client interactions. With ASP.NET Core and Blazor, you can register t\", \"he \\nconfiguration of your HttpClient in Program.cs or in the Startup class\\u2019s ConfigureServices metho\", \"d. Use \\nthat configuration when you need to interact with the HTTP endpoint. Consider the following \", \"\\nconfiguration code:55 CHAPTER 10 | Work with data\\n// in Program.cs\\nbuilder.Services.AddHttpClient(\\\"\", \"github\\\", client =>\\n{\\n client.BaseAddress = new Uri(\\\"http://api.github.com/\\\");\\n // Github API version\", \"ing\\n client.DefaultRequestHeaders.Add(\\\"Accept\\\", \\\"application/vnd.github.v3+json\\\");\\n // Github requir\", \"es a user-agent\\n client.DefaultRequestHeaders.Add(\\\"User-Agent\\\", \\\"BlazorWebForms-Sample\\\");\\n});\\nWhenev\", \"er you need to access data from GitHub, create a client with a name of github. The client is \\nconfig\", \"ured with the base address, and the request headers are set appropriately. Inject the \\nIHttpClientFa\", \"ctory into your Blazor components with the @inject directive or an [Inject] attribute on a \\nproperty\", \". Create your named client and interact with services using the following syntax:\\n@inject IHttpClien\", \"tFactory factory\\n...\\n@code {\\n protected override async Task OnInitializedAsync()\\n {\\n var client = fa\", \"ctory.CreateClient(\\\"github\\\");\\n var response = await client.GetAsync(\\\"repos/dotnet/docs/issues\\\");\\n re\", \"sponse.EnsureStatusCode();\\n var content = await response.Content.ReadAsStringAsync();\\n }\\n}\\nThis meth\", \"od returns the string describing the collection of issues in the dotnet/docs GitHub repository. \\nIt \", \"returns content in JSON format and is deserialized into appropriate GitHub issue objects. There are \", \"\\nmany ways that you can configure the HttpClientFactory to deliver preconfigured HttpClient objects.\", \" \\nTry configuring multiple HttpClient instances with different names and endpoints for the various w\", \"eb \\nservices you work with. This approach will make your interactions with those services easier to \", \"work \\nwith on each page. For more information, see Make HTTP requests using IHttpClientFactory.56 CH\", \"APTER 11 | Modules, handlers, and middleware\\nCHAPTER 11\\nModules, handlers, and \\nmiddleware\\nAn ASP.NE\", \"T Core app is built upon a series of middleware. Middleware is handlers that are arranged \\ninto a pi\", \"peline to handle requests and responses. In a Web Forms app, HTTP handlers and modules \\nsolve simila\", \"r problems. In ASP.NET Core, modules, handlers, Global.asax.cs, and the app life cycle are \\nreplaced\", \" with middleware. In this chapter, you\\u2019ll learn about middleware in the context of a Blazor \\napp.\\nOv\", \"erview\\nThe ASP.NET Core request pipeline consists of a sequence of request delegates, called one aft\", \"er the \\nother. The following diagram demonstrates the concept. The thread of execution follows the b\", \"lack \\narrows.57 CHAPTER 11 | Modules, handlers, and middleware\\nThe preceding diagram lacks a concept\", \" of lifecycle events. This concept is foundational to how \\nASP.NET Web Forms requests are handled. T\", \"his system makes it easier to reason about what process \\nis occurring and allows middleware to be in\", \"serted at any point. Middleware executes in the order in \\nwhich it\\u2019s added to the request pipeline. \", \"They\\u2019re also added in code instead of configuration files, \\nusually in Startup.cs.\\nKatana\\nReaders fa\", \"miliar with Katana will feel comfortable in ASP.NET Core. In fact, Katana is a framework from \\nwhich\", \" ASP.NET Core derives. It introduced similar middleware and pipeline patterns for ASP.NET 4.x. \\nMidd\", \"leware designed for Katana can be adapted to work with the ASP.NET Core pipeline.\\nCommon middleware\\n\", \"ASP.NET 4.x includes many modules. In a similar fashion, ASP.NET Core has many middleware \\ncomponent\", \"s available as well. IIS modules may be used in some cases with ASP.NET Core. In other \\ncases, nativ\", \"e ASP.NET Core middleware may be available.\\nThe following table lists replacement middleware and com\", \"ponents in ASP.NET Core.\\nModule ASP.NET 4.x module ASP.NET Core option\\nHTTP errors CustomErrorModule\", \" Status Code Pages \\nMiddleware58 CHAPTER 11 | Modules, handlers, and middleware\\nModule ASP.NET 4.x m\", \"odule ASP.NET Core option\\nDefault document DefaultDocumentModule Default Files Middleware\\nDirectory \", \"browsing DirectoryListingModule Directory Browsing \\nMiddleware\\nDynamic compression DynamicCompressio\", \"nModule Response Compression \\nMiddleware\\nFailed requests tracing FailedRequestsTracingModule ASP.NET\", \" Core Logging\\nFile caching FileCacheModule Response Caching \\nMiddleware\\nHTTP caching HttpCacheModule\", \" Response Caching \\nMiddleware\\nHTTP logging HttpLoggingModule ASP.NET Core Logging\\nHTTP redirection H\", \"ttpRedirectionModule URL Rewriting \\nMiddleware\\nISAPI filters IsapiFilterModule Middleware\\nISAPI Isap\", \"iModule Middleware\\nRequest filtering RequestFilteringModule URL Rewriting \\nMiddleware IRule\\nURL rewr\", \"iting\\u2020 RewriteModule URL Rewriting \\nMiddleware\\nStatic compression StaticCompressionModule Response C\", \"ompression \\nMiddleware\\nStatic content StaticFileModule Static File Middleware\\nURL authorization UrlA\", \"uthorizationModule ASP.NET Core Identity\\nThis list isn\\u2019t exhaustive but should give an idea of what \", \"mapping exists between the two frameworks. \\nFor a more detailed list, see IIS modules with ASP.NET C\", \"ore.\\nCustom middleware\\nBuilt-in middleware may not handle all scenarios needed for an app. In such c\", \"ases, it makes sense to \\ncreate your own middleware. There are multiple ways of defining middleware,\", \" with the simplest being \\na simple delegate. Consider the following middleware, which accepts a cult\", \"ure request from a query \\nstring:\\npublic class Startup\\n{\\n public void Configure(IApplicationBuilder \", \"app)\\n {\\n app.Use(async (context, next) =>\\n {\\n var cultureQuery = context.Request.Query[\\\"culture\\\"];59\", \" CHAPTER 11 | Modules, handlers, and middleware\\n if (!string.IsNullOrWhiteSpace(cultureQuery))\\n {\\n v\", \"ar culture = new CultureInfo(cultureQuery);\\n CultureInfo.CurrentCulture = culture;\\n CultureInfo.Curr\", \"entUICulture = culture;\\n }\\n // Call the next delegate/middleware in the pipeline\\n await next();\\n });\", \"\\n app.Run(async (context) =>\\n await context.Response.WriteAsync(\\n $\\\"Hello {CultureInfo.CurrentCultur\", \"e.DisplayName}\\\"));\\n }\\n}\\nMiddleware can also be defined as class, either by implementing the IMiddlew\", \"are interface or by \\nfollowing middleware convention. For more information, see Write custom ASP.NET\", \" Core middleware.60 CHAPTER 12 | App configuration\\nCHAPTER 12\\nApp configuration\\nThe primary way to l\", \"oad app configuration in Web Forms is with entries in the web.config file\\u2014either \\non the server or a\", \" related configuration file referenced by web.config. You can use the static \\nConfigurationManager o\", \"bject to interact with app settings, data repository connection strings, and \\nother extended configu\", \"ration providers that are added into the app. It\\u2019s typical to see interactions \\nwith app configurati\", \"on as seen in the following code:\\nvar configurationValue = ConfigurationManager.AppSettings[\\\"Configu\", \"rationSettingName\\\"];\\nvar connectionString =\\nConfigurationManager.ConnectionStrings[\\\"MyDatabaseConnec\", \"tionName\\\"].ConnectionString;\\nWith ASP.NET Core and server-side Blazor, the web.config file MAY be pr\", \"esent if your app is hosted on \\na Windows IIS server. However, there\\u2019s no ConfigurationManager inter\", \"action with this configuration, \\nand you can receive more structured app configuration from other so\", \"urces. Let\\u2019s take a look at how \\nconfiguration is gathered and how you can still access configuratio\", \"n information from a web.config\\nfile.\\nConfiguration sources\\nASP.NET Core recognizes there are many c\", \"onfiguration sources you may want to use for your app. The \\nframework attempts to offer you the best\", \" of these features by default. Configuration is read and \\naggregated from these various sources by A\", \"SP.NET Core. Later loaded values for the same \\nconfiguration key take precedence over earlier values\", \".\\nASP.NET Core was designed to be cloud-aware and to make the configuration of apps easier for both \", \"\\noperators and developers. ASP.NET Core is environment-aware and knows if it\\u2019s running in your \\nProd\", \"uction or Development environment. The environment indicator is set in the \\nASPNETCORE_ENVIRONMENT s\", \"ystem environment variable. If no value is configured, the app defaults \\nto running in the Productio\", \"n environment.\\nYour app can trigger and add configuration from several sources based on the environm\", \"ent\\u2019s name. \\nBy default, the configuration is loaded from the following resources in the order liste\", \"d:\\n1. appsettings.json file, if present\\n2. appsettings.{ENVIRONMENT_NAME}.json file, if present\\n3. U\", \"ser secrets file on disk, if present\\n4. Environment variables\\n5. Command-line arguments61 CHAPTER 12\", \" | App configuration\\nappsettings.json format and access\\nThe appsettings.json file can be hierarchica\", \"l with values structured like the following JSON:\\n{\\n \\\"section0\\\": {\\n \\\"key0\\\": \\\"value\\\",\\n \\\"key1\\\": \\\"value\", \"\\\"\\n },\\n \\\"section1\\\": {\\n \\\"key0\\\": \\\"value\\\",\\n \\\"key1\\\": \\\"value\\\"\\n }\\n}\\nWhen presented with the preceding JSON,\", \" the configuration system flattens child values and \\nreferences their fully qualified hierarchical p\", \"aths. A colon (:) character separates each property in the \\nhierarchy. For example, the configuratio\", \"n key section1:key0 accesses the section1 object literal\\u2019s key0 \\nvalue.\\nUser secrets\\nUser secrets ar\", \"e:\\n\\u2022 Configuration values that are stored in a JSON file on the developer\\u2019s workstation, outside of \", \"\\nthe app development folder.\\n\\u2022 Only loaded when running in the Development environment.\\n\\u2022 Associated\", \" with a specific app.\\n\\u2022 Managed with the .NET CLI\\u2019s user-secrets command.\\nConfigure your app for sec\", \"rets storage by executing the user-secrets command:\\ndotnet user-secrets init\\nThe preceding command a\", \"dds a UserSecretsId element to the project file. The element contains a \\nGUID, which is used to asso\", \"ciate secrets with the app. You can then define a secret with the set \\ncommand. For example:\\ndotnet \", \"user-secrets set \\\"Parent:ApiKey\\\" \\\"12345\\\"\\nThe preceding command makes the Parent:ApiKey configuration\", \" key available on a developer\\u2019s \\nworkstation with the value 12345.\\nFor more information about creati\", \"ng, storing, and managing user secrets, see the Safe storage of app \\nsecrets in development in ASP.N\", \"ET Core document.\\nEnvironment variables\\nThe next set of values loaded into your app configuration is\", \" the system\\u2019s environment variables. All of \\nyour system\\u2019s environment variable settings are now acc\", \"essible to you through the configuration API. 62 CHAPTER 12 | App configuration\\nHierarchical values \", \"are flattened and separated by colon characters when read inside your app. \\nHowever, some operating \", \"systems don\\u2019t allow the colon character environment variable names. \\nASP.NET Core addresses this lim\", \"itation by converting values that have double-underscores (__) into a \\ncolon when they\\u2019re accessed. \", \"The Parent:ApiKey value from the user secrets section above can be \\noverridden with the environment \", \"variable Parent__ApiKey.\\nCommand-line arguments\\nConfiguration can also be provided as command-line a\", \"rguments when your app is started. Use the \\ndouble-dash (--) or forward-slash (/) notation to indica\", \"te the name of the configuration value to set \\nand the value to be configured. The syntax resembles \", \"the following commands:\\ndotnet run CommandLineKey1=value1 --CommandLineKey2=value2 /CommandLineKey3=\", \"value3\\ndotnet run --CommandLineKey1 value1 /CommandLineKey2 value2\\ndotnet run Parent:ApiKey=67890\\nTh\", \"e return of web.config\\nIf you\\u2019ve deployed your app to Windows on IIS, the web.config file still conf\", \"igures IIS to manage your \\napp. By default, IIS adds a reference to the ASP.NET Core Module (ANCM). \", \"ANCM is a native IIS \\nmodule that hosts your app in place of the Kestrel web server. This web.config\", \" section resembles the \\nfollowing XML markup:\\n<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<configuration>\", \"\\n <location path=\\\".\\\" inheritInChildApplications=\\\"false\\\">\\n <system.webServer>\\n <handlers>\\n <add name=\", \"\\\"aspNetCore\\\" path=\\\"*\\\" verb=\\\"*\\\" modules=\\\"AspNetCoreModuleV2\\\"\\nresourceType=\\\"Unspecified\\\" />\\n </handler\", \"s>\\n <aspNetCore processPath=\\\".\\\\MyApp.exe\\\"\\n stdoutLogEnabled=\\\"false\\\"\\n stdoutLogFile=\\\".\\\\logs\\\\stdout\\\"\\n \", \"hostingModel=\\\"inprocess\\\" />\\n </system.webServer>\\n </location>\\n</configuration>\\nApp-specific configur\", \"ation can be defined by nesting an environmentVariables element in the \\naspNetCore element. The valu\", \"es defined in this section are presented to the ASP.NET Core app as \\nenvironment variables. The envi\", \"ronment variables load appropriately during that segment of app \\nstartup.\\n<aspNetCore processPath=\\\"d\", \"otnet\\\"\\n arguments=\\\".\\\\MyApp.dll\\\"\\n stdoutLogEnabled=\\\"false\\\"\\n stdoutLogFile=\\\".\\\\logs\\\\stdout\\\"\\n hostingMod\", \"el=\\\"inprocess\\\">\\n <environmentVariables>\\n <environmentVariable name=\\\"ASPNETCORE_ENVIRONMENT\\\" value=\\\"D\", \"evelopment\\\" />63 CHAPTER 12 | App configuration\\n <environmentVariable name=\\\"Parent:ApiKey\\\" value=\\\"67\", \"890\\\" />\\n </environmentVariables>\\n</aspNetCore>\\nRead configuration in the app\\nASP.NET Core provides a\", \"pp configuration through the IConfiguration interface. This configuration \\ninterface should be reque\", \"sted by your Blazor components, Blazor pages, and any other ASP.NET Core\\u0002managed class that needs ac\", \"cess to configuration. The ASP.NET Core framework will automatically \\npopulate this interface with t\", \"he resolved configuration configured earlier. On a Blazor page or a \\ncomponent\\u2019s Razor markup, you c\", \"an inject the IConfiguration object with an @inject directive at the \\ntop of the .razor file like th\", \"is:\\n@inject IConfiguration Configuration\\nThis preceding statement makes the IConfiguration object av\", \"ailable as the Configuration variable \\nthroughout the rest of the Razor template.\\nIndividual configu\", \"ration settings can be read by specifying the configuration setting hierarchy sought \\nas an indexer \", \"parameter:\\nvar mySetting = Configuration[\\\"section1:key0\\\"];\\nYou can fetch entire configuration sectio\", \"ns by using the GetSection method to retrieve a collection of \\nkeys at a specific location with a sy\", \"ntax similar to GetSection(\\\"section1\\\") to retrieve the configuration \\nfor section1 from the earlier \", \"example.\\nStrongly typed configuration\\nWith Web Forms, it was possible to create a strongly typed con\", \"figuration type that inherited from the \\nConfigurationSection type and associated types. A Configura\", \"tionSection allowed you to configure \\nsome business rules and processing for those configuration val\", \"ues.\\nIn ASP.NET Core, you can specify a class hierarchy that will receive the configuration values. \", \"These \\nclasses:\\n\\u2022 Don\\u2019t need to inherit from a parent class.\\n\\u2022 Should include public properties that\", \" match the properties and type references for the \\nconfiguration structure you wish to capture.\\nFor \", \"the earlier appsettings.json sample, you could define the following classes to capture the values:\\np\", \"ublic class MyConfig\\n{\\n public MyConfigSection section0 { get; set;}\\n public MyConfigSection section\", \"1 { get; set;}\\n}\\npublic class MyConfigSection\\n{64 CHAPTER 12 | App configuration\\n public string key0\", \" { get; set; }\\n public string key1 { get; set; }\\n}\\nThis class hierarchy can be populated by adding t\", \"he following line to the Startup.ConfigureServices \\nmethod (or appropriate location in Program.cs us\", \"ing the builder.Services property instead of services):\\nservices.Configure<MyConfig>(Configuration);\", \"\\nIn the rest of the app, you can add an input parameter to classes or an @inject directive in Razor \", \"\\ntemplates of type IOptions<MyConfig> to receive the strongly typed configuration settings. The \\nIOp\", \"tions<MyConfig>.Value property will yield the MyConfig value populated from the configuration \\nsetti\", \"ngs.\\n@inject IOptions<MyConfig> options\\n@code {\\n var MyConfiguration = options.Value;\\n var theSettin\", \"g = MyConfiguration.section1.key0;\\n}\\nMore information about the Options feature can be found in the \", \"Options pattern in ASP.NET Core\\ndocument.65 CHAPTER 13 | Security: Authentication and Authorization \", \"in ASP.NET Web Forms and Blazor\\nCHAPTER 13\\nSecurity: Authentication \\nand Authorization in \\nASP.NET W\", \"eb Forms and \\nBlazor\\nMigrating from an ASP.NET Web Forms application to Blazor will almost certainly\", \" require updating \\nhow authentication and authorization are performed, assuming the application had \", \"authentication \\nconfigured. This chapter will cover how to migrate from the ASP.NET Web Forms univer\", \"sal provider \\nmodel (for membership, roles, and user profiles) and how to work with ASP.NET Core Ide\", \"ntity from \\nBlazor apps. While this chapter will cover the high-level steps and considerations, the \", \"detailed steps \\nand scripts may be found in the referenced documentation.\\nASP.NET universal provider\", \"s\\nSince ASP.NET 2.0, the ASP.NET Web Forms platform has supported a provider model for a variety of \", \"\\nfeatures, including membership. The universal membership provider, along with the optional role \\npr\", \"ovider, is commonly deployed with ASP.NET Web Forms applications. It offers a robust and secure \\nway\", \" to manage authentication and authorization that continues to work well today. The most recent \\noffe\", \"ring of these universal providers is available as a NuGet package, Microsoft.AspNet.Providers.\\nThe U\", \"niversal Providers work with a SQL database schema that includes tables like \\naspnet_Applications, a\", \"spnet_Membership, aspnet_Roles, and aspnet_Users. When configured by \\nrunning the aspnet_regsql.exe \", \"command, the providers install tables and stored procedures that \\nprovide all of the necessary queri\", \"es and commands to work with the underlying data. The database \\nschema and these stored procedures a\", \"re not compatible with newer ASP.NET Identity and ASP.NET \\nCore Identity systems, so existing data m\", \"ust be migrated into the new system. Figure 1 shows an \\nexample table schema configured for universa\", \"l providers.66 CHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blaz\", \"or\\nThe universal provider handles users, membership, roles, and profiles. Users are assigned globall\", \"y \\nunique identifiers and basic information like userId, userName etc. are stored in the aspnet_User\", \"s \\ntable. Authentication information, such as password, password format, password salt, lockout coun\", \"ters \\nand details, etc. are stored in the aspnet_Membership table. Roles consist simply of names and\", \" unique \\nidentifiers, which are assigned to users via the aspnet_UsersInRoles association table, pro\", \"viding a \\nmany-to-many relationship.\\nIf your existing system is using roles in addition to membershi\", \"p, you will need to migrate the user \\naccounts, the associated passwords, the roles, and the role me\", \"mbership into ASP.NET Core Identity. \\nYou will also most likely need to update your code where you\\u2019r\", \"e currently performing role checks \\nusing if statements to instead leverage declarative filters, att\", \"ributes, and/or tag helpers. We will review \\nmigration considerations in greater detail at the end o\", \"f this chapter.\\nAuthorization configuration in Web Forms\\nTo configure authorized access to certain p\", \"ages in an ASP.NET Web Forms application, typically you \\nspecify that certain pages or folders are i\", \"naccessible to anonymous users. This configuration is done in \\nthe web.config file:\\n<?xml version=\\\"1\", \".0\\\"?>\\n<configuration>\\n <system.web>\\n <authentication mode=\\\"Forms\\\">\\n <forms defaultUrl=\\\"~/home.aspx\\\" \", \"loginUrl=\\\"~/login.aspx\\\"\\n slidingExpiration=\\\"true\\\" timeout=\\\"2880\\\"></forms>\\n </authentication>\\n <autho\", \"rization>\\n <deny users=\\\"?\\\" />\\n </authorization>\\n </system.web>\\n</configuration>\\nThe authentication c\", \"onfiguration section sets up the forms authentication for the application. The \\nauthorization sectio\", \"n is used to disallow anonymous users for the entire application. However, you \\ncan provide more gra\", \"nular authorization rules on a per-location basis as well as apply role-based \\nauthorization checks.\", \"\\n<location path=\\\"login.aspx\\\">\\n <system.web>67 CHAPTER 13 | Security: Authentication and Authorizatio\", \"n in ASP.NET Web Forms and Blazor\\n <authorization>\\n <allow users=\\\"*\\\" />\\n </authorization>\\n </system.\", \"web>\\n</location>\\nThe above configuration, when combined with the first one, would allow anonymous us\", \"ers to access \\nthe login page, overriding the site-wide restriction on non-authenticated users.\\n<loc\", \"ation path=\\\"/admin\\\">\\n <system.web>\\n <authorization>\\n <allow roles=\\\"Administrators\\\" />\\n <deny users=\\\"\", \"*\\\" />\\n </authorization>\\n </system.web>\\n</location>\\nThe above configuration, when combined with the o\", \"thers, restricts access to the /admin folder and all \\nresources within it to members of the \\u201cAdminis\", \"trators\\u201d role. This restriction could also be applied by \\nplacing a separate web.config file within \", \"the /admin folder root.\\nAuthorization code in Web Forms\\nIn addition to configuring access using web.\", \"config, you can also programmatically configure access \\nand behavior in your Web Forms application. \", \"For instance, you can restrict the ability to perform \\ncertain operations or view certain data based\", \" on the user\\u2019s role.\\nThis code can be used both in code-behind logic as well as in the page itself:\\n\", \"<% if (HttpContext.Current.User.IsInRole(\\\"Administrators\\\")) { %>\\n <a href=\\\"/admin\\\">Go To Admin</a>\\n<\", \"% } %>\\nIn addition to checking user role membership, you can also determine if they are authenticate\", \"d \\n(though often this is better done using the location-based configuration covered above). Below is\", \" an \\nexample of this approach.\\nprotected void Page_Load(object sender, EventArgs e)\\n{\\n if (!User.Ide\", \"ntity.IsAuthenticated)\\n {\\n FormsAuthentication.RedirectToLoginPage();\\n }\\n if (!Roles.IsUserInRole(Us\", \"er.Identity.Name, \\\"Administrators\\\"))\\n {\\n MessageLabel.Text = \\\"Only administrators can view this.\\\";\\n \", \"SecretPanel.Visible = false;\\n }\\n}\\nIn the code above, role-based access control (RBAC) is used to det\", \"ermine whether certain elements of \\nthe page, such as a SecretPanel, are visible based on the curren\", \"t user\\u2019s role.68 CHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Bl\", \"azor\\nTypically, ASP.NET Web Forms applications configure security within the web.config file and the\", \"n add \\nadditional checks where needed in .aspx pages and their related .aspx.cs code-behind files. M\", \"ost \\napplications leverage the universal membership provider, frequently with the additional role pr\", \"ovider.\\nASP.NET Core Identity\\nAlthough still tasked with authentication and authorization, ASP.NET C\", \"ore Identity uses a different set \\nof abstractions and assumptions when compared to the universal pr\", \"oviders. For example, the new \\nIdentity model supports third party authentication, allowing users to\", \" authenticate using a social media \\naccount or other trusted authentication provider. ASP.NET Core I\", \"dentity supports UI for commonly \\nneeded pages like login, logout, and register. It leverages EF Cor\", \"e for its data access, and uses EF Core \\nmigrations to generate the necessary schema required to sup\", \"port its data model. This introduction to \\nIdentity on ASP.NET Core provides a good overview of what\", \" is included with ASP.NET Core Identity \\nand how to get started working with it. If you haven\\u2019t alre\", \"ady set up ASP.NET Core Identity in your \\napplication and its database, it will help you get started\", \".\\nRoles, claims, and policies\\nBoth the universal providers and ASP.NET Core Identity support the con\", \"cept of roles. You can create \\nroles for users and assign users to roles. Users can belong to any nu\", \"mber of roles, and you can verify \\nrole membership as part of your authorization implementation.\\nIn \", \"addition to roles, ASP.NET Core identity supports the concepts of claims and policies. While a role \", \"\\nshould specifically correspond to a set of resources a user in that role should be able to access, \", \"a \\nclaim is simply part of a user\\u2019s identity. A claim is a name value pair that represents what the \", \"subject \\nis, not what the subject can do.\\nIt is possible to directly inspect a user\\u2019s claims and det\", \"ermine based on these values whether a user \\nshould be given access to a resource. However, such che\", \"cks are often repetitive and scattered \\nthroughout the system. A better approach is to define a poli\", \"cy.\\nAn authorization policy consists of one or more requirements. Policies are registered as part of\", \" the \\nauthorization service configuration in the ConfigureServices method of Startup.cs. For example\", \", the \\nfollowing code snippet configures a policy called \\u201cCanadiansOnly\\u201d, which has the requirement \", \"that the \\nuser has the Country claim with the value of \\u201cCanada\\u201d.\\nservices.AddAuthorization(options =\", \">\\n{\\n options.AddPolicy(\\\"CanadiansOnly\\\", policy => policy.RequireClaim(ClaimTypes.Country,\\n\\\"Canada\\\"))\", \";\\n});\\nYou can learn more about how to create custom policies in the documentation.\\nWhether you\\u2019re us\", \"ing policies or roles, you can specify that a particular page in your Blazor \\napplication requires t\", \"hat role or policy with the [Authorize] attribute, applied with the @attribute \\ndirective.\\nRequiring\", \" a role:69 CHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n@\", \"attribute [Authorize(Roles =\\\"administrators\\\")]\\nRequiring a policy be satisfied:\\n@attribute [Authoriz\", \"e(Policy =\\\"CanadiansOnly\\\")]\\nIf you need access to a user\\u2019s authentication state, roles, or claims in\", \" your code, there are two primary \\nways to achieve this functionality. The first is to receive the a\", \"uthentication state as a cascading \\nparameter. The second is to access the state using an injected A\", \"uthenticationStateProvider. The \\ndetails of each of these approaches are described in the Blazor Sec\", \"urity documentation.\\nThe following code shows how to receive the AuthenticationState as a cascading \", \"parameter:\\n[CascadingParameter]\\nprivate Task<AuthenticationState> authenticationStateTask { get; set\", \"; }\\nWith this parameter in place, you can get the user using this code:\\nvar authState = await authen\", \"ticationStateTask;\\nvar user = authState.User;\\nThe following code shows how to inject the Authenticat\", \"ionStateProvider:\\n@using Microsoft.AspNetCore.Components.Authorization\\n@inject AuthenticationStatePr\", \"ovider AuthenticationStateProvider\\nWith the provider in place, you can gain access to the user with \", \"the following code:\\nAuthenticationState authState = await \\nAuthenticationStateProvider.GetAuthentica\", \"tionStateAsync();\\nClaimsPrincipal user = authState.User;\\nif (user.Identity.IsAuthenticated)\\n{\\n // wo\", \"rk with user.Claims and/or user.Roles\\n}\\nNote: The AuthorizeView component, covered later in this cha\", \"pter, provides a declarative way to \\ncontrol what a user sees on a page or component.\\nTo work with u\", \"sers and claims (in Blazor Server applications) you may also need to inject a \\nUserManager<T> (use I\", \"dentityUser for default) which you can use to enumerate and modify claims \\nfor a user. First inject \", \"the type and assign it to a property:\\n@inject UserManager<IdentityUser> MyUserManager\\nThen use it to\", \" work with the user\\u2019s claims. The following sample shows how to add and persist a claim \\non a user:\\n\", \"private async Task AddCountryClaim()\\n{\\n var authState = await AuthenticationStateProvider.GetAuthent\", \"icationStateAsync();\\n var user = authState.User;\\n var identityUser = await MyUserManager.FindByNameA\", \"sync(user.Identity.Name);\\n if (!user.HasClaim(c => c.Type == ClaimTypes.Country))\\n {70 CHAPTER 13 | \", \"Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n // stores the claim in t\", \"he cookie\\n ClaimsIdentity id = new ClaimsIdentity();\\n id.AddClaim(new Claim(ClaimTypes.Country, \\\"Can\", \"ada\\\"));\\n user.AddIdentity(id);\\n // save the claim in the database\\n await MyUserManager.AddClaimAsync\", \"(identityUser, new Claim(ClaimTypes.Country,\\n\\\"Canada\\\"));\\n }\\n}\\nIf you need to work with roles, follow\", \" the same approach. You may need to inject a RoleManager<T> \\n(use IdentityRole for default type) to \", \"list and manage the roles themselves.\\nNote: In Blazor WebAssembly projects, you will need to provide\", \" server APIs to perform these \\noperations (instead of using UserManager<T> or RoleManager<T> directl\", \"y). A Blazor WebAssembly \\nclient application would manage claims and/or roles by securely calling AP\", \"I endpoints exposed for \\nthis purpose.\\nMigration guide\\nMigrating from ASP.NET Web Forms and universa\", \"l providers to ASP.NET Core Identity requires several \\nsteps:\\n1. Create ASP.NET Core Identity databa\", \"se schema in the destination database\\n2. Migrate data from universal provider schema to ASP.NET Core\", \" Identity schema\\n3. Migrate configuration from the web.config to middleware and services, typically \", \"in Program.cs\\n(or a Startup class)\\n4. Update individual pages using controls and conditionals to use\", \" tag helpers and new identity \\nAPIs.\\nEach of these steps is described in detail in the following sec\", \"tions.\\nCreating the ASP.NET Core Identity schema\\nThere are several ways to create the necessary tabl\", \"e structure used for ASP.NET Core Identity. The \\nsimplest is to create a new ASP.NET Core Web applic\", \"ation. Choose Web Application and then change \\nAuthentication type to use Individual Accounts.71 CHA\", \"PTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\nFrom the comman\", \"d line, you can do the same thing by running dotnet new webapp -au Individual. \\nOnce the app has bee\", \"n created, run it and register on the site. You should trigger a page like the one \\nshown below:72 C\", \"HAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\nClick on the \", \"\\u201cApply Migrations\\u201d button and the necessary database tables should be created for you. \\nIn addition,\", \" the migration files should appear in your project, as shown:73 CHAPTER 13 | Security: Authenticatio\", \"n and Authorization in ASP.NET Web Forms and Blazor\\nYou can run the migration yourself, without runn\", \"ing the web application, using this command-line \\ntool:\\ndotnet ef database update\\nIf you would rathe\", \"r run a script to apply the new schema to an existing database, you can script these \\nmigrations fro\", \"m the command-line. Run this command to generate the script:\\ndotnet ef migrations script -o auth.sql\", \"\\nThe above command will produce a SQL script in the output file auth.sql, which can then be run \\naga\", \"inst whatever database you like. If you have any trouble running dotnet ef commands, make sure \\nyou \", \"have the EF Core tools installed on your system.\\nIn the event you have additional columns on your so\", \"urce tables, you will need to identify the best \\nlocation for these columns in the new schema. Gener\", \"ally, columns found on the aspnet_Membership \\ntable should be mapped to the AspNetUsers table. Colum\", \"ns on aspnet_Roles should be mapped to \\nAspNetRoles. Any additional columns on the aspnet_UsersInRol\", \"es table would be added to the \\nAspNetUserRoles table.\\nIt\\u2019s also worth considering putting any addit\", \"ional columns on separate tables. So that future \\nmigrations won\\u2019t need to take into account such cu\", \"stomizations of the default identity schema.\\nMigrating data from universal providers to ASP.NET Core\", \" Identity\\nOnce you have the destination table schema in place, the next step is to migrate your user\", \" and role \\nrecords to the new schema. A complete list of the schema differences, including which col\", \"umns map \\nto which new columns, can be found here.74 CHAPTER 13 | Security: Authentication and Autho\", \"rization in ASP.NET Web Forms and Blazor\\nTo migrate your users from membership to the new identity t\", \"ables, you should follow the steps \\ndescribed in the documentation. After following these steps and \", \"the script provided, your users will \\nneed to change their password the next time they log in.\\nIt is\", \" possible to migrate user passwords but the process is much more involved. Requiring users to \\nupdat\", \"e their passwords as part of the migration process, and encouraging them to use new, unique \\npasswor\", \"ds, is likely to enhance the overall security of the application.\\nMigrating security settings from w\", \"eb.config to app startup\\nAs noted above, ASP.NET membership and role providers are configured in the\", \" application\\u2019s \\nweb.config file. Since ASP.NET Core apps are not tied to IIS and use a separate syst\", \"em for \\nconfiguration, these settings must be configured elsewhere. For the most part, ASP.NET Core \", \"Identity \\nis configured in the Program.cs file. Open the web project that was created earlier (to ge\", \"nerate the \\nidentity table schema) and review its Program.cs (or Startup.cs) file.\\nThis code adds su\", \"pport for EF Core and Identity:\\n// Add services to the container.\\nvar connectionString = builder.Con\", \"figuration.GetConnectionString(\\\"DefaultConnection\\\");\\nbuilder.Services.AddDbContext<ApplicationDbCont\", \"ext>(options =>\\n options.UseSqlServer(connectionString));\\nbuilder.Services.AddDatabaseDeveloperPageE\", \"xceptionFilter();\\nbuilder.Services.AddDefaultIdentity<IdentityUser>(options =>\\n options.SignIn.Requi\", \"reConfirmedAccount = true)\\n .AddEntityFrameworkStores<ApplicationDbContext>();\\nThe AddDefaultIdentit\", \"y extension method is used to configure Identity to use the default \\nApplicationDbContext and the fr\", \"amework\\u2019s IdentityUser type. If you\\u2019re using a custom IdentityUser, be \\nsure to specify its type her\", \"e. If these extension methods aren\\u2019t working in your application, check that \\nyou have the appropria\", \"te using statements and that you have the necessary NuGet package \\nreferences. For example, your pro\", \"ject should have some version of the \\nMicrosoft.AspNetCore.Identity.EntityFrameworkCore and Microsof\", \"t.AspNetCore.Identity.UI packages \\nreferenced.\\nAlso in Program.cs you should see the necessary middl\", \"eware configured for the site. Specifically, \\nUseAuthentication and UseAuthorization should be set u\", \"p, and in the proper location.\\n// Configure the HTTP request pipeline.\\nif (app.Environment.IsDevelop\", \"ment())\\n{\\n app.UseMigrationsEndPoint();\\n}\\nelse\\n{\\n app.UseExceptionHandler(\\\"/Error\\\");\\n // The default\", \" HSTS value is 30 days. You may want to change this for production \\nscenarios, see https://aka.ms/as\", \"pnetcore-hsts.\\n app.UseHsts();\\n}\\napp.UseHttpsRedirection();\\napp.UseStaticFiles();75 CHAPTER 13 | Sec\", \"urity: Authentication and Authorization in ASP.NET Web Forms and Blazor\\napp.UseRouting();\\napp.UseAut\", \"hentication();\\napp.UseAuthorization();\\n//app.MapControllers();\\napp.MapBlazorHub();\\napp.MapFallbackTo\", \"Page(\\\"/_Host\\\");\\nASP.NET Identity does not configure anonymous or role-based access to locations from\", \" Program.cs. \\nYou will need to migrate any location-specific authorization configuration data to fil\", \"ters in ASP.NET \\nCore. Make note of which folders and pages will require such updates. You will make\", \" these changes in \\nthe next section.\\nUpdating individual pages to use ASP.NET Core Identity abstract\", \"ions\\nIn your ASP.NET Web Forms application, if you had web.config settings to deny access to certain\", \" \\npages or folders to anonymous users, you would migrate these changes by adding the [Authorize] \\nat\", \"tribute to such pages:\\n@attribute [Authorize]\\nIf you further had denied access except to those users\", \" belonging to a certain role, you would likewise \\nmigrate this behavior by adding an attribute speci\", \"fying a role:\\n@attribute [Authorize(Roles =\\\"administrators\\\")]\\nThe [Authorize] attribute only works o\", \"n @page components that are reached via the Blazor Router. \\nThe attribute does not work with child c\", \"omponents, which should instead use AuthorizeView.\\nIf you have logic within page markup for determin\", \"ing whether to display some code to a certain user, \\nyou can replace this with the AuthorizeView com\", \"ponent. The AuthorizeView component selectively \\ndisplays UI depending on whether the user is author\", \"ized to see it. It also exposes a context variable \\nthat can be used to access user information.\\n<Au\", \"thorizeView>\\n <Authorized>\\n <h1>Hello, @context.User.Identity.Name!</h1>\\n <p>You can only see this c\", \"ontent if you are authenticated.</p>\\n </Authorized>\\n <NotAuthorized>\\n <h1>Authentication Failure!</h\", \"1>\\n <p>You are not signed in.</p>\\n </NotAuthorized>\\n</AuthorizeView>\\nYou can access the authenticati\", \"on state within procedural logic by accessing the user from a \\nTask<AuthenticationState configured w\", \"ith the [CascadingParameter] attribute. This configuration will \\nget you access to the user, which c\", \"an let you determine if they are authenticated and if they belong to \\na particular role. If you need\", \" to evaluate a policy procedurally, you can inject an instance of the \\nIAuthorizationService and cal\", \"ls the AuthorizeAsync method on it. The following sample code \\ndemonstrates how to get user informat\", \"ion and allow an authorized user to perform a task restricted \\nby the content-editor policy.76 CHAPT\", \"ER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n@using Microsoft.\", \"AspNetCore.Authorization\\n@inject IAuthorizationService AuthorizationService\\n<button @onclick=\\\"@DoSom\", \"ething\\\">Do something important</button>\\n@code {\\n [CascadingParameter]\\n private Task<AuthenticationSt\", \"ate> authenticationStateTask { get; set; }\\n private async Task DoSomething()\\n {\\n var user = (await a\", \"uthenticationStateTask).User;\\n if (user.Identity.IsAuthenticated)\\n {\\n // Perform an action only avai\", \"lable to authenticated (signed-in) users.\\n }\\n if (user.IsInRole(\\\"admin\\\"))\\n {\\n // Perform an action o\", \"nly available to users in the 'admin' role.\\n }\\n if ((await AuthorizationService.AuthorizeAsync(user,\", \" \\\"content-editor\\\"))\\n .Succeeded)\\n {\\n // Perform an action only available to users satisfying the\\n //\", \" 'content-editor' policy.\\n }\\n }\\n}\\nThe AuthenticationState first need to be set up as a cascading val\", \"ue before it can be bound to a \\ncascading parameter like this. That\\u2019s typically done using the Casca\", \"dingAuthenticationState \\ncomponent. This configuration is typically done in App.razor:\\n<CascadingAut\", \"henticationState>\\n <Router AppAssembly=\\\"@typeof(Program).Assembly\\\">\\n <Found Context=\\\"routeData\\\">\\n <A\", \"uthorizeRouteView RouteData=\\\"@routeData\\\"\\n DefaultLayout=\\\"@typeof(MainLayout)\\\" />\\n </Found>\\n <NotFoun\", \"d>\\n <LayoutView Layout=\\\"@typeof(MainLayout)\\\">\\n <p>Sorry, there's nothing at this address.</p>\\n </Lay\", \"outView>\\n </NotFound>\\n </Router>\\n</CascadingAuthenticationState>\\nSummary\\nBlazor uses the same securi\", \"ty model as ASP.NET Core, which is ASP.NET Core Identity. Migrating from \\nuniversal providers to ASP\", \".NET Core Identity is relatively straightforward, assuming not too much \\ncustomization was applied t\", \"o the original data schema. Once the data has been migrated, working 77 CHAPTER 13 | Security: Authe\", \"ntication and Authorization in ASP.NET Web Forms and Blazor\\nwith authentication and authorization in\", \" Blazor apps is well documented, with configurable as well as \\nprogrammatic support for most securit\", \"y requirements.\\nReferences\\n\\u2022 Introduction to Identity on ASP.NET Core\\n\\u2022 Migrate from ASP.NET Members\", \"hip authentication to ASP.NET Core 2.0 Identity\\n\\u2022 Migrate Authentication and Identity to ASP.NET Cor\", \"e\\n\\u2022 ASP.NET Core Blazor authentication and authorization78 CHAPTER 14 | Migrate from ASP.NET Web For\", \"ms to Blazor\\nCHAPTER 14\\nMigrate from ASP.NET \\nWeb Forms to Blazor\\nMigrating a code base from ASP.NET\", \" Web Forms to Blazor is a time-consuming task that requires \\nplanning. This chapter outlines the pro\", \"cess. Something that can ease the transition is to ensure the \\napp adheres to an N-tier architecture\", \", wherein the app model (in this case, Web Forms) is separate \\nfrom the business logic. This logical\", \" separation of layers makes it clear what needs to move to .NET \\nCore and Blazor.\\nFor this example, \", \"the eShop app available on GitHub is used. eShop is a catalog service that provides \\nCRUD capabiliti\", \"es via form entry and validation.\\nWhy should a working app be migrated to Blazor? Many times, there\\u2019\", \"s no need. ASP.NET Web Forms \\nwill continue to be supported for many years. However, many of the fea\", \"tures that Blazor provides are \\nonly supported on a migrated app. Such features include:\\n\\u2022 Performan\", \"ce improvements in the framework such as Span<T>\\n\\u2022 Ability to run as WebAssembly\\n\\u2022 Cross-platform su\", \"pport for Linux and macOS\\n\\u2022 App-local deployment or shared framework deployment without impacting ot\", \"her apps\\nIf these or other new features are compelling enough, there may be value in migrating the a\", \"pp. The \\nmigration can take different shapes; it can be the entire app, or only certain endpoints th\", \"at require the \\nchanges. The decision to migrate is ultimately based on the business problems to be \", \"solved by the \\ndeveloper.\\nServer-side versus client-side hosting\\nAs described in the hosting models \", \"chapter, a Blazor app can be hosted in two different ways: server\\u0002side and client-side. The server-s\", \"ide model uses ASP.NET Core SignalR connections to manage the \\nDOM updates while running any actual \", \"code on the server. The client-side model runs as \\nWebAssembly within a browser and requires no serv\", \"er connections. There are a number of differences \\nthat may affect which is best for a specific app:\", \"\\n\\u2022 Running as WebAssembly doesn\\u2019t support all features (such as threading) at the current time\\n\\u2022 Cha\", \"tty communication between the client and server may cause latency issues in server-side \\nmode79 CHAP\", \"TER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\u2022 Access to databases and internal or protected se\", \"rvices require a separate service with client\\u0002side hosting\\nAt the time of writing, the server-side m\", \"odel more closely resembles Web Forms. Most of this chapter \\nfocuses on the server-side hosting mode\", \"l, as it\\u2019s production-ready.\\nCreate a new project\\nThis initial migration step is to create a new pro\", \"ject. This project type is based on the SDK style \\nprojects of .NET and simplifies much of the boile\", \"rplate that was used in previous project formats. For \\nmore detail, please see the chapter on Projec\", \"t Structure.\\nOnce the project has been created, install the libraries that were used in the previous\", \" project. In older \\nWeb Forms projects, you may have used the packages.config file to list the requi\", \"red NuGet packages. \\nIn the new SDK-style project, packages.config has been replaced with <PackageRe\", \"ference> elements \\nin the project file. A benefit to this approach is that all dependencies are inst\", \"alled transitively. You only \\nlist the top-level dependencies you care about.\\nMany of the dependenci\", \"es you\\u2019re using are available for .NET, including Entity Framework 6 and \\nlog4net. If there\\u2019s no .NE\", \"T or .NET Standard version available, the .NET Framework version can often \\nbe used. Your mileage ma\", \"y vary. Any API used that isn\\u2019t available in .NET causes a runtime error. Visual \\nStudio notifies yo\", \"u of such packages. A yellow icon appears on the project\\u2019s References node in \\nSolution Explorer.\\nIn\", \" the Blazor-based eShop project, you can see the packages that are installed. Previously, the \\npacka\", \"ges.config file listed every package used in the project, resulting in a file almost 50 lines long. \", \"A \\nsnippet of packages.config is:\\n<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<packages>\\n ...\\n <package i\", \"d=\\\"Microsoft.ApplicationInsights.Agent.Intercept\\\" version=\\\"2.4.0\\\"\\ntargetFramework=\\\"net472\\\" />\\n <pack\", \"age id=\\\"Microsoft.ApplicationInsights.DependencyCollector\\\" version=\\\"2.9.1\\\"\\ntargetFramework=\\\"net472\\\" \", \"/>\\n <package id=\\\"Microsoft.ApplicationInsights.PerfCounterCollector\\\" version=\\\"2.9.1\\\"\\ntargetFramework\", \"=\\\"net472\\\" />\\n <package id=\\\"Microsoft.ApplicationInsights.Web\\\" version=\\\"2.9.1\\\" targetFramework=\\\"net47\", \"2\\\"\\n/>\\n <package id=\\\"Microsoft.ApplicationInsights.WindowsServer\\\" version=\\\"2.9.1\\\"\\ntargetFramework=\\\"ne\", \"t472\\\" />\\n<package id=\\\"Microsoft.ApplicationInsights.WindowsServer.TelemetryChannel\\\"\\nversion=\\\"2.9.1\\\" \", \"targetFramework=\\\"net472\\\" />\\n <package id=\\\"Microsoft.AspNet.FriendlyUrls\\\" version=\\\"1.0.2\\\" targetFrame\", \"work=\\\"net472\\\" />\\n <package id=\\\"Microsoft.AspNet.FriendlyUrls.Core\\\" version=\\\"1.0.2\\\" targetFramework=\\\"\", \"net472\\\"\\n/>\\n <package id=\\\"Microsoft.AspNet.ScriptManager.MSAjax\\\" version=\\\"5.0.0\\\"\\ntargetFramework=\\\"net\", \"472\\\" />\\n <package id=\\\"Microsoft.AspNet.ScriptManager.WebForms\\\" version=\\\"5.0.0\\\"\\ntargetFramework=\\\"net4\", \"72\\\" />\\n ...\\n <package id=\\\"System.Memory\\\" version=\\\"4.5.1\\\" targetFramework=\\\"net472\\\" />\\n <package id=\\\"S\", \"ystem.Numerics.Vectors\\\" version=\\\"4.4.0\\\" targetFramework=\\\"net472\\\" />\\n <package id=\\\"System.Runtime.Com\", \"pilerServices.Unsafe\\\" version=\\\"4.5.0\\\"80 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\ntarget\", \"Framework=\\\"net472\\\" />\\n <package id=\\\"System.Threading.Channels\\\" version=\\\"4.5.0\\\" targetFramework=\\\"net4\", \"72\\\" />\\n <package id=\\\"System.Threading.Tasks.Extensions\\\" version=\\\"4.5.1\\\" targetFramework=\\\"net472\\\"\\n/>\\n\", \" <package id=\\\"WebGrease\\\" version=\\\"1.6.0\\\" targetFramework=\\\"net472\\\" />\\n</packages>\\nThe <packages> elem\", \"ent includes all necessary dependencies. It\\u2019s difficult to identify which of these \\npackages are inc\", \"luded because you require them. Some <package> elements are listed simply to \\nsatisfy the needs of d\", \"ependencies you require.\\nThe Blazor project lists the dependencies you require within an <ItemGroup>\", \" element in the project \\nfile:\\n<ItemGroup>\\n <PackageReference Include=\\\"Autofac\\\" Version=\\\"4.9.3\\\" />\\n \", \"<PackageReference Include=\\\"EntityFramework\\\" Version=\\\"6.4.4\\\" />\\n <PackageReference Include=\\\"log4net\\\" \", \"Version=\\\"2.0.12\\\" />\\n <PackageReference Include=\\\"Microsoft.Extensions.Logging.Log4Net.AspNetCore\\\"\\nVer\", \"sion=\\\"2.2.12\\\" />\\n</ItemGroup>\\nOne NuGet package that simplifies the life of Web Forms developers is \", \"the Windows Compatibility \\nPack. Although .NET is cross-platform, some features are only available o\", \"n Windows. Windows\\u0002specific features are made available by installing the compatibility pack. Exampl\", \"es of such features \\ninclude the Registry, WMI, and Directory Services. The package adds around 20,0\", \"00 APIs and activates \\nmany services with which you may already be familiar. The eShop project doesn\", \"\\u2019t require the \\ncompatibility pack; but if your projects use Windows-specific features, the package \", \"eases the \\nmigration efforts.\\nEnable startup process\\nThe startup process for Blazor has changed from\", \" Web Forms and follows a similar setup for other \\nASP.NET Core services. When hosted server-side, Ra\", \"zor components are run as part of a normal \\nASP.NET Core app. When hosted in the browser with WebAss\", \"embly, Razor components use a similar \\nhosting model. The difference is the components are run as a \", \"separate service from any of the \\nbackend processes. Either way, the startup is similar.\\nThe Global.\", \"asax.cs file is the default startup page for Web Forms projects. In the eShop project, this file \\nco\", \"nfigures the Inversion of Control (IoC) container and handles the various lifecycle events of the ap\", \"p \\nor request. Some of these events are handled with middleware (such as Application_BeginRequest). \", \"\\nOther events require the overriding of specific services via dependency injection (DI).\\nBy way of e\", \"xample, the Global.asax.cs file for eShop, contains the following code:\\npublic class Global : HttpAp\", \"plication, IContainerProviderAccessor\\n{\\n private static readonly ILog _log =\\nLogManager.GetLogger(Sy\", \"stem.Reflection.MethodBase.GetCurrentMethod().DeclaringType);\\n static IContainerProvider _containerP\", \"rovider;\\n IContainer container;81 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n public ICon\", \"tainerProvider ContainerProvider\\n {\\n get { return _containerProvider; }\\n }\\n protected void Applicati\", \"on_Start(object sender, EventArgs e)\\n {\\n // Code that runs on app startup\\n RouteConfig.RegisterRoute\", \"s(RouteTable.Routes);\\n BundleConfig.RegisterBundles(BundleTable.Bundles);\\n ConfigureContainer();\\n Co\", \"nfigDataBase();\\n }\\n /// <summary>\\n /// Track the machine name and the start time for the session ins\", \"ide the current \\nsession\\n /// </summary>\\n protected void Session_Start(Object sender, EventArgs e)\\n \", \"{\\n HttpContext.Current.Session[\\\"MachineName\\\"] = Environment.MachineName;\\n HttpContext.Current.Sessio\", \"n[\\\"SessionStartTime\\\"] = DateTime.Now;\\n }\\n /// <summary>\\n /// https://autofaccn.readthedocs.io/en/lat\", \"est/integration/webforms.html\\n /// </summary>\\n private void ConfigureContainer()\\n {\\n var builder = n\", \"ew ContainerBuilder();\\n var mockData = bool.Parse(ConfigurationManager.AppSettings[\\\"UseMockData\\\"]);\\n\", \" builder.RegisterModule(new ApplicationModule(mockData));\\n container = builder.Build();\\n _containerP\", \"rovider = new ContainerProvider(container);\\n }\\n private void ConfigDataBase()\\n {\\n var mockData = boo\", \"l.Parse(ConfigurationManager.AppSettings[\\\"UseMockData\\\"]);\\n if (!mockData)\\n {\\n \\nDatabase.SetInitializ\", \"er<CatalogDBContext>(container.Resolve<CatalogDBInitializer>());\\n }\\n }\\n protected void Application_B\", \"eginRequest(object sender, EventArgs e)\\n {\\n //set the property to our new object\\n LogicalThreadConte\", \"xt.Properties[\\\"activityid\\\"] = new ActivityIdHelper();\\n LogicalThreadContext.Properties[\\\"requestinfo\\\"\", \"] = new WebRequestInfo();\\n _log.Debug(\\\"Application_BeginRequest\\\");\\n }\\n}\\nThe preceding file becomes t\", \"he Program.cs file in server-side Blazor:82 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\nus\", \"ing eShopOnBlazor.Models;\\nusing eShopOnBlazor.Models.Infrastructure;\\nusing eShopOnBlazor.Services;\\nu\", \"sing log4net;\\nusing System.Data.Entity;\\nusing eShopOnBlazor;\\nvar builder = WebApplication.CreateBuil\", \"der(args);\\n// add services\\nbuilder.Services.AddRazorPages();\\nbuilder.Services.AddServerSideBlazor();\", \"\\nif (builder.Configuration.GetValue<bool>(\\\"UseMockData\\\"))\\n{\\n builder.Services.AddSingleton<ICatalogS\", \"ervice, CatalogServiceMock>();\\n}\\nelse\\n{\\n builder.Services.AddScoped<ICatalogService, CatalogService>\", \"();\\n builder.Services.AddScoped<IDatabaseInitializer<CatalogDBContext>,\\nCatalogDBInitializer>();\\n bu\", \"ilder.Services.AddSingleton<CatalogItemHiLoGenerator>();\\n builder.Services.AddScoped(_ => new\\nCatalo\", \"gDBContext(builder.Configuration.GetConnectionString(\\\"CatalogDBContext\\\")));\\n}\\nvar app = builder.Buil\", \"d();\\nnew LoggerFactory().AddLog4Net(\\\"log4Net.xml\\\");\\nif (app.Environment.IsDevelopment())\\n{\\n app.UseD\", \"eveloperExceptionPage();\\n}\\nelse\\n{\\n app.UseExceptionHandler(\\\"/Home/Error\\\");\\n}\\n// Middleware for Appli\", \"cation_BeginRequest\\napp.Use((ctx, next) =>\\n{\\n LogicalThreadContext.Properties[\\\"activityid\\\"] = new Ac\", \"tivityIdHelper(ctx);\\n LogicalThreadContext.Properties[\\\"requestinfo\\\"] = new WebRequestInfo(ctx);\\n ret\", \"urn next();\\n});\\napp.UseStaticFiles();\\napp.UseRouting();\\napp.UseEndpoints(endpoints =>\\n{\\n endpoints.M\", \"apBlazorHub();\\n endpoints.MapFallbackToPage(\\\"/_Host\\\");\\n});\\nConfigDataBase(app);83 CHAPTER 14 | Migra\", \"te from ASP.NET Web Forms to Blazor\\nvoid ConfigDataBase(IApplicationBuilder app)\\n{\\n using (var scope\", \" = app.ApplicationServices.CreateScope())\\n {\\n var initializer =\\nscope.ServiceProvider.GetService<IDa\", \"tabaseInitializer<CatalogDBContext>>();\\n if (initializer != null)\\n {\\n Database.SetInitializer(initia\", \"lizer);\\n }\\n }\\n}\\napp.Run();\\nOne significant change you may notice from Web Forms is the prominence of\", \" dependency injection \\n(DI). DI has been a guiding principle in the ASP.NET Core design. It supports\", \" customization of almost \\nall aspects of the ASP.NET Core framework. There\\u2019s even a built-in service\", \" provider that can be used \\nfor many scenarios. If more customization is required, it can be support\", \"ed by many community \\nprojects. For example, you can carry forward your third-party DI library inves\", \"tment.\\nIn the original eShop app, there\\u2019s some configuration for session management. Since server-si\", \"de \\nBlazor uses ASP.NET Core SignalR for communication, the session state isn\\u2019t supported as the \\nco\", \"nnections may occur independent of an HTTP context. An app that uses the session state requires \\nrea\", \"rchitecting before running as a Blazor app.\\nFor more information about app startup, see App startup.\", \"\\nMigrate HTTP modules and handlers to middleware\\nHTTP modules and handlers are common patterns in We\", \"b Forms to control the HTTP request pipeline. \\nClasses that implement IHttpModule or IHttpHandler co\", \"uld be registered and process incoming \\nrequests. Web Forms configure modules and handlers in the we\", \"b.config file. Web Forms is also heavily \\nbased on app lifecycle event handling. ASP.NET Core uses m\", \"iddleware instead. Middleware is \\nregistered in the Configure method of the Startup class. Middlewar\", \"e execution order is determined by \\nthe registration order.\\nIn the Enable startup process section, a\", \" lifecycle event was raised by Web Forms as the \\nApplication_BeginRequest method. This event isn\\u2019t a\", \"vailable in ASP.NET Core. One way to achieve this \\nbehavior is to implement middleware as seen in th\", \"e Startup.cs file example. This middleware does the \\nsame logic and then transfers control to the ne\", \"xt handler in the middleware pipeline.\\nFor more information on migrating modules and handlers, see M\", \"igrate HTTP handlers and modules to \\nASP.NET Core middleware.84 CHAPTER 14 | Migrate from ASP.NET We\", \"b Forms to Blazor\\nMigrate static files\\nTo serve static files (for example, HTML, CSS, images, and Ja\", \"vaScript), the files must be exposed by \\nmiddleware. Calling the UseStaticFiles method enables the s\", \"erving of static files from the web root \\npath. The default web root directory is wwwroot, but it ca\", \"n be customized. As included in the \\nProgram.cs file:\\n...\\napp.UseStaticFiles();\\n...\\nThe eShop projec\", \"t enables basic static file access. There are many customizations available for static \\nfile access.\", \" For information on enabling default files or a file browser, see Static files in ASP.NET Core.\\nMigr\", \"ate runtime bundling and minification setup\\nBundling and minification are performance optimization t\", \"echniques for reducing the number and size \\nof server requests to retrieve certain file types. JavaS\", \"cript and CSS often undergo some form of \\nbundling or minification before being sent to the client. \", \"In ASP.NET Web Forms, these optimizations \\nare handled at run time. The optimization conventions are\", \" defined an App_Start/BundleConfig.cs file. \\nIn ASP.NET Core, a more declarative approach is adopted\", \". A file lists the files to be minified, along \\nwith specific minification settings.\\nFor more inform\", \"ation on bundling and minification, see Bundle and minify static assets in ASP.NET \\nCore.\\nMigrate AS\", \"PX pages\\nA page in a Web Forms app is a file with the .aspx extension. A Web Forms page can often be\", \" mapped \\nto a component in Blazor. A Razor component is authored in a file with the .razor extension\", \". For the \\neShop project, five pages are converted to a Razor page.\\nFor example, the details view co\", \"mprises three files in the Web Forms project: Details.aspx, \\nDetails.aspx.cs, and Details.aspx.desig\", \"ner.cs. When converting to Blazor, the code-behind and markup \\nare combined into Details.razor. Razo\", \"r compilation (equivalent to what\\u2019s in .designer.cs files) is stored \\nin the obj directory and isn\\u2019t\", \", by default, viewable in Solution Explorer. The Web Forms page consists \\nof the following markup:\\n<\", \"%@ Page Title=\\\"Details\\\" Language=\\\"C#\\\" MasterPageFile=\\\"~/Site.Master\\\" \\nAutoEventWireup=\\\"true\\\" CodeBeh\", \"ind=\\\"Details.aspx.cs\\\" \\nInherits=\\\"eShopLegacyWebForms.Catalog.Details\\\" %>\\n<asp:Content ID=\\\"Details\\\" C\", \"ontentPlaceHolderID=\\\"MainContent\\\" runat=\\\"server\\\">\\n <h2 class=\\\"esh-body-title\\\">Details</h2>\\n <div cla\", \"ss=\\\"container\\\">\\n <div class=\\\"row\\\">85 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n <asp:Ima\", \"ge runat=\\\"server\\\" CssClass=\\\"col-md-6 esh-picture\\\" ImageUrl='<%#\\\"/Pics/\\\" \\n+ product.PictureFileName%>\", \"' />\\n <dl class=\\\"col-md-6 dl-horizontal\\\">\\n <dt>Name\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"server\\\" Text='<%\", \"#product.Name%>' />\\n </dd>\\n <dt>Description\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"server\\\" Text='<%#product\", \".Description%>' />\\n </dd>\\n <dt>Brand\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"server\\\" Text='<%#product.Catalo\", \"gBrand.Brand%>' />\\n </dd>\\n <dt>Type\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"server\\\" Text='<%#product.Catalog\", \"Type.Type%>' />\\n </dd>\\n <dt>Price\\n </dt>\\n <dd>\\n <asp:Label CssClass=\\\"esh-price\\\" runat=\\\"server\\\" \\nText\", \"='<%#product.Price%>' />\\n </dd>\\n <dt>Picture name\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"server\\\" Text='<%#p\", \"roduct.PictureFileName%>' />\\n </dd>\\n <dt>Stock\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"server\\\" Text='<%#prod\", \"uct.AvailableStock%>' />\\n </dd>\\n <dt>Restock\\n </dt>\\n <dd>\\n <asp:Label runat=\\\"server\\\" Text='<%#produc\", \"t.RestockThreshold%>' />\\n </dd>\\n <dt>Max stock\\n </dt>86 CHAPTER 14 | Migrate from ASP.NET Web Forms \", \"to Blazor\\n <dd>\\n <asp:Label runat=\\\"server\\\" Text='<%#product.MaxStockThreshold%>' />\\n </dd>\\n </dl>\\n <\", \"/div>\\n <div class=\\\"form-actions no-color esh-link-list\\\">\\n <a runat=\\\"server\\\" href='<%# GetRouteUrl(\\\"E\", \"ditProductRoute\\\", new {id \\n=product.Id}) %>' class=\\\"esh-link-item\\\">Edit\\n </a>\\n |\\n <a runat=\\\"server\\\" \", \"href=\\\"~\\\" class=\\\"esh-link-item\\\">Back to list\\n </a>\\n </div>\\n </div>\\n</asp:Content>\\nThe preceding marku\", \"p\\u2019s code-behind includes the following code:\\nusing eShopLegacyWebForms.Models;\\nusing eShopLegacyWebF\", \"orms.Services;\\nusing log4net;\\nusing System;\\nusing System.Web.UI;\\nnamespace eShopLegacyWebForms.Catal\", \"og\\n{\\n public partial class Details : System.Web.UI.Page\\n {\\n private static readonly ILog _log =\\nLogM\", \"anager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);\\n protected CatalogI\", \"tem product;\\n public ICatalogService CatalogService { get; set; }\\n protected void Page_Load(object s\", \"ender, EventArgs e)\\n {\\n var productId = Convert.ToInt32(Page.RouteData.Values[\\\"id\\\"]);\\n _log.Info($\\\"N\", \"ow loading... /Catalog/Details.aspx?id={productId}\\\");\\n product = CatalogService.FindCatalogItem(prod\", \"uctId);\\n this.DataBind();\\n }\\n }\\n}\\nWhen converted to Blazor, the Web Forms page translates to the fol\", \"lowing code:\\n@page \\\"/Catalog/Details/{id:int}\\\"\\n@inject ICatalogService CatalogService\\n@inject ILogge\", \"r<Details> Logger\\n<h2 class=\\\"esh-body-title\\\">Details</h2>\\n<div class=\\\"container\\\">\\n <div class=\\\"row\\\">\", \"87 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n <img class=\\\"col-md-6 esh-picture\\\" src=\\\"@($\", \"\\\"/Pics/{_item.PictureFileName}\\\")\\\">\\n <dl class=\\\"col-md-6 dl-horizontal\\\">\\n <dt>\\n Name\\n </dt>\\n <dd>\\n @_\", \"item.Name\\n </dd>\\n <dt>\\n Description\\n </dt>\\n <dd>\\n @_item.Description\\n </dd>\\n <dt>\\n Brand\\n </dt>\\n <dd\", \">\\n @_item.CatalogBrand.Brand\\n </dd>\\n <dt>\\n Type\\n </dt>\\n <dd>\\n @_item.CatalogType.Type\\n </dd>\\n <dt>\\n \", \"Price\\n </dt>\\n <dd>\\n @_item.Price\\n </dd>\\n <dt>\\n Picture name\\n </dt>\\n <dd>\\n @_item.PictureFileName\\n </\", \"dd>\\n <dt>\\n Stock\\n </dt>\\n <dd>\\n @_item.AvailableStock\\n </dd>\\n <dt>\\n Restock\\n </dt>88 CHAPTER 14 | Mig\", \"rate from ASP.NET Web Forms to Blazor\\n <dd>\\n @_item.RestockThreshold\\n </dd>\\n <dt>\\n Max stock\\n </dt>\\n\", \" <dd>\\n @_item.MaxStockThreshold\\n </dd>\\n </dl>\\n </div>\\n <div class=\\\"form-actions no-color esh-link-li\", \"st\\\">\\n <a href=\\\"@($\\\"/Catalog/Edit/{_item.Id}\\\")\\\" class=\\\"esh-link-item\\\">\\n Edit\\n </a>\\n |\\n <a href=\\\"/\\\" cl\", \"ass=\\\"esh-link-item\\\">\\n Back to list\\n </a>\\n </div>\\n</div>\\n@code {\\n private CatalogItem _item;\\n [Parame\", \"ter]\\n public int Id { get; set; }\\n protected override void OnInitialized()\\n {\\n Logger.LogInformation\", \"(\\\"Now loading... /Catalog/Details/{Id}\\\", Id);\\n _item = CatalogService.FindCatalogItem(Id);\\n }\\n}\\nNoti\", \"ce that the code and markup are in the same file. Any required services are made accessible with \\nth\", \"e @inject attribute. Per the @page directive, this page can be accessed at the Catalog/Details/{id} \", \"\\nroute. The value of the route\\u2019s {id} placeholder has been constrained to an integer. As described i\", \"n the \\nrouting section, unlike Web Forms, a Razor component explicitly states its route and any para\", \"meters \\nthat are included. Many Web Forms controls may not have exact counterparts in Blazor. There\\u2019\", \"s often \\nan equivalent HTML snippet that will serve the same purpose. For example, the <asp:Label />\", \" control \\ncan be replaced with an HTML <label> element.\\nModel validation in Blazor\\nIf your Web Forms\", \" code includes validation, you can transfer much of what you have with little-to-no \\nchanges. A bene\", \"fit to running in Blazor is that the same validation logic can be run without needing \\ncustom JavaSc\", \"ript. Data annotations enable easy model validation.89 CHAPTER 14 | Migrate from ASP.NET Web Forms t\", \"o Blazor\\nFor example, the Create.aspx page has a data entry form with validation. An example snippet\", \" would \\nlook like this:\\n<div class=\\\"form-group\\\">\\n <label class=\\\"control-label col-md-2\\\">Name</label>\", \"\\n <div class=\\\"col-md-3\\\">\\n <asp:TextBox ID=\\\"Name\\\" runat=\\\"server\\\" CssClass=\\\"form-control\\\"></asp:TextBo\", \"x>\\n <asp:RequiredFieldValidator runat=\\\"server\\\" ControlToValidate=\\\"Name\\\"\\nDisplay=\\\"Dynamic\\\"\\n CssClass=\", \"\\\"field-validation-valid text-danger\\\" ErrorMessage=\\\"The Name field is \\nrequired.\\\" />\\n </div>\\n</div>\\nI\", \"n Blazor, the equivalent markup is provided in a Create.razor file:\\n<EditForm Model=\\\"_item\\\" OnValidS\", \"ubmit=\\\"@...\\\">\\n <DataAnnotationsValidator />\\n <div class=\\\"form-group\\\">\\n <label class=\\\"control-label c\", \"ol-md-2\\\">Name</label>\\n <div class=\\\"col-md-3\\\">\\n <InputText class=\\\"form-control\\\" @bind-Value=\\\"_item.Na\", \"me\\\" />\\n <ValidationMessage For=\\\"(() => _item.Name)\\\" />\\n </div>\\n </div>\\n ...\\n</EditForm>\\nThe EditForm\", \" context includes validation support and can be wrapped around an input. Data \\nannotations are a com\", \"mon way to add validation. Such validation support can be added via the \\nDataAnnotationsValidator co\", \"mponent. For more information on this mechanism, see ASP.NET Core \\nBlazor forms and validation.\\nMigr\", \"ate configuration\\nIn a Web Forms project, configuration data is most commonly stored in the web.conf\", \"ig file. The \\nconfiguration data is accessed with ConfigurationManager. Services were often required\", \" to parse \\nobjects. With .NET Framework 4.7.2, composability was added to the configuration via \\nCon\", \"figurationBuilders. These builders allowed developers to add various sources for the configuration \\n\", \"that was then composed at run time to retrieve the necessary values.\\nASP.NET Core introduced a flexi\", \"ble configuration system that allows you to define the configuration \\nsource or sources used by your\", \" app and deployment. The ConfigurationBuilder infrastructure that you \\nmay be using in your Web Form\", \"s app was modeled after the concepts used in the ASP.NET Core \\nconfiguration system.\\nThe following s\", \"nippet demonstrates how the Web Forms eShop project uses web.config to store \\nconfiguration values:\\n\", \"<configuration>\\n <configSections>\\n <section name=\\\"entityFramework\\\"90 CHAPTER 14 | Migrate from ASP.N\", \"ET Web Forms to Blazor\\ntype=\\\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFr\", \"amework, \\nVersion=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\\\"\\nrequirePermission=\\\"fals\", \"e\\\" />\\n </configSections>\\n <connectionStrings>\\n <add name=\\\"CatalogDBContext\\\" connectionString=\\\"Data S\", \"ource=(localdb)\\\\MSSQLLocalDB; \\nInitial Catalog=Microsoft.eShopOnContainers.Services.CatalogDb; Integ\", \"rated Security=True; \\nMultipleActiveResultSets=True;\\\" providerName=\\\"System.Data.SqlClient\\\" />\\n </con\", \"nectionStrings>\\n <appSettings>\\n <add key=\\\"UseMockData\\\" value=\\\"true\\\" />\\n <add key=\\\"UseCustomizationDa\", \"ta\\\" value=\\\"false\\\" />\\n </appSettings>\\n</configuration>\\nIt\\u2019s common for secrets, such as database conn\", \"ection strings, to be stored within the web.config. The \\nsecrets are inevitably persisted in unsecur\", \"e locations, such as source control. With Blazor on ASP.NET \\nCore, the preceding XML-based configura\", \"tion is replaced with the following JSON:\\n{\\n \\\"ConnectionStrings\\\": {\\n \\\"CatalogDBContext\\\": \\\"Data Sourc\", \"e=(localdb)\\\\\\\\MSSQLLocalDB; Initial \\nCatalog=Microsoft.eShopOnContainers.Services.CatalogDb; Integrat\", \"ed Security=True; \\nMultipleActiveResultSets=True;\\\"\\n },\\n \\\"UseMockData\\\": true,\\n \\\"UseCustomizationData\\\"\", \": false\\n}\\nJSON is the default configuration format; however, ASP.NET Core supports many other format\", \"s, \\nincluding XML. There are also several community-supported formats.\\nYou can access configuration \", \"values from the builder in Program.cs:\\nif (builder.Configuration.GetValue<bool>(\\\"UseMockData\\\"))\\n{\\n b\", \"uilder.Services.AddSingleton<ICatalogService, CatalogServiceMock>();\\n}\\nelse\\n{\\n builder.Services.AddS\", \"coped<ICatalogService, CatalogService>();\\n builder.Services.AddScoped<IDatabaseInitializer<CatalogDB\", \"Context>,\\nCatalogDBInitializer>();\\n builder.Services.AddSingleton<CatalogItemHiLoGenerator>();\\n buil\", \"der.Services.AddScoped(_ => new\\nCatalogDBContext(builder.Configuration.GetConnectionString(\\\"CatalogD\", \"BContext\\\")));\\n}\\nBy default, environment variables, JSON files (appsettings.json and appsettings.{Env\", \"ironment}.json), and \\ncommand-line options are registered as valid configuration sources in the conf\", \"iguration object. The \\nconfiguration sources can be accessed via Configuration[key]. A more advanced\", \" technique is to bind \\nthe configuration data to objects using the options pattern. For more informa\", \"tion on configuration \\nand the options pattern, see Configuration in ASP.NET Core and Options patter\", \"n in ASP.NET Core, \\nrespectively.91 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\nMigrate da\", \"ta access\\nData access is an important aspect of any app. The eShop project stores catalog informatio\", \"n in a \\ndatabase and retrieves the data with Entity Framework (EF) 6. Since EF 6 is supported in .NE\", \"T 5, the \\nproject can continue to use it.\\nThe following EF-related changes were necessary to eShop:\\n\", \"\\u2022 In .NET Framework, the DbContext object accepts a string of the form name=ConnectionString\\nand use\", \"s the connection string from ConfigurationManager.AppSettings[ConnectionString] to \\nconnect. In .NET\", \" Core, this isn\\u2019t supported. The connection string must be supplied.\\n\\u2022 The database was accessed in \", \"a synchronous way. Though this works, scalability may suffer. \\nThis logic should be moved to an asyn\", \"chronous pattern.\\nAlthough there isn\\u2019t the same native support for dataset binding, Blazor provides \", \"flexibility and power \\nwith its C# support in a Razor page. For example, you can perform calculation\", \"s and display the result. \\nFor more information on data patterns in Blazor, see the Data access chap\", \"ter.\\nArchitectural changes\\nFinally, there are some important architectural differences to consider w\", \"hen migrating to Blazor. Many \\nof these changes are applicable to anything based on .NET Core or ASP\", \".NET Core.\\nBecause Blazor is built on .NET Core, there are considerations in ensuring support on .NE\", \"T Core. Some \\nof the major changes include the removal of the following features:\\n\\u2022 Multiple AppDoma\", \"ins\\n\\u2022 Remoting\\n\\u2022 Code Access Security (CAS)\\n\\u2022 Security Transparency\\nFor more information on techniqu\", \"es to identify necessary changes to support running on .NET Core, \\nsee Port your code from .NET Fram\", \"ework to .NET Core.\\nASP.NET Core is a reimagined version of ASP.NET and has some changes that may no\", \"t initially seem \\nobvious. The main changes are:\\n\\u2022 No synchronization context, which means there\\u2019s n\", \"o HttpContext.Current, \\nThread.CurrentPrincipal, or other static accessors\\n\\u2022 No shadow copying\\n\\u2022 No \", \"request queue\\nMany operations in ASP.NET Core are asynchronous, which allows easier off-loading of I\", \"/O-bound \\ntasks. It\\u2019s important to never block by using Task.Wait() or Task.GetResult(), which can q\", \"uickly exhaust \\nthread pool resources.92 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\nMigra\", \"tion conclusion\\nAt this point, you\\u2019ve seen many examples of what it takes to move a Web Forms projec\", \"t to Blazor. For \\na full example, see the eShopOnBlazor project.\"]"