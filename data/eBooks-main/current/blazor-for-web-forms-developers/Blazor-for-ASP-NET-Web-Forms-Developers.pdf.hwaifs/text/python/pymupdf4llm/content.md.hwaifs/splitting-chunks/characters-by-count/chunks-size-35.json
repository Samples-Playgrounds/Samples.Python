"[\"**EDITION v8.0** - Updated to .NET 8\\n\\n\\n[Refer to changelog](https://aka.ms/blazor-ebook-changelog) f\", \"or the book updates and community contributions.\\n\\n\\nPUBLISHED BY\\n\\n\\nMicrosoft Developer Division, .NET\", \", and Visual Studio product teams\\n\\n\\nA division of Microsoft Corporation\\n\\n\\nOne Microsoft Way\\n\\n\\nRedmon\", \"d, Washington 98052-6399\\n\\n\\nCopyright \\u00a9 2023 by Microsoft Corporation\\n\\n\\nAll rights reserved. No part \", \"of the contents of this book may be reproduced or transmitted in any\\nform or by any means without th\", \"e written permission of the publisher.\\n\\n\\nThis book is provided \\u201cas-is\\u201d and expresses the author\\u2019s vi\", \"ews and opinions. The views, opinions, and\\ninformation expressed in this book, including URL and oth\", \"er Internet website references, may change\\nwithout notice.\\n\\n\\nSome examples depicted herein are provi\", \"ded for illustration only and are fictitious. No real association\\nor connection is intended or shoul\", \"d be inferred.\\n\\n\\n[Microsoft and the trademarks listed at https://www.microsoft.com](https://www.micr\", \"osoft.com/) on the \\u201cTrademarks\\u201d webpage are\\ntrademarks of the Microsoft group of companies.\\n\\n\\nMac an\", \"d macOS are trademarks of Apple Inc.\\n\\n\\nAll other marks and logos are property of their respective ow\", \"ners.\\n\\n\\nAuthors:\\n\\n\\n**[Daniel Roth](https://github.com/danroth27)**, Principal Program Manager, Micro\", \"soft Corp.\\n\\n\\n**[Jeff Fritz](https://github.com/csharpfritz)**, Senior Program Manager, Microsoft Cor\", \"p.\\n\\n\\n**[Taylor Southwick](https://github.com/twsouthwick)**, Senior Software Engineer, Microsoft Cor\", \"p.\\n\\n\\n**[Scott Addie](https://github.com/scottaddie)**, Senior Content Developer, Microsoft Corp.\\n\\n\\n*\", \"*[Steve \\u201c@ardalis\\u201d Smith](https://github.com/ardalis)**, Software Architect and Trainer, NimblePros.\", \"com\\n### Introduction\\n\\n\\n.NET has long supported web app development through ASP.NET, a comprehensive \", \"set of frameworks\\nand tools for building any kind of web app. ASP.NET has its own lineage of web fra\", \"meworks and\\ntechnologies starting all the way back with classic Active Server Pages (ASP). Framework\", \"s like ASP.NET\\nWeb Forms, ASP.NET MVC, ASP.NET Web Pages, and more recently ASP.NET Core, provide a\\n\", \"productive and powerful way to build _server-rendered_ web apps, where UI content is dynamically\\ngen\", \"erated on the server in response to HTTP requests. Each ASP.NET framework caters to a different\\naudi\", \"ence and app building philosophy. ASP.NET Web Forms shipped with the original release of the\\n.NET Fr\", \"amework and enabled web development using many of the patterns familiar to desktop\\n\\n\\ndevelopers, lik\", \"e reusable UI controls with simple event handling. However, none of the ASP.NET\\nofferings provide a \", \"way to run code that executed in the user\\u2019s browser. To do that requires writing\\nJavaScript and usin\", \"g any of the many JavaScript frameworks and tools that have phased in and out of\\npopularity over the\", \" years: jQuery, Knockout, Angular, React, and so on.\\n\\n\\n[Blazor](https://blazor.net/) is a new web fr\", \"amework that changes what is possible when building web apps with .NET.\\nBlazor is a client-side web \", \"UI framework based on C# instead of JavaScript. With Blazor you can write\\nyour client-side logic and\", \" UI components in C#, compile them into normal .NET assemblies, and then\\nrun them directly in the br\", \"owser using a new open web standard called WebAssembly. Or\\nalternatively, Blazor can run your .NET U\", \"I components on the server and handle all UI interactions\\nfluidly over a real-time connection with t\", \"he browser. When paired with .NET running on the server,\\nBlazor enables full-stack web development w\", \"ith .NET. While Blazor shares many commonalities with\\nASP.NET Web Forms, like having a reusable comp\", \"onent model and a simple way to handle user\\nevents, it also builds on the foundations of .NET to pro\", \"vide a modern and high-performance web\\ndevelopment experience.\\n\\n\\nThis book introduces ASP.NET Web Fo\", \"rms developers to Blazor in a way that is familiar and\\nconvenient. It introduces Blazor concepts in \", \"parallel with analogous concepts in ASP.NET Web Forms\\nwhile also explaining new concepts that may be\", \" less familiar. It covers a broad range of topics and\\nconcerns including component authoring, routin\", \"g, layout, configuration, and security. And while the\\ncontent of this book is primarily for enabling\", \" new development, it also covers guidelines and\\nstrategies for migrating existing ASP.NET Web Forms \", \"to Blazor for when you want to modernize an\\nexisting app.\\n### Who should use the book\\n\\n\\nThis book is\", \" for ASP.NET Web Forms developers looking for an introduction to Blazor that relates to\\ntheir existi\", \"ng knowledge and skills. This book can help with quickly getting started on a new Blazorbased projec\", \"t or to help chart a roadmap for modernizing an existing ASP.NET Web Forms\\napplication.\\n### How to u\", \"se the book\\n\\n\\nThe first part of this book covers what Blazor is and compares it to web app developme\", \"nt with\\nASP.NET Web Forms. The book then covers a variety of Blazor topics, chapter by chapter, and \", \"relates\\neach Blazor concept to the corresponding concept in ASP.NET Web Forms, or explains fully any\", \"\\ncompletely new concepts. The book also refers regularly to a complete sample app implemented in\\nbot\", \"h ASP.NET Web Forms and Blazor to demonstrate Blazor features and to provide a case study for\\nmigrat\", \"ing from ASP.NET Web Forms to Blazor. You can find both implementations of the sample app\\n[(ASP.NET \", \"Web Forms and Blazor versions) on GitHub.](https://github.com/dotnet-architecture/eshoponblazor)\\n###\", \" What this book doesn\\u2019t cover\\n\\n\\nThis book is an introduction to Blazor, not a comprehensive migratio\", \"n guide. While it does include\\nguidance on how to approach migrating a project from ASP.NET Web Form\", \"s to Blazor, it does not\\n\\n\\nattempt to cover every nuance and detail. For more general guidance on mi\", \"grating from ASP.NET to\\n[ASP.NET Core, refer to the migration guidance](https://docs.microsoft.com/a\", \"spnet/core/migration/proper-to-2x/) in the ASP.NET Core documentation.\\n#### **Additional resources**\", \"\\n\\n\\n[You can find the official Blazor home page and documentation at https://blazor.net.](https://bla\", \"zor.net/)\\n\\n\\n## Contents\\n\\n**An introduction to Blazor for ASP.NET Web Forms developers ..............\", \".......................... 1**\\n\\n\\nAn open-source and cross-platform .NET ............................\", \"......................................................................................... 2\\n\\n\\nClient\", \"-side web development ..............................................................................\", \"............................................................... 3\\n\\n\\nWebAssembly fulfills a need ....\", \"....................................................................................................\", \"....................................... 3\\n\\n\\nBlazor: full-stack web development with .NET ...........\", \".................................................................................................. 4\", \"\\n\\n\\nGet started with Blazor .........................................................................\", \"................................................................................. 4\\n\\n\\n**Architecture\", \" comparison of ASP.NET Web Forms and Blazor ............................................ 5**\\n\\n\\nASP.N\", \"ET Web Forms .......................................................................................\", \"........................................................................ 5\\n\\n\\nBlazor ................\", \"....................................................................................................\", \"........................................................................ 6\\n\\n\\n**Blazor app hosting mo\", \"dels ...............................................................................................\", \"...... 8**\\n\\n\\nBlazor WebAssembly apps ...............................................................\", \".................................................................................... 8\\n\\n\\nBlazor Serv\", \"er apps ............................................................................................\", \"....................................................................... 9\\n\\n\\nHow to choose the right \", \"Blazor hosting model ...............................................................................\", \"........................ 10\\n\\n\\nDeploy your app ......................................................\", \"....................................................................................................\", \".......... 11\\n\\n\\n**Project structure for Blazor apps ................................................\", \"......................................... 12**\\n\\n\\nProject file ......................................\", \"....................................................................................................\", \"...................................... 12\\n\\n\\nEntry point ............................................\", \"....................................................................................................\", \"............................... 13\\n\\n\\nStatic files ..................................................\", \"....................................................................................................\", \"........................... 15\\n\\n\\nConfiguration......................................................\", \"....................................................................................................\", \"................ 15\\n\\n\\nRazor components .............................................................\", \".................................................................................................. 1\", \"5\\n\\n\\nPages ..........................................................................................\", \"................................................................................................ 16\\n\", \"\\n\\nLayout ...........................................................................................\", \"............................................................................................. 16\\n\\n\\nB\", \"ootstrap Blazor ....................................................................................\", \"................................................................................ 16\\n\\n\\nBuild output .\", \"....................................................................................................\", \"....................................................................... 18\\n\\n\\nRun the app with Hot Re\", \"load................................................................................................\", \"........................................... 18\\n\\n\\n**App startup .....................................\", \"....................................................................................... 21**\\n\\n\\nAppli\", \"cation_Start and Web Forms .........................................................................\", \"........................................................ 21\\n\\n\\nBlazor Server Startup Structure ......\", \"....................................................................................................\", \"............................. 21\\n\\n\\ni Contents\\n\\n\\nUpgrading the BundleConfig Process .................\", \"....................................................................................................\", \"..... 23\\n\\n\\n**Build reusable UI components with Blazor...............................................\", \".......................... 24**\\n\\n\\nAn introduction to Razor .........................................\", \"....................................................................................................\", \"...... 24\\n\\n\\nUse components .........................................................................\", \".......................................................................................... 28\\n\\n\\nModi\", \"fy page title from components ......................................................................\", \"....................................................... 28\\n\\n\\nComponent parameters ..................\", \"....................................................................................................\", \"............................... 29\\n\\n\\nQuery string parameters .......................................\", \"....................................................................................................\", \".... 29\\n\\n\\nComponents and error boundaries ..........................................................\", \"..................................................................... 30\\n\\n\\nEvent handlers ..........\", \"....................................................................................................\", \".......................................................... 30\\n\\n\\nData binding .......................\", \"....................................................................................................\", \"................................................ 32\\n\\n\\nState changes ................................\", \"....................................................................................................\", \"..................................... 33\\n\\n\\nComponent lifecycle .....................................\", \"....................................................................................................\", \"................... 34\\n\\n\\nOnInitialized .............................................................\", \"....................................................................................................\", \"...... 34\\n\\n\\nOnParametersSet ........................................................................\", \"..................................................................................... 35\\n\\n\\nOnAfterRe\", \"nder ...............................................................................................\", \"................................................................... 35\\n\\n\\nIDisposable ...............\", \"....................................................................................................\", \"...................................................... 35\\n\\n\\nCapture component references ...........\", \"....................................................................................................\", \"....................... 36\\n\\n\\nCapture element references ............................................\", \"................................................................................................. 36\", \"\\n\\n\\nTemplated components ............................................................................\", \"......................................................................... 36\\n\\n\\nChild content........\", \"....................................................................................................\", \".......................................................... 37\\n\\n\\nTemplate parameters ................\", \"....................................................................................................\", \".................................. 37\\n\\n\\nCode-behind ................................................\", \"....................................................................................................\", \"....................... 38\\n\\n\\nAdditional resources ..................................................\", \"....................................................................................................\", \"...... 39\\n\\n\\n**Pages, routing, and layouts ..........................................................\", \"........................................ 40**\\n\\n\\nCreate pages .......................................\", \"....................................................................................................\", \"................................ 41\\n\\n\\nRouter component .............................................\", \"....................................................................................................\", \".............. 42\\n\\n\\nNavigation .....................................................................\", \"....................................................................................................\", \"...... 42\\n\\n\\nBase URLs ..............................................................................\", \"................................................................................................... \", \"43\\n\\n\\nPage layout ...................................................................................\", \"........................................................................................... 43\\n\\n\\n**S\", \"tate management ....................................................................................\", \"............................ 46**\\n\\n\\nRequest state management with ViewState ........................\", \"...................................................................................... 46\\n\\n\\nii Conte\", \"nts\\n\\n\\nMaintain state with Session ..................................................................\", \"............................................................................ 47\\n\\n\\nApplication state \", \"....................................................................................................\", \"............................................................... 47\\n\\n\\nIn the browser ................\", \"....................................................................................................\", \".................................................... 48\\n\\n\\n**Forms and validation ...................\", \"......................................................................................... 49**\\n\\n\\nAdd\", \"itional resources ..................................................................................\", \".......................................................................... 51\\n\\n\\n**Work with data ...\", \"....................................................................................................\", \"............... 52**\\n\\n\\nEntity Framework ............................................................\", \"....................................................................................................\", \".. 52\\n\\n\\nEF Code First...............................................................................\", \"........................................................................................ 53\\n\\n\\nEF Dat\", \"abase First ........................................................................................\", \"...................................................................... 54\\n\\n\\nInteract with web servic\", \"es .................................................................................................\", \"................................................ 54\\n\\n\\n**Modules, handlers, and middleware ..........\", \"......................................................................... 56**\\n\\n\\nOverview ..........\", \"....................................................................................................\", \"..................................................................... 56\\n\\n\\nKatana ..................\", \"....................................................................................................\", \".................................................................. 57\\n\\n\\nCommon middleware ..........\", \"....................................................................................................\", \"............................................ 57\\n\\n\\nCustom middleware ................................\", \"....................................................................................................\", \"......................... 58\\n\\n\\n**App configuration .................................................\", \"................................................................ 60**\\n\\n\\nConfiguration sources ......\", \"....................................................................................................\", \"............................................... 60\\n\\n\\nappsettings.json format and access ............\", \"....................................................................................................\", \".............. 61\\n\\n\\nUser secrets ...................................................................\", \"....................................................................................................\", \"...... 61\\n\\n\\nEnvironment variables ..................................................................\", \"....................................................................................... 61\\n\\n\\nCommand\", \"-line arguments ....................................................................................\", \"............................................................ 62\\n\\n\\nThe return of web.config .........\", \"....................................................................................................\", \"...................................... 62\\n\\n\\nRead configuration in the app ..........................\", \"....................................................................................................\", \"........... 63\\n\\n\\nStrongly typed configuration ......................................................\", \"..................................................................................... 63\\n\\n\\n**Securit\", \"y: Authentication and Authorization in ASP.NET Web Forms and Blazor ........... 65**\\n\\n\\nASP.NET unive\", \"rsal providers .....................................................................................\", \"........................................................ 65\\n\\n\\nAuthorization configuration in Web For\", \"ms .................................................................................................\", \".......... 66\\n\\n\\nAuthorization code in Web Forms ....................................................\", \"........................................................................ 67\\n\\n\\nASP.NET Core Identity \", \"....................................................................................................\", \"..................................................... 68\\n\\n\\nRoles, claims, and policies .............\", \"....................................................................................................\", \"........................... 68\\n\\n\\nMigration guide ...................................................\", \"....................................................................................................\", \"......... 70\\n\\n\\niii Contents\\n\\n\\nCreating the ASP.NET Core Identity schema ............................\", \"............................................................................. 70\\n\\n\\nMigrating data fr\", \"om universal providers to ASP.NET Core Identity ....................................................\", \"........ 73\\n\\n\\nMigrating security settings from web.config to app startup ...........................\", \"............................................... 74\\n\\n\\nUpdating individual pages to use ASP.NET Core I\", \"dentity abstractions ..................................................... 75\\n\\n\\nSummary ............\", \"....................................................................................................\", \".................................................................. 76\\n\\n\\nReferences .................\", \"....................................................................................................\", \".......................................................... 77\\n\\n\\n**Migrate from ASP.NET Web Forms to \", \"Blazor ..................................................................... 78**\\n\\n\\nServer-side vers\", \"us client-side hosting .............................................................................\", \"............................................. 78\\n\\n\\nCreate a new project.............................\", \"....................................................................................................\", \"........................... 79\\n\\n\\nEnable startup process ............................................\", \"....................................................................................................\", \"........ 80\\n\\n\\nMigrate HTTP modules and handlers to middleware ......................................\", \"...................................................... 83\\n\\n\\nMigrate static files ...................\", \"....................................................................................................\", \"......................................... 84\\n\\n\\nMigrate runtime bundling and minification setup .....\", \"............................................................................................. 84\\n\\n\\nM\", \"igrate ASPX pages ..................................................................................\", \".......................................................................... 84\\n\\n\\nModel validation in \", \"Blazor .............................................................................................\", \"............................................... 88\\n\\n\\nMigrate configuration .........................\", \"....................................................................................................\", \"............................ 89\\n\\n\\nMigrate data access ..............................................\", \"....................................................................................................\", \"........... 91\\n\\n\\nArchitectural changes .............................................................\", \"............................................................................................. 91\\n\\n\\nM\", \"igration conclusion ................................................................................\", \"........................................................................... 92\\n\\n\\niv Contents\\n\\n\\n**CHA\", \"PTER**\\n# 1\\n\\n## An introduction to Blazor for ASP.NET Web Forms developers\\n\\n\\nThe ASP.NET Web Forms fr\", \"amework has been a staple of .NET web development since the .NET\\nFramework first shipped in 2002. Ba\", \"ck when the Web was still largely in its infancy, ASP.NET Web\\nForms made building web apps simple an\", \"d productive by adopting many of the patterns that were\\nused for desktop development. In ASP.NET Web\", \" Forms, web pages can be quickly composed from\\nreusable UI controls. User interactions are handled n\", \"aturally as events. There\\u2019s a rich ecosystem of\\nWeb Forms UI controls provided by Microsoft and cont\", \"rol vendors. The controls ease the efforts of\\nconnecting to data sources and displaying rich data vi\", \"sualizations. For the visually inclined, the Web\\nForms designer provides a simple drag-and-drop inte\", \"rface for managing controls.\\n\\n\\nOver the years, Microsoft has introduced new ASP.NET-based web framew\", \"orks to address web\\ndevelopment trends. Some such web frameworks include ASP.NET MVC, ASP.NET Web Pa\", \"ges, and\\nmore recently ASP.NET Core. With each new framework, some have predicted the imminent decli\", \"ne of\\nASP.NET Web Forms and criticized it as an outdated, outmoded web framework. Despite these\\npred\", \"ictions, many .NET web developers continue to find ASP.NET Web Forms a simple, stable, and\\nproductiv\", \"e way to get their work done.\\n\\n\\nAt the time of writing, almost half a million web developers use ASP\", \".NET Web Forms every month. The\\nASP.NET Web Forms framework is stable to the point that docs, sample\", \"s, books, and blog posts from\\na decade ago remain useful and relevant. For many .NET web developers,\", \" \\u201cASP.NET\\u201d is still\\nsynonymous with \\u201cASP.NET Web Forms\\u201d as it was when .NET was first conceived. Arg\", \"uments on the\\npros and cons of ASP.NET Web Forms compared to the other new .NET web frameworks may r\", \"age on.\\nASP.NET Web Forms remains a popular framework for creating web apps.\\n\\n\\nEven so, innovations \", \"in software development aren\\u2019t slowing. All software developers need to stay\\nabreast of new technolo\", \"gies and trends. Two trends in particular are worth considering:\\n\\n\\n1. The shift to open-source and c\", \"ross-platform\\n\\n2. The shift of app logic to the client\\n\\n\\n1 CHAPTER 1 | An introduction to Blazor for\", \" ASP.NET Web Forms developers\\n\\n\\n### An open-source and cross-platform .NET\\n\\nWhen .NET and ASP.NET We\", \"b Forms first shipped, the platform ecosystem looked much different than\\nit does today. The desktop \", \"and server markets were dominated by Windows. Alternative platforms like\\nmacOS and Linux were still \", \"struggling to gain traction. ASP.NET Web Forms ships with the .NET\\nFramework as a Windows-only compo\", \"nent, which means ASP.NET Web Forms apps can only run on\\nWindows Server machines. Many modern enviro\", \"nments now use different kinds of platforms for\\nservers and development machines such that cross-pla\", \"tform support for many users is an absolute\\nrequirement.\\n\\n\\nMost modern web frameworks are now also o\", \"pen-source, which has a number of benefits. Users\\naren\\u2019t beheld to a single project owner to fix bug\", \"s and add features. Open-source projects provide\\nimproved transparency on development progress and u\", \"pcoming changes. Open-source projects enjoy\\ncontributions from an entire community, and they foster \", \"a supportive open-source ecosystem.\\nDespite the risks of open-source, many consumers and contributor\", \"s have found suitable mitigations\\nthat enable them to enjoy the benefits of an open-source ecosystem\", \" in a safe and reasonable way.\\nExamples of such mitigations include contributor license agreements, \", \"friendly licenses, pedigree scans,\\nand supporting foundations.\\n\\n\\nThe .NET community has embraced bot\", \"h cross-platform support and open-source. .NET Core is an\\nopen-source and cross-platform implementat\", \"ion of .NET that runs on a plethora of platforms,\\nincluding Windows, macOS, and various Linux distri\", \"butions. Xamarin provides Mono, an open-source\\nversion of .NET. Mono runs on Android, iOS, and a var\", \"iety of other form factors, including watches\\n[and smart TVs. In 2020, Microsoft released .NET 5 tha\", \"t reconciled .NET Core and Mono into \\u201ca single](https://devblogs.microsoft.com/dotnet/announcing-net\", \"-5-0/)\\n.NET runtime and framework that can be used everywhere and that has uniform runtime behaviors\", \"\\nand developer experiences.\\u201d\\n\\n\\nWill ASP.NET Web Forms benefit from the move to open-source and cross\", \"-platform support? The\\nanswer, unfortunately, is no, or at least not to the same extent as the rest \", \"of the platform. The .NET\\n[team made it clear](https://devblogs.microsoft.com/dotnet/net-core-is-the\", \"-future-of-net/) that ASP.NET Web Forms won\\u2019t be ported to .NET Core or .NET 8. Why is that?\\n\\n\\nThere\", \" were efforts in the early days of .NET Core to port ASP.NET Web Forms. The number of breaking\\nchang\", \"es required were found to be too drastic. There\\u2019s also an admission here that even for Microsoft,\\nth\", \"ere\\u2019s a limit to the number of web frameworks that it can support simultaneously. Perhaps someone\\nin\", \" the community will take up the cause of creating an open-source and cross-platform version of\\n[ASP.\", \"NET Web Forms. The source code for ASP.NET Web Forms](https://github.com/microsoft/referencesource) \", \"has been made available publicly in\\nreference form. But for the time being, it seems ASP.NET Web For\", \"ms will remain Windows-only and\\nwithout an open-source contribution model. If cross-platform support\", \" or open-source become\\nimportant for your scenarios, then you\\u2019ll need to look for something new.\\n\\n\\nD\", \"oes this mean ASP.NET Web Forms is _dead_ and should no longer be used? Of course not! As long as\\nth\", \"e .NET Framework ships as part of Windows, ASP.NET Web Forms will be a supported framework.\\nFor many\", \" Web Forms developers, the lack of cross-platform and open-source support is a non-issue.\\nIf you don\", \"\\u2019t have a requirement for cross-platform support, open-source, or any of the other new\\nfeatures in .\", \"NET Core or .NET 8, then sticking with ASP.NET Web Forms on Windows is fine. ASP.NET\\nWeb Forms will \", \"continue to be a productive way to write web apps for many years to come.\\n\\n\\nBut there\\u2019s another tren\", \"d worth considering, and that\\u2019s the shift to the client.\\n\\n\\n2 CHAPTER 1 | An introduction to Blazor f\", \"or ASP.NET Web Forms developers\\n\\n\\n### Client-side web development\\n\\nAll of the .NET-based web framewo\", \"rks, including ASP.NET Web Forms, have historically had one thing\\nin common: they\\u2019re _server-rendere\", \"d_ . In server-rendered web apps, the browser makes a request to the\\nserver, which executes some cod\", \"e (.NET code in ASP.NET apps) to produce a response. That response\\nis sent back to the browser to ha\", \"ndle. In this model, the browser is used as a thin rendering engine.\\nThe hard work of producing the \", \"UI, running the business logic, and managing state occurs on the\\nserver.\\n\\n\\nHowever, browsers have be\", \"come versatile platforms. They implement an ever-increasing number of\\nopen web standards that grant \", \"access to the capabilities of the user\\u2019s machine. Why not take\\nadvantage of the compute power, stora\", \"ge, memory, and other resources of the client device? UI\\ninteractions in particular can benefit from\", \" a richer and more interactive feel when handled at least\\npartially or completely client-side. Logic\", \" and data that should be handled on the server can still be\\nhandled server-side. Web API calls or ev\", \"en real-time protocols, like WebSockets, can be used. These\\nbenefits are available to web developers\", \" for free if they\\u2019re willing to write JavaScript. Client-side UI\\nframeworks, such as Angular, React,\", \" and Vue, simplify client-side web development and have grown in\\npopularity. ASP.NET Web Forms devel\", \"opers can also benefit from leveraging the client, and even have\\nsome out-of-the-box support with in\", \"tegrated JavaScript frameworks like ASP.NET AJAX.\\n\\n\\nBut bridging two different platforms and ecosyst\", \"ems (.NET and JavaScript) comes with a cost.\\nExpertise is required in two parallel worlds with diffe\", \"rent languages, frameworks, and tools. Code and\\nlogic can\\u2019t be easily shared between client and serv\", \"er, resulting in duplication and engineering\\noverhead. It can also be difficult to keep up with the \", \"JavaScript ecosystem, which has a history of\\nevolving at breakneck speed. Front-end framework and bu\", \"ild tool preferences change quickly. The\\nindustry has observed the progression from Grunt to Gulp to\", \" Webpack, and so on. The same restless\\nchurn has occurred with front-end frameworks such as jQuery, \", \"Knockout, Angular, React, and Vue. But\\ngiven JavaScript\\u2019s browser monopoly, there was little choice \", \"in the matter. That is, until the web\\ncommunity got together and caused a _miracle_ to happen!\\n\\n### \", \"WebAssembly fulfills a need\\n\\n\\nIn 2015, the major browser vendors joined forces in a W3C Community Gr\", \"oup to create a new open\\nweb standard called WebAssembly. WebAssembly is a byte code for the Web. If\", \" you can compile your\\ncode to WebAssembly, it can then run on any browser on any platform at near na\", \"tive speed. Initial\\nefforts focused on C/C++. The result was a dramatic demonstration of running nat\", \"ive 3D graphics\\nengines directly in the browser without plugins. WebAssembly has since been standard\", \"ized and\\nimplemented by all major browsers.\\n\\n\\nWork on running .NET on WebAssembly was announced in l\", \"ate 2017 and released in 2020, including\\nsupport in .NET 5 and beyond. The ability to run .NET code \", \"directly in the browser enables full-stack\\nweb development with .NET.\\n\\n\\n3 CHAPTER 1 | An introductio\", \"n to Blazor for ASP.NET Web Forms developers\\n\\n\\n### Blazor: full-stack web development with .NET\\n\\nOn \", \"its own, the ability to run .NET code in a browser doesn\\u2019t provide an end-to-end experience for\\ncrea\", \"ting client-side web apps. That\\u2019s where Blazor comes in. Blazor is a client-side web UI framework\\nba\", \"sed on C# instead of JavaScript. Blazor can run directly in the browser via WebAssembly. No\\nbrowser \", \"plugins are required. Alternatively, Blazor apps can run server-side on .NET and handle all\\nuser int\", \"eractions over a real-time connection with the browser.\\n\\n\\nBlazor has great tooling support in Visual\", \" Studio and Visual Studio Code. The framework also includes\\na full UI component model and has built-\", \"in facilities for:\\n\\n\\n  - Forms and validation\\n\\n  - Dependency injection\\n\\n  - Client-side routing\\n\\n  \", \"- Layouts\\n\\n  - In-browser debugging\\n\\n  - JavaScript interop\\n\\n\\nBlazor has a lot in common with ASP.NE\", \"T Web Forms. Both frameworks offer component-based,\\nevent-driven, stateful UI programming models. Th\", \"e main architectural difference is that ASP.NET Web\\nForms runs only on the server. Blazor can run on\", \" the client in the browser. But if you\\u2019re coming from\\nan ASP.NET Web Forms background, there\\u2019s a lot\", \" in Blazor that will feel familiar. Blazor is a natural\\nsolution for ASP.NET Web Forms developers lo\", \"oking for a way to take advantage of client-side\\ndevelopment and the open-source, cross-platform fut\", \"ure of .NET.\\n\\n\\nThis book provides an introduction to Blazor that is catered specifically to ASP.NET \", \"Web Forms\\ndevelopers. Each Blazor concept is presented in the context of analogous ASP.NET Web Forms\", \"\\nfeatures and practices. By the end of this book, you\\u2019ll have an understanding of:\\n\\n\\n  - How to buil\", \"d Blazor apps.\\n\\n  - How Blazor works.\\n\\n  - How Blazor relates to .NET.\\n\\n  - Reasonable strategies fo\", \"r migrating existing ASP.NET Web Forms apps to Blazor where\\nappropriate.\\n\\n### Get started with Blazo\", \"r\\n\\n\\n[Getting started with Blazor is easy. Go to https://blazor.net](https://blazor.net/) and follow \", \"the links to install the\\nappropriate .NET SDK and Blazor project templates. You\\u2019ll also find instruc\", \"tions for setting up the\\nBlazor tooling in Visual Studio or Visual Studio Code.\\n\\n\\n4 CHAPTER 1 | An i\", \"ntroduction to Blazor for ASP.NET Web Forms developers\\n\\n\\n**CHAPTER**\\n# 2\\n\\n## Architecture comparison\", \" of ASP.NET Web Forms and Blazor\\n\\n\\nWhile ASP.NET Web Forms and Blazor have many similar concepts, th\", \"ere are differences in how they\\nwork. This chapter examines the inner workings and architectures of \", \"ASP.NET Web Forms and Blazor.\\n\\n### ASP.NET Web Forms\\n\\n\\nThe ASP.NET Web Forms framework is based on a\", \" page-centric architecture. Each HTTP request for a\\nlocation in the app is a separate page with whic\", \"h ASP.NET responds. As pages are requested, the\\ncontents of the browser are replaced with the result\", \"s of the page requested.\\n\\n\\nPages consist of the following components:\\n\\n\\n  - HTML markup\\n\\n  - C# or V\", \"isual Basic code\\n\\n  - A code-behind class containing logic and event-handling capabilities\\n\\n  - Cont\", \"rols\\n\\n\\nControls are reusable units of web UI that can be programmatically placed and interacted with\", \" on a\\npage. Pages are composed of files that end with _.aspx_ containing markup, controls, and some \", \"code.\\nThe code-behind classes are in files with the same base name and an _.aspx.cs_ or _.aspx.vb_ e\", \"xtension,\\ndepending on the programming language used. Interestingly, the web server interprets conte\", \"nts of\\nthe _.aspx_ files and compiles them whenever they change. This recompilation occurs even if t\", \"he web\\nserver is already running.\\n\\n\\nControls can be built with markup and delivered as user controls\", \". A user control derives from the\\nUserControl class and has a similar structure to the Page. Markup \", \"for user controls is stored in an _.ascx_\\nfile. An accompanying code-behind class resides in an _.as\", \"cx.cs_ or _.ascx.vb_ file. Controls can also be\\nbuilt completely with code, by inheriting from eithe\", \"r the WebControl or CompositeControl base class.\\n\\n\\nPages also have an extensive event lifecycle. Eac\", \"h page raises events for the initialization, load,\\nprerender, and unload events that occur as the AS\", \"P.NET runtime executes the page\\u2019s code for each\\nrequest.\\n\\n\\n5 CHAPTER 2 | Architecture comparison of \", \"ASP.NET Web Forms and Blazor\\n\\n\\nControls on a Page typically post-back to the same page that presente\", \"d the control, and carry along\\nwith them a payload from a hidden form field called ViewState. The Vi\", \"ewState field contains\\ninformation about the state of the controls at the time they were rendered an\", \"d presented on the\\npage, allowing the ASP.NET runtime to compare and identify changes in the content\", \" submitted to the\\nserver.\\n\\n### Blazor\\n\\n\\nBlazor is a client-side web UI framework similar in nature t\", \"o JavaScript front-end frameworks like\\nAngular or React. Blazor handles user interactions and render\", \"s the necessary UI updates. Blazor _isn\\u2019t_\\nbased on a request-reply model. User interactions are han\", \"dled as events that aren\\u2019t in the context of\\nany particular HTTP request.\\n\\n\\nBlazor apps consist of o\", \"ne or more root components that are rendered on an HTML page.\\n\\n\\nHow the user specifies where compone\", \"nts should render and how the components are then wired up\\nfor user interactions is hosting model sp\", \"ecific.\\n\\n\\nBlazor components are .NET classes that represent a reusable piece of UI. Each component m\", \"aintains\\nits own state and specifies its own rendering logic, which can include rendering other comp\", \"onents.\\nComponents specify event handlers for specific user interactions to update the component\\u2019s s\", \"tate.\\n\\n\\nAfter a component handles an event, Blazor renders the component and keeps track of what cha\", \"nged\\nin the rendered output. Components don\\u2019t render directly to the Document Object Model (DOM).\\nTh\", \"ey instead render to an in-memory representation of the DOM called a RenderTree so that Blazor\\ncan t\", \"rack the changes. Blazor compares the newly rendered output with the previous output to\\ncalculate a \", \"UI diff that it then applies efficiently to the DOM.\\n\\n\\n6 CHAPTER 2 | Architecture comparison of ASP.\", \"NET Web Forms and Blazor\\n\\n\\nComponents can also manually indicate that they should be rendered if the\", \"ir state changes outside of\\na normal UI event. Blazor uses a SynchronizationContext to enforce a sin\", \"gle logical thread of\\nexecution. A component\\u2019s lifecycle methods and any event callbacks that are ra\", \"ised by Blazor are\\nexecuted on this SynchronizationContext.\\n\\n\\n7 CHAPTER 2 | Architecture comparison \", \"of ASP.NET Web Forms and Blazor\\n\\n\\n**CHAPTER**\\n# 3\\n\\n## Blazor app hosting models\\n\\n\\nBlazor apps can be\", \" hosted in one of the following ways:\\n\\n\\n  - Client-side in the browser on WebAssembly.\\n\\n  - Server-s\", \"ide in an ASP.NET Core app.\\n\\n### Blazor WebAssembly apps\\n\\n\\nBlazor WebAssembly apps execute directly \", \"in the browser on a WebAssembly-based .NET runtime.\\nBlazor WebAssembly apps function in a similar wa\", \"y to front-end JavaScript frameworks like Angular or\\nReact. However, instead of writing JavaScript y\", \"ou write C#. The .NET runtime is downloaded with the\\napp along with the app assembly and any require\", \"d dependencies. No browser plugins or extensions\\nare required.\\n\\n\\nThe downloaded assemblies are norma\", \"l .NET assemblies, like you would use in any other .NET app.\\nBecause the runtime supports .NET Stand\", \"ard, you can use existing .NET Standard libraries with your\\nBlazor WebAssembly app. However, these a\", \"ssemblies will still execute in the browser security\\n[sandbox. Some functionality may throw a Platfo\", \"rmNotSupportedException, like trying to access the](https://docs.microsoft.com/dotnet/api/system.pla\", \"tformnotsupportedexception)\\nfile system or opening arbitrary network connections.\\n\\n\\nWhen the app loa\", \"ds, the .NET runtime is started and pointed at the app assembly. The app startup\\nlogic runs, and the\", \" root components are rendered. Blazor calculates the UI updates based on the\\nrendered output from th\", \"e components. The DOM updates are then applied.\\n\\n\\n8 CHAPTER 3 | Blazor app hosting models\\n\\n\\nBlazor W\", \"ebAssembly apps run purely client-side. Such apps can be deployed to static site hosting\\nsolutions l\", \"ike GitHub Pages or Azure Static Website Hosting. .NET isn\\u2019t required on the server at all.\\nDeep lin\", \"king to parts of the app typically requires a routing solution on the server. The routing\\nsolution r\", \"edirects requests to the root of the app. For example, this redirection can be handled using\\nURL rew\", \"rite rules in IIS.\\n\\n\\nTo get all the benefits of Blazor and full-stack .NET web development, host you\", \"r Blazor WebAssembly\\napp with ASP.NET Core. By using .NET on both the client and server, you can eas\", \"ily share code and\\nbuild your app using one consistent set of languages, frameworks, and tools. Blaz\", \"or provides\\nconvenient templates for setting up a solution that contains both a Blazor WebAssembly a\", \"pp and an\\nASP.NET Core host project. When the solution is built, the built static files from the Bla\", \"zor app are\\nhosted by the ASP.NET Core app with fallback routing already setup.\\n\\n### Blazor Server a\", \"pps\\n\\n\\nRecall from the Blazor architecture discussion that Blazor components render their output to a\", \"n\\nintermediate abstraction called a RenderTree. The Blazor framework then compares what was\\nrendered\", \" with what was previously rendered. The differences are applied to the DOM. Blazor\\ncomponents are de\", \"coupled from how their rendered output is applied. Consequently, the\\ncomponents themselves don\\u2019t hav\", \"e to run in the same process as the process updating the UI. In fact,\\nthey don\\u2019t even have to run on\", \" the same machine.\\n\\n\\nIn Blazor Server apps, the components run on the server instead of client-side \", \"in the browser. UI\\nevents that occur in the browser are sent to the server over a real-time connecti\", \"on. The events are\\ndispatched to the correct component instances. The components render, and the cal\", \"culated UI diff is\\nserialized and sent to the browser where it\\u2019s applied to the DOM.\\n\\n\\n9 CHAPTER 3 |\", \" Blazor app hosting models\\n\\n\\nThe Blazor Server hosting model may sound familiar if you\\u2019ve used ASP.N\", \"ET AJAX and the\\n[UpdatePanel](https://docs.microsoft.com/dotnet/api/system.web.ui.updatepanel) contr\", \"ol. The UpdatePanel control handles applying partial page updates in response to\\ntrigger events on t\", \"he page. When triggered, the UpdatePanel requests a partial update and then\\napplies it without needi\", \"ng to refresh the page. The state of the UI is managed using ViewState. Blazor\\nServer apps are sligh\", \"tly different in that the app requires an active connection with the client.\\nAdditionally, all UI st\", \"ate is maintained on the server. Aside from those differences, the two models are\\nconceptually simil\", \"ar.\\n\\n### How to choose the right Blazor hosting model\\n\\n\\n[As described in the Blazor hosting model do\", \"cs, the different Blazor hosting models have different](https://docs.microsoft.com/aspnet/core/blazo\", \"r/hosting-models)\\ntradeoffs.\\n\\n\\nThe Blazor WebAssembly hosting model has the following benefits:\\n\\n\\n  \", \"- There\\u2019s no .NET server-side dependency. The app is fully functioning after downloaded to the\\nclien\", \"t.\\n\\n  - Client resources and capabilities are fully leveraged.\\n\\n  - Work is offloaded from the serve\", \"r to the client.\\n\\n  - An ASP.NET Core web server isn\\u2019t required to host the app. Serverless deployme\", \"nt scenarios\\nare possible (for example, serving the app from a CDN).\\n\\n\\nThe downsides of the Blazor W\", \"ebAssembly hosting model are:\\n\\n\\n  - Browser capabilities restrict the app.\\n\\n  - Capable client hardw\", \"are and software (for example, WebAssembly support) is required.\\n\\n  - Download size is larger, and a\", \"pps take longer to load.\\n\\n\\n10 CHAPTER 3 | Blazor app hosting models\\n\\n\\n  - [.NET runtime and tooling \", \"support is less mature. For example, there are limitations in .NET](https://docs.microsoft.com/en-us\", \"/dotnet/standard/net-standard)\\n[Standard](https://docs.microsoft.com/en-us/dotnet/standard/net-stand\", \"ard) support and debugging.\\n\\n\\nConversely, the Blazor Server hosting model offers the following benef\", \"its:\\n\\n\\n  - Download size is much smaller than a client-side app, and the app loads much faster.\\n\\n  -\", \" The app takes full advantage of server capabilities, including use of any .NET compatible APIs.\\n\\n  \", \"- .NET on the server is used to run the app, so existing .NET tooling, such as debugging, works\\nas e\", \"xpected.\\n\\n  - Thin clients are supported. For example, server-side apps work with browsers that don\\u2019\", \"t\\nsupport WebAssembly and on resource-constrained devices.\\n\\n  - The app\\u2019s .NET/C# code base, includi\", \"ng the app\\u2019s component code, isn\\u2019t served to clients.\\n\\n\\nThe downsides to the Blazor Server hosting m\", \"odel are:\\n\\n\\n  - Higher UI latency. Every user interaction involves a network hop.\\n\\n  - There\\u2019s no of\", \"fline support. If the client connection fails, the app stops working.\\n\\n  - Scalability is challengin\", \"g for apps with many users. The server must manage multiple client\\nconnections and handle client sta\", \"te.\\n\\n  - An ASP.NET Core server is required to serve the app. Serverless deployment scenarios aren\\u2019t\", \"\\npossible. For example, you can\\u2019t serve the app from a CDN.\\n\\n\\nThe preceding list of trade-offs may b\", \"e intimidating, but your hosting model can be changed later.\\nRegardless of the Blazor hosting model \", \"selected, the component model is _the same_ . In principle, the\\nsame components can be used with eit\", \"her hosting model. Your app code doesn\\u2019t change; however,\\nit\\u2019s a good practice to introduce abstract\", \"ions so that your components stay hosting model-agnostic.\\nThe abstractions allow your app to more ea\", \"sily adopt a different hosting model.\\n\\n### Deploy your app\\n\\n\\nASP.NET Web Forms apps are typically ho\", \"sted on IIS on a Windows Server machine or cluster. Blazor\\napps can also:\\n\\n\\n  - Be hosted on IIS, ei\", \"ther as static files or as an ASP.NET Core app.\\n\\n  - Leverage ASP.NET Core\\u2019s flexibility to be hoste\", \"d on various platforms and server\\n[infrastructures. For example, you can host a Blazor App using Ngi\", \"nx](https://docs.microsoft.com/aspnet/core/host-and-deploy/linux-nginx) [or Apache on Linux. For](ht\", \"tps://docs.microsoft.com/aspnet/core/host-and-deploy/linux-apache)\\n[more information about how to pu\", \"blish and deploy Blazor apps, see the Blazor Hosting and](https://docs.microsoft.com/aspnet/core/hos\", \"t-and-deploy/blazor/)\\n[deployment](https://docs.microsoft.com/aspnet/core/host-and-deploy/blazor/) d\", \"ocumentation.\\n\\n\\nIn the next section, we\\u2019ll look at how the projects for Blazor WebAssembly and Blazo\", \"r Server apps are\\nset up.\\n\\n\\n11 CHAPTER 3 | Blazor app hosting models\\n\\n\\n**CHAPTER**\\n# 4\\n\\n## Project s\", \"tructure for Blazor apps\\n\\n\\nDespite their significant project structure differences, ASP.NET Web Form\", \"s and Blazor share many\\nsimilar concepts. Here, we\\u2019ll look at the structure of a Blazor project and \", \"compare it to an ASP.NET\\nWeb Forms project.\\n\\n\\n[To create your first Blazor app, follow the instructi\", \"ons in the Blazor getting started steps. You can](https://docs.microsoft.com/aspnet/core/blazor/get-\", \"started)\\nfollow the instructions to create either a Blazor Server app or a Blazor WebAssembly app ho\", \"sted in\\nASP.NET Core. Except for the hosting model-specific logic, most of the code in both projects\", \" is the\\nsame.\\n\\n### Project file\\n\\n\\nBlazor Server apps are .NET projects. The project file for the Bla\", \"zor Server app is about as simple as it\\ncan get:\\n\\n\\n12 CHAPTER 4 | Project structure for Blazor apps\\n\", \"\\n\\nBlazor WebAssembly project targets Microsoft.NET.Sdk.BlazorWebAssembly instead of\\nMicrosoft.NET.Sd\", \"k.Web sdk because they run in the browser on a WebAssembly-based .NET runtime.\\nYou can\\u2019t install .NE\", \"T into a web browser like you can on a server or developer machine.\\nConsequently, the project refere\", \"nces the Blazor framework using individual package references.\\n\\n\\nBy comparison, a default ASP.NET We\", \"b Forms project includes almost 300 lines of XML in its _.csproj_\\nfile, most of which is explicitly \", \"listing the various code and content files in the project. Since the\\nrelease of .NET 5, both Blazor \", \"Server and Blazor WebAssembly apps can easily share one unified\\nruntime.\\n\\n\\nAlthough they\\u2019re supporte\", \"d, individual assembly references are less common in .NET projects. Most\\nproject dependencies are ha\", \"ndled as NuGet package references. You only need to reference top-level\\npackage dependencies in .NET\", \" projects. Transitive dependencies are included automatically. Instead of\\nusing the _packages.config\", \"_ file commonly found in ASP.NET Web Forms projects to reference packages,\\npackage references are ad\", \"ded to the project file using the <PackageReference> element.\\n\\n### Entry point\\n\\n\\nThe Blazor Server a\", \"pp\\u2019s entry point is defined in the _Program.cs_ file, as you would see in a Console\\napp. When the ap\", \"p executes, it creates and runs a web host instance using defaults specific to web\\napps. The web hos\", \"t manages the Blazor Server app\\u2019s lifecycle and sets up host-level services.\\nExamples of such servic\", \"es are configuration, logging, dependency injection, and the HTTP server. This\\ncode is mostly boiler\", \"plate and is often left unchanged.\\n\\n\\n13 CHAPTER 4 | Project structure for Blazor apps\\n\\n\\nBlazor WebAs\", \"sembly apps also define an entry point in _Program.cs_ . The code looks slightly different.\\nThe code\", \" is similar in that it\\u2019s setting up the app host to provide the same host-level services to the\\napp.\", \" The WebAssembly app host doesn\\u2019t, however, set up an HTTP server because it executes directly\\nin th\", \"e browser.\\n\\n\\nBlazor apps don\\u2019t use a _Global.asax_ file to define the startup logic for the app. Ins\", \"tead, this logic is\\ncontained in _Program.cs_ or in a related Startup class that is referenced from \", \"_Program.cs_ . Either way,\\nthis code is used to configure the app and any app-specific services.\\n\\n\\nI\", \"n a Blazor Server app, the _Program.cs_ file shown is used to set up the endpoint for the real-time\\n\", \"connection used by Blazor between the client browsers and the server.\\n\\n\\nIn a Blazor WebAssembly app,\", \" the _Program.cs_ file defines the root components for the app and where\\nthey should be rendered:\\n\\n\\n\", \"14 CHAPTER 4 | Project structure for Blazor apps\\n\\n\\n### Static files\\n\\nUnlike ASP.NET Web Forms projec\", \"ts, not all files in a Blazor project can be requested as static files.\\nOnly the files in the _wwwro\", \"ot_ folder are web-addressable. This folder is referred to as the app\\u2019s \\u201cweb\\nroot\\u201d. Anything outside\", \" of the app\\u2019s web root _isn\\u2019t_ web-addressable. This setup provides an additional\\nlevel of security \", \"that prevents accidental exposure of project files over the web.\\n\\n### Configuration\\n\\n\\nConfiguration \", \"in ASP.NET Web Forms apps is typically handled using one or more _web.config_ files.\\nBlazor apps don\", \"\\u2019t typically have _web.config_ files. If they do, the file is only used to configure IISspecific set\", \"tings when hosted on IIS. Instead, Blazor Server apps use the ASP.NET Core configuration\\nabstraction\", \"s. (Blazor WebAssembly apps don\\u2019t currently support the same configuration abstractions,\\nbut that ma\", \"y be a feature added in the future.) For example, the default Blazor Server app stores some\\nsettings\", \" in _appsettings.json_ .\\n\\n\\nYou\\u2019ll learn more about configuration in ASP.NET Core projects in the Con\", \"figuration section.\\n\\n### Razor components\\n\\n\\nMost files in Blazor projects are _.razor_ files. Razor \", \"is a templating language based on HTML and C#\\nthat is used to dynamically generate web UI. The _.raz\", \"or_ files define components that make up the UI\\nof the app. For the most part, the components are id\", \"entical for both the Blazor Server and Blazor\\nWebAssembly apps. Components in Blazor are analogous t\", \"o user controls in ASP.NET Web Forms.\\n\\n\\nEach Razor component file is compiled into a .NET class when\", \" the project is built. The generated class\\ncaptures the component\\u2019s state, rendering logic, lifecycl\", \"e methods, event handlers, and other logic.\\nYou\\u2019ll learn more about authoring components in the Buil\", \"ding reusable UI components with Blazor\\nsection.\\n\\n\\nThe *_Imports.razor* files aren\\u2019t Razor component\", \" files. Instead, they define a set of Razor directives to\\nimport into other _.razor_ files within th\", \"e same folder and in its subfolders. For example, a\\n*_Imports.razor* file is a conventional way to a\", \"dd using directives for commonly used namespaces:\\n\\n\\n15 CHAPTER 4 | Project structure for Blazor apps\", \"\\n\\n\\n### Pages\\n\\nWhere are the pages in the Blazor apps? Blazor doesn\\u2019t define a separate file extensio\", \"n for\\naddressable pages, like the _.aspx_ files in ASP.NET Web Forms apps. Instead, pages are define\", \"d by\\nassigning routes to components. A route is typically assigned using the @page Razor directive. \", \"For\\nexample, the Counter component authored in the _Pages/Counter.razor_ file defines the following \", \"route:\\n\\n```\\n@page \\\"/counter\\\"\\n\\n```\\n\\nRouting in Blazor is handled client-side, not on the server. As t\", \"he user navigates in the browser, Blazor\\nintercepts the navigation and then renders the component wi\", \"th the matching route.\\n\\n\\nThe component routes aren\\u2019t currently inferred by the component\\u2019s file loca\", \"tion like they are with\\n_.aspx_ pages or ASP.NET Core Razor Pages. This feature may be added in the \", \"future. Each route must\\nbe specified explicitly on the component. Storing routable components in a _\", \"Pages_ folder has no\\nspecial meaning and is purely a convention.\\n\\n\\nYou\\u2019ll learn more about routing i\", \"n Blazor in the Pages, routing, and layouts section.\\n\\n### Layout\\n\\n\\nIn ASP.NET Web Forms apps, a comm\", \"on page layout is handled using master pages ( _Site.Master_ ). In\\nBlazor apps, the page layout is h\", \"andled using layout components ( _Shared/MainLayout.razor_ ). Layout\\ncomponents are discussed in mor\", \"e detail in the Page, routing, and layouts section.\\n\\n### Bootstrap Blazor\\n\\n\\nTo bootstrap Blazor, the\", \" app must:\\n\\n\\n  - Specify where on the page the root component ( _App.Razor_ ) should be rendered.\\n\\n \", \" - Add the corresponding Blazor framework script.\\n\\n\\nIn the Blazor Server app, the root component\\u2019s h\", \"ost page is defined in the *_Host.cshtml* file. This file\\ndefines a Razor Page, not a component. Raz\", \"or Pages use Razor syntax to define a server-addressable\\npage, very much like an _.aspx_ page.\\n\\n\\n16 \", \"CHAPTER 4 | Project structure for Blazor apps\\n\\n\\nThe render-mode attribute is used to define where a \", \"root-level component should be rendered. The\\nRenderMode option indicates the manner in which the com\", \"ponent should be rendered. The following\\ntable outlines the supported RenderMode options.\\n\\n|Option|D\", \"escription|\\n|---|---|\\n|RenderMode.Server|Rendered interactively once a<br>connection with the browse\", \"r is<br>established|\\n|RenderMode.ServerPrerendered|First prerendered and then rendered<br>interactiv\", \"ely|\\n|RenderMode.Static|Rendered as static content|\\n\\n\\n\\nThe *_Layout.cshtml* file includes the defaul\", \"t HTML for the app and its components.\\n\\n\\nThe script reference to *_framework/blazor.server.js* estab\", \"lishes the real-time connection with the\\nserver and then deals with all user interactions and UI upd\", \"ates.\\n\\n\\n17 CHAPTER 4 | Project structure for Blazor apps\\n\\n\\nIn the Blazor WebAssembly app, the host p\", \"age is a simple static HTML file under _wwwroot/index.html_ .\\nThe <div> element with id named app is\", \" used to indicate where the root component should be\\nrendered.\\n\\n\\nThe root component to render is spe\", \"cified in the app\\u2019s _Program.cs_ file with the flexibility to register\\n[services through dependency \", \"injection. For more information, see ASP.NET Core Blazor dependency](https://docs.microsoft.com/aspn\", \"et/core/blazor/fundamentals/dependency-injection?pivots=webassembly)\\n[injection.](https://docs.micro\", \"soft.com/aspnet/core/blazor/fundamentals/dependency-injection?pivots=webassembly)\\n\\n### Build output\\n\", \"\\n\\nWhen a Blazor project is built, all Razor component and code files are compiled into a single\\nasse\", \"mbly. Unlike ASP.NET Web Forms projects, Blazor doesn\\u2019t support runtime compilation of the UI\\nlogic.\", \"\\n\\n### Run the app with Hot Reload\\n\\n\\nTo run the Blazor Server app, press F5 in Visual Studio to run w\", \"ith the debugger attached, or Ctrl + F5\\nto run without the debugger attached.\\n\\n\\nTo run the Blazor We\", \"bAssembly app, choose one of the following approaches:\\n\\n\\n  - Run the client project directly using t\", \"he development server.\\n\\n\\n18 CHAPTER 4 | Project structure for Blazor apps\\n\\n\\n  - Run the server proje\", \"ct when hosting the app with ASP.NET Core.\\n\\n\\n[Blazor WebAssembly apps can be debugged in both browse\", \"r and Visual Studio. See Debug ASP.NET](https://docs.microsoft.com/aspnet/core/blazor/debug)\\n[Core B\", \"lazor WebAssembly for details.](https://docs.microsoft.com/aspnet/core/blazor/debug)\\n\\n\\nBoth Blazor S\", \"erver and Blazor WebAssembly apps support Hot Reload in Visual Studio. Hot Reload is\\na feature that \", \"automatically updates changes made to a Blazor app live, in the browser. You can\\ntoggle whether Hot \", \"Reload is enabled from its icon in the toolbar:\\n\\n\\nSelecting the caret beside the icon reveals additi\", \"onal options. You can toggle Hot Reload on or off,\\nrestart the application, and toggle whether Hot R\", \"eload should occur whenever a file is saved.\\n\\n\\nYou can also access additional configuration options.\", \" The configuration dialog lets you specify\\nwhether Hot Reload should be enabled when debugging (alon\", \"g with Edit and Continue), when\\nstarting without debugging, or when a file is saved.\\n\\n\\n19 CHAPTER 4 \", \"| Project structure for Blazor apps\\n\\n\\nThe \\u201cdeveloper inner loop\\u201d has been greatly streamlined with H\", \"ot Reload. Without Hot Reload, a\\nBlazor developer would typically need to restart and rerun the app \", \"after every change, navigating to\\nthe appropriate part of the app as required. With Hot Reload, chan\", \"ges can be made to the running\\napp without the need to restart in most cases. Hot Reload even retain\", \"s the state of pages, so there\\u2019s\\nno need to have to re-enter form values or otherwise get the app ba\", \"ck where you need it.\\n\\n\\n20 CHAPTER 4 | Project structure for Blazor apps\\n\\n\\n**CHAPTER**\\n# 5\\n\\n## App s\", \"tartup\\n\\n\\nApplications that are written for ASP.NET typically have a global.asax.cs file that defines\", \" the\\nApplication_Start event that controls which services are configured and made available for both\", \" HTML\\nrendering and .NET processing. This chapter looks at how things are slightly different with AS\", \"P.NET\\nCore and Blazor Server.\\n\\n### Application_Start and Web Forms\\n\\n\\nThe default web forms Applicati\", \"on_Start method has grown in purpose over years to handle many\\nconfiguration tasks. A fresh web form\", \"s project with the default template in Visual Studio 2022 now\\ncontains the following configuration l\", \"ogic:\\n\\n\\n  - RouteConfig - Application URL routing\\n\\n  - BundleConfig - CSS and JavaScript bundling an\", \"d minification\\n\\nEach of these individual files resides in the App_Start folder and run only once at \", \"the start of our\\napplication. RouteConfig in the default project template adds the FriendlyUrlSettin\", \"gs for web forms to\\nallow application URLs to omit the .ASPX file extension. The default template al\", \"so contains a directive\\nthat provides permanent HTTP redirect status codes (HTTP 301) for the .ASPX \", \"pages to the friendly\\nURL with the file name that omits the extension.\\n\\n\\nWith ASP.NET Core and Blazo\", \"r, these methods are either simplified and consolidated into the Startup\\nclass or they are eliminate\", \"d in favor of common web technologies.\\n\\n### Blazor Server Startup Structure\\n\\n\\nBlazor Server applicat\", \"ions reside on top of an ASP.NET Core 3.0 or later version. ASP.NET Core web\\napplications are config\", \"ured in _Program.cs_, or through a pair of methods in the Startup.cs class. A\\nsample _Program.cs_ fi\", \"le is shown below:\\n\\n\\n21 CHAPTER 5 | App startup\\n\\n\\nThe app\\u2019s required services are added to the WebAp\", \"plicationBuilder instance\\u2019s Services collection.\\nThis is how the various ASP.NET Core framework serv\", \"ices are configured with the framework\\u2019s built-in\\ndependency injection container. The various builde\", \"r.Services.Add* methods add services that enable\\nfeatures such as authentication, razor pages, MVC c\", \"ontroller routing, SignalR, and Blazor Server\\ninteractions among many others. This method was not ne\", \"eded in web forms, as the parsing and\\nhandling of the ASPX, ASCX, ASHX, and ASMX files were defined \", \"by referencing ASP.NET in the\\nweb.config configuration file. More information about dependency injec\", \"tion in ASP.NET Core is\\n[available in the online documentation.](https://docs.microsoft.com/aspnet/c\", \"ore/fundamentals/dependency-injection)\\n\\n\\nAfter the app has been built by the builder, the rest of th\", \"e calls on app configure its HTTP pipeline.\\nWith these calls, we declare from top to bottom the Midd\", \"leware that will handle every request sent to\\nour application. Most of these features in the default\", \" configuration were scattered across the web\\nforms configuration files and are now in one place for \", \"ease of reference.\\n\\n\\nNo longer is the configuration of the custom error page placed in a web.config \", \"file, but now is\\nconfigured to always be shown if the application environment is not labeled Develop\", \"ment.\\nAdditionally, ASP.NET Core applications are now configured to serve secure pages with TLS by d\", \"efault\\nwith the UseHttpsRedirection method call.\\n\\n\\nNext, an unexpected configuration method call is \", \"made to UseStaticFiles. In ASP.NET Core, support for\\nrequests for static files (like JavaScript, CSS\", \", and image files) must be explicitly enabled, and only files\\nin the app\\u2019s _wwwroot_ folder are publ\", \"icly addressable by default.\\n\\n\\nThe next line is the first that replicates one of the configuration o\", \"ptions from web forms: UseRouting.\\nThis method adds the ASP.NET Core router to the pipeline and it c\", \"an be either configured here or in\\nthe individual files that it can consider routing to. More inform\", \"ation about routing configuration can\\nbe found in the Routing section.\\n\\n\\nThe final app.Map* calls in\", \" this section define the endpoints that ASP.NET Core is listening on. These\\nroutes are the web acces\", \"sible locations that you can access on the web server and receive some\\ncontent handled by .NET and r\", \"eturned to you. The first entry, MapBlazorHub configures a SignalR hub\\nfor use in providing the real\", \"-time and persistent connection to the server where the state and\\nrendering of Blazor components is \", \"handled. The MapFallbackToPage method call indicates the webaccessible location of the page that sta\", \"rts the Blazor application and also configures the application to\\n\\n\\n22 CHAPTER 5 | App startup\\n\\n\\nhan\", \"dle deep-linking requests from the client-side. You will see this feature at work if you open a\\nbrow\", \"ser and navigate directly to Blazor handled route in your application, such as /counter in the\\ndefau\", \"lt project template. The request gets handled by the *_Host.cshtml* fallback page, which then\\nruns t\", \"he Blazor router and renders the counter page.\\n\\n\\nThe very last line starts the application, somethin\", \"g that wasn\\u2019t required in web forms (since it relied on\\nIIS to be running).\\n\\n### Upgrading the Bundl\", \"eConfig Process\\n\\n\\nTechnologies for bundling assets like CSS stylesheets and JavaScript files have ch\", \"anged significantly,\\nwith other technologies providing quickly evolving tools and techniques for man\", \"aging these\\nresources. To this end, we recommend using a Node command-line tool such as Grunt / Gulp\", \" /\\nWebPack to package your static assets.\\n\\n\\nThe Grunt, Gulp, and WebPack command-line tools and thei\", \"r associated configurations can be added\\nto your application and ASP.NET Core will quietly ignore th\", \"ose files during the application build\\nprocess. You can add a call to run their tasks by adding a Ta\", \"rget inside your project file with syntax\\nsimilar to the following that would trigger a gulp script \", \"and the min target inside that script:\\n\\n\\n[More details about both strategies to manage your CSS and \", \"JavaScript files are available in the Bundle](https://docs.microsoft.com/aspnet/core/client-side/bun\", \"dling-and-minification)\\n[and minify static assets in ASP.NET Core documentation.](https://docs.micro\", \"soft.com/aspnet/core/client-side/bundling-and-minification)\\n\\n\\n23 CHAPTER 5 | App startup\\n\\n\\n**CHAPTER\", \"**\\n# 6\\n\\n## Build reusable UI components with Blazor\\n\\n\\nOne of the beautiful things about ASP.NET Web \", \"Forms is how it enables encapsulation of reusable\\npieces of user interface (UI) code into reusable U\", \"I controls. Custom user controls can be defined in\\nmarkup using _.ascx_ files. You can also build el\", \"aborate server controls in code with full designer\\nsupport.\\n\\n\\nBlazor also supports UI encapsulation \", \"through _components_ . A component:\\n\\n\\n  - Is a self-contained chunk of UI.\\n\\n  - Maintains its own st\", \"ate and rendering logic.\\n\\n  - Can define UI event handlers, bind to input data, and manage its own l\", \"ifecycle.\\n\\n  - Is typically defined in a _.razor_ file using Razor syntax.\\n\\n### An introduction to R\", \"azor\\n\\n\\nRazor is a light-weight markup templating language based on HTML and C#. With Razor, you can\\n\", \"seamlessly transition between markup and C# code to define your component rendering logic. When\\nthe \", \"_.razor_ file is compiled, the rendering logic is captured in a structured way in a .NET class. The \", \"name\\nof the compiled class is taken from the _.razor_ file name. The namespace is taken from the def\", \"ault\\nnamespace for the project and the folder path, or you can explicitly specify the namespace usin\", \"g the\\n@namespace directive (more on Razor directives below).\\n\\n\\nA component\\u2019s rendering logic is auth\", \"ored using normal HTML markup with dynamic logic added\\nusing C#. The @ character is used to transiti\", \"on to C#. Razor is typically smart about figuring out when\\nyou\\u2019ve switched back to HTML. For example\", \", the following component renders a <p> tag with the\\ncurrent time:\\n\\n```\\n<p>@DateTime.Now</p>\\n\\n```\\n\\nT\", \"o explicitly specify the beginning and ending of a C# expression, use parentheses:\\n\\n```\\n<p>@(DateTim\", \"e.Now)</p>\\n\\n```\\n\\nRazor also makes it easy to use C# control flow in your rendering logic. For exampl\", \"e, you can\\nconditionally render some HTML like this:\\n\\n\\n24 CHAPTER 6 | Build reusable UI components w\", \"ith Blazor\\n\\n\\nOr you can generate a list of items using a normal C# foreach loop like this:\\n\\n\\nRazor d\", \"irectives, like directives in ASP.NET Web Forms, control many aspects of how a Razor\\ncomponent is co\", \"mpiled. Examples include the component\\u2019s:\\n\\n\\n  - Namespace\\n\\n  - Base class\\n\\n  - Implemented interface\", \"s\\n\\n  - Generic parameters\\n\\n  - Imported namespaces\\n\\n  - Routes\\n\\n\\nRazor directives start with the @ c\", \"haracter and are typically used at the start of a new line at the start\\nof the file. For example, th\", \"e @namespace directive defines the component\\u2019s namespace:\\n\\n```\\n@namespace MyComponentNamespace\\n\\n```\\n\", \"\\nThe following table summarizes the various Razor directives used in Blazor and their ASP.NET Web\\nFo\", \"rms equivalents, if they exist.\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n|Directive|Description|Example|Web Forms equivalent|\\n|\", \"---|---|---|---|\\n|@attribute|Adds a class-level<br>attribute to the<br>component|@attribute<br>[Auth\", \"orize]|None|\\n|@code|Adds class<br>members to the<br>component|@code { ... }|<script runat=\\\"server\\\">.\", \"..</script>|\\n|@implements|Implements the<br>specified interface|@impleme<br>nts<br>IDisposable|Use c\", \"ode-behind|\\n|@inherits|Inherits from the<br>specified base class|@inherits<br>MyCompon<br>entBase|<%\", \"@ Control<br>Inherits=\\\"MyUserControlBase\\\" %>|\\n|@inject|Injects a service<br>into the component|@inje\", \"ct<br>IJSRuntime<br>JS|None|\\n\\n\\n\\n25 CHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\n|Directive\", \"|Description|Example|Web Forms equivalent|\\n|---|---|---|---|\\n|@layout|Specifies a layout<br>componen\", \"t for the<br>component|@layout<br>MainLayout|<%@ Page<br>MasterPageFile=\\\"~/Site.Master\\\" %>|\\n|@namesp\", \"ace|Sets the namespace<br>for the component|@namespa<br>ce<br>MyNamesp<br>ace|None|\\n|@page|Specifies\", \" the route<br>for the component|@page<br>\\\"/product/{i<br>d}\\\"|<%@ Page %>|\\n|@typeparam|Specifies a ge\", \"neric<br>type parameter for<br>the component|@typepara<br>m TItem|Use code-behind|\\n|@using|Specifies\", \" a<br>namespace to bring<br>into scope|@using<br>MyCompon<br>entNamesp<br>ace|Add namespace in_web.c\", \"onfig_|\\n\\n\\n\\nRazor components also make extensive use of _directive attributes_ on elements to control\", \" various\\naspects of how components get compiled (event handling, data binding, component & element\\nr\", \"eferences, and so on). Directive attributes all follow a common generic syntax where the values in\\np\", \"arenthesis are optional:\\n\\n```\\n@directive(-suffix(:name))(=\\\"value\\\")\\n\\n```\\n\\nThe following table summari\", \"zes the various attributes for Razor directives used in Blazor.\\n\\n\\n\\n\\n\\n\\n|Attribute|Description|Example\", \"|\\n|---|---|---|\\n|@attributes|Renders a dictionary of attributes|<input<br>@attributes=\\\"ExtraA<br>ttr\", \"ibutes\\\" />|\\n|@bind|Creates a two-way data binding|<input<br>@bind=\\\"username\\\"<br>@bind:event=\\\"oninp<b\", \"r>ut\\\" />|\\n|@on{event}|Adds an event handler for the<br>specified event|<button<br>@onclick=\\\"Incremen\", \"<br>tCount\\\">Click<br>me!</button>|\\n|@key|Specifies a key to be used by the<br>diffing algorithm for \", \"preserving<br>elements in a collection|<DetailsEditor<br>@key=\\\"person\\\"<br>Details=\\\"person.Det<br>ail\", \"s\\\" />|\\n\\n\\n\\n26 CHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\n|Attribute|Description|Example|\\n\", \"|---|---|---|\\n|@ref|Captures a reference to the<br>component or HTML element|<MyDialog<br>@ref=\\\"myDi\", \"alog\\\" />|\\n\\n\\n\\nThe various directive attributes used by Blazor (@onclick, @bind, @ref, and so on) are \", \"covered in the\\nsections below and later chapters.\\n\\n\\nMany of the syntaxes used in _.aspx_ and _.ascx_\", \" files have parallel syntaxes in Razor. Below is a simple\\ncomparison of the syntaxes for ASP.NET Web\", \" Forms and Razor.\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n|Feature|Web Forms|Syntax|Razor|Synt<br>ax|\\n|---|---|---|---|---|\\n|D\", \"irectives|<%@ [directive] %>|<%@ Page %>|@[directive]|@pa<br>ge|\\n|Code blocks|<% %>|<% int x = 123; \", \"%>|@{ }|@{<br>int x<br>= <br>123; }|\\n|Expressions<br>(HTML-encoded)|<%: %>|<%:DateTime.Now<br>%>|Imp\", \"licit: @<br>Explicit: @()|@Da<br>teTi<br>me.N<br>ow<br>@(Da<br>teTi<br>me.N<br>ow)|\\n|Comments|<%-- -\", \"-%>|<%-- Commented --<br>%>|@* *@|@*<br>Com<br>ment<br>ed<br>*@|\\n|Data binding|<%# %>|<%# Bind(\\\"Name\", \"\\\")<br>%>|@bind|<inp<br>ut<br>@bin<br>d=\\\"u<br>serna<br>me\\\"<br>/>|\\n\\n\\n\\nTo add members to the Razor comp\", \"onent class, use the @code directive. This technique is similar to\\nusing a <script runat=\\\"server\\\">..\", \".</script> block in an ASP.NET Web Forms user control or page.\\n\\n\\n27 CHAPTER 6 | Build reusable UI co\", \"mponents with Blazor\\n\\n\\nBecause Razor is based on C#, it must be compiled from within a C# project ( \", \"_.csproj_ ). You can\\u2019t\\ncompile _.razor_ files from a Visual Basic project ( _.vbproj_ ). You can sti\", \"ll reference Visual Basic projects\\nfrom your Blazor project. The opposite is true too.\\n\\n\\n[For a full\", \" Razor syntax reference, see Razor syntax reference for ASP.NET Core.](https://docs.microsoft.com/as\", \"pnet/core/mvc/views/razor)\\n\\n### Use components\\n\\n\\nAside from normal HTML, components can also use oth\", \"er components as part of their rendering logic.\\nThe syntax for using a component in Razor is similar\", \" to using a user control in an ASP.NET Web Forms\\napp. Components are specified using an element tag \", \"that matches the type name of the component.\\nFor example, you can add a Counter component like this:\", \"\\n\\n```\\n<Counter />\\n\\n```\\n\\nUnlike ASP.NET Web Forms, components in Blazor:\\n\\n\\n  - Don\\u2019t use an element p\", \"refix (for example, asp:).\\n\\n  - Don\\u2019t require registration on the page or in the _web.config_ .\\n\\n\\nTh\", \"ink of Razor components like you would .NET types, because that\\u2019s exactly what they are. If the\\nasse\", \"mbly containing the component is referenced, then the component is available for use. To bring\\nthe c\", \"omponent\\u2019s namespace into scope, apply the @using directive:\\n\\n\\nAs seen in the default Blazor project\", \"s, it\\u2019s common to put @using directives into a *_Imports.razor* file\\nso that they\\u2019re imported into a\", \"ll _.razor_ files in the same directory and in child directories.\\n\\n\\nIf the namespace for a component\", \" isn\\u2019t in scope, you can specify a component using its full type\\nname, as you can in C#:\\n\\n```\\n<MyCom\", \"ponentLib.Counter />\\n\\n### Modify page title from components\\n\\n```\\n\\nWhen building SPA-style apps, it\\u2019s\", \" common for parts of a page to reload without reloading the entire\\npage. Even so, it can be useful t\", \"o have the title of the page change based on which component is\\ncurrently loaded. This can be accomp\", \"lished by including the <PageTitle> tag in the component\\u2019s\\nRazor page:\\n\\n\\nThe contents of this elemen\", \"t can be dynamic, for instance showing the current count of messages:\\n\\n\\n28 CHAPTER 6 | Build reusabl\", \"e UI components with Blazor\\n\\n\\n```\\n<PageTitle>@MessageCount messages</PageTitle>\\n\\n```\\n\\nNote that if s\", \"everal components on a particular page include <PageTitle> tags, only the last one will\\nbe displayed\", \" (since each one will overwrite the previous one).\\n\\n### Component parameters\\n\\n\\nIn ASP.NET Web Forms,\", \" you can flow parameters and data to controls using public properties. These\\nproperties can be set i\", \"n markup using attributes or set directly in code. Razor components work in a\\nsimilar fashion, altho\", \"ugh the component properties must also be marked with the [Parameter]\\nattribute to be considered com\", \"ponent parameters.\\n\\n\\nThe following Counter component defines a component parameter called IncrementA\", \"mount that can\\nbe used to specify the amount that the Counter should be incremented each time the bu\", \"tton is\\nclicked.\\n\\n\\nTo specify a component parameter in Blazor, use an attribute as you would in ASP.\", \"NET Web Forms:\\n\\n```\\n<Counter IncrementAmount=\\\"10\\\" />\\n\\n#### **Query string parameters**\\n\\n```\\n\\nRazor c\", \"omponents can also leverage values from the query string of the page they\\u2019re rendered on as\\na parame\", \"ter source. To enable this, add the [SupplyParameterFromQuery] attribute to the parameter.\\nFor examp\", \"le, the following parameter definition would get its value from the request in the form\\n?IncBy=2:\\n\\n\\n\", \"If you don\\u2019t supply a custom Name in the [SupplyParameterFromQuery] attribute, by default it will\\nma\", \"tch the property name (IncrementAmount in this case).\\n\\n\\n29 CHAPTER 6 | Build reusable UI components \", \"with Blazor\\n\\n\\n### Components and error boundaries\\n\\nBy default, Blazor apps will detect unhandled exc\", \"eptions and show an error message at the bottom of\\nthe page with no additional detail. To constrain \", \"the parts of the app that are impacted by an\\nunhandled error, for instance to limit the impact to a \", \"single component, the <ErrorBoundary> tag can\\nbe wrapped around component declarations.\\n\\n\\nFor exampl\", \"e, to protect against possible exceptions thrown from the Counter component, declare it\\nwithin an <E\", \"rrorBoundary> and optionally specify a message to display if there is an exception:\\n\\n\\nA default mess\", \"age stating \\u201cAn error as occurred.\\u201d will be displayed if an unhandled exception occurs\\nin the wrappe\", \"d component.\\n\\n### Event handlers\\n\\n\\nBoth ASP.NET Web Forms and Blazor provide an event-based programm\", \"ing model for handling UI\\nevents. Examples of such events include button clicks and text input. In A\", \"SP.NET Web Forms, you use\\nHTML server controls to handle UI events exposed by the DOM, or you can ha\", \"ndle events exposed by\\nweb server controls. The events are surfaced on the server through form post-\", \"back requests. Consider\\nthe following Web Forms button click example:\\n\\n\\n_Counter.ascx_\\n\\n\\nIn Blazor, \", \"you can register handlers for DOM UI events directly using directive attributes of the form\\n@on{even\", \"t}. The {event} placeholder represents the name of the event. For example, you can listen for\\nbutton\", \" clicks like this:\\n\\n\\n30 CHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\nEvent handlers can ac\", \"cept an optional, event-specific argument to provide more information about\\nthe event. For example, \", \"mouse events can take a MouseEventArgs argument, but it isn\\u2019t required.\\n\\n\\nInstead of referring to a \", \"method group for an event handler, you can use a lambda expression. A\\nlambda expression allows you t\", \"o close over other in-scope values.\\n\\n\\nEvent handlers can execute synchronously or asynchronously. Fo\", \"r example, the following OnClick\\nevent handler executes asynchronously:\\n\\n\\nAfter an event is handled,\", \" the component is rendered to account for any component state changes.\\nWith asynchronous event handl\", \"ers, the component is rendered immediately after the handler\\nexecution completes. The component is r\", \"endered _again_ after the asynchronous Task completes. This\\nasynchronous execution mode provides an \", \"opportunity to render some appropriate UI while the\\nasynchronous Task is still in progress.\\n\\n\\n31 CHA\", \"PTER 6 | Build reusable UI components with Blazor\\n\\n\\nComponents can also define their own events by d\", \"efining a component parameter of type\\nEventCallback<TValue>. Event callbacks support all the variati\", \"ons of DOM UI event handlers: optional\\narguments, synchronous or asynchronous, method groups, or lam\", \"bda expressions.\\n\\n### Data binding\\n\\n\\nBlazor provides a simple mechanism to bind data from a UI compo\", \"nent to the component\\u2019s state. This\\napproach differs from the features in ASP.NET Web Forms for bind\", \"ing data from data sources to UI\\ncontrols. We\\u2019ll cover handling data from different data sources in \", \"the Dealing with data section.\\n\\n\\nTo create a two-way data binding from a UI component to the compone\", \"nt\\u2019s state, use the @bind\\ndirective attribute. In the following example, the value of the check box \", \"is bound to the isChecked\\nfield.\\n\\n\\nWhen the component is rendered, the value of the checkbox is set \", \"to the value of the isChecked field.\\nWhen the user toggles the checkbox, the onchange event is fired\", \" and the isChecked field is set to the\\nnew value. The @bind syntax in this case is equivalent to the\", \" following markup:\\n\\n```\\n<input value=\\\"@isChecked\\\" @onchange=\\\"(UIChangeEventArgs e) => isChecked = e.\", \"Value\\\" />\\n\\n```\\n\\nTo change the event used for the bind, use the @bind:event attribute.\\n\\n\\n32 CHAPTER 6\", \" | Build reusable UI components with Blazor\\n\\n\\nComponents can also support data binding to their para\", \"meters. To data bind, define an event callback\\nparameter with the same name as the bindable paramete\", \"r. The \\u201cChanged\\u201d suffix is added to the\\nname.\\n\\n\\n_PasswordBox.razor_\\n\\n\\nTo chain a data binding to an \", \"underlying UI element, set the value and handle the event directly on\\nthe UI element instead of usin\", \"g the @bind attribute.\\n\\n\\nTo bind to a component parameter, use a @bind-{Parameter} attribute to spec\", \"ify the parameter to\\nwhich you want to bind.\\n\\n### State changes\\n\\n\\nIf the component\\u2019s state has chang\", \"ed outside of a normal UI event or event callback, then the\\ncomponent must manually signal that it n\", \"eeds to be rendered again. To signal that a component\\u2019s\\nstate has changed, call the StateHasChanged \", \"method on the component.\\n\\n\\nIn the example below, a component displays a message from an AppState ser\", \"vice that can be updated\\nby other parts of the app. The component registers its StateHasChanged meth\", \"od with the\\nAppState.OnChange event so that the component is rendered whenever the message gets upda\", \"ted.\\n\\n\\n33 CHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\n### Component lifecycle\\n\\nThe ASP.NE\", \"T Web Forms framework has well-defined lifecycle methods for modules, pages, and\\ncontrols. For examp\", \"le, the following control implements event handlers for the Init, Load, and UnLoad\\nlifecycle events:\", \"\\n\\n\\n_Counter.ascx.cs_\\n\\n\\nRazor components also have a well-defined lifecycle. A component\\u2019s lifecycle \", \"can be used to initialize\\ncomponent state and implement advanced component behaviors.\\n\\n\\nAll of Blazo\", \"r\\u2019s component lifecycle methods have both synchronous and asynchronous versions.\\nComponent rendering\", \" is synchronous. You can\\u2019t run asynchronous logic as part of the component\\nrendering. All asynchrono\", \"us logic must execute as part of an async lifecycle method.\\n\\n#### **OnInitialized**\\n\\n\\nThe OnInitiali\", \"zed and OnInitializedAsync methods are used to initialize the component. A component\\nis typically in\", \"itialized after it\\u2019s first rendered. After a component is initialized, it may be rendered\\n\\n\\n34 CHAPT\", \"ER 6 | Build reusable UI components with Blazor\\n\\n\\nmultiple times before it\\u2019s eventually disposed. Th\", \"e OnInitialized method is similar to the Page_Load\\nevent in ASP.NET Web Forms pages and controls.\\n\\n#\", \"### **OnParametersSet**\\n\\n\\nThe OnParametersSet and OnParametersSetAsync methods are called when a com\", \"ponent has\\nreceived parameters from its parent and the value are assigned to properties. These metho\", \"ds are\\nexecuted after component initialization and _each time the component is rendered_ .\\n\\n#### **O\", \"nAfterRender**\\n\\n\\nThe OnAfterRender and OnAfterRenderAsync methods are called after a component has f\", \"inished\\nrendering. Element and component references are populated at this point (more on these conce\", \"pts\\nbelow). Interactivity with the browser is enabled at this point. Interactions with the DOM and\\nJ\", \"avaScript execution can safely take place.\\n\\n\\nOnAfterRender and OnAfterRenderAsync _aren\\u2019t called whe\", \"n prerendering on the server_ .\\n\\n\\nThe firstRender parameter is true the first time the component is \", \"rendered; otherwise, its value is false.\\n\\n#### **IDisposable**\\n\\n\\nRazor components can implement IDis\", \"posable to dispose of resources when the component is\\nremoved from the UI. A Razor component can imp\", \"lement IDispose by using the @implements\\ndirective:\\n\\n\\n35 CHAPTER 6 | Build reusable UI components wi\", \"th Blazor\\n\\n\\n### Capture component references\\n\\nIn ASP.NET Web Forms, it\\u2019s common to manipulate a cont\", \"rol instance directly in code by referring to\\nits ID. In Blazor, it\\u2019s also possible to capture and m\", \"anipulate a reference to a component, although it\\u2019s\\nmuch less common.\\n\\n\\nTo capture a component refer\", \"ence in Blazor, use the @ref directive attribute. The value of the\\nattribute should match the name o\", \"f a settable field with the same type as the referenced component.\\n\\n\\nWhen the parent component is re\", \"ndered, the field is populated with the child component instance.\\nYou can then call methods on, or o\", \"therwise manipulate, the component instance.\\n\\n\\nManipulating component state directly using component\", \" references isn\\u2019t recommended. Doing so\\nprevents the component from being rendered automatically at \", \"the correct times.\\n\\n### Capture element references\\n\\n\\nRazor components can capture references to an e\", \"lement. Unlike HTML server controls in ASP.NET\\nWeb Forms, you can\\u2019t manipulate the DOM directly usin\", \"g an element reference in Blazor. Blazor\\nhandles most DOM interactions for you using its DOM diffing\", \" algorithm. Captured element references\\nin Blazor are opaque. However, they\\u2019re used to pass a specif\", \"ic element reference in a JavaScript\\n[interop call. For more information about JavaScript interop, s\", \"ee ASP.NET Core Blazor JavaScript](https://docs.microsoft.com/aspnet/core/blazor/javascript-interop)\", \"\\n[interop.](https://docs.microsoft.com/aspnet/core/blazor/javascript-interop)\\n\\n### Templated compone\", \"nts\\n\\n\\nIn ASP.NET Web Forms, you can create _templated controls_ . Templated controls enable the deve\", \"loper\\nto specify a portion of the HTML used to render a container control. The mechanics of building\", \"\\ntemplated server controls are complex, but they enable powerful scenarios for rendering data in a\\nu\", \"ser customizable way. Examples of templated controls include Repeater and DataList.\\n\\n\\nRazor componen\", \"ts can also be templated by defining component parameters of type\\nRenderFragment or RenderFragment<T\", \">. A RenderFragment represents a chunk of Razor markup\\n\\n\\n36 CHAPTER 6 | Build reusable UI components\", \" with Blazor\\n\\n\\nthat can then be rendered by the component. A RenderFragment<T> is a chunk of Razor m\", \"arkup that\\ntakes a parameter that can be specified when the render fragment is rendered.\\n\\n#### **Chi\", \"ld content**\\n\\n\\nRazor components can capture their child content as a RenderFragment and render that \", \"content as\\npart of the component rendering. To capture child content, define a component parameter o\", \"f type\\nRenderFragment and name it ChildContent.\\n\\n\\n_ChildContentComponent.razor_\\n\\n#### **Template par\", \"ameters**\\n\\n\\nA templated Razor component can also define multiple component parameters of type\\nRender\", \"Fragment or RenderFragment<T>. The parameter for a RenderFragment<T> can be specified\\nwhen it\\u2019s invo\", \"ked. To specify a generic type parameter for a component, use the @typeparam Razor\\ndirective.\\n\\n\\n_Sim\", \"pleListView.razor_\\n\\n\\n37 CHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\nWhen using a template\", \"d component, the template parameters can be specified using child elements\\nthat match the names of t\", \"he parameters. Component arguments of type RenderFragment<T> passed\\nas elements have an implicit par\", \"ameter named context. You can change the name of this implement\\nparameter using the Context attribut\", \"e on the child element. Any generic type parameters can be\\nspecified using an attribute that matches\", \" the name of the type parameter. The type parameter will be\\ninferred if possible:\\n\\n### Code-behind\\n\\n\", \"\\nA Razor component is typically authored in a single _.razor_ file. However, it\\u2019s also possible to s\", \"eparate\\nthe code and markup using a code-behind file. To use a component file, add a C# file that ma\", \"tches\\nthe file name of the component file but with a _.cs_ extension added ( _Counter.razor.cs_ ). U\", \"se the C# file\\nto define a base class for the component. You can name the base class anything you\\u2019d \", \"like, but it\\u2019s\\ncommon to name the class the same as the component class, but with a Base extension a\", \"dded\\n(CounterBase). The component-based class must also derive from ComponentBase. Then, in the Razo\", \"r\\ncomponent file, add the @inherits directive to specify the base class for the component (@inherits\", \"\\nCounterBase).\\n\\n\\n_Counter.razor_\\n\\n\\n38 CHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\nThe vis\", \"ibility of the component\\u2019s members in the base class must be protected or public to be visible\\nto th\", \"e component class.\\n\\n### Additional resources\\n\\n\\nThe preceding isn\\u2019t an exhaustive treatment of all as\", \"pects of Razor components. For more information\\n[on how to Create and use ASP.NET Core Razor compone\", \"nts, see the Blazor documentation.](https://docs.microsoft.com/aspnet/core/blazor/components)\\n\\n\\n39 C\", \"HAPTER 6 | Build reusable UI components with Blazor\\n\\n\\n**CHAPTER**\\n# 7\\n\\n## Pages, routing, and layout\", \"s\\n\\n\\nASP.NET Web Forms apps are composed of pages defined in _.aspx_ files. Each page\\u2019s address is ba\", \"sed\\non its physical file path in the project. When a browser makes a request to the page, the conten\", \"ts of\\nthe page are dynamically rendered on the server. The rendering accounts for both the page\\u2019s HT\", \"ML\\nmarkup and its server controls.\\n\\n\\nIn Blazor, each page in the app is a component, typically defin\", \"ed in a _.razor_ file, with one or more\\nspecified routes. Routing mostly happens client-side without\", \" involving a specific server request. The\\nbrowser first makes a request to the root address of the a\", \"pp. A root Router component in the Blazor\\napp then handles intercepting navigation requests and forw\", \"ards them to the correct component.\\n\\n\\nBlazor also supports _deep linking_ . Deep linking occurs when\", \" the browser makes a request to a specific\\nroute other than the root of the app. Requests for deep l\", \"inks sent to the server are routed to the\\nBlazor app, which then routes the request client-side to t\", \"he correct component.\\n\\n\\nA simple page in ASP.NET Web Forms might contain the following markup:\\n\\n\\n_Na\", \"me.aspx_\\n\\n\\n_Name.aspx.cs_\\n\\n\\n40 CHAPTER 7 | Pages, routing, and layouts\\n\\n\\nThe equivalent page in a Bl\", \"azor app would look like this:\\n\\n\\n_Name.razor_\\n\\n### Create pages\\n\\n\\nTo create a page in Blazor, create\", \" a component and add the @page Razor directive to specify the\\nroute for the component. The @page dir\", \"ective takes a single parameter, which is the route template\\nto add to that component.\\n\\n```\\n@page \\\"/\", \"counter\\\"\\n\\n```\\n\\nThe route template parameter is required. Unlike ASP.NET Web Forms, the route to a Bl\", \"azor\\ncomponent _isn\\u2019t_ inferred from its file location (although that may be a feature added in the \", \"future).\\n\\n\\nThe route template syntax is the same basic syntax used for routing in ASP.NET Web Forms.\", \" Route\\nparameters are specified in the template using braces. Blazor will bind route values to compo\", \"nent\\nparameters with the same name (case-insensitive).\\n\\n\\nYou can also specify constraints on the val\", \"ue of the route parameter. For example, to constrain the\\nproduct ID to be an int:\\n\\n\\n41 CHAPTER 7 | P\", \"ages, routing, and layouts\\n\\n\\n[For a full list of the route constraints supported by Blazor, see Rout\", \"e constraints.](https://docs.microsoft.com/aspnet/core/blazor/routing#route-constraints)\\n\\n### Router\", \" component\\n\\n\\nRouting in Blazor is handled by the Router component. The Router component is typically\", \" used in the\\napp\\u2019s root component ( _App.razor_ ).\\n\\n\\nThe Router component discovers the routable com\", \"ponents in the specified AppAssembly and in the\\noptionally specified AdditionalAssemblies. When the \", \"browser navigates, the Router intercepts the\\nnavigation and renders the contents of its Found parame\", \"ter with the extracted RouteData if a route\\nmatches the address, otherwise the Router renders its No\", \"tFound parameter.\\n\\n\\nThe RouteView component handles rendering the matched component specified by the\", \" RouteData\\nwith its layout if it has one. If the matched component doesn\\u2019t have a layout, then the o\", \"ptionally\\nspecified DefaultLayout is used.\\n\\n\\nThe LayoutView component renders its child content with\", \"in the specified layout. We\\u2019ll look at layouts\\nmore in detail later in this chapter.\\n\\n### Navigation\", \"\\n\\n\\nIn ASP.NET Web Forms, you trigger navigation to a different page by returning a redirect response\", \" to\\nthe browser. For example:\\n\\n\\nReturning a redirect response isn\\u2019t typically possible in Blazor. Bl\", \"azor doesn\\u2019t use a request-reply\\nmodel. You can, however, trigger browser navigations directly, as y\", \"ou can with JavaScript.\\n\\n\\n42 CHAPTER 7 | Pages, routing, and layouts\\n\\n\\nBlazor provides a NavigationM\", \"anager service that can be used to:\\n\\n\\n  - Get the current browser address\\n\\n  - Get the base address\\n\", \"\\n  - Trigger navigations\\n\\n  - Get notified when the address changes\\n\\n\\nTo navigate to a different add\", \"ress, use the NavigateTo method:\\n\\n\\n[For a description of all NavigationManager members, see URI and \", \"navigation state helpers.](https://docs.microsoft.com/aspnet/core/blazor/routing#uri-and-navigation-\", \"state-helpers)\\n\\n### Base URLs\\n\\n\\nIf your Blazor app is deployed under a base path, then you need to s\", \"pecify the base URL in the page\\nmetadata using the <base> tag for routing to work property. If the h\", \"ost page for the app is serverrendered using Razor, then you can use the ~/ syntax to specify the ap\", \"p\\u2019s base address. If the host\\npage is static HTML, then you need to specify the base URL explicitly.\", \"\\n\\n```\\n< base href =\\\"~/\\\" />\\n\\n### Page layout\\n\\n```\\n\\nPage layout in ASP.NET Web Forms is handled by Mas\", \"ter Pages. Master Pages define a template with\\none or more content placeholders that can then be sup\", \"plied by individual pages. Master Pages are\\ndefined in _.master_ files and start with the <%@ Master\", \" %> directive. The content of the _.master_ files is\\ncoded as you would an _.aspx_ page, but with th\", \"e addition of <asp:ContentPlaceHolder> controls to\\nmark where pages can supply content.\\n\\n\\n_Site.mast\", \"er_\\n\\n\\n43 CHAPTER 7 | Pages, routing, and layouts\\n\\n\\nIn Blazor, you handle page layout using layout co\", \"mponents. Layout components inherit from\\nLayoutComponentBase, which defines a single Body property o\", \"f type RenderFragment, which can be\\nused to render the contents of the page.\\n\\n\\n_MainLayout.razor_\\n\\n\\n\", \"When the page with a layout is rendered, the page is rendered within the contents of the specified\\nl\", \"ayout at the location where the layout renders its Body property.\\n\\n\\nTo apply a layout to a page, use\", \" the @layout directive:\\n\\n```\\n@layout MainLayout\\n\\n```\\n\\nYou can specify the layout for all components \", \"in a folder and subfolders using an *_Imports.razor* file.\\nYou can also specify a default layout for\", \" all your pages using the Router component.\\n\\n\\nMaster Pages can define multiple content placeholders,\", \" but layouts in Blazor only have a single Body\\nproperty. This limitation of Blazor layout components\", \" will hopefully be addressed in a future release.\\n\\n\\nMaster Pages in ASP.NET Web Forms can be nested.\", \" That is, a Master Page may also use a Master\\nPage. Layout components in Blazor may be nested too. Y\", \"ou can apply a layout component to a layout\\ncomponent. The contents of the inner layout will be rend\", \"ered within the outer layout.\\n\\n\\n_ChildLayout.razor_\\n\\n\\n_Index.razor_\\n\\n\\nThe rendered output for the pa\", \"ge would then be:\\n\\n\\n44 CHAPTER 7 | Pages, routing, and layouts\\n\\n\\nLayouts in Blazor don\\u2019t typically d\", \"efine the root HTML elements for a page (<html>, <body>, <head>,\\nand so on). The root HTML elements \", \"are instead defined in a Blazor app\\u2019s host page, which is used to\\nrender the initial HTML content fo\", \"r the app (see Bootstrap Blazor). The host page can render multiple\\nroot components for the app with\", \" surrounding markup.\\n\\n\\nComponents in Blazor, including pages, can\\u2019t render <script> tags. This rende\", \"ring restriction exists\\nbecause <script> tags get loaded once and then can\\u2019t be changed. Unexpected \", \"behavior may occur if\\nyou try to render the tags dynamically using Razor syntax. Instead, all <scrip\", \"t> tags should be added\\nto the app\\u2019s host page.\\n\\n\\n45 CHAPTER 7 | Pages, routing, and layouts\\n\\n\\n**CHA\", \"PTER**\\n# 8\\n\\n## State management\\n\\n\\nState management is a key concept of Web Forms applications, facil\", \"itated through ViewState, Session\\nState, Application State, and Postback features. These stateful fe\", \"atures of the framework helped to\\nhide the state management required for an application and allow ap\", \"plication developers to focus on\\ndelivering their functionality. With ASP.NET Core and Blazor, some \", \"of these features have been\\nrelocated and some have been removed altogether. This chapter reviews ho\", \"w to maintain state and\\ndeliver the same functionality with the new features in Blazor.\\n\\n### Request\", \" state management with ViewState\\n\\n\\nWhen discussing state management in Web Forms application, many d\", \"evelopers will immediately\\nthink of ViewState. In Web Forms, ViewState manages the state of the cont\", \"ent between HTTP requests\\nby sending a large encoded block of text back and forth to the browser. Th\", \"e ViewState field could be\\noverwhelmed with content from a page containing many elements, potentiall\", \"y expanding to several\\nmegabytes in size.\\n\\n\\nWith Blazor Server, the app maintains an ongoing connect\", \"ion with the server. The app\\u2019s state, called a\\n_circuit_, is held in server memory while the connect\", \"ion is considered active. State will only be disposed\\nwhen the user navigates away from the app or a\", \" particular page in the app. All members of the active\\ncomponents are available between interactions\", \" with the server.\\n\\n\\nThere are several advantages of this feature:\\n\\n\\n  - Component state is readily a\", \"vailable and not rebuilt between interactions.\\n\\n  - State isn\\u2019t transmitted to the browser.\\n\\n\\nHoweve\", \"r, there are some disadvantages to in-memory component state persistence to be aware of:\\n\\n\\n  - If th\", \"e server restarts between request, state is lost.\\n\\n  - Your application web server load-balancing so\", \"lution must include sticky sessions to ensure\\nthat all requests from the same browser return to the \", \"same server. If a request goes to a\\ndifferent server, state will be lost.\\n\\n  - Persistence of compon\", \"ent state on the server can lead to memory pressure on the web server.\\n\\nFor the preceding reasons, d\", \"on\\u2019t rely on just the state of the component to reside in-memory on the\\nserver. Your application sho\", \"uld also include some backing data store for data between requests. Some\\nsimple examples of this str\", \"ategy:\\n\\n\\n  - In a shopping cart application, persist the content of new items added to the cart in a\", \"\\ndatabase record. If the state on the server is lost, you can reconstitute it from the database\\nreco\", \"rds.\\n\\n\\n46 CHAPTER 8 | State management\\n\\n\\n  - In a multi-part web form, your users will expect your a\", \"pplication to remember values between\\neach request. Write the data between each of your user\\u2019s posts\", \" to a data store so that they\\ncan be fetched and assembled into the final form response structure wh\", \"en the multi-part\\nform is completed.\\n\\n[For additional details on managing state in Blazor apps, see \", \"ASP.NET Core Blazor state management.](https://docs.microsoft.com/aspnet/core/blazor/state-managemen\", \"t)\\n\\n### Maintain state with Session\\n\\n\\nWeb Forms developers could maintain information about the curr\", \"ently acting user with the\\n[Microsoft.AspNetCore.Http.ISession dictionary object. It\\u2019s easy enough t\", \"o add an object with a string](https://docs.microsoft.com/dotnet/api/microsoft.aspnetcore.http.isess\", \"ion)\\nkey to the Session, and that object would be available at a later time during the user\\u2019s intera\", \"ctions\\nwith the application. In an attempt to eliminate managing interacting with HTTP, the Session \", \"object\\nmade it easy to maintain state.\\n\\n\\nThe signature of the .NET Framework Session object isn\\u2019t th\", \"e same as the ASP.NET Core Session\\n[object. Consider the documentation for the new ASP.NET Core Sess\", \"ion](https://docs.microsoft.com/dotnet/api/microsoft.aspnetcore.http.isession) before deciding to mi\", \"grate\\nand use the new session state feature.\\n\\n\\nSession is available in ASP.NET Core and Blazor Serve\", \"r, but is discouraged from use in favor of storing\\ndata in a data repository appropriately. Session \", \"state is also not functional if visitors decline the use\\nHTTP cookies in your application due to pri\", \"vacy concerns.\\n\\n\\n[Configuration for ASP.NET Core and Session state is available in the Session and s\", \"tate management in](https://docs.microsoft.com/aspnet/core/fundamentals/app-state#session-state)\\n[AS\", \"P.NET Core article.](https://docs.microsoft.com/aspnet/core/fundamentals/app-state#session-state)\\n\\n#\", \"## Application state\\n\\n\\nThe Application object in the Web Forms framework provides a massive, cross-r\", \"equest repository for\\ninteracting with application-scope configuration and state. Application state \", \"was an ideal place to\\nstore various application configuration properties that would be referenced by\", \" all requests, regardless\\nof the user making the request. The problem with the Application object wa\", \"s that data didn\\u2019t persist\\nacross multiple servers. The state of the application object was lost bet\", \"ween restarts.\\n\\n\\nAs with Session, it\\u2019s recommended that data move to a persistent backing store that\", \" could be\\naccessed by multiple server instances. If there is volatile data that you would like to be\", \" able to access\\nacross requests and users, you could easily store it in a singleton service that can\", \" be injected into\\ncomponents that require this information or interaction.\\n\\n\\nThe construction of an \", \"object to maintain application state and its consumption could resemble the\\nfollowing implementation\", \":\\n\\n\\n47 CHAPTER 8 | State management\\n\\n\\nThe MyApplicationState object is created only once on the serv\", \"er, and the value VisitorCounter is\\nfetched and output in the component\\u2019s label. The VisitorCounter \", \"value should be persisted and\\nretrieved from a backing data store for durability and scalability.\\n\\n#\", \"## In the browser\\n\\n\\nApplication data can also be stored client-side on the user\\u2019s device so that is \", \"available later. There are\\ntwo browser features that allow for persistence of data in different scop\", \"es of the user\\u2019s browser:\\n\\n\\n  - localStorage - scoped to the user\\u2019s entire browser. If the page is r\", \"eloaded, the browser is\\nclosed and reopened, or another tab is opened with the same URL then the sam\", \"e\\nlocalStorage is provided by the browser\\n\\n  - sessionStorage - scoped to the user\\u2019s current browser\", \" tab. If the tab is reloaded, the state\\npersists. However, if the user opens another tab to your app\", \"lication or closes and reopens the\\nbrowser the state is lost.\\n\\n\\nYou can write some custom JavaScript\", \" code to interact with these features, or there are a number of\\nNuGet packages that you can use that\", \" provide this functionality. One such package is\\n[Microsoft.AspNetCore.ProtectedBrowserStorage.](htt\", \"ps://www.nuget.org/packages/Microsoft.AspNetCore.ProtectedBrowserStorage)\\n\\n\\nFor instructions on util\", \"izing this package to interact with localStorage and sessionStorage, see the\\n[Blazor State Managemen\", \"t article.](https://docs.microsoft.com/aspnet/core/blazor/state-management#protected-browser-storage\", \"-experimental-package)\\n\\n\\n48 CHAPTER 8 | State management\\n\\n\\n**CHAPTER**\\n# 9\\n\\n## Forms and validation\\n\", \"\\n\\nThe ASP.NET Web Forms framework includes a set of validation server controls that handle validatin\", \"g\\nuser input entered into a form (RequiredFieldValidator, CompareValidator, RangeValidator, and so o\", \"n).\\nThe ASP.NET Web Forms framework also supports model binding and validating the model based on\\nda\", \"ta annotations ([Required], [StringLength], [Range], and so on). The validation logic can be enforce\", \"d\\nboth on the server and on the client using unobtrusive JavaScript-based validation. The\\nValidation\", \"Summary server control is used to display a summary of the validation errors to the user.\\n\\n\\nBlazor s\", \"upports the sharing of validation logic between both the client and the server. ASP.NET\\nprovides pre\", \"-built JavaScript implementations of many common server validations. In many cases, the\\ndeveloper st\", \"ill has to write JavaScript to fully implement their app-specific validation logic. The same\\nmodel t\", \"ypes, data annotations, and validation logic can be used on both the server and client.\\n\\n\\nBlazor pro\", \"vides a set of input components. The input components handle binding field data to a\\nmodel and valid\", \"ating the user input when the form is submitted.\\n\\n|Input component|Rendered HTML element|\\n|---|---|\\n\", \"|InputCheckbox|<input type=\\\"checkbox\\\">|\\n|InputDate|<input type=\\\"date\\\">|\\n|InputNumber|<input type=\\\"nu\", \"mber\\\">|\\n|InputSelect|<select>|\\n|InputText|<input>|\\n|InputTextArea|<textarea>|\\n\\n\\n\\nThe EditForm compon\", \"ent wraps these input components and orchestrates the validation process\\nthrough an EditContext. Whe\", \"n creating an EditForm, you specify what model instance to bind to using\\nthe Model parameter. Valida\", \"tion is typically done using data annotations, and it\\u2019s extensible. To\\nenable data annotation-based \", \"validation, add the DataAnnotationsValidator component as a child of\\nthe EditForm. The EditForm comp\", \"onent provides a convenient event for handling valid\\n(OnValidSubmit) and invalid (OnInvalidSubmit) s\", \"ubmissions. There\\u2019s also a more generic OnSubmit\\nevent that lets you trigger and handle the validati\", \"on yourself.\\n\\n\\nTo display a validation error summary, use the ValidationSummary component. To displa\", \"y validation\\nmessages for a specific input field, use the ValidationMessage component, specifying a \", \"lambda\\nexpression for the For parameter that points to the appropriate model member.\\n\\n\\nThe following\", \" model type defines several validation rules using data annotations:\\n\\n\\n49 CHAPTER 9 | Forms and vali\", \"dation\\n\\n\\nThe following component demonstrates building a form in Blazor based on the Starship model \", \"type:\\n\\n\\n50 CHAPTER 9 | Forms and validation\\n\\n\\nAfter the form submission, the model-bound data hasn\\u2019t\", \" been saved to any data store, like a\\ndatabase. In a Blazor WebAssembly app, the data must be sent t\", \"o the server. For example, using an\\nHTTP POST request. In a Blazor Server app, the data is already o\", \"n the server, but it must be persisted.\\nHandling data access in Blazor apps is the subject of the De\", \"aling with data section.\\n\\n### Additional resources\\n\\n\\n[For more information on forms and validation](\", \"https://docs.microsoft.com/aspnet/core/blazor/forms-validation) in Blazor apps, see the Blazor docum\", \"entation.\\n\\n\\n51 CHAPTER 9 | Forms and validation\\n\\n\\n**CHAPTER**\\n# 10\\n\\n## Work with data\\n\\n\\nData access \", \"is the backbone of an ASP.NET Web Forms app. If you\\u2019re building forms for the web, what\\nhappens to t\", \"hat data? With Web Forms, there were multiple data access techniques you could use to\\ninteract with \", \"a database:\\n\\n\\n  - Data Sources\\n\\n  - ADO.NET\\n\\n  - Entity Framework\\n\\n\\nData Sources were controls that \", \"you could place on a Web Forms page and configure like other\\ncontrols. Visual Studio provided a frie\", \"ndly set of dialogs to configure and bind the controls to your\\nWeb Forms pages. Developers who enjoy\", \" a \\u201clow code\\u201d or \\u201cno code\\u201d approach preferred this\\ntechnique when Web Forms was first released.\\n\\n\\nAD\", \"O.NET is the low-level approach to interacting with a database. Your apps could create a\\nconnection \", \"to the database with Commands, Datatables, and Datasets for interacting. The results\\ncould then be b\", \"ound to fields on screen without much code. The drawback of this approach was that\\neach set of ADO.N\", \"ET objects (Connection, Command, and DataTable) was bound to libraries provided\\nby a database vendor\", \". Use of these components made the code rigid and difficult to migrate to a\\ndifferent database.\\n\\n###\", \" Entity Framework\\n\\n\\nEntity Framework (EF) is the open source object-relational mapping framework mai\", \"ntained by the\\n.NET Foundation. Initially released with .NET Framework, EF allows for generating cod\", \"e for the\\ndatabase connections, storage schemas, and interactions. With this abstraction, you can fo\", \"cus on your\\n\\n\\n52 CHAPTER 10 | Work with data\\n\\n\\napp\\u2019s business rules and allow the database to be man\", \"aged by a trusted database administrator. In\\n.NET, you can use an updated version of EF called EF Co\", \"re. EF Core helps generate and maintain the\\ninteractions between your code and the database with a s\", \"eries of commands that are available for you\\nusing the dotnet ef command-line tool. Let\\u2019s take a loo\", \"k at a few samples to get you working with a\\ndatabase.\\n\\n#### **EF Code First**\\n\\n\\nA quick way to get \", \"started building your database interactions is to start with the class objects you\\nwant to work with\", \". EF provides a tool to help generate the appropriate database code for your classes.\\nThis approach \", \"is called \\u201cCode First\\u201d development. Consider the following Product class for a sample\\nstorefront app\", \" that we want to store in a relational database like Microsoft SQL Server.\\n\\n\\nProduct has a primary k\", \"ey and three additional fields that would be created in our database:\\n\\n\\n  - EF will identify the Id \", \"property as a primary key by convention.\\n\\n  - Name will be stored in a column configured for text st\", \"orage. The [Required] attribute\\ndecorating this property will add a not null constraint to help enfo\", \"rce this declared behavior\\nof the property.\\n\\n  - Description will be stored in a column configured f\", \"or text storage, and have a maximum\\nlength configured of 4000 characters as dictated by the [MaxLeng\", \"th] attribute. The database\\nschema will be configured with a column named MaxLength using data type \", \"varchar(4000).\\n\\n  - The Price property will be stored as currency. The [Range] attribute will genera\", \"te appropriate\\nconstraints to prevent data storage outside of the minimum and maximum values declare\", \"d.\\n\\n\\nWe need to add this Product class to a database context class that defines the connection and\\nt\", \"ranslation operations with our database.\\n\\n\\nThe MyDbContext class provides the one property that defi\", \"nes the access and translation for the\\nProduct class. Your application configures this class for int\", \"eraction with the database using the\\nfollowing entries in the Startup class\\u2019s ConfigureServices meth\", \"od (or appropriate location in\\n_Program.cs_ using the builder.Services property instead of services)\", \":\\n\\n\\n53 CHAPTER 10 | Work with data\\n\\n\\nThe preceding code will connect to a SQL Server database with t\", \"he specified connection string. You\\ncan place the connection string in your _appsettings.json_ file,\", \" environment variables, or other\\nconfiguration storage locations and replace this embedded string ap\", \"propriately.\\n\\n\\nYou can then generate the database table appropriate for this class using the followi\", \"ng commands:\\n\\n\\nThe first command defines the changes you\\u2019re making to the database schema as a new E\", \"F Migration\\ncalled Create Product table. A Migration defines how to apply and remove your new databa\", \"se\\nchanges.\\n\\n\\nOnce applied, you have a simple Product table in your database and some new classes ad\", \"ded to the\\nproject that help manage the database schema. You can find these generated classes, by de\", \"fault, in a\\nnew folder called _Migrations_ . When you make changes to the Product class or add more \", \"related\\nclasses you would like interacting with your database, you need to run the command-line comm\", \"ands\\nagain with a new name of the migration. This command will generate another set of migration cla\", \"sses\\nto update your database schema.\\n\\n#### **EF Database First**\\n\\n\\nFor existing databases, you can g\", \"enerate the classes for EF Core by using the .NET command-line\\ntools. To scaffold the classes, use a\", \" variation of the following command:\\n\\n\\nThe preceding command connects to the database using the spec\", \"ified connection string and the\\nMicrosoft.EntityFrameworkCore.SqlServer provider. Once connected, a \", \"database context class named\\nMyDbContext is created. Additionally, supporting classes are created fo\", \"r the Product and Customer\\ntables that were specified with the -t options. There are many configurat\", \"ion options for this command\\nto generate the class hierarchy appropriate for your database. For a co\", \"mplete reference, see the\\n[command\\u2019s documentation.](https://docs.microsoft.com/ef/core/miscellaneou\", \"s/cli/dotnet#dotnet-ef-dbcontext-scaffold)\\n\\n\\n[More information about EF Core can be found on the Mic\", \"rosoft Docs site.](https://docs.microsoft.com/ef/core/)\\n\\n### Interact with web services\\n\\n\\nWhen ASP.N\", \"ET was first released, SOAP services were the preferred way for web servers and clients to\\nexchange \", \"data. Much has changed since that time, and the preferred interactions with services have\\nshifted to\", \" direct HTTP client interactions. With ASP.NET Core and Blazor, you can register the\\nconfiguration o\", \"f your HttpClient in _Program.cs_ or in the Startup class\\u2019s ConfigureServices method. Use\\nthat confi\", \"guration when you need to interact with the HTTP endpoint. Consider the following\\nconfiguration code\", \":\\n\\n\\n54 CHAPTER 10 | Work with data\\n\\n\\nWhenever you need to access data from GitHub, create a client w\", \"ith a name of github. The client is\\nconfigured with the base address, and the request headers are se\", \"t appropriately. Inject the\\nIHttpClientFactory into your Blazor components with the @inject directiv\", \"e or an [Inject] attribute on a\\nproperty. Create your named client and interact with services using \", \"the following syntax:\\n\\n\\nThis method returns the string describing the collection of issues in the _d\", \"otnet/docs_ GitHub repository.\\nIt returns content in JSON format and is deserialized into appropriat\", \"e GitHub issue objects. There are\\nmany ways that you can configure the HttpClientFactory to deliver \", \"preconfigured HttpClient objects.\\nTry configuring multiple HttpClient instances with different names\", \" and endpoints for the various web\\nservices you work with. This approach will make your interactions\", \" with those services easier to work\\n[with on each page. For more information, see Make HTTP requests\", \" using IHttpClientFactory.](https://docs.microsoft.com/aspnet/core/fundamentals/http-requests)\\n\\n\\n55 \", \"CHAPTER 10 | Work with data\\n\\n\\n**CHAPTER**\\n# 11\\n\\n## Modules, handlers, and middleware\\n\\n\\nAn ASP.NET Co\", \"re app is built upon a series of _middleware_ . Middleware is handlers that are arranged\\ninto a pipe\", \"line to handle requests and responses. In a Web Forms app, HTTP handlers and modules\\nsolve similar p\", \"roblems. In ASP.NET Core, modules, handlers, _Global.asax.cs_, and the app life cycle are\\nreplaced w\", \"ith middleware. In this chapter, you\\u2019ll learn about middleware in the context of a Blazor\\napp.\\n\\n### \", \"Overview\\n\\n\\nThe ASP.NET Core request pipeline consists of a sequence of request delegates, called one\", \" after the\\nother. The following diagram demonstrates the concept. The thread of execution follows th\", \"e black\\narrows.\\n\\n\\n56 CHAPTER 11 | Modules, handlers, and middleware\\n\\n\\nThe preceding diagram lacks a \", \"concept of lifecycle events. This concept is foundational to how\\nASP.NET Web Forms requests are hand\", \"led. This system makes it easier to reason about what process\\nis occurring and allows middleware to \", \"be inserted at any point. Middleware executes in the order in\\nwhich it\\u2019s added to the request pipeli\", \"ne. They\\u2019re also added in code instead of configuration files,\\nusually in _Startup.cs_ .\\n\\n### Katana\", \"\\n\\n\\nReaders familiar with Katana will feel comfortable in ASP.NET Core. In fact, Katana is a framewor\", \"k from\\nwhich ASP.NET Core derives. It introduced similar middleware and pipeline patterns for ASP.NE\", \"T 4.x.\\nMiddleware designed for Katana can be adapted to work with the ASP.NET Core pipeline.\\n\\n### Co\", \"mmon middleware\\n\\n\\nASP.NET 4.x includes many modules. In a similar fashion, ASP.NET Core has many mid\", \"dleware\\ncomponents available as well. IIS modules may be used in some cases with ASP.NET Core. In ot\", \"her\\ncases, native ASP.NET Core middleware may be available.\\n\\n\\nThe following table lists replacement \", \"middleware and components in ASP.NET Core.\\n\\n|Module|ASP.NET 4.x module|ASP.NET Core option|\\n|---|---\", \"|---|\\n|HTTP errors|CustomErrorModule|Status Code Pages<br>Middleware|\\n\\n\\n\\n57 CHAPTER 11 | Modules, ha\", \"ndlers, and middleware\\n\\n\\n|Module|ASP.NET 4.x module|ASP.NET Core option|\\n|---|---|---|\\n|Default docu\", \"ment|DefaultDocumentModule|Default Files Middleware|\\n|Directory browsing|DirectoryListingModule|Dire\", \"ctory Browsing<br>Middleware|\\n|Dynamic compression|DynamicCompressionModule|Response Compression<br>\", \"Middleware|\\n|Failed requests tracing|FailedRequestsTracingModule|ASP.NET Core Logging|\\n|File caching\", \"|FileCacheModule|Response Caching<br>Middleware|\\n|HTTP caching|HttpCacheModule|Response Caching<br>M\", \"iddleware|\\n|HTTP logging|HttpLoggingModule|ASP.NET Core Logging|\\n|HTTP redirection|HttpRedirectionMo\", \"dule|URL Rewriting<br>Middleware|\\n|ISAPI filters|IsapiFilterModule|Middleware|\\n|ISAPI|IsapiModule|Mi\", \"ddleware|\\n|Request filtering|RequestFilteringModule|URL Rewriting<br>Middleware IRule|\\n|URL rewritin\", \"g\\u2020|RewriteModule|URL Rewriting<br>Middleware|\\n|Static compression|StaticCompressionModule|Response C\", \"ompression<br>Middleware|\\n|Static content|StaticFileModule|Static File Middleware|\\n|URL authorizatio\", \"n|UrlAuthorizationModule|ASP.NET Core Identity|\\n\\n\\nThis list isn\\u2019t exhaustive but should give an idea\", \" of what mapping exists between the two frameworks.\\n[For a more detailed list, see IIS modules with \", \"ASP.NET Core.](https://docs.microsoft.com/aspnet/core/host-and-deploy/iis/modules)\\n\\n### Custom middl\", \"eware\\n\\n\\nBuilt-in middleware may not handle all scenarios needed for an app. In such cases, it makes \", \"sense to\\ncreate your own middleware. There are multiple ways of defining middleware, with the simple\", \"st being\\na simple delegate. Consider the following middleware, which accepts a culture request from \", \"a query\\nstring:\\n\\n\\n58 CHAPTER 11 | Modules, handlers, and middleware\\n\\n\\nMiddleware can also be defined\", \" as class, either by implementing the IMiddleware interface or by\\n[following middleware convention. \", \"For more information, see Write custom ASP.NET Core middleware.](https://docs.microsoft.com/aspnet/c\", \"ore/fundamentals/middleware/write)\\n\\n\\n59 CHAPTER 11 | Modules, handlers, and middleware\\n\\n\\n**CHAPTER**\", \"\\n# 12\\n\\n## App configuration\\n\\n\\nThe primary way to load app configuration in Web Forms is with entries\", \" in the _web.config_ file\\u2014either\\non the server or a related configuration file referenced by _web.co\", \"nfig_ . You can use the static\\nConfigurationManager object to interact with app settings, data repos\", \"itory connection strings, and\\nother extended configuration providers that are added into the app. It\", \"\\u2019s typical to see interactions\\nwith app configuration as seen in the following code:\\n\\n\\nWith ASP.NET \", \"Core and server-side Blazor, the _web.config_ file MAY be present if your app is hosted on\\na Windows\", \" IIS server. However, there\\u2019s no ConfigurationManager interaction with this configuration,\\nand you c\", \"an receive more structured app configuration from other sources. Let\\u2019s take a look at how\\nconfigurat\", \"ion is gathered and how you can still access configuration information from a _web.config_\\nfile.\\n\\n##\", \"# Configuration sources\\n\\n\\nASP.NET Core recognizes there are many configuration sources you may want \", \"to use for your app. The\\nframework attempts to offer you the best of these features by default. Conf\", \"iguration is read and\\naggregated from these various sources by ASP.NET Core. Later loaded values for\", \" the same\\nconfiguration key take precedence over earlier values.\\n\\n\\nASP.NET Core was designed to be c\", \"loud-aware and to make the configuration of apps easier for both\\noperators and developers. ASP.NET C\", \"ore is environment-aware and knows if it\\u2019s running in your\\nProduction or Development environment. Th\", \"e environment indicator is set in the\\nASPNETCORE_ENVIRONMENT system environment variable. If no valu\", \"e is configured, the app defaults\\nto running in the Production environment.\\n\\n\\nYour app can trigger a\", \"nd add configuration from several sources based on the environment\\u2019s name.\\nBy default, the configura\", \"tion is loaded from the following resources in the order listed:\\n\\n\\n1. _appsettings.json_ file, if pr\", \"esent\\n\\n2. _appsettings.{ENVIRONMENT_NAME}.json_ file, if present\\n\\n3. User secrets file on disk, if p\", \"resent\\n\\n4. Environment variables\\n\\n5. Command-line arguments\\n\\n\\n60 CHAPTER 12 | App configuration\\n\\n\\n##\", \"# appsettings.json format and access\\n\\nThe _appsettings.json_ file can be hierarchical with values st\", \"ructured like the following JSON:\\n\\n\\nWhen presented with the preceding JSON, the configuration system\", \" flattens child values and\\nreferences their fully qualified hierarchical paths. A colon (:) characte\", \"r separates each property in the\\nhierarchy. For example, the configuration key section1:key0 accesse\", \"s the section1 object literal\\u2019s key0\\nvalue.\\n\\n### User secrets\\n\\n\\nUser secrets are:\\n\\n\\n  - Configuratio\", \"n values that are stored in a JSON file on the developer\\u2019s workstation, outside of\\nthe app developme\", \"nt folder.\\n\\n  - Only loaded when running in the Development environment.\\n\\n  - Associated with a spec\", \"ific app.\\n\\n  - Managed with the .NET CLI\\u2019s user-secrets command.\\n\\nConfigure your app for secrets sto\", \"rage by executing the user-secrets command:\\n\\n```\\ndotnet user-secrets init\\n\\n```\\n\\nThe preceding comman\", \"d adds a UserSecretsId element to the project file. The element contains a\\nGUID, which is used to as\", \"sociate secrets with the app. You can then define a secret with the set\\ncommand. For example:\\n\\n```\\nd\", \"otnet user-secrets set \\\"Parent:ApiKey\\\" \\\"12345\\\"\\n\\n```\\n\\nThe preceding command makes the Parent:ApiKey c\", \"onfiguration key available on a developer\\u2019s\\nworkstation with the value 12345.\\n\\n\\n[For more informatio\", \"n about creating, storing, and managing user secrets, see the Safe storage of app](https://docs.micr\", \"osoft.com/aspnet/core/security/app-secrets)\\n[secrets in development in ASP.NET Core document.](https\", \"://docs.microsoft.com/aspnet/core/security/app-secrets)\\n\\n### Environment variables\\n\\n\\nThe next set of\", \" values loaded into your app configuration is the system\\u2019s environment variables. All of\\nyour system\", \"\\u2019s environment variable settings are now accessible to you through the configuration API.\\n\\n\\n61 CHAPT\", \"ER 12 | App configuration\\n\\n\\nHierarchical values are flattened and separated by colon characters when\", \" read inside your app.\\nHowever, some operating systems don\\u2019t allow the colon character environment v\", \"ariable names.\\nASP.NET Core addresses this limitation by converting values that have double-undersco\", \"res (__) into a\\ncolon when they\\u2019re accessed. The Parent:ApiKey value from the user secrets section a\", \"bove can be\\noverridden with the environment variable Parent__ApiKey.\\n\\n### Command-line arguments\\n\\n\\nC\", \"onfiguration can also be provided as command-line arguments when your app is started. Use the\\ndouble\", \"-dash (--) or forward-slash (/) notation to indicate the name of the configuration value to set\\nand \", \"the value to be configured. The syntax resembles the following commands:\\n\\n### The return of web.conf\", \"ig\\n\\n\\nIf you\\u2019ve deployed your app to Windows on IIS, the _web.config_ file still configures IIS to ma\", \"nage your\\napp. By default, IIS adds a reference to the ASP.NET Core Module (ANCM). ANCM is a native \", \"IIS\\nmodule that hosts your app in place of the Kestrel web server. This _web.config_ section resembl\", \"es the\\nfollowing XML markup:\\n\\n\\nApp-specific configuration can be defined by nesting an environmentVa\", \"riables element in the\\naspNetCore element. The values defined in this section are presented to the A\", \"SP.NET Core app as\\nenvironment variables. The environment variables load appropriately during that s\", \"egment of app\\nstartup.\\n\\n\\n62 CHAPTER 12 | App configuration\\n\\n\\n### Read configuration in the app\\n\\n[ASP\", \".NET Core provides app configuration through the IConfiguration interface. This configuration](https\", \"://docs.microsoft.com/dotnet/api/microsoft.extensions.configuration.iconfiguration)\\ninterface should\", \" be requested by your Blazor components, Blazor pages, and any other ASP.NET Coremanaged class that \", \"needs access to configuration. The ASP.NET Core framework will automatically\\npopulate this interface\", \" with the resolved configuration configured earlier. On a Blazor page or a\\ncomponent\\u2019s Razor markup,\", \" you can inject the IConfiguration object with an @inject directive at the\\ntop of the _.razor_ file \", \"like this:\\n\\n```\\n@inject IConfiguration Configuration\\n\\n```\\n\\nThis preceding statement makes the IConfi\", \"guration object available as the Configuration variable\\nthroughout the rest of the Razor template.\\n\\n\", \"\\nIndividual configuration settings can be read by specifying the configuration setting hierarchy sou\", \"ght\\nas an indexer parameter:\\n\\n```\\nvar mySetting = Configuration[\\\"section1:key0\\\"];\\n\\n```\\n\\n[You can fet\", \"ch entire configuration sections by using the GetSection](https://docs.microsoft.com/dotnet/api/micr\", \"osoft.extensions.configuration.iconfiguration.getsection) method to retrieve a collection of\\nkeys at\", \" a specific location with a syntax similar to GetSection(\\\"section1\\\") to retrieve the configuration\\nf\", \"or section1 from the earlier example.\\n\\n### Strongly typed configuration\\n\\n\\nWith Web Forms, it was pos\", \"sible to create a strongly typed configuration type that inherited from the\\n[ConfigurationSection](h\", \"ttps://docs.microsoft.com/dotnet/api/system.configuration.configurationsection) type and associated \", \"types. A ConfigurationSection allowed you to configure\\nsome business rules and processing for those \", \"configuration values.\\n\\n\\nIn ASP.NET Core, you can specify a class hierarchy that will receive the con\", \"figuration values. These\\nclasses:\\n\\n\\n  - Don\\u2019t need to inherit from a parent class.\\n\\n  - Should inclu\", \"de public properties that match the properties and type references for the\\nconfiguration structure y\", \"ou wish to capture.\\n\\n\\nFor the earlier _appsettings.json_ sample, you could define the following clas\", \"ses to capture the values:\\n\\n\\n63 CHAPTER 12 | App configuration\\n\\n\\nThis class hierarchy can be populat\", \"ed by adding the following line to the Startup.ConfigureServices\\nmethod (or appropriate location in \", \"_Program.cs_ using the builder.Services property instead of services):\\n\\n```\\nservices.Configure<MyCon\", \"fig>(Configuration);\\n\\n```\\n\\nIn the rest of the app, you can add an input parameter to classes or an @\", \"inject directive in Razor\\ntemplates of type IOptions<MyConfig> to receive the strongly typed configu\", \"ration settings. The\\nIOptions<MyConfig>.Value property will yield the MyConfig value populated from \", \"the configuration\\nsettings.\\n\\n\\n[More information about the Options feature can be found in the Option\", \"s pattern in ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/configuration/options\", \"#options-interfaces)\\ndocument.\\n\\n\\n64 CHAPTER 12 | App configuration\\n\\n\\n**CHAPTER**\\n# 13\\n\\n## Security: \", \"Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\nMigrating from an ASP.NET Web For\", \"ms application to Blazor will almost certainly require updating\\nhow authentication and authorization\", \" are performed, assuming the application had authentication\\nconfigured. This chapter will cover how \", \"to migrate from the ASP.NET Web Forms universal provider\\nmodel (for membership, roles, and user prof\", \"iles) and how to work with ASP.NET Core Identity from\\nBlazor apps. While this chapter will cover the\", \" high-level steps and considerations, the detailed steps\\nand scripts may be found in the referenced \", \"documentation.\\n\\n### ASP.NET universal providers\\n\\n\\nSince ASP.NET 2.0, the ASP.NET Web Forms platform \", \"has supported a provider model for a variety of\\nfeatures, including membership. The universal member\", \"ship provider, along with the optional role\\nprovider, is commonly deployed with ASP.NET Web Forms ap\", \"plications. It offers a robust and secure\\nway to manage authentication and authorization that contin\", \"ues to work well today. The most recent\\n[offering of these universal providers is available as a NuG\", \"et package, Microsoft.AspNet.Providers.](https://www.nuget.org/packages/Microsoft.AspNet.Providers)\\n\", \"\\n\\nThe Universal Providers work with a SQL database schema that includes tables like\\naspnet_Applicati\", \"ons, aspnet_Membership, aspnet_Roles, and aspnet_Users. When configured by\\n[running the aspnet_regsq\", \"l.exe command, the providers install tables and stored procedures that](https://docs.microsoft.com/p\", \"revious-versions/ms229862(v=vs.140))\\nprovide all of the necessary queries and commands to work with \", \"the underlying data. The database\\nschema and these stored procedures are not compatible with newer A\", \"SP.NET Identity and ASP.NET\\nCore Identity systems, so existing data must be migrated into the new sy\", \"stem. Figure 1 shows an\\nexample table schema configured for universal providers.\\n\\n\\n65 CHAPTER 13 | S\", \"ecurity: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\nThe universal provider h\", \"andles users, membership, roles, and profiles. Users are assigned globally\\nunique identifiers and ba\", \"sic information like userId, userName etc. are stored in the aspnet_Users\\ntable. Authentication info\", \"rmation, such as password, password format, password salt, lockout counters\\nand details, etc. are st\", \"ored in the aspnet_Membership table. Roles consist simply of names and unique\\nidentifiers, which are\", \" assigned to users via the aspnet_UsersInRoles association table, providing a\\nmany-to-many relations\", \"hip.\\n\\n\\nIf your existing system is using roles in addition to membership, you will need to migrate th\", \"e user\\naccounts, the associated passwords, the roles, and the role membership into ASP.NET Core Iden\", \"tity.\\nYou will also most likely need to update your code where you\\u2019re currently performing role chec\", \"ks\\nusing if statements to instead leverage declarative filters, attributes, and/or tag helpers. We w\", \"ill review\\nmigration considerations in greater detail at the end of this chapter.\\n\\n#### **Authorizat\", \"ion configuration in Web Forms**\\n\\n\\nTo configure authorized access to certain pages in an ASP.NET Web\", \" Forms application, typically you\\nspecify that certain pages or folders are inaccessible to anonymou\", \"s users. This configuration is done in\\nthe web.config file:\\n\\n\\nThe authentication configuration secti\", \"on sets up the forms authentication for the application. The\\nauthorization section is used to disall\", \"ow anonymous users for the entire application. However, you\\ncan provide more granular authorization \", \"rules on a per-location basis as well as apply role-based\\nauthorization checks.\\n\\n\\n66 CHAPTER 13 | Se\", \"curity: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\nThe above configuration, \", \"when combined with the first one, would allow anonymous users to access\\nthe login page, overriding t\", \"he site-wide restriction on non-authenticated users.\\n\\n\\nThe above configuration, when combined with t\", \"he others, restricts access to the /admin folder and all\\nresources within it to members of the \\u201cAdmi\", \"nistrators\\u201d role. This restriction could also be applied by\\nplacing a separate web.config file withi\", \"n the /admin folder root.\\n\\n#### **Authorization code in Web Forms**\\n\\n\\nIn addition to configuring acc\", \"ess using web.config, you can also programmatically configure access\\nand behavior in your Web Forms \", \"application. For instance, you can restrict the ability to perform\\ncertain operations or view certai\", \"n data based on the user\\u2019s role.\\n\\n\\nThis code can be used both in code-behind logic as well as in the\", \" page itself:\\n\\n\\nIn addition to checking user role membership, you can also determine if they are aut\", \"henticated\\n(though often this is better done using the location-based configuration covered above). \", \"Below is an\\nexample of this approach.\\n\\n\\nIn the code above, role-based access control (RBAC) is used \", \"to determine whether certain elements of\\nthe page, such as a SecretPanel, are visible based on the c\", \"urrent user\\u2019s role.\\n\\n\\n67 CHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Form\", \"s and Blazor\\n\\n\\nTypically, ASP.NET Web Forms applications configure security within the web.config fi\", \"le and then add\\nadditional checks where needed in .aspx pages and their related .aspx.cs code-behind\", \" files. Most\\napplications leverage the universal membership provider, frequently with the additional\", \" role provider.\\n\\n### ASP.NET Core Identity\\n\\n\\nAlthough still tasked with authentication and authoriza\", \"tion, ASP.NET Core Identity uses a different set\\nof abstractions and assumptions when compared to th\", \"e universal providers. For example, the new\\nIdentity model supports third party authentication, allo\", \"wing users to authenticate using a social media\\naccount or other trusted authentication provider. AS\", \"P.NET Core Identity supports UI for commonly\\nneeded pages like login, logout, and register. It lever\", \"ages EF Core for its data access, and uses EF Core\\n[migrations to generate the necessary schema requ\", \"ired to support its data model. This introduction to](https://docs.microsoft.com/aspnet/core/securit\", \"y/authentication/identity)\\n[Identity on ASP.NET Core provides a good overview of what is included wi\", \"th ASP.NET Core Identity](https://docs.microsoft.com/aspnet/core/security/authentication/identity)\\na\", \"nd how to get started working with it. If you haven\\u2019t already set up ASP.NET Core Identity in your\\na\", \"pplication and its database, it will help you get started.\\n\\n#### **Roles, claims, and policies**\\n\\n\\nB\", \"oth the universal providers and ASP.NET Core Identity support the concept of roles. You can create\\nr\", \"oles for users and assign users to roles. Users can belong to any number of roles, and you can verif\", \"y\\nrole membership as part of your authorization implementation.\\n\\n\\nIn addition to roles, ASP.NET Core\", \" identity supports the concepts of claims and policies. While a role\\nshould specifically correspond \", \"to a set of resources a user in that role should be able to access, a\\nclaim is simply part of a user\", \"\\u2019s identity. A claim is a name value pair that represents what the subject\\nis, not what the subject \", \"can do.\\n\\n\\nIt is possible to directly inspect a user\\u2019s claims and determine based on these values whe\", \"ther a user\\nshould be given access to a resource. However, such checks are often repetitive and scat\", \"tered\\nthroughout the system. A better approach is to define a _policy_ .\\n\\n\\nAn authorization policy c\", \"onsists of one or more requirements. Policies are registered as part of the\\nauthorization service co\", \"nfiguration in the ConfigureServices method of Startup.cs. For example, the\\nfollowing code snippet c\", \"onfigures a policy called \\u201cCanadiansOnly\\u201d, which has the requirement that the\\nuser has the Country c\", \"laim with the value of \\u201cCanada\\u201d.\\n\\n\\n[You can learn more about how to create custom policies in the do\", \"cumentation.](https://docs.microsoft.com/aspnet/core/security/authorization/policies)\\n\\n\\nWhether you\\u2019\", \"re using policies or roles, you can specify that a particular page in your Blazor\\napplication requir\", \"es that role or policy with the [Authorize] attribute, applied with the @attribute\\ndirective.\\n\\n\\nRequ\", \"iring a role:\\n\\n\\n68 CHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and \", \"Blazor\\n\\n\\n```\\n@attribute [Authorize(Roles =\\\"administrators\\\")]\\n\\n```\\n\\nRequiring a policy be satisfied:\\n\", \"\\n```\\n@attribute [Authorize(Policy =\\\"CanadiansOnly\\\")]\\n\\n```\\n\\nIf you need access to a user\\u2019s authentica\", \"tion state, roles, or claims in your code, there are two primary\\nways to achieve this functionality.\", \" The first is to receive the authentication state as a cascading\\nparameter. The second is to access \", \"the state using an injected AuthenticationStateProvider. The\\n[details of each of these approaches ar\", \"e described in the Blazor Security documentation.](https://docs.microsoft.com/aspnet/core/blazor/sec\", \"urity/)\\n\\n\\nThe following code shows how to receive the AuthenticationState as a cascading parameter:\\n\", \"\\n\\nWith this parameter in place, you can get the user using this code:\\n\\n\\nThe following code shows how\", \" to inject the AuthenticationStateProvider:\\n\\n\\nWith the provider in place, you can gain access to the\", \" user with the following code:\\n\\n\\n**Note:** The AuthorizeView component, covered later in this chapte\", \"r, provides a declarative way to\\ncontrol what a user sees on a page or component.\\n\\n\\nTo work with use\", \"rs and claims (in Blazor Server applications) you may also need to inject a\\nUserManager<T> (use Iden\", \"tityUser for default) which you can use to enumerate and modify claims\\nfor a user. First inject the \", \"type and assign it to a property:\\n\\n```\\n@inject UserManager<IdentityUser> MyUserManager\\n\\n```\\n\\nThen us\", \"e it to work with the user\\u2019s claims. The following sample shows how to add and persist a claim\\non a \", \"user:\\n\\n\\n69 CHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\", \"\\nIf you need to work with roles, follow the same approach. You may need to inject a RoleManager<T>\\n(\", \"use IdentityRole for default type) to list and manage the roles themselves.\\n\\n\\n**Note:** In Blazor We\", \"bAssembly projects, you will need to provide server APIs to perform these\\noperations (instead of usi\", \"ng UserManager<T> or RoleManager<T> directly). A Blazor WebAssembly\\nclient application would manage \", \"claims and/or roles by securely calling API endpoints exposed for\\nthis purpose.\\n\\n#### **Migration gu\", \"ide**\\n\\n\\nMigrating from ASP.NET Web Forms and universal providers to ASP.NET Core Identity requires s\", \"everal\\nsteps:\\n\\n\\n1. Create ASP.NET Core Identity database schema in the destination database\\n\\n2. Migr\", \"ate data from universal provider schema to ASP.NET Core Identity schema\\n\\n3. Migrate configuration fr\", \"om the web.config to middleware and services, typically in _Program.cs_\\n(or a Startup class)\\n\\n4. Upd\", \"ate individual pages using controls and conditionals to use tag helpers and new identity\\nAPIs.\\n\\nEach\", \" of these steps is described in detail in the following sections.\\n\\n#### **Creating the ASP.NET Core \", \"Identity schema**\\n\\n\\nThere are several ways to create the necessary table structure used for ASP.NET \", \"Core Identity. The\\nsimplest is to create a new ASP.NET Core Web application. Choose Web Application \", \"and then change\\nAuthentication type to use Individual Accounts.\\n\\n\\n70 CHAPTER 13 | Security: Authenti\", \"cation and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\nFrom the command line, you can do the sam\", \"e thing by running dotnet new webapp -au Individual.\\nOnce the app has been created, run it and regis\", \"ter on the site. You should trigger a page like the one\\nshown below:\\n\\n\\n71 CHAPTER 13 | Security: Aut\", \"hentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\nClick on the \\u201cApply Migrations\\u201d butt\", \"on and the necessary database tables should be created for you.\\nIn addition, the migration files sho\", \"uld appear in your project, as shown:\\n\\n\\n72 CHAPTER 13 | Security: Authentication and Authorization i\", \"n ASP.NET Web Forms and Blazor\\n\\n\\nYou can run the migration yourself, without running the web applica\", \"tion, using this command-line\\ntool:\\n\\n```\\ndotnet ef database update\\n\\n```\\n\\nIf you would rather run a s\", \"cript to apply the new schema to an existing database, you can script these\\nmigrations from the comm\", \"and-line. Run this command to generate the script:\\n\\n```\\ndotnet ef migrations script -o auth.sql\\n\\n```\", \"\\n\\nThe above command will produce a SQL script in the output file auth.sql, which can then be run\\n[ag\", \"ainst whatever database you like. If you have any trouble running dotnet ef commands, make sure](htt\", \"ps://docs.microsoft.com/ef/core/miscellaneous/cli/dotnet)\\n[you have the EF Core tools installed on y\", \"our system.](https://docs.microsoft.com/ef/core/miscellaneous/cli/dotnet)\\n\\n\\nIn the event you have ad\", \"ditional columns on your source tables, you will need to identify the best\\nlocation for these column\", \"s in the new schema. Generally, columns found on the aspnet_Membership\\ntable should be mapped to the\", \" AspNetUsers table. Columns on aspnet_Roles should be mapped to\\nAspNetRoles. Any additional columns \", \"on the aspnet_UsersInRoles table would be added to the\\nAspNetUserRoles table.\\n\\n\\nIt\\u2019s also worth cons\", \"idering putting any additional columns on separate tables. So that future\\nmigrations won\\u2019t need to t\", \"ake into account such customizations of the default identity schema.\\n\\n#### **Migrating data from uni\", \"versal providers to ASP.NET Core Identity**\\n\\n\\nOnce you have the destination table schema in place, t\", \"he next step is to migrate your user and role\\nrecords to the new schema. A complete list of the sche\", \"ma differences, including which columns map\\n[to which new columns, can be found here.](https://docs.\", \"microsoft.com/aspnet/core/migration/proper-to-2x/membership-to-core-identity)\\n\\n\\n73 CHAPTER 13 | Secu\", \"rity: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\n[To migrate your users from\", \" membership to the new identity tables, you should follow the steps](https://docs.microsoft.com/aspn\", \"et/core/migration/proper-to-2x/membership-to-core-identity)\\n[described in the documentation. After f\", \"ollowing these steps and the script provided, your users will](https://docs.microsoft.com/aspnet/cor\", \"e/migration/proper-to-2x/membership-to-core-identity)\\nneed to change their password the next time th\", \"ey log in.\\n\\n\\nIt is possible to migrate user passwords but the process is much more involved. Requiri\", \"ng users to\\nupdate their passwords as part of the migration process, and encouraging them to use new\", \", unique\\npasswords, is likely to enhance the overall security of the application.\\n\\n#### **Migrating \", \"security settings from web.config to app startup**\\n\\n\\nAs noted above, ASP.NET membership and role pro\", \"viders are configured in the application\\u2019s\\nweb.config file. Since ASP.NET Core apps are not tied to \", \"IIS and use a separate system for\\nconfiguration, these settings must be configured elsewhere. For th\", \"e most part, ASP.NET Core Identity\\nis configured in the _Program.cs_ file. Open the web project that\", \" was created earlier (to generate the\\nidentity table schema) and review its _Program.cs_ (or _Startu\", \"p.cs_ ) file.\\n\\n\\nThis code adds support for EF Core and Identity:\\n\\n\\nThe AddDefaultIdentity extension \", \"method is used to configure Identity to use the default\\nApplicationDbContext and the framework\\u2019s Ide\", \"ntityUser type. If you\\u2019re using a custom IdentityUser, be\\nsure to specify its type here. If these ex\", \"tension methods aren\\u2019t working in your application, check that\\nyou have the appropriate using statem\", \"ents and that you have the necessary NuGet package\\nreferences. For example, your project should have\", \" some version of the\\nMicrosoft.AspNetCore.Identity.EntityFrameworkCore and Microsoft.AspNetCore.Iden\", \"tity.UI packages\\nreferenced.\\n\\n\\nAlso in _Program.cs_ you should see the necessary middleware configur\", \"ed for the site. Specifically,\\nUseAuthentication and UseAuthorization should be set up, and in the p\", \"roper location.\\n\\n\\n74 CHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms an\", \"d Blazor\\n\\n\\nASP.NET Identity does not configure anonymous or role-based access to locations from _Pro\", \"gram.cs_ .\\nYou will need to migrate any location-specific authorization configuration data to filter\", \"s in ASP.NET\\nCore. Make note of which folders and pages will require such updates. You will make the\", \"se changes in\\nthe next section.\\n\\n#### **Updating individual pages to use ASP.NET Core Identity abstr\", \"actions**\\n\\n\\nIn your ASP.NET Web Forms application, if you had web.config settings to deny access to \", \"certain\\npages or folders to anonymous users, you would migrate these changes by adding the [Authoriz\", \"e]\\nattribute to such pages:\\n\\n```\\n@attribute [Authorize]\\n\\n```\\n\\nIf you further had denied access excep\", \"t to those users belonging to a certain role, you would likewise\\nmigrate this behavior by adding an \", \"attribute specifying a role:\\n\\n```\\n@attribute [Authorize(Roles =\\\"administrators\\\")]\\n\\n```\\n\\nThe [Authori\", \"ze] attribute only works on @page components that are reached via the Blazor Router.\\nThe attribute d\", \"oes not work with child components, which should instead use AuthorizeView.\\n\\n\\nIf you have logic with\", \"in page markup for determining whether to display some code to a certain user,\\n[you can replace this\", \" with the AuthorizeView component. The AuthorizeView component selectively](https://docs.microsoft.c\", \"om/aspnet/core/blazor/security#authorizeview-component)\\ndisplays UI depending on whether the user is\", \" authorized to see it. It also exposes a context variable\\nthat can be used to access user informatio\", \"n.\\n\\n\\nYou can access the authentication state within procedural logic by accessing the user from a\\nTa\", \"sk<AuthenticationState configured with the [CascadingParameter] attribute. This configuration will\\ng\", \"et you access to the user, which can let you determine if they are authenticated and if they belong \", \"to\\na particular role. If you need to evaluate a policy procedurally, you can inject an instance of t\", \"he\\nIAuthorizationService and calls the AuthorizeAsync method on it. The following sample code\\ndemons\", \"trates how to get user information and allow an authorized user to perform a task restricted\\nby the \", \"content-editor policy.\\n\\n\\n75 CHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web F\", \"orms and Blazor\\n\\n\\nThe AuthenticationState first need to be set up as a cascading value before it can\", \" be bound to a\\ncascading parameter like this. That\\u2019s typically done using the CascadingAuthenticatio\", \"nState\\ncomponent. This configuration is typically done in App.razor:\\n\\n### Summary\\n\\n\\nBlazor uses the \", \"same security model as ASP.NET Core, which is ASP.NET Core Identity. Migrating from\\nuniversal provid\", \"ers to ASP.NET Core Identity is relatively straightforward, assuming not too much\\ncustomization was \", \"applied to the original data schema. Once the data has been migrated, working\\n\\n\\n76 CHAPTER 13 | Secu\", \"rity: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\nwith authentication and aut\", \"horization in Blazor apps is well documented, with configurable as well as\\nprogrammatic support for \", \"most security requirements.\\n\\n### References\\n\\n\\n  - [Introduction to Identity on ASP.NET Core](https:/\", \"/docs.microsoft.com/aspnet/core/security/authentication/identity)\\n\\n  - [Migrate from ASP.NET Members\", \"hip authentication to ASP.NET Core 2.0 Identity](https://docs.microsoft.com/aspnet/core/migration/pr\", \"oper-to-2x/membership-to-core-identity)\\n\\n  - [Migrate Authentication and Identity to ASP.NET Core](h\", \"ttps://docs.microsoft.com/aspnet/core/migration/identity)\\n\\n  - [ASP.NET Core Blazor authentication a\", \"nd authorization](https://docs.microsoft.com/aspnet/core/blazor/security/)\\n\\n\\n77 CHAPTER 13 | Securit\", \"y: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\n**CHAPTER**\\n# 14\\n\\n## Migrate f\", \"rom ASP.NET Web Forms to Blazor\\n\\n\\nMigrating a code base from ASP.NET Web Forms to Blazor is a time-c\", \"onsuming task that requires\\nplanning. This chapter outlines the process. Something that can ease the\", \" transition is to ensure the\\napp adheres to an _N-tier_ architecture, wherein the app model (in this\", \" case, Web Forms) is separate\\nfrom the business logic. This logical separation of layers makes it cl\", \"ear what needs to move to .NET\\nCore and Blazor.\\n\\n\\n[For this example, the eShop app available on GitH\", \"ub](https://github.com/dotnet-architecture/eShopOnBlazor) is used. eShop is a catalog service that p\", \"rovides\\nCRUD capabilities via form entry and validation.\\n\\n\\nWhy should a working app be migrated to B\", \"lazor? Many times, there\\u2019s no need. ASP.NET Web Forms\\nwill continue to be supported for many years. \", \"However, many of the features that Blazor provides are\\nonly supported on a migrated app. Such featur\", \"es include:\\n\\n\\n  - Performance improvements in the framework such as Span<T>\\n\\n  - Ability to run as W\", \"ebAssembly\\n\\n  - Cross-platform support for Linux and macOS\\n\\n  - App-local deployment or shared frame\", \"work deployment without impacting other apps\\n\\n\\nIf these or other new features are compelling enough,\", \" there may be value in migrating the app. The\\nmigration can take different shapes; it can be the ent\", \"ire app, or only certain endpoints that require the\\nchanges. The decision to migrate is ultimately b\", \"ased on the business problems to be solved by the\\ndeveloper.\\n\\n### Server-side versus client-side hos\", \"ting\\n\\n\\nAs described in the hosting models chapter, a Blazor app can be hosted in two different ways:\", \" serverside and client-side. The server-side model uses ASP.NET Core SignalR connections to manage t\", \"he\\nDOM updates while running any actual code on the server. The client-side model runs as\\nWebAssembl\", \"y within a browser and requires no server connections. There are a number of differences\\nthat may af\", \"fect which is best for a specific app:\\n\\n\\n  - Running as WebAssembly doesn\\u2019t support all features (su\", \"ch as threading) at the current time\\n\\n  - Chatty communication between the client and server may cau\", \"se latency issues in server-side\\nmode\\n\\n\\n78 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\n \", \" - Access to databases and internal or protected services require a separate service with clientside\", \" hosting\\n\\n\\nAt the time of writing, the server-side model more closely resembles Web Forms. Most of t\", \"his chapter\\nfocuses on the server-side hosting model, as it\\u2019s production-ready.\\n\\n### Create a new pr\", \"oject\\n\\n\\nThis initial migration step is to create a new project. This project type is based on the SD\", \"K style\\nprojects of .NET and simplifies much of the boilerplate that was used in previous project fo\", \"rmats. For\\nmore detail, please see the chapter on Project Structure.\\n\\n\\nOnce the project has been cre\", \"ated, install the libraries that were used in the previous project. In older\\nWeb Forms projects, you\", \" may have used the _packages.config_ file to list the required NuGet packages.\\nIn the new SDK-style \", \"project, _packages.config_ has been replaced with <PackageReference> elements\\nin the project file. A\", \" benefit to this approach is that all dependencies are installed transitively. You only\\nlist the top\", \"-level dependencies you care about.\\n\\n\\nMany of the dependencies you\\u2019re using are available for .NET, \", \"including Entity Framework 6 and\\nlog4net. If there\\u2019s no .NET or .NET Standard version available, the\", \" .NET Framework version can often\\nbe used. Your mileage may vary. Any API used that isn\\u2019t available \", \"in .NET causes a runtime error. Visual\\nStudio notifies you of such packages. A yellow icon appears o\", \"n the project\\u2019s **References** node in\\n**Solution Explorer** .\\n\\n\\nIn the Blazor-based eShop project, \", \"you can see the packages that are installed. Previously, the\\n_packages.config_ file listed every pac\", \"kage used in the project, resulting in a file almost 50 lines long. A\\nsnippet of _packages.config_ i\", \"s:\\n\\n\\n79 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\nThe <packages> element includes all \", \"necessary dependencies. It\\u2019s difficult to identify which of these\\npackages are included because you \", \"require them. Some <package> elements are listed simply to\\nsatisfy the needs of dependencies you req\", \"uire.\\n\\n\\nThe Blazor project lists the dependencies you require within an <ItemGroup> element in the p\", \"roject\\nfile:\\n\\n\\n[One NuGet package that simplifies the life of Web Forms developers is the Windows Co\", \"mpatibility](https://docs.microsoft.com/en-us/dotnet/core/porting/windows-compat-pack)\\n[Pack. Althou\", \"gh .NET is cross-platform, some features are only available on Windows. Windows-](https://docs.micro\", \"soft.com/en-us/dotnet/core/porting/windows-compat-pack)\\nspecific features are made available by inst\", \"alling the compatibility pack. Examples of such features\\ninclude the Registry, WMI, and Directory Se\", \"rvices. The package adds around 20,000 APIs and activates\\nmany services with which you may already b\", \"e familiar. The eShop project doesn\\u2019t require the\\ncompatibility pack; but if your projects use Windo\", \"ws-specific features, the package eases the\\nmigration efforts.\\n\\n### Enable startup process\\n\\n\\nThe sta\", \"rtup process for Blazor has changed from Web Forms and follows a similar setup for other\\nASP.NET Cor\", \"e services. When hosted server-side, Razor components are run as part of a normal\\nASP.NET Core app. \", \"When hosted in the browser with WebAssembly, Razor components use a similar\\nhosting model. The diffe\", \"rence is the components are run as a separate service from any of the\\nbackend processes. Either way,\", \" the startup is similar.\\n\\n\\nThe _Global.asax.cs_ file is the default startup page for Web Forms proje\", \"cts. In the eShop project, this file\\nconfigures the Inversion of Control (IoC) container and handles\", \" the various lifecycle events of the app\\nor request. Some of these events are handled with middlewar\", \"e (such as Application_BeginRequest).\\nOther events require the overriding of specific services via d\", \"ependency injection (DI).\\n\\n\\nBy way of example, the _Global.asax.cs_ file for eShop, contains the fol\", \"lowing code:\\n\\n\\n80 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\nThe preceding file becomes\", \" the _Program.cs_ file in server-side Blazor:\\n\\n\\n81 CHAPTER 14 | Migrate from ASP.NET Web Forms to Bl\", \"azor\\n\\n\\n82 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\nOne significant change you may not\", \"ice from Web Forms is the prominence of dependency injection\\n(DI). DI has been a guiding principle i\", \"n the ASP.NET Core design. It supports customization of almost\\nall aspects of the ASP.NET Core frame\", \"work. There\\u2019s even a built-in service provider that can be used\\nfor many scenarios. If more customiz\", \"ation is required, it can be supported by many community\\nprojects. For example, you can carry forwar\", \"d your third-party DI library investment.\\n\\n\\nIn the original eShop app, there\\u2019s some configuration fo\", \"r session management. Since server-side\\nBlazor uses ASP.NET Core SignalR for communication, the sess\", \"ion state isn\\u2019t supported as the\\nconnections may occur independent of an HTTP context. An app that u\", \"ses the session state requires\\nrearchitecting before running as a Blazor app.\\n\\n\\nFor more information\", \" about app startup, see App startup.\\n\\n### Migrate HTTP modules and handlers to middleware\\n\\n\\nHTTP mod\", \"ules and handlers are common patterns in Web Forms to control the HTTP request pipeline.\\nClasses tha\", \"t implement IHttpModule or IHttpHandler could be registered and process incoming\\nrequests. Web Forms\", \" configure modules and handlers in the _web.config_ file. Web Forms is also heavily\\nbased on app lif\", \"ecycle event handling. ASP.NET Core uses middleware instead. Middleware is\\nregistered in the Configu\", \"re method of the Startup class. Middleware execution order is determined by\\nthe registration order.\\n\", \"\\n\\nIn the Enable startup process section, a lifecycle event was raised by Web Forms as the\\nApplicatio\", \"n_BeginRequest method. This event isn\\u2019t available in ASP.NET Core. One way to achieve this\\nbehavior \", \"is to implement middleware as seen in the _Startup.cs_ file example. This middleware does the\\nsame l\", \"ogic and then transfers control to the next handler in the middleware pipeline.\\n\\n\\n[For more informat\", \"ion on migrating modules and handlers, see Migrate HTTP handlers and modules to](https://docs.micros\", \"oft.com/aspnet/core/migration/http-modules)\\n[ASP.NET Core middleware.](https://docs.microsoft.com/as\", \"pnet/core/migration/http-modules)\\n\\n\\n83 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\n### M\", \"igrate static files\\n\\nTo serve static files (for example, HTML, CSS, images, and JavaScript), the fil\", \"es must be exposed by\\nmiddleware. Calling the UseStaticFiles method enables the serving of static fi\", \"les from the web root\\npath. The default web root directory is _wwwroot_, but it can be customized. A\", \"s included in the\\n_Program.cs_ file:\\n\\n\\nThe eShop project enables basic static file access. There are\", \" many customizations available for static\\n[file access. For information on enabling default files or\", \" a file browser, see Static files in ASP.NET Core.](https://docs.microsoft.com/aspnet/core/fundament\", \"als/static-files)\\n\\n### Migrate runtime bundling and minification setup\\n\\n\\nBundling and minification a\", \"re performance optimization techniques for reducing the number and size\\nof server requests to retrie\", \"ve certain file types. JavaScript and CSS often undergo some form of\\nbundling or minification before\", \" being sent to the client. In ASP.NET Web Forms, these optimizations\\nare handled at run time. The op\", \"timization conventions are defined an _App_Start/BundleConfig.cs_ file.\\nIn ASP.NET Core, a more decl\", \"arative approach is adopted. A file lists the files to be minified, along\\nwith specific minification\", \" settings.\\n\\n\\n[For more information on bundling and minification, see Bundle and minify static assets\", \" in ASP.NET](https://docs.microsoft.com/aspnet/core/client-side/bundling-and-minification)\\n[Core.](h\", \"ttps://docs.microsoft.com/aspnet/core/client-side/bundling-and-minification)\\n\\n### Migrate ASPX pages\", \"\\n\\n\\nA page in a Web Forms app is a file with the _.aspx_ extension. A Web Forms page can often be map\", \"ped\\nto a component in Blazor. A Razor component is authored in a file with the _.razor_ extension. F\", \"or the\\neShop project, five pages are converted to a Razor page.\\n\\n\\nFor example, the details view comp\", \"rises three files in the Web Forms project: _Details.aspx_,\\n_Details.aspx.cs_, and _Details.aspx.des\", \"igner.cs_ . When converting to Blazor, the code-behind and markup\\nare combined into _Details.razor_ \", \". Razor compilation (equivalent to what\\u2019s in _.designer.cs_ files) is stored\\nin the _obj_ directory \", \"and isn\\u2019t, by default, viewable in **Solution Explorer** . The Web Forms page consists\\nof the follow\", \"ing markup:\\n\\n\\n84 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\n85 CHAPTER 14 | Migrate fro\", \"m ASP.NET Web Forms to Blazor\\n\\n\\nThe preceding markup\\u2019s code-behind includes the following code:\\n\\n\\nWh\", \"en converted to Blazor, the Web Forms page translates to the following code:\\n\\n\\n86 CHAPTER 14 | Migra\", \"te from ASP.NET Web Forms to Blazor\\n\\n\\n87 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\nNot\", \"ice that the code and markup are in the same file. Any required services are made accessible with\\nth\", \"e @inject attribute. Per the @page directive, this page can be accessed at the Catalog/Details/{id}\\n\", \"route. The value of the route\\u2019s {id} placeholder has been constrained to an integer. As described in\", \" the\\nrouting section, unlike Web Forms, a Razor component explicitly states its route and any parame\", \"ters\\nthat are included. Many Web Forms controls may not have exact counterparts in Blazor. There\\u2019s o\", \"ften\\nan equivalent HTML snippet that will serve the same purpose. For example, the <asp:Label /> con\", \"trol\\ncan be replaced with an HTML <label> element.\\n\\n#### **Model validation in Blazor**\\n\\n\\nIf your We\", \"b Forms code includes validation, you can transfer much of what you have with little-to-no\\nchanges. \", \"A benefit to running in Blazor is that the same validation logic can be run without needing\\ncustom J\", \"avaScript. Data annotations enable easy model validation.\\n\\n\\n88 CHAPTER 14 | Migrate from ASP.NET Web\", \" Forms to Blazor\\n\\n\\nFor example, the _Create.aspx_ page has a data entry form with validation. An exa\", \"mple snippet would\\nlook like this:\\n\\n\\nIn Blazor, the equivalent markup is provided in a _Create.razor\", \"_ file:\\n\\n\\nThe EditForm context includes validation support and can be wrapped around an input. Data\\n\", \"annotations are a common way to add validation. Such validation support can be added via the\\n[DataAn\", \"notationsValidator component. For more information on this mechanism, see ASP.NET Core](https://docs\", \".microsoft.com/aspnet/core/blazor/forms-validation)\\n[Blazor forms and validation.](https://docs.micr\", \"osoft.com/aspnet/core/blazor/forms-validation)\\n\\n### Migrate configuration\\n\\n\\nIn a Web Forms project, \", \"configuration data is most commonly stored in the _web.config_ file. The\\nconfiguration data is acces\", \"sed with ConfigurationManager. Services were often required to parse\\nobjects. With .NET Framework 4.\", \"7.2, composability was added to the configuration via\\nConfigurationBuilders. These builders allowed \", \"developers to add various sources for the configuration\\nthat was then composed at run time to retrie\", \"ve the necessary values.\\n\\n\\nASP.NET Core introduced a flexible configuration system that allows you t\", \"o define the configuration\\nsource or sources used by your app and deployment. The ConfigurationBuild\", \"er infrastructure that you\\nmay be using in your Web Forms app was modeled after the concepts used in\", \" the ASP.NET Core\\nconfiguration system.\\n\\n\\nThe following snippet demonstrates how the Web Forms eShop\", \" project uses _web.config_ to store\\nconfiguration values:\\n\\n\\n89 CHAPTER 14 | Migrate from ASP.NET Web\", \" Forms to Blazor\\n\\n\\nIt\\u2019s common for secrets, such as database connection strings, to be stored within\", \" the _web.config_ . The\\nsecrets are inevitably persisted in unsecure locations, such as source contr\", \"ol. With Blazor on ASP.NET\\nCore, the preceding XML-based configuration is replaced with the followin\", \"g JSON:\\n\\n\\nJSON is the default configuration format; however, ASP.NET Core supports many other format\", \"s,\\nincluding XML. There are also several community-supported formats.\\n\\n\\nYou can access configuration\", \" values from the builder in _Program.cs_ :\\n\\n\\nBy default, environment variables, JSON files ( _appset\", \"tings.json_ and _appsettings.{Environment}.json_ ), and\\ncommand-line options are registered as valid\", \" configuration sources in the configuration object. The\\nconfiguration sources can be accessed via Co\", \"nfiguration[key]. A more advanced technique is to bind\\nthe configuration data to objects using the o\", \"ptions pattern. For more information on configuration\\n[and the options pattern, see Configuration in\", \" ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/configuration/) [and Options patt\", \"ern in ASP.NET Core,](https://docs.microsoft.com/aspnet/core/fundamentals/configuration/options)\\nres\", \"pectively.\\n\\n\\n90 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\n### Migrate data access\\n\\nDat\", \"a access is an important aspect of any app. The eShop project stores catalog information in a\\ndataba\", \"se and retrieves the data with Entity Framework (EF) 6. Since EF 6 is supported in .NET 5, the\\nproje\", \"ct can continue to use it.\\n\\n\\nThe following EF-related changes were necessary to eShop:\\n\\n\\n  - In .NET\", \" Framework, the DbContext object accepts a string of the form _name=ConnectionString_\\nand uses the c\", \"onnection string from ConfigurationManager.AppSettings[ConnectionString] to\\nconnect. In .NET Core, t\", \"his isn\\u2019t supported. The connection string must be supplied.\\n\\n  - The database was accessed in a syn\", \"chronous way. Though this works, scalability may suffer.\\nThis logic should be moved to an asynchrono\", \"us pattern.\\n\\n\\nAlthough there isn\\u2019t the same native support for dataset binding, Blazor provides flex\", \"ibility and power\\nwith its C# support in a Razor page. For example, you can perform calculations and\", \" display the result.\\nFor more information on data patterns in Blazor, see the Data access chapter.\\n\\n\", \"### Architectural changes\\n\\n\\nFinally, there are some important architectural differences to consider \", \"when migrating to Blazor. Many\\nof these changes are applicable to anything based on .NET Core or ASP\", \".NET Core.\\n\\n\\nBecause Blazor is built on .NET Core, there are considerations in ensuring support on .\", \"NET Core. Some\\nof the major changes include the removal of the following features:\\n\\n\\n  - Multiple Ap\", \"pDomains\\n\\n  - Remoting\\n\\n  - Code Access Security (CAS)\\n\\n  - Security Transparency\\n\\n\\nFor more informa\", \"tion on techniques to identify necessary changes to support running on .NET Core,\\n[see Port your cod\", \"e from .NET Framework to .NET Core.](https://docs.microsoft.com/en-us/dotnet/core/porting/)\\n\\n\\nASP.NE\", \"T Core is a reimagined version of ASP.NET and has some changes that may not initially seem\\nobvious. \", \"The main changes are:\\n\\n\\n  - No synchronization context, which means there\\u2019s no HttpContext.Current,\\n\", \"Thread.CurrentPrincipal, or other static accessors\\n\\n  - No shadow copying\\n\\n  - No request queue\\n\\nMan\", \"y operations in ASP.NET Core are asynchronous, which allows easier off-loading of I/O-bound\\ntasks. I\", \"t\\u2019s important to never block by using Task.Wait() or Task.GetResult(), which can quickly exhaust\\nthr\", \"ead pool resources.\\n\\n\\n91 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\n### Migration concl\", \"usion\\n\\nAt this point, you\\u2019ve seen many examples of what it takes to move a Web Forms project to Blaz\", \"or. For\\n[a full example, see the eShopOnBlazor project.](https://github.com/dotnet-architecture/eSho\", \"pOnBlazor)\\n\\n\\n92 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\n\"]"