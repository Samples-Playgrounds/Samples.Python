"[\"\\n\\fEDITION v8.0 - Updated to .NET 8\\n\\nRefer to changelog for the book updates and community contributi\", \"ons.\\n\\nPUBLISHED BY\\n\\nMicrosoft Developer Division, .NET, and Visual Studio product teams\\n\\nA division \", \"of Microsoft Corporation\\n\\nOne Microsoft Way\\n\\nRedmond, Washington 98052-6399\\n\\nCopyright \\u00a9 2023 by Mic\", \"rosoft Corporation\\n\\nAll rights reserved. No part of the contents of this book may be reproduced or t\", \"ransmitted in any\\nform or by any means without the written permission of the publisher.\\n\\nThis book i\", \"s provided \\u201cas-is\\u201d and expresses the author\\u2019s views and opinions. The views, opinions, and\\ninformati\", \"on expressed in this book, including URL and other Internet website references, may change\\nwithout n\", \"otice.\\n\\nSome examples depicted herein are provided for illustration only and are fictitious. No real\", \" association\\nor connection is intended or should be inferred.\\n\\nMicrosoft and the trademarks listed a\", \"t https://www.microsoft.com on the \\u201cTrademarks\\u201d webpage are\\ntrademarks of the Microsoft group of com\", \"panies.\\n\\nMac and macOS are trademarks of Apple Inc.\\n\\nAll other marks and logos are property of their\", \" respective owners.\\n\\nAuthors:\\n\\nDaniel Roth, Principal Program Manager, Microsoft Corp.\\n\\nJeff Fritz, \", \"Senior Program Manager, Microsoft Corp.\\n\\nTaylor Southwick, Senior Software Engineer, Microsoft Corp.\", \"\\n\\nScott Addie, Senior Content Developer, Microsoft Corp.\\n\\nSteve \\u201c@ardalis\\u201d Smith, Software Architect\", \" and Trainer, NimblePros.com\\n\\nIntroduction\\n\\n.NET has long supported web app development through ASP.\", \"NET, a comprehensive set of frameworks\\nand tools for building any kind of web app. ASP.NET has its o\", \"wn lineage of web frameworks and\\ntechnologies starting all the way back with classic Active Server P\", \"ages (ASP). Frameworks like ASP.NET\\nWeb Forms, ASP.NET MVC, ASP.NET Web Pages, and more recently ASP\", \".NET Core, provide a\\nproductive and powerful way to build server-rendered web apps, where UI content\", \" is dynamically\\ngenerated on the server in response to HTTP requests. Each ASP.NET framework caters \", \"to a different\\naudience and app building philosophy. ASP.NET Web Forms shipped with the original rel\", \"ease of the\\n.NET Framework and enabled web development using many of the patterns familiar to deskto\", \"p\\n\\n\\fdevelopers, like reusable UI controls with simple event handling. However, none of the ASP.NET\\no\", \"fferings provide a way to run code that executed in the user\\u2019s browser. To do that requires writing\\n\", \"JavaScript and using any of the many JavaScript frameworks and tools that have phased in and out of\\n\", \"popularity over the years: jQuery, Knockout, Angular, React, and so on.\\n\\nBlazor is a new web framewo\", \"rk that changes what is possible when building web apps with .NET.\\nBlazor is a client-side web UI fr\", \"amework based on C# instead of JavaScript. With Blazor you can write\\nyour client-side logic and UI c\", \"omponents in C#, compile them into normal .NET assemblies, and then\\nrun them directly in the browser\", \" using a new open web standard called WebAssembly. Or\\nalternatively, Blazor can run your .NET UI com\", \"ponents on the server and handle all UI interactions\\nfluidly over a real-time connection with the br\", \"owser. When paired with .NET running on the server,\\nBlazor enables full-stack web development with .\", \"NET. While Blazor shares many commonalities with\\nASP.NET Web Forms, like having a reusable component\", \" model and a simple way to handle user\\nevents, it also builds on the foundations of .NET to provide \", \"a modern and high-performance web\\ndevelopment experience.\\n\\nThis book introduces ASP.NET Web Forms de\", \"velopers to Blazor in a way that is familiar and\\nconvenient. It introduces Blazor concepts in parall\", \"el with analogous concepts in ASP.NET Web Forms\\nwhile also explaining new concepts that may be less \", \"familiar. It covers a broad range of topics and\\nconcerns including component authoring, routing, lay\", \"out, configuration, and security. And while the\\ncontent of this book is primarily for enabling new d\", \"evelopment, it also covers guidelines and\\nstrategies for migrating existing ASP.NET Web Forms to Bla\", \"zor for when you want to modernize an\\nexisting app.\\n\\nWho should use the book\\n\\nThis book is for ASP.N\", \"ET Web Forms developers looking for an introduction to Blazor that relates to\\ntheir existing knowled\", \"ge and skills. This book can help with quickly getting started on a new Blazor-\\nbased project or to \", \"help chart a roadmap for modernizing an existing ASP.NET Web Forms\\napplication.\\n\\nHow to use the book\", \"\\n\\nThe first part of this book covers what Blazor is and compares it to web app development with\\nASP.\", \"NET Web Forms. The book then covers a variety of Blazor topics, chapter by chapter, and relates\\neach\", \" Blazor concept to the corresponding concept in ASP.NET Web Forms, or explains fully any\\ncompletely \", \"new concepts. The book also refers regularly to a complete sample app implemented in\\nboth ASP.NET We\", \"b Forms and Blazor to demonstrate Blazor features and to provide a case study for\\nmigrating from ASP\", \".NET Web Forms to Blazor. You can find both implementations of the sample app\\n(ASP.NET Web Forms and\", \" Blazor versions) on GitHub.\\n\\nWhat this book doesn\\u2019t cover\\n\\nThis book is an introduction to Blazor, \", \"not a comprehensive migration guide. While it does include\\nguidance on how to approach migrating a p\", \"roject from ASP.NET Web Forms to Blazor, it does not\\n\\n\\fattempt to cover every nuance and detail. For\", \" more general guidance on migrating from ASP.NET to\\nASP.NET Core, refer to the migration guidance in\", \" the ASP.NET Core documentation.\\n\\nAdditional resources\\n\\nYou can find the official Blazor home page a\", \"nd documentation at https://blazor.net.\\n\\n\\fContents\\n\\nAn introduction to Blazor for ASP.NET Web Forms \", \"developers ........................................ 1\\n\\nAn open-source and cross-platform .NET ......\", \"....................................................................................................\", \"........... 2\\n\\nClient-side web development .........................................................\", \".................................................................................... 3\\n\\nWebAssembly \", \"fulfills a need ....................................................................................\", \"........................................................... 3\\n\\nBlazor: full-stack web development wi\", \"th .NET ............................................................................................\", \"................. 4\\n\\nGet started with Blazor .......................................................\", \"................................................................................................... \", \"4\\n\\nArchitecture comparison of ASP.NET Web Forms and Blazor .........................................\", \"... 5\\n\\nASP.NET Web Forms ...........................................................................\", \".................................................................................... 5\\n\\nBlazor .....\", \"....................................................................................................\", \"................................................................................... 6\\n\\nBlazor app ho\", \"sting models .......................................................................................\", \".............. 8\\n\\nBlazor WebAssembly apps ..........................................................\", \"......................................................................................... 8\\n\\nBlazor \", \"Server apps ........................................................................................\", \"........................................................................... 9\\n\\nHow to choose the rig\", \"ht Blazor hosting model ............................................................................\", \"........................... 10\\n\\nDeploy your app ....................................................\", \"....................................................................................................\", \"............ 11\\n\\nProject structure for Blazor apps .................................................\", \"........................................ 12\\n\\nProject file ..........................................\", \"....................................................................................................\", \".................................. 12\\n\\nEntry point .................................................\", \"....................................................................................................\", \".......................... 13\\n\\nStatic files ........................................................\", \"....................................................................................................\", \"..................... 15\\n\\nConfiguration.............................................................\", \"....................................................................................................\", \"......... 15\\n\\nRazor components .....................................................................\", \".......................................................................................... 15\\n\\nPages\", \" ...................................................................................................\", \"....................................................................................... 16\\n\\nLayout .\", \"....................................................................................................\", \"................................................................................... 16\\n\\nBootstrap Bl\", \"azor ...............................................................................................\", \"..................................................................... 16\\n\\nBuild output .............\", \"....................................................................................................\", \"........................................................... 18\\n\\nRun the app with Hot Reload.........\", \"....................................................................................................\", \".............................. 18\\n\\nApp startup .....................................................\", \"....................................................................... 21\\n\\nApplication_Start and We\", \"b Forms ............................................................................................\", \"..................................... 21\\n\\nBlazor Server Startup Structure ..........................\", \"....................................................................................................\", \"......... 21\\n\\ni\\n\\nContents\\n\\n\\fUpgrading the BundleConfig Process .....................................\", \"..................................................................................... 23\\n\\nBuild reus\", \"able UI components with Blazor......................................................................\", \"... 24\\n\\nAn introduction to Razor ...................................................................\", \"................................................................................ 24\\n\\nUse components \", \"....................................................................................................\", \"............................................................... 28\\n\\nModify page title from component\", \"s ..................................................................................................\", \"........................... 28\\n\\nComponent parameters ...............................................\", \"....................................................................................................\", \".. 29\\n\\nQuery string parameters .....................................................................\", \".......................................................................... 29\\n\\nComponents and error \", \"boundaries .........................................................................................\", \"...................................... 30\\n\\nEvent handlers ..........................................\", \"....................................................................................................\", \".......................... 30\\n\\nData binding ........................................................\", \"....................................................................................................\", \"............... 32\\n\\nState changes ..................................................................\", \"....................................................................................................\", \"... 33\\n\\nComponent lifecycle ........................................................................\", \".................................................................................... 34\\n\\nOnInitializ\", \"ed .................................................................................................\", \"...................................................................... 34\\n\\nOnParametersSet .........\", \"....................................................................................................\", \"................................................ 35\\n\\nOnAfterRender .................................\", \"....................................................................................................\", \"............................. 35\\n\\nIDisposable ......................................................\", \"....................................................................................................\", \"............... 35\\n\\nCapture component references ...................................................\", \"................................................................................... 36\\n\\nCapture elem\", \"ent references .....................................................................................\", \"........................................................ 36\\n\\nTemplated components ..................\", \"....................................................................................................\", \"............................... 36\\n\\nChild content...................................................\", \"....................................................................................................\", \"............... 37\\n\\nTemplate parameters ............................................................\", \".......................................................................................... 37\\n\\nCode-\", \"behind .............................................................................................\", \".............................................................................. 38\\n\\nAdditional resour\", \"ces ................................................................................................\", \"............................................................ 39\\n\\nPages, routing, and layouts .......\", \"........................................................................................... 40\\n\\nCrea\", \"te pages ...........................................................................................\", \"................................................................................ 41\\n\\nRouter componen\", \"t ..................................................................................................\", \"............................................................. 42\\n\\nNavigation .......................\", \"....................................................................................................\", \".................................................... 42\\n\\nBase URLs .................................\", \"....................................................................................................\", \"............................................ 43\\n\\nPage layout .......................................\", \"....................................................................................................\", \"................................... 43\\n\\nState management ...........................................\", \"..................................................................... 46\\n\\nRequest state management w\", \"ith ViewState ......................................................................................\", \"........................ 46\\n\\nii\\n\\nContents\\n\\n\\fMaintain state with Session ............................\", \"....................................................................................................\", \".............. 47\\n\\nApplication state ...............................................................\", \"....................................................................................................\", \" 47\\n\\nIn the browser ................................................................................\", \"........................................................................................ 48\\n\\nForms a\", \"nd validation ......................................................................................\", \"...................... 49\\n\\nAdditional resources ....................................................\", \"....................................................................................................\", \".... 51\\n\\nWork with data ............................................................................\", \".......................................... 52\\n\\nEntity Framework ....................................\", \"....................................................................................................\", \".......................... 52\\n\\nEF Code First........................................................\", \"....................................................................................................\", \"........... 53\\n\\nEF Database First ..................................................................\", \"............................................................................................ 54\\n\\nInt\", \"eract with web services ............................................................................\", \"..................................................................... 54\\n\\nModules, handlers, and mid\", \"dleware ................................................................................... 56\\n\\nOver\", \"view ...............................................................................................\", \".................................................................................... 56\\n\\nKatana ....\", \"....................................................................................................\", \"................................................................................ 57\\n\\nCommon middlewa\", \"re .................................................................................................\", \"......................................................... 57\\n\\nCustom middleware ....................\", \"....................................................................................................\", \"..................................... 58\\n\\nApp configuration ........................................\", \"......................................................................... 60\\n\\nConfiguration sources \", \"....................................................................................................\", \"..................................................... 60\\n\\nappsettings.json format and access .......\", \"....................................................................................................\", \"................... 61\\n\\nUser secrets ...............................................................\", \"....................................................................................................\", \".......... 61\\n\\nEnvironment variables ...............................................................\", \".......................................................................................... 61\\n\\nComma\", \"nd-line arguments ..................................................................................\", \".............................................................. 62\\n\\nThe return of web.config ........\", \"....................................................................................................\", \"....................................... 62\\n\\nRead configuration in the app ..........................\", \"....................................................................................................\", \"........... 63\\n\\nStrongly typed configuration .......................................................\", \".................................................................................... 63\\n\\nSecurity: A\", \"uthentication and Authorization in ASP.NET Web Forms and Blazor ........... 65\\n\\nASP.NET universal pr\", \"oviders ............................................................................................\", \"................................................. 65\\n\\nAuthorization configuration in Web Forms .....\", \"....................................................................................................\", \".. 66\\n\\nAuthorization code in Web Forms .............................................................\", \"............................................................... 67\\n\\nASP.NET Core Identity ..........\", \"....................................................................................................\", \"........................................... 68\\n\\nRoles, claims, and policies ........................\", \"....................................................................................................\", \"................ 68\\n\\nMigration guide ...............................................................\", \"................................................................................................. 70\", \"\\n\\niii\\n\\nContents\\n\\n\\fCreating the ASP.NET Core Identity schema ........................................\", \"................................................................. 70\\n\\nMigrating data from universal \", \"providers to ASP.NET Core Identity ............................................................ 73\\n\\n\", \"Migrating security settings from web.config to app startup .........................................\", \"................................. 74\\n\\nUpdating individual pages to use ASP.NET Core Identity abstrac\", \"tions ..................................................... 75\\n\\nSummary ............................\", \"....................................................................................................\", \".................................................. 76\\n\\nReferences ..................................\", \"....................................................................................................\", \"......................................... 77\\n\\nMigrate from ASP.NET Web Forms to Blazor .............\", \"........................................................ 78\\n\\nServer-side versus client-side hosting \", \"....................................................................................................\", \"...................... 78\\n\\nCreate a new project.....................................................\", \"....................................................................................................\", \"... 79\\n\\nEnable startup process .....................................................................\", \"................................................................................... 80\\n\\nMigrate HTTP\", \" modules and handlers to middleware ................................................................\", \"............................ 83\\n\\nMigrate static files ..............................................\", \"....................................................................................................\", \".............. 84\\n\\nMigrate runtime bundling and minification setup .................................\", \"................................................................. 84\\n\\nMigrate ASPX pages ...........\", \"....................................................................................................\", \"............................................. 84\\n\\nModel validation in Blazor .......................\", \"....................................................................................................\", \"................. 88\\n\\nMigrate configuration ........................................................\", \"................................................................................................. 89\", \"\\n\\nMigrate data access ..............................................................................\", \"............................................................................... 91\\n\\nArchitectural ch\", \"anges ..............................................................................................\", \"............................................................ 91\\n\\nMigration conclusion ..............\", \"....................................................................................................\", \"......................................... 92\\n\\niv\\n\\nContents\\n\\n\\fCHAPTER  1\\n\\nAn introduction to Blazor\\nf\", \"or ASP.NET Web Forms\\ndevelopers\\n\\nThe ASP.NET Web Forms framework has been a staple of .NET web devel\", \"opment since the .NET\\nFramework first shipped in 2002. Back when the Web was still largely in its in\", \"fancy, ASP.NET Web\\nForms made building web apps simple and productive by adopting many of the patter\", \"ns that were\\nused for desktop development. In ASP.NET Web Forms, web pages can be quickly composed f\", \"rom\\nreusable UI controls. User interactions are handled naturally as events. There\\u2019s a rich ecosyste\", \"m of\\nWeb Forms UI controls provided by Microsoft and control vendors. The controls ease the efforts \", \"of\\nconnecting to data sources and displaying rich data visualizations. For the visually inclined, th\", \"e Web\\nForms designer provides a simple drag-and-drop interface for managing controls.\\n\\nOver the year\", \"s, Microsoft has introduced new ASP.NET-based web frameworks to address web\\ndevelopment trends. Some\", \" such web frameworks include ASP.NET MVC, ASP.NET Web Pages, and\\nmore recently ASP.NET Core. With ea\", \"ch new framework, some have predicted the imminent decline of\\nASP.NET Web Forms and criticized it as\", \" an outdated, outmoded web framework. Despite these\\npredictions, many .NET web developers continue t\", \"o find ASP.NET Web Forms a simple, stable, and\\nproductive way to get their work done.\\n\\nAt the time o\", \"f writing, almost half a million web developers use ASP.NET Web Forms every month. The\\nASP.NET Web F\", \"orms framework is stable to the point that docs, samples, books, and blog posts from\\na decade ago re\", \"main useful and relevant. For many .NET web developers, \\u201cASP.NET\\u201d is still\\nsynonymous with \\u201cASP.NET \", \"Web Forms\\u201d as it was when .NET was first conceived. Arguments on the\\npros and cons of ASP.NET Web Fo\", \"rms compared to the other new .NET web frameworks may rage on.\\nASP.NET Web Forms remains a popular f\", \"ramework for creating web apps.\\n\\nEven so, innovations in software development aren\\u2019t slowing. All so\", \"ftware developers need to stay\\nabreast of new technologies and trends. Two trends in particular are \", \"worth considering:\\n\\n1.\\n\\n2.\\n\\nThe shift to open-source and cross-platform\\n\\nThe shift of app logic to t\", \"he client\\n\\n1\\n\\nCHAPTER 1 | An introduction to Blazor for ASP.NET Web Forms developers\\n\\n\\fAn open-sourc\", \"e and cross-platform .NET\\n\\nWhen .NET and ASP.NET Web Forms first shipped, the platform ecosystem loo\", \"ked much different than\\nit does today. The desktop and server markets were dominated by Windows. Alt\", \"ernative platforms like\\nmacOS and Linux were still struggling to gain traction. ASP.NET Web Forms sh\", \"ips with the .NET\\nFramework as a Windows-only component, which means ASP.NET Web Forms apps can only\", \" run on\\nWindows Server machines. Many modern environments now use different kinds of platforms for\\ns\", \"ervers and development machines such that cross-platform support for many users is an absolute\\nrequi\", \"rement.\\n\\nMost modern web frameworks are now also open-source, which has a number of benefits. Users\\n\", \"aren\\u2019t beheld to a single project owner to fix bugs and add features. Open-source projects provide\\ni\", \"mproved transparency on development progress and upcoming changes. Open-source projects enjoy\\ncontri\", \"butions from an entire community, and they foster a supportive open-source ecosystem.\\nDespite the ri\", \"sks of open-source, many consumers and contributors have found suitable mitigations\\nthat enable them\", \" to enjoy the benefits of an open-source ecosystem in a safe and reasonable way.\\nExamples of such mi\", \"tigations include contributor license agreements, friendly licenses, pedigree scans,\\nand supporting \", \"foundations.\\n\\nThe .NET community has embraced both cross-platform support and open-source. .NET Core\", \" is an\\nopen-source and cross-platform implementation of .NET that runs on a plethora of platforms,\\ni\", \"ncluding Windows, macOS, and various Linux distributions. Xamarin provides Mono, an open-source\\nvers\", \"ion of .NET. Mono runs on Android, iOS, and a variety of other form factors, including watches\\nand s\", \"mart TVs. In 2020, Microsoft released .NET 5 that reconciled .NET Core and Mono into \\u201ca single\\n.NET \", \"runtime and framework that can be used everywhere and that has uniform runtime behaviors\\nand develop\", \"er experiences.\\u201d\\n\\nWill ASP.NET Web Forms benefit from the move to open-source and cross-platform sup\", \"port? The\\nanswer, unfortunately, is no, or at least not to the same extent as the rest of the platfo\", \"rm. The .NET\\nteam made it clear that ASP.NET Web Forms won\\u2019t be ported to .NET Core or .NET 8. Why i\", \"s that?\\n\\nThere were efforts in the early days of .NET Core to port ASP.NET Web Forms. The number of \", \"breaking\\nchanges required were found to be too drastic. There\\u2019s also an admission here that even for\", \" Microsoft,\\nthere\\u2019s a limit to the number of web frameworks that it can support simultaneously. Perh\", \"aps someone\\nin the community will take up the cause of creating an open-source and cross-platform ve\", \"rsion of\\nASP.NET Web Forms. The source code for ASP.NET Web Forms has been made available publicly i\", \"n\\nreference form. But for the time being, it seems ASP.NET Web Forms will remain Windows-only and\\nwi\", \"thout an open-source contribution model. If cross-platform support or open-source become\\nimportant f\", \"or your scenarios, then you\\u2019ll need to look for something new.\\n\\nDoes this mean ASP.NET Web Forms is \", \"dead and should no longer be used? Of course not! As long as\\nthe .NET Framework ships as part of Win\", \"dows, ASP.NET Web Forms will be a supported framework.\\nFor many Web Forms developers, the lack of cr\", \"oss-platform and open-source support is a non-issue.\\nIf you don\\u2019t have a requirement for cross-platf\", \"orm support, open-source, or any of the other new\\nfeatures in .NET Core or .NET 8, then sticking wit\", \"h ASP.NET Web Forms on Windows is fine. ASP.NET\\nWeb Forms will continue to be a productive way to wr\", \"ite web apps for many years to come.\\n\\nBut there\\u2019s another trend worth considering, and that\\u2019s the sh\", \"ift to the client.\\n\\n2\\n\\nCHAPTER 1 | An introduction to Blazor for ASP.NET Web Forms developers\\n\\n\\fClie\", \"nt-side web development\\n\\nAll of the .NET-based web frameworks, including ASP.NET Web Forms, have his\", \"torically had one thing\\nin common: they\\u2019re server-rendered. In server-rendered web apps, the browser\", \" makes a request to the\\nserver, which executes some code (.NET code in ASP.NET apps) to produce a re\", \"sponse. That response\\nis sent back to the browser to handle. In this model, the browser is used as a\", \" thin rendering engine.\\nThe hard work of producing the UI, running the business logic, and managing \", \"state occurs on the\\nserver.\\n\\nHowever, browsers have become versatile platforms. They implement an ev\", \"er-increasing number of\\nopen web standards that grant access to the capabilities of the user\\u2019s machi\", \"ne. Why not take\\nadvantage of the compute power, storage, memory, and other resources of the client \", \"device? UI\\ninteractions in particular can benefit from a richer and more interactive feel when handl\", \"ed at least\\npartially or completely client-side. Logic and data that should be handled on the server\", \" can still be\\nhandled server-side. Web API calls or even real-time protocols, like WebSockets, can b\", \"e used. These\\nbenefits are available to web developers for free if they\\u2019re willing to write JavaScri\", \"pt. Client-side UI\\nframeworks, such as Angular, React, and Vue, simplify client-side web development\", \" and have grown in\\npopularity. ASP.NET Web Forms developers can also benefit from leveraging the cli\", \"ent, and even have\\nsome out-of-the-box support with integrated JavaScript frameworks like ASP.NET AJ\", \"AX.\\n\\nBut bridging two different platforms and ecosystems (.NET and JavaScript) comes with a cost.\\nEx\", \"pertise is required in two parallel worlds with different languages, frameworks, and tools. Code and\", \"\\nlogic can\\u2019t be easily shared between client and server, resulting in duplication and engineering\\nov\", \"erhead. It can also be difficult to keep up with the JavaScript ecosystem, which has a history of\\nev\", \"olving at breakneck speed. Front-end framework and build tool preferences change quickly. The\\nindust\", \"ry has observed the progression from Grunt to Gulp to Webpack, and so on. The same restless\\nchurn ha\", \"s occurred with front-end frameworks such as jQuery, Knockout, Angular, React, and Vue. But\\ngiven Ja\", \"vaScript\\u2019s browser monopoly, there was little choice in the matter. That is, until the web\\ncommunity\", \" got together and caused a miracle to happen!\\n\\nWebAssembly fulfills a need\\n\\nIn 2015, the major brows\", \"er vendors joined forces in a W3C Community Group to create a new open\\nweb standard called WebAssemb\", \"ly. WebAssembly is a byte code for the Web. If you can compile your\\ncode to WebAssembly, it can then\", \" run on any browser on any platform at near native speed. Initial\\nefforts focused on C/C++. The resu\", \"lt was a dramatic demonstration of running native 3D graphics\\nengines directly in the browser withou\", \"t plugins. WebAssembly has since been standardized and\\nimplemented by all major browsers.\\n\\nWork on r\", \"unning .NET on WebAssembly was announced in late 2017 and released in 2020, including\\nsupport in .NE\", \"T 5 and beyond. The ability to run .NET code directly in the browser enables full-stack\\nweb developm\", \"ent with .NET.\\n\\n3\\n\\nCHAPTER 1 | An introduction to Blazor for ASP.NET Web Forms developers\\n\\n\\fBlazor: \", \"full-stack web development with .NET\\n\\nOn its own, the ability to run .NET code in a browser doesn\\u2019t \", \"provide an end-to-end experience for\\ncreating client-side web apps. That\\u2019s where Blazor comes in. Bl\", \"azor is a client-side web UI framework\\nbased on C# instead of JavaScript. Blazor can run directly in\", \" the browser via WebAssembly. No\\nbrowser plugins are required. Alternatively, Blazor apps can run se\", \"rver-side on .NET and handle all\\nuser interactions over a real-time connection with the browser.\\n\\nBl\", \"azor has great tooling support in Visual Studio and Visual Studio Code. The framework also includes\\n\", \"a full UI component model and has built-in facilities for:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nForms and validation\\n\\n\", \"Dependency injection\\n\\nClient-side routing\\n\\nLayouts\\n\\nIn-browser debugging\\n\\nJavaScript interop\\n\\nBlazor\", \" has a lot in common with ASP.NET Web Forms. Both frameworks offer component-based,\\nevent-driven, st\", \"ateful UI programming models. The main architectural difference is that ASP.NET Web\\nForms runs only \", \"on the server. Blazor can run on the client in the browser. But if you\\u2019re coming from\\nan ASP.NET Web\", \" Forms background, there\\u2019s a lot in Blazor that will feel familiar. Blazor is a natural\\nsolution for\", \" ASP.NET Web Forms developers looking for a way to take advantage of client-side\\ndevelopment and the\", \" open-source, cross-platform future of .NET.\\n\\nThis book provides an introduction to Blazor that is c\", \"atered specifically to ASP.NET Web Forms\\ndevelopers. Each Blazor concept is presented in the context\", \" of analogous ASP.NET Web Forms\\nfeatures and practices. By the end of this book, you\\u2019ll have an unde\", \"rstanding of:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nHow to build Blazor apps.\\n\\nHow Blazor works.\\n\\nHow Blazor relates to .NET.\", \"\\n\\nReasonable strategies for migrating existing ASP.NET Web Forms apps to Blazor where\\nappropriate.\\n\\n\", \"Get started with Blazor\\n\\nGetting started with Blazor is easy. Go to https://blazor.net and follow th\", \"e links to install the\\nappropriate .NET SDK and Blazor project templates. You\\u2019ll also find instructi\", \"ons for setting up the\\nBlazor tooling in Visual Studio or Visual Studio Code.\\n\\n4\\n\\nCHAPTER 1 | An int\", \"roduction to Blazor for ASP.NET Web Forms developers\\n\\n\\fCHAPTER  2\\n\\nArchitecture comparison\\nof ASP.NE\", \"T Web Forms\\nand Blazor\\n\\nWhile ASP.NET Web Forms and Blazor have many similar concepts, there are dif\", \"ferences in how they\\nwork. This chapter examines the inner workings and architectures of ASP.NET Web\", \" Forms and Blazor.\\n\\nASP.NET Web Forms\\n\\nThe ASP.NET Web Forms framework is based on a page-centric ar\", \"chitecture. Each HTTP request for a\\nlocation in the app is a separate page with which ASP.NET respon\", \"ds. As pages are requested, the\\ncontents of the browser are replaced with the results of the page re\", \"quested.\\n\\nPages consist of the following components:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nHTML markup\\n\\nC# or Visual Basic co\", \"de\\n\\nA code-behind class containing logic and event-handling capabilities\\n\\nControls\\n\\nControls are reu\", \"sable units of web UI that can be programmatically placed and interacted with on a\\npage. Pages are c\", \"omposed of files that end with .aspx containing markup, controls, and some code.\\nThe code-behind cla\", \"sses are in files with the same base name and an .aspx.cs or .aspx.vb extension,\\ndepending on the pr\", \"ogramming language used. Interestingly, the web server interprets contents of\\nthe .aspx files and co\", \"mpiles them whenever they change. This recompilation occurs even if the web\\nserver is already runnin\", \"g.\\n\\nControls can be built with markup and delivered as user controls. A user control derives from th\", \"e\\nUserControl class and has a similar structure to the Page. Markup for user controls is stored in a\", \"n .ascx\\nfile. An accompanying code-behind class resides in an .ascx.cs or .ascx.vb file. Controls ca\", \"n also be\\nbuilt completely with code, by inheriting from either the WebControl or CompositeControl b\", \"ase class.\\n\\nPages also have an extensive event lifecycle. Each page raises events for the initializa\", \"tion, load,\\nprerender, and unload events that occur as the ASP.NET runtime executes the page\\u2019s code \", \"for each\\nrequest.\\n\\n5\\n\\nCHAPTER 2 | Architecture comparison of ASP.NET Web Forms and Blazor\\n\\n\\fControls\", \" on a Page typically post-back to the same page that presented the control, and carry along\\nwith the\", \"m a payload from a hidden form field called ViewState. The ViewState field contains\\ninformation abou\", \"t the state of the controls at the time they were rendered and presented on the\\npage, allowing the A\", \"SP.NET runtime to compare and identify changes in the content submitted to the\\nserver.\\n\\nBlazor\\n\\nBlaz\", \"or is a client-side web UI framework similar in nature to JavaScript front-end frameworks like\\nAngul\", \"ar or React. Blazor handles user interactions and renders the necessary UI updates. Blazor isn\\u2019t\\nbas\", \"ed on a request-reply model. User interactions are handled as events that aren\\u2019t in the context of\\na\", \"ny particular HTTP request.\\n\\nBlazor apps consist of one or more root components that are rendered on\", \" an HTML page.\\n\\nHow the user specifies where components should render and how the components are the\", \"n wired up\\nfor user interactions is hosting model specific.\\n\\nBlazor components are .NET classes that\", \" represent a reusable piece of UI. Each component maintains\\nits own state and specifies its own rend\", \"ering logic, which can include rendering other components.\\nComponents specify event handlers for spe\", \"cific user interactions to update the component\\u2019s state.\\n\\nAfter a component handles an event, Blazor\", \" renders the component and keeps track of what changed\\nin the rendered output. Components don\\u2019t rend\", \"er directly to the Document Object Model (DOM).\\nThey instead render to an in-memory representation o\", \"f the DOM called a RenderTree so that Blazor\\ncan track the changes. Blazor compares the newly render\", \"ed output with the previous output to\\ncalculate a UI diff that it then applies efficiently to the DO\", \"M.\\n\\n6\\n\\nCHAPTER 2 | Architecture comparison of ASP.NET Web Forms and Blazor\\n\\n\\fComponents can also man\", \"ually indicate that they should be rendered if their state changes outside of\\na normal UI event. Bla\", \"zor uses a SynchronizationContext to enforce a single logical thread of\\nexecution. A component\\u2019s lif\", \"ecycle methods and any event callbacks that are raised by Blazor are\\nexecuted on this Synchronizatio\", \"nContext.\\n\\n7\\n\\nCHAPTER 2 | Architecture comparison of ASP.NET Web Forms and Blazor\\n\\n\\fCHAPTER  3\\n\\nBlaz\", \"or app hosting models\\n\\nBlazor apps can be hosted in one of the following ways:\\n\\n\\u2022\\n\\n\\u2022\\n\\nClient-side in\", \" the browser on WebAssembly.\\n\\nServer-side in an ASP.NET Core app.\\n\\nBlazor WebAssembly apps\\n\\nBlazor W\", \"ebAssembly apps execute directly in the browser on a WebAssembly-based .NET runtime.\\nBlazor WebAssem\", \"bly apps function in a similar way to front-end JavaScript frameworks like Angular or\\nReact. However\", \", instead of writing JavaScript you write C#. The .NET runtime is downloaded with the\\napp along with\", \" the app assembly and any required dependencies. No browser plugins or extensions\\nare required.\\n\\nThe\", \" downloaded assemblies are normal .NET assemblies, like you would use in any other .NET app.\\nBecause\", \" the runtime supports .NET Standard, you can use existing .NET Standard libraries with your\\nBlazor W\", \"ebAssembly app. However, these assemblies will still execute in the browser security\\nsandbox. Some f\", \"unctionality may throw a PlatformNotSupportedException, like trying to access the\\nfile system or ope\", \"ning arbitrary network connections.\\n\\nWhen the app loads, the .NET runtime is started and pointed at \", \"the app assembly. The app startup\\nlogic runs, and the root components are rendered. Blazor calculate\", \"s the UI updates based on the\\nrendered output from the components. The DOM updates are then applied.\", \"\\n\\n8\\n\\nCHAPTER 3 | Blazor app hosting models\\n\\n\\fBlazor WebAssembly apps run purely client-side. Such ap\", \"ps can be deployed to static site hosting\\nsolutions like GitHub Pages or Azure Static Website Hostin\", \"g. .NET isn\\u2019t required on the server at all.\\nDeep linking to parts of the app typically requires a r\", \"outing solution on the server. The routing\\nsolution redirects requests to the root of the app. For e\", \"xample, this redirection can be handled using\\nURL rewrite rules in IIS.\\n\\nTo get all the benefits of \", \"Blazor and full-stack .NET web development, host your Blazor WebAssembly\\napp with ASP.NET Core. By u\", \"sing .NET on both the client and server, you can easily share code and\\nbuild your app using one cons\", \"istent set of languages, frameworks, and tools. Blazor provides\\nconvenient templates for setting up \", \"a solution that contains both a Blazor WebAssembly app and an\\nASP.NET Core host project. When the so\", \"lution is built, the built static files from the Blazor app are\\nhosted by the ASP.NET Core app with \", \"fallback routing already setup.\\n\\nBlazor Server apps\\n\\nRecall from the Blazor architecture discussion \", \"that Blazor components render their output to an\\nintermediate abstraction called a RenderTree. The B\", \"lazor framework then compares what was\\nrendered with what was previously rendered. The differences a\", \"re applied to the DOM. Blazor\\ncomponents are decoupled from how their rendered output is applied. Co\", \"nsequently, the\\ncomponents themselves don\\u2019t have to run in the same process as the process updating \", \"the UI. In fact,\\nthey don\\u2019t even have to run on the same machine.\\n\\nIn Blazor Server apps, the compon\", \"ents run on the server instead of client-side in the browser. UI\\nevents that occur in the browser ar\", \"e sent to the server over a real-time connection. The events are\\ndispatched to the correct component\", \" instances. The components render, and the calculated UI diff is\\nserialized and sent to the browser \", \"where it\\u2019s applied to the DOM.\\n\\n9\\n\\nCHAPTER 3 | Blazor app hosting models\\n\\n\\fThe Blazor Server hosting\", \" model may sound familiar if you\\u2019ve used ASP.NET AJAX and the\\nUpdatePanel control. The UpdatePanel c\", \"ontrol handles applying partial page updates in response to\\ntrigger events on the page. When trigger\", \"ed, the UpdatePanel requests a partial update and then\\napplies it without needing to refresh the pag\", \"e. The state of the UI is managed using ViewState. Blazor\\nServer apps are slightly different in that\", \" the app requires an active connection with the client.\\nAdditionally, all UI state is maintained on \", \"the server. Aside from those differences, the two models are\\nconceptually similar.\\n\\nHow to choose th\", \"e right Blazor hosting model\\n\\nAs described in the Blazor hosting model docs, the different Blazor ho\", \"sting models have different\\ntradeoffs.\\n\\nThe Blazor WebAssembly hosting model has the following benef\", \"its:\\n\\n\\u2022\\n\\n\\u2022\\n\\nThere\\u2019s no .NET server-side dependency. The app is fully functioning after downloaded to\", \" the\\nclient.\\n\\nClient resources and capabilities are fully leveraged.\\n\\n\\u2022  Work is offloaded from the \", \"server to the client.\\n\\n\\u2022\\n\\nAn ASP.NET Core web server isn\\u2019t required to host the app. Serverless depl\", \"oyment scenarios\\nare possible (for example, serving the app from a CDN).\\n\\nThe downsides of the Blazo\", \"r WebAssembly hosting model are:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n10\\n\\nBrowser capabilities restrict the app.\\n\\nCapable clien\", \"t hardware and software (for example, WebAssembly support) is required.\\n\\nDownload size is larger, an\", \"d apps take longer to load.\\n\\nCHAPTER 3 | Blazor app hosting models\\n\\n\\f\\u2022\\n\\n.NET runtime and tooling sup\", \"port is less mature. For example, there are limitations in .NET\\nStandard support and debugging.\\n\\nCon\", \"versely, the Blazor Server hosting model offers the following benefits:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nDownload siz\", \"e is much smaller than a client-side app, and the app loads much faster.\\n\\nThe app takes full advanta\", \"ge of server capabilities, including use of any .NET compatible APIs.\\n\\n.NET on the server is used to\", \" run the app, so existing .NET tooling, such as debugging, works\\nas expected.\\n\\nThin clients are supp\", \"orted. For example, server-side apps work with browsers that don\\u2019t\\nsupport WebAssembly and on resour\", \"ce-constrained devices.\\n\\nThe app\\u2019s .NET/C# code base, including the app\\u2019s component code, isn\\u2019t serv\", \"ed to clients.\\n\\nThe downsides to the Blazor Server hosting model are:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nHigher UI latency\", \". Every user interaction involves a network hop.\\n\\nThere\\u2019s no offline support. If the client connecti\", \"on fails, the app stops working.\\n\\nScalability is challenging for apps with many users. The server mu\", \"st manage multiple client\\nconnections and handle client state.\\n\\nAn ASP.NET Core server is required t\", \"o serve the app. Serverless deployment scenarios aren\\u2019t\\npossible. For example, you can\\u2019t serve the a\", \"pp from a CDN.\\n\\nThe preceding list of trade-offs may be intimidating, but your hosting model can be \", \"changed later.\\nRegardless of the Blazor hosting model selected, the component model is the same. In \", \"principle, the\\nsame components can be used with either hosting model. Your app code doesn\\u2019t change; \", \"however,\\nit\\u2019s a good practice to introduce abstractions so that your components stay hosting model-a\", \"gnostic.\\nThe abstractions allow your app to more easily adopt a different hosting model.\\n\\nDeploy you\", \"r app\\n\\nASP.NET Web Forms apps are typically hosted on IIS on a Windows Server machine or cluster. Bl\", \"azor\\napps can also:\\n\\n\\u2022\\n\\n\\u2022\\n\\nBe hosted on IIS, either as static files or as an ASP.NET Core app.\\n\\nLeve\", \"rage ASP.NET Core\\u2019s flexibility to be hosted on various platforms and server\\ninfrastructures. For ex\", \"ample, you can host a Blazor App using Nginx or Apache on Linux. For\\nmore information about how to p\", \"ublish and deploy Blazor apps, see the Blazor Hosting and\\ndeployment documentation.\\n\\nIn the next sec\", \"tion, we\\u2019ll look at how the projects for Blazor WebAssembly and Blazor Server apps are\\nset up.\\n\\n11\\n\\n\", \"CHAPTER 3 | Blazor app hosting models\\n\\n\\fCHAPTER  4\\n\\nProject structure for Blazor\\napps\\n\\nDespite their\", \" significant project structure differences, ASP.NET Web Forms and Blazor share many\\nsimilar concepts\", \". Here, we\\u2019ll look at the structure of a Blazor project and compare it to an ASP.NET\\nWeb Forms proje\", \"ct.\\n\\nTo create your first Blazor app, follow the instructions in the Blazor getting started steps. Y\", \"ou can\\nfollow the instructions to create either a Blazor Server app or a Blazor WebAssembly app host\", \"ed in\\nASP.NET Core. Except for the hosting model-specific logic, most of the code in both projects i\", \"s the\\nsame.\\n\\nProject file\\n\\nBlazor Server apps are .NET projects. The project file for the Blazor Ser\", \"ver app is about as simple as it\\ncan get:\\n\\n<Project Sdk=\\\"Microsoft.NET.Sdk.Web\\\">\\n\\n  <PropertyGroup>\\n\", \"    <TargetFramework>net8.0</TargetFramework>\\n  </PropertyGroup>\\n\\n</Project>\\nThe project file for a \", \"Blazor WebAssembly app looks slightly more involved (exact version\\nnumbers may vary):\\n<Project Sdk=\\\"\", \"Microsoft.NET.Sdk.BlazorWebAssembly\\\">\\n\\n  <PropertyGroup>\\n    <TargetFramework>net8.0</TargetFramewor\", \"k>\\n    <ImplicitUsings>enable</ImplicitUsings>\\n  </PropertyGroup>\\n\\n  <ItemGroup>\\n    <PackageReferen\", \"ce Include=\\\"Microsoft.AspNetCore.Components.WebAssembly\\\" Version=\\\"8.0.0\\\"\\n/>\\n    <PackageReference In\", \"clude=\\\"Microsoft.AspNetCore.Components.WebAssembly.DevServer\\\"\\nVersion=\\\"8.0.0\\\" PrivateAssets=\\\"all\\\" />\", \"\\n  </ItemGroup>\\n\\n</Project>\\n\\n12\\n\\nCHAPTER 4 | Project structure for Blazor apps\\n\\n\\fBlazor WebAssembly \", \"project targets Microsoft.NET.Sdk.BlazorWebAssembly instead of\\nMicrosoft.NET.Sdk.Web sdk because the\", \"y run in the browser on a WebAssembly-based .NET runtime.\\nYou can\\u2019t install .NET into a web browser \", \"like you can on a server or developer machine.\\nConsequently, the project references the Blazor frame\", \"work using individual package references.\\n\\nBy comparison, a default ASP.NET Web Forms project includ\", \"es almost 300 lines of XML in its .csproj\\nfile, most of which is explicitly listing the various code\", \" and content files in the project. Since the\\nrelease of .NET 5, both Blazor Server and Blazor WebAss\", \"embly apps can easily share one unified\\nruntime.\\n\\nAlthough they\\u2019re supported, individual assembly re\", \"ferences are less common in .NET projects. Most\\nproject dependencies are handled as NuGet package re\", \"ferences. You only need to reference top-level\\npackage dependencies in .NET projects. Transitive dep\", \"endencies are included automatically. Instead of\\nusing the packages.config file commonly found in AS\", \"P.NET Web Forms projects to reference packages,\\npackage references are added to the project file usi\", \"ng the <PackageReference> element.\\n\\n<ItemGroup>\\n  <PackageReference Include=\\\"Newtonsoft.Json\\\" Versio\", \"n=\\\"13.0.2\\\" />\\n</ItemGroup>\\n\\nEntry point\\n\\nThe Blazor Server app\\u2019s entry point is defined in the Progr\", \"am.cs file, as you would see in a Console\\napp. When the app executes, it creates and runs a web host\", \" instance using defaults specific to web\\napps. The web host manages the Blazor Server app\\u2019s lifecycl\", \"e and sets up host-level services.\\nExamples of such services are configuration, logging, dependency \", \"injection, and the HTTP server. This\\ncode is mostly boilerplate and is often left unchanged.\\n\\nusing \", \"BlazorApp3.Areas.Identity;\\nusing BlazorApp3.Data;\\nusing Microsoft.AspNetCore.Components.Authorizatio\", \"n;\\nusing Microsoft.AspNetCore.Identity;\\nusing Microsoft.EntityFrameworkCore;\\n\\nvar builder = WebAppli\", \"cation.CreateBuilder(args);\\n\\n// Add services to the container.\\nvar connectionString = builder.Config\", \"uration.GetConnectionString(\\\"DefaultConnection\\\");\\nbuilder.Services.AddDbContext<ApplicationDbContext\", \">(options =>\\n    options.UseSqlServer(connectionString));\\nbuilder.Services.AddDatabaseDeveloperPageE\", \"xceptionFilter();\\nbuilder.Services.AddDefaultIdentity<IdentityUser>(options =>\\noptions.SignIn.Requir\", \"eConfirmedAccount = true)\\n    .AddEntityFrameworkStores<ApplicationDbContext>();\\nbuilder.Services.Ad\", \"dRazorPages();\\nbuilder.Services.AddServerSideBlazor();\\nbuilder.Services.AddScoped<AuthenticationStat\", \"eProvider,\\nRevalidatingIdentityAuthenticationStateProvider<IdentityUser>>();\\nbuilder.Services.AddSin\", \"gleton<WeatherForecastService>();\\n\\nvar app = builder.Build();\\n\\n// Configure the HTTP request pipelin\", \"e.\\n\\n13\\n\\nCHAPTER 4 | Project structure for Blazor apps\\n\\n\\fif (app.Environment.IsDevelopment())\\n{\\n    a\", \"pp.UseMigrationsEndPoint();\\n}\\nelse\\n{\\n    app.UseExceptionHandler(\\\"/Error\\\");\\n    // The default HSTS \", \"value is 30 days. You may want to change this for production\\nscenarios, see https://aka.ms/aspnetcor\", \"e-hsts.\\n    app.UseHsts();\\n}\\n\\napp.UseHttpsRedirection();\\n\\napp.UseStaticFiles();\\n\\napp.UseRouting();\\n\\n\", \"app.UseAuthorization();\\n\\napp.MapControllers();\\napp.MapBlazorHub();\\napp.MapFallbackToPage(\\\"/_Host\\\");\\n\", \"\\napp.Run();\\n\\nBlazor WebAssembly apps also define an entry point in Program.cs. The code looks slight\", \"ly different.\\nThe code is similar in that it\\u2019s setting up the app host to provide the same host-leve\", \"l services to the\\napp. The WebAssembly app host doesn\\u2019t, however, set up an HTTP server because it e\", \"xecutes directly\\nin the browser.\\n\\nBlazor apps don\\u2019t use a Global.asax file to define the startup log\", \"ic for the app. Instead, this logic is\\ncontained in Program.cs or in a related Startup class that is\", \" referenced from Program.cs. Either way,\\nthis code is used to configure the app and any app-specific\", \" services.\\n\\nIn a Blazor Server app, the Program.cs file shown is used to set up the endpoint for the\", \" real-time\\nconnection used by Blazor between the client browsers and the server.\\n\\nIn a Blazor WebAss\", \"embly app, the Program.cs file defines the root components for the app and where\\nthey should be rend\", \"ered:\\n\\nusing BlazorApp1;\\nusing Microsoft.AspNetCore.Components.Web;\\nusing Microsoft.AspNetCore.Compo\", \"nents.WebAssembly.Hosting;\\n\\nvar builder = WebAssemblyHostBuilder.CreateDefault(args);\\nbuilder.RootCo\", \"mponents.Add<App>(\\\"#app\\\");\\nbuilder.RootComponents.Add<HeadOutlet>(\\\"head::after\\\");\\n\\nbuilder.Services.\", \"AddScoped(sp => new HttpClient { BaseAddress = new\\nUri(builder.HostEnvironment.BaseAddress) });\\n\\nawa\", \"it builder.Build().RunAsync();\\n\\n14\\n\\nCHAPTER 4 | Project structure for Blazor apps\\n\\n\\fStatic files\\n\\nUn\", \"like ASP.NET Web Forms projects, not all files in a Blazor project can be requested as static files.\", \"\\nOnly the files in the wwwroot folder are web-addressable. This folder is referred to as the app\\u2019s \\u201c\", \"web\\nroot\\u201d. Anything outside of the app\\u2019s web root isn\\u2019t web-addressable. This setup provides an addi\", \"tional\\nlevel of security that prevents accidental exposure of project files over the web.\\n\\nConfigura\", \"tion\\n\\nConfiguration in ASP.NET Web Forms apps is typically handled using one or more web.config file\", \"s.\\nBlazor apps don\\u2019t typically have web.config files. If they do, the file is only used to configure\", \" IIS-\\nspecific settings when hosted on IIS. Instead, Blazor Server apps use the ASP.NET Core configu\", \"ration\\nabstractions. (Blazor WebAssembly apps don\\u2019t currently support the same configuration abstrac\", \"tions,\\nbut that may be a feature added in the future.) For example, the default Blazor Server app st\", \"ores some\\nsettings in appsettings.json.\\n\\n{\\n  \\\"Logging\\\": {\\n    \\\"LogLevel\\\": {\\n      \\\"Default\\\": \\\"Inform\", \"ation\\\",\\n      \\\"Microsoft\\\": \\\"Warning\\\",\\n      \\\"Microsoft.Hosting.Lifetime\\\": \\\"Information\\\"\\n    }\\n  },\\n \", \" \\\"AllowedHosts\\\": \\\"*\\\"\\n}\\n\\nYou\\u2019ll learn more about configuration in ASP.NET Core projects in the Config\", \"uration section.\\n\\nRazor components\\n\\nMost files in Blazor projects are .razor files. Razor is a templ\", \"ating language based on HTML and C#\\nthat is used to dynamically generate web UI. The .razor files de\", \"fine components that make up the UI\\nof the app. For the most part, the components are identical for \", \"both the Blazor Server and Blazor\\nWebAssembly apps. Components in Blazor are analogous to user contr\", \"ols in ASP.NET Web Forms.\\n\\nEach Razor component file is compiled into a .NET class when the project \", \"is built. The generated class\\ncaptures the component\\u2019s state, rendering logic, lifecycle methods, ev\", \"ent handlers, and other logic.\\nYou\\u2019ll learn more about authoring components in the Building reusable\", \" UI components with Blazor\\nsection.\\n\\nThe *_Imports.razor* files aren\\u2019t Razor component files. Instea\", \"d, they define a set of Razor directives to\\nimport into other .razor files within the same folder an\", \"d in its subfolders. For example, a\\n*_Imports.razor* file is a conventional way to add using directi\", \"ves for commonly used namespaces:\\n\\n@using System.Net.Http\\n@using System.Net.Http.Json\\n@using Microso\", \"ft.AspNetCore.Components.Forms\\n@using Microsoft.AspNetCore.Components.Routing\\n\\n15\\n\\nCHAPTER 4 | Proje\", \"ct structure for Blazor apps\\n\\n\\f@using Microsoft.AspNetCore.Components.Web\\n@using Microsoft.AspNetCor\", \"e.Components.Web.Virtualization\\n@using Microsoft.AspNetCore.Components.WebAssembly.Http\\n@using Micro\", \"soft.JSInterop\\n@using BlazorApp1\\n@using BlazorApp1.Shared\\n\\nPages\\n\\nWhere are the pages in the Blazor \", \"apps? Blazor doesn\\u2019t define a separate file extension for\\naddressable pages, like the .aspx files in\", \" ASP.NET Web Forms apps. Instead, pages are defined by\\nassigning routes to components. A route is ty\", \"pically assigned using the @page Razor directive. For\\nexample, the Counter component authored in the\", \" Pages/Counter.razor file defines the following route:\\n\\n@page \\\"/counter\\\"\\n\\nRouting in Blazor is handl\", \"ed client-side, not on the server. As the user navigates in the browser, Blazor\\nintercepts the navig\", \"ation and then renders the component with the matching route.\\n\\nThe component routes aren\\u2019t currently\", \" inferred by the component\\u2019s file location like they are with\\n.aspx pages or ASP.NET Core Razor Page\", \"s. This feature may be added in the future. Each route must\\nbe specified explicitly on the component\", \". Storing routable components in a Pages folder has no\\nspecial meaning and is purely a convention.\\n\\n\", \"You\\u2019ll learn more about routing in Blazor in the Pages, routing, and layouts section.\\n\\nLayout\\n\\nIn AS\", \"P.NET Web Forms apps, a common page layout is handled using master pages (Site.Master). In\\nBlazor ap\", \"ps, the page layout is handled using layout components (Shared/MainLayout.razor). Layout\\ncomponents \", \"are discussed in more detail in the Page, routing, and layouts section.\\n\\nBootstrap Blazor\\n\\nTo bootst\", \"rap Blazor, the app must:\\n\\n\\u2022\\n\\n\\u2022\\n\\nSpecify where on the page the root component (App.Razor) should be \", \"rendered.\\n\\nAdd the corresponding Blazor framework script.\\n\\nIn the Blazor Server app, the root compon\", \"ent\\u2019s host page is defined in the *_Host.cshtml* file. This file\\ndefines a Razor Page, not a compone\", \"nt. Razor Pages use Razor syntax to define a server-addressable\\npage, very much like an .aspx page.\\n\", \"\\n@page \\\"/\\\"\\n@namespace BlazorApp3.Pages\\n@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers\\n@{\\n    L\", \"ayout = \\\"_Layout\\\";\\n}\\n\\n16\\n\\nCHAPTER 4 | Project structure for Blazor apps\\n\\n\\f<component type=\\\"typeof(Ap\", \"p)\\\" render-mode=\\\"ServerPrerendered\\\" />\\n\\nThe render-mode attribute is used to define where a root-lev\", \"el component should be rendered. The\\nRenderMode option indicates the manner in which the component s\", \"hould be rendered. The following\\ntable outlines the supported RenderMode options.\\n\\nOption\\n\\nDescripti\", \"on\\n\\nRenderMode.Server\\n\\nRenderMode.ServerPrerendered\\n\\nRenderMode.Static\\n\\nRendered interactively once \", \"a\\nconnection with the browser is\\nestablished\\n\\nFirst prerendered and then rendered\\ninteractively\\n\\nRen\", \"dered as static content\\n\\nThe *_Layout.cshtml* file includes the default HTML for the app and its com\", \"ponents.\\n\\n@using Microsoft.AspNetCore.Components.Web\\n@namespace BlazorApp3.Pages\\n@addTagHelper *, Mi\", \"crosoft.AspNetCore.Mvc.TagHelpers\\n\\n<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n<head>\\n    <meta charset=\\\"utf-8\\\"\", \" />\\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\" />\\n    <base href=\\\"~/\\\"\", \" />\\n    <link rel=\\\"stylesheet\\\" href=\\\"css/bootstrap/bootstrap.min.css\\\" />\\n    <link href=\\\"css/site.cs\", \"s\\\" rel=\\\"stylesheet\\\" />\\n    <link href=\\\"BlazorApp3.styles.css\\\" rel=\\\"stylesheet\\\" />\\n    <component typ\", \"e=\\\"typeof(HeadOutlet)\\\" render-mode=\\\"ServerPrerendered\\\" />\\n</head>\\n<body>\\n    @RenderBody()\\n\\n    <div\", \" id=\\\"blazor-error-ui\\\">\\n        <environment include=\\\"Staging,Production\\\">\\n            An error has o\", \"ccurred. This application may no longer respond until reloaded.\\n        </environment>\\n        <envi\", \"ronment include=\\\"Development\\\">\\n            An unhandled exception has occurred. See browser dev tool\", \"s for details.\\n        </environment>\\n        <a href=\\\"\\\" class=\\\"reload\\\">Reload</a>\\n        <a class=\", \"\\\"dismiss\\\">\\ud83d\\uddd9</a>\\n    </div>\\n\\n    <script src=\\\"_framework/blazor.server.js\\\"></script>\\n</body>\\n</html>\\n\", \"\\nThe script reference to *_framework/blazor.server.js* establishes the real-time connection with the\", \"\\nserver and then deals with all user interactions and UI updates.\\n\\n17\\n\\nCHAPTER 4 | Project structure\", \" for Blazor apps\\n\\n\\fIn the Blazor WebAssembly app, the host page is a simple static HTML file under w\", \"wwroot/index.html.\\nThe <div> element with id named app is used to indicate where the root component \", \"should be\\nrendered.\\n\\n<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n\\n<head>\\n    <meta charset=\\\"utf-8\\\" />\\n    <meta\", \" name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maximum-\\nscale=1.0, user-scalable=n\", \"o\\\" />\\n    <title>BlazorApp1</title>\\n    <base href=\\\"/\\\" />\\n    <link href=\\\"css/bootstrap/bootstrap.mi\", \"n.css\\\" rel=\\\"stylesheet\\\" />\\n    <link href=\\\"css/app.css\\\" rel=\\\"stylesheet\\\" />\\n    <link href=\\\"BlazorAp\", \"p1.styles.css\\\" rel=\\\"stylesheet\\\" />\\n</head>\\n\\n<body>\\n    <div id=\\\"app\\\">Loading...</div>\\n\\n    <div id=\\\"\", \"blazor-error-ui\\\">\\n        An unhandled error has occurred.\\n        <a href=\\\"\\\" class=\\\"reload\\\">Reload<\", \"/a>\\n        <a class=\\\"dismiss\\\">\\ud83d\\uddd9</a>\\n    </div>\\n    <script src=\\\"_framework/blazor.webassembly.js\\\"><\", \"/script>\\n</body>\\n\\n</html>\\n\\nThe root component to render is specified in the app\\u2019s Program.cs file wi\", \"th the flexibility to register\\nservices through dependency injection. For more information, see ASP.\", \"NET Core Blazor dependency\\ninjection.\\n\\nvar builder = WebAssemblyHostBuilder.CreateDefault(args);\\nbui\", \"lder.RootComponents.Add<App>(\\\"#app\\\");\\nbuilder.RootComponents.Add<HeadOutlet>(\\\"head::after\\\");\\n\\nBuild \", \"output\\n\\nWhen a Blazor project is built, all Razor component and code files are compiled into a singl\", \"e\\nassembly. Unlike ASP.NET Web Forms projects, Blazor doesn\\u2019t support runtime compilation of the UI\\n\", \"logic.\\n\\nRun the app with Hot Reload\\n\\nTo run the Blazor Server app, press F5 in Visual Studio to run \", \"with the debugger attached, or Ctrl + F5\\nto run without the debugger attached.\\n\\nTo run the Blazor We\", \"bAssembly app, choose one of the following approaches:\\n\\n\\u2022\\n\\nRun the client project directly using the\", \" development server.\\n\\n18\\n\\nCHAPTER 4 | Project structure for Blazor apps\\n\\n\\f\\u2022\\n\\nRun the server project \", \"when hosting the app with ASP.NET Core.\\n\\nBlazor WebAssembly apps can be debugged in both browser and\", \" Visual Studio. See Debug ASP.NET\\nCore Blazor WebAssembly for details.\\n\\nBoth Blazor Server and Blazo\", \"r WebAssembly apps support Hot Reload in Visual Studio. Hot Reload is\\na feature that automatically u\", \"pdates changes made to a Blazor app live, in the browser. You can\\ntoggle whether Hot Reload is enabl\", \"ed from its icon in the toolbar:\\n\\nSelecting the caret beside the icon reveals additional options. Yo\", \"u can toggle Hot Reload on or off,\\nrestart the application, and toggle whether Hot Reload should occ\", \"ur whenever a file is saved.\\n\\nYou can also access additional configuration options. The configuratio\", \"n dialog lets you specify\\nwhether Hot Reload should be enabled when debugging (along with Edit and C\", \"ontinue), when\\nstarting without debugging, or when a file is saved.\\n\\n19\\n\\nCHAPTER 4 | Project structu\", \"re for Blazor apps\\n\\n\\fThe \\u201cdeveloper inner loop\\u201d has been greatly streamlined with Hot Reload. Withou\", \"t Hot Reload, a\\nBlazor developer would typically need to restart and rerun the app after every chang\", \"e, navigating to\\nthe appropriate part of the app as required. With Hot Reload, changes can be made t\", \"o the running\\napp without the need to restart in most cases. Hot Reload even retains the state of pa\", \"ges, so there\\u2019s\\nno need to have to re-enter form values or otherwise get the app back where you need\", \" it.\\n\\n20\\n\\nCHAPTER 4 | Project structure for Blazor apps\\n\\n\\fCHAPTER  5\\n\\nApp startup\\n\\nApplications that\", \" are written for ASP.NET typically have a global.asax.cs file that defines the\\nApplication_Start eve\", \"nt that controls which services are configured and made available for both HTML\\nrendering and .NET p\", \"rocessing. This chapter looks at how things are slightly different with ASP.NET\\nCore and Blazor Serv\", \"er.\\n\\nApplication_Start and Web Forms\\n\\nThe default web forms Application_Start method has grown in pu\", \"rpose over years to handle many\\nconfiguration tasks. A fresh web forms project with the default temp\", \"late in Visual Studio 2022 now\\ncontains the following configuration logic:\\n\\n\\u2022\\n\\n\\u2022\\n\\nRouteConfig - Appl\", \"ication URL routing\\n\\nBundleConfig - CSS and JavaScript bundling and minification\\n\\nEach of these indi\", \"vidual files resides in the App_Start folder and run only once at the start of our\\napplication. Rout\", \"eConfig in the default project template adds the FriendlyUrlSettings for web forms to\\nallow applicat\", \"ion URLs to omit the .ASPX file extension. The default template also contains a directive\\nthat provi\", \"des permanent HTTP redirect status codes (HTTP 301) for the .ASPX pages to the friendly\\nURL with the\", \" file name that omits the extension.\\n\\nWith ASP.NET Core and Blazor, these methods are either simplif\", \"ied and consolidated into the Startup\\nclass or they are eliminated in favor of common web technologi\", \"es.\\n\\nBlazor Server Startup Structure\\n\\nBlazor Server applications reside on top of an ASP.NET Core 3.\", \"0 or later version. ASP.NET Core web\\napplications are configured in Program.cs, or through a pair of\", \" methods in the Startup.cs class. A\\nsample Program.cs file is shown below:\\n\\nusing BlazorApp1.Data;\\nu\", \"sing Microsoft.AspNetCore.Components;\\nusing Microsoft.AspNetCore.Components.Web;\\n\\nvar builder = WebA\", \"pplication.CreateBuilder(args);\\n\\n// Add services to the container.\\nbuilder.Services.AddRazorPages();\", \"\\nbuilder.Services.AddServerSideBlazor();\\nbuilder.Services.AddSingleton<WeatherForecastService>();\\n\\n2\", \"1\\n\\nCHAPTER 5 | App startup\\n\\n\\fvar app = builder.Build();\\n\\n// Configure the HTTP request pipeline.\\nif \", \"(!app.Environment.IsDevelopment())\\n{\\n    app.UseExceptionHandler(\\\"/Error\\\");\\n    // The default HSTS \", \"value is 30 days. You may want to change this for production\\nscenarios, see https://aka.ms/aspnetcor\", \"e-hsts.\\n    app.UseHsts();\\n}\\n\\napp.UseHttpsRedirection();\\napp.UseStaticFiles();\\napp.UseRouting();\\napp\", \".MapBlazorHub();\\napp.MapFallbackToPage(\\\"/_Host\\\");\\n\\napp.Run();\\n\\nThe app\\u2019s required services are added\", \" to the WebApplicationBuilder instance\\u2019s Services collection.\\nThis is how the various ASP.NET Core f\", \"ramework services are configured with the framework\\u2019s built-in\\ndependency injection container. The v\", \"arious builder.Services.Add* methods add services that enable\\nfeatures such as authentication, razor\", \" pages, MVC controller routing, SignalR, and Blazor Server\\ninteractions among many others. This meth\", \"od was not needed in web forms, as the parsing and\\nhandling of the ASPX, ASCX, ASHX, and ASMX files \", \"were defined by referencing ASP.NET in the\\nweb.config configuration file. More information about dep\", \"endency injection in ASP.NET Core is\\navailable in the online documentation.\\n\\nAfter the app has been \", \"built by the builder, the rest of the calls on app configure its HTTP pipeline.\\nWith these calls, we\", \" declare from top to bottom the Middleware that will handle every request sent to\\nour application. M\", \"ost of these features in the default configuration were scattered across the web\\nforms configuration\", \" files and are now in one place for ease of reference.\\n\\nNo longer is the configuration of the custom\", \" error page placed in a web.config file, but now is\\nconfigured to always be shown if the application\", \" environment is not labeled Development.\\nAdditionally, ASP.NET Core applications are now configured \", \"to serve secure pages with TLS by default\\nwith the UseHttpsRedirection method call.\\n\\nNext, an unexpe\", \"cted configuration method call is made to UseStaticFiles. In ASP.NET Core, support for\\nrequests for \", \"static files (like JavaScript, CSS, and image files) must be explicitly enabled, and only files\\nin t\", \"he app\\u2019s wwwroot folder are publicly addressable by default.\\n\\nThe next line is the first that replic\", \"ates one of the configuration options from web forms: UseRouting.\\nThis method adds the ASP.NET Core \", \"router to the pipeline and it can be either configured here or in\\nthe individual files that it can c\", \"onsider routing to. More information about routing configuration can\\nbe found in the Routing section\", \".\\n\\nThe final app.Map* calls in this section define the endpoints that ASP.NET Core is listening on. \", \"These\\nroutes are the web accessible locations that you can access on the web server and receive some\", \"\\ncontent handled by .NET and returned to you. The first entry, MapBlazorHub configures a SignalR hub\", \"\\nfor use in providing the real-time and persistent connection to the server where the state and\\nrend\", \"ering of Blazor components is handled. The MapFallbackToPage method call indicates the web-\\naccessib\", \"le location of the page that starts the Blazor application and also configures the application to\\n\\n2\", \"2\\n\\nCHAPTER 5 | App startup\\n\\n\\fhandle deep-linking requests from the client-side. You will see this fe\", \"ature at work if you open a\\nbrowser and navigate directly to Blazor handled route in your applicatio\", \"n, such as /counter in the\\ndefault project template. The request gets handled by the *_Host.cshtml* \", \"fallback page, which then\\nruns the Blazor router and renders the counter page.\\n\\nThe very last line s\", \"tarts the application, something that wasn\\u2019t required in web forms (since it relied on\\nIIS to be run\", \"ning).\\n\\nUpgrading the BundleConfig Process\\n\\nTechnologies for bundling assets like CSS stylesheets an\", \"d JavaScript files have changed significantly,\\nwith other technologies providing quickly evolving to\", \"ols and techniques for managing these\\nresources. To this end, we recommend using a Node command-line\", \" tool such as Grunt / Gulp /\\nWebPack to package your static assets.\\n\\nThe Grunt, Gulp, and WebPack co\", \"mmand-line tools and their associated configurations can be added\\nto your application and ASP.NET Co\", \"re will quietly ignore those files during the application build\\nprocess. You can add a call to run t\", \"heir tasks by adding a Target inside your project file with syntax\\nsimilar to the following that wou\", \"ld trigger a gulp script and the min target inside that script:\\n\\n<Target Name=\\\"MyPreCompileTarget\\\" B\", \"eforeTargets=\\\"Build\\\">\\n  <Exec Command=\\\"gulp min\\\" />\\n</Target>\\n\\nMore details about both strategies to\", \" manage your CSS and JavaScript files are available in the Bundle\\nand minify static assets in ASP.NE\", \"T Core documentation.\\n\\n23\\n\\nCHAPTER 5 | App startup\\n\\n\\fCHAPTER  6\\n\\nBuild reusable UI\\ncomponents with B\", \"lazor\\n\\nOne of the beautiful things about ASP.NET Web Forms is how it enables encapsulation of reusab\", \"le\\npieces of user interface (UI) code into reusable UI controls. Custom user controls can be defined\", \" in\\nmarkup using .ascx files. You can also build elaborate server controls in code with full designe\", \"r\\nsupport.\\n\\nBlazor also supports UI encapsulation through components. A component:\\n\\n\\u2022\\n\\nIs a self-con\", \"tained chunk of UI.\\n\\n\\u2022  Maintains its own state and rendering logic.\\n\\n\\u2022\\n\\n\\u2022\\n\\nCan define UI event hand\", \"lers, bind to input data, and manage its own lifecycle.\\n\\nIs typically defined in a .razor file using\", \" Razor syntax.\\n\\nAn introduction to Razor\\n\\nRazor is a light-weight markup templating language based o\", \"n HTML and C#. With Razor, you can\\nseamlessly transition between markup and C# code to define your c\", \"omponent rendering logic. When\\nthe .razor file is compiled, the rendering logic is captured in a str\", \"uctured way in a .NET class. The name\\nof the compiled class is taken from the .razor file name. The \", \"namespace is taken from the default\\nnamespace for the project and the folder path, or you can explic\", \"itly specify the namespace using the\\n@namespace directive (more on Razor directives below).\\n\\nA compo\", \"nent\\u2019s rendering logic is authored using normal HTML markup with dynamic logic added\\nusing C#. The @\", \" character is used to transition to C#. Razor is typically smart about figuring out when\\nyou\\u2019ve swit\", \"ched back to HTML. For example, the following component renders a <p> tag with the\\ncurrent time:\\n\\n<p\", \">@DateTime.Now</p>\\n\\nTo explicitly specify the beginning and ending of a C# expression, use parenthes\", \"es:\\n\\n<p>@(DateTime.Now)</p>\\n\\nRazor also makes it easy to use C# control flow in your rendering logic\", \". For example, you can\\nconditionally render some HTML like this:\\n\\n24\\n\\nCHAPTER 6 | Build reusable UI \", \"components with Blazor\\n\\n\\f@if (value % 2 == 0)\\n{\\n    <p>The value was even.</p>\\n}\\n\\nOr you can generat\", \"e a list of items using a normal C# foreach loop like this:\\n\\n<ul>\\n@foreach (var item in items)\\n{\\n   \", \" <li>@item.Text</li>\\n}\\n</ul>\\n\\nRazor directives, like directives in ASP.NET Web Forms, control many a\", \"spects of how a Razor\\ncomponent is compiled. Examples include the component\\u2019s:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nNa\", \"mespace\\n\\nBase class\\n\\nImplemented interfaces\\n\\nGeneric parameters\\n\\nImported namespaces\\n\\nRoutes\\n\\nRazor \", \"directives start with the @ character and are typically used at the start of a new line at the start\", \"\\nof the file. For example, the @namespace directive defines the component\\u2019s namespace:\\n\\n@namespace M\", \"yComponentNamespace\\n\\nThe following table summarizes the various Razor directives used in Blazor and \", \"their ASP.NET Web\\nForms equivalents, if they exist.\\n\\nDirective\\n\\nDescription\\n\\nExample\\n\\nWeb Forms equi\", \"valent\\n\\n@attribute\\n\\n@code\\n\\n@implements\\n\\n@inherits\\n\\n@inject\\n\\nAdds a class-level\\nattribute to the\\ncomp\", \"onent\\n\\nAdds class\\nmembers to the\\ncomponent\\n\\nImplements the\\nspecified interface\\n\\nInherits from the\\nsp\", \"ecified base class\\n\\nInjects a service\\ninto the component\\n\\n@attribute\\n[Authorize]\\n\\nNone\\n\\n@code { ... \", \"}  <script runat=\\\"server\\\">...</script>\\n\\nUse code-behind\\n\\n<%@ Control\\nInherits=\\\"MyUserControlBase\\\" %>\", \"\\n\\nNone\\n\\n@impleme\\nnts\\nIDisposable\\n\\n@inherits\\nMyCompon\\nentBase\\n\\n@inject\\nIJSRuntime\\nJS\\n\\n25\\n\\nCHAPTER 6 |\", \" Build reusable UI components with Blazor\\n\\n\\fDirective\\n\\nDescription\\n\\nExample\\n\\nWeb Forms equivalent\\n\\n@\", \"layout\\n\\n@namespace\\n\\n@page\\n\\n@typeparam\\n\\n@using\\n\\nSpecifies a layout\\ncomponent for the\\ncomponent\\n\\nSets \", \"the namespace\\nfor the component\\n\\nSpecifies the route\\nfor the component\\n\\nSpecifies a generic\\ntype par\", \"ameter for\\nthe component\\n\\nSpecifies a\\nnamespace to bring\\ninto scope\\n\\n@layout\\nMainLayout\\n\\n<%@ Page\\nMa\", \"sterPageFile=\\\"~/Site.Master\\\" %>\\n\\nNone\\n\\n<%@ Page %>\\n\\nUse code-behind\\n\\nAdd namespace in web.config\\n\\n@n\", \"amespa\\nce\\nMyNamesp\\nace\\n\\n@page\\n\\\"/product/{i\\nd}\\\"\\n\\n@typepara\\nm TItem\\n\\n@using\\nMyCompon\\nentNamesp\\nace\\n\\nRa\", \"zor components also make extensive use of directive attributes on elements to control various\\naspect\", \"s of how components get compiled (event handling, data binding, component & element\\nreferences, and \", \"so on). Directive attributes all follow a common generic syntax where the values in\\nparenthesis are \", \"optional:\\n\\n@directive(-suffix(:name))(=\\\"value\\\")\\n\\nThe following table summarizes the various attribut\", \"es for Razor directives used in Blazor.\\n\\nAttribute\\n\\nDescription\\n\\nExample\\n\\n@attributes\\n\\nRenders a dic\", \"tionary of attributes\\n\\n@bind\\n\\nCreates a two-way data binding\\n\\n@on{event}\\n\\n@key\\n\\nAdds an event handle\", \"r for the\\nspecified event\\n\\nSpecifies a key to be used by the\\ndiffing algorithm for preserving\\nelemen\", \"ts in a collection\\n\\n<input\\n@attributes=\\\"ExtraA\\nttributes\\\" />\\n\\n<input\\n@bind=\\\"username\\\"\\n@bind:event=\\\"o\", \"ninp\\nut\\\" />\\n\\n<button\\n@onclick=\\\"Incremen\\ntCount\\\">Click\\nme!</button>\\n\\n<DetailsEditor\\n@key=\\\"person\\\"\\nDet\", \"ails=\\\"person.Det\\nails\\\" />\\n\\n26\\n\\nCHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\fAttribute\\n\\nDes\", \"cription\\n\\nExample\\n\\n@ref\\n\\nCaptures a reference to the\\ncomponent or HTML element\\n\\n<MyDialog\\n@ref=\\\"myDi\", \"alog\\\" />\\n\\nThe various directive attributes used by Blazor (@onclick, @bind, @ref, and so on) are cov\", \"ered in the\\nsections below and later chapters.\\n\\nMany of the syntaxes used in .aspx and .ascx files h\", \"ave parallel syntaxes in Razor. Below is a simple\\ncomparison of the syntaxes for ASP.NET Web Forms a\", \"nd Razor.\\n\\nFeature\\n\\nWeb Forms\\n\\nSyntax\\n\\nRazor\\n\\nSynt\\nax\\n\\nDirectives\\n\\n<%@ [directive] %>  <%@ Page %>\\n\\n\", \"@[directive]  @pa\\n\\nCode blocks\\n\\n<% %>\\n\\n<% int x = 123; %>  @{ }\\n\\nExpressions\\n(HTML-encoded)\\n\\n<%: %>\\n\", \"\\n<%:DateTime.Now\\n%>\\n\\nImplicit: @\\nExplicit: @()\\n\\nComments\\n\\n<%-- --%>\\n\\n<%-- Commented --\\n%>\\n\\n@* *@\\n\\nDa\", \"ta binding\\n\\n<%# %>\\n\\n<%# Bind(\\\"Name\\\")\\n%>\\n\\n@bind\\n\\nge\\n\\n@{\\nint x\\n=\\n123; }\\n\\n@Da\\nteTi\\nme.N\\now\\n@(Da\\nteTi\\nme\", \".N\\now)\\n\\n@*\\nCom\\nment\\ned\\n*@\\n\\n<inp\\nut\\n@bin\\nd=\\\"u\\nserna\\nme\\\"\\n/>\\n\\nTo add members to the Razor component cla\", \"ss, use the @code directive. This technique is similar to\\nusing a <script runat=\\\"server\\\">...</script\", \"> block in an ASP.NET Web Forms user control or page.\\n\\n@code {\\n    int count = 0;\\n\\n    void Incremen\", \"tCount()\\n    {\\n        count++;\\n\\n27\\n\\nCHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\f    }\\n}\\n\", \"\\nBecause Razor is based on C#, it must be compiled from within a C# project (.csproj). You can\\u2019t\\ncom\", \"pile .razor files from a Visual Basic project (.vbproj). You can still reference Visual Basic projec\", \"ts\\nfrom your Blazor project. The opposite is true too.\\n\\nFor a full Razor syntax reference, see Razor\", \" syntax reference for ASP.NET Core.\\n\\nUse components\\n\\nAside from normal HTML, components can also use\", \" other components as part of their rendering logic.\\nThe syntax for using a component in Razor is sim\", \"ilar to using a user control in an ASP.NET Web Forms\\napp. Components are specified using an element \", \"tag that matches the type name of the component.\\nFor example, you can add a Counter component like t\", \"his:\\n\\n<Counter />\\n\\nUnlike ASP.NET Web Forms, components in Blazor:\\n\\n\\u2022\\n\\n\\u2022\\n\\nDon\\u2019t use an element prefi\", \"x (for example, asp:).\\n\\nDon\\u2019t require registration on the page or in the web.config.\\n\\nThink of Razor\", \" components like you would .NET types, because that\\u2019s exactly what they are. If the\\nassembly contain\", \"ing the component is referenced, then the component is available for use. To bring\\nthe component\\u2019s n\", \"amespace into scope, apply the @using directive:\\n\\n@using MyComponentLib\\n\\n<Counter />\\n\\nAs seen in the\", \" default Blazor projects, it\\u2019s common to put @using directives into a *_Imports.razor* file\\nso that \", \"they\\u2019re imported into all .razor files in the same directory and in child directories.\\n\\nIf the names\", \"pace for a component isn\\u2019t in scope, you can specify a component using its full type\\nname, as you ca\", \"n in C#:\\n\\n<MyComponentLib.Counter />\\n\\nModify page title from components\\n\\nWhen building SPA-style app\", \"s, it\\u2019s common for parts of a page to reload without reloading the entire\\npage. Even so, it can be u\", \"seful to have the title of the page change based on which component is\\ncurrently loaded. This can be\", \" accomplished by including the <PageTitle> tag in the component\\u2019s\\nRazor page:\\n\\n@page \\\"/\\\"\\n<PageTitle>\", \"Home</PageTitle>\\n\\nThe contents of this element can be dynamic, for instance showing the current coun\", \"t of messages:\\n\\n28\\n\\nCHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\f<PageTitle>@MessageCount \", \"messages</PageTitle>\\n\\nNote that if several components on a particular page include <PageTitle> tags,\", \" only the last one will\\nbe displayed (since each one will overwrite the previous one).\\n\\nComponent pa\", \"rameters\\n\\nIn ASP.NET Web Forms, you can flow parameters and data to controls using public properties\", \". These\\nproperties can be set in markup using attributes or set directly in code. Razor components w\", \"ork in a\\nsimilar fashion, although the component properties must also be marked with the [Parameter]\", \"\\nattribute to be considered component parameters.\\n\\nThe following Counter component defines a compone\", \"nt parameter called IncrementAmount that can\\nbe used to specify the amount that the Counter should b\", \"e incremented each time the button is\\nclicked.\\n\\n<h1>Counter</h1>\\n\\n<p>Current count: @currentCount</p\", \">\\n\\n<button class=\\\"btn btn-primary\\\" @onclick=\\\"IncrementCount\\\">Click me</button>\\n\\n@code {\\n    int curr\", \"entCount = 0;\\n\\n    [Parameter]\\n    public int IncrementAmount { get; set; } = 1;\\n\\n    void Increment\", \"Count()\\n    {\\n        currentCount+=IncrementAmount;\\n    }\\n}\\n\\nTo specify a component parameter in Bl\", \"azor, use an attribute as you would in ASP.NET Web Forms:\\n\\n<Counter IncrementAmount=\\\"10\\\" />\\n\\nQuery s\", \"tring parameters\\n\\nRazor components can also leverage values from the query string of the page they\\u2019r\", \"e rendered on as\\na parameter source. To enable this, add the [SupplyParameterFromQuery] attribute to\", \" the parameter.\\nFor example, the following parameter definition would get its value from the request\", \" in the form\\n?IncBy=2:\\n\\n[Parameter]\\n[SupplyParameterFromQuery(Name = \\\"IncBy\\\")]\\npublic int IncrementA\", \"mount { get; set; } = 1;\\n\\nIf you don\\u2019t supply a custom Name in the [SupplyParameterFromQuery] attrib\", \"ute, by default it will\\nmatch the property name (IncrementAmount in this case).\\n\\n29\\n\\nCHAPTER 6 | Bui\", \"ld reusable UI components with Blazor\\n\\n\\fComponents and error boundaries\\n\\nBy default, Blazor apps wil\", \"l detect unhandled exceptions and show an error message at the bottom of\\nthe page with no additional\", \" detail. To constrain the parts of the app that are impacted by an\\nunhandled error, for instance to \", \"limit the impact to a single component, the <ErrorBoundary> tag can\\nbe wrapped around component decl\", \"arations.\\n\\nFor example, to protect against possible exceptions thrown from the Counter component, de\", \"clare it\\nwithin an <ErrorBoundary> and optionally specify a message to display if there is an except\", \"ion:\\n\\n<ErrorBoundary>\\n    <ChildContent>\\n        <Counter />\\n    </ChildContent>\\n    <ErrorContent>\\n\", \"        Oops! The counter isn't working right now; please try again later.\\n    </ErrorContent>\\n</Err\", \"orBoundary>\\nIf you don\\u2019t need to specify custom error content, you can just wrap the component\\ndirec\", \"tly:\\n<ErrorBoundary>\\n  <Counter />\\n</ErrorBoundary>\\n\\nA default message stating \\u201cAn error as occurred\", \".\\u201d will be displayed if an unhandled exception occurs\\nin the wrapped component.\\n\\nEvent handlers\\n\\nBot\", \"h ASP.NET Web Forms and Blazor provide an event-based programming model for handling UI\\nevents. Exam\", \"ples of such events include button clicks and text input. In ASP.NET Web Forms, you use\\nHTML server \", \"controls to handle UI events exposed by the DOM, or you can handle events exposed by\\nweb server cont\", \"rols. The events are surfaced on the server through form post-back requests. Consider\\nthe following \", \"Web Forms button click example:\\n\\nCounter.ascx\\n\\n<asp:Button ID=\\\"ClickMeButton\\\" runat=\\\"server\\\" Text=\\\"C\", \"lick me!\\\"\\nOnClick=\\\"ClickMeButton_Click\\\" />\\nCounter.ascx.cs\\npublic partial class Counter : System.Web\", \".UI.UserControl\\n{\\n    protected void ClickMeButton_Click(object sender, EventArgs e)\\n    {\\n        C\", \"onsole.WriteLine(\\\"The button was clicked!\\\");\\n    }\\n}\\n\\nIn Blazor, you can register handlers for DOM U\", \"I events directly using directive attributes of the form\\n@on{event}. The {event} placeholder represe\", \"nts the name of the event. For example, you can listen for\\nbutton clicks like this:\\n\\n30\\n\\nCHAPTER 6 |\", \" Build reusable UI components with Blazor\\n\\n\\f<button @onclick=\\\"OnClick\\\">Click me!</button>\\n\\n@code {\\n \", \"   void OnClick()\\n    {\\n        Console.WriteLine(\\\"The button was clicked!\\\");\\n    }\\n}\\n\\nEvent handler\", \"s can accept an optional, event-specific argument to provide more information about\\nthe event. For e\", \"xample, mouse events can take a MouseEventArgs argument, but it isn\\u2019t required.\\n\\n<button @onclick=\\\"O\", \"nClick\\\">Click me!</button>\\n\\n@code {\\n    void OnClick(MouseEventArgs e)\\n    {\\n        Console.WriteLi\", \"ne($\\\"Mouse clicked at {e.ScreenX}, {e.ScreenY}.\\\");\\n    }\\n}\\n\\nInstead of referring to a method group f\", \"or an event handler, you can use a lambda expression. A\\nlambda expression allows you to close over o\", \"ther in-scope values.\\n\\n@foreach (var buttonLabel in buttonLabels)\\n{\\n    <button @onclick=\\\"() => Cons\", \"ole.WriteLine($\\\"The {buttonLabel} button was\\nclicked!\\\")\\\">@buttonLabel</button>\\n}\\n\\nEvent handlers can\", \" execute synchronously or asynchronously. For example, the following OnClick\\nevent handler executes \", \"asynchronously:\\n\\n<button @onclick=\\\"OnClick\\\">Click me!</button>\\n\\n@code {\\n    async Task OnClick()\\n   \", \" {\\n        var result = await Http.GetAsync(\\\"api/values\\\");\\n    }\\n}\\n\\nAfter an event is handled, the c\", \"omponent is rendered to account for any component state changes.\\nWith asynchronous event handlers, t\", \"he component is rendered immediately after the handler\\nexecution completes. The component is rendere\", \"d again after the asynchronous Task completes. This\\nasynchronous execution mode provides an opportun\", \"ity to render some appropriate UI while the\\nasynchronous Task is still in progress.\\n\\n<button @onclic\", \"k=\\\"ShowMessage\\\">Get message</button>\\n\\n@if (showMessage)\\n{\\n    @if (message == null)\\n    {\\n        <p\", \"><em>Loading...</em></p>\\n    }\\n    else\\n\\n31\\n\\nCHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\f\", \"    {\\n        <p>The message is: @message</p>\\n    }\\n}\\n\\n@code\\n{\\n    bool showMessage = false;\\n    str\", \"ing message;\\n\\n    public async Task ShowMessage()\\n    {\\n        showMessage = true;\\n        message \", \"= await MessageService.GetMessageAsync();\\n    }\\n}\\n\\nComponents can also define their own events by de\", \"fining a component parameter of type\\nEventCallback<TValue>. Event callbacks support all the variatio\", \"ns of DOM UI event handlers: optional\\narguments, synchronous or asynchronous, method groups, or lamb\", \"da expressions.\\n\\n<button class=\\\"btn btn-primary\\\" @onclick=\\\"OnClick\\\">Click me!</button>\\n\\n@code {\\n    \", \"[Parameter]\\n    public EventCallback<MouseEventArgs> OnClick { get; set; }\\n}\\n\\nData binding\\n\\nBlazor p\", \"rovides a simple mechanism to bind data from a UI component to the component\\u2019s state. This\\napproach \", \"differs from the features in ASP.NET Web Forms for binding data from data sources to UI\\ncontrols. We\", \"\\u2019ll cover handling data from different data sources in the Dealing with data section.\\n\\nTo create a t\", \"wo-way data binding from a UI component to the component\\u2019s state, use the @bind\\ndirective attribute.\", \" In the following example, the value of the check box is bound to the isChecked\\nfield.\\n\\n<input type=\", \"\\\"checkbox\\\" @bind=\\\"isChecked\\\" />\\n\\n@code {\\n    bool isChecked;\\n}\\n\\nWhen the component is rendered, the \", \"value of the checkbox is set to the value of the isChecked field.\\nWhen the user toggles the checkbox\", \", the onchange event is fired and the isChecked field is set to the\\nnew value. The @bind syntax in t\", \"his case is equivalent to the following markup:\\n\\n<input value=\\\"@isChecked\\\" @onchange=\\\"(UIChangeEvent\", \"Args e) => isChecked = e.Value\\\" />\\n\\nTo change the event used for the bind, use the @bind:event attri\", \"bute.\\n\\n<input @bind=\\\"text\\\" @bind:event=\\\"oninput\\\" />\\n<p>@text</p>\\n\\n32\\n\\nCHAPTER 6 | Build reusable UI \", \"components with Blazor\\n\\n\\f@code {\\n    string text;\\n}\\n\\nComponents can also support data binding to the\", \"ir parameters. To data bind, define an event callback\\nparameter with the same name as the bindable p\", \"arameter. The \\u201cChanged\\u201d suffix is added to the\\nname.\\n\\nPasswordBox.razor\\n\\nPassword: <input\\n    value=\", \"\\\"@Password\\\"\\n    @oninput=\\\"OnPasswordChanged\\\"\\n    type=\\\"@(showPassword ? \\\"text\\\" : \\\"password\\\")\\\" />\\n\\n<l\", \"abel><input type=\\\"checkbox\\\" @bind=\\\"showPassword\\\" />Show password</label>\\n\\n@code {\\n    private bool s\", \"howPassword;\\n\\n    [Parameter]\\n    public string Password { get; set; }\\n\\n    [Parameter]\\n    public E\", \"ventCallback<string> PasswordChanged { get; set; }\\n\\n    private Task OnPasswordChanged(ChangeEventAr\", \"gs e)\\n    {\\n        Password = e.Value.ToString();\\n        return PasswordChanged.InvokeAsync(Passwo\", \"rd);\\n    }\\n}\\n\\nTo chain a data binding to an underlying UI element, set the value and handle the even\", \"t directly on\\nthe UI element instead of using the @bind attribute.\\n\\nTo bind to a component parameter\", \", use a @bind-{Parameter} attribute to specify the parameter to\\nwhich you want to bind.\\n\\n<PasswordBo\", \"x @bind-Password=\\\"password\\\" />\\n\\n@code {\\n    string password;\\n}\\n\\nState changes\\n\\nIf the component\\u2019s st\", \"ate has changed outside of a normal UI event or event callback, then the\\ncomponent must manually sig\", \"nal that it needs to be rendered again. To signal that a component\\u2019s\\nstate has changed, call the Sta\", \"teHasChanged method on the component.\\n\\nIn the example below, a component displays a message from an \", \"AppState service that can be updated\\nby other parts of the app. The component registers its StateHas\", \"Changed method with the\\nAppState.OnChange event so that the component is rendered whenever the messa\", \"ge gets updated.\\n\\n33\\n\\nCHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\fpublic class AppState\\n{\", \"\\n    public string Message { get; }\\n\\n    // Lets components receive change notifications\\n    public \", \"event Action OnChange;\\n\\n    public void UpdateMessage(string message)\\n    {\\n        Message = messag\", \"e;\\n        NotifyStateChanged();\\n    }\\n\\n    private void NotifyStateChanged() => OnChange?.Invoke();\", \"\\n}\\n\\n@inject AppState AppState\\n\\n<p>App message: @AppState.Message</p>\\n\\n@code {\\n    protected override\", \" void OnInitialized()\\n    {\\n        AppState.OnChange += StateHasChanged\\n    }\\n}\\n\\nComponent lifecycl\", \"e\\n\\nThe ASP.NET Web Forms framework has well-defined lifecycle methods for modules, pages, and\\ncontro\", \"ls. For example, the following control implements event handlers for the Init, Load, and UnLoad\\nlife\", \"cycle events:\\n\\nCounter.ascx.cs\\n\\npublic partial class Counter : System.Web.UI.UserControl\\n{\\n    prote\", \"cted void Page_Init(object sender, EventArgs e) { ... }\\n    protected void Page_Load(object sender, \", \"EventArgs e) { ... }\\n    protected void Page_UnLoad(object sender, EventArgs e) { ... }\\n}\\n\\nRazor com\", \"ponents also have a well-defined lifecycle. A component\\u2019s lifecycle can be used to initialize\\ncompon\", \"ent state and implement advanced component behaviors.\\n\\nAll of Blazor\\u2019s component lifecycle methods h\", \"ave both synchronous and asynchronous versions.\\nComponent rendering is synchronous. You can\\u2019t run as\", \"ynchronous logic as part of the component\\nrendering. All asynchronous logic must execute as part of \", \"an async lifecycle method.\\n\\nOnInitialized\\n\\nThe OnInitialized and OnInitializedAsync methods are used\", \" to initialize the component. A component\\nis typically initialized after it\\u2019s first rendered. After \", \"a component is initialized, it may be rendered\\n\\n34\\n\\nCHAPTER 6 | Build reusable UI components with Bl\", \"azor\\n\\n\\fmultiple times before it\\u2019s eventually disposed. The OnInitialized method is similar to the Pa\", \"ge_Load\\nevent in ASP.NET Web Forms pages and controls.\\n\\nprotected override void OnInitialized() { ..\", \". }\\nprotected override async Task OnInitializedAsync() { await ... }\\n\\nOnParametersSet\\n\\nThe OnParamet\", \"ersSet and OnParametersSetAsync methods are called when a component has\\nreceived parameters from its\", \" parent and the value are assigned to properties. These methods are\\nexecuted after component initial\", \"ization and each time the component is rendered.\\n\\nprotected override void OnParametersSet() { ... }\\n\", \"protected override async Task OnParametersSetAsync() { await ... }\\n\\nOnAfterRender\\n\\nThe OnAfterRender\", \" and OnAfterRenderAsync methods are called after a component has finished\\nrendering. Element and com\", \"ponent references are populated at this point (more on these concepts\\nbelow). Interactivity with the\", \" browser is enabled at this point. Interactions with the DOM and\\nJavaScript execution can safely tak\", \"e place.\\n\\nprotected override void OnAfterRender(bool firstRender)\\n{\\n    if (firstRender)\\n    {\\n     \", \"   ...\\n    }\\n}\\nprotected override async Task OnAfterRenderAsync(bool firstRender)\\n{\\n    if (firstRen\", \"der)\\n    {\\n        await ...\\n    }\\n}\\n\\nOnAfterRender and OnAfterRenderAsync aren\\u2019t called when preren\", \"dering on the server.\\n\\nThe firstRender parameter is true the first time the component is rendered; o\", \"therwise, its value is false.\\n\\nIDisposable\\n\\nRazor components can implement IDisposable to dispose of\", \" resources when the component is\\nremoved from the UI. A Razor component can implement IDispose by us\", \"ing the @implements\\ndirective:\\n\\n@using System\\n@implements IDisposable\\n\\n...\\n\\n@code {\\n    public void \", \"Dispose()\\n\\n35\\n\\nCHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\f    {\\n        ...\\n    }\\n}\\n\\nCap\", \"ture component references\\n\\nIn ASP.NET Web Forms, it\\u2019s common to manipulate a control instance direct\", \"ly in code by referring to\\nits ID. In Blazor, it\\u2019s also possible to capture and manipulate a referen\", \"ce to a component, although it\\u2019s\\nmuch less common.\\n\\nTo capture a component reference in Blazor, use \", \"the @ref directive attribute. The value of the\\nattribute should match the name of a settable field w\", \"ith the same type as the referenced component.\\n\\n<MyLoginDialog @ref=\\\"loginDialog\\\" ... />\\n\\n@code {\\n  \", \"  MyLoginDialog loginDialog = default!;\\n\\n    void OnSomething()\\n    {\\n        loginDialog.Show();\\n  \", \"  }\\n}\\n\\nWhen the parent component is rendered, the field is populated with the child component instan\", \"ce.\\nYou can then call methods on, or otherwise manipulate, the component instance.\\n\\nManipulating com\", \"ponent state directly using component references isn\\u2019t recommended. Doing so\\nprevents the component \", \"from being rendered automatically at the correct times.\\n\\nCapture element references\\n\\nRazor component\", \"s can capture references to an element. Unlike HTML server controls in ASP.NET\\nWeb Forms, you can\\u2019t \", \"manipulate the DOM directly using an element reference in Blazor. Blazor\\nhandles most DOM interactio\", \"ns for you using its DOM diffing algorithm. Captured element references\\nin Blazor are opaque. Howeve\", \"r, they\\u2019re used to pass a specific element reference in a JavaScript\\ninterop call. For more informat\", \"ion about JavaScript interop, see ASP.NET Core Blazor JavaScript\\ninterop.\\n\\nTemplated components\\n\\nIn \", \"ASP.NET Web Forms, you can create templated controls. Templated controls enable the developer\\nto spe\", \"cify a portion of the HTML used to render a container control. The mechanics of building\\ntemplated s\", \"erver controls are complex, but they enable powerful scenarios for rendering data in a\\nuser customiz\", \"able way. Examples of templated controls include Repeater and DataList.\\n\\nRazor components can also b\", \"e templated by defining component parameters of type\\nRenderFragment or RenderFragment<T>. A RenderFr\", \"agment represents a chunk of Razor markup\\n\\n36\\n\\nCHAPTER 6 | Build reusable UI components with Blazor\\n\", \"\\n\\fthat can then be rendered by the component. A RenderFragment<T> is a chunk of Razor markup that\\nta\", \"kes a parameter that can be specified when the render fragment is rendered.\\n\\nChild content\\n\\nRazor co\", \"mponents can capture their child content as a RenderFragment and render that content as\\npart of the \", \"component rendering. To capture child content, define a component parameter of type\\nRenderFragment a\", \"nd name it ChildContent.\\n\\nChildContentComponent.razor\\n\\n<h1>Component with child content</h1>\\n\\n<div>@\", \"ChildContent</div>\\n\\n@code {\\n    [Parameter]\\n    public RenderFragment ChildContent { get; set; }\\n}\\nA\", \" parent component can then supply child content using normal Razor syntax.\\n<ChildContentComponent>\\n \", \"   <ChildContent>\\n        <p>The time is @DateTime.Now</p>\\n    </ChildContent>\\n</ChildContentCompone\", \"nt>\\n\\nTemplate parameters\\n\\nA templated Razor component can also define multiple component parameters \", \"of type\\nRenderFragment or RenderFragment<T>. The parameter for a RenderFragment<T> can be specified\\n\", \"when it\\u2019s invoked. To specify a generic type parameter for a component, use the @typeparam Razor\\ndir\", \"ective.\\n\\nSimpleListView.razor\\n\\n@typeparam TItem\\n\\n@Heading\\n\\n<ul>\\n@foreach (var item in Items)\\n{\\n    <\", \"li>@ItemTemplate(item)</li>\\n}\\n</ul>\\n\\n@code {\\n    [Parameter]\\n    public RenderFragment Heading { get\", \"; set; }\\n\\n    [Parameter]\\n    public RenderFragment<TItem> ItemTemplate { get; set; }\\n\\n    [Paramete\", \"r]\\n    public IEnumerable<TItem> Items { get; set; }\\n}\\n\\n37\\n\\nCHAPTER 6 | Build reusable UI components\", \" with Blazor\\n\\n\\fWhen using a templated component, the template parameters can be specified using chil\", \"d elements\\nthat match the names of the parameters. Component arguments of type RenderFragment<T> pas\", \"sed\\nas elements have an implicit parameter named context. You can change the name of this implement\\n\", \"parameter using the Context attribute on the child element. Any generic type parameters can be\\nspeci\", \"fied using an attribute that matches the name of the type parameter. The type parameter will be\\ninfe\", \"rred if possible:\\n\\n<SimpleListView Items=\\\"messages\\\" TItem=\\\"string\\\">\\n    <Heading>\\n        <h1>My lis\", \"t</h1>\\n    </Heading>\\n    <ItemTemplate Context=\\\"message\\\">\\n        <p>The message is: @message</p>\\n \", \"   </ItemTemplate>\\n</SimpleListView>\\nThe output of this component looks like this:\\n<h1>My list</h1>\\n\", \"<ul>\\n    <li><p>The message is: message1</p></li>\\n    <li><p>The message is: message2</p></li>\\n<ul>\\n\", \"\\nCode-behind\\n\\nA Razor component is typically authored in a single .razor file. However, it\\u2019s also po\", \"ssible to separate\\nthe code and markup using a code-behind file. To use a component file, add a C# f\", \"ile that matches\\nthe file name of the component file but with a .cs extension added (Counter.razor.c\", \"s). Use the C# file\\nto define a base class for the component. You can name the base class anything y\", \"ou\\u2019d like, but it\\u2019s\\ncommon to name the class the same as the component class, but with a Base extens\", \"ion added\\n(CounterBase). The component-based class must also derive from ComponentBase. Then, in the\", \" Razor\\ncomponent file, add the @inherits directive to specify the base class for the component (@inh\", \"erits\\nCounterBase).\\n\\nCounter.razor\\n\\n@inherits CounterBase\\n\\n<h1>Counter</h1>\\n\\n<p>Current count: @curr\", \"entCount</p>\\n\\n<button @onclick=\\\"IncrementCount\\\">Click me</button>\\nCounter.razor.cs\\npublic class Coun\", \"terBase : ComponentBase\\n{\\n    protected int currentCount = 0;\\n\\n    protected void IncrementCount()\\n \", \"   {\\n        currentCount++;\\n    }\\n}\\n\\n38\\n\\nCHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\fThe\", \" visibility of the component\\u2019s members in the base class must be protected or public to be visible\\nt\", \"o the component class.\\n\\nAdditional resources\\n\\nThe preceding isn\\u2019t an exhaustive treatment of all asp\", \"ects of Razor components. For more information\\non how to Create and use ASP.NET Core Razor component\", \"s, see the Blazor documentation.\\n\\n39\\n\\nCHAPTER 6 | Build reusable UI components with Blazor\\n\\n\\fCHAPTER\", \"  7\\n\\nPages, routing, and\\nlayouts\\n\\nASP.NET Web Forms apps are composed of pages defined in .aspx file\", \"s. Each page\\u2019s address is based\\non its physical file path in the project. When a browser makes a req\", \"uest to the page, the contents of\\nthe page are dynamically rendered on the server. The rendering acc\", \"ounts for both the page\\u2019s HTML\\nmarkup and its server controls.\\n\\nIn Blazor, each page in the app is a\", \" component, typically defined in a .razor file, with one or more\\nspecified routes. Routing mostly ha\", \"ppens client-side without involving a specific server request. The\\nbrowser first makes a request to \", \"the root address of the app. A root Router component in the Blazor\\napp then handles intercepting nav\", \"igation requests and forwards them to the correct component.\\n\\nBlazor also supports deep linking. Dee\", \"p linking occurs when the browser makes a request to a specific\\nroute other than the root of the app\", \". Requests for deep links sent to the server are routed to the\\nBlazor app, which then routes the req\", \"uest client-side to the correct component.\\n\\nA simple page in ASP.NET Web Forms might contain the fol\", \"lowing markup:\\n\\nName.aspx\\n\\n<%@ Page Title=\\\"Name\\\" Language=\\\"C#\\\" MasterPageFile=\\\"~/Site.Master\\\" AutoEv\", \"entWireup=\\\"true\\\"\\nCodeBehind=\\\"Name.aspx.cs\\\" Inherits=\\\"WebApplication1.Name\\\" %>\\n\\n<asp:Content ID=\\\"Body\", \"Content\\\" ContentPlaceHolderID=\\\"MainContent\\\" runat=\\\"server\\\">\\n    <div>\\n        What is your name?<br \", \"/>\\n        <asp:TextBox ID=\\\"TextBox1\\\" runat=\\\"server\\\"></asp:TextBox>\\n        <asp:Button ID=\\\"Button1\\\"\", \" runat=\\\"server\\\" Text=\\\"Submit\\\" OnClick=\\\"Button1_Click\\\" />\\n    </div>\\n    <div>\\n        <asp:Literal I\", \"D=\\\"Literal1\\\" runat=\\\"server\\\" />\\n    </div>\\n</asp:Content>\\n\\nName.aspx.cs\\n\\npublic partial class Name : \", \"System.Web.UI.Page\\n{\\n    protected void Button1_Click1(object sender, EventArgs e)\\n    {\\n        Lit\", \"eral1.Text = \\\"Hello \\\" + TextBox1.Text;\\n    }\\n}\\n\\n40\\n\\nCHAPTER 7 | Pages, routing, and layouts\\n\\n\\fThe eq\", \"uivalent page in a Blazor app would look like this:\\n\\nName.razor\\n\\n@page \\\"/Name\\\"\\n@layout MainLayout\\n\\n<\", \"div>\\n    What is your name?<br />\\n    <input @bind=\\\"text\\\" />\\n    <button @onclick=\\\"OnClick\\\">Submit</\", \"button>\\n</div>\\n<div>\\n    @if (name != null)\\n    {\\n        @:Hello @name\\n    }\\n</div>\\n\\n@code {\\n    st\", \"ring text;\\n    string name;\\n\\n    void OnClick() {\\n        name = text;\\n    }\\n}\\n\\nCreate pages\\n\\nTo cre\", \"ate a page in Blazor, create a component and add the @page Razor directive to specify the\\nroute for \", \"the component. The @page directive takes a single parameter, which is the route template\\nto add to t\", \"hat component.\\n\\n@page \\\"/counter\\\"\\n\\nThe route template parameter is required. Unlike ASP.NET Web Forms\", \", the route to a Blazor\\ncomponent isn\\u2019t inferred from its file location (although that may be a feat\", \"ure added in the future).\\n\\nThe route template syntax is the same basic syntax used for routing in AS\", \"P.NET Web Forms. Route\\nparameters are specified in the template using braces. Blazor will bind route\", \" values to component\\nparameters with the same name (case-insensitive).\\n\\n@page \\\"/product/{id}\\\"\\n\\n<h1>P\", \"roduct @Id</h1>\\n\\n@code {\\n    [Parameter]\\n    public string Id { get; set; }\\n}\\n\\nYou can also specify \", \"constraints on the value of the route parameter. For example, to constrain the\\nproduct ID to be an i\", \"nt:\\n\\n41\\n\\nCHAPTER 7 | Pages, routing, and layouts\\n\\n\\f@page \\\"/product/{id:int}\\\"\\n\\n<h1>Product @Id</h1>\\n\\n\", \"@code {\\n    [Parameter]\\n    public int Id { get; set; }\\n}\\n\\nFor a full list of the route constraints \", \"supported by Blazor, see Route constraints.\\n\\nRouter component\\n\\nRouting in Blazor is handled by the R\", \"outer component. The Router component is typically used in the\\napp\\u2019s root component (App.razor).\\n\\n<R\", \"outer AppAssembly=\\\"@typeof(Program).Assembly\\\">\\n    <Found Context=\\\"routeData\\\">\\n        <RouteView Ro\", \"uteData=\\\"@routeData\\\" DefaultLayout=\\\"@typeof(MainLayout)\\\" />\\n    </Found>\\n    <NotFound>\\n        <Lay\", \"outView Layout=\\\"@typeof(MainLayout)\\\">\\n            <p>Sorry, there's nothing at this address.</p>\\n   \", \"     </LayoutView>\\n    </NotFound>\\n</Router>\\n\\nThe Router component discovers the routable components\", \" in the specified AppAssembly and in the\\noptionally specified AdditionalAssemblies. When the browser\", \" navigates, the Router intercepts the\\nnavigation and renders the contents of its Found parameter wit\", \"h the extracted RouteData if a route\\nmatches the address, otherwise the Router renders its NotFound \", \"parameter.\\n\\nThe RouteView component handles rendering the matched component specified by the RouteDa\", \"ta\\nwith its layout if it has one. If the matched component doesn\\u2019t have a layout, then the optionall\", \"y\\nspecified DefaultLayout is used.\\n\\nThe LayoutView component renders its child content within the sp\", \"ecified layout. We\\u2019ll look at layouts\\nmore in detail later in this chapter.\\n\\nNavigation\\n\\nIn ASP.NET \", \"Web Forms, you trigger navigation to a different page by returning a redirect response to\\nthe browse\", \"r. For example:\\n\\nprotected void NavigateButton_Click(object sender, EventArgs e)\\n{\\n    Response.Redi\", \"rect(\\\"Counter\\\");\\n}\\n\\nReturning a redirect response isn\\u2019t typically possible in Blazor. Blazor doesn\\u2019t\", \" use a request-reply\\nmodel. You can, however, trigger browser navigations directly, as you can with \", \"JavaScript.\\n\\n42\\n\\nCHAPTER 7 | Pages, routing, and layouts\\n\\n\\fBlazor provides a NavigationManager servi\", \"ce that can be used to:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nGet the current browser address\\n\\nGet the base address\\n\\nTrigger \", \"navigations\\n\\nGet notified when the address changes\\n\\nTo navigate to a different address, use the Navi\", \"gateTo method:\\n\\n@page \\\"/\\\"\\n@inject NavigationManager NavigationManager\\n\\n<button @onclick=\\\"Navigate\\\">N\", \"avigate</button>\\n\\n@code {\\n    void Navigate() {\\n        NavigationManager.NavigateTo(\\\"counter\\\");\\n   \", \" }\\n}\\n\\nFor a description of all NavigationManager members, see URI and navigation state helpers.\\n\\nBas\", \"e URLs\\n\\nIf your Blazor app is deployed under a base path, then you need to specify the base URL in t\", \"he page\\nmetadata using the <base> tag for routing to work property. If the host page for the app is \", \"server-\\nrendered using Razor, then you can use the ~/ syntax to specify the app\\u2019s base address. If t\", \"he host\\npage is static HTML, then you need to specify the base URL explicitly.\\n\\n<base href=\\\"~/\\\" />\\n\\n\", \"Page layout\\n\\nPage layout in ASP.NET Web Forms is handled by Master Pages. Master Pages define a temp\", \"late with\\none or more content placeholders that can then be supplied by individual pages. Master Pag\", \"es are\\ndefined in .master files and start with the <%@ Master %> directive. The content of the .mast\", \"er files is\\ncoded as you would an .aspx page, but with the addition of <asp:ContentPlaceHolder> cont\", \"rols to\\nmark where pages can supply content.\\n\\nSite.master\\n\\n<%@ Master Language=\\\"C#\\\" AutoEventWireup=\", \"\\\"true\\\" CodeBehind=\\\"Site.master.cs\\\"\\nInherits=\\\"WebApplication1.SiteMaster\\\" %>\\n\\n<!DOCTYPE html>\\n<html l\", \"ang=\\\"en\\\">\\n<head runat=\\\"server\\\">\\n    <meta charset=\\\"utf-8\\\" />\\n    <meta name=\\\"viewport\\\" content=\\\"widt\", \"h=device-width, initial-scale=1.0\\\" />\\n    <title><%: Page.Title %> - My ASP.NET Application</title>\\n\", \"    <link href=\\\"~/favicon.ico\\\" rel=\\\"shortcut icon\\\" type=\\\"image/x-icon\\\" />\\n</head>\\n\\n43\\n\\nCHAPTER 7 | P\", \"ages, routing, and layouts\\n\\n\\f<body>\\n    <form runat=\\\"server\\\">\\n        <div class=\\\"container body-con\", \"tent\\\">\\n            <asp:ContentPlaceHolder ID=\\\"MainContent\\\" runat=\\\"server\\\">\\n            </asp:Conten\", \"tPlaceHolder>\\n            <hr />\\n            <footer>\\n                <p>&copy; <%: DateTime.Now.Yea\", \"r %> - My ASP.NET Application</p>\\n            </footer>\\n        </div>\\n    </form>\\n</body>\\n</html>\\n\\n\", \"In Blazor, you handle page layout using layout components. Layout components inherit from\\nLayoutComp\", \"onentBase, which defines a single Body property of type RenderFragment, which can be\\nused to render \", \"the contents of the page.\\n\\nMainLayout.razor\\n\\n@inherits LayoutComponentBase\\n<h1>Main layout</h1>\\n<div\", \">\\n    @Body\\n</div>\\n\\nWhen the page with a layout is rendered, the page is rendered within the content\", \"s of the specified\\nlayout at the location where the layout renders its Body property.\\n\\nTo apply a la\", \"yout to a page, use the @layout directive:\\n\\n@layout MainLayout\\n\\nYou can specify the layout for all c\", \"omponents in a folder and subfolders using an *_Imports.razor* file.\\nYou can also specify a default \", \"layout for all your pages using the Router component.\\n\\nMaster Pages can define multiple content plac\", \"eholders, but layouts in Blazor only have a single Body\\nproperty. This limitation of Blazor layout c\", \"omponents will hopefully be addressed in a future release.\\n\\nMaster Pages in ASP.NET Web Forms can be\", \" nested. That is, a Master Page may also use a Master\\nPage. Layout components in Blazor may be neste\", \"d too. You can apply a layout component to a layout\\ncomponent. The contents of the inner layout will\", \" be rendered within the outer layout.\\n\\nChildLayout.razor\\n\\n@layout MainLayout\\n<h2>Child layout</h2>\\n<\", \"div>\\n    @Body\\n</div>\\n\\nIndex.razor\\n\\n@page \\\"/\\\"\\n@layout ChildLayout\\n<p>I'm in a nested layout!</p>\\n\\nTh\", \"e rendered output for the page would then be:\\n\\n44\\n\\nCHAPTER 7 | Pages, routing, and layouts\\n\\n\\f<h1>Mai\", \"n layout</h1>\\n<div>\\n    <h2>Child layout</h2>\\n    <div>\\n        <p>I'm in a nested layout!</p>\\n    <\", \"/div>\\n</div>\\n\\nLayouts in Blazor don\\u2019t typically define the root HTML elements for a page (<html>, <b\", \"ody>, <head>,\\nand so on). The root HTML elements are instead defined in a Blazor app\\u2019s host page, wh\", \"ich is used to\\nrender the initial HTML content for the app (see Bootstrap Blazor). The host page can\", \" render multiple\\nroot components for the app with surrounding markup.\\n\\nComponents in Blazor, includi\", \"ng pages, can\\u2019t render <script> tags. This rendering restriction exists\\nbecause <script> tags get lo\", \"aded once and then can\\u2019t be changed. Unexpected behavior may occur if\\nyou try to render the tags dyn\", \"amically using Razor syntax. Instead, all <script> tags should be added\\nto the app\\u2019s host page.\\n\\n45\\n\", \"\\nCHAPTER 7 | Pages, routing, and layouts\\n\\n\\fCHAPTER  8\\n\\nState management\\n\\nState management is a key c\", \"oncept of Web Forms applications, facilitated through ViewState, Session\\nState, Application State, a\", \"nd Postback features. These stateful features of the framework helped to\\nhide the state management r\", \"equired for an application and allow application developers to focus on\\ndelivering their functionali\", \"ty. With ASP.NET Core and Blazor, some of these features have been\\nrelocated and some have been remo\", \"ved altogether. This chapter reviews how to maintain state and\\ndeliver the same functionality with t\", \"he new features in Blazor.\\n\\nRequest state management with ViewState\\n\\nWhen discussing state managemen\", \"t in Web Forms application, many developers will immediately\\nthink of ViewState. In Web Forms, ViewS\", \"tate manages the state of the content between HTTP requests\\nby sending a large encoded block of text\", \" back and forth to the browser. The ViewState field could be\\noverwhelmed with content from a page co\", \"ntaining many elements, potentially expanding to several\\nmegabytes in size.\\n\\nWith Blazor Server, the\", \" app maintains an ongoing connection with the server. The app\\u2019s state, called a\\ncircuit, is held in \", \"server memory while the connection is considered active. State will only be disposed\\nwhen the user n\", \"avigates away from the app or a particular page in the app. All members of the active\\ncomponents are\", \" available between interactions with the server.\\n\\nThere are several advantages of this feature:\\n\\n\\u2022\\n\\n\", \"\\u2022\\n\\nComponent state is readily available and not rebuilt between interactions.\\n\\nState isn\\u2019t transmitt\", \"ed to the browser.\\n\\nHowever, there are some disadvantages to in-memory component state persistence t\", \"o be aware of:\\n\\n\\u2022\\n\\n\\u2022\\n\\nIf the server restarts between request, state is lost.\\n\\nYour application web s\", \"erver load-balancing solution must include sticky sessions to ensure\\nthat all requests from the same\", \" browser return to the same server. If a request goes to a\\ndifferent server, state will be lost.\\n\\n\\u2022\\n\", \"\\nPersistence of component state on the server can lead to memory pressure on the web server.\\n\\nFor th\", \"e preceding reasons, don\\u2019t rely on just the state of the component to reside in-memory on the\\nserver\", \". Your application should also include some backing data store for data between requests. Some\\nsimpl\", \"e examples of this strategy:\\n\\n\\u2022\\n\\nIn a shopping cart application, persist the content of new items ad\", \"ded to the cart in a\\ndatabase record. If the state on the server is lost, you can reconstitute it fr\", \"om the database\\nrecords.\\n\\n46\\n\\nCHAPTER 8 | State management\\n\\n\\f\\u2022\\n\\nIn a multi-part web form, your users\", \" will expect your application to remember values between\\neach request. Write the data between each o\", \"f your user\\u2019s posts to a data store so that they\\ncan be fetched and assembled into the final form re\", \"sponse structure when the multi-part\\nform is completed.\\n\\nFor additional details on managing state in\", \" Blazor apps, see ASP.NET Core Blazor state management.\\n\\nMaintain state with Session\\n\\nWeb Forms deve\", \"lopers could maintain information about the currently acting user with the\\nMicrosoft.AspNetCore.Http\", \".ISession dictionary object. It\\u2019s easy enough to add an object with a string\\nkey to the Session, and\", \" that object would be available at a later time during the user\\u2019s interactions\\nwith the application.\", \" In an attempt to eliminate managing interacting with HTTP, the Session object\\nmade it easy to maint\", \"ain state.\\n\\nThe signature of the .NET Framework Session object isn\\u2019t the same as the ASP.NET Core Se\", \"ssion\\nobject. Consider the documentation for the new ASP.NET Core Session before deciding to migrate\", \"\\nand use the new session state feature.\\n\\nSession is available in ASP.NET Core and Blazor Server, but\", \" is discouraged from use in favor of storing\\ndata in a data repository appropriately. Session state \", \"is also not functional if visitors decline the use\\nHTTP cookies in your application due to privacy c\", \"oncerns.\\n\\nConfiguration for ASP.NET Core and Session state is available in the Session and state man\", \"agement in\\nASP.NET Core article.\\n\\nApplication state\\n\\nThe Application object in the Web Forms framewo\", \"rk provides a massive, cross-request repository for\\ninteracting with application-scope configuration\", \" and state. Application state was an ideal place to\\nstore various application configuration properti\", \"es that would be referenced by all requests, regardless\\nof the user making the request. The problem \", \"with the Application object was that data didn\\u2019t persist\\nacross multiple servers. The state of the a\", \"pplication object was lost between restarts.\\n\\nAs with Session, it\\u2019s recommended that data move to a \", \"persistent backing store that could be\\naccessed by multiple server instances. If there is volatile d\", \"ata that you would like to be able to access\\nacross requests and users, you could easily store it in\", \" a singleton service that can be injected into\\ncomponents that require this information or interacti\", \"on.\\n\\nThe construction of an object to maintain application state and its consumption could resemble \", \"the\\nfollowing implementation:\\n\\npublic class MyApplicationState\\n{\\n    public int VisitorCounter { get\", \"; private set; } = 0;\\n\\n    public void IncrementCounter() => VisitorCounter += 1;\\n}\\n\\n47\\n\\nCHAPTER 8 |\", \" State management\\n\\n\\fapp.AddSingleton<MyApplicationState>();\\n\\n@inject MyApplicationState AppState\\n\\n<l\", \"abel>Total Visitors: @AppState.VisitorCounter</label>\\n\\nThe MyApplicationState object is created only\", \" once on the server, and the value VisitorCounter is\\nfetched and output in the component\\u2019s label. Th\", \"e VisitorCounter value should be persisted and\\nretrieved from a backing data store for durability an\", \"d scalability.\\n\\nIn the browser\\n\\nApplication data can also be stored client-side on the user\\u2019s device\", \" so that is available later. There are\\ntwo browser features that allow for persistence of data in di\", \"fferent scopes of the user\\u2019s browser:\\n\\n\\u2022\\n\\n\\u2022\\n\\nlocalStorage - scoped to the user\\u2019s entire browser. If \", \"the page is reloaded, the browser is\\nclosed and reopened, or another tab is opened with the same URL\", \" then the same\\nlocalStorage is provided by the browser\\n\\nsessionStorage - scoped to the user\\u2019s curren\", \"t browser tab. If the tab is reloaded, the state\\npersists. However, if the user opens another tab to\", \" your application or closes and reopens the\\nbrowser the state is lost.\\n\\nYou can write some custom Ja\", \"vaScript code to interact with these features, or there are a number of\\nNuGet packages that you can \", \"use that provide this functionality. One such package is\\nMicrosoft.AspNetCore.ProtectedBrowserStorag\", \"e.\\n\\nFor instructions on utilizing this package to interact with localStorage and sessionStorage, see\", \" the\\nBlazor State Management article.\\n\\n48\\n\\nCHAPTER 8 | State management\\n\\n\\fCHAPTER  9\\n\\nForms and vali\", \"dation\\n\\nThe ASP.NET Web Forms framework includes a set of validation server controls that handle val\", \"idating\\nuser input entered into a form (RequiredFieldValidator, CompareValidator, RangeValidator, an\", \"d so on).\\nThe ASP.NET Web Forms framework also supports model binding and validating the model based\", \" on\\ndata annotations ([Required], [StringLength], [Range], and so on). The validation logic can be e\", \"nforced\\nboth on the server and on the client using unobtrusive JavaScript-based validation. The\\nVali\", \"dationSummary server control is used to display a summary of the validation errors to the user.\\n\\nBla\", \"zor supports the sharing of validation logic between both the client and the server. ASP.NET\\nprovide\", \"s pre-built JavaScript implementations of many common server validations. In many cases, the\\ndevelop\", \"er still has to write JavaScript to fully implement their app-specific validation logic. The same\\nmo\", \"del types, data annotations, and validation logic can be used on both the server and client.\\n\\nBlazor\", \" provides a set of input components. The input components handle binding field data to a\\nmodel and v\", \"alidating the user input when the form is submitted.\\n\\nInput component\\n\\nRendered HTML element\\n\\nInputC\", \"heckbox\\n\\nInputDate\\n\\nInputNumber\\n\\nInputSelect\\n\\nInputText\\n\\nInputTextArea\\n\\n<input type=\\\"checkbox\\\">\\n\\n<in\", \"put type=\\\"date\\\">\\n\\n<input type=\\\"number\\\">\\n\\n<select>\\n\\n<input>\\n\\n<textarea>\\n\\nThe EditForm component wraps\", \" these input components and orchestrates the validation process\\nthrough an EditContext. When creatin\", \"g an EditForm, you specify what model instance to bind to using\\nthe Model parameter. Validation is t\", \"ypically done using data annotations, and it\\u2019s extensible. To\\nenable data annotation-based validatio\", \"n, add the DataAnnotationsValidator component as a child of\\nthe EditForm. The EditForm component pro\", \"vides a convenient event for handling valid\\n(OnValidSubmit) and invalid (OnInvalidSubmit) submission\", \"s. There\\u2019s also a more generic OnSubmit\\nevent that lets you trigger and handle the validation yourse\", \"lf.\\n\\nTo display a validation error summary, use the ValidationSummary component. To display validati\", \"on\\nmessages for a specific input field, use the ValidationMessage component, specifying a lambda\\nexp\", \"ression for the For parameter that points to the appropriate model member.\\n\\nThe following model type\", \" defines several validation rules using data annotations:\\n\\n49\\n\\nCHAPTER 9 | Forms and validation\\n\\n\\fus\", \"ing System;\\nusing System.ComponentModel.DataAnnotations;\\n\\npublic class Starship\\n{\\n    [Required]\\n   \", \" [StringLength(16,\\n        ErrorMessage = \\\"Identifier too long (16 character limit).\\\")]\\n    public s\", \"tring Identifier { get; set; }\\n\\n    public string Description { get; set; }\\n\\n    [Required]\\n    publ\", \"ic string Classification { get; set; }\\n\\n    [Range(1, 100000,\\n        ErrorMessage = \\\"Accommodation \", \"invalid (1-100000).\\\")]\\n    public int MaximumAccommodation { get; set; }\\n\\n    [Required]\\n    [Range(\", \"typeof(bool), \\\"true\\\", \\\"true\\\",\\n        ErrorMessage = \\\"This form disallows unapproved ships.\\\")]\\n    p\", \"ublic bool IsValidatedDesign { get; set; }\\n\\n    [Required]\\n    public DateTime ProductionDate { get;\", \" set; }\\n}\\n\\nThe following component demonstrates building a form in Blazor based on the Starship mode\", \"l type:\\n\\n<h1>New Ship Entry Form</h1>\\n\\n<EditForm Model=\\\"@starship\\\" OnValidSubmit=\\\"@HandleValidSubmit\", \"\\\">\\n    <DataAnnotationsValidator />\\n    <ValidationSummary />\\n\\n    <p>\\n        <label for=\\\"identifie\", \"r\\\">Identifier: </label>\\n        <InputText id=\\\"identifier\\\" @bind-Value=\\\"starship.Identifier\\\" />\\n    \", \"    <ValidationMessage For=\\\"() => starship.Identifier\\\" />\\n    </p>\\n    <p>\\n        <label for=\\\"descr\", \"iption\\\">Description (optional): </label>\\n        <InputTextArea id=\\\"description\\\" @bind-Value=\\\"starsh\", \"ip.Description\\\" />\\n    </p>\\n    <p>\\n        <label for=\\\"classification\\\">Primary Classification: </la\", \"bel>\\n        <InputSelect id=\\\"classification\\\" @bind-Value=\\\"starship.Classification\\\">\\n            <op\", \"tion value=\\\"\\\">Select classification ...</option>\\n            <option value=\\\"Exploration\\\">Exploration\", \"</option>\\n            <option value=\\\"Diplomacy\\\">Diplomacy</option>\\n            <option value=\\\"Defens\", \"e\\\">Defense</option>\\n        </InputSelect>\\n        <ValidationMessage For=\\\"() => starship.Classifica\", \"tion\\\" />\\n    </p>\\n    <p>\\n        <label for=\\\"accommodation\\\">Maximum Accommodation: </label>\\n       \", \" <InputNumber id=\\\"accommodation\\\" @bind-Value=\\\"starship.MaximumAccommodation\\\" />\\n        <ValidationM\", \"essage For=\\\"() => starship.MaximumAccommodation\\\" />\\n    </p>\\n\\n50\\n\\nCHAPTER 9 | Forms and validation\\n\\n\", \"\\f    <p>\\n        <label for=\\\"valid\\\">Engineering Approval: </label>\\n        <InputCheckbox id=\\\"valid\\\"\", \" @bind-Value=\\\"starship.IsValidatedDesign\\\" />\\n        <ValidationMessage For=\\\"() => starship.IsValida\", \"tedDesign\\\" />\\n    </p>\\n    <p>\\n        <label for=\\\"productionDate\\\">Production Date: </label>\\n       \", \" <InputDate id=\\\"productionDate\\\" @bind-Value=\\\"starship.ProductionDate\\\" />\\n        <ValidationMessage \", \"For=\\\"() => starship.ProductionDate\\\" />\\n    </p>\\n\\n    <button type=\\\"submit\\\">Submit</button>\\n</EditFor\", \"m>\\n\\n@code {\\n    private Starship starship = new Starship();\\n\\n    private void HandleValidSubmit()\\n  \", \"  {\\n        // Save the data\\n    }\\n}\\n\\nAfter the form submission, the model-bound data hasn\\u2019t been sa\", \"ved to any data store, like a\\ndatabase. In a Blazor WebAssembly app, the data must be sent to the se\", \"rver. For example, using an\\nHTTP POST request. In a Blazor Server app, the data is already on the se\", \"rver, but it must be persisted.\\nHandling data access in Blazor apps is the subject of the Dealing wi\", \"th data section.\\n\\nAdditional resources\\n\\nFor more information on forms and validation in Blazor apps,\", \" see the Blazor documentation.\\n\\n51\\n\\nCHAPTER 9 | Forms and validation\\n\\n\\fCHAPTER  10\\n\\nWork with data\\n\\n\", \"Data access is the backbone of an ASP.NET Web Forms app. If you\\u2019re building forms for the web, what\\n\", \"happens to that data? With Web Forms, there were multiple data access techniques you could use to\\nin\", \"teract with a database:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nData Sources\\n\\nADO.NET\\n\\nEntity Framework\\n\\nData Sources were control\", \"s that you could place on a Web Forms page and configure like other\\ncontrols. Visual Studio provided\", \" a friendly set of dialogs to configure and bind the controls to your\\nWeb Forms pages. Developers wh\", \"o enjoy a \\u201clow code\\u201d or \\u201cno code\\u201d approach preferred this\\ntechnique when Web Forms was first release\", \"d.\\n\\nADO.NET is the low-level approach to interacting with a database. Your apps could create a\\nconne\", \"ction to the database with Commands, Datatables, and Datasets for interacting. The results\\ncould the\", \"n be bound to fields on screen without much code. The drawback of this approach was that\\neach set of\", \" ADO.NET objects (Connection, Command, and DataTable) was bound to libraries provided\\nby a database \", \"vendor. Use of these components made the code rigid and difficult to migrate to a\\ndifferent database\", \".\\n\\nEntity Framework\\n\\nEntity Framework (EF) is the open source object-relational mapping framework ma\", \"intained by the\\n.NET Foundation. Initially released with .NET Framework, EF allows for generating co\", \"de for the\\ndatabase connections, storage schemas, and interactions. With this abstraction, you can f\", \"ocus on your\\n\\n52\\n\\nCHAPTER 10 | Work with data\\n\\n\\fapp\\u2019s business rules and allow the database to be ma\", \"naged by a trusted database administrator. In\\n.NET, you can use an updated version of EF called EF C\", \"ore. EF Core helps generate and maintain the\\ninteractions between your code and the database with a \", \"series of commands that are available for you\\nusing the dotnet ef command-line tool. Let\\u2019s take a lo\", \"ok at a few samples to get you working with a\\ndatabase.\\n\\nEF Code First\\n\\nA quick way to get started b\", \"uilding your database interactions is to start with the class objects you\\nwant to work with. EF prov\", \"ides a tool to help generate the appropriate database code for your classes.\\nThis approach is called\", \" \\u201cCode First\\u201d development. Consider the following Product class for a sample\\nstorefront app that we \", \"want to store in a relational database like Microsoft SQL Server.\\n\\npublic class Product\\n{\\n    public\", \" int Id { get; set; }\\n\\n    [Required]\\n    public string Name { get; set; }\\n\\n    [MaxLength(4000)]\\n  \", \"  public string Description { get; set; }\\n\\n    [Range(0, 99999,99)]\\n    [DataType(DataType.Currency)\", \"]\\n    public decimal Price { get; set; }\\n}\\n\\nProduct has a primary key and three additional fields th\", \"at would be created in our database:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nEF will identify the Id property as a primary key \", \"by convention.\\n\\nName will be stored in a column configured for text storage. The [Required] attribut\", \"e\\ndecorating this property will add a not null constraint to help enforce this declared behavior\\nof \", \"the property.\\n\\nDescription will be stored in a column configured for text storage, and have a maximu\", \"m\\nlength configured of 4000 characters as dictated by the [MaxLength] attribute. The database\\nschema\", \" will be configured with a column named MaxLength using data type varchar(4000).\\n\\nThe Price property\", \" will be stored as currency. The [Range] attribute will generate appropriate\\nconstraints to prevent \", \"data storage outside of the minimum and maximum values declared.\\n\\nWe need to add this Product class \", \"to a database context class that defines the connection and\\ntranslation operations with our database\", \".\\n\\npublic class MyDbContext : DbContext\\n{\\n    public DbSet<Product> Products { get; set; }\\n}\\n\\nThe My\", \"DbContext class provides the one property that defines the access and translation for the\\nProduct cl\", \"ass. Your application configures this class for interaction with the database using the\\nfollowing en\", \"tries in the Startup class\\u2019s ConfigureServices method (or appropriate location in\\nProgram.cs using t\", \"he builder.Services property instead of services):\\n\\n53\\n\\nCHAPTER 10 | Work with data\\n\\n\\fservices.AddDb\", \"Context<MyDbContext>(options =>\\n    options.UseSqlServer(\\\"MY DATABASE CONNECTION STRING\\\"));\\n\\nThe pre\", \"ceding code will connect to a SQL Server database with the specified connection string. You\\ncan plac\", \"e the connection string in your appsettings.json file, environment variables, or other\\nconfiguration\", \" storage locations and replace this embedded string appropriately.\\n\\nYou can then generate the databa\", \"se table appropriate for this class using the following commands:\\n\\ndotnet ef migrations add 'Create \", \"Product table'\\ndotnet ef database update\\n\\nThe first command defines the changes you\\u2019re making to the\", \" database schema as a new EF Migration\\ncalled Create Product table. A Migration defines how to apply\", \" and remove your new database\\nchanges.\\n\\nOnce applied, you have a simple Product table in your databa\", \"se and some new classes added to the\\nproject that help manage the database schema. You can find thes\", \"e generated classes, by default, in a\\nnew folder called Migrations. When you make changes to the Pro\", \"duct class or add more related\\nclasses you would like interacting with your database, you need to ru\", \"n the command-line commands\\nagain with a new name of the migration. This command will generate anoth\", \"er set of migration classes\\nto update your database schema.\\n\\nEF Database First\\n\\nFor existing databas\", \"es, you can generate the classes for EF Core by using the .NET command-line\\ntools. To scaffold the c\", \"lasses, use a variation of the following command:\\n\\ndotnet ef dbcontext scaffold \\\"CONNECTION STRING\\\" \", \"Microsoft.EntityFrameworkCore.SqlServer -c\\nMyDbContext -t Product -t Customer\\n\\nThe preceding command\", \" connects to the database using the specified connection string and the\\nMicrosoft.EntityFrameworkCor\", \"e.SqlServer provider. Once connected, a database context class named\\nMyDbContext is created. Additio\", \"nally, supporting classes are created for the Product and Customer\\ntables that were specified with t\", \"he -t options. There are many configuration options for this command\\nto generate the class hierarchy\", \" appropriate for your database. For a complete reference, see the\\ncommand\\u2019s documentation.\\n\\nMore inf\", \"ormation about EF Core can be found on the Microsoft Docs site.\\n\\nInteract with web services\\n\\nWhen AS\", \"P.NET was first released, SOAP services were the preferred way for web servers and clients to\\nexchan\", \"ge data. Much has changed since that time, and the preferred interactions with services have\\nshifted\", \" to direct HTTP client interactions. With ASP.NET Core and Blazor, you can register the\\nconfiguratio\", \"n of your HttpClient in Program.cs or in the Startup class\\u2019s ConfigureServices method. Use\\nthat conf\", \"iguration when you need to interact with the HTTP endpoint. Consider the following\\nconfiguration cod\", \"e:\\n\\n54\\n\\nCHAPTER 10 | Work with data\\n\\n\\f// in Program.cs\\nbuilder.Services.AddHttpClient(\\\"github\\\", clie\", \"nt =>\\n{\\n    client.BaseAddress = new Uri(\\\"http://api.github.com/\\\");\\n    // Github API versioning\\n   \", \" client.DefaultRequestHeaders.Add(\\\"Accept\\\", \\\"application/vnd.github.v3+json\\\");\\n    // Github require\", \"s a user-agent\\n    client.DefaultRequestHeaders.Add(\\\"User-Agent\\\", \\\"BlazorWebForms-Sample\\\");\\n});\\n\\nWhe\", \"never you need to access data from GitHub, create a client with a name of github. The client is\\nconf\", \"igured with the base address, and the request headers are set appropriately. Inject the\\nIHttpClientF\", \"actory into your Blazor components with the @inject directive or an [Inject] attribute on a\\nproperty\", \". Create your named client and interact with services using the following syntax:\\n\\n@inject IHttpClie\", \"ntFactory factory\\n\\n...\\n\\n@code {\\n    protected override async Task OnInitializedAsync()\\n    {\\n       \", \" var client = factory.CreateClient(\\\"github\\\");\\n        var response = await client.GetAsync(\\\"repos/do\", \"tnet/docs/issues\\\");\\n        response.EnsureStatusCode();\\n        var content = await response.Conten\", \"t.ReadAsStringAsync();\\n    }\\n}\\n\\nThis method returns the string describing the collection of issues i\", \"n the dotnet/docs GitHub repository.\\nIt returns content in JSON format and is deserialized into appr\", \"opriate GitHub issue objects. There are\\nmany ways that you can configure the HttpClientFactory to de\", \"liver preconfigured HttpClient objects.\\nTry configuring multiple HttpClient instances with different\", \" names and endpoints for the various web\\nservices you work with. This approach will make your intera\", \"ctions with those services easier to work\\nwith on each page. For more information, see Make HTTP req\", \"uests using IHttpClientFactory.\\n\\n55\\n\\nCHAPTER 10 | Work with data\\n\\n\\fCHAPTER  11\\n\\nModules, handlers, a\", \"nd\\nmiddleware\\n\\nAn ASP.NET Core app is built upon a series of middleware. Middleware is handlers that\", \" are arranged\\ninto a pipeline to handle requests and responses. In a Web Forms app, HTTP handlers an\", \"d modules\\nsolve similar problems. In ASP.NET Core, modules, handlers, Global.asax.cs, and the app li\", \"fe cycle are\\nreplaced with middleware. In this chapter, you\\u2019ll learn about middleware in the context\", \" of a Blazor\\napp.\\n\\nOverview\\n\\nThe ASP.NET Core request pipeline consists of a sequence of request del\", \"egates, called one after the\\nother. The following diagram demonstrates the concept. The thread of ex\", \"ecution follows the black\\narrows.\\n\\n56\\n\\nCHAPTER 11 | Modules, handlers, and middleware\\n\\n\\fThe precedin\", \"g diagram lacks a concept of lifecycle events. This concept is foundational to how\\nASP.NET Web Forms\", \" requests are handled. This system makes it easier to reason about what process\\nis occurring and all\", \"ows middleware to be inserted at any point. Middleware executes in the order in\\nwhich it\\u2019s added to \", \"the request pipeline. They\\u2019re also added in code instead of configuration files,\\nusually in Startup.\", \"cs.\\n\\nKatana\\n\\nReaders familiar with Katana will feel comfortable in ASP.NET Core. In fact, Katana is \", \"a framework from\\nwhich ASP.NET Core derives. It introduced similar middleware and pipeline patterns \", \"for ASP.NET 4.x.\\nMiddleware designed for Katana can be adapted to work with the ASP.NET Core pipelin\", \"e.\\n\\nCommon middleware\\n\\nASP.NET 4.x includes many modules. In a similar fashion, ASP.NET Core has man\", \"y middleware\\ncomponents available as well. IIS modules may be used in some cases with ASP.NET Core. \", \"In other\\ncases, native ASP.NET Core middleware may be available.\\n\\nThe following table lists replacem\", \"ent middleware and components in ASP.NET Core.\\n\\nModule\\n\\nASP.NET 4.x module\\n\\nASP.NET Core option\\n\\nHTT\", \"P errors\\n\\nCustomErrorModule\\n\\nStatus Code Pages\\nMiddleware\\n\\n57\\n\\nCHAPTER 11 | Modules, handlers, and m\", \"iddleware\\n\\n\\fModule\\n\\nASP.NET 4.x module\\n\\nASP.NET Core option\\n\\nDefault document\\n\\nDefaultDocumentModule\", \"\\n\\nDefault Files Middleware\\n\\nDirectory browsing\\n\\nDirectoryListingModule\\n\\nDynamic compression\\n\\nDynamic\", \"CompressionModule\\n\\nDirectory Browsing\\nMiddleware\\n\\nResponse Compression\\nMiddleware\\n\\nFailed requests t\", \"racing\\n\\nFailedRequestsTracingModule\\n\\nASP.NET Core Logging\\n\\nFile caching\\n\\nFileCacheModule\\n\\nHTTP cachi\", \"ng\\n\\nHttpCacheModule\\n\\nResponse Caching\\nMiddleware\\n\\nResponse Caching\\nMiddleware\\n\\nHTTP logging\\n\\nHttpLog\", \"gingModule\\n\\nASP.NET Core Logging\\n\\nHTTP redirection\\n\\nHttpRedirectionModule\\n\\nISAPI filters\\n\\nISAPI\\n\\nIsa\", \"piFilterModule\\n\\nIsapiModule\\n\\nRequest filtering\\n\\nRequestFilteringModule\\n\\nURL rewriting\\u2020\\n\\nRewriteModul\", \"e\\n\\nStatic compression\\n\\nStaticCompressionModule\\n\\nStatic content\\n\\nStaticFileModule\\n\\nURL Rewriting\\nMidd\", \"leware\\n\\nMiddleware\\n\\nMiddleware\\n\\nURL Rewriting\\nMiddleware IRule\\n\\nURL Rewriting\\nMiddleware\\n\\nResponse C\", \"ompression\\nMiddleware\\n\\nStatic File Middleware\\n\\nURL authorization\\n\\nUrlAuthorizationModule\\n\\nASP.NET Co\", \"re Identity\\n\\nThis list isn\\u2019t exhaustive but should give an idea of what mapping exists between the t\", \"wo frameworks.\\nFor a more detailed list, see IIS modules with ASP.NET Core.\\n\\nCustom middleware\\n\\nBuil\", \"t-in middleware may not handle all scenarios needed for an app. In such cases, it makes sense to\\ncre\", \"ate your own middleware. There are multiple ways of defining middleware, with the simplest being\\na s\", \"imple delegate. Consider the following middleware, which accepts a culture request from a query\\nstri\", \"ng:\\n\\npublic class Startup\\n{\\n    public void Configure(IApplicationBuilder app)\\n    {\\n        app.Use\", \"(async (context, next) =>\\n        {\\n            var cultureQuery = context.Request.Query[\\\"culture\\\"];\", \"\\n\\n58\\n\\nCHAPTER 11 | Modules, handlers, and middleware\\n\\n\\f            if (!string.IsNullOrWhiteSpace(cu\", \"ltureQuery))\\n            {\\n                var culture = new CultureInfo(cultureQuery);\\n\\n           \", \"     CultureInfo.CurrentCulture = culture;\\n                CultureInfo.CurrentUICulture = culture;\\n \", \"           }\\n\\n            // Call the next delegate/middleware in the pipeline\\n            await nex\", \"t();\\n        });\\n\\n        app.Run(async (context) =>\\n            await context.Response.WriteAsync(\\n\", \"                $\\\"Hello {CultureInfo.CurrentCulture.DisplayName}\\\"));\\n    }\\n}\\n\\nMiddleware can also be\", \" defined as class, either by implementing the IMiddleware interface or by\\nfollowing middleware conve\", \"ntion. For more information, see Write custom ASP.NET Core middleware.\\n\\n59\\n\\nCHAPTER 11 | Modules, ha\", \"ndlers, and middleware\\n\\n\\fCHAPTER  12\\n\\nApp configuration\\n\\nThe primary way to load app configuration i\", \"n Web Forms is with entries in the web.config file\\u2014either\\non the server or a related configuration f\", \"ile referenced by web.config. You can use the static\\nConfigurationManager object to interact with ap\", \"p settings, data repository connection strings, and\\nother extended configuration providers that are \", \"added into the app. It\\u2019s typical to see interactions\\nwith app configuration as seen in the following\", \" code:\\n\\nvar configurationValue = ConfigurationManager.AppSettings[\\\"ConfigurationSettingName\\\"];\\nvar c\", \"onnectionString =\\nConfigurationManager.ConnectionStrings[\\\"MyDatabaseConnectionName\\\"].ConnectionStrin\", \"g;\\n\\nWith ASP.NET Core and server-side Blazor, the web.config file MAY be present if your app is host\", \"ed on\\na Windows IIS server. However, there\\u2019s no ConfigurationManager interaction with this configura\", \"tion,\\nand you can receive more structured app configuration from other sources. Let\\u2019s take a look at\", \" how\\nconfiguration is gathered and how you can still access configuration information from a web.con\", \"fig\\nfile.\\n\\nConfiguration sources\\n\\nASP.NET Core recognizes there are many configuration sources you m\", \"ay want to use for your app. The\\nframework attempts to offer you the best of these features by defau\", \"lt. Configuration is read and\\naggregated from these various sources by ASP.NET Core. Later loaded va\", \"lues for the same\\nconfiguration key take precedence over earlier values.\\n\\nASP.NET Core was designed \", \"to be cloud-aware and to make the configuration of apps easier for both\\noperators and developers. AS\", \"P.NET Core is environment-aware and knows if it\\u2019s running in your\\nProduction or Development environm\", \"ent. The environment indicator is set in the\\nASPNETCORE_ENVIRONMENT system environment variable. If \", \"no value is configured, the app defaults\\nto running in the Production environment.\\n\\nYour app can tri\", \"gger and add configuration from several sources based on the environment\\u2019s name.\\nBy default, the con\", \"figuration is loaded from the following resources in the order listed:\\n\\n1.\\n\\n2.\\n\\nappsettings.json fil\", \"e, if present\\n\\nappsettings.{ENVIRONMENT_NAME}.json file, if present\\n\\n3.  User secrets file on disk, \", \"if present\\n\\n4.\\n\\n5.\\n\\nEnvironment variables\\n\\nCommand-line arguments\\n\\n60\\n\\nCHAPTER 12 | App configuratio\", \"n\\n\\n\\fappsettings.json format and access\\n\\nThe appsettings.json file can be hierarchical with values st\", \"ructured like the following JSON:\\n\\n{\\n  \\\"section0\\\": {\\n    \\\"key0\\\": \\\"value\\\",\\n    \\\"key1\\\": \\\"value\\\"\\n  },\\n \", \" \\\"section1\\\": {\\n    \\\"key0\\\": \\\"value\\\",\\n    \\\"key1\\\": \\\"value\\\"\\n  }\\n}\\n\\nWhen presented with the preceding JSO\", \"N, the configuration system flattens child values and\\nreferences their fully qualified hierarchical \", \"paths. A colon (:) character separates each property in the\\nhierarchy. For example, the configuratio\", \"n key section1:key0 accesses the section1 object literal\\u2019s key0\\nvalue.\\n\\nUser secrets\\n\\nUser secrets a\", \"re:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nConfiguration values that are stored in a JSON file on the developer\\u2019s workstation, ou\", \"tside of\\nthe app development folder.\\n\\nOnly loaded when running in the Development environment.\\n\\nAsso\", \"ciated with a specific app.\\n\\n\\u2022  Managed with the .NET CLI\\u2019s user-secrets command.\\n\\nConfigure your ap\", \"p for secrets storage by executing the user-secrets command:\\n\\ndotnet user-secrets init\\n\\nThe precedin\", \"g command adds a UserSecretsId element to the project file. The element contains a\\nGUID, which is us\", \"ed to associate secrets with the app. You can then define a secret with the set\\ncommand. For example\", \":\\n\\ndotnet user-secrets set \\\"Parent:ApiKey\\\" \\\"12345\\\"\\n\\nThe preceding command makes the Parent:ApiKey co\", \"nfiguration key available on a developer\\u2019s\\nworkstation with the value 12345.\\n\\nFor more information a\", \"bout creating, storing, and managing user secrets, see the Safe storage of app\\nsecrets in developmen\", \"t in ASP.NET Core document.\\n\\nEnvironment variables\\n\\nThe next set of values loaded into your app conf\", \"iguration is the system\\u2019s environment variables. All of\\nyour system\\u2019s environment variable settings \", \"are now accessible to you through the configuration API.\\n\\n61\\n\\nCHAPTER 12 | App configuration\\n\\n\\fHiera\", \"rchical values are flattened and separated by colon characters when read inside your app.\\nHowever, s\", \"ome operating systems don\\u2019t allow the colon character environment variable names.\\nASP.NET Core addre\", \"sses this limitation by converting values that have double-underscores (__) into a\\ncolon when they\\u2019r\", \"e accessed. The Parent:ApiKey value from the user secrets section above can be\\noverridden with the e\", \"nvironment variable Parent__ApiKey.\\n\\nCommand-line arguments\\n\\nConfiguration can also be provided as c\", \"ommand-line arguments when your app is started. Use the\\ndouble-dash (--) or forward-slash (/) notati\", \"on to indicate the name of the configuration value to set\\nand the value to be configured. The syntax\", \" resembles the following commands:\\n\\ndotnet run CommandLineKey1=value1 --CommandLineKey2=value2 /Comm\", \"andLineKey3=value3\\ndotnet run --CommandLineKey1 value1 /CommandLineKey2 value2\\ndotnet run Parent:Api\", \"Key=67890\\n\\nThe return of web.config\\n\\nIf you\\u2019ve deployed your app to Windows on IIS, the web.config f\", \"ile still configures IIS to manage your\\napp. By default, IIS adds a reference to the ASP.NET Core Mo\", \"dule (ANCM). ANCM is a native IIS\\nmodule that hosts your app in place of the Kestrel web server. Thi\", \"s web.config section resembles the\\nfollowing XML markup:\\n\\n<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<co\", \"nfiguration>\\n  <location path=\\\".\\\" inheritInChildApplications=\\\"false\\\">\\n    <system.webServer>\\n      <\", \"handlers>\\n        <add name=\\\"aspNetCore\\\" path=\\\"*\\\" verb=\\\"*\\\" modules=\\\"AspNetCoreModuleV2\\\"\\nresourceType\", \"=\\\"Unspecified\\\" />\\n      </handlers>\\n      <aspNetCore processPath=\\\".\\\\MyApp.exe\\\"\\n                  st\", \"doutLogEnabled=\\\"false\\\"\\n                  stdoutLogFile=\\\".\\\\logs\\\\stdout\\\"\\n                  hostingMode\", \"l=\\\"inprocess\\\" />\\n    </system.webServer>\\n  </location>\\n</configuration>\\n\\nApp-specific configuration \", \"can be defined by nesting an environmentVariables element in the\\naspNetCore element. The values defi\", \"ned in this section are presented to the ASP.NET Core app as\\nenvironment variables. The environment \", \"variables load appropriately during that segment of app\\nstartup.\\n\\n<aspNetCore processPath=\\\"dotnet\\\"\\n \", \"     arguments=\\\".\\\\MyApp.dll\\\"\\n      stdoutLogEnabled=\\\"false\\\"\\n      stdoutLogFile=\\\".\\\\logs\\\\stdout\\\"\\n    \", \"  hostingModel=\\\"inprocess\\\">\\n  <environmentVariables>\\n    <environmentVariable name=\\\"ASPNETCORE_ENVIR\", \"ONMENT\\\" value=\\\"Development\\\" />\\n\\n62\\n\\nCHAPTER 12 | App configuration\\n\\n\\f    <environmentVariable name=\\\"\", \"Parent:ApiKey\\\" value=\\\"67890\\\" />\\n  </environmentVariables>\\n</aspNetCore>\\n\\nRead configuration in the a\", \"pp\\n\\nASP.NET Core provides app configuration through the IConfiguration interface. This configuration\", \"\\ninterface should be requested by your Blazor components, Blazor pages, and any other ASP.NET Core-\\n\", \"managed class that needs access to configuration. The ASP.NET Core framework will automatically\\npopu\", \"late this interface with the resolved configuration configured earlier. On a Blazor page or a\\ncompon\", \"ent\\u2019s Razor markup, you can inject the IConfiguration object with an @inject directive at the\\ntop of\", \" the .razor file like this:\\n\\n@inject IConfiguration Configuration\\n\\nThis preceding statement makes th\", \"e IConfiguration object available as the Configuration variable\\nthroughout the rest of the Razor tem\", \"plate.\\n\\nIndividual configuration settings can be read by specifying the configuration setting hierar\", \"chy sought\\nas an indexer parameter:\\n\\nvar mySetting = Configuration[\\\"section1:key0\\\"];\\n\\nYou can fetch \", \"entire configuration sections by using the GetSection method to retrieve a collection of\\nkeys at a s\", \"pecific location with a syntax similar to GetSection(\\\"section1\\\") to retrieve the configuration\\nfor s\", \"ection1 from the earlier example.\\n\\nStrongly typed configuration\\n\\nWith Web Forms, it was possible to \", \"create a strongly typed configuration type that inherited from the\\nConfigurationSection type and ass\", \"ociated types. A ConfigurationSection allowed you to configure\\nsome business rules and processing fo\", \"r those configuration values.\\n\\nIn ASP.NET Core, you can specify a class hierarchy that will receive \", \"the configuration values. These\\nclasses:\\n\\n\\u2022\\n\\n\\u2022\\n\\nDon\\u2019t need to inherit from a parent class.\\n\\nShould i\", \"nclude public properties that match the properties and type references for the\\nconfiguration structu\", \"re you wish to capture.\\n\\nFor the earlier appsettings.json sample, you could define the following cla\", \"sses to capture the values:\\n\\npublic class MyConfig\\n{\\n    public MyConfigSection section0 { get; set;\", \"}\\n\\n    public MyConfigSection section1 { get; set;}\\n}\\n\\npublic class MyConfigSection\\n{\\n\\n63\\n\\nCHAPTER 1\", \"2 | App configuration\\n\\n\\f    public string key0 { get; set; }\\n\\n    public string key1 { get; set; }\\n}\", \"\\n\\nThis class hierarchy can be populated by adding the following line to the Startup.ConfigureService\", \"s\\nmethod (or appropriate location in Program.cs using the builder.Services property instead of servi\", \"ces):\\n\\nservices.Configure<MyConfig>(Configuration);\\n\\nIn the rest of the app, you can add an input pa\", \"rameter to classes or an @inject directive in Razor\\ntemplates of type IOptions<MyConfig> to receive \", \"the strongly typed configuration settings. The\\nIOptions<MyConfig>.Value property will yield the MyCo\", \"nfig value populated from the configuration\\nsettings.\\n\\n@inject IOptions<MyConfig> options\\n@code {\\n  \", \"  var MyConfiguration = options.Value;\\n    var theSetting = MyConfiguration.section1.key0;\\n}\\n\\nMore i\", \"nformation about the Options feature can be found in the Options pattern in ASP.NET Core\\ndocument.\\n\\n\", \"64\\n\\nCHAPTER 12 | App configuration\\n\\n\\fCHAPTER  13\\n\\nSecurity: Authentication\\nand Authorization in\\nASP.\", \"NET Web Forms and\\nBlazor\\n\\nMigrating from an ASP.NET Web Forms application to Blazor will almost cert\", \"ainly require updating\\nhow authentication and authorization are performed, assuming the application \", \"had authentication\\nconfigured. This chapter will cover how to migrate from the ASP.NET Web Forms uni\", \"versal provider\\nmodel (for membership, roles, and user profiles) and how to work with ASP.NET Core I\", \"dentity from\\nBlazor apps. While this chapter will cover the high-level steps and considerations, the\", \" detailed steps\\nand scripts may be found in the referenced documentation.\\n\\nASP.NET universal provide\", \"rs\\n\\nSince ASP.NET 2.0, the ASP.NET Web Forms platform has supported a provider model for a variety o\", \"f\\nfeatures, including membership. The universal membership provider, along with the optional role\\npr\", \"ovider, is commonly deployed with ASP.NET Web Forms applications. It offers a robust and secure\\nway \", \"to manage authentication and authorization that continues to work well today. The most recent\\nofferi\", \"ng of these universal providers is available as a NuGet package, Microsoft.AspNet.Providers.\\n\\nThe Un\", \"iversal Providers work with a SQL database schema that includes tables like\\naspnet_Applications, asp\", \"net_Membership, aspnet_Roles, and aspnet_Users. When configured by\\nrunning the aspnet_regsql.exe com\", \"mand, the providers install tables and stored procedures that\\nprovide all of the necessary queries a\", \"nd commands to work with the underlying data. The database\\nschema and these stored procedures are no\", \"t compatible with newer ASP.NET Identity and ASP.NET\\nCore Identity systems, so existing data must be\", \" migrated into the new system. Figure 1 shows an\\nexample table schema configured for universal provi\", \"ders.\\n\\n65\\n\\nCHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\", \"\\fThe universal provider handles users, membership, roles, and profiles. Users are assigned globally\\n\", \"unique identifiers and basic information like userId, userName etc. are stored in the aspnet_Users\\nt\", \"able. Authentication information, such as password, password format, password salt, lockout counters\", \"\\nand details, etc. are stored in the aspnet_Membership table. Roles consist simply of names and uniq\", \"ue\\nidentifiers, which are assigned to users via the aspnet_UsersInRoles association table, providing\", \" a\\nmany-to-many relationship.\\n\\nIf your existing system is using roles in addition to membership, you\", \" will need to migrate the user\\naccounts, the associated passwords, the roles, and the role membershi\", \"p into ASP.NET Core Identity.\\nYou will also most likely need to update your code where you\\u2019re curren\", \"tly performing role checks\\nusing if statements to instead leverage declarative filters, attributes, \", \"and/or tag helpers. We will review\\nmigration considerations in greater detail at the end of this cha\", \"pter.\\n\\nAuthorization configuration in Web Forms\\n\\nTo configure authorized access to certain pages in \", \"an ASP.NET Web Forms application, typically you\\nspecify that certain pages or folders are inaccessib\", \"le to anonymous users. This configuration is done in\\nthe web.config file:\\n\\n<?xml version=\\\"1.0\\\"?>\\n<co\", \"nfiguration>\\n    <system.web>\\n      <authentication mode=\\\"Forms\\\">\\n        <forms defaultUrl=\\\"~/home.\", \"aspx\\\" loginUrl=\\\"~/login.aspx\\\"\\n          slidingExpiration=\\\"true\\\" timeout=\\\"2880\\\"></forms>\\n      </aut\", \"hentication>\\n\\n      <authorization>\\n        <deny users=\\\"?\\\" />\\n      </authorization>\\n    </system.w\", \"eb>\\n</configuration>\\n\\nThe authentication configuration section sets up the forms authentication for \", \"the application. The\\nauthorization section is used to disallow anonymous users for the entire applic\", \"ation. However, you\\ncan provide more granular authorization rules on a per-location basis as well as\", \" apply role-based\\nauthorization checks.\\n\\n<location path=\\\"login.aspx\\\">\\n  <system.web>\\n\\n66\\n\\nCHAPTER 13\", \" | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\f    <authorization>\\n\", \"      <allow users=\\\"*\\\" />\\n    </authorization>\\n  </system.web>\\n</location>\\n\\nThe above configuration,\", \" when combined with the first one, would allow anonymous users to access\\nthe login page, overriding \", \"the site-wide restriction on non-authenticated users.\\n\\n<location path=\\\"/admin\\\">\\n  <system.web>\\n    <\", \"authorization>\\n      <allow roles=\\\"Administrators\\\" />\\n      <deny users=\\\"*\\\" />\\n    </authorization>\\n\", \"  </system.web>\\n</location>\\n\\nThe above configuration, when combined with the others, restricts acces\", \"s to the /admin folder and all\\nresources within it to members of the \\u201cAdministrators\\u201d role. This res\", \"triction could also be applied by\\nplacing a separate web.config file within the /admin folder root.\\n\", \"\\nAuthorization code in Web Forms\\n\\nIn addition to configuring access using web.config, you can also p\", \"rogrammatically configure access\\nand behavior in your Web Forms application. For instance, you can r\", \"estrict the ability to perform\\ncertain operations or view certain data based on the user\\u2019s role.\\n\\nTh\", \"is code can be used both in code-behind logic as well as in the page itself:\\n\\n<% if (HttpContext.Cur\", \"rent.User.IsInRole(\\\"Administrators\\\")) { %>\\n  <a href=\\\"/admin\\\">Go To Admin</a>\\n<% } %>\\n\\nIn addition t\", \"o checking user role membership, you can also determine if they are authenticated\\n(though often this\", \" is better done using the location-based configuration covered above). Below is an\\nexample of this a\", \"pproach.\\n\\nprotected void Page_Load(object sender, EventArgs e)\\n{\\n    if (!User.Identity.IsAuthentica\", \"ted)\\n    {\\n        FormsAuthentication.RedirectToLoginPage();\\n    }\\n    if (!Roles.IsUserInRole(User\", \".Identity.Name, \\\"Administrators\\\"))\\n    {\\n        MessageLabel.Text = \\\"Only administrators can view t\", \"his.\\\";\\n        SecretPanel.Visible = false;\\n    }\\n}\\n\\nIn the code above, role-based access control (R\", \"BAC) is used to determine whether certain elements of\\nthe page, such as a SecretPanel, are visible b\", \"ased on the current user\\u2019s role.\\n\\n67\\n\\nCHAPTER 13 | Security: Authentication and Authorization in ASP\", \".NET Web Forms and Blazor\\n\\n\\fTypically, ASP.NET Web Forms applications configure security within the \", \"web.config file and then add\\nadditional checks where needed in .aspx pages and their related .aspx.c\", \"s code-behind files. Most\\napplications leverage the universal membership provider, frequently with t\", \"he additional role provider.\\n\\nASP.NET Core Identity\\n\\nAlthough still tasked with authentication and a\", \"uthorization, ASP.NET Core Identity uses a different set\\nof abstractions and assumptions when compar\", \"ed to the universal providers. For example, the new\\nIdentity model supports third party authenticati\", \"on, allowing users to authenticate using a social media\\naccount or other trusted authentication prov\", \"ider. ASP.NET Core Identity supports UI for commonly\\nneeded pages like login, logout, and register. \", \"It leverages EF Core for its data access, and uses EF Core\\nmigrations to generate the necessary sche\", \"ma required to support its data model. This introduction to\\nIdentity on ASP.NET Core provides a good\", \" overview of what is included with ASP.NET Core Identity\\nand how to get started working with it. If \", \"you haven\\u2019t already set up ASP.NET Core Identity in your\\napplication and its database, it will help \", \"you get started.\\n\\nRoles, claims, and policies\\n\\nBoth the universal providers and ASP.NET Core Identit\", \"y support the concept of roles. You can create\\nroles for users and assign users to roles. Users can \", \"belong to any number of roles, and you can verify\\nrole membership as part of your authorization impl\", \"ementation.\\n\\nIn addition to roles, ASP.NET Core identity supports the concepts of claims and policie\", \"s. While a role\\nshould specifically correspond to a set of resources a user in that role should be a\", \"ble to access, a\\nclaim is simply part of a user\\u2019s identity. A claim is a name value pair that repres\", \"ents what the subject\\nis, not what the subject can do.\\n\\nIt is possible to directly inspect a user\\u2019s \", \"claims and determine based on these values whether a user\\nshould be given access to a resource. Howe\", \"ver, such checks are often repetitive and scattered\\nthroughout the system. A better approach is to d\", \"efine a policy.\\n\\nAn authorization policy consists of one or more requirements. Policies are register\", \"ed as part of the\\nauthorization service configuration in the ConfigureServices method of Startup.cs.\", \" For example, the\\nfollowing code snippet configures a policy called \\u201cCanadiansOnly\\u201d, which has the r\", \"equirement that the\\nuser has the Country claim with the value of \\u201cCanada\\u201d.\\n\\nservices.AddAuthorizatio\", \"n(options =>\\n{\\n    options.AddPolicy(\\\"CanadiansOnly\\\", policy => policy.RequireClaim(ClaimTypes.Count\", \"ry,\\n\\\"Canada\\\"));\\n});\\n\\nYou can learn more about how to create custom policies in the documentation.\\n\\nW\", \"hether you\\u2019re using policies or roles, you can specify that a particular page in your Blazor\\napplica\", \"tion requires that role or policy with the [Authorize] attribute, applied with the @attribute\\ndirect\", \"ive.\\n\\nRequiring a role:\\n\\n68\\n\\nCHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web \", \"Forms and Blazor\\n\\n\\f@attribute [Authorize(Roles =\\\"administrators\\\")]\\n\\nRequiring a policy be satisfied:\", \"\\n\\n@attribute [Authorize(Policy =\\\"CanadiansOnly\\\")]\\n\\nIf you need access to a user\\u2019s authentication sta\", \"te, roles, or claims in your code, there are two primary\\nways to achieve this functionality. The fir\", \"st is to receive the authentication state as a cascading\\nparameter. The second is to access the stat\", \"e using an injected AuthenticationStateProvider. The\\ndetails of each of these approaches are describ\", \"ed in the Blazor Security documentation.\\n\\nThe following code shows how to receive the Authentication\", \"State as a cascading parameter:\\n\\n[CascadingParameter]\\nprivate Task<AuthenticationState> authenticati\", \"onStateTask { get; set; }\\n\\nWith this parameter in place, you can get the user using this code:\\n\\nvar \", \"authState = await authenticationStateTask;\\nvar user = authState.User;\\n\\nThe following code shows how \", \"to inject the AuthenticationStateProvider:\\n\\n@using Microsoft.AspNetCore.Components.Authorization\\n@in\", \"ject AuthenticationStateProvider AuthenticationStateProvider\\n\\nWith the provider in place, you can ga\", \"in access to the user with the following code:\\n\\nAuthenticationState authState = await\\nAuthentication\", \"StateProvider.GetAuthenticationStateAsync();\\nClaimsPrincipal user = authState.User;\\n\\nif (user.Identi\", \"ty.IsAuthenticated)\\n{\\n  // work with user.Claims and/or user.Roles\\n}\\n\\nNote: The AuthorizeView compon\", \"ent, covered later in this chapter, provides a declarative way to\\ncontrol what a user sees on a page\", \" or component.\\n\\nTo work with users and claims (in Blazor Server applications) you may also need to i\", \"nject a\\nUserManager<T> (use IdentityUser for default) which you can use to enumerate and modify clai\", \"ms\\nfor a user. First inject the type and assign it to a property:\\n\\n@inject UserManager<IdentityUser>\", \" MyUserManager\\n\\nThen use it to work with the user\\u2019s claims. The following sample shows how to add an\", \"d persist a claim\\non a user:\\n\\nprivate async Task AddCountryClaim()\\n{\\n    var authState = await Authe\", \"nticationStateProvider.GetAuthenticationStateAsync();\\n    var user = authState.User;\\n    var identit\", \"yUser = await MyUserManager.FindByNameAsync(user.Identity.Name);\\n\\n    if (!user.HasClaim(c => c.Type\", \" == ClaimTypes.Country))\\n    {\\n\\n69\\n\\nCHAPTER 13 | Security: Authentication and Authorization in ASP.N\", \"ET Web Forms and Blazor\\n\\n\\f        // stores the claim in the cookie\\n        ClaimsIdentity id = new \", \"ClaimsIdentity();\\n        id.AddClaim(new Claim(ClaimTypes.Country, \\\"Canada\\\"));\\n        user.AddIden\", \"tity(id);\\n\\n        // save the claim in the database\\n        await MyUserManager.AddClaimAsync(ident\", \"ityUser, new Claim(ClaimTypes.Country,\\n\\\"Canada\\\"));\\n    }\\n}\\n\\nIf you need to work with roles, follow t\", \"he same approach. You may need to inject a RoleManager<T>\\n(use IdentityRole for default type) to lis\", \"t and manage the roles themselves.\\n\\nNote: In Blazor WebAssembly projects, you will need to provide s\", \"erver APIs to perform these\\noperations (instead of using UserManager<T> or RoleManager<T> directly).\", \" A Blazor WebAssembly\\nclient application would manage claims and/or roles by securely calling API en\", \"dpoints exposed for\\nthis purpose.\\n\\nMigration guide\\n\\nMigrating from ASP.NET Web Forms and universal p\", \"roviders to ASP.NET Core Identity requires several\\nsteps:\\n\\n1.\\n\\nCreate ASP.NET Core Identity database\", \" schema in the destination database\\n\\n2.  Migrate data from universal provider schema to ASP.NET Core\", \" Identity schema\\n\\n3.  Migrate configuration from the web.config to middleware and services, typicall\", \"y in Program.cs\\n\\n(or a Startup class)\\n\\n4.  Update individual pages using controls and conditionals t\", \"o use tag helpers and new identity\\n\\nAPIs.\\n\\nEach of these steps is described in detail in the followi\", \"ng sections.\\n\\nCreating the ASP.NET Core Identity schema\\n\\nThere are several ways to create the necess\", \"ary table structure used for ASP.NET Core Identity. The\\nsimplest is to create a new ASP.NET Core Web\", \" application. Choose Web Application and then change\\nAuthentication type to use Individual Accounts.\", \"\\n\\n70\\n\\nCHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\fFrom\", \" the command line, you can do the same thing by running dotnet new webapp -au Individual.\\nOnce the a\", \"pp has been created, run it and register on the site. You should trigger a page like the one\\nshown b\", \"elow:\\n\\n71\\n\\nCHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\", \"\\fClick on the \\u201cApply Migrations\\u201d button and the necessary database tables should be created for you.\", \"\\nIn addition, the migration files should appear in your project, as shown:\\n\\n72\\n\\nCHAPTER 13 | Securit\", \"y: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\fYou can run the migration your\", \"self, without running the web application, using this command-line\\ntool:\\n\\ndotnet ef database update\\n\", \"\\nIf you would rather run a script to apply the new schema to an existing database, you can script th\", \"ese\\nmigrations from the command-line. Run this command to generate the script:\\n\\ndotnet ef migrations\", \" script -o auth.sql\\n\\nThe above command will produce a SQL script in the output file auth.sql, which \", \"can then be run\\nagainst whatever database you like. If you have any trouble running dotnet ef comman\", \"ds, make sure\\nyou have the EF Core tools installed on your system.\\n\\nIn the event you have additional\", \" columns on your source tables, you will need to identify the best\\nlocation for these columns in the\", \" new schema. Generally, columns found on the aspnet_Membership\\ntable should be mapped to the AspNetU\", \"sers table. Columns on aspnet_Roles should be mapped to\\nAspNetRoles. Any additional columns on the a\", \"spnet_UsersInRoles table would be added to the\\nAspNetUserRoles table.\\n\\nIt\\u2019s also worth considering p\", \"utting any additional columns on separate tables. So that future\\nmigrations won\\u2019t need to take into \", \"account such customizations of the default identity schema.\\n\\nMigrating data from universal providers\", \" to ASP.NET Core Identity\\n\\nOnce you have the destination table schema in place, the next step is to \", \"migrate your user and role\\nrecords to the new schema. A complete list of the schema differences, inc\", \"luding which columns map\\nto which new columns, can be found here.\\n\\n73\\n\\nCHAPTER 13 | Security: Authen\", \"tication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\fTo migrate your users from membership t\", \"o the new identity tables, you should follow the steps\\ndescribed in the documentation. After followi\", \"ng these steps and the script provided, your users will\\nneed to change their password the next time \", \"they log in.\\n\\nIt is possible to migrate user passwords but the process is much more involved. Requir\", \"ing users to\\nupdate their passwords as part of the migration process, and encouraging them to use ne\", \"w, unique\\npasswords, is likely to enhance the overall security of the application.\\n\\nMigrating securi\", \"ty settings from web.config to app startup\\n\\nAs noted above, ASP.NET membership and role providers ar\", \"e configured in the application\\u2019s\\nweb.config file. Since ASP.NET Core apps are not tied to IIS and u\", \"se a separate system for\\nconfiguration, these settings must be configured elsewhere. For the most pa\", \"rt, ASP.NET Core Identity\\nis configured in the Program.cs file. Open the web project that was create\", \"d earlier (to generate the\\nidentity table schema) and review its Program.cs (or Startup.cs) file.\\n\\nT\", \"his code adds support for EF Core and Identity:\\n\\n// Add services to the container.\\nvar connectionStr\", \"ing = builder.Configuration.GetConnectionString(\\\"DefaultConnection\\\");\\nbuilder.Services.AddDbContext<\", \"ApplicationDbContext>(options =>\\n    options.UseSqlServer(connectionString));\\nbuilder.Services.AddDa\", \"tabaseDeveloperPageExceptionFilter();\\nbuilder.Services.AddDefaultIdentity<IdentityUser>(options =>\\n \", \"   options.SignIn.RequireConfirmedAccount = true)\\n    .AddEntityFrameworkStores<ApplicationDbContext\", \">();\\n\\nThe AddDefaultIdentity extension method is used to configure Identity to use the default\\nAppli\", \"cationDbContext and the framework\\u2019s IdentityUser type. If you\\u2019re using a custom IdentityUser, be\\nsur\", \"e to specify its type here. If these extension methods aren\\u2019t working in your application, check tha\", \"t\\nyou have the appropriate using statements and that you have the necessary NuGet package\\nreferences\", \". For example, your project should have some version of the\\nMicrosoft.AspNetCore.Identity.EntityFram\", \"eworkCore and Microsoft.AspNetCore.Identity.UI packages\\nreferenced.\\n\\nAlso in Program.cs you should s\", \"ee the necessary middleware configured for the site. Specifically,\\nUseAuthentication and UseAuthoriz\", \"ation should be set up, and in the proper location.\\n\\n// Configure the HTTP request pipeline.\\nif (app\", \".Environment.IsDevelopment())\\n{\\n    app.UseMigrationsEndPoint();\\n}\\nelse\\n{\\n    app.UseExceptionHandle\", \"r(\\\"/Error\\\");\\n    // The default HSTS value is 30 days. You may want to change this for production\\nsc\", \"enarios, see https://aka.ms/aspnetcore-hsts.\\n    app.UseHsts();\\n}\\n\\napp.UseHttpsRedirection();\\n\\napp.U\", \"seStaticFiles();\\n\\n74\\n\\nCHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms a\", \"nd Blazor\\n\\n\\fapp.UseRouting();\\n\\napp.UseAuthentication();\\napp.UseAuthorization();\\n\\n//app.MapController\", \"s();\\napp.MapBlazorHub();\\napp.MapFallbackToPage(\\\"/_Host\\\");\\n\\nASP.NET Identity does not configure anony\", \"mous or role-based access to locations from Program.cs.\\nYou will need to migrate any location-specif\", \"ic authorization configuration data to filters in ASP.NET\\nCore. Make note of which folders and pages\", \" will require such updates. You will make these changes in\\nthe next section.\\n\\nUpdating individual pa\", \"ges to use ASP.NET Core Identity abstractions\\n\\nIn your ASP.NET Web Forms application, if you had web\", \".config settings to deny access to certain\\npages or folders to anonymous users, you would migrate th\", \"ese changes by adding the [Authorize]\\nattribute to such pages:\\n\\n@attribute [Authorize]\\n\\nIf you furth\", \"er had denied access except to those users belonging to a certain role, you would likewise\\nmigrate t\", \"his behavior by adding an attribute specifying a role:\\n\\n@attribute [Authorize(Roles =\\\"administrators\", \"\\\")]\\n\\nThe [Authorize] attribute only works on @page components that are reached via the Blazor Router\", \".\\nThe attribute does not work with child components, which should instead use AuthorizeView.\\n\\nIf you\", \" have logic within page markup for determining whether to display some code to a certain user,\\nyou c\", \"an replace this with the AuthorizeView component. The AuthorizeView component selectively\\ndisplays U\", \"I depending on whether the user is authorized to see it. It also exposes a context variable\\nthat can\", \" be used to access user information.\\n\\n<AuthorizeView>\\n    <Authorized>\\n        <h1>Hello, @context.U\", \"ser.Identity.Name!</h1>\\n        <p>You can only see this content if you are authenticated.</p>\\n    <\", \"/Authorized>\\n    <NotAuthorized>\\n        <h1>Authentication Failure!</h1>\\n        <p>You are not sig\", \"ned in.</p>\\n    </NotAuthorized>\\n</AuthorizeView>\\n\\nYou can access the authentication state within pr\", \"ocedural logic by accessing the user from a\\nTask<AuthenticationState configured with the [CascadingP\", \"arameter] attribute. This configuration will\\nget you access to the user, which can let you determine\", \" if they are authenticated and if they belong to\\na particular role. If you need to evaluate a policy\", \" procedurally, you can inject an instance of the\\nIAuthorizationService and calls the AuthorizeAsync \", \"method on it. The following sample code\\ndemonstrates how to get user information and allow an author\", \"ized user to perform a task restricted\\nby the content-editor policy.\\n\\n75\\n\\nCHAPTER 13 | Security: Aut\", \"hentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\f@using Microsoft.AspNetCore.Authoriz\", \"ation\\n@inject IAuthorizationService AuthorizationService\\n\\n<button @onclick=\\\"@DoSomething\\\">Do somethi\", \"ng important</button>\\n\\n@code {\\n    [CascadingParameter]\\n    private Task<AuthenticationState> authen\", \"ticationStateTask { get; set; }\\n\\n    private async Task DoSomething()\\n    {\\n        var user = (awai\", \"t authenticationStateTask).User;\\n\\n        if (user.Identity.IsAuthenticated)\\n        {\\n            /\", \"/ Perform an action only available to authenticated (signed-in) users.\\n        }\\n\\n        if (user.I\", \"sInRole(\\\"admin\\\"))\\n        {\\n            // Perform an action only available to users in the 'admin' \", \"role.\\n        }\\n\\n        if ((await AuthorizationService.AuthorizeAsync(user, \\\"content-editor\\\"))\\n   \", \"         .Succeeded)\\n        {\\n            // Perform an action only available to users satisfying t\", \"he\\n            // 'content-editor' policy.\\n        }\\n    }\\n}\\n\\nThe AuthenticationState first need to \", \"be set up as a cascading value before it can be bound to a\\ncascading parameter like this. That\\u2019s typ\", \"ically done using the CascadingAuthenticationState\\ncomponent. This configuration is typically done i\", \"n App.razor:\\n\\n<CascadingAuthenticationState>\\n    <Router AppAssembly=\\\"@typeof(Program).Assembly\\\">\\n  \", \"      <Found Context=\\\"routeData\\\">\\n            <AuthorizeRouteView RouteData=\\\"@routeData\\\"\\n           \", \"     DefaultLayout=\\\"@typeof(MainLayout)\\\" />\\n        </Found>\\n        <NotFound>\\n            <LayoutV\", \"iew Layout=\\\"@typeof(MainLayout)\\\">\\n                <p>Sorry, there's nothing at this address.</p>\\n   \", \"         </LayoutView>\\n        </NotFound>\\n    </Router>\\n</CascadingAuthenticationState>\\n\\nSummary\\n\\nB\", \"lazor uses the same security model as ASP.NET Core, which is ASP.NET Core Identity. Migrating from\\nu\", \"niversal providers to ASP.NET Core Identity is relatively straightforward, assuming not too much\\ncus\", \"tomization was applied to the original data schema. Once the data has been migrated, working\\n\\n76\\n\\nCH\", \"APTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\fwith authent\", \"ication and authorization in Blazor apps is well documented, with configurable as well as\\nprogrammat\", \"ic support for most security requirements.\\n\\nReferences\\n\\n\\u2022\\n\\nIntroduction to Identity on ASP.NET Core\\n\", \"\\n\\u2022  Migrate from ASP.NET Membership authentication to ASP.NET Core 2.0 Identity\\n\\n\\u2022  Migrate Authenti\", \"cation and Identity to ASP.NET Core\\n\\n\\u2022\\n\\nASP.NET Core Blazor authentication and authorization\\n\\n77\\n\\nCH\", \"APTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor\\n\\n\\fCHAPTER  14\\n\", \"\\nMigrate from ASP.NET\\nWeb Forms to Blazor\\n\\nMigrating a code base from ASP.NET Web Forms to Blazor is\", \" a time-consuming task that requires\\nplanning. This chapter outlines the process. Something that can\", \" ease the transition is to ensure the\\napp adheres to an N-tier architecture, wherein the app model (\", \"in this case, Web Forms) is separate\\nfrom the business logic. This logical separation of layers make\", \"s it clear what needs to move to .NET\\nCore and Blazor.\\n\\nFor this example, the eShop app available on\", \" GitHub is used. eShop is a catalog service that provides\\nCRUD capabilities via form entry and valid\", \"ation.\\n\\nWhy should a working app be migrated to Blazor? Many times, there\\u2019s no need. ASP.NET Web For\", \"ms\\nwill continue to be supported for many years. However, many of the features that Blazor provides \", \"are\\nonly supported on a migrated app. Such features include:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nPerformance improvements i\", \"n the framework such as Span<T>\\n\\nAbility to run as WebAssembly\\n\\nCross-platform support for Linux and\", \" macOS\\n\\nApp-local deployment or shared framework deployment without impacting other apps\\n\\nIf these o\", \"r other new features are compelling enough, there may be value in migrating the app. The\\nmigration c\", \"an take different shapes; it can be the entire app, or only certain endpoints that require the\\nchang\", \"es. The decision to migrate is ultimately based on the business problems to be solved by the\\ndevelop\", \"er.\\n\\nServer-side versus client-side hosting\\n\\nAs described in the hosting models chapter, a Blazor ap\", \"p can be hosted in two different ways: server-\\nside and client-side. The server-side model uses ASP.\", \"NET Core SignalR connections to manage the\\nDOM updates while running any actual code on the server. \", \"The client-side model runs as\\nWebAssembly within a browser and requires no server connections. There\", \" are a number of differences\\nthat may affect which is best for a specific app:\\n\\n\\u2022\\n\\n\\u2022\\n\\n78\\n\\nRunning as\", \" WebAssembly doesn\\u2019t support all features (such as threading) at the current time\\n\\nChatty communicat\", \"ion between the client and server may cause latency issues in server-side\\nmode\\n\\nCHAPTER 14 | Migrate\", \" from ASP.NET Web Forms to Blazor\\n\\n\\f\\u2022\\n\\nAccess to databases and internal or protected services requir\", \"e a separate service with client-\\nside hosting\\n\\nAt the time of writing, the server-side model more c\", \"losely resembles Web Forms. Most of this chapter\\nfocuses on the server-side hosting model, as it\\u2019s p\", \"roduction-ready.\\n\\nCreate a new project\\n\\nThis initial migration step is to create a new project. This\", \" project type is based on the SDK style\\nprojects of .NET and simplifies much of the boilerplate that\", \" was used in previous project formats. For\\nmore detail, please see the chapter on Project Structure.\", \"\\n\\nOnce the project has been created, install the libraries that were used in the previous project. I\", \"n older\\nWeb Forms projects, you may have used the packages.config file to list the required NuGet pa\", \"ckages.\\nIn the new SDK-style project, packages.config has been replaced with <PackageReference> elem\", \"ents\\nin the project file. A benefit to this approach is that all dependencies are installed transiti\", \"vely. You only\\nlist the top-level dependencies you care about.\\n\\nMany of the dependencies you\\u2019re usin\", \"g are available for .NET, including Entity Framework 6 and\\nlog4net. If there\\u2019s no .NET or .NET Stand\", \"ard version available, the .NET Framework version can often\\nbe used. Your mileage may vary. Any API \", \"used that isn\\u2019t available in .NET causes a runtime error. Visual\\nStudio notifies you of such package\", \"s. A yellow icon appears on the project\\u2019s References node in\\nSolution Explorer.\\n\\nIn the Blazor-based\", \" eShop project, you can see the packages that are installed. Previously, the\\npackages.config file li\", \"sted every package used in the project, resulting in a file almost 50 lines long. A\\nsnippet of packa\", \"ges.config is:\\n\\n<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<packages>\\n  ...\\n  <package id=\\\"Microsoft.App\", \"licationInsights.Agent.Intercept\\\" version=\\\"2.4.0\\\"\\ntargetFramework=\\\"net472\\\" />\\n  <package id=\\\"Microso\", \"ft.ApplicationInsights.DependencyCollector\\\" version=\\\"2.9.1\\\"\\ntargetFramework=\\\"net472\\\" />\\n  <package i\", \"d=\\\"Microsoft.ApplicationInsights.PerfCounterCollector\\\" version=\\\"2.9.1\\\"\\ntargetFramework=\\\"net472\\\" />\\n \", \" <package id=\\\"Microsoft.ApplicationInsights.Web\\\" version=\\\"2.9.1\\\" targetFramework=\\\"net472\\\"\\n/>\\n  <pack\", \"age id=\\\"Microsoft.ApplicationInsights.WindowsServer\\\" version=\\\"2.9.1\\\"\\ntargetFramework=\\\"net472\\\" />\\n  <\", \"package id=\\\"Microsoft.ApplicationInsights.WindowsServer.TelemetryChannel\\\"\\nversion=\\\"2.9.1\\\" targetFram\", \"ework=\\\"net472\\\" />\\n  <package id=\\\"Microsoft.AspNet.FriendlyUrls\\\" version=\\\"1.0.2\\\" targetFramework=\\\"net\", \"472\\\" />\\n  <package id=\\\"Microsoft.AspNet.FriendlyUrls.Core\\\" version=\\\"1.0.2\\\" targetFramework=\\\"net472\\\"\\n\", \"/>\\n  <package id=\\\"Microsoft.AspNet.ScriptManager.MSAjax\\\" version=\\\"5.0.0\\\"\\ntargetFramework=\\\"net472\\\" />\", \"\\n  <package id=\\\"Microsoft.AspNet.ScriptManager.WebForms\\\" version=\\\"5.0.0\\\"\\ntargetFramework=\\\"net472\\\" />\", \"\\n  ...\\n  <package id=\\\"System.Memory\\\" version=\\\"4.5.1\\\" targetFramework=\\\"net472\\\" />\\n  <package id=\\\"Syst\", \"em.Numerics.Vectors\\\" version=\\\"4.4.0\\\" targetFramework=\\\"net472\\\" />\\n  <package id=\\\"System.Runtime.Compi\", \"lerServices.Unsafe\\\" version=\\\"4.5.0\\\"\\n\\n79\\n\\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\ftar\", \"getFramework=\\\"net472\\\" />\\n  <package id=\\\"System.Threading.Channels\\\" version=\\\"4.5.0\\\" targetFramework=\\\"\", \"net472\\\" />\\n  <package id=\\\"System.Threading.Tasks.Extensions\\\" version=\\\"4.5.1\\\" targetFramework=\\\"net472\", \"\\\"\\n/>\\n  <package id=\\\"WebGrease\\\" version=\\\"1.6.0\\\" targetFramework=\\\"net472\\\" />\\n</packages>\\n\\nThe <package\", \"s> element includes all necessary dependencies. It\\u2019s difficult to identify which of these\\npackages a\", \"re included because you require them. Some <package> elements are listed simply to\\nsatisfy the needs\", \" of dependencies you require.\\n\\nThe Blazor project lists the dependencies you require within an <Item\", \"Group> element in the project\\nfile:\\n\\n<ItemGroup>\\n    <PackageReference Include=\\\"Autofac\\\" Version=\\\"4.\", \"9.3\\\" />\\n    <PackageReference Include=\\\"EntityFramework\\\" Version=\\\"6.4.4\\\" />\\n    <PackageReference Inc\", \"lude=\\\"log4net\\\" Version=\\\"2.0.12\\\" />\\n    <PackageReference Include=\\\"Microsoft.Extensions.Logging.Log4N\", \"et.AspNetCore\\\"\\nVersion=\\\"2.2.12\\\" />\\n</ItemGroup>\\n\\nOne NuGet package that simplifies the life of Web F\", \"orms developers is the Windows Compatibility\\nPack. Although .NET is cross-platform, some features ar\", \"e only available on Windows. Windows-\\nspecific features are made available by installing the compati\", \"bility pack. Examples of such features\\ninclude the Registry, WMI, and Directory Services. The packag\", \"e adds around 20,000 APIs and activates\\nmany services with which you may already be familiar. The eS\", \"hop project doesn\\u2019t require the\\ncompatibility pack; but if your projects use Windows-specific featur\", \"es, the package eases the\\nmigration efforts.\\n\\nEnable startup process\\n\\nThe startup process for Blazor\", \" has changed from Web Forms and follows a similar setup for other\\nASP.NET Core services. When hosted\", \" server-side, Razor components are run as part of a normal\\nASP.NET Core app. When hosted in the brow\", \"ser with WebAssembly, Razor components use a similar\\nhosting model. The difference is the components\", \" are run as a separate service from any of the\\nbackend processes. Either way, the startup is similar\", \".\\n\\nThe Global.asax.cs file is the default startup page for Web Forms projects. In the eShop project,\", \" this file\\nconfigures the Inversion of Control (IoC) container and handles the various lifecycle eve\", \"nts of the app\\nor request. Some of these events are handled with middleware (such as Application_Beg\", \"inRequest).\\nOther events require the overriding of specific services via dependency injection (DI).\\n\", \"\\nBy way of example, the Global.asax.cs file for eShop, contains the following code:\\n\\npublic class Gl\", \"obal : HttpApplication, IContainerProviderAccessor\\n{\\n    private static readonly ILog _log =\\nLogMana\", \"ger.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);\\n\\n    static IContainer\", \"Provider _containerProvider;\\n    IContainer container;\\n\\n80\\n\\nCHAPTER 14 | Migrate from ASP.NET Web Fo\", \"rms to Blazor\\n\\n\\f    public IContainerProvider ContainerProvider\\n    {\\n        get { return _containe\", \"rProvider; }\\n    }\\n\\n    protected void Application_Start(object sender, EventArgs e)\\n    {\\n        /\", \"/ Code that runs on app startup\\n        RouteConfig.RegisterRoutes(RouteTable.Routes);\\n        Bundl\", \"eConfig.RegisterBundles(BundleTable.Bundles);\\n        ConfigureContainer();\\n        ConfigDataBase()\", \";\\n    }\\n\\n    /// <summary>\\n    /// Track the machine name and the start time for the session inside \", \"the current\\nsession\\n    /// </summary>\\n    protected void Session_Start(Object sender, EventArgs e)\\n\", \"    {\\n        HttpContext.Current.Session[\\\"MachineName\\\"] = Environment.MachineName;\\n        HttpCont\", \"ext.Current.Session[\\\"SessionStartTime\\\"] = DateTime.Now;\\n    }\\n\\n    /// <summary>\\n    /// https://aut\", \"ofaccn.readthedocs.io/en/latest/integration/webforms.html\\n    /// </summary>\\n    private void Config\", \"ureContainer()\\n    {\\n        var builder = new ContainerBuilder();\\n        var mockData = bool.Parse\", \"(ConfigurationManager.AppSettings[\\\"UseMockData\\\"]);\\n        builder.RegisterModule(new ApplicationMod\", \"ule(mockData));\\n        container = builder.Build();\\n        _containerProvider = new ContainerProvi\", \"der(container);\\n    }\\n\\n    private void ConfigDataBase()\\n    {\\n        var mockData = bool.Parse(Con\", \"figurationManager.AppSettings[\\\"UseMockData\\\"]);\\n\\n        if (!mockData)\\n        {\\n\\nDatabase.SetInitia\", \"lizer<CatalogDBContext>(container.Resolve<CatalogDBInitializer>());\\n        }\\n    }\\n\\n    protected v\", \"oid Application_BeginRequest(object sender, EventArgs e)\\n    {\\n        //set the property to our new\", \" object\\n        LogicalThreadContext.Properties[\\\"activityid\\\"] = new ActivityIdHelper();\\n\\n        Log\", \"icalThreadContext.Properties[\\\"requestinfo\\\"] = new WebRequestInfo();\\n\\n        _log.Debug(\\\"Application\", \"_BeginRequest\\\");\\n    }\\n}\\n\\nThe preceding file becomes the Program.cs file in server-side Blazor:\\n\\n81\\n\", \"\\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\fusing eShopOnBlazor.Models;\\nusing eShopOnBl\", \"azor.Models.Infrastructure;\\nusing eShopOnBlazor.Services;\\nusing log4net;\\nusing System.Data.Entity;\\nu\", \"sing eShopOnBlazor;\\n\\nvar builder = WebApplication.CreateBuilder(args);\\n\\n// add services\\n\\nbuilder.Ser\", \"vices.AddRazorPages();\\nbuilder.Services.AddServerSideBlazor();\\n\\nif (builder.Configuration.GetValue<b\", \"ool>(\\\"UseMockData\\\"))\\n{\\n    builder.Services.AddSingleton<ICatalogService, CatalogServiceMock>();\\n}\\ne\", \"lse\\n{\\n    builder.Services.AddScoped<ICatalogService, CatalogService>();\\n    builder.Services.AddSco\", \"ped<IDatabaseInitializer<CatalogDBContext>,\\nCatalogDBInitializer>();\\n    builder.Services.AddSinglet\", \"on<CatalogItemHiLoGenerator>();\\n    builder.Services.AddScoped(_ => new\\nCatalogDBContext(builder.Con\", \"figuration.GetConnectionString(\\\"CatalogDBContext\\\")));\\n}\\n\\nvar app = builder.Build();\\n\\nnew LoggerFacto\", \"ry().AddLog4Net(\\\"log4Net.xml\\\");\\n\\nif (app.Environment.IsDevelopment())\\n{\\n    app.UseDeveloperExceptio\", \"nPage();\\n}\\nelse\\n{\\n    app.UseExceptionHandler(\\\"/Home/Error\\\");\\n}\\n\\n// Middleware for Application_Begin\", \"Request\\napp.Use((ctx, next) =>\\n{\\n    LogicalThreadContext.Properties[\\\"activityid\\\"] = new ActivityIdH\", \"elper(ctx);\\n    LogicalThreadContext.Properties[\\\"requestinfo\\\"] = new WebRequestInfo(ctx);\\n    return\", \" next();\\n});\\n\\napp.UseStaticFiles();\\n\\napp.UseRouting();\\n\\napp.UseEndpoints(endpoints =>\\n{\\n    endpoint\", \"s.MapBlazorHub();\\n    endpoints.MapFallbackToPage(\\\"/_Host\\\");\\n});\\n\\nConfigDataBase(app);\\n\\n82\\n\\nCHAPTER \", \"14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\fvoid ConfigDataBase(IApplicationBuilder app)\\n{\\n    u\", \"sing (var scope = app.ApplicationServices.CreateScope())\\n    {\\n        var initializer =\\nscope.Servi\", \"ceProvider.GetService<IDatabaseInitializer<CatalogDBContext>>();\\n\\n        if (initializer != null)\\n \", \"       {\\n            Database.SetInitializer(initializer);\\n        }\\n    }\\n}\\n\\napp.Run();\\n\\nOne signif\", \"icant change you may notice from Web Forms is the prominence of dependency injection\\n(DI). DI has be\", \"en a guiding principle in the ASP.NET Core design. It supports customization of almost\\nall aspects o\", \"f the ASP.NET Core framework. There\\u2019s even a built-in service provider that can be used\\nfor many sce\", \"narios. If more customization is required, it can be supported by many community\\nprojects. For examp\", \"le, you can carry forward your third-party DI library investment.\\n\\nIn the original eShop app, there\\u2019\", \"s some configuration for session management. Since server-side\\nBlazor uses ASP.NET Core SignalR for \", \"communication, the session state isn\\u2019t supported as the\\nconnections may occur independent of an HTTP\", \" context. An app that uses the session state requires\\nrearchitecting before running as a Blazor app.\", \"\\n\\nFor more information about app startup, see App startup.\\n\\nMigrate HTTP modules and handlers to mid\", \"dleware\\n\\nHTTP modules and handlers are common patterns in Web Forms to control the HTTP request pipe\", \"line.\\nClasses that implement IHttpModule or IHttpHandler could be registered and process incoming\\nre\", \"quests. Web Forms configure modules and handlers in the web.config file. Web Forms is also heavily\\nb\", \"ased on app lifecycle event handling. ASP.NET Core uses middleware instead. Middleware is\\nregistered\", \" in the Configure method of the Startup class. Middleware execution order is determined by\\nthe regis\", \"tration order.\\n\\nIn the Enable startup process section, a lifecycle event was raised by Web Forms as \", \"the\\nApplication_BeginRequest method. This event isn\\u2019t available in ASP.NET Core. One way to achieve \", \"this\\nbehavior is to implement middleware as seen in the Startup.cs file example. This middleware doe\", \"s the\\nsame logic and then transfers control to the next handler in the middleware pipeline.\\n\\nFor mor\", \"e information on migrating modules and handlers, see Migrate HTTP handlers and modules to\\nASP.NET Co\", \"re middleware.\\n\\n83\\n\\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\fMigrate static files\\n\\nTo\", \" serve static files (for example, HTML, CSS, images, and JavaScript), the files must be exposed by\\nm\", \"iddleware. Calling the UseStaticFiles method enables the serving of static files from the web root\\np\", \"ath. The default web root directory is wwwroot, but it can be customized. As included in the\\nProgram\", \".cs file:\\n\\n...\\n\\napp.UseStaticFiles();\\n\\n...\\n\\nThe eShop project enables basic static file access. Ther\", \"e are many customizations available for static\\nfile access. For information on enabling default file\", \"s or a file browser, see Static files in ASP.NET Core.\\n\\nMigrate runtime bundling and minification se\", \"tup\\n\\nBundling and minification are performance optimization techniques for reducing the number and s\", \"ize\\nof server requests to retrieve certain file types. JavaScript and CSS often undergo some form of\", \"\\nbundling or minification before being sent to the client. In ASP.NET Web Forms, these optimizations\", \"\\nare handled at run time. The optimization conventions are defined an App_Start/BundleConfig.cs file\", \".\\nIn ASP.NET Core, a more declarative approach is adopted. A file lists the files to be minified, al\", \"ong\\nwith specific minification settings.\\n\\nFor more information on bundling and minification, see Bun\", \"dle and minify static assets in ASP.NET\\nCore.\\n\\nMigrate ASPX pages\\n\\nA page in a Web Forms app is a fi\", \"le with the .aspx extension. A Web Forms page can often be mapped\\nto a component in Blazor. A Razor \", \"component is authored in a file with the .razor extension. For the\\neShop project, five pages are con\", \"verted to a Razor page.\\n\\nFor example, the details view comprises three files in the Web Forms projec\", \"t: Details.aspx,\\nDetails.aspx.cs, and Details.aspx.designer.cs. When converting to Blazor, the code-\", \"behind and markup\\nare combined into Details.razor. Razor compilation (equivalent to what\\u2019s in .desig\", \"ner.cs files) is stored\\nin the obj directory and isn\\u2019t, by default, viewable in Solution Explorer. T\", \"he Web Forms page consists\\nof the following markup:\\n\\n<%@ Page Title=\\\"Details\\\" Language=\\\"C#\\\" MasterPa\", \"geFile=\\\"~/Site.Master\\\"\\nAutoEventWireup=\\\"true\\\" CodeBehind=\\\"Details.aspx.cs\\\"\\nInherits=\\\"eShopLegacyWebF\", \"orms.Catalog.Details\\\" %>\\n\\n<asp:Content ID=\\\"Details\\\" ContentPlaceHolderID=\\\"MainContent\\\" runat=\\\"server\", \"\\\">\\n    <h2 class=\\\"esh-body-title\\\">Details</h2>\\n\\n    <div class=\\\"container\\\">\\n        <div class=\\\"row\\\"\", \">\\n\\n84\\n\\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\f            <asp:Image runat=\\\"server\\\"\", \" CssClass=\\\"col-md-6 esh-picture\\\" ImageUrl='<%#\\\"/Pics/\\\"\\n+ product.PictureFileName%>' />\\n            <\", \"dl class=\\\"col-md-6 dl-horizontal\\\">\\n                <dt>Name\\n                </dt>\\n\\n                <\", \"dd>\\n                    <asp:Label runat=\\\"server\\\" Text='<%#product.Name%>' />\\n                </dd>\\n\", \"\\n                <dt>Description\\n                </dt>\\n\\n                <dd>\\n                    <as\", \"p:Label runat=\\\"server\\\" Text='<%#product.Description%>' />\\n                </dd>\\n\\n                <dt\", \">Brand\\n                </dt>\\n\\n                <dd>\\n                    <asp:Label runat=\\\"server\\\" Tex\", \"t='<%#product.CatalogBrand.Brand%>' />\\n                </dd>\\n\\n                <dt>Type\\n             \", \"   </dt>\\n\\n                <dd>\\n                    <asp:Label runat=\\\"server\\\" Text='<%#product.Catalo\", \"gType.Type%>' />\\n                </dd>\\n                <dt>Price\\n                </dt>\\n\\n            \", \"    <dd>\\n                    <asp:Label CssClass=\\\"esh-price\\\" runat=\\\"server\\\"\\nText='<%#product.Price%>\", \"' />\\n                </dd>\\n\\n                <dt>Picture name\\n                </dt>\\n\\n                \", \"<dd>\\n                    <asp:Label runat=\\\"server\\\" Text='<%#product.PictureFileName%>' />\\n          \", \"      </dd>\\n\\n                <dt>Stock\\n                </dt>\\n\\n                <dd>\\n                 \", \"   <asp:Label runat=\\\"server\\\" Text='<%#product.AvailableStock%>' />\\n                </dd>\\n\\n          \", \"      <dt>Restock\\n                </dt>\\n\\n                <dd>\\n                    <asp:Label runat=\\\"\", \"server\\\" Text='<%#product.RestockThreshold%>' />\\n                </dd>\\n\\n                <dt>Max stock\", \"\\n                </dt>\\n\\n85\\n\\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\f                \", \"<dd>\\n                    <asp:Label runat=\\\"server\\\" Text='<%#product.MaxStockThreshold%>' />\\n        \", \"        </dd>\\n\\n            </dl>\\n        </div>\\n\\n        <div class=\\\"form-actions no-color esh-link-\", \"list\\\">\\n            <a runat=\\\"server\\\" href='<%# GetRouteUrl(\\\"EditProductRoute\\\", new {id\\n=product.Id})\", \" %>' class=\\\"esh-link-item\\\">Edit\\n            </a>\\n            |\\n            <a runat=\\\"server\\\" href=\\\"~\", \"\\\" class=\\\"esh-link-item\\\">Back to list\\n            </a>\\n        </div>\\n\\n    </div>\\n</asp:Content>\\n\\nThe\", \" preceding markup\\u2019s code-behind includes the following code:\\n\\nusing eShopLegacyWebForms.Models;\\nusin\", \"g eShopLegacyWebForms.Services;\\nusing log4net;\\nusing System;\\nusing System.Web.UI;\\n\\nnamespace eShopLe\", \"gacyWebForms.Catalog\\n{\\n    public partial class Details : System.Web.UI.Page\\n    {\\n        private s\", \"tatic readonly ILog _log =\\nLogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().Decl\", \"aringType);\\n\\n        protected CatalogItem product;\\n\\n        public ICatalogService CatalogService {\", \" get; set; }\\n\\n        protected void Page_Load(object sender, EventArgs e)\\n        {\\n            var\", \" productId = Convert.ToInt32(Page.RouteData.Values[\\\"id\\\"]);\\n            _log.Info($\\\"Now loading... /C\", \"atalog/Details.aspx?id={productId}\\\");\\n            product = CatalogService.FindCatalogItem(productId\", \");\\n\\n            this.DataBind();\\n        }\\n    }\\n}\\n\\nWhen converted to Blazor, the Web Forms page tra\", \"nslates to the following code:\\n\\n@page \\\"/Catalog/Details/{id:int}\\\"\\n@inject ICatalogService CatalogSer\", \"vice\\n@inject ILogger<Details> Logger\\n\\n<h2 class=\\\"esh-body-title\\\">Details</h2>\\n\\n<div class=\\\"container\", \"\\\">\\n    <div class=\\\"row\\\">\\n\\n86\\n\\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\f        <img c\", \"lass=\\\"col-md-6 esh-picture\\\" src=\\\"@($\\\"/Pics/{_item.PictureFileName}\\\")\\\">\\n\\n        <dl class=\\\"col-md-6 \", \"dl-horizontal\\\">\\n            <dt>\\n                Name\\n            </dt>\\n\\n            <dd>\\n          \", \"      @_item.Name\\n            </dd>\\n\\n            <dt>\\n                Description\\n            </dt>\\n\", \"\\n            <dd>\\n                @_item.Description\\n            </dd>\\n\\n            <dt>\\n           \", \"     Brand\\n            </dt>\\n\\n            <dd>\\n                @_item.CatalogBrand.Brand\\n           \", \" </dd>\\n\\n            <dt>\\n                Type\\n            </dt>\\n\\n            <dd>\\n                @_\", \"item.CatalogType.Type\\n            </dd>\\n            <dt>\\n                Price\\n            </dt>\\n\\n  \", \"          <dd>\\n                @_item.Price\\n            </dd>\\n\\n            <dt>\\n                Pict\", \"ure name\\n            </dt>\\n\\n            <dd>\\n                @_item.PictureFileName\\n            </dd\", \">\\n\\n            <dt>\\n                Stock\\n            </dt>\\n\\n            <dd>\\n                @_item\", \".AvailableStock\\n            </dd>\\n\\n            <dt>\\n                Restock\\n            </dt>\\n\\n87\\n\\nC\", \"HAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\f            <dd>\\n                @_item.Resto\", \"ckThreshold\\n            </dd>\\n\\n            <dt>\\n                Max stock\\n            </dt>\\n\\n       \", \"     <dd>\\n                @_item.MaxStockThreshold\\n            </dd>\\n\\n        </dl>\\n    </div>\\n\\n    \", \"<div class=\\\"form-actions no-color esh-link-list\\\">\\n        <a href=\\\"@($\\\"/Catalog/Edit/{_item.Id}\\\")\\\" c\", \"lass=\\\"esh-link-item\\\">\\n            Edit\\n        </a>\\n        |\\n        <a href=\\\"/\\\" class=\\\"esh-link-it\", \"em\\\">\\n            Back to list\\n        </a>\\n    </div>\\n\\n</div>\\n\\n@code {\\n    private CatalogItem _item\", \";\\n\\n    [Parameter]\\n    public int Id { get; set; }\\n\\n    protected override void OnInitialized()\\n    \", \"{\\n        Logger.LogInformation(\\\"Now loading... /Catalog/Details/{Id}\\\", Id);\\n\\n        _item = Catalo\", \"gService.FindCatalogItem(Id);\\n    }\\n}\\n\\nNotice that the code and markup are in the same file. Any req\", \"uired services are made accessible with\\nthe @inject attribute. Per the @page directive, this page ca\", \"n be accessed at the Catalog/Details/{id}\\nroute. The value of the route\\u2019s {id} placeholder has been \", \"constrained to an integer. As described in the\\nrouting section, unlike Web Forms, a Razor component \", \"explicitly states its route and any parameters\\nthat are included. Many Web Forms controls may not ha\", \"ve exact counterparts in Blazor. There\\u2019s often\\nan equivalent HTML snippet that will serve the same p\", \"urpose. For example, the <asp:Label /> control\\ncan be replaced with an HTML <label> element.\\n\\nModel \", \"validation in Blazor\\n\\nIf your Web Forms code includes validation, you can transfer much of what you \", \"have with little-to-no\\nchanges. A benefit to running in Blazor is that the same validation logic can\", \" be run without needing\\ncustom JavaScript. Data annotations enable easy model validation.\\n\\n88\\n\\nCHAPT\", \"ER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\fFor example, the Create.aspx page has a data entr\", \"y form with validation. An example snippet would\\nlook like this:\\n\\n<div class=\\\"form-group\\\">\\n    <labe\", \"l class=\\\"control-label col-md-2\\\">Name</label>\\n    <div class=\\\"col-md-3\\\">\\n        <asp:TextBox ID=\\\"Na\", \"me\\\" runat=\\\"server\\\" CssClass=\\\"form-control\\\"></asp:TextBox>\\n        <asp:RequiredFieldValidator runat=\", \"\\\"server\\\" ControlToValidate=\\\"Name\\\"\\nDisplay=\\\"Dynamic\\\"\\n            CssClass=\\\"field-validation-valid tex\", \"t-danger\\\" ErrorMessage=\\\"The Name field is\\nrequired.\\\" />\\n    </div>\\n</div>\\n\\nIn Blazor, the equivalent\", \" markup is provided in a Create.razor file:\\n\\n<EditForm Model=\\\"_item\\\" OnValidSubmit=\\\"@...\\\">\\n    <Data\", \"AnnotationsValidator />\\n\\n    <div class=\\\"form-group\\\">\\n        <label class=\\\"control-label col-md-2\\\">\", \"Name</label>\\n        <div class=\\\"col-md-3\\\">\\n            <InputText class=\\\"form-control\\\" @bind-Value=\", \"\\\"_item.Name\\\" />\\n            <ValidationMessage For=\\\"(() => _item.Name)\\\" />\\n        </div>\\n    </div>\", \"\\n\\n    ...\\n</EditForm>\\n\\nThe EditForm context includes validation support and can be wrapped around an\", \" input. Data\\nannotations are a common way to add validation. Such validation support can be added vi\", \"a the\\nDataAnnotationsValidator component. For more information on this mechanism, see ASP.NET Core\\nB\", \"lazor forms and validation.\\n\\nMigrate configuration\\n\\nIn a Web Forms project, configuration data is mo\", \"st commonly stored in the web.config file. The\\nconfiguration data is accessed with ConfigurationMana\", \"ger. Services were often required to parse\\nobjects. With .NET Framework 4.7.2, composability was add\", \"ed to the configuration via\\nConfigurationBuilders. These builders allowed developers to add various \", \"sources for the configuration\\nthat was then composed at run time to retrieve the necessary values.\\n\\n\", \"ASP.NET Core introduced a flexible configuration system that allows you to define the configuration\\n\", \"source or sources used by your app and deployment. The ConfigurationBuilder infrastructure that you\\n\", \"may be using in your Web Forms app was modeled after the concepts used in the ASP.NET Core\\nconfigura\", \"tion system.\\n\\nThe following snippet demonstrates how the Web Forms eShop project uses web.config to \", \"store\\nconfiguration values:\\n\\n<configuration>\\n  <configSections>\\n    <section name=\\\"entityFramework\\\"\\n\", \"\\n89\\n\\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\ftype=\\\"System.Data.Entity.Internal.Confi\", \"gFile.EntityFrameworkSection, EntityFramework,\\nVersion=6.0.0.0, Culture=neutral, PublicKeyToken=b77a\", \"5c561934e089\\\"\\nrequirePermission=\\\"false\\\" />\\n  </configSections>\\n  <connectionStrings>\\n    <add name=\\\"\", \"CatalogDBContext\\\" connectionString=\\\"Data Source=(localdb)\\\\MSSQLLocalDB;\\nInitial Catalog=Microsoft.eS\", \"hopOnContainers.Services.CatalogDb; Integrated Security=True;\\nMultipleActiveResultSets=True;\\\" provid\", \"erName=\\\"System.Data.SqlClient\\\" />\\n  </connectionStrings>\\n  <appSettings>\\n    <add key=\\\"UseMockData\\\" \", \"value=\\\"true\\\" />\\n    <add key=\\\"UseCustomizationData\\\" value=\\\"false\\\" />\\n  </appSettings>\\n</configuratio\", \"n>\\n\\nIt\\u2019s common for secrets, such as database connection strings, to be stored within the web.config\", \". The\\nsecrets are inevitably persisted in unsecure locations, such as source control. With Blazor on\", \" ASP.NET\\nCore, the preceding XML-based configuration is replaced with the following JSON:\\n\\n{\\n  \\\"Conn\", \"ectionStrings\\\": {\\n    \\\"CatalogDBContext\\\": \\\"Data Source=(localdb)\\\\\\\\MSSQLLocalDB; Initial\\nCatalog=Micr\", \"osoft.eShopOnContainers.Services.CatalogDb; Integrated Security=True;\\nMultipleActiveResultSets=True;\", \"\\\"\\n  },\\n  \\\"UseMockData\\\": true,\\n  \\\"UseCustomizationData\\\": false\\n}\\n\\nJSON is the default configuration f\", \"ormat; however, ASP.NET Core supports many other formats,\\nincluding XML. There are also several comm\", \"unity-supported formats.\\n\\nYou can access configuration values from the builder in Program.cs:\\n\\nif (b\", \"uilder.Configuration.GetValue<bool>(\\\"UseMockData\\\"))\\n{\\n    builder.Services.AddSingleton<ICatalogServ\", \"ice, CatalogServiceMock>();\\n}\\nelse\\n{\\n    builder.Services.AddScoped<ICatalogService, CatalogService>\", \"();\\n    builder.Services.AddScoped<IDatabaseInitializer<CatalogDBContext>,\\nCatalogDBInitializer>();\\n\", \"    builder.Services.AddSingleton<CatalogItemHiLoGenerator>();\\n    builder.Services.AddScoped(_ => n\", \"ew\\nCatalogDBContext(builder.Configuration.GetConnectionString(\\\"CatalogDBContext\\\")));\\n}\\n\\nBy default, \", \"environment variables, JSON files (appsettings.json and appsettings.{Environment}.json), and\\ncommand\", \"-line options are registered as valid configuration sources in the configuration object. The\\nconfigu\", \"ration sources can be accessed via Configuration[key]. A more advanced technique is to bind\\nthe conf\", \"iguration data to objects using the options pattern. For more information on configuration\\nand the o\", \"ptions pattern, see Configuration in ASP.NET Core and Options pattern in ASP.NET Core,\\nrespectively.\", \"\\n\\n90\\n\\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\fMigrate data access\\n\\nData access is an\", \" important aspect of any app. The eShop project stores catalog information in a\\ndatabase and retriev\", \"es the data with Entity Framework (EF) 6. Since EF 6 is supported in .NET 5, the\\nproject can continu\", \"e to use it.\\n\\nThe following EF-related changes were necessary to eShop:\\n\\n\\u2022\\n\\n\\u2022\\n\\nIn .NET Framework, th\", \"e DbContext object accepts a string of the form name=ConnectionString\\nand uses the connection string\", \" from ConfigurationManager.AppSettings[ConnectionString] to\\nconnect. In .NET Core, this isn\\u2019t suppor\", \"ted. The connection string must be supplied.\\n\\nThe database was accessed in a synchronous way. Though\", \" this works, scalability may suffer.\\nThis logic should be moved to an asynchronous pattern.\\n\\nAlthoug\", \"h there isn\\u2019t the same native support for dataset binding, Blazor provides flexibility and power\\nwit\", \"h its C# support in a Razor page. For example, you can perform calculations and display the result.\\n\", \"For more information on data patterns in Blazor, see the Data access chapter.\\n\\nArchitectural changes\", \"\\n\\nFinally, there are some important architectural differences to consider when migrating to Blazor. \", \"Many\\nof these changes are applicable to anything based on .NET Core or ASP.NET Core.\\n\\nBecause Blazor\", \" is built on .NET Core, there are considerations in ensuring support on .NET Core. Some\\nof the major\", \" changes include the removal of the following features:\\n\\n\\u2022  Multiple AppDomains\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nRemoting\\n\\n\", \"Code Access Security (CAS)\\n\\nSecurity Transparency\\n\\nFor more information on techniques to identify ne\", \"cessary changes to support running on .NET Core,\\nsee Port your code from .NET Framework to .NET Core\", \".\\n\\nASP.NET Core is a reimagined version of ASP.NET and has some changes that may not initially seem\\n\", \"obvious. The main changes are:\\n\\n\\u2022\\n\\n\\u2022\\n\\n\\u2022\\n\\nNo synchronization context, which means there\\u2019s no HttpCont\", \"ext.Current,\\nThread.CurrentPrincipal, or other static accessors\\n\\nNo shadow copying\\n\\nNo request queue\", \"\\n\\nMany operations in ASP.NET Core are asynchronous, which allows easier off-loading of I/O-bound\\ntas\", \"ks. It\\u2019s important to never block by using Task.Wait() or Task.GetResult(), which can quickly exhaus\", \"t\\nthread pool resources.\\n\\n91\\n\\nCHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\n\\n\\fMigration conc\", \"lusion\\n\\nAt this point, you\\u2019ve seen many examples of what it takes to move a Web Forms project to Bla\", \"zor. For\\na full example, see the eShopOnBlazor project.\\n\\n92\\n\\nCHAPTER 14 | Migrate from ASP.NET Web F\", \"orms to Blazor\\n\\n\"]"