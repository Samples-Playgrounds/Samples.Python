"[\"EDITION v8.0 - Updated to .NET 8\\nRefer to changelog for the book updates and community contributions\", \".\\nPUBLISHED BY\\nMicrosoft Developer Division, .NET, and Visual Studio product teams\\nA division of Mic\", \"rosoft Corporation\\nOne Microsoft Way\\nRedmond, Washington 98052-6399\\nCopyright \\u00a9 2023 by Microsoft Co\", \"rporation\\nAll rights reserved. No part of the contents of this book may be reproduced or transmitted\", \" in any\\nform or by any means without the written permission of the publisher.\\nThis book is provided \", \"\\u201cas-is\\u201d and expresses the author\\u2019s views and opinions. The views, opinions, and\\ninformation expresse\", \"d in this book, including URL and other Internet website references, may change\\nwithout notice.\\nSome\", \" examples depicted herein are provided for illustration only and are fictitious. No real association\", \"\\nor connection is intended or should be inferred.\\nMicrosoft and the trademarks listed at https://www\", \".microsoft.com on the \\u201cTrademarks\\u201d webpage are\\ntrademarks of the Microsoft group of companies.\\nMac a\", \"nd macOS are trademarks of Apple Inc.\\nAll other marks and logos are property of their respective own\", \"ers.\\nAuthors:\\nDaniel Roth, Principal Program Manager, Microsoft Corp.\\nJeff Fritz, Senior Program Man\", \"ager, Microsoft Corp.\\nTaylor Southwick, Senior Software Engineer, Microsoft Corp.\\nScott Addie, Senio\", \"r Content Developer, Microsoft Corp.\\nSteve \\u201c@ardalis\\u201d Smith, Software Architect and Trainer, NimbleP\", \"ros.com\\nIntroduction\\n.NET has long supported web app development through ASP.NET, a comprehensive se\", \"t of frameworks\\nand tools for building any kind of web app. ASP.NET has its own lineage of web frame\", \"works and\\ntechnologies starting all the way back with classic Active Server Pages (ASP). Frameworks \", \"like ASP.NET\\nWeb Forms, ASP.NET MVC, ASP.NET Web Pages, and more recently ASP.NET Core, provide a\\npr\", \"oductive and powerful way to build server-rendered web apps, where UI content is dynamically\\ngenerat\", \"ed on the server in response to HTTP requests. Each ASP.NET framework caters to a different\\naudience\", \" and app building philosophy. ASP.NET Web Forms shipped with the original release of the\\n.NET Framew\", \"ork and enabled web development using many of the patterns familiar to desktopdevelopers, like reusa\", \"ble UI controls with simple event handling. However, none of the ASP.NET\\nofferings provide a way to \", \"run code that executed in the user\\u2019s browser. To do that requires writing\\nJavaScript and using any o\", \"f the many JavaScript frameworks and tools that have phased in and out of\\npopularity over the years:\", \" jQuery, Knockout, Angular, React, and so on.\\nBlazor is a new web framework that changes what is pos\", \"sible when building web apps with .NET.\\nBlazor is a client-side web UI framework based on C# instead\", \" of JavaScript. With Blazor you can write\\nyour client-side logic and UI components in C#, compile th\", \"em into normal .NET assemblies, and then\\nrun them directly in the browser using a new open web stand\", \"ard called WebAssembly. Or\\nalternatively, Blazor can run your .NET UI components on the server and h\", \"andle all UI interactions\\nfluidly over a real-time connection with the browser. When paired with .NE\", \"T running on the server,\\nBlazor enables full-stack web development with .NET. While Blazor shares ma\", \"ny commonalities with\\nASP.NET Web Forms, like having a reusable component model and a simple way to \", \"handle user\\nevents, it also builds on the foundations of .NET to provide a modern and high-performan\", \"ce web\\ndevelopment experience.\\nThis book introduces ASP.NET Web Forms developers to Blazor in a way \", \"that is familiar and\\nconvenient. It introduces Blazor concepts in parallel with analogous concepts i\", \"n ASP.NET Web Forms\\nwhile also explaining new concepts that may be less familiar. It covers a broad \", \"range of topics and\\nconcerns including component authoring, routing, layout, configuration, and secu\", \"rity. And while the\\ncontent of this book is primarily for enabling new development, it also covers g\", \"uidelines and\\nstrategies for migrating existing ASP.NET Web Forms to Blazor for when you want to mod\", \"ernize an\\nexisting app.\\nWho should use the book\\nThis book is for ASP.NET Web Forms developers lookin\", \"g for an introduction to Blazor that relates to\\ntheir existing knowledge and skills. This book can h\", \"elp with quickly getting started on a new Blazor-\\nbased project or to help chart a roadmap for moder\", \"nizing an existing ASP.NET Web Forms\\napplication.\\nHow to use the book\\nThe first part of this book co\", \"vers what Blazor is and compares it to web app development with\\nASP.NET Web Forms. The book then cov\", \"ers a variety of Blazor topics, chapter by chapter, and relates\\neach Blazor concept to the correspon\", \"ding concept in ASP.NET Web Forms, or explains fully any\\ncompletely new concepts. The book also refe\", \"rs regularly to a complete sample app implemented in\\nboth ASP.NET Web Forms and Blazor to demonstrat\", \"e Blazor features and to provide a case study for\\nmigrating from ASP.NET Web Forms to Blazor. You ca\", \"n find both implementations of the sample app\\n(ASP.NET Web Forms and Blazor versions) on GitHub.\\nWha\", \"t this book doesn\\u2019t cover\\nThis book is an introduction to Blazor, not a comprehensive migration guid\", \"e. While it does include\\nguidance on how to approach migrating a project from ASP.NET Web Forms to B\", \"lazor, it does notattempt to cover every nuance and detail. For more general guidance on migrating f\", \"rom ASP.NET to\\nASP.NET Core, refer to the migration guidance in the ASP.NET Core documentation.\\nAddi\", \"tional resources\\nYou can find the official Blazor home page and documentation at https://blazor.net.\", \"Contents\\nAn introduction to Blazor for ASP.NET Web Forms developers ................................\", \"........ 1\\nAn open-source and cross-platform .NET ..................................................\", \"................................................................... 2\\nClient-side web development ..\", \"....................................................................................................\", \"....................................... 3\\nWebAssembly fulfills a need ..............................\", \"....................................................................................................\", \"............. 3\\nBlazor: full-stack web development with .NET .......................................\", \"...................................................................... 4\\nGet started with Blazor ...\", \"....................................................................................................\", \"................................................... 4\\nArchitecture comparison of ASP.NET Web Forms a\", \"nd Blazor ............................................ 5\\nASP.NET Web Forms .........................\", \"....................................................................................................\", \".................................. 5\\nBlazor ........................................................\", \"....................................................................................................\", \"................................ 6\\nBlazor app hosting models .......................................\", \".............................................................. 8\\nBlazor WebAssembly apps ...........\", \"....................................................................................................\", \".................................... 8\\nBlazor Server apps ..........................................\", \"....................................................................................................\", \"..................... 9\\nHow to choose the right Blazor hosting model ...............................\", \"........................................................................ 10\\nDeploy your app ........\", \"....................................................................................................\", \"........................................................ 11\\nProject structure for Blazor apps ......\", \"................................................................................... 12\\nProject file \", \"....................................................................................................\", \"............................................................................ 12\\nEntry point ........\", \"....................................................................................................\", \"................................................................... 13\\nStatic files ................\", \"....................................................................................................\", \"............................................................. 15\\nConfiguration......................\", \"....................................................................................................\", \"................................................ 15\\nRazor components ...............................\", \"....................................................................................................\", \"............................ 15\\nPages ..............................................................\", \"....................................................................................................\", \"........................ 16\\nLayout .................................................................\", \"....................................................................................................\", \"................... 16\\nBootstrap Blazor ............................................................\", \"....................................................................................................\", \".... 16\\nBuild output ...............................................................................\", \"............................................................................................. 18\\nRun\", \" the app with Hot Reload............................................................................\", \"............................................................... 18\\nApp startup .....................\", \"....................................................................................................\", \"... 21\\nApplication_Start and Web Forms .............................................................\", \".................................................................... 21\\nBlazor Server Startup Struct\", \"ure ................................................................................................\", \"....................................... 21\\ni ContentsUpgrading the BundleConfig Process ............\", \"....................................................................................................\", \".......... 23\\nBuild reusable UI components with Blazor..............................................\", \"........................... 24\\nAn introduction to Razor ............................................\", \"....................................................................................................\", \"... 24\\nUse components ..............................................................................\", \"..................................................................................... 28\\nModify page\", \" title from components .............................................................................\", \"................................................ 28\\nComponent parameters ...........................\", \"....................................................................................................\", \"...................... 29\\nQuery string parameters ..................................................\", \"............................................................................................. 29\\nCom\", \"ponents and error boundaries .......................................................................\", \"........................................................ 30\\nEvent handlers .........................\", \"....................................................................................................\", \"........................................... 30\\nData binding ........................................\", \"....................................................................................................\", \"............................... 32\\nState changes ...................................................\", \"....................................................................................................\", \".................. 33\\nComponent lifecycle ..........................................................\", \".................................................................................................. 3\", \"4\\nOnInitialized ....................................................................................\", \"................................................................................... 34\\nOnParametersS\", \"et .................................................................................................\", \"............................................................ 35\\nOnAfterRender ......................\", \"....................................................................................................\", \"........................................ 35\\nIDisposable ............................................\", \"....................................................................................................\", \"......................... 35\\nCapture component references ..........................................\", \"............................................................................................ 36\\nCapt\", \"ure element references .............................................................................\", \"................................................................ 36\\nTemplated components ...........\", \"....................................................................................................\", \"...................................... 36\\nChild content.............................................\", \"....................................................................................................\", \"..................... 37\\nTemplate parameters .......................................................\", \"............................................................................................... 37\\nC\", \"ode-behind .........................................................................................\", \".................................................................................. 38\\nAdditional res\", \"ources .............................................................................................\", \"............................................................... 39\\nPages, routing, and layouts .....\", \"............................................................................................. 40\\nCre\", \"ate pages ..........................................................................................\", \"................................................................................. 41\\nRouter componen\", \"t ..................................................................................................\", \"............................................................. 42\\nNavigation ........................\", \"....................................................................................................\", \"................................................... 42\\nBase URLs ...................................\", \"....................................................................................................\", \".......................................... 43\\nPage layout ..........................................\", \"....................................................................................................\", \"................................ 43\\nState management ...............................................\", \"................................................................. 46\\nRequest state management with V\", \"iewState ...........................................................................................\", \"................... 46\\nii ContentsMaintain state with Session ......................................\", \"....................................................................................................\", \".... 47\\nApplication state ..........................................................................\", \"......................................................................................... 47\\nIn the \", \"browser ............................................................................................\", \"............................................................................ 48\\nForms and validation\", \" ...................................................................................................\", \"......... 49\\nAdditional resources ..................................................................\", \".......................................................................................... 51\\nWork w\", \"ith data ...........................................................................................\", \"........................... 52\\nEntity Framework ....................................................\", \"....................................................................................................\", \".......... 52\\nEF Code First.........................................................................\", \".............................................................................................. 53\\nEF\", \" Database First ....................................................................................\", \".......................................................................... 54\\nInteract with web serv\", \"ices ...............................................................................................\", \".................................................. 54\\nModules, handlers, and middleware ............\", \"....................................................................... 56\\nOverview ................\", \"....................................................................................................\", \"............................................................... 56\\nKatana ..........................\", \"....................................................................................................\", \".......................................................... 57\\nCommon middleware ....................\", \"....................................................................................................\", \".................................. 57\\nCustom middleware ............................................\", \"....................................................................................................\", \"............. 58\\nApp configuration .................................................................\", \"................................................ 60\\nConfiguration sources ..........................\", \"....................................................................................................\", \"........................... 60\\nappsettings.json format and access ..................................\", \"............................................................................................ 61\\nUser\", \" secrets ...........................................................................................\", \".................................................................................. 61\\nEnvironment va\", \"riables ............................................................................................\", \"............................................................. 61\\nCommand-line arguments ............\", \"....................................................................................................\", \"................................ 62\\nThe return of web.config .......................................\", \"....................................................................................................\", \"........ 62\\nRead configuration in the app ..........................................................\", \"............................................................................... 63\\nStrongly typed co\", \"nfiguration ........................................................................................\", \"................................................... 63\\nSecurity: Authentication and Authorization in\", \" ASP.NET Web Forms and Blazor ........... 65\\nASP.NET universal providers ...........................\", \"....................................................................................................\", \".............. 65\\nAuthorization configuration in Web Forms .........................................\", \".................................................................. 66\\nAuthorization code in Web Form\", \"s ..................................................................................................\", \".......................... 67\\nASP.NET Core Identity ................................................\", \"....................................................................................................\", \"..... 68\\nRoles, claims, and policies ...............................................................\", \"............................................................................. 68\\nMigration guide ...\", \"....................................................................................................\", \"......................................................... 70\\niii ContentsCreating the ASP.NET Core I\", \"dentity schema .....................................................................................\", \".................... 70\\nMigrating data from universal providers to ASP.NET Core Identity ...........\", \"................................................. 73\\nMigrating security settings from web.config to \", \"app startup .......................................................................... 74\\nUpdating i\", \"ndividual pages to use ASP.NET Core Identity abstractions ..........................................\", \"........... 75\\nSummary .............................................................................\", \"....................................................................................................\", \". 76\\nReferences ....................................................................................\", \"........................................................................................... 77\\nMigra\", \"te from ASP.NET Web Forms to Blazor ................................................................\", \"..... 78\\nServer-side versus client-side hosting ....................................................\", \"...................................................................... 78\\nCreate a new project......\", \"....................................................................................................\", \".................................................. 79\\nEnable startup process .......................\", \"....................................................................................................\", \"............................. 80\\nMigrate HTTP modules and handlers to middleware ...................\", \"......................................................................... 83\\nMigrate static files ..\", \"....................................................................................................\", \".......................................................... 84\\nMigrate runtime bundling and minificat\", \"ion setup ..........................................................................................\", \"........ 84\\nMigrate ASPX pages .....................................................................\", \"....................................................................................... 84\\nModel val\", \"idation in Blazor ..................................................................................\", \".......................................................... 88\\nMigrate configuration ................\", \"....................................................................................................\", \"..................................... 89\\nMigrate data access .......................................\", \"....................................................................................................\", \".................. 91\\nArchitectural changes ........................................................\", \".................................................................................................. 9\", \"1\\nMigration conclusion .............................................................................\", \".............................................................................. 92\\niv Contents1\\nCHAPT\", \"ER\\nAn introduction to Blazor\\nfor ASP.NET Web Forms\\ndevelopers\\nThe ASP.NET Web Forms framework has be\", \"en a staple of .NET web development since the .NET\\nFramework first shipped in 2002. Back when the We\", \"b was still largely in its infancy, ASP.NET Web\\nForms made building web apps simple and productive b\", \"y adopting many of the patterns that were\\nused for desktop development. In ASP.NET Web Forms, web pa\", \"ges can be quickly composed from\\nreusable UI controls. User interactions are handled naturally as ev\", \"ents. There\\u2019s a rich ecosystem of\\nWeb Forms UI controls provided by Microsoft and control vendors. T\", \"he controls ease the efforts of\\nconnecting to data sources and displaying rich data visualizations. \", \"For the visually inclined, the Web\\nForms designer provides a simple drag-and-drop interface for mana\", \"ging controls.\\nOver the years, Microsoft has introduced new ASP.NET-based web frameworks to address \", \"web\\ndevelopment trends. Some such web frameworks include ASP.NET MVC, ASP.NET Web Pages, and\\nmore re\", \"cently ASP.NET Core. With each new framework, some have predicted the imminent decline of\\nASP.NET We\", \"b Forms and criticized it as an outdated, outmoded web framework. Despite these\\npredictions, many .N\", \"ET web developers continue to find ASP.NET Web Forms a simple, stable, and\\nproductive way to get the\", \"ir work done.\\nAt the time of writing, almost half a million web developers use ASP.NET Web Forms eve\", \"ry month. The\\nASP.NET Web Forms framework is stable to the point that docs, samples, books, and blog\", \" posts from\\na decade ago remain useful and relevant. For many .NET web developers, \\u201cASP.NET\\u201d is stil\", \"l\\nsynonymous with \\u201cASP.NET Web Forms\\u201d as it was when .NET was first conceived. Arguments on the\\npros\", \" and cons of ASP.NET Web Forms compared to the other new .NET web frameworks may rage on.\\nASP.NET We\", \"b Forms remains a popular framework for creating web apps.\\nEven so, innovations in software developm\", \"ent aren\\u2019t slowing. All software developers need to stay\\nabreast of new technologies and trends. Two\", \" trends in particular are worth considering:\\n1. The shift to open-source and cross-platform\\n2. The s\", \"hift of app logic to the client\\n1 CHAPTER 1 | An introduction to Blazor for ASP.NET Web Forms develo\", \"persAn open-source and cross-platform .NET\\nWhen .NET and ASP.NET Web Forms first shipped, the platfo\", \"rm ecosystem looked much different than\\nit does today. The desktop and server markets were dominated\", \" by Windows. Alternative platforms like\\nmacOS and Linux were still struggling to gain traction. ASP.\", \"NET Web Forms ships with the .NET\\nFramework as a Windows-only component, which means ASP.NET Web For\", \"ms apps can only run on\\nWindows Server machines. Many modern environments now use different kinds of\", \" platforms for\\nservers and development machines such that cross-platform support for many users is a\", \"n absolute\\nrequirement.\\nMost modern web frameworks are now also open-source, which has a number of b\", \"enefits. Users\\naren\\u2019t beheld to a single project owner to fix bugs and add features. Open-source pro\", \"jects provide\\nimproved transparency on development progress and upcoming changes. Open-source projec\", \"ts enjoy\\ncontributions from an entire community, and they foster a supportive open-source ecosystem.\", \"\\nDespite the risks of open-source, many consumers and contributors have found suitable mitigations\\nt\", \"hat enable them to enjoy the benefits of an open-source ecosystem in a safe and reasonable way.\\nExam\", \"ples of such mitigations include contributor license agreements, friendly licenses, pedigree scans,\\n\", \"and supporting foundations.\\nThe .NET community has embraced both cross-platform support and open-sou\", \"rce. .NET Core is an\\nopen-source and cross-platform implementation of .NET that runs on a plethora o\", \"f platforms,\\nincluding Windows, macOS, and various Linux distributions. Xamarin provides Mono, an op\", \"en-source\\nversion of .NET. Mono runs on Android, iOS, and a variety of other form factors, including\", \" watches\\nand smart TVs. In 2020, Microsoft released .NET 5 that reconciled .NET Core and Mono into \\u201c\", \"a single\\n.NET runtime and framework that can be used everywhere and that has uniform runtime behavio\", \"rs\\nand developer experiences.\\u201d\\nWill ASP.NET Web Forms benefit from the move to open-source and cross\", \"-platform support? The\\nanswer, unfortunately, is no, or at least not to the same extent as the rest \", \"of the platform. The .NET\\nteam made it clear that ASP.NET Web Forms won\\u2019t be ported to .NET Core or \", \".NET 8. Why is that?\\nThere were efforts in the early days of .NET Core to port ASP.NET Web Forms. Th\", \"e number of breaking\\nchanges required were found to be too drastic. There\\u2019s also an admission here t\", \"hat even for Microsoft,\\nthere\\u2019s a limit to the number of web frameworks that it can support simultan\", \"eously. Perhaps someone\\nin the community will take up the cause of creating an open-source and cross\", \"-platform version of\\nASP.NET Web Forms. The source code for ASP.NET Web Forms has been made availabl\", \"e publicly in\\nreference form. But for the time being, it seems ASP.NET Web Forms will remain Windows\", \"-only and\\nwithout an open-source contribution model. If cross-platform support or open-source become\", \"\\nimportant for your scenarios, then you\\u2019ll need to look for something new.\\nDoes this mean ASP.NET We\", \"b Forms is dead and should no longer be used? Of course not! As long as\\nthe .NET Framework ships as \", \"part of Windows, ASP.NET Web Forms will be a supported framework.\\nFor many Web Forms developers, the\", \" lack of cross-platform and open-source support is a non-issue.\\nIf you don\\u2019t have a requirement for \", \"cross-platform support, open-source, or any of the other new\\nfeatures in .NET Core or .NET 8, then s\", \"ticking with ASP.NET Web Forms on Windows is fine. ASP.NET\\nWeb Forms will continue to be a productiv\", \"e way to write web apps for many years to come.\\nBut there\\u2019s another trend worth considering, and tha\", \"t\\u2019s the shift to the client.\\n2 CHAPTER 1 | An introduction to Blazor for ASP.NET Web Forms developer\", \"sClient-side web development\\nAll of the .NET-based web frameworks, including ASP.NET Web Forms, have\", \" historically had one thing\\nin common: they\\u2019re server-rendered. In server-rendered web apps, the bro\", \"wser makes a request to the\\nserver, which executes some code (.NET code in ASP.NET apps) to produce \", \"a response. That response\\nis sent back to the browser to handle. In this model, the browser is used \", \"as a thin rendering engine.\\nThe hard work of producing the UI, running the business logic, and manag\", \"ing state occurs on the\\nserver.\\nHowever, browsers have become versatile platforms. They implement an\", \" ever-increasing number of\\nopen web standards that grant access to the capabilities of the user\\u2019s ma\", \"chine. Why not take\\nadvantage of the compute power, storage, memory, and other resources of the clie\", \"nt device? UI\\ninteractions in particular can benefit from a richer and more interactive feel when ha\", \"ndled at least\\npartially or completely client-side. Logic and data that should be handled on the ser\", \"ver can still be\\nhandled server-side. Web API calls or even real-time protocols, like WebSockets, ca\", \"n be used. These\\nbenefits are available to web developers for free if they\\u2019re willing to write JavaS\", \"cript. Client-side UI\\nframeworks, such as Angular, React, and Vue, simplify client-side web developm\", \"ent and have grown in\\npopularity. ASP.NET Web Forms developers can also benefit from leveraging the \", \"client, and even have\\nsome out-of-the-box support with integrated JavaScript frameworks like ASP.NET\", \" AJAX.\\nBut bridging two different platforms and ecosystems (.NET and JavaScript) comes with a cost.\\n\", \"Expertise is required in two parallel worlds with different languages, frameworks, and tools. Code a\", \"nd\\nlogic can\\u2019t be easily shared between client and server, resulting in duplication and engineering\\n\", \"overhead. It can also be difficult to keep up with the JavaScript ecosystem, which has a history of\\n\", \"evolving at breakneck speed. Front-end framework and build tool preferences change quickly. The\\nindu\", \"stry has observed the progression from Grunt to Gulp to Webpack, and so on. The same restless\\nchurn \", \"has occurred with front-end frameworks such as jQuery, Knockout, Angular, React, and Vue. But\\ngiven \", \"JavaScript\\u2019s browser monopoly, there was little choice in the matter. That is, until the web\\ncommuni\", \"ty got together and caused a miracle to happen!\\nWebAssembly fulfills a need\\nIn 2015, the major brows\", \"er vendors joined forces in a W3C Community Group to create a new open\\nweb standard called WebAssemb\", \"ly. WebAssembly is a byte code for the Web. If you can compile your\\ncode to WebAssembly, it can then\", \" run on any browser on any platform at near native speed. Initial\\nefforts focused on C/C++. The resu\", \"lt was a dramatic demonstration of running native 3D graphics\\nengines directly in the browser withou\", \"t plugins. WebAssembly has since been standardized and\\nimplemented by all major browsers.\\nWork on ru\", \"nning .NET on WebAssembly was announced in late 2017 and released in 2020, including\\nsupport in .NET\", \" 5 and beyond. The ability to run .NET code directly in the browser enables full-stack\\nweb developme\", \"nt with .NET.\\n3 CHAPTER 1 | An introduction to Blazor for ASP.NET Web Forms developersBlazor: full-s\", \"tack web development with .NET\\nOn its own, the ability to run .NET code in a browser doesn\\u2019t provide\", \" an end-to-end experience for\\ncreating client-side web apps. That\\u2019s where Blazor comes in. Blazor is\", \" a client-side web UI framework\\nbased on C# instead of JavaScript. Blazor can run directly in the br\", \"owser via WebAssembly. No\\nbrowser plugins are required. Alternatively, Blazor apps can run server-si\", \"de on .NET and handle all\\nuser interactions over a real-time connection with the browser.\\nBlazor has\", \" great tooling support in Visual Studio and Visual Studio Code. The framework also includes\\na full U\", \"I component model and has built-in facilities for:\\n\\u2022 Forms and validation\\n\\u2022 Dependency injection\\n\\u2022 C\", \"lient-side routing\\n\\u2022 Layouts\\n\\u2022 In-browser debugging\\n\\u2022 JavaScript interop\\nBlazor has a lot in common \", \"with ASP.NET Web Forms. Both frameworks offer component-based,\\nevent-driven, stateful UI programming\", \" models. The main architectural difference is that ASP.NET Web\\nForms runs only on the server. Blazor\", \" can run on the client in the browser. But if you\\u2019re coming from\\nan ASP.NET Web Forms background, th\", \"ere\\u2019s a lot in Blazor that will feel familiar. Blazor is a natural\\nsolution for ASP.NET Web Forms de\", \"velopers looking for a way to take advantage of client-side\\ndevelopment and the open-source, cross-p\", \"latform future of .NET.\\nThis book provides an introduction to Blazor that is catered specifically to\", \" ASP.NET Web Forms\\ndevelopers. Each Blazor concept is presented in the context of analogous ASP.NET \", \"Web Forms\\nfeatures and practices. By the end of this book, you\\u2019ll have an understanding of:\\n\\u2022 How to\", \" build Blazor apps.\\n\\u2022 How Blazor works.\\n\\u2022 How Blazor relates to .NET.\\n\\u2022 Reasonable strategies for mi\", \"grating existing ASP.NET Web Forms apps to Blazor where\\nappropriate.\\nGet started with Blazor\\nGetting\", \" started with Blazor is easy. Go to https://blazor.net and follow the links to install the\\nappropria\", \"te .NET SDK and Blazor project templates. You\\u2019ll also find instructions for setting up the\\nBlazor to\", \"oling in Visual Studio or Visual Studio Code.\\n4 CHAPTER 1 | An introduction to Blazor for ASP.NET We\", \"b Forms developers2\\nCHAPTER\\nArchitecture comparison\\nof ASP.NET Web Forms\\nand Blazor\\nWhile ASP.NET We\", \"b Forms and Blazor have many similar concepts, there are differences in how they\\nwork. This chapter \", \"examines the inner workings and architectures of ASP.NET Web Forms and Blazor.\\nASP.NET Web Forms\\nThe\", \" ASP.NET Web Forms framework is based on a page-centric architecture. Each HTTP request for a\\nlocati\", \"on in the app is a separate page with which ASP.NET responds. As pages are requested, the\\ncontents o\", \"f the browser are replaced with the results of the page requested.\\nPages consist of the following co\", \"mponents:\\n\\u2022 HTML markup\\n\\u2022 C# or Visual Basic code\\n\\u2022 A code-behind class containing logic and event-h\", \"andling capabilities\\n\\u2022 Controls\\nControls are reusable units of web UI that can be programmatically p\", \"laced and interacted with on a\\npage. Pages are composed of files that end with .aspx containing mark\", \"up, controls, and some code.\\nThe code-behind classes are in files with the same base name and an .as\", \"px.cs or .aspx.vb extension,\\ndepending on the programming language used. Interestingly, the web serv\", \"er interprets contents of\\nthe .aspx files and compiles them whenever they change. This recompilation\", \" occurs even if the web\\nserver is already running.\\nControls can be built with markup and delivered a\", \"s user controls. A user control derives from the\\nUserControl class and has a similar structure to th\", \"e Page. Markup for user controls is stored in an .ascx\\nfile. An accompanying code-behind class resid\", \"es in an .ascx.cs or .ascx.vb file. Controls can also be\\nbuilt completely with code, by inheriting f\", \"rom either the WebControl or CompositeControl base class.\\nPages also have an extensive event lifecyc\", \"le. Each page raises events for the initialization, load,\\nprerender, and unload events that occur as\", \" the ASP.NET runtime executes the page\\u2019s code for each\\nrequest.\\n5 CHAPTER 2 | Architecture compariso\", \"n of ASP.NET Web Forms and BlazorControls on a Page typically post-back to the same page that presen\", \"ted the control, and carry along\\nwith them a payload from a hidden form field called ViewState. The \", \"ViewState field contains\\ninformation about the state of the controls at the time they were rendered \", \"and presented on the\\npage, allowing the ASP.NET runtime to compare and identify changes in the conte\", \"nt submitted to the\\nserver.\\nBlazor\\nBlazor is a client-side web UI framework similar in nature to Jav\", \"aScript front-end frameworks like\\nAngular or React. Blazor handles user interactions and renders the\", \" necessary UI updates. Blazor isn\\u2019t\\nbased on a request-reply model. User interactions are handled as\", \" events that aren\\u2019t in the context of\\nany particular HTTP request.\\nBlazor apps consist of one or mor\", \"e root components that are rendered on an HTML page.\\nHow the user specifies where components should \", \"render and how the components are then wired up\\nfor user interactions is hosting model specific.\\nBla\", \"zor components are .NET classes that represent a reusable piece of UI. Each component maintains\\nits \", \"own state and specifies its own rendering logic, which can include rendering other components.\\nCompo\", \"nents specify event handlers for specific user interactions to update the component\\u2019s state.\\nAfter a\", \" component handles an event, Blazor renders the component and keeps track of what changed\\nin the ren\", \"dered output. Components don\\u2019t render directly to the Document Object Model (DOM).\\nThey instead rend\", \"er to an in-memory representation of the DOM called a RenderTree so that Blazor\\ncan track the change\", \"s. Blazor compares the newly rendered output with the previous output to\\ncalculate a UI diff that it\", \" then applies efficiently to the DOM.\\n6 CHAPTER 2 | Architecture comparison of ASP.NET Web Forms and\", \" BlazorComponents can also manually indicate that they should be rendered if their state changes out\", \"side of\\na normal UI event. Blazor uses a SynchronizationContext to enforce a single logical thread o\", \"f\\nexecution. A component\\u2019s lifecycle methods and any event callbacks that are raised by Blazor are\\ne\", \"xecuted on this SynchronizationContext.\\n7 CHAPTER 2 | Architecture comparison of ASP.NET Web Forms a\", \"nd Blazor3\\nCHAPTER\\nBlazor app hosting models\\nBlazor apps can be hosted in one of the following ways:\", \"\\n\\u2022 Client-side in the browser on WebAssembly.\\n\\u2022 Server-side in an ASP.NET Core app.\\nBlazor WebAssemb\", \"ly apps\\nBlazor WebAssembly apps execute directly in the browser on a WebAssembly-based .NET runtime.\", \"\\nBlazor WebAssembly apps function in a similar way to front-end JavaScript frameworks like Angular o\", \"r\\nReact. However, instead of writing JavaScript you write C#. The .NET runtime is downloaded with th\", \"e\\napp along with the app assembly and any required dependencies. No browser plugins or extensions\\nar\", \"e required.\\nThe downloaded assemblies are normal .NET assemblies, like you would use in any other .N\", \"ET app.\\nBecause the runtime supports .NET Standard, you can use existing .NET Standard libraries wit\", \"h your\\nBlazor WebAssembly app. However, these assemblies will still execute in the browser security\\n\", \"sandbox. Some functionality may throw a PlatformNotSupportedException, like trying to access the\\nfil\", \"e system or opening arbitrary network connections.\\nWhen the app loads, the .NET runtime is started a\", \"nd pointed at the app assembly. The app startup\\nlogic runs, and the root components are rendered. Bl\", \"azor calculates the UI updates based on the\\nrendered output from the components. The DOM updates are\", \" then applied.\\n8 CHAPTER 3 | Blazor app hosting modelsBlazor WebAssembly apps run purely client-side\", \". Such apps can be deployed to static site hosting\\nsolutions like GitHub Pages or Azure Static Websi\", \"te Hosting. .NET isn\\u2019t required on the server at all.\\nDeep linking to parts of the app typically req\", \"uires a routing solution on the server. The routing\\nsolution redirects requests to the root of the a\", \"pp. For example, this redirection can be handled using\\nURL rewrite rules in IIS.\\nTo get all the bene\", \"fits of Blazor and full-stack .NET web development, host your Blazor WebAssembly\\napp with ASP.NET Co\", \"re. By using .NET on both the client and server, you can easily share code and\\nbuild your app using \", \"one consistent set of languages, frameworks, and tools. Blazor provides\\nconvenient templates for set\", \"ting up a solution that contains both a Blazor WebAssembly app and an\\nASP.NET Core host project. Whe\", \"n the solution is built, the built static files from the Blazor app are\\nhosted by the ASP.NET Core a\", \"pp with fallback routing already setup.\\nBlazor Server apps\\nRecall from the Blazor architecture discu\", \"ssion that Blazor components render their output to an\\nintermediate abstraction called a RenderTree.\", \" The Blazor framework then compares what was\\nrendered with what was previously rendered. The differe\", \"nces are applied to the DOM. Blazor\\ncomponents are decoupled from how their rendered output is appli\", \"ed. Consequently, the\\ncomponents themselves don\\u2019t have to run in the same process as the process upd\", \"ating the UI. In fact,\\nthey don\\u2019t even have to run on the same machine.\\nIn Blazor Server apps, the c\", \"omponents run on the server instead of client-side in the browser. UI\\nevents that occur in the brows\", \"er are sent to the server over a real-time connection. The events are\\ndispatched to the correct comp\", \"onent instances. The components render, and the calculated UI diff is\\nserialized and sent to the bro\", \"wser where it\\u2019s applied to the DOM.\\n9 CHAPTER 3 | Blazor app hosting modelsThe Blazor Server hosting\", \" model may sound familiar if you\\u2019ve used ASP.NET AJAX and the\\nUpdatePanel control. The UpdatePanel c\", \"ontrol handles applying partial page updates in response to\\ntrigger events on the page. When trigger\", \"ed, the UpdatePanel requests a partial update and then\\napplies it without needing to refresh the pag\", \"e. The state of the UI is managed using ViewState. Blazor\\nServer apps are slightly different in that\", \" the app requires an active connection with the client.\\nAdditionally, all UI state is maintained on \", \"the server. Aside from those differences, the two models are\\nconceptually similar.\\nHow to choose the\", \" right Blazor hosting model\\nAs described in the Blazor hosting model docs, the different Blazor host\", \"ing models have different\\ntradeoffs.\\nThe Blazor WebAssembly hosting model has the following benefits\", \":\\n\\u2022 There\\u2019s no .NET server-side dependency. The app is fully functioning after downloaded to the\\ncli\", \"ent.\\n\\u2022 Client resources and capabilities are fully leveraged.\\n\\u2022 Work is offloaded from the server to\", \" the client.\\n\\u2022 An ASP.NET Core web server isn\\u2019t required to host the app. Serverless deployment scen\", \"arios\\nare possible (for example, serving the app from a CDN).\\nThe downsides of the Blazor WebAssembl\", \"y hosting model are:\\n\\u2022 Browser capabilities restrict the app.\\n\\u2022 Capable client hardware and software\", \" (for example, WebAssembly support) is required.\\n\\u2022 Download size is larger, and apps take longer to \", \"load.\\n10 CHAPTER 3 | Blazor app hosting models\\u2022 .NET runtime and tooling support is less mature. For\", \" example, there are limitations in .NET\\nStandard support and debugging.\\nConversely, the Blazor Serve\", \"r hosting model offers the following benefits:\\n\\u2022 Download size is much smaller than a client-side ap\", \"p, and the app loads much faster.\\n\\u2022 The app takes full advantage of server capabilities, including u\", \"se of any .NET compatible APIs.\\n\\u2022 .NET on the server is used to run the app, so existing .NET toolin\", \"g, such as debugging, works\\nas expected.\\n\\u2022 Thin clients are supported. For example, server-side apps\", \" work with browsers that don\\u2019t\\nsupport WebAssembly and on resource-constrained devices.\\n\\u2022 The app\\u2019s \", \".NET/C# code base, including the app\\u2019s component code, isn\\u2019t served to clients.\\nThe downsides to the\", \" Blazor Server hosting model are:\\n\\u2022 Higher UI latency. Every user interaction involves a network hop\", \".\\n\\u2022 There\\u2019s no offline support. If the client connection fails, the app stops working.\\n\\u2022 Scalability\", \" is challenging for apps with many users. The server must manage multiple client\\nconnections and han\", \"dle client state.\\n\\u2022 An ASP.NET Core server is required to serve the app. Serverless deployment scena\", \"rios aren\\u2019t\\npossible. For example, you can\\u2019t serve the app from a CDN.\\nThe preceding list of trade-o\", \"ffs may be intimidating, but your hosting model can be changed later.\\nRegardless of the Blazor hosti\", \"ng model selected, the component model is the same. In principle, the\\nsame components can be used wi\", \"th either hosting model. Your app code doesn\\u2019t change; however,\\nit\\u2019s a good practice to introduce ab\", \"stractions so that your components stay hosting model-agnostic.\\nThe abstractions allow your app to m\", \"ore easily adopt a different hosting model.\\nDeploy your app\\nASP.NET Web Forms apps are typically hos\", \"ted on IIS on a Windows Server machine or cluster. Blazor\\napps can also:\\n\\u2022 Be hosted on IIS, either \", \"as static files or as an ASP.NET Core app.\\n\\u2022 Leverage ASP.NET Core\\u2019s flexibility to be hosted on var\", \"ious platforms and server\\ninfrastructures. For example, you can host a Blazor App using Nginx or Apa\", \"che on Linux. For\\nmore information about how to publish and deploy Blazor apps, see the Blazor Hosti\", \"ng and\\ndeployment documentation.\\nIn the next section, we\\u2019ll look at how the projects for Blazor WebA\", \"ssembly and Blazor Server apps are\\nset up.\\n11 CHAPTER 3 | Blazor app hosting models4\\nCHAPTER\\nProject\", \" structure for Blazor\\napps\\nDespite their significant project structure differences, ASP.NET Web Form\", \"s and Blazor share many\\nsimilar concepts. Here, we\\u2019ll look at the structure of a Blazor project and \", \"compare it to an ASP.NET\\nWeb Forms project.\\nTo create your first Blazor app, follow the instructions\", \" in the Blazor getting started steps. You can\\nfollow the instructions to create either a Blazor Serv\", \"er app or a Blazor WebAssembly app hosted in\\nASP.NET Core. Except for the hosting model-specific log\", \"ic, most of the code in both projects is the\\nsame.\\nProject file\\nBlazor Server apps are .NET projects\", \". The project file for the Blazor Server app is about as simple as it\\ncan get:\\n<Project Sdk=\\\"Microso\", \"ft.NET.Sdk.Web\\\">\\n<PropertyGroup>\\n<TargetFramework>net8.0</TargetFramework>\\n</PropertyGroup>\\n</Projec\", \"t>\\nThe project file for a Blazor WebAssembly app looks slightly more involved (exact version\\nnumbers\", \" may vary):\\n<Project Sdk=\\\"Microsoft.NET.Sdk.BlazorWebAssembly\\\">\\n<PropertyGroup>\\n<TargetFramework>net\", \"8.0</TargetFramework>\\n<ImplicitUsings>enable</ImplicitUsings>\\n</PropertyGroup>\\n<ItemGroup>\\n<PackageR\", \"eference Include=\\\"Microsoft.AspNetCore.Components.WebAssembly\\\" Version=\\\"8.0.0\\\"\\n/>\\n<PackageReference \", \"Include=\\\"Microsoft.AspNetCore.Components.WebAssembly.DevServer\\\"\\nVersion=\\\"8.0.0\\\" PrivateAssets=\\\"all\\\" \", \"/>\\n</ItemGroup>\\n</Project>\\n12 CHAPTER 4 | Project structure for Blazor appsBlazor WebAssembly projec\", \"t targets Microsoft.NET.Sdk.BlazorWebAssembly instead of\\nMicrosoft.NET.Sdk.Web sdk because they run \", \"in the browser on a WebAssembly-based .NET runtime.\\nYou can\\u2019t install .NET into a web browser like y\", \"ou can on a server or developer machine.\\nConsequently, the project references the Blazor framework u\", \"sing individual package references.\\nBy comparison, a default ASP.NET Web Forms project includes almo\", \"st 300 lines of XML in its .csproj\\nfile, most of which is explicitly listing the various code and co\", \"ntent files in the project. Since the\\nrelease of .NET 5, both Blazor Server and Blazor WebAssembly a\", \"pps can easily share one unified\\nruntime.\\nAlthough they\\u2019re supported, individual assembly references\", \" are less common in .NET projects. Most\\nproject dependencies are handled as NuGet package references\", \". You only need to reference top-level\\npackage dependencies in .NET projects. Transitive dependencie\", \"s are included automatically. Instead of\\nusing the packages.config file commonly found in ASP.NET We\", \"b Forms projects to reference packages,\\npackage references are added to the project file using the <\", \"PackageReference> element.\\n<ItemGroup>\\n<PackageReference Include=\\\"Newtonsoft.Json\\\" Version=\\\"13.0.2\\\" \", \"/>\\n</ItemGroup>\\nEntry point\\nThe Blazor Server app\\u2019s entry point is defined in the Program.cs file, a\", \"s you would see in a Console\\napp. When the app executes, it creates and runs a web host instance usi\", \"ng defaults specific to web\\napps. The web host manages the Blazor Server app\\u2019s lifecycle and sets up\", \" host-level services.\\nExamples of such services are configuration, logging, dependency injection, an\", \"d the HTTP server. This\\ncode is mostly boilerplate and is often left unchanged.\\nusing BlazorApp3.Are\", \"as.Identity;\\nusing BlazorApp3.Data;\\nusing Microsoft.AspNetCore.Components.Authorization;\\nusing Micro\", \"soft.AspNetCore.Identity;\\nusing Microsoft.EntityFrameworkCore;\\nvar builder = WebApplication.CreateBu\", \"ilder(args);\\n// Add services to the container.\\nvar connectionString = builder.Configuration.GetConne\", \"ctionString(\\\"DefaultConnection\\\");\\nbuilder.Services.AddDbContext<ApplicationDbContext>(options =>\\nopt\", \"ions.UseSqlServer(connectionString));\\nbuilder.Services.AddDatabaseDeveloperPageExceptionFilter();\\nbu\", \"ilder.Services.AddDefaultIdentity<IdentityUser>(options =>\\noptions.SignIn.RequireConfirmedAccount = \", \"true)\\n.AddEntityFrameworkStores<ApplicationDbContext>();\\nbuilder.Services.AddRazorPages();\\nbuilder.S\", \"ervices.AddServerSideBlazor();\\nbuilder.Services.AddScoped<AuthenticationStateProvider,\\nRevalidatingI\", \"dentityAuthenticationStateProvider<IdentityUser>>();\\nbuilder.Services.AddSingleton<WeatherForecastSe\", \"rvice>();\\nvar app = builder.Build();\\n// Configure the HTTP request pipeline.\\n13 CHAPTER 4 | Project \", \"structure for Blazor appsif (app.Environment.IsDevelopment())\\n{\\napp.UseMigrationsEndPoint();\\n}\\nelse\\n\", \"{\\napp.UseExceptionHandler(\\\"/Error\\\");\\n// The default HSTS value is 30 days. You may want to change th\", \"is for production\\nscenarios, see https://aka.ms/aspnetcore-hsts.\\napp.UseHsts();\\n}\\napp.UseHttpsRedire\", \"ction();\\napp.UseStaticFiles();\\napp.UseRouting();\\napp.UseAuthorization();\\napp.MapControllers();\\napp.M\", \"apBlazorHub();\\napp.MapFallbackToPage(\\\"/_Host\\\");\\napp.Run();\\nBlazor WebAssembly apps also define an en\", \"try point in Program.cs. The code looks slightly different.\\nThe code is similar in that it\\u2019s setting\", \" up the app host to provide the same host-level services to the\\napp. The WebAssembly app host doesn\\u2019\", \"t, however, set up an HTTP server because it executes directly\\nin the browser.\\nBlazor apps don\\u2019t use\", \" a Global.asax file to define the startup logic for the app. Instead, this logic is\\ncontained in Pro\", \"gram.cs or in a related Startup class that is referenced from Program.cs. Either way,\\nthis code is u\", \"sed to configure the app and any app-specific services.\\nIn a Blazor Server app, the Program.cs file \", \"shown is used to set up the endpoint for the real-time\\nconnection used by Blazor between the client \", \"browsers and the server.\\nIn a Blazor WebAssembly app, the Program.cs file defines the root component\", \"s for the app and where\\nthey should be rendered:\\nusing BlazorApp1;\\nusing Microsoft.AspNetCore.Compon\", \"ents.Web;\\nusing Microsoft.AspNetCore.Components.WebAssembly.Hosting;\\nvar builder = WebAssemblyHostBu\", \"ilder.CreateDefault(args);\\nbuilder.RootComponents.Add<App>(\\\"#app\\\");\\nbuilder.RootComponents.Add<HeadO\", \"utlet>(\\\"head::after\\\");\\nbuilder.Services.AddScoped(sp => new HttpClient { BaseAddress = new\\nUri(build\", \"er.HostEnvironment.BaseAddress) });\\nawait builder.Build().RunAsync();\\n14 CHAPTER 4 | Project structu\", \"re for Blazor appsStatic files\\nUnlike ASP.NET Web Forms projects, not all files in a Blazor project \", \"can be requested as static files.\\nOnly the files in the wwwroot folder are web-addressable. This fol\", \"der is referred to as the app\\u2019s \\u201cweb\\nroot\\u201d. Anything outside of the app\\u2019s web root isn\\u2019t web-address\", \"able. This setup provides an additional\\nlevel of security that prevents accidental exposure of proje\", \"ct files over the web.\\nConfiguration\\nConfiguration in ASP.NET Web Forms apps is typically handled us\", \"ing one or more web.config files.\\nBlazor apps don\\u2019t typically have web.config files. If they do, the\", \" file is only used to configure IIS-\\nspecific settings when hosted on IIS. Instead, Blazor Server ap\", \"ps use the ASP.NET Core configuration\\nabstractions. (Blazor WebAssembly apps don\\u2019t currently support\", \" the same configuration abstractions,\\nbut that may be a feature added in the future.) For example, t\", \"he default Blazor Server app stores some\\nsettings in appsettings.json.\\n{\\n\\\"Logging\\\": {\\n\\\"LogLevel\\\": {\\n\", \"\\\"Default\\\": \\\"Information\\\",\\n\\\"Microsoft\\\": \\\"Warning\\\",\\n\\\"Microsoft.Hosting.Lifetime\\\": \\\"Information\\\"\\n}\\n},\\n\\\"\", \"AllowedHosts\\\": \\\"*\\\"\\n}\\nYou\\u2019ll learn more about configuration in ASP.NET Core projects in the Configura\", \"tion section.\\nRazor components\\nMost files in Blazor projects are .razor files. Razor is a templating\", \" language based on HTML and C#\\nthat is used to dynamically generate web UI. The .razor files define \", \"components that make up the UI\\nof the app. For the most part, the components are identical for both \", \"the Blazor Server and Blazor\\nWebAssembly apps. Components in Blazor are analogous to user controls i\", \"n ASP.NET Web Forms.\\nEach Razor component file is compiled into a .NET class when the project is bui\", \"lt. The generated class\\ncaptures the component\\u2019s state, rendering logic, lifecycle methods, event ha\", \"ndlers, and other logic.\\nYou\\u2019ll learn more about authoring components in the Building reusable UI co\", \"mponents with Blazor\\nsection.\\nThe *_Imports.razor* files aren\\u2019t Razor component files. Instead, they\", \" define a set of Razor directives to\\nimport into other .razor files within the same folder and in it\", \"s subfolders. For example, a\\n*_Imports.razor* file is a conventional way to add using directives for\", \" commonly used namespaces:\\n@using System.Net.Http\\n@using System.Net.Http.Json\\n@using Microsoft.AspNe\", \"tCore.Components.Forms\\n@using Microsoft.AspNetCore.Components.Routing\\n15 CHAPTER 4 | Project structu\", \"re for Blazor apps@using Microsoft.AspNetCore.Components.Web\\n@using Microsoft.AspNetCore.Components.\", \"Web.Virtualization\\n@using Microsoft.AspNetCore.Components.WebAssembly.Http\\n@using Microsoft.JSIntero\", \"p\\n@using BlazorApp1\\n@using BlazorApp1.Shared\\nPages\\nWhere are the pages in the Blazor apps? Blazor do\", \"esn\\u2019t define a separate file extension for\\naddressable pages, like the .aspx files in ASP.NET Web Fo\", \"rms apps. Instead, pages are defined by\\nassigning routes to components. A route is typically assigne\", \"d using the @page Razor directive. For\\nexample, the Counter component authored in the Pages/Counter.\", \"razor file defines the following route:\\n@page \\\"/counter\\\"\\nRouting in Blazor is handled client-side, n\", \"ot on the server. As the user navigates in the browser, Blazor\\nintercepts the navigation and then re\", \"nders the component with the matching route.\\nThe component routes aren\\u2019t currently inferred by the c\", \"omponent\\u2019s file location like they are with\\n.aspx pages or ASP.NET Core Razor Pages. This feature ma\", \"y be added in the future. Each route must\\nbe specified explicitly on the component. Storing routable\", \" components in a Pages folder has no\\nspecial meaning and is purely a convention.\\nYou\\u2019ll learn more a\", \"bout routing in Blazor in the Pages, routing, and layouts section.\\nLayout\\nIn ASP.NET Web Forms apps,\", \" a common page layout is handled using master pages (Site.Master). In\\nBlazor apps, the page layout i\", \"s handled using layout components (Shared/MainLayout.razor). Layout\\ncomponents are discussed in more\", \" detail in the Page, routing, and layouts section.\\nBootstrap Blazor\\nTo bootstrap Blazor, the app mus\", \"t:\\n\\u2022 Specify where on the page the root component (App.Razor) should be rendered.\\n\\u2022 Add the correspo\", \"nding Blazor framework script.\\nIn the Blazor Server app, the root component\\u2019s host page is defined i\", \"n the *_Host.cshtml* file. This file\\ndefines a Razor Page, not a component. Razor Pages use Razor sy\", \"ntax to define a server-addressable\\npage, very much like an .aspx page.\\n@page \\\"/\\\"\\n@namespace BlazorA\", \"pp3.Pages\\n@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers\\n@{\\nLayout = \\\"_Layout\\\";\\n}\\n16 CHAPTER 4\", \" | Project structure for Blazor apps<component type=\\\"typeof(App)\\\" render-mode=\\\"ServerPrerendered\\\" />\", \"\\nThe render-mode attribute is used to define where a root-level component should be rendered. The\\nRe\", \"nderMode option indicates the manner in which the component should be rendered. The following\\ntable \", \"outlines the supported RenderMode options.\\nOption Description\\nRenderMode.Server Rendered interactive\", \"ly once a\\nconnection with the browser is\\nestablished\\nRenderMode.ServerPrerendered First prerendered \", \"and then rendered\\ninteractively\\nRenderMode.Static Rendered as static content\\nThe *_Layout.cshtml* fi\", \"le includes the default HTML for the app and its components.\\n@using Microsoft.AspNetCore.Components.\", \"Web\\n@namespace BlazorApp3.Pages\\n@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers\\n<!DOCTYPE html>\", \"\\n<html lang=\\\"en\\\">\\n<head>\\n<meta charset=\\\"utf-8\\\" />\\n<meta name=\\\"viewport\\\" content=\\\"width=device-width,\", \" initial-scale=1.0\\\" />\\n<base href=\\\"~/\\\" />\\n<link rel=\\\"stylesheet\\\" href=\\\"css/bootstrap/bootstrap.min.c\", \"ss\\\" />\\n<link href=\\\"css/site.css\\\" rel=\\\"stylesheet\\\" />\\n<link href=\\\"BlazorApp3.styles.css\\\" rel=\\\"stylesh\", \"eet\\\" />\\n<component type=\\\"typeof(HeadOutlet)\\\" render-mode=\\\"ServerPrerendered\\\" />\\n</head>\\n<body>\\n@Rend\", \"erBody()\\n<div id=\\\"blazor-error-ui\\\">\\n<environment include=\\\"Staging,Production\\\">\\nAn error has occurred\", \". This application may no longer respond until reloaded.\\n</environment>\\n<environment include=\\\"Develo\", \"pment\\\">\\nAn unhandled exception has occurred. See browser dev tools for details.\\n</environment>\\n<a hr\", \"ef=\\\"\\\" class=\\\"reload\\\">Reload</a>\\n<a class=\\\"dismiss\\\">\\ud83d\\uddd9</a>\\n</div>\\n<script src=\\\"_framework/blazor.serve\", \"r.js\\\"></script>\\n</body>\\n</html>\\nThe script reference to *_framework/blazor.server.js* establishes th\", \"e real-time connection with the\\nserver and then deals with all user interactions and UI updates.\\n17 \", \"CHAPTER 4 | Project structure for Blazor appsIn the Blazor WebAssembly app, the host page is a simpl\", \"e static HTML file under wwwroot/index.html.\\nThe <div> element with id named app is used to indicate\", \" where the root component should be\\nrendered.\\n<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n<head>\\n<meta charset=\", \"\\\"utf-8\\\" />\\n<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maximum-\\nscale=1.0,\", \" user-scalable=no\\\" />\\n<title>BlazorApp1</title>\\n<base href=\\\"/\\\" />\\n<link href=\\\"css/bootstrap/bootstra\", \"p.min.css\\\" rel=\\\"stylesheet\\\" />\\n<link href=\\\"css/app.css\\\" rel=\\\"stylesheet\\\" />\\n<link href=\\\"BlazorApp1.s\", \"tyles.css\\\" rel=\\\"stylesheet\\\" />\\n</head>\\n<body>\\n<div id=\\\"app\\\">Loading...</div>\\n<div id=\\\"blazor-error-u\", \"i\\\">\\nAn unhandled error has occurred.\\n<a href=\\\"\\\" class=\\\"reload\\\">Reload</a>\\n<a class=\\\"dismiss\\\">\\ud83d\\uddd9</a>\\n<\", \"/div>\\n<script src=\\\"_framework/blazor.webassembly.js\\\"></script>\\n</body>\\n</html>\\nThe root component to\", \" render is specified in the app\\u2019s Program.cs file with the flexibility to register\\nservices through \", \"dependency injection. For more information, see ASP.NET Core Blazor dependency\\ninjection.\\nvar builde\", \"r = WebAssemblyHostBuilder.CreateDefault(args);\\nbuilder.RootComponents.Add<App>(\\\"#app\\\");\\nbuilder.Roo\", \"tComponents.Add<HeadOutlet>(\\\"head::after\\\");\\nBuild output\\nWhen a Blazor project is built, all Razor c\", \"omponent and code files are compiled into a single\\nassembly. Unlike ASP.NET Web Forms projects, Blaz\", \"or doesn\\u2019t support runtime compilation of the UI\\nlogic.\\nRun the app with Hot Reload\\nTo run the Blazo\", \"r Server app, press F5 in Visual Studio to run with the debugger attached, or Ctrl + F5\\nto run witho\", \"ut the debugger attached.\\nTo run the Blazor WebAssembly app, choose one of the following approaches:\", \"\\n\\u2022 Run the client project directly using the development server.\\n18 CHAPTER 4 | Project structure fo\", \"r Blazor apps\\u2022 Run the server project when hosting the app with ASP.NET Core.\\nBlazor WebAssembly app\", \"s can be debugged in both browser and Visual Studio. See Debug ASP.NET\\nCore Blazor WebAssembly for d\", \"etails.\\nBoth Blazor Server and Blazor WebAssembly apps support Hot Reload in Visual Studio. Hot Relo\", \"ad is\\na feature that automatically updates changes made to a Blazor app live, in the browser. You ca\", \"n\\ntoggle whether Hot Reload is enabled from its icon in the toolbar:\\nSelecting the caret beside the \", \"icon reveals additional options. You can toggle Hot Reload on or off,\\nrestart the application, and t\", \"oggle whether Hot Reload should occur whenever a file is saved.\\nYou can also access additional confi\", \"guration options. The configuration dialog lets you specify\\nwhether Hot Reload should be enabled whe\", \"n debugging (along with Edit and Continue), when\\nstarting without debugging, or when a file is saved\", \".\\n19 CHAPTER 4 | Project structure for Blazor appsThe \\u201cdeveloper inner loop\\u201d has been greatly stream\", \"lined with Hot Reload. Without Hot Reload, a\\nBlazor developer would typically need to restart and re\", \"run the app after every change, navigating to\\nthe appropriate part of the app as required. With Hot \", \"Reload, changes can be made to the running\\napp without the need to restart in most cases. Hot Reload\", \" even retains the state of pages, so there\\u2019s\\nno need to have to re-enter form values or otherwise ge\", \"t the app back where you need it.\\n20 CHAPTER 4 | Project structure for Blazor apps5\\nCHAPTER\\nApp star\", \"tup\\nApplications that are written for ASP.NET typically have a global.asax.cs file that defines the\\n\", \"Application_Start event that controls which services are configured and made available for both HTML\", \"\\nrendering and .NET processing. This chapter looks at how things are slightly different with ASP.NET\", \"\\nCore and Blazor Server.\\nApplication_Start and Web Forms\\nThe default web forms Application_Start met\", \"hod has grown in purpose over years to handle many\\nconfiguration tasks. A fresh web forms project wi\", \"th the default template in Visual Studio 2022 now\\ncontains the following configuration logic:\\n\\u2022 Rout\", \"eConfig - Application URL routing\\n\\u2022 BundleConfig - CSS and JavaScript bundling and minification\\nEach\", \" of these individual files resides in the App_Start folder and run only once at the start of our\\napp\", \"lication. RouteConfig in the default project template adds the FriendlyUrlSettings for web forms to\\n\", \"allow application URLs to omit the .ASPX file extension. The default template also contains a direct\", \"ive\\nthat provides permanent HTTP redirect status codes (HTTP 301) for the .ASPX pages to the friendl\", \"y\\nURL with the file name that omits the extension.\\nWith ASP.NET Core and Blazor, these methods are e\", \"ither simplified and consolidated into the Startup\\nclass or they are eliminated in favor of common w\", \"eb technologies.\\nBlazor Server Startup Structure\\nBlazor Server applications reside on top of an ASP.\", \"NET Core 3.0 or later version. ASP.NET Core web\\napplications are configured in Program.cs, or throug\", \"h a pair of methods in the Startup.cs class. A\\nsample Program.cs file is shown below:\\nusing BlazorAp\", \"p1.Data;\\nusing Microsoft.AspNetCore.Components;\\nusing Microsoft.AspNetCore.Components.Web;\\nvar build\", \"er = WebApplication.CreateBuilder(args);\\n// Add services to the container.\\nbuilder.Services.AddRazor\", \"Pages();\\nbuilder.Services.AddServerSideBlazor();\\nbuilder.Services.AddSingleton<WeatherForecastServic\", \"e>();\\n21 CHAPTER 5 | App startupvar app = builder.Build();\\n// Configure the HTTP request pipeline.\\ni\", \"f (!app.Environment.IsDevelopment())\\n{\\napp.UseExceptionHandler(\\\"/Error\\\");\\n// The default HSTS value \", \"is 30 days. You may want to change this for production\\nscenarios, see https://aka.ms/aspnetcore-hsts\", \".\\napp.UseHsts();\\n}\\napp.UseHttpsRedirection();\\napp.UseStaticFiles();\\napp.UseRouting();\\napp.MapBlazorH\", \"ub();\\napp.MapFallbackToPage(\\\"/_Host\\\");\\napp.Run();\\nThe app\\u2019s required services are added to the WebAp\", \"plicationBuilder instance\\u2019s Services collection.\\nThis is how the various ASP.NET Core framework serv\", \"ices are configured with the framework\\u2019s built-in\\ndependency injection container. The various builde\", \"r.Services.Add* methods add services that enable\\nfeatures such as authentication, razor pages, MVC c\", \"ontroller routing, SignalR, and Blazor Server\\ninteractions among many others. This method was not ne\", \"eded in web forms, as the parsing and\\nhandling of the ASPX, ASCX, ASHX, and ASMX files were defined \", \"by referencing ASP.NET in the\\nweb.config configuration file. More information about dependency injec\", \"tion in ASP.NET Core is\\navailable in the online documentation.\\nAfter the app has been built by the b\", \"uilder, the rest of the calls on app configure its HTTP pipeline.\\nWith these calls, we declare from \", \"top to bottom the Middleware that will handle every request sent to\\nour application. Most of these f\", \"eatures in the default configuration were scattered across the web\\nforms configuration files and are\", \" now in one place for ease of reference.\\nNo longer is the configuration of the custom error page pla\", \"ced in a web.config file, but now is\\nconfigured to always be shown if the application environment is\", \" not labeled Development.\\nAdditionally, ASP.NET Core applications are now configured to serve secure\", \" pages with TLS by default\\nwith the UseHttpsRedirection method call.\\nNext, an unexpected configurati\", \"on method call is made to UseStaticFiles. In ASP.NET Core, support for\\nrequests for static files (li\", \"ke JavaScript, CSS, and image files) must be explicitly enabled, and only files\\nin the app\\u2019s wwwroot\", \" folder are publicly addressable by default.\\nThe next line is the first that replicates one of the c\", \"onfiguration options from web forms: UseRouting.\\nThis method adds the ASP.NET Core router to the pip\", \"eline and it can be either configured here or in\\nthe individual files that it can consider routing t\", \"o. More information about routing configuration can\\nbe found in the Routing section.\\nThe final app.M\", \"ap* calls in this section define the endpoints that ASP.NET Core is listening on. These\\nroutes are t\", \"he web accessible locations that you can access on the web server and receive some\\ncontent handled b\", \"y .NET and returned to you. The first entry, MapBlazorHub configures a SignalR hub\\nfor use in provid\", \"ing the real-time and persistent connection to the server where the state and\\nrendering of Blazor co\", \"mponents is handled. The MapFallbackToPage method call indicates the web-\\naccessible location of the\", \" page that starts the Blazor application and also configures the application to\\n22 CHAPTER 5 | App s\", \"tartuphandle deep-linking requests from the client-side. You will see this feature at work if you op\", \"en a\\nbrowser and navigate directly to Blazor handled route in your application, such as /counter in \", \"the\\ndefault project template. The request gets handled by the *_Host.cshtml* fallback page, which th\", \"en\\nruns the Blazor router and renders the counter page.\\nThe very last line starts the application, s\", \"omething that wasn\\u2019t required in web forms (since it relied on\\nIIS to be running).\\nUpgrading the Bun\", \"dleConfig Process\\nTechnologies for bundling assets like CSS stylesheets and JavaScript files have ch\", \"anged significantly,\\nwith other technologies providing quickly evolving tools and techniques for man\", \"aging these\\nresources. To this end, we recommend using a Node command-line tool such as Grunt / Gulp\", \" /\\nWebPack to package your static assets.\\nThe Grunt, Gulp, and WebPack command-line tools and their \", \"associated configurations can be added\\nto your application and ASP.NET Core will quietly ignore thos\", \"e files during the application build\\nprocess. You can add a call to run their tasks by adding a Targ\", \"et inside your project file with syntax\\nsimilar to the following that would trigger a gulp script an\", \"d the min target inside that script:\\n<Target Name=\\\"MyPreCompileTarget\\\" BeforeTargets=\\\"Build\\\">\\n<Exec \", \"Command=\\\"gulp min\\\" />\\n</Target>\\nMore details about both strategies to manage your CSS and JavaScript\", \" files are available in the Bundle\\nand minify static assets in ASP.NET Core documentation.\\n23 CHAPTE\", \"R 5 | App startup6\\nCHAPTER\\nBuild reusable UI\\ncomponents with Blazor\\nOne of the beautiful things abou\", \"t ASP.NET Web Forms is how it enables encapsulation of reusable\\npieces of user interface (UI) code i\", \"nto reusable UI controls. Custom user controls can be defined in\\nmarkup using .ascx files. You can a\", \"lso build elaborate server controls in code with full designer\\nsupport.\\nBlazor also supports UI enca\", \"psulation through components. A component:\\n\\u2022 Is a self-contained chunk of UI.\\n\\u2022 Maintains its own st\", \"ate and rendering logic.\\n\\u2022 Can define UI event handlers, bind to input data, and manage its own life\", \"cycle.\\n\\u2022 Is typically defined in a .razor file using Razor syntax.\\nAn introduction to Razor\\nRazor is\", \" a light-weight markup templating language based on HTML and C#. With Razor, you can\\nseamlessly tran\", \"sition between markup and C# code to define your component rendering logic. When\\nthe .razor file is \", \"compiled, the rendering logic is captured in a structured way in a .NET class. The name\\nof the compi\", \"led class is taken from the .razor file name. The namespace is taken from the default\\nnamespace for \", \"the project and the folder path, or you can explicitly specify the namespace using the\\n@namespace di\", \"rective (more on Razor directives below).\\nA component\\u2019s rendering logic is authored using normal HTM\", \"L markup with dynamic logic added\\nusing C#. The @ character is used to transition to C#. Razor is ty\", \"pically smart about figuring out when\\nyou\\u2019ve switched back to HTML. For example, the following compo\", \"nent renders a <p> tag with the\\ncurrent time:\\n<p>@DateTime.Now</p>\\nTo explicitly specify the beginni\", \"ng and ending of a C# expression, use parentheses:\\n<p>@(DateTime.Now)</p>\\nRazor also makes it easy t\", \"o use C# control flow in your rendering logic. For example, you can\\nconditionally render some HTML l\", \"ike this:\\n24 CHAPTER 6 | Build reusable UI components with Blazor@if (value % 2 == 0)\\n{\\n<p>The value\", \" was even.</p>\\n}\\nOr you can generate a list of items using a normal C# foreach loop like this:\\n<ul>\\n\", \"@foreach (var item in items)\\n{\\n<li>@item.Text</li>\\n}\\n</ul>\\nRazor directives, like directives in ASP.\", \"NET Web Forms, control many aspects of how a Razor\\ncomponent is compiled. Examples include the compo\", \"nent\\u2019s:\\n\\u2022 Namespace\\n\\u2022 Base class\\n\\u2022 Implemented interfaces\\n\\u2022 Generic parameters\\n\\u2022 Imported namespaces\", \"\\n\\u2022 Routes\\nRazor directives start with the @ character and are typically used at the start of a new l\", \"ine at the start\\nof the file. For example, the @namespace directive defines the component\\u2019s namespac\", \"e:\\n@namespace MyComponentNamespace\\nThe following table summarizes the various Razor directives used \", \"in Blazor and their ASP.NET Web\\nForms equivalents, if they exist.\\nDirective Description Example Web \", \"Forms equivalent\\n@attribute Adds a class-level @attribute None\\nattribute to the [Authorize]\\ncomponen\", \"t\\n@code Adds class @code { ... } <script runat=\\\"server\\\">...</script>\\nmembers to the\\ncomponent\\n@imple\", \"ments Implements the @impleme Use code-behind\\nspecified interface nts\\nIDisposable\\n@inherits Inherits\", \" from the @inherits <%@ Control\\nspecified base class MyCompon Inherits=\\\"MyUserControlBase\\\" %>\\nentBas\", \"e\\n@inject Injects a service @inject None\\ninto the component IJSRuntime\\nJS\\n25 CHAPTER 6 | Build reusa\", \"ble UI components with BlazorDirective Description Example Web Forms equivalent\\n@layout Specifies a \", \"layout @layout <%@ Page\\ncomponent for the MainLayout MasterPageFile=\\\"~/Site.Master\\\" %>\\ncomponent\\n@na\", \"mespace Sets the namespace @namespa None\\nfor the component ce\\nMyNamesp\\nace\\n@page Specifies the route\", \" @page <%@ Page %>\\nfor the component \\\"/product/{i\\nd}\\\"\\n@typeparam Specifies a generic @typepara Use c\", \"ode-behind\\ntype parameter for m TItem\\nthe component\\n@using Specifies a @using Add namespace in web.c\", \"onfig\\nnamespace to bring MyCompon\\ninto scope entNamesp\\nace\\nRazor components also make extensive use \", \"of directive attributes on elements to control various\\naspects of how components get compiled (event\", \" handling, data binding, component & element\\nreferences, and so on). Directive attributes all follow\", \" a common generic syntax where the values in\\nparenthesis are optional:\\n@directive(-suffix(:name))(=\\\"\", \"value\\\")\\nThe following table summarizes the various attributes for Razor directives used in Blazor.\\nA\", \"ttribute Description Example\\n@attributes Renders a dictionary of attributes <input\\n@attributes=\\\"Extr\", \"aA\\nttributes\\\" />\\n@bind Creates a two-way data binding <input\\n@bind=\\\"username\\\"\\n@bind:event=\\\"oninp\\nut\\\"\", \" />\\n@on{event} Adds an event handler for the <button\\nspecified event @onclick=\\\"Incremen\\ntCount\\\">Clic\", \"k\\nme!</button>\\n@key Specifies a key to be used by the <DetailsEditor\\ndiffing algorithm for preservin\", \"g @key=\\\"person\\\"\\nelements in a collection Details=\\\"person.Det\\nails\\\" />\\n26 CHAPTER 6 | Build reusable \", \"UI components with BlazorAttribute Description Example\\n@ref Captures a reference to the <MyDialog\\nco\", \"mponent or HTML element @ref=\\\"myDialog\\\" />\\nThe various directive attributes used by Blazor (@onclick\", \", @bind, @ref, and so on) are covered in the\\nsections below and later chapters.\\nMany of the syntaxes\", \" used in .aspx and .ascx files have parallel syntaxes in Razor. Below is a simple\\ncomparison of the \", \"syntaxes for ASP.NET Web Forms and Razor.\\nSynt\\nFeature Web Forms Syntax Razor\\nax\\nDirectives <%@ [dir\", \"ective] %> <%@ Page %> @[directive] @pa\\nge\\nCode blocks <% %> <% int x = 123; %> @{ } @{\\nint x\\n=\\n123;\", \" }\\nExpressions <%: %> <%:DateTime.Now Implicit: @ @Da\\n(HTML-encoded) %> Explicit: @() teTi\\nme.N\\now\\n@\", \"(Da\\nteTi\\nme.N\\now)\\nComments <%-- --%> <%-- Commented -- @* *@ @*\\n%> Com\\nment\\ned\\n*@\\nData binding <%# %\", \"> <%# Bind(\\\"Name\\\") @bind <inp\\n%> ut\\n@bin\\nd=\\\"u\\nserna\\nme\\\"\\n/>\\nTo add members to the Razor component cla\", \"ss, use the @code directive. This technique is similar to\\nusing a <script runat=\\\"server\\\">...</script\", \"> block in an ASP.NET Web Forms user control or page.\\n@code {\\nint count = 0;\\nvoid IncrementCount()\\n{\", \"\\ncount++;\\n27 CHAPTER 6 | Build reusable UI components with Blazor}\\n}\\nBecause Razor is based on C#, i\", \"t must be compiled from within a C# project (.csproj). You can\\u2019t\\ncompile .razor files from a Visual \", \"Basic project (.vbproj). You can still reference Visual Basic projects\\nfrom your Blazor project. The\", \" opposite is true too.\\nFor a full Razor syntax reference, see Razor syntax reference for ASP.NET Cor\", \"e.\\nUse components\\nAside from normal HTML, components can also use other components as part of their \", \"rendering logic.\\nThe syntax for using a component in Razor is similar to using a user control in an \", \"ASP.NET Web Forms\\napp. Components are specified using an element tag that matches the type name of t\", \"he component.\\nFor example, you can add a Counter component like this:\\n<Counter />\\nUnlike ASP.NET Web\", \" Forms, components in Blazor:\\n\\u2022 Don\\u2019t use an element prefix (for example, asp:).\\n\\u2022 Don\\u2019t require reg\", \"istration on the page or in the web.config.\\nThink of Razor components like you would .NET types, bec\", \"ause that\\u2019s exactly what they are. If the\\nassembly containing the component is referenced, then the \", \"component is available for use. To bring\\nthe component\\u2019s namespace into scope, apply the @using dire\", \"ctive:\\n@using MyComponentLib\\n<Counter />\\nAs seen in the default Blazor projects, it\\u2019s common to put \", \"@using directives into a *_Imports.razor* file\\nso that they\\u2019re imported into all .razor files in the\", \" same directory and in child directories.\\nIf the namespace for a component isn\\u2019t in scope, you can s\", \"pecify a component using its full type\\nname, as you can in C#:\\n<MyComponentLib.Counter />\\nModify pag\", \"e title from components\\nWhen building SPA-style apps, it\\u2019s common for parts of a page to reload with\", \"out reloading the entire\\npage. Even so, it can be useful to have the title of the page change based \", \"on which component is\\ncurrently loaded. This can be accomplished by including the <PageTitle> tag in\", \" the component\\u2019s\\nRazor page:\\n@page \\\"/\\\"\\n<PageTitle>Home</PageTitle>\\nThe contents of this element can \", \"be dynamic, for instance showing the current count of messages:\\n28 CHAPTER 6 | Build reusable UI com\", \"ponents with Blazor<PageTitle>@MessageCount messages</PageTitle>\\nNote that if several components on \", \"a particular page include <PageTitle> tags, only the last one will\\nbe displayed (since each one will\", \" overwrite the previous one).\\nComponent parameters\\nIn ASP.NET Web Forms, you can flow parameters and\", \" data to controls using public properties. These\\nproperties can be set in markup using attributes or\", \" set directly in code. Razor components work in a\\nsimilar fashion, although the component properties\", \" must also be marked with the [Parameter]\\nattribute to be considered component parameters.\\nThe follo\", \"wing Counter component defines a component parameter called IncrementAmount that can\\nbe used to spec\", \"ify the amount that the Counter should be incremented each time the button is\\nclicked.\\n<h1>Counter</\", \"h1>\\n<p>Current count: @currentCount</p>\\n<button class=\\\"btn btn-primary\\\" @onclick=\\\"IncrementCount\\\">Cl\", \"ick me</button>\\n@code {\\nint currentCount = 0;\\n[Parameter]\\npublic int IncrementAmount { get; set; } =\", \" 1;\\nvoid IncrementCount()\\n{\\ncurrentCount+=IncrementAmount;\\n}\\n}\\nTo specify a component parameter in B\", \"lazor, use an attribute as you would in ASP.NET Web Forms:\\n<Counter IncrementAmount=\\\"10\\\" />\\nQuery st\", \"ring parameters\\nRazor components can also leverage values from the query string of the page they\\u2019re \", \"rendered on as\\na parameter source. To enable this, add the [SupplyParameterFromQuery] attribute to t\", \"he parameter.\\nFor example, the following parameter definition would get its value from the request i\", \"n the form\\n?IncBy=2:\\n[Parameter]\\n[SupplyParameterFromQuery(Name = \\\"IncBy\\\")]\\npublic int IncrementAmou\", \"nt { get; set; } = 1;\\nIf you don\\u2019t supply a custom Name in the [SupplyParameterFromQuery] attribute,\", \" by default it will\\nmatch the property name (IncrementAmount in this case).\\n29 CHAPTER 6 | Build reu\", \"sable UI components with BlazorComponents and error boundaries\\nBy default, Blazor apps will detect u\", \"nhandled exceptions and show an error message at the bottom of\\nthe page with no additional detail. T\", \"o constrain the parts of the app that are impacted by an\\nunhandled error, for instance to limit the \", \"impact to a single component, the <ErrorBoundary> tag can\\nbe wrapped around component declarations.\\n\", \"For example, to protect against possible exceptions thrown from the Counter component, declare it\\nwi\", \"thin an <ErrorBoundary> and optionally specify a message to display if there is an exception:\\n<Error\", \"Boundary>\\n<ChildContent>\\n<Counter />\\n</ChildContent>\\n<ErrorContent>\\nOops! The counter isn't working \", \"right now; please try again later.\\n</ErrorContent>\\n</ErrorBoundary>\\nIf you don\\u2019t need to specify cus\", \"tom error content, you can just wrap the component\\ndirectly:\\n<ErrorBoundary>\\n<Counter />\\n</ErrorBoun\", \"dary>\\nA default message stating \\u201cAn error as occurred.\\u201d will be displayed if an unhandled exception \", \"occurs\\nin the wrapped component.\\nEvent handlers\\nBoth ASP.NET Web Forms and Blazor provide an event-b\", \"ased programming model for handling UI\\nevents. Examples of such events include button clicks and tex\", \"t input. In ASP.NET Web Forms, you use\\nHTML server controls to handle UI events exposed by the DOM, \", \"or you can handle events exposed by\\nweb server controls. The events are surfaced on the server throu\", \"gh form post-back requests. Consider\\nthe following Web Forms button click example:\\nCounter.ascx\\n<asp\", \":Button ID=\\\"ClickMeButton\\\" runat=\\\"server\\\" Text=\\\"Click me!\\\"\\nOnClick=\\\"ClickMeButton_Click\\\" />\\nCounter.\", \"ascx.cs\\npublic partial class Counter : System.Web.UI.UserControl\\n{\\nprotected void ClickMeButton_Clic\", \"k(object sender, EventArgs e)\\n{\\nConsole.WriteLine(\\\"The button was clicked!\\\");\\n}\\n}\\nIn Blazor, you can\", \" register handlers for DOM UI events directly using directive attributes of the form\\n@on{event}. The\", \" {event} placeholder represents the name of the event. For example, you can listen for\\nbutton clicks\", \" like this:\\n30 CHAPTER 6 | Build reusable UI components with Blazor<button @onclick=\\\"OnClick\\\">Click \", \"me!</button>\\n@code {\\nvoid OnClick()\\n{\\nConsole.WriteLine(\\\"The button was clicked!\\\");\\n}\\n}\\nEvent handle\", \"rs can accept an optional, event-specific argument to provide more information about\\nthe event. For \", \"example, mouse events can take a MouseEventArgs argument, but it isn\\u2019t required.\\n<button @onclick=\\\"O\", \"nClick\\\">Click me!</button>\\n@code {\\nvoid OnClick(MouseEventArgs e)\\n{\\nConsole.WriteLine($\\\"Mouse clicke\", \"d at {e.ScreenX}, {e.ScreenY}.\\\");\\n}\\n}\\nInstead of referring to a method group for an event handler, y\", \"ou can use a lambda expression. A\\nlambda expression allows you to close over other in-scope values.\\n\", \"@foreach (var buttonLabel in buttonLabels)\\n{\\n<button @onclick=\\\"() => Console.WriteLine($\\\"The {button\", \"Label} button was\\nclicked!\\\")\\\">@buttonLabel</button>\\n}\\nEvent handlers can execute synchronously or as\", \"ynchronously. For example, the following OnClick\\nevent handler executes asynchronously:\\n<button @onc\", \"lick=\\\"OnClick\\\">Click me!</button>\\n@code {\\nasync Task OnClick()\\n{\\nvar result = await Http.GetAsync(\\\"a\", \"pi/values\\\");\\n}\\n}\\nAfter an event is handled, the component is rendered to account for any component s\", \"tate changes.\\nWith asynchronous event handlers, the component is rendered immediately after the hand\", \"ler\\nexecution completes. The component is rendered again after the asynchronous Task completes. This\", \"\\nasynchronous execution mode provides an opportunity to render some appropriate UI while the\\nasynchr\", \"onous Task is still in progress.\\n<button @onclick=\\\"ShowMessage\\\">Get message</button>\\n@if (showMessag\", \"e)\\n{\\n@if (message == null)\\n{\\n<p><em>Loading...</em></p>\\n}\\nelse\\n31 CHAPTER 6 | Build reusable UI comp\", \"onents with Blazor{\\n<p>The message is: @message</p>\\n}\\n}\\n@code\\n{\\nbool showMessage = false;\\nstring mes\", \"sage;\\npublic async Task ShowMessage()\\n{\\nshowMessage = true;\\nmessage = await MessageService.GetMessag\", \"eAsync();\\n}\\n}\\nComponents can also define their own events by defining a component parameter of type\\n\", \"EventCallback<TValue>. Event callbacks support all the variations of DOM UI event handlers: optional\", \"\\narguments, synchronous or asynchronous, method groups, or lambda expressions.\\n<button class=\\\"btn bt\", \"n-primary\\\" @onclick=\\\"OnClick\\\">Click me!</button>\\n@code {\\n[Parameter]\\npublic EventCallback<MouseEvent\", \"Args> OnClick { get; set; }\\n}\\nData binding\\nBlazor provides a simple mechanism to bind data from a UI\", \" component to the component\\u2019s state. This\\napproach differs from the features in ASP.NET Web Forms fo\", \"r binding data from data sources to UI\\ncontrols. We\\u2019ll cover handling data from different data sourc\", \"es in the Dealing with data section.\\nTo create a two-way data binding from a UI component to the com\", \"ponent\\u2019s state, use the @bind\\ndirective attribute. In the following example, the value of the check \", \"box is bound to the isChecked\\nfield.\\n<input type=\\\"checkbox\\\" @bind=\\\"isChecked\\\" />\\n@code {\\nbool isChec\", \"ked;\\n}\\nWhen the component is rendered, the value of the checkbox is set to the value of the isChecke\", \"d field.\\nWhen the user toggles the checkbox, the onchange event is fired and the isChecked field is \", \"set to the\\nnew value. The @bind syntax in this case is equivalent to the following markup:\\n<input va\", \"lue=\\\"@isChecked\\\" @onchange=\\\"(UIChangeEventArgs e) => isChecked = e.Value\\\" />\\nTo change the event use\", \"d for the bind, use the @bind:event attribute.\\n<input @bind=\\\"text\\\" @bind:event=\\\"oninput\\\" />\\n<p>@text\", \"</p>\\n32 CHAPTER 6 | Build reusable UI components with Blazor@code {\\nstring text;\\n}\\nComponents can al\", \"so support data binding to their parameters. To data bind, define an event callback\\nparameter with t\", \"he same name as the bindable parameter. The \\u201cChanged\\u201d suffix is added to the\\nname.\\nPasswordBox.razor\", \"\\nPassword: <input\\nvalue=\\\"@Password\\\"\\n@oninput=\\\"OnPasswordChanged\\\"\\ntype=\\\"@(showPassword ? \\\"text\\\" : \\\"pa\", \"ssword\\\")\\\" />\\n<label><input type=\\\"checkbox\\\" @bind=\\\"showPassword\\\" />Show password</label>\\n@code {\\npriv\", \"ate bool showPassword;\\n[Parameter]\\npublic string Password { get; set; }\\n[Parameter]\\npublic EventCall\", \"back<string> PasswordChanged { get; set; }\\nprivate Task OnPasswordChanged(ChangeEventArgs e)\\n{\\nPassw\", \"ord = e.Value.ToString();\\nreturn PasswordChanged.InvokeAsync(Password);\\n}\\n}\\nTo chain a data binding \", \"to an underlying UI element, set the value and handle the event directly on\\nthe UI element instead o\", \"f using the @bind attribute.\\nTo bind to a component parameter, use a @bind-{Parameter} attribute to \", \"specify the parameter to\\nwhich you want to bind.\\n<PasswordBox @bind-Password=\\\"password\\\" />\\n@code {\\ns\", \"tring password;\\n}\\nState changes\\nIf the component\\u2019s state has changed outside of a normal UI event or\", \" event callback, then the\\ncomponent must manually signal that it needs to be rendered again. To sign\", \"al that a component\\u2019s\\nstate has changed, call the StateHasChanged method on the component.\\nIn the ex\", \"ample below, a component displays a message from an AppState service that can be updated\\nby other pa\", \"rts of the app. The component registers its StateHasChanged method with the\\nAppState.OnChange event \", \"so that the component is rendered whenever the message gets updated.\\n33 CHAPTER 6 | Build reusable U\", \"I components with Blazorpublic class AppState\\n{\\npublic string Message { get; }\\n// Lets components re\", \"ceive change notifications\\npublic event Action OnChange;\\npublic void UpdateMessage(string message)\\n{\", \"\\nMessage = message;\\nNotifyStateChanged();\\n}\\nprivate void NotifyStateChanged() => OnChange?.Invoke();\", \"\\n}\\n@inject AppState AppState\\n<p>App message: @AppState.Message</p>\\n@code {\\nprotected override void O\", \"nInitialized()\\n{\\nAppState.OnChange += StateHasChanged\\n}\\n}\\nComponent lifecycle\\nThe ASP.NET Web Forms \", \"framework has well-defined lifecycle methods for modules, pages, and\\ncontrols. For example, the foll\", \"owing control implements event handlers for the Init, Load, and UnLoad\\nlifecycle events:\\nCounter.asc\", \"x.cs\\npublic partial class Counter : System.Web.UI.UserControl\\n{\\nprotected void Page_Init(object send\", \"er, EventArgs e) { ... }\\nprotected void Page_Load(object sender, EventArgs e) { ... }\\nprotected void\", \" Page_UnLoad(object sender, EventArgs e) { ... }\\n}\\nRazor components also have a well-defined lifecyc\", \"le. A component\\u2019s lifecycle can be used to initialize\\ncomponent state and implement advanced compone\", \"nt behaviors.\\nAll of Blazor\\u2019s component lifecycle methods have both synchronous and asynchronous ver\", \"sions.\\nComponent rendering is synchronous. You can\\u2019t run asynchronous logic as part of the component\", \"\\nrendering. All asynchronous logic must execute as part of an async lifecycle method.\\nOnInitialized\\n\", \"The OnInitialized and OnInitializedAsync methods are used to initialize the component. A component\\ni\", \"s typically initialized after it\\u2019s first rendered. After a component is initialized, it may be rende\", \"red\\n34 CHAPTER 6 | Build reusable UI components with Blazormultiple times before it\\u2019s eventually dis\", \"posed. The OnInitialized method is similar to the Page_Load\\nevent in ASP.NET Web Forms pages and con\", \"trols.\\nprotected override void OnInitialized() { ... }\\nprotected override async Task OnInitializedAs\", \"ync() { await ... }\\nOnParametersSet\\nThe OnParametersSet and OnParametersSetAsync methods are called \", \"when a component has\\nreceived parameters from its parent and the value are assigned to properties. T\", \"hese methods are\\nexecuted after component initialization and each time the component is rendered.\\npr\", \"otected override void OnParametersSet() { ... }\\nprotected override async Task OnParametersSetAsync()\", \" { await ... }\\nOnAfterRender\\nThe OnAfterRender and OnAfterRenderAsync methods are called after a com\", \"ponent has finished\\nrendering. Element and component references are populated at this point (more on\", \" these concepts\\nbelow). Interactivity with the browser is enabled at this point. Interactions with t\", \"he DOM and\\nJavaScript execution can safely take place.\\nprotected override void OnAfterRender(bool fi\", \"rstRender)\\n{\\nif (firstRender)\\n{\\n...\\n}\\n}\\nprotected override async Task OnAfterRenderAsync(bool firstR\", \"ender)\\n{\\nif (firstRender)\\n{\\nawait ...\\n}\\n}\\nOnAfterRender and OnAfterRenderAsync aren\\u2019t called when pr\", \"erendering on the server.\\nThe firstRender parameter is true the first time the component is rendered\", \"; otherwise, its value is false.\\nIDisposable\\nRazor components can implement IDisposable to dispose o\", \"f resources when the component is\\nremoved from the UI. A Razor component can implement IDispose by u\", \"sing the @implements\\ndirective:\\n@using System\\n@implements IDisposable\\n...\\n@code {\\npublic void Dispos\", \"e()\\n35 CHAPTER 6 | Build reusable UI components with Blazor{\\n...\\n}\\n}\\nCapture component references\\nIn\", \" ASP.NET Web Forms, it\\u2019s common to manipulate a control instance directly in code by referring to\\nit\", \"s ID. In Blazor, it\\u2019s also possible to capture and manipulate a reference to a component, although i\", \"t\\u2019s\\nmuch less common.\\nTo capture a component reference in Blazor, use the @ref directive attribute. \", \"The value of the\\nattribute should match the name of a settable field with the same type as the refer\", \"enced component.\\n<MyLoginDialog @ref=\\\"loginDialog\\\" ... />\\n@code {\\nMyLoginDialog loginDialog = defaul\", \"t!;\\nvoid OnSomething()\\n{\\nloginDialog.Show();\\n}\\n}\\nWhen the parent component is rendered, the field is\", \" populated with the child component instance.\\nYou can then call methods on, or otherwise manipulate,\", \" the component instance.\\nManipulating component state directly using component references isn\\u2019t reco\", \"mmended. Doing so\\nprevents the component from being rendered automatically at the correct times.\\nCap\", \"ture element references\\nRazor components can capture references to an element. Unlike HTML server co\", \"ntrols in ASP.NET\\nWeb Forms, you can\\u2019t manipulate the DOM directly using an element reference in Bla\", \"zor. Blazor\\nhandles most DOM interactions for you using its DOM diffing algorithm. Captured element \", \"references\\nin Blazor are opaque. However, they\\u2019re used to pass a specific element reference in a Jav\", \"aScript\\ninterop call. For more information about JavaScript interop, see ASP.NET Core Blazor JavaScr\", \"ipt\\ninterop.\\nTemplated components\\nIn ASP.NET Web Forms, you can create templated controls. Templated\", \" controls enable the developer\\nto specify a portion of the HTML used to render a container control. \", \"The mechanics of building\\ntemplated server controls are complex, but they enable powerful scenarios \", \"for rendering data in a\\nuser customizable way. Examples of templated controls include Repeater and D\", \"ataList.\\nRazor components can also be templated by defining component parameters of type\\nRenderFragm\", \"ent or RenderFragment<T>. A RenderFragment represents a chunk of Razor markup\\n36 CHAPTER 6 | Build r\", \"eusable UI components with Blazorthat can then be rendered by the component. A RenderFragment<T> is \", \"a chunk of Razor markup that\\ntakes a parameter that can be specified when the render fragment is ren\", \"dered.\\nChild content\\nRazor components can capture their child content as a RenderFragment and render\", \" that content as\\npart of the component rendering. To capture child content, define a component param\", \"eter of type\\nRenderFragment and name it ChildContent.\\nChildContentComponent.razor\\n<h1>Component with\", \" child content</h1>\\n<div>@ChildContent</div>\\n@code {\\n[Parameter]\\npublic RenderFragment ChildContent \", \"{ get; set; }\\n}\\nA parent component can then supply child content using normal Razor syntax.\\n<ChildCo\", \"ntentComponent>\\n<ChildContent>\\n<p>The time is @DateTime.Now</p>\\n</ChildContent>\\n</ChildContentCompon\", \"ent>\\nTemplate parameters\\nA templated Razor component can also define multiple component parameters o\", \"f type\\nRenderFragment or RenderFragment<T>. The parameter for a RenderFragment<T> can be specified\\nw\", \"hen it\\u2019s invoked. To specify a generic type parameter for a component, use the @typeparam Razor\\ndire\", \"ctive.\\nSimpleListView.razor\\n@typeparam TItem\\n@Heading\\n<ul>\\n@foreach (var item in Items)\\n{\\n<li>@ItemT\", \"emplate(item)</li>\\n}\\n</ul>\\n@code {\\n[Parameter]\\npublic RenderFragment Heading { get; set; }\\n[Paramete\", \"r]\\npublic RenderFragment<TItem> ItemTemplate { get; set; }\\n[Parameter]\\npublic IEnumerable<TItem> Ite\", \"ms { get; set; }\\n}\\n37 CHAPTER 6 | Build reusable UI components with BlazorWhen using a templated com\", \"ponent, the template parameters can be specified using child elements\\nthat match the names of the pa\", \"rameters. Component arguments of type RenderFragment<T> passed\\nas elements have an implicit paramete\", \"r named context. You can change the name of this implement\\nparameter using the Context attribute on \", \"the child element. Any generic type parameters can be\\nspecified using an attribute that matches the \", \"name of the type parameter. The type parameter will be\\ninferred if possible:\\n<SimpleListView Items=\\\"\", \"messages\\\" TItem=\\\"string\\\">\\n<Heading>\\n<h1>My list</h1>\\n</Heading>\\n<ItemTemplate Context=\\\"message\\\">\\n<p>\", \"The message is: @message</p>\\n</ItemTemplate>\\n</SimpleListView>\\nThe output of this component looks li\", \"ke this:\\n<h1>My list</h1>\\n<ul>\\n<li><p>The message is: message1</p></li>\\n<li><p>The message is: messa\", \"ge2</p></li>\\n<ul>\\nCode-behind\\nA Razor component is typically authored in a single .razor file. Howev\", \"er, it\\u2019s also possible to separate\\nthe code and markup using a code-behind file. To use a component \", \"file, add a C# file that matches\\nthe file name of the component file but with a .cs extension added \", \"(Counter.razor.cs). Use the C# file\\nto define a base class for the component. You can name the base \", \"class anything you\\u2019d like, but it\\u2019s\\ncommon to name the class the same as the component class, but wi\", \"th a Base extension added\\n(CounterBase). The component-based class must also derive from ComponentBa\", \"se. Then, in the Razor\\ncomponent file, add the @inherits directive to specify the base class for the\", \" component (@inherits\\nCounterBase).\\nCounter.razor\\n@inherits CounterBase\\n<h1>Counter</h1>\\n<p>Current \", \"count: @currentCount</p>\\n<button @onclick=\\\"IncrementCount\\\">Click me</button>\\nCounter.razor.cs\\npublic\", \" class CounterBase : ComponentBase\\n{\\nprotected int currentCount = 0;\\nprotected void IncrementCount()\", \"\\n{\\ncurrentCount++;\\n}\\n}\\n38 CHAPTER 6 | Build reusable UI components with BlazorThe visibility of the \", \"component\\u2019s members in the base class must be protected or public to be visible\\nto the component cla\", \"ss.\\nAdditional resources\\nThe preceding isn\\u2019t an exhaustive treatment of all aspects of Razor compone\", \"nts. For more information\\non how to Create and use ASP.NET Core Razor components, see the Blazor doc\", \"umentation.\\n39 CHAPTER 6 | Build reusable UI components with Blazor7\\nCHAPTER\\nPages, routing, and\\nlay\", \"outs\\nASP.NET Web Forms apps are composed of pages defined in .aspx files. Each page\\u2019s address is bas\", \"ed\\non its physical file path in the project. When a browser makes a request to the page, the content\", \"s of\\nthe page are dynamically rendered on the server. The rendering accounts for both the page\\u2019s HTM\", \"L\\nmarkup and its server controls.\\nIn Blazor, each page in the app is a component, typically defined \", \"in a .razor file, with one or more\\nspecified routes. Routing mostly happens client-side without invo\", \"lving a specific server request. The\\nbrowser first makes a request to the root address of the app. A\", \" root Router component in the Blazor\\napp then handles intercepting navigation requests and forwards \", \"them to the correct component.\\nBlazor also supports deep linking. Deep linking occurs when the brows\", \"er makes a request to a specific\\nroute other than the root of the app. Requests for deep links sent \", \"to the server are routed to the\\nBlazor app, which then routes the request client-side to the correct\", \" component.\\nA simple page in ASP.NET Web Forms might contain the following markup:\\nName.aspx\\n<%@ Pag\", \"e Title=\\\"Name\\\" Language=\\\"C#\\\" MasterPageFile=\\\"~/Site.Master\\\" AutoEventWireup=\\\"true\\\"\\nCodeBehind=\\\"Name.\", \"aspx.cs\\\" Inherits=\\\"WebApplication1.Name\\\" %>\\n<asp:Content ID=\\\"BodyContent\\\" ContentPlaceHolderID=\\\"Main\", \"Content\\\" runat=\\\"server\\\">\\n<div>\\nWhat is your name?<br />\\n<asp:TextBox ID=\\\"TextBox1\\\" runat=\\\"server\\\"></\", \"asp:TextBox>\\n<asp:Button ID=\\\"Button1\\\" runat=\\\"server\\\" Text=\\\"Submit\\\" OnClick=\\\"Button1_Click\\\" />\\n</div>\", \"\\n<div>\\n<asp:Literal ID=\\\"Literal1\\\" runat=\\\"server\\\" />\\n</div>\\n</asp:Content>\\nName.aspx.cs\\npublic partia\", \"l class Name : System.Web.UI.Page\\n{\\nprotected void Button1_Click1(object sender, EventArgs e)\\n{\\nLite\", \"ral1.Text = \\\"Hello \\\" + TextBox1.Text;\\n}\\n}\\n40 CHAPTER 7 | Pages, routing, and layoutsThe equivalent p\", \"age in a Blazor app would look like this:\\nName.razor\\n@page \\\"/Name\\\"\\n@layout MainLayout\\n<div>\\nWhat is \", \"your name?<br />\\n<input @bind=\\\"text\\\" />\\n<button @onclick=\\\"OnClick\\\">Submit</button>\\n</div>\\n<div>\\n@if \", \"(name != null)\\n{\\n@:Hello @name\\n}\\n</div>\\n@code {\\nstring text;\\nstring name;\\nvoid OnClick() {\\nname = te\", \"xt;\\n}\\n}\\nCreate pages\\nTo create a page in Blazor, create a component and add the @page Razor directiv\", \"e to specify the\\nroute for the component. The @page directive takes a single parameter, which is the\", \" route template\\nto add to that component.\\n@page \\\"/counter\\\"\\nThe route template parameter is required.\", \" Unlike ASP.NET Web Forms, the route to a Blazor\\ncomponent isn\\u2019t inferred from its file location (al\", \"though that may be a feature added in the future).\\nThe route template syntax is the same basic synta\", \"x used for routing in ASP.NET Web Forms. Route\\nparameters are specified in the template using braces\", \". Blazor will bind route values to component\\nparameters with the same name (case-insensitive).\\n@page\", \" \\\"/product/{id}\\\"\\n<h1>Product @Id</h1>\\n@code {\\n[Parameter]\\npublic string Id { get; set; }\\n}\\nYou can a\", \"lso specify constraints on the value of the route parameter. For example, to constrain the\\nproduct I\", \"D to be an int:\\n41 CHAPTER 7 | Pages, routing, and layouts@page \\\"/product/{id:int}\\\"\\n<h1>Product @Id<\", \"/h1>\\n@code {\\n[Parameter]\\npublic int Id { get; set; }\\n}\\nFor a full list of the route constraints supp\", \"orted by Blazor, see Route constraints.\\nRouter component\\nRouting in Blazor is handled by the Router \", \"component. The Router component is typically used in the\\napp\\u2019s root component (App.razor).\\n<Router A\", \"ppAssembly=\\\"@typeof(Program).Assembly\\\">\\n<Found Context=\\\"routeData\\\">\\n<RouteView RouteData=\\\"@routeData\", \"\\\" DefaultLayout=\\\"@typeof(MainLayout)\\\" />\\n</Found>\\n<NotFound>\\n<LayoutView Layout=\\\"@typeof(MainLayout)\", \"\\\">\\n<p>Sorry, there's nothing at this address.</p>\\n</LayoutView>\\n</NotFound>\\n</Router>\\nThe Router com\", \"ponent discovers the routable components in the specified AppAssembly and in the\\noptionally specifie\", \"d AdditionalAssemblies. When the browser navigates, the Router intercepts the\\nnavigation and renders\", \" the contents of its Found parameter with the extracted RouteData if a route\\nmatches the address, ot\", \"herwise the Router renders its NotFound parameter.\\nThe RouteView component handles rendering the mat\", \"ched component specified by the RouteData\\nwith its layout if it has one. If the matched component do\", \"esn\\u2019t have a layout, then the optionally\\nspecified DefaultLayout is used.\\nThe LayoutView component r\", \"enders its child content within the specified layout. We\\u2019ll look at layouts\\nmore in detail later in \", \"this chapter.\\nNavigation\\nIn ASP.NET Web Forms, you trigger navigation to a different page by returni\", \"ng a redirect response to\\nthe browser. For example:\\nprotected void NavigateButton_Click(object sende\", \"r, EventArgs e)\\n{\\nResponse.Redirect(\\\"Counter\\\");\\n}\\nReturning a redirect response isn\\u2019t typically poss\", \"ible in Blazor. Blazor doesn\\u2019t use a request-reply\\nmodel. You can, however, trigger browser navigati\", \"ons directly, as you can with JavaScript.\\n42 CHAPTER 7 | Pages, routing, and layoutsBlazor provides \", \"a NavigationManager service that can be used to:\\n\\u2022 Get the current browser address\\n\\u2022 Get the base ad\", \"dress\\n\\u2022 Trigger navigations\\n\\u2022 Get notified when the address changes\\nTo navigate to a different addre\", \"ss, use the NavigateTo method:\\n@page \\\"/\\\"\\n@inject NavigationManager NavigationManager\\n<button @onclic\", \"k=\\\"Navigate\\\">Navigate</button>\\n@code {\\nvoid Navigate() {\\nNavigationManager.NavigateTo(\\\"counter\\\");\\n}\\n\", \"}\\nFor a description of all NavigationManager members, see URI and navigation state helpers.\\nBase URL\", \"s\\nIf your Blazor app is deployed under a base path, then you need to specify the base URL in the pag\", \"e\\nmetadata using the <base> tag for routing to work property. If the host page for the app is server\", \"-\\nrendered using Razor, then you can use the ~/ syntax to specify the app\\u2019s base address. If the hos\", \"t\\npage is static HTML, then you need to specify the base URL explicitly.\\n<base href=\\\"~/\\\" />\\nPage lay\", \"out\\nPage layout in ASP.NET Web Forms is handled by Master Pages. Master Pages define a template with\", \"\\none or more content placeholders that can then be supplied by individual pages. Master Pages are\\nde\", \"fined in .master files and start with the <%@ Master %> directive. The content of the .master files \", \"is\\ncoded as you would an .aspx page, but with the addition of <asp:ContentPlaceHolder> controls to\\nm\", \"ark where pages can supply content.\\nSite.master\\n<%@ Master Language=\\\"C#\\\" AutoEventWireup=\\\"true\\\" Code\", \"Behind=\\\"Site.master.cs\\\"\\nInherits=\\\"WebApplication1.SiteMaster\\\" %>\\n<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n<h\", \"ead runat=\\\"server\\\">\\n<meta charset=\\\"utf-8\\\" />\\n<meta name=\\\"viewport\\\" content=\\\"width=device-width, init\", \"ial-scale=1.0\\\" />\\n<title><%: Page.Title %> - My ASP.NET Application</title>\\n<link href=\\\"~/favicon.ic\", \"o\\\" rel=\\\"shortcut icon\\\" type=\\\"image/x-icon\\\" />\\n</head>\\n43 CHAPTER 7 | Pages, routing, and layouts<bod\", \"y>\\n<form runat=\\\"server\\\">\\n<div class=\\\"container body-content\\\">\\n<asp:ContentPlaceHolder ID=\\\"MainConten\", \"t\\\" runat=\\\"server\\\">\\n</asp:ContentPlaceHolder>\\n<hr />\\n<footer>\\n<p>&copy; <%: DateTime.Now.Year %> - My\", \" ASP.NET Application</p>\\n</footer>\\n</div>\\n</form>\\n</body>\\n</html>\\nIn Blazor, you handle page layout \", \"using layout components. Layout components inherit from\\nLayoutComponentBase, which defines a single \", \"Body property of type RenderFragment, which can be\\nused to render the contents of the page.\\nMainLayo\", \"ut.razor\\n@inherits LayoutComponentBase\\n<h1>Main layout</h1>\\n<div>\\n@Body\\n</div>\\nWhen the page with a \", \"layout is rendered, the page is rendered within the contents of the specified\\nlayout at the location\", \" where the layout renders its Body property.\\nTo apply a layout to a page, use the @layout directive:\", \"\\n@layout MainLayout\\nYou can specify the layout for all components in a folder and subfolders using a\", \"n *_Imports.razor* file.\\nYou can also specify a default layout for all your pages using the Router c\", \"omponent.\\nMaster Pages can define multiple content placeholders, but layouts in Blazor only have a s\", \"ingle Body\\nproperty. This limitation of Blazor layout components will hopefully be addressed in a fu\", \"ture release.\\nMaster Pages in ASP.NET Web Forms can be nested. That is, a Master Page may also use a\", \" Master\\nPage. Layout components in Blazor may be nested too. You can apply a layout component to a l\", \"ayout\\ncomponent. The contents of the inner layout will be rendered within the outer layout.\\nChildLay\", \"out.razor\\n@layout MainLayout\\n<h2>Child layout</h2>\\n<div>\\n@Body\\n</div>\\nIndex.razor\\n@page \\\"/\\\"\\n@layout \", \"ChildLayout\\n<p>I'm in a nested layout!</p>\\nThe rendered output for the page would then be:\\n44 CHAPTE\", \"R 7 | Pages, routing, and layouts<h1>Main layout</h1>\\n<div>\\n<h2>Child layout</h2>\\n<div>\\n<p>I'm in a \", \"nested layout!</p>\\n</div>\\n</div>\\nLayouts in Blazor don\\u2019t typically define the root HTML elements for\", \" a page (<html>, <body>, <head>,\\nand so on). The root HTML elements are instead defined in a Blazor \", \"app\\u2019s host page, which is used to\\nrender the initial HTML content for the app (see Bootstrap Blazor)\", \". The host page can render multiple\\nroot components for the app with surrounding markup.\\nComponents \", \"in Blazor, including pages, can\\u2019t render <script> tags. This rendering restriction exists\\nbecause <s\", \"cript> tags get loaded once and then can\\u2019t be changed. Unexpected behavior may occur if\\nyou try to r\", \"ender the tags dynamically using Razor syntax. Instead, all <script> tags should be added\\nto the app\", \"\\u2019s host page.\\n45 CHAPTER 7 | Pages, routing, and layouts8\\nCHAPTER\\nState management\\nState management \", \"is a key concept of Web Forms applications, facilitated through ViewState, Session\\nState, Applicatio\", \"n State, and Postback features. These stateful features of the framework helped to\\nhide the state ma\", \"nagement required for an application and allow application developers to focus on\\ndelivering their f\", \"unctionality. With ASP.NET Core and Blazor, some of these features have been\\nrelocated and some have\", \" been removed altogether. This chapter reviews how to maintain state and\\ndeliver the same functional\", \"ity with the new features in Blazor.\\nRequest state management with ViewState\\nWhen discussing state m\", \"anagement in Web Forms application, many developers will immediately\\nthink of ViewState. In Web Form\", \"s, ViewState manages the state of the content between HTTP requests\\nby sending a large encoded block\", \" of text back and forth to the browser. The ViewState field could be\\noverwhelmed with content from a\", \" page containing many elements, potentially expanding to several\\nmegabytes in size.\\nWith Blazor Serv\", \"er, the app maintains an ongoing connection with the server. The app\\u2019s state, called a\\ncircuit, is h\", \"eld in server memory while the connection is considered active. State will only be disposed\\nwhen the\", \" user navigates away from the app or a particular page in the app. All members of the active\\ncompone\", \"nts are available between interactions with the server.\\nThere are several advantages of this feature\", \":\\n\\u2022 Component state is readily available and not rebuilt between interactions.\\n\\u2022 State isn\\u2019t transmi\", \"tted to the browser.\\nHowever, there are some disadvantages to in-memory component state persistence \", \"to be aware of:\\n\\u2022 If the server restarts between request, state is lost.\\n\\u2022 Your application web serv\", \"er load-balancing solution must include sticky sessions to ensure\\nthat all requests from the same br\", \"owser return to the same server. If a request goes to a\\ndifferent server, state will be lost.\\n\\u2022 Pers\", \"istence of component state on the server can lead to memory pressure on the web server.\\nFor the prec\", \"eding reasons, don\\u2019t rely on just the state of the component to reside in-memory on the\\nserver. Your\", \" application should also include some backing data store for data between requests. Some\\nsimple exam\", \"ples of this strategy:\\n\\u2022 In a shopping cart application, persist the content of new items added to t\", \"he cart in a\\ndatabase record. If the state on the server is lost, you can reconstitute it from the d\", \"atabase\\nrecords.\\n46 CHAPTER 8 | State management\\u2022 In a multi-part web form, your users will expect y\", \"our application to remember values between\\neach request. Write the data between each of your user\\u2019s \", \"posts to a data store so that they\\ncan be fetched and assembled into the final form response structu\", \"re when the multi-part\\nform is completed.\\nFor additional details on managing state in Blazor apps, s\", \"ee ASP.NET Core Blazor state management.\\nMaintain state with Session\\nWeb Forms developers could main\", \"tain information about the currently acting user with the\\nMicrosoft.AspNetCore.Http.ISession diction\", \"ary object. It\\u2019s easy enough to add an object with a string\\nkey to the Session, and that object woul\", \"d be available at a later time during the user\\u2019s interactions\\nwith the application. In an attempt to\", \" eliminate managing interacting with HTTP, the Session object\\nmade it easy to maintain state.\\nThe si\", \"gnature of the .NET Framework Session object isn\\u2019t the same as the ASP.NET Core Session\\nobject. Cons\", \"ider the documentation for the new ASP.NET Core Session before deciding to migrate\\nand use the new s\", \"ession state feature.\\nSession is available in ASP.NET Core and Blazor Server, but is discouraged fro\", \"m use in favor of storing\\ndata in a data repository appropriately. Session state is also not functio\", \"nal if visitors decline the use\\nHTTP cookies in your application due to privacy concerns.\\nConfigurat\", \"ion for ASP.NET Core and Session state is available in the Session and state management in\\nASP.NET C\", \"ore article.\\nApplication state\\nThe Application object in the Web Forms framework provides a massive,\", \" cross-request repository for\\ninteracting with application-scope configuration and state. Applicatio\", \"n state was an ideal place to\\nstore various application configuration properties that would be refer\", \"enced by all requests, regardless\\nof the user making the request. The problem with the Application o\", \"bject was that data didn\\u2019t persist\\nacross multiple servers. The state of the application object was \", \"lost between restarts.\\nAs with Session, it\\u2019s recommended that data move to a persistent backing stor\", \"e that could be\\naccessed by multiple server instances. If there is volatile data that you would like\", \" to be able to access\\nacross requests and users, you could easily store it in a singleton service th\", \"at can be injected into\\ncomponents that require this information or interaction.\\nThe construction of\", \" an object to maintain application state and its consumption could resemble the\\nfollowing implementa\", \"tion:\\npublic class MyApplicationState\\n{\\npublic int VisitorCounter { get; private set; } = 0;\\npublic \", \"void IncrementCounter() => VisitorCounter += 1;\\n}\\n47 CHAPTER 8 | State managementapp.AddSingleton<My\", \"ApplicationState>();\\n@inject MyApplicationState AppState\\n<label>Total Visitors: @AppState.VisitorCou\", \"nter</label>\\nThe MyApplicationState object is created only once on the server, and the value Visitor\", \"Counter is\\nfetched and output in the component\\u2019s label. The VisitorCounter value should be persisted\", \" and\\nretrieved from a backing data store for durability and scalability.\\nIn the browser\\nApplication \", \"data can also be stored client-side on the user\\u2019s device so that is available later. There are\\ntwo b\", \"rowser features that allow for persistence of data in different scopes of the user\\u2019s browser:\\n\\u2022 loca\", \"lStorage - scoped to the user\\u2019s entire browser. If the page is reloaded, the browser is\\nclosed and r\", \"eopened, or another tab is opened with the same URL then the same\\nlocalStorage is provided by the br\", \"owser\\n\\u2022 sessionStorage - scoped to the user\\u2019s current browser tab. If the tab is reloaded, the state\", \"\\npersists. However, if the user opens another tab to your application or closes and reopens the\\nbrow\", \"ser the state is lost.\\nYou can write some custom JavaScript code to interact with these features, or\", \" there are a number of\\nNuGet packages that you can use that provide this functionality. One such pac\", \"kage is\\nMicrosoft.AspNetCore.ProtectedBrowserStorage.\\nFor instructions on utilizing this package to \", \"interact with localStorage and sessionStorage, see the\\nBlazor State Management article.\\n48 CHAPTER 8\", \" | State management9\\nCHAPTER\\nForms and validation\\nThe ASP.NET Web Forms framework includes a set of \", \"validation server controls that handle validating\\nuser input entered into a form (RequiredFieldValid\", \"ator, CompareValidator, RangeValidator, and so on).\\nThe ASP.NET Web Forms framework also supports mo\", \"del binding and validating the model based on\\ndata annotations ([Required], [StringLength], [Range],\", \" and so on). The validation logic can be enforced\\nboth on the server and on the client using unobtru\", \"sive JavaScript-based validation. The\\nValidationSummary server control is used to display a summary \", \"of the validation errors to the user.\\nBlazor supports the sharing of validation logic between both t\", \"he client and the server. ASP.NET\\nprovides pre-built JavaScript implementations of many common serve\", \"r validations. In many cases, the\\ndeveloper still has to write JavaScript to fully implement their a\", \"pp-specific validation logic. The same\\nmodel types, data annotations, and validation logic can be us\", \"ed on both the server and client.\\nBlazor provides a set of input components. The input components ha\", \"ndle binding field data to a\\nmodel and validating the user input when the form is submitted.\\nInput c\", \"omponent Rendered HTML element\\nInputCheckbox <input type=\\\"checkbox\\\">\\nInputDate <input type=\\\"date\\\">\\nI\", \"nputNumber <input type=\\\"number\\\">\\nInputSelect <select>\\nInputText <input>\\nInputTextArea <textarea>\\nThe\", \" EditForm component wraps these input components and orchestrates the validation process\\nthrough an \", \"EditContext. When creating an EditForm, you specify what model instance to bind to using\\nthe Model p\", \"arameter. Validation is typically done using data annotations, and it\\u2019s extensible. To\\nenable data a\", \"nnotation-based validation, add the DataAnnotationsValidator component as a child of\\nthe EditForm. T\", \"he EditForm component provides a convenient event for handling valid\\n(OnValidSubmit) and invalid (On\", \"InvalidSubmit) submissions. There\\u2019s also a more generic OnSubmit\\nevent that lets you trigger and han\", \"dle the validation yourself.\\nTo display a validation error summary, use the ValidationSummary compon\", \"ent. To display validation\\nmessages for a specific input field, use the ValidationMessage component,\", \" specifying a lambda\\nexpression for the For parameter that points to the appropriate model member.\\nT\", \"he following model type defines several validation rules using data annotations:\\n49 CHAPTER 9 | Form\", \"s and validationusing System;\\nusing System.ComponentModel.DataAnnotations;\\npublic class Starship\\n{\\n[\", \"Required]\\n[StringLength(16,\\nErrorMessage = \\\"Identifier too long (16 character limit).\\\")]\\npublic stri\", \"ng Identifier { get; set; }\\npublic string Description { get; set; }\\n[Required]\\npublic string Classif\", \"ication { get; set; }\\n[Range(1, 100000,\\nErrorMessage = \\\"Accommodation invalid (1-100000).\\\")]\\npublic \", \"int MaximumAccommodation { get; set; }\\n[Required]\\n[Range(typeof(bool), \\\"true\\\", \\\"true\\\",\\nErrorMessage \", \"= \\\"This form disallows unapproved ships.\\\")]\\npublic bool IsValidatedDesign { get; set; }\\n[Required]\\np\", \"ublic DateTime ProductionDate { get; set; }\\n}\\nThe following component demonstrates building a form i\", \"n Blazor based on the Starship model type:\\n<h1>New Ship Entry Form</h1>\\n<EditForm Model=\\\"@starship\\\" \", \"OnValidSubmit=\\\"@HandleValidSubmit\\\">\\n<DataAnnotationsValidator />\\n<ValidationSummary />\\n<p>\\n<label fo\", \"r=\\\"identifier\\\">Identifier: </label>\\n<InputText id=\\\"identifier\\\" @bind-Value=\\\"starship.Identifier\\\" />\\n\", \"<ValidationMessage For=\\\"() => starship.Identifier\\\" />\\n</p>\\n<p>\\n<label for=\\\"description\\\">Description \", \"(optional): </label>\\n<InputTextArea id=\\\"description\\\" @bind-Value=\\\"starship.Description\\\" />\\n</p>\\n<p>\\n\", \"<label for=\\\"classification\\\">Primary Classification: </label>\\n<InputSelect id=\\\"classification\\\" @bind-\", \"Value=\\\"starship.Classification\\\">\\n<option value=\\\"\\\">Select classification ...</option>\\n<option value=\\\"\", \"Exploration\\\">Exploration</option>\\n<option value=\\\"Diplomacy\\\">Diplomacy</option>\\n<option value=\\\"Defens\", \"e\\\">Defense</option>\\n</InputSelect>\\n<ValidationMessage For=\\\"() => starship.Classification\\\" />\\n</p>\\n<p\", \">\\n<label for=\\\"accommodation\\\">Maximum Accommodation: </label>\\n<InputNumber id=\\\"accommodation\\\" @bind-V\", \"alue=\\\"starship.MaximumAccommodation\\\" />\\n<ValidationMessage For=\\\"() => starship.MaximumAccommodation\\\"\", \" />\\n</p>\\n50 CHAPTER 9 | Forms and validation<p>\\n<label for=\\\"valid\\\">Engineering Approval: </label>\\n<I\", \"nputCheckbox id=\\\"valid\\\" @bind-Value=\\\"starship.IsValidatedDesign\\\" />\\n<ValidationMessage For=\\\"() => st\", \"arship.IsValidatedDesign\\\" />\\n</p>\\n<p>\\n<label for=\\\"productionDate\\\">Production Date: </label>\\n<InputDa\", \"te id=\\\"productionDate\\\" @bind-Value=\\\"starship.ProductionDate\\\" />\\n<ValidationMessage For=\\\"() => starsh\", \"ip.ProductionDate\\\" />\\n</p>\\n<button type=\\\"submit\\\">Submit</button>\\n</EditForm>\\n@code {\\nprivate Starshi\", \"p starship = new Starship();\\nprivate void HandleValidSubmit()\\n{\\n// Save the data\\n}\\n}\\nAfter the form \", \"submission, the model-bound data hasn\\u2019t been saved to any data store, like a\\ndatabase. In a Blazor W\", \"ebAssembly app, the data must be sent to the server. For example, using an\\nHTTP POST request. In a B\", \"lazor Server app, the data is already on the server, but it must be persisted.\\nHandling data access \", \"in Blazor apps is the subject of the Dealing with data section.\\nAdditional resources\\nFor more inform\", \"ation on forms and validation in Blazor apps, see the Blazor documentation.\\n51 CHAPTER 9 | Forms and\", \" validation10\\nCHAPTER\\nWork with data\\nData access is the backbone of an ASP.NET Web Forms app. If you\", \"\\u2019re building forms for the web, what\\nhappens to that data? With Web Forms, there were multiple data \", \"access techniques you could use to\\ninteract with a database:\\n\\u2022 Data Sources\\n\\u2022 ADO.NET\\n\\u2022 Entity Frame\", \"work\\nData Sources were controls that you could place on a Web Forms page and configure like other\\nco\", \"ntrols. Visual Studio provided a friendly set of dialogs to configure and bind the controls to your\\n\", \"Web Forms pages. Developers who enjoy a \\u201clow code\\u201d or \\u201cno code\\u201d approach preferred this\\ntechnique wh\", \"en Web Forms was first released.\\nADO.NET is the low-level approach to interacting with a database. Y\", \"our apps could create a\\nconnection to the database with Commands, Datatables, and Datasets for inter\", \"acting. The results\\ncould then be bound to fields on screen without much code. The drawback of this \", \"approach was that\\neach set of ADO.NET objects (Connection, Command, and DataTable) was bound to libr\", \"aries provided\\nby a database vendor. Use of these components made the code rigid and difficult to mi\", \"grate to a\\ndifferent database.\\nEntity Framework\\nEntity Framework (EF) is the open source object-rela\", \"tional mapping framework maintained by the\\n.NET Foundation. Initially released with .NET Framework, \", \"EF allows for generating code for the\\ndatabase connections, storage schemas, and interactions. With \", \"this abstraction, you can focus on your\\n52 CHAPTER 10 | Work with dataapp\\u2019s business rules and allow\", \" the database to be managed by a trusted database administrator. In\\n.NET, you can use an updated ver\", \"sion of EF called EF Core. EF Core helps generate and maintain the\\ninteractions between your code an\", \"d the database with a series of commands that are available for you\\nusing the dotnet ef command-line\", \" tool. Let\\u2019s take a look at a few samples to get you working with a\\ndatabase.\\nEF Code First\\nA quick \", \"way to get started building your database interactions is to start with the class objects you\\nwant t\", \"o work with. EF provides a tool to help generate the appropriate database code for your classes.\\nThi\", \"s approach is called \\u201cCode First\\u201d development. Consider the following Product class for a sample\\nsto\", \"refront app that we want to store in a relational database like Microsoft SQL Server.\\npublic class P\", \"roduct\\n{\\npublic int Id { get; set; }\\n[Required]\\npublic string Name { get; set; }\\n[MaxLength(4000)]\\np\", \"ublic string Description { get; set; }\\n[Range(0, 99999,99)]\\n[DataType(DataType.Currency)]\\npublic dec\", \"imal Price { get; set; }\\n}\\nProduct has a primary key and three additional fields that would be creat\", \"ed in our database:\\n\\u2022 EF will identify the Id property as a primary key by convention.\\n\\u2022 Name will b\", \"e stored in a column configured for text storage. The [Required] attribute\\ndecorating this property \", \"will add a not null constraint to help enforce this declared behavior\\nof the property.\\n\\u2022 Description\", \" will be stored in a column configured for text storage, and have a maximum\\nlength configured of 400\", \"0 characters as dictated by the [MaxLength] attribute. The database\\nschema will be configured with a\", \" column named MaxLength using data type varchar(4000).\\n\\u2022 The Price property will be stored as curren\", \"cy. The [Range] attribute will generate appropriate\\nconstraints to prevent data storage outside of t\", \"he minimum and maximum values declared.\\nWe need to add this Product class to a database context clas\", \"s that defines the connection and\\ntranslation operations with our database.\\npublic class MyDbContext\", \" : DbContext\\n{\\npublic DbSet<Product> Products { get; set; }\\n}\\nThe MyDbContext class provides the one\", \" property that defines the access and translation for the\\nProduct class. Your application configures\", \" this class for interaction with the database using the\\nfollowing entries in the Startup class\\u2019s Con\", \"figureServices method (or appropriate location in\\nProgram.cs using the builder.Services property ins\", \"tead of services):\\n53 CHAPTER 10 | Work with dataservices.AddDbContext<MyDbContext>(options =>\\noptio\", \"ns.UseSqlServer(\\\"MY DATABASE CONNECTION STRING\\\"));\\nThe preceding code will connect to a SQL Server d\", \"atabase with the specified connection string. You\\ncan place the connection string in your appsetting\", \"s.json file, environment variables, or other\\nconfiguration storage locations and replace this embedd\", \"ed string appropriately.\\nYou can then generate the database table appropriate for this class using t\", \"he following commands:\\ndotnet ef migrations add 'Create Product table'\\ndotnet ef database update\\nThe\", \" first command defines the changes you\\u2019re making to the database schema as a new EF Migration\\ncalled\", \" Create Product table. A Migration defines how to apply and remove your new database\\nchanges.\\nOnce a\", \"pplied, you have a simple Product table in your database and some new classes added to the\\nproject t\", \"hat help manage the database schema. You can find these generated classes, by default, in a\\nnew fold\", \"er called Migrations. When you make changes to the Product class or add more related\\nclasses you wou\", \"ld like interacting with your database, you need to run the command-line commands\\nagain with a new n\", \"ame of the migration. This command will generate another set of migration classes\\nto update your dat\", \"abase schema.\\nEF Database First\\nFor existing databases, you can generate the classes for EF Core by \", \"using the .NET command-line\\ntools. To scaffold the classes, use a variation of the following command\", \":\\ndotnet ef dbcontext scaffold \\\"CONNECTION STRING\\\" Microsoft.EntityFrameworkCore.SqlServer -c\\nMyDbCo\", \"ntext -t Product -t Customer\\nThe preceding command connects to the database using the specified conn\", \"ection string and the\\nMicrosoft.EntityFrameworkCore.SqlServer provider. Once connected, a database c\", \"ontext class named\\nMyDbContext is created. Additionally, supporting classes are created for the Prod\", \"uct and Customer\\ntables that were specified with the -t options. There are many configuration option\", \"s for this command\\nto generate the class hierarchy appropriate for your database. For a complete ref\", \"erence, see the\\ncommand\\u2019s documentation.\\nMore information about EF Core can be found on the Microsof\", \"t Docs site.\\nInteract with web services\\nWhen ASP.NET was first released, SOAP services were the pref\", \"erred way for web servers and clients to\\nexchange data. Much has changed since that time, and the pr\", \"eferred interactions with services have\\nshifted to direct HTTP client interactions. With ASP.NET Cor\", \"e and Blazor, you can register the\\nconfiguration of your HttpClient in Program.cs or in the Startup \", \"class\\u2019s ConfigureServices method. Use\\nthat configuration when you need to interact with the HTTP end\", \"point. Consider the following\\nconfiguration code:\\n54 CHAPTER 10 | Work with data// in Program.cs\\nbui\", \"lder.Services.AddHttpClient(\\\"github\\\", client =>\\n{\\nclient.BaseAddress = new Uri(\\\"http://api.github.co\", \"m/\\\");\\n// Github API versioning\\nclient.DefaultRequestHeaders.Add(\\\"Accept\\\", \\\"application/vnd.github.v3\", \"+json\\\");\\n// Github requires a user-agent\\nclient.DefaultRequestHeaders.Add(\\\"User-Agent\\\", \\\"BlazorWebFo\", \"rms-Sample\\\");\\n});\\nWhenever you need to access data from GitHub, create a client with a name of githu\", \"b. The client is\\nconfigured with the base address, and the request headers are set appropriately. In\", \"ject the\\nIHttpClientFactory into your Blazor components with the @inject directive or an [Inject] at\", \"tribute on a\\nproperty. Create your named client and interact with services using the following synta\", \"x:\\n@inject IHttpClientFactory factory\\n...\\n@code {\\nprotected override async Task OnInitializedAsync()\", \"\\n{\\nvar client = factory.CreateClient(\\\"github\\\");\\nvar response = await client.GetAsync(\\\"repos/dotnet/d\", \"ocs/issues\\\");\\nresponse.EnsureStatusCode();\\nvar content = await response.Content.ReadAsStringAsync();\", \"\\n}\\n}\\nThis method returns the string describing the collection of issues in the dotnet/docs GitHub re\", \"pository.\\nIt returns content in JSON format and is deserialized into appropriate GitHub issue object\", \"s. There are\\nmany ways that you can configure the HttpClientFactory to deliver preconfigured HttpCli\", \"ent objects.\\nTry configuring multiple HttpClient instances with different names and endpoints for th\", \"e various web\\nservices you work with. This approach will make your interactions with those services \", \"easier to work\\nwith on each page. For more information, see Make HTTP requests using IHttpClientFact\", \"ory.\\n55 CHAPTER 10 | Work with data11\\nCHAPTER\\nModules, handlers, and\\nmiddleware\\nAn ASP.NET Core app \", \"is built upon a series of middleware. Middleware is handlers that are arranged\\ninto a pipeline to ha\", \"ndle requests and responses. In a Web Forms app, HTTP handlers and modules\\nsolve similar problems. I\", \"n ASP.NET Core, modules, handlers, Global.asax.cs, and the app life cycle are\\nreplaced with middlewa\", \"re. In this chapter, you\\u2019ll learn about middleware in the context of a Blazor\\napp.\\nOverview\\nThe ASP.\", \"NET Core request pipeline consists of a sequence of request delegates, called one after the\\nother. T\", \"he following diagram demonstrates the concept. The thread of execution follows the black\\narrows.\\n56 \", \"CHAPTER 11 | Modules, handlers, and middlewareThe preceding diagram lacks a concept of lifecycle eve\", \"nts. This concept is foundational to how\\nASP.NET Web Forms requests are handled. This system makes i\", \"t easier to reason about what process\\nis occurring and allows middleware to be inserted at any point\", \". Middleware executes in the order in\\nwhich it\\u2019s added to the request pipeline. They\\u2019re also added i\", \"n code instead of configuration files,\\nusually in Startup.cs.\\nKatana\\nReaders familiar with Katana wi\", \"ll feel comfortable in ASP.NET Core. In fact, Katana is a framework from\\nwhich ASP.NET Core derives.\", \" It introduced similar middleware and pipeline patterns for ASP.NET 4.x.\\nMiddleware designed for Kat\", \"ana can be adapted to work with the ASP.NET Core pipeline.\\nCommon middleware\\nASP.NET 4.x includes ma\", \"ny modules. In a similar fashion, ASP.NET Core has many middleware\\ncomponents available as well. IIS\", \" modules may be used in some cases with ASP.NET Core. In other\\ncases, native ASP.NET Core middleware\", \" may be available.\\nThe following table lists replacement middleware and components in ASP.NET Core.\\n\", \"Module ASP.NET 4.x module ASP.NET Core option\\nHTTP errors CustomErrorModule Status Code Pages\\nMiddle\", \"ware\\n57 CHAPTER 11 | Modules, handlers, and middlewareModule ASP.NET 4.x module ASP.NET Core option\\n\", \"Default document DefaultDocumentModule Default Files Middleware\\nDirectory browsing DirectoryListingM\", \"odule Directory Browsing\\nMiddleware\\nDynamic compression DynamicCompressionModule Response Compressio\", \"n\\nMiddleware\\nFailed requests tracing FailedRequestsTracingModule ASP.NET Core Logging\\nFile caching F\", \"ileCacheModule Response Caching\\nMiddleware\\nHTTP caching HttpCacheModule Response Caching\\nMiddleware\\n\", \"HTTP logging HttpLoggingModule ASP.NET Core Logging\\nHTTP redirection HttpRedirectionModule URL Rewri\", \"ting\\nMiddleware\\nISAPI filters IsapiFilterModule Middleware\\nISAPI IsapiModule Middleware\\nRequest filt\", \"ering RequestFilteringModule URL Rewriting\\nMiddleware IRule\\nURL rewriting\\u2020 RewriteModule URL Rewriti\", \"ng\\nMiddleware\\nStatic compression StaticCompressionModule Response Compression\\nMiddleware\\nStatic cont\", \"ent StaticFileModule Static File Middleware\\nURL authorization UrlAuthorizationModule ASP.NET Core Id\", \"entity\\nThis list isn\\u2019t exhaustive but should give an idea of what mapping exists between the two fra\", \"meworks.\\nFor a more detailed list, see IIS modules with ASP.NET Core.\\nCustom middleware\\nBuilt-in mid\", \"dleware may not handle all scenarios needed for an app. In such cases, it makes sense to\\ncreate your\", \" own middleware. There are multiple ways of defining middleware, with the simplest being\\na simple de\", \"legate. Consider the following middleware, which accepts a culture request from a query\\nstring:\\npubl\", \"ic class Startup\\n{\\npublic void Configure(IApplicationBuilder app)\\n{\\napp.Use(async (context, next) =>\", \"\\n{\\nvar cultureQuery = context.Request.Query[\\\"culture\\\"];\\n58 CHAPTER 11 | Modules, handlers, and middl\", \"ewareif (!string.IsNullOrWhiteSpace(cultureQuery))\\n{\\nvar culture = new CultureInfo(cultureQuery);\\nCu\", \"ltureInfo.CurrentCulture = culture;\\nCultureInfo.CurrentUICulture = culture;\\n}\\n// Call the next deleg\", \"ate/middleware in the pipeline\\nawait next();\\n});\\napp.Run(async (context) =>\\nawait context.Response.W\", \"riteAsync(\\n$\\\"Hello {CultureInfo.CurrentCulture.DisplayName}\\\"));\\n}\\n}\\nMiddleware can also be defined a\", \"s class, either by implementing the IMiddleware interface or by\\nfollowing middleware convention. For\", \" more information, see Write custom ASP.NET Core middleware.\\n59 CHAPTER 11 | Modules, handlers, and \", \"middleware12\\nCHAPTER\\nApp configuration\\nThe primary way to load app configuration in Web Forms is wit\", \"h entries in the web.config file\\u2014either\\non the server or a related configuration file referenced by \", \"web.config. You can use the static\\nConfigurationManager object to interact with app settings, data r\", \"epository connection strings, and\\nother extended configuration providers that are added into the app\", \". It\\u2019s typical to see interactions\\nwith app configuration as seen in the following code:\\nvar configu\", \"rationValue = ConfigurationManager.AppSettings[\\\"ConfigurationSettingName\\\"];\\nvar connectionString =\\nC\", \"onfigurationManager.ConnectionStrings[\\\"MyDatabaseConnectionName\\\"].ConnectionString;\\nWith ASP.NET Cor\", \"e and server-side Blazor, the web.config file MAY be present if your app is hosted on\\na Windows IIS \", \"server. However, there\\u2019s no ConfigurationManager interaction with this configuration,\\nand you can re\", \"ceive more structured app configuration from other sources. Let\\u2019s take a look at how\\nconfiguration i\", \"s gathered and how you can still access configuration information from a web.config\\nfile.\\nConfigurat\", \"ion sources\\nASP.NET Core recognizes there are many configuration sources you may want to use for you\", \"r app. The\\nframework attempts to offer you the best of these features by default. Configuration is r\", \"ead and\\naggregated from these various sources by ASP.NET Core. Later loaded values for the same\\nconf\", \"iguration key take precedence over earlier values.\\nASP.NET Core was designed to be cloud-aware and t\", \"o make the configuration of apps easier for both\\noperators and developers. ASP.NET Core is environme\", \"nt-aware and knows if it\\u2019s running in your\\nProduction or Development environment. The environment in\", \"dicator is set in the\\nASPNETCORE_ENVIRONMENT system environment variable. If no value is configured,\", \" the app defaults\\nto running in the Production environment.\\nYour app can trigger and add configurati\", \"on from several sources based on the environment\\u2019s name.\\nBy default, the configuration is loaded fro\", \"m the following resources in the order listed:\\n1. appsettings.json file, if present\\n2. appsettings.{\", \"ENVIRONMENT_NAME}.json file, if present\\n3. User secrets file on disk, if present\\n4. Environment vari\", \"ables\\n5. Command-line arguments\\n60 CHAPTER 12 | App configurationappsettings.json format and access\\n\", \"The appsettings.json file can be hierarchical with values structured like the following JSON:\\n{\\n\\\"sec\", \"tion0\\\": {\\n\\\"key0\\\": \\\"value\\\",\\n\\\"key1\\\": \\\"value\\\"\\n},\\n\\\"section1\\\": {\\n\\\"key0\\\": \\\"value\\\",\\n\\\"key1\\\": \\\"value\\\"\\n}\\n}\\nWhe\", \"n presented with the preceding JSON, the configuration system flattens child values and\\nreferences t\", \"heir fully qualified hierarchical paths. A colon (:) character separates each property in the\\nhierar\", \"chy. For example, the configuration key section1:key0 accesses the section1 object literal\\u2019s key0\\nva\", \"lue.\\nUser secrets\\nUser secrets are:\\n\\u2022 Configuration values that are stored in a JSON file on the dev\", \"eloper\\u2019s workstation, outside of\\nthe app development folder.\\n\\u2022 Only loaded when running in the Devel\", \"opment environment.\\n\\u2022 Associated with a specific app.\\n\\u2022 Managed with the .NET CLI\\u2019s user-secrets com\", \"mand.\\nConfigure your app for secrets storage by executing the user-secrets command:\\ndotnet user-secr\", \"ets init\\nThe preceding command adds a UserSecretsId element to the project file. The element contain\", \"s a\\nGUID, which is used to associate secrets with the app. You can then define a secret with the set\", \"\\ncommand. For example:\\ndotnet user-secrets set \\\"Parent:ApiKey\\\" \\\"12345\\\"\\nThe preceding command makes t\", \"he Parent:ApiKey configuration key available on a developer\\u2019s\\nworkstation with the value 12345.\\nFor \", \"more information about creating, storing, and managing user secrets, see the Safe storage of app\\nsec\", \"rets in development in ASP.NET Core document.\\nEnvironment variables\\nThe next set of values loaded in\", \"to your app configuration is the system\\u2019s environment variables. All of\\nyour system\\u2019s environment va\", \"riable settings are now accessible to you through the configuration API.\\n61 CHAPTER 12 | App configu\", \"rationHierarchical values are flattened and separated by colon characters when read inside your app.\", \"\\nHowever, some operating systems don\\u2019t allow the colon character environment variable names.\\nASP.NET\", \" Core addresses this limitation by converting values that have double-underscores (__) into a\\ncolon \", \"when they\\u2019re accessed. The Parent:ApiKey value from the user secrets section above can be\\noverridden\", \" with the environment variable Parent__ApiKey.\\nCommand-line arguments\\nConfiguration can also be prov\", \"ided as command-line arguments when your app is started. Use the\\ndouble-dash (--) or forward-slash (\", \"/) notation to indicate the name of the configuration value to set\\nand the value to be configured. T\", \"he syntax resembles the following commands:\\ndotnet run CommandLineKey1=value1 --CommandLineKey2=valu\", \"e2 /CommandLineKey3=value3\\ndotnet run --CommandLineKey1 value1 /CommandLineKey2 value2\\ndotnet run Pa\", \"rent:ApiKey=67890\\nThe return of web.config\\nIf you\\u2019ve deployed your app to Windows on IIS, the web.co\", \"nfig file still configures IIS to manage your\\napp. By default, IIS adds a reference to the ASP.NET C\", \"ore Module (ANCM). ANCM is a native IIS\\nmodule that hosts your app in place of the Kestrel web serve\", \"r. This web.config section resembles the\\nfollowing XML markup:\\n<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?\", \">\\n<configuration>\\n<location path=\\\".\\\" inheritInChildApplications=\\\"false\\\">\\n<system.webServer>\\n<handler\", \"s>\\n<add name=\\\"aspNetCore\\\" path=\\\"*\\\" verb=\\\"*\\\" modules=\\\"AspNetCoreModuleV2\\\"\\nresourceType=\\\"Unspecified\\\" \", \"/>\\n</handlers>\\n<aspNetCore processPath=\\\".\\\\MyApp.exe\\\"\\nstdoutLogEnabled=\\\"false\\\"\\nstdoutLogFile=\\\".\\\\logs\\\\\", \"stdout\\\"\\nhostingModel=\\\"inprocess\\\" />\\n</system.webServer>\\n</location>\\n</configuration>\\nApp-specific co\", \"nfiguration can be defined by nesting an environmentVariables element in the\\naspNetCore element. The\", \" values defined in this section are presented to the ASP.NET Core app as\\nenvironment variables. The \", \"environment variables load appropriately during that segment of app\\nstartup.\\n<aspNetCore processPath\", \"=\\\"dotnet\\\"\\narguments=\\\".\\\\MyApp.dll\\\"\\nstdoutLogEnabled=\\\"false\\\"\\nstdoutLogFile=\\\".\\\\logs\\\\stdout\\\"\\nhostingMode\", \"l=\\\"inprocess\\\">\\n<environmentVariables>\\n<environmentVariable name=\\\"ASPNETCORE_ENVIRONMENT\\\" value=\\\"Deve\", \"lopment\\\" />\\n62 CHAPTER 12 | App configuration<environmentVariable name=\\\"Parent:ApiKey\\\" value=\\\"67890\\\"\", \" />\\n</environmentVariables>\\n</aspNetCore>\\nRead configuration in the app\\nASP.NET Core provides app co\", \"nfiguration through the IConfiguration interface. This configuration\\ninterface should be requested b\", \"y your Blazor components, Blazor pages, and any other ASP.NET Core-\\nmanaged class that needs access \", \"to configuration. The ASP.NET Core framework will automatically\\npopulate this interface with the res\", \"olved configuration configured earlier. On a Blazor page or a\\ncomponent\\u2019s Razor markup, you can inje\", \"ct the IConfiguration object with an @inject directive at the\\ntop of the .razor file like this:\\n@inj\", \"ect IConfiguration Configuration\\nThis preceding statement makes the IConfiguration object available \", \"as the Configuration variable\\nthroughout the rest of the Razor template.\\nIndividual configuration se\", \"ttings can be read by specifying the configuration setting hierarchy sought\\nas an indexer parameter:\", \"\\nvar mySetting = Configuration[\\\"section1:key0\\\"];\\nYou can fetch entire configuration sections by usin\", \"g the GetSection method to retrieve a collection of\\nkeys at a specific location with a syntax simila\", \"r to GetSection(\\\"section1\\\") to retrieve the configuration\\nfor section1 from the earlier example.\\nStr\", \"ongly typed configuration\\nWith Web Forms, it was possible to create a strongly typed configuration t\", \"ype that inherited from the\\nConfigurationSection type and associated types. A ConfigurationSection a\", \"llowed you to configure\\nsome business rules and processing for those configuration values.\\nIn ASP.NE\", \"T Core, you can specify a class hierarchy that will receive the configuration values. These\\nclasses:\", \"\\n\\u2022 Don\\u2019t need to inherit from a parent class.\\n\\u2022 Should include public properties that match the prop\", \"erties and type references for the\\nconfiguration structure you wish to capture.\\nFor the earlier apps\", \"ettings.json sample, you could define the following classes to capture the values:\\npublic class MyCo\", \"nfig\\n{\\npublic MyConfigSection section0 { get; set;}\\npublic MyConfigSection section1 { get; set;}\\n}\\np\", \"ublic class MyConfigSection\\n{\\n63 CHAPTER 12 | App configurationpublic string key0 { get; set; }\\npubl\", \"ic string key1 { get; set; }\\n}\\nThis class hierarchy can be populated by adding the following line to\", \" the Startup.ConfigureServices\\nmethod (or appropriate location in Program.cs using the builder.Servi\", \"ces property instead of services):\\nservices.Configure<MyConfig>(Configuration);\\nIn the rest of the a\", \"pp, you can add an input parameter to classes or an @inject directive in Razor\\ntemplates of type IOp\", \"tions<MyConfig> to receive the strongly typed configuration settings. The\\nIOptions<MyConfig>.Value p\", \"roperty will yield the MyConfig value populated from the configuration\\nsettings.\\n@inject IOptions<My\", \"Config> options\\n@code {\\nvar MyConfiguration = options.Value;\\nvar theSetting = MyConfiguration.sectio\", \"n1.key0;\\n}\\nMore information about the Options feature can be found in the Options pattern in ASP.NET\", \" Core\\ndocument.\\n64 CHAPTER 12 | App configuration13\\nCHAPTER\\nSecurity: Authentication\\nand Authorizati\", \"on in\\nASP.NET Web Forms and\\nBlazor\\nMigrating from an ASP.NET Web Forms application to Blazor will al\", \"most certainly require updating\\nhow authentication and authorization are performed, assuming the app\", \"lication had authentication\\nconfigured. This chapter will cover how to migrate from the ASP.NET Web \", \"Forms universal provider\\nmodel (for membership, roles, and user profiles) and how to work with ASP.N\", \"ET Core Identity from\\nBlazor apps. While this chapter will cover the high-level steps and considerat\", \"ions, the detailed steps\\nand scripts may be found in the referenced documentation.\\nASP.NET universal\", \" providers\\nSince ASP.NET 2.0, the ASP.NET Web Forms platform has supported a provider model for a va\", \"riety of\\nfeatures, including membership. The universal membership provider, along with the optional \", \"role\\nprovider, is commonly deployed with ASP.NET Web Forms applications. It offers a robust and secu\", \"re\\nway to manage authentication and authorization that continues to work well today. The most recent\", \"\\noffering of these universal providers is available as a NuGet package, Microsoft.AspNet.Providers.\\n\", \"The Universal Providers work with a SQL database schema that includes tables like\\naspnet_Application\", \"s, aspnet_Membership, aspnet_Roles, and aspnet_Users. When configured by\\nrunning the aspnet_regsql.e\", \"xe command, the providers install tables and stored procedures that\\nprovide all of the necessary que\", \"ries and commands to work with the underlying data. The database\\nschema and these stored procedures \", \"are not compatible with newer ASP.NET Identity and ASP.NET\\nCore Identity systems, so existing data m\", \"ust be migrated into the new system. Figure 1 shows an\\nexample table schema configured for universal\", \" providers.\\n65 CHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blaz\", \"orThe universal provider handles users, membership, roles, and profiles. Users are assigned globally\", \"\\nunique identifiers and basic information like userId, userName etc. are stored in the aspnet_Users\\n\", \"table. Authentication information, such as password, password format, password salt, lockout counter\", \"s\\nand details, etc. are stored in the aspnet_Membership table. Roles consist simply of names and uni\", \"que\\nidentifiers, which are assigned to users via the aspnet_UsersInRoles association table, providin\", \"g a\\nmany-to-many relationship.\\nIf your existing system is using roles in addition to membership, you\", \" will need to migrate the user\\naccounts, the associated passwords, the roles, and the role membershi\", \"p into ASP.NET Core Identity.\\nYou will also most likely need to update your code where you\\u2019re curren\", \"tly performing role checks\\nusing if statements to instead leverage declarative filters, attributes, \", \"and/or tag helpers. We will review\\nmigration considerations in greater detail at the end of this cha\", \"pter.\\nAuthorization configuration in Web Forms\\nTo configure authorized access to certain pages in an\", \" ASP.NET Web Forms application, typically you\\nspecify that certain pages or folders are inaccessible\", \" to anonymous users. This configuration is done in\\nthe web.config file:\\n<?xml version=\\\"1.0\\\"?>\\n<confi\", \"guration>\\n<system.web>\\n<authentication mode=\\\"Forms\\\">\\n<forms defaultUrl=\\\"~/home.aspx\\\" loginUrl=\\\"~/log\", \"in.aspx\\\"\\nslidingExpiration=\\\"true\\\" timeout=\\\"2880\\\"></forms>\\n</authentication>\\n<authorization>\\n<deny us\", \"ers=\\\"?\\\" />\\n</authorization>\\n</system.web>\\n</configuration>\\nThe authentication configuration section \", \"sets up the forms authentication for the application. The\\nauthorization section is used to disallow \", \"anonymous users for the entire application. However, you\\ncan provide more granular authorization rul\", \"es on a per-location basis as well as apply role-based\\nauthorization checks.\\n<location path=\\\"login.a\", \"spx\\\">\\n<system.web>\\n66 CHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms a\", \"nd Blazor<authorization>\\n<allow users=\\\"*\\\" />\\n</authorization>\\n</system.web>\\n</location>\\nThe above co\", \"nfiguration, when combined with the first one, would allow anonymous users to access\\nthe login page,\", \" overriding the site-wide restriction on non-authenticated users.\\n<location path=\\\"/admin\\\">\\n<system.w\", \"eb>\\n<authorization>\\n<allow roles=\\\"Administrators\\\" />\\n<deny users=\\\"*\\\" />\\n</authorization>\\n</system.we\", \"b>\\n</location>\\nThe above configuration, when combined with the others, restricts access to the /admi\", \"n folder and all\\nresources within it to members of the \\u201cAdministrators\\u201d role. This restriction could\", \" also be applied by\\nplacing a separate web.config file within the /admin folder root.\\nAuthorization \", \"code in Web Forms\\nIn addition to configuring access using web.config, you can also programmatically \", \"configure access\\nand behavior in your Web Forms application. For instance, you can restrict the abil\", \"ity to perform\\ncertain operations or view certain data based on the user\\u2019s role.\\nThis code can be us\", \"ed both in code-behind logic as well as in the page itself:\\n<% if (HttpContext.Current.User.IsInRole\", \"(\\\"Administrators\\\")) { %>\\n<a href=\\\"/admin\\\">Go To Admin</a>\\n<% } %>\\nIn addition to checking user role \", \"membership, you can also determine if they are authenticated\\n(though often this is better done using\", \" the location-based configuration covered above). Below is an\\nexample of this approach.\\nprotected vo\", \"id Page_Load(object sender, EventArgs e)\\n{\\nif (!User.Identity.IsAuthenticated)\\n{\\nFormsAuthentication\", \".RedirectToLoginPage();\\n}\\nif (!Roles.IsUserInRole(User.Identity.Name, \\\"Administrators\\\"))\\n{\\nMessageLa\", \"bel.Text = \\\"Only administrators can view this.\\\";\\nSecretPanel.Visible = false;\\n}\\n}\\nIn the code above,\", \" role-based access control (RBAC) is used to determine whether certain elements of\\nthe page, such as\", \" a SecretPanel, are visible based on the current user\\u2019s role.\\n67 CHAPTER 13 | Security: Authenticati\", \"on and Authorization in ASP.NET Web Forms and BlazorTypically, ASP.NET Web Forms applications config\", \"ure security within the web.config file and then add\\nadditional checks where needed in .aspx pages a\", \"nd their related .aspx.cs code-behind files. Most\\napplications leverage the universal membership pro\", \"vider, frequently with the additional role provider.\\nASP.NET Core Identity\\nAlthough still tasked wit\", \"h authentication and authorization, ASP.NET Core Identity uses a different set\\nof abstractions and a\", \"ssumptions when compared to the universal providers. For example, the new\\nIdentity model supports th\", \"ird party authentication, allowing users to authenticate using a social media\\naccount or other trust\", \"ed authentication provider. ASP.NET Core Identity supports UI for commonly\\nneeded pages like login, \", \"logout, and register. It leverages EF Core for its data access, and uses EF Core\\nmigrations to gener\", \"ate the necessary schema required to support its data model. This introduction to\\nIdentity on ASP.NE\", \"T Core provides a good overview of what is included with ASP.NET Core Identity\\nand how to get starte\", \"d working with it. If you haven\\u2019t already set up ASP.NET Core Identity in your\\napplication and its d\", \"atabase, it will help you get started.\\nRoles, claims, and policies\\nBoth the universal providers and \", \"ASP.NET Core Identity support the concept of roles. You can create\\nroles for users and assign users \", \"to roles. Users can belong to any number of roles, and you can verify\\nrole membership as part of you\", \"r authorization implementation.\\nIn addition to roles, ASP.NET Core identity supports the concepts of\", \" claims and policies. While a role\\nshould specifically correspond to a set of resources a user in th\", \"at role should be able to access, a\\nclaim is simply part of a user\\u2019s identity. A claim is a name val\", \"ue pair that represents what the subject\\nis, not what the subject can do.\\nIt is possible to directly\", \" inspect a user\\u2019s claims and determine based on these values whether a user\\nshould be given access t\", \"o a resource. However, such checks are often repetitive and scattered\\nthroughout the system. A bette\", \"r approach is to define a policy.\\nAn authorization policy consists of one or more requirements. Poli\", \"cies are registered as part of the\\nauthorization service configuration in the ConfigureServices meth\", \"od of Startup.cs. For example, the\\nfollowing code snippet configures a policy called \\u201cCanadiansOnly\\u201d\", \", which has the requirement that the\\nuser has the Country claim with the value of \\u201cCanada\\u201d.\\nservices\", \".AddAuthorization(options =>\\n{\\noptions.AddPolicy(\\\"CanadiansOnly\\\", policy => policy.RequireClaim(Clai\", \"mTypes.Country,\\n\\\"Canada\\\"));\\n});\\nYou can learn more about how to create custom policies in the docume\", \"ntation.\\nWhether you\\u2019re using policies or roles, you can specify that a particular page in your Blaz\", \"or\\napplication requires that role or policy with the [Authorize] attribute, applied with the @attrib\", \"ute\\ndirective.\\nRequiring a role:\\n68 CHAPTER 13 | Security: Authentication and Authorization in ASP.N\", \"ET Web Forms and Blazor@attribute [Authorize(Roles =\\\"administrators\\\")]\\nRequiring a policy be satisfi\", \"ed:\\n@attribute [Authorize(Policy =\\\"CanadiansOnly\\\")]\\nIf you need access to a user\\u2019s authentication st\", \"ate, roles, or claims in your code, there are two primary\\nways to achieve this functionality. The fi\", \"rst is to receive the authentication state as a cascading\\nparameter. The second is to access the sta\", \"te using an injected AuthenticationStateProvider. The\\ndetails of each of these approaches are descri\", \"bed in the Blazor Security documentation.\\nThe following code shows how to receive the Authentication\", \"State as a cascading parameter:\\n[CascadingParameter]\\nprivate Task<AuthenticationState> authenticatio\", \"nStateTask { get; set; }\\nWith this parameter in place, you can get the user using this code:\\nvar aut\", \"hState = await authenticationStateTask;\\nvar user = authState.User;\\nThe following code shows how to i\", \"nject the AuthenticationStateProvider:\\n@using Microsoft.AspNetCore.Components.Authorization\\n@inject \", \"AuthenticationStateProvider AuthenticationStateProvider\\nWith the provider in place, you can gain acc\", \"ess to the user with the following code:\\nAuthenticationState authState = await\\nAuthenticationStatePr\", \"ovider.GetAuthenticationStateAsync();\\nClaimsPrincipal user = authState.User;\\nif (user.Identity.IsAut\", \"henticated)\\n{\\n// work with user.Claims and/or user.Roles\\n}\\nNote: The AuthorizeView component, covere\", \"d later in this chapter, provides a declarative way to\\ncontrol what a user sees on a page or compone\", \"nt.\\nTo work with users and claims (in Blazor Server applications) you may also need to inject a\\nUser\", \"Manager<T> (use IdentityUser for default) which you can use to enumerate and modify claims\\nfor a use\", \"r. First inject the type and assign it to a property:\\n@inject UserManager<IdentityUser> MyUserManage\", \"r\\nThen use it to work with the user\\u2019s claims. The following sample shows how to add and persist a cl\", \"aim\\non a user:\\nprivate async Task AddCountryClaim()\\n{\\nvar authState = await AuthenticationStateProvi\", \"der.GetAuthenticationStateAsync();\\nvar user = authState.User;\\nvar identityUser = await MyUserManager\", \".FindByNameAsync(user.Identity.Name);\\nif (!user.HasClaim(c => c.Type == ClaimTypes.Country))\\n{\\n69 CH\", \"APTER 13 | Security: Authentication and Authorization in ASP.NET Web Forms and Blazor// stores the c\", \"laim in the cookie\\nClaimsIdentity id = new ClaimsIdentity();\\nid.AddClaim(new Claim(ClaimTypes.Countr\", \"y, \\\"Canada\\\"));\\nuser.AddIdentity(id);\\n// save the claim in the database\\nawait MyUserManager.AddClaimA\", \"sync(identityUser, new Claim(ClaimTypes.Country,\\n\\\"Canada\\\"));\\n}\\n}\\nIf you need to work with roles, fol\", \"low the same approach. You may need to inject a RoleManager<T>\\n(use IdentityRole for default type) t\", \"o list and manage the roles themselves.\\nNote: In Blazor WebAssembly projects, you will need to provi\", \"de server APIs to perform these\\noperations (instead of using UserManager<T> or RoleManager<T> direct\", \"ly). A Blazor WebAssembly\\nclient application would manage claims and/or roles by securely calling AP\", \"I endpoints exposed for\\nthis purpose.\\nMigration guide\\nMigrating from ASP.NET Web Forms and universal\", \" providers to ASP.NET Core Identity requires several\\nsteps:\\n1. Create ASP.NET Core Identity database\", \" schema in the destination database\\n2. Migrate data from universal provider schema to ASP.NET Core I\", \"dentity schema\\n3. Migrate configuration from the web.config to middleware and services, typically in\", \" Program.cs\\n(or a Startup class)\\n4. Update individual pages using controls and conditionals to use t\", \"ag helpers and new identity\\nAPIs.\\nEach of these steps is described in detail in the following sectio\", \"ns.\\nCreating the ASP.NET Core Identity schema\\nThere are several ways to create the necessary table s\", \"tructure used for ASP.NET Core Identity. The\\nsimplest is to create a new ASP.NET Core Web applicatio\", \"n. Choose Web Application and then change\\nAuthentication type to use Individual Accounts.\\n70 CHAPTER\", \" 13 | Security: Authentication and Authorization in ASP.NET Web Forms and BlazorFrom the command lin\", \"e, you can do the same thing by running dotnet new webapp -au Individual.\\nOnce the app has been crea\", \"ted, run it and register on the site. You should trigger a page like the one\\nshown below:\\n71 CHAPTER\", \" 13 | Security: Authentication and Authorization in ASP.NET Web Forms and BlazorClick on the \\u201cApply \", \"Migrations\\u201d button and the necessary database tables should be created for you.\\nIn addition, the mig\", \"ration files should appear in your project, as shown:\\n72 CHAPTER 13 | Security: Authentication and A\", \"uthorization in ASP.NET Web Forms and BlazorYou can run the migration yourself, without running the \", \"web application, using this command-line\\ntool:\\ndotnet ef database update\\nIf you would rather run a s\", \"cript to apply the new schema to an existing database, you can script these\\nmigrations from the comm\", \"and-line. Run this command to generate the script:\\ndotnet ef migrations script -o auth.sql\\nThe above\", \" command will produce a SQL script in the output file auth.sql, which can then be run\\nagainst whatev\", \"er database you like. If you have any trouble running dotnet ef commands, make sure\\nyou have the EF \", \"Core tools installed on your system.\\nIn the event you have additional columns on your source tables,\", \" you will need to identify the best\\nlocation for these columns in the new schema. Generally, columns\", \" found on the aspnet_Membership\\ntable should be mapped to the AspNetUsers table. Columns on aspnet_R\", \"oles should be mapped to\\nAspNetRoles. Any additional columns on the aspnet_UsersInRoles table would \", \"be added to the\\nAspNetUserRoles table.\\nIt\\u2019s also worth considering putting any additional columns on\", \" separate tables. So that future\\nmigrations won\\u2019t need to take into account such customizations of t\", \"he default identity schema.\\nMigrating data from universal providers to ASP.NET Core Identity\\nOnce yo\", \"u have the destination table schema in place, the next step is to migrate your user and role\\nrecords\", \" to the new schema. A complete list of the schema differences, including which columns map\\nto which \", \"new columns, can be found here.\\n73 CHAPTER 13 | Security: Authentication and Authorization in ASP.NE\", \"T Web Forms and BlazorTo migrate your users from membership to the new identity tables, you should f\", \"ollow the steps\\ndescribed in the documentation. After following these steps and the script provided,\", \" your users will\\nneed to change their password the next time they log in.\\nIt is possible to migrate \", \"user passwords but the process is much more involved. Requiring users to\\nupdate their passwords as p\", \"art of the migration process, and encouraging them to use new, unique\\npasswords, is likely to enhanc\", \"e the overall security of the application.\\nMigrating security settings from web.config to app startu\", \"p\\nAs noted above, ASP.NET membership and role providers are configured in the application\\u2019s\\nweb.conf\", \"ig file. Since ASP.NET Core apps are not tied to IIS and use a separate system for\\nconfiguration, th\", \"ese settings must be configured elsewhere. For the most part, ASP.NET Core Identity\\nis configured in\", \" the Program.cs file. Open the web project that was created earlier (to generate the\\nidentity table \", \"schema) and review its Program.cs (or Startup.cs) file.\\nThis code adds support for EF Core and Ident\", \"ity:\\n// Add services to the container.\\nvar connectionString = builder.Configuration.GetConnectionStr\", \"ing(\\\"DefaultConnection\\\");\\nbuilder.Services.AddDbContext<ApplicationDbContext>(options =>\\noptions.Use\", \"SqlServer(connectionString));\\nbuilder.Services.AddDatabaseDeveloperPageExceptionFilter();\\nbuilder.Se\", \"rvices.AddDefaultIdentity<IdentityUser>(options =>\\noptions.SignIn.RequireConfirmedAccount = true)\\n.A\", \"ddEntityFrameworkStores<ApplicationDbContext>();\\nThe AddDefaultIdentity extension method is used to \", \"configure Identity to use the default\\nApplicationDbContext and the framework\\u2019s IdentityUser type. If\", \" you\\u2019re using a custom IdentityUser, be\\nsure to specify its type here. If these extension methods ar\", \"en\\u2019t working in your application, check that\\nyou have the appropriate using statements and that you \", \"have the necessary NuGet package\\nreferences. For example, your project should have some version of t\", \"he\\nMicrosoft.AspNetCore.Identity.EntityFrameworkCore and Microsoft.AspNetCore.Identity.UI packages\\nr\", \"eferenced.\\nAlso in Program.cs you should see the necessary middleware configured for the site. Speci\", \"fically,\\nUseAuthentication and UseAuthorization should be set up, and in the proper location.\\n// Con\", \"figure the HTTP request pipeline.\\nif (app.Environment.IsDevelopment())\\n{\\napp.UseMigrationsEndPoint()\", \";\\n}\\nelse\\n{\\napp.UseExceptionHandler(\\\"/Error\\\");\\n// The default HSTS value is 30 days. You may want to \", \"change this for production\\nscenarios, see https://aka.ms/aspnetcore-hsts.\\napp.UseHsts();\\n}\\napp.UseHt\", \"tpsRedirection();\\napp.UseStaticFiles();\\n74 CHAPTER 13 | Security: Authentication and Authorization i\", \"n ASP.NET Web Forms and Blazorapp.UseRouting();\\napp.UseAuthentication();\\napp.UseAuthorization();\\n//a\", \"pp.MapControllers();\\napp.MapBlazorHub();\\napp.MapFallbackToPage(\\\"/_Host\\\");\\nASP.NET Identity does not \", \"configure anonymous or role-based access to locations from Program.cs.\\nYou will need to migrate any \", \"location-specific authorization configuration data to filters in ASP.NET\\nCore. Make note of which fo\", \"lders and pages will require such updates. You will make these changes in\\nthe next section.\\nUpdating\", \" individual pages to use ASP.NET Core Identity abstractions\\nIn your ASP.NET Web Forms application, i\", \"f you had web.config settings to deny access to certain\\npages or folders to anonymous users, you wou\", \"ld migrate these changes by adding the [Authorize]\\nattribute to such pages:\\n@attribute [Authorize]\\nI\", \"f you further had denied access except to those users belonging to a certain role, you would likewis\", \"e\\nmigrate this behavior by adding an attribute specifying a role:\\n@attribute [Authorize(Roles =\\\"admi\", \"nistrators\\\")]\\nThe [Authorize] attribute only works on @page components that are reached via the Blaz\", \"or Router.\\nThe attribute does not work with child components, which should instead use AuthorizeView\", \".\\nIf you have logic within page markup for determining whether to display some code to a certain use\", \"r,\\nyou can replace this with the AuthorizeView component. The AuthorizeView component selectively\\ndi\", \"splays UI depending on whether the user is authorized to see it. It also exposes a context variable\\n\", \"that can be used to access user information.\\n<AuthorizeView>\\n<Authorized>\\n<h1>Hello, @context.User.I\", \"dentity.Name!</h1>\\n<p>You can only see this content if you are authenticated.</p>\\n</Authorized>\\n<Not\", \"Authorized>\\n<h1>Authentication Failure!</h1>\\n<p>You are not signed in.</p>\\n</NotAuthorized>\\n</Author\", \"izeView>\\nYou can access the authentication state within procedural logic by accessing the user from \", \"a\\nTask<AuthenticationState configured with the [CascadingParameter] attribute. This configuration wi\", \"ll\\nget you access to the user, which can let you determine if they are authenticated and if they bel\", \"ong to\\na particular role. If you need to evaluate a policy procedurally, you can inject an instance \", \"of the\\nIAuthorizationService and calls the AuthorizeAsync method on it. The following sample code\\nde\", \"monstrates how to get user information and allow an authorized user to perform a task restricted\\nby \", \"the content-editor policy.\\n75 CHAPTER 13 | Security: Authentication and Authorization in ASP.NET Web\", \" Forms and Blazor@using Microsoft.AspNetCore.Authorization\\n@inject IAuthorizationService Authorizati\", \"onService\\n<button @onclick=\\\"@DoSomething\\\">Do something important</button>\\n@code {\\n[CascadingParamete\", \"r]\\nprivate Task<AuthenticationState> authenticationStateTask { get; set; }\\nprivate async Task DoSome\", \"thing()\\n{\\nvar user = (await authenticationStateTask).User;\\nif (user.Identity.IsAuthenticated)\\n{\\n// P\", \"erform an action only available to authenticated (signed-in) users.\\n}\\nif (user.IsInRole(\\\"admin\\\"))\\n{\\n\", \"// Perform an action only available to users in the 'admin' role.\\n}\\nif ((await AuthorizationService.\", \"AuthorizeAsync(user, \\\"content-editor\\\"))\\n.Succeeded)\\n{\\n// Perform an action only available to users s\", \"atisfying the\\n// 'content-editor' policy.\\n}\\n}\\n}\\nThe AuthenticationState first need to be set up as a\", \" cascading value before it can be bound to a\\ncascading parameter like this. That\\u2019s typically done us\", \"ing the CascadingAuthenticationState\\ncomponent. This configuration is typically done in App.razor:\\n<\", \"CascadingAuthenticationState>\\n<Router AppAssembly=\\\"@typeof(Program).Assembly\\\">\\n<Found Context=\\\"route\", \"Data\\\">\\n<AuthorizeRouteView RouteData=\\\"@routeData\\\"\\nDefaultLayout=\\\"@typeof(MainLayout)\\\" />\\n</Found>\\n<N\", \"otFound>\\n<LayoutView Layout=\\\"@typeof(MainLayout)\\\">\\n<p>Sorry, there's nothing at this address.</p>\\n</\", \"LayoutView>\\n</NotFound>\\n</Router>\\n</CascadingAuthenticationState>\\nSummary\\nBlazor uses the same secur\", \"ity model as ASP.NET Core, which is ASP.NET Core Identity. Migrating from\\nuniversal providers to ASP\", \".NET Core Identity is relatively straightforward, assuming not too much\\ncustomization was applied to\", \" the original data schema. Once the data has been migrated, working\\n76 CHAPTER 13 | Security: Authen\", \"tication and Authorization in ASP.NET Web Forms and Blazorwith authentication and authorization in B\", \"lazor apps is well documented, with configurable as well as\\nprogrammatic support for most security r\", \"equirements.\\nReferences\\n\\u2022 Introduction to Identity on ASP.NET Core\\n\\u2022 Migrate from ASP.NET Membership\", \" authentication to ASP.NET Core 2.0 Identity\\n\\u2022 Migrate Authentication and Identity to ASP.NET Core\\n\\u2022\", \" ASP.NET Core Blazor authentication and authorization\\n77 CHAPTER 13 | Security: Authentication and A\", \"uthorization in ASP.NET Web Forms and Blazor14\\nCHAPTER\\nMigrate from ASP.NET\\nWeb Forms to Blazor\\nMigr\", \"ating a code base from ASP.NET Web Forms to Blazor is a time-consuming task that requires\\nplanning. \", \"This chapter outlines the process. Something that can ease the transition is to ensure the\\napp adher\", \"es to an N-tier architecture, wherein the app model (in this case, Web Forms) is separate\\nfrom the b\", \"usiness logic. This logical separation of layers makes it clear what needs to move to .NET\\nCore and \", \"Blazor.\\nFor this example, the eShop app available on GitHub is used. eShop is a catalog service that\", \" provides\\nCRUD capabilities via form entry and validation.\\nWhy should a working app be migrated to B\", \"lazor? Many times, there\\u2019s no need. ASP.NET Web Forms\\nwill continue to be supported for many years. \", \"However, many of the features that Blazor provides are\\nonly supported on a migrated app. Such featur\", \"es include:\\n\\u2022 Performance improvements in the framework such as Span<T>\\n\\u2022 Ability to run as WebAssem\", \"bly\\n\\u2022 Cross-platform support for Linux and macOS\\n\\u2022 App-local deployment or shared framework deployme\", \"nt without impacting other apps\\nIf these or other new features are compelling enough, there may be v\", \"alue in migrating the app. The\\nmigration can take different shapes; it can be the entire app, or onl\", \"y certain endpoints that require the\\nchanges. The decision to migrate is ultimately based on the bus\", \"iness problems to be solved by the\\ndeveloper.\\nServer-side versus client-side hosting\\nAs described in\", \" the hosting models chapter, a Blazor app can be hosted in two different ways: server-\\nside and clie\", \"nt-side. The server-side model uses ASP.NET Core SignalR connections to manage the\\nDOM updates while\", \" running any actual code on the server. The client-side model runs as\\nWebAssembly within a browser a\", \"nd requires no server connections. There are a number of differences\\nthat may affect which is best f\", \"or a specific app:\\n\\u2022 Running as WebAssembly doesn\\u2019t support all features (such as threading) at the \", \"current time\\n\\u2022 Chatty communication between the client and server may cause latency issues in server\", \"-side\\nmode\\n78 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor\\u2022 Access to databases and interna\", \"l or protected services require a separate service with client-\\nside hosting\\nAt the time of writing,\", \" the server-side model more closely resembles Web Forms. Most of this chapter\\nfocuses on the server-\", \"side hosting model, as it\\u2019s production-ready.\\nCreate a new project\\nThis initial migration step is to\", \" create a new project. This project type is based on the SDK style\\nprojects of .NET and simplifies m\", \"uch of the boilerplate that was used in previous project formats. For\\nmore detail, please see the ch\", \"apter on Project Structure.\\nOnce the project has been created, install the libraries that were used \", \"in the previous project. In older\\nWeb Forms projects, you may have used the packages.config file to \", \"list the required NuGet packages.\\nIn the new SDK-style project, packages.config has been replaced wi\", \"th <PackageReference> elements\\nin the project file. A benefit to this approach is that all dependenc\", \"ies are installed transitively. You only\\nlist the top-level dependencies you care about.\\nMany of the\", \" dependencies you\\u2019re using are available for .NET, including Entity Framework 6 and\\nlog4net. If ther\", \"e\\u2019s no .NET or .NET Standard version available, the .NET Framework version can often\\nbe used. Your m\", \"ileage may vary. Any API used that isn\\u2019t available in .NET causes a runtime error. Visual\\nStudio not\", \"ifies you of such packages. A yellow icon appears on the project\\u2019s References node in\\nSolution Explo\", \"rer.\\nIn the Blazor-based eShop project, you can see the packages that are installed. Previously, the\", \"\\npackages.config file listed every package used in the project, resulting in a file almost 50 lines \", \"long. A\\nsnippet of packages.config is:\\n<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<packages>\\n...\\n<packag\", \"e id=\\\"Microsoft.ApplicationInsights.Agent.Intercept\\\" version=\\\"2.4.0\\\"\\ntargetFramework=\\\"net472\\\" />\\n<pa\", \"ckage id=\\\"Microsoft.ApplicationInsights.DependencyCollector\\\" version=\\\"2.9.1\\\"\\ntargetFramework=\\\"net472\", \"\\\" />\\n<package id=\\\"Microsoft.ApplicationInsights.PerfCounterCollector\\\" version=\\\"2.9.1\\\"\\ntargetFramewor\", \"k=\\\"net472\\\" />\\n<package id=\\\"Microsoft.ApplicationInsights.Web\\\" version=\\\"2.9.1\\\" targetFramework=\\\"net47\", \"2\\\"\\n/>\\n<package id=\\\"Microsoft.ApplicationInsights.WindowsServer\\\" version=\\\"2.9.1\\\"\\ntargetFramework=\\\"net\", \"472\\\" />\\n<package id=\\\"Microsoft.ApplicationInsights.WindowsServer.TelemetryChannel\\\"\\nversion=\\\"2.9.1\\\" t\", \"argetFramework=\\\"net472\\\" />\\n<package id=\\\"Microsoft.AspNet.FriendlyUrls\\\" version=\\\"1.0.2\\\" targetFramewo\", \"rk=\\\"net472\\\" />\\n<package id=\\\"Microsoft.AspNet.FriendlyUrls.Core\\\" version=\\\"1.0.2\\\" targetFramework=\\\"net\", \"472\\\"\\n/>\\n<package id=\\\"Microsoft.AspNet.ScriptManager.MSAjax\\\" version=\\\"5.0.0\\\"\\ntargetFramework=\\\"net472\\\"\", \" />\\n<package id=\\\"Microsoft.AspNet.ScriptManager.WebForms\\\" version=\\\"5.0.0\\\"\\ntargetFramework=\\\"net472\\\" /\", \">\\n...\\n<package id=\\\"System.Memory\\\" version=\\\"4.5.1\\\" targetFramework=\\\"net472\\\" />\\n<package id=\\\"System.Nu\", \"merics.Vectors\\\" version=\\\"4.4.0\\\" targetFramework=\\\"net472\\\" />\\n<package id=\\\"System.Runtime.CompilerServ\", \"ices.Unsafe\\\" version=\\\"4.5.0\\\"\\n79 CHAPTER 14 | Migrate from ASP.NET Web Forms to BlazortargetFramework\", \"=\\\"net472\\\" />\\n<package id=\\\"System.Threading.Channels\\\" version=\\\"4.5.0\\\" targetFramework=\\\"net472\\\" />\\n<pa\", \"ckage id=\\\"System.Threading.Tasks.Extensions\\\" version=\\\"4.5.1\\\" targetFramework=\\\"net472\\\"\\n/>\\n<package id\", \"=\\\"WebGrease\\\" version=\\\"1.6.0\\\" targetFramework=\\\"net472\\\" />\\n</packages>\\nThe <packages> element includes\", \" all necessary dependencies. It\\u2019s difficult to identify which of these\\npackages are included because\", \" you require them. Some <package> elements are listed simply to\\nsatisfy the needs of dependencies yo\", \"u require.\\nThe Blazor project lists the dependencies you require within an <ItemGroup> element in th\", \"e project\\nfile:\\n<ItemGroup>\\n<PackageReference Include=\\\"Autofac\\\" Version=\\\"4.9.3\\\" />\\n<PackageReference\", \" Include=\\\"EntityFramework\\\" Version=\\\"6.4.4\\\" />\\n<PackageReference Include=\\\"log4net\\\" Version=\\\"2.0.12\\\" /\", \">\\n<PackageReference Include=\\\"Microsoft.Extensions.Logging.Log4Net.AspNetCore\\\"\\nVersion=\\\"2.2.12\\\" />\\n</\", \"ItemGroup>\\nOne NuGet package that simplifies the life of Web Forms developers is the Windows Compati\", \"bility\\nPack. Although .NET is cross-platform, some features are only available on Windows. Windows-\\n\", \"specific features are made available by installing the compatibility pack. Examples of such features\", \"\\ninclude the Registry, WMI, and Directory Services. The package adds around 20,000 APIs and activate\", \"s\\nmany services with which you may already be familiar. The eShop project doesn\\u2019t require the\\ncompat\", \"ibility pack; but if your projects use Windows-specific features, the package eases the\\nmigration ef\", \"forts.\\nEnable startup process\\nThe startup process for Blazor has changed from Web Forms and follows \", \"a similar setup for other\\nASP.NET Core services. When hosted server-side, Razor components are run a\", \"s part of a normal\\nASP.NET Core app. When hosted in the browser with WebAssembly, Razor components u\", \"se a similar\\nhosting model. The difference is the components are run as a separate service from any \", \"of the\\nbackend processes. Either way, the startup is similar.\\nThe Global.asax.cs file is the default\", \" startup page for Web Forms projects. In the eShop project, this file\\nconfigures the Inversion of Co\", \"ntrol (IoC) container and handles the various lifecycle events of the app\\nor request. Some of these \", \"events are handled with middleware (such as Application_BeginRequest).\\nOther events require the over\", \"riding of specific services via dependency injection (DI).\\nBy way of example, the Global.asax.cs fil\", \"e for eShop, contains the following code:\\npublic class Global : HttpApplication, IContainerProviderA\", \"ccessor\\n{\\nprivate static readonly ILog _log =\\nLogManager.GetLogger(System.Reflection.MethodBase.GetC\", \"urrentMethod().DeclaringType);\\nstatic IContainerProvider _containerProvider;\\nIContainer container;\\n8\", \"0 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazorpublic IContainerProvider ContainerProvider\\n{\", \"\\nget { return _containerProvider; }\\n}\\nprotected void Application_Start(object sender, EventArgs e)\\n{\", \"\\n// Code that runs on app startup\\nRouteConfig.RegisterRoutes(RouteTable.Routes);\\nBundleConfig.Regist\", \"erBundles(BundleTable.Bundles);\\nConfigureContainer();\\nConfigDataBase();\\n}\\n/// <summary>\\n/// Track th\", \"e machine name and the start time for the session inside the current\\nsession\\n/// </summary>\\nprotecte\", \"d void Session_Start(Object sender, EventArgs e)\\n{\\nHttpContext.Current.Session[\\\"MachineName\\\"] = Envi\", \"ronment.MachineName;\\nHttpContext.Current.Session[\\\"SessionStartTime\\\"] = DateTime.Now;\\n}\\n/// <summary>\", \"\\n/// https://autofaccn.readthedocs.io/en/latest/integration/webforms.html\\n/// </summary>\\nprivate voi\", \"d ConfigureContainer()\\n{\\nvar builder = new ContainerBuilder();\\nvar mockData = bool.Parse(Configurati\", \"onManager.AppSettings[\\\"UseMockData\\\"]);\\nbuilder.RegisterModule(new ApplicationModule(mockData));\\ncont\", \"ainer = builder.Build();\\n_containerProvider = new ContainerProvider(container);\\n}\\nprivate void Confi\", \"gDataBase()\\n{\\nvar mockData = bool.Parse(ConfigurationManager.AppSettings[\\\"UseMockData\\\"]);\\nif (!mockD\", \"ata)\\n{\\nDatabase.SetInitializer<CatalogDBContext>(container.Resolve<CatalogDBInitializer>());\\n}\\n}\\npro\", \"tected void Application_BeginRequest(object sender, EventArgs e)\\n{\\n//set the property to our new obj\", \"ect\\nLogicalThreadContext.Properties[\\\"activityid\\\"] = new ActivityIdHelper();\\nLogicalThreadContext.Pro\", \"perties[\\\"requestinfo\\\"] = new WebRequestInfo();\\n_log.Debug(\\\"Application_BeginRequest\\\");\\n}\\n}\\nThe prece\", \"ding file becomes the Program.cs file in server-side Blazor:\\n81 CHAPTER 14 | Migrate from ASP.NET We\", \"b Forms to Blazorusing eShopOnBlazor.Models;\\nusing eShopOnBlazor.Models.Infrastructure;\\nusing eShopO\", \"nBlazor.Services;\\nusing log4net;\\nusing System.Data.Entity;\\nusing eShopOnBlazor;\\nvar builder = WebApp\", \"lication.CreateBuilder(args);\\n// add services\\nbuilder.Services.AddRazorPages();\\nbuilder.Services.Add\", \"ServerSideBlazor();\\nif (builder.Configuration.GetValue<bool>(\\\"UseMockData\\\"))\\n{\\nbuilder.Services.AddS\", \"ingleton<ICatalogService, CatalogServiceMock>();\\n}\\nelse\\n{\\nbuilder.Services.AddScoped<ICatalogService\", \", CatalogService>();\\nbuilder.Services.AddScoped<IDatabaseInitializer<CatalogDBContext>,\\nCatalogDBIni\", \"tializer>();\\nbuilder.Services.AddSingleton<CatalogItemHiLoGenerator>();\\nbuilder.Services.AddScoped(_\", \" => new\\nCatalogDBContext(builder.Configuration.GetConnectionString(\\\"CatalogDBContext\\\")));\\n}\\nvar app \", \"= builder.Build();\\nnew LoggerFactory().AddLog4Net(\\\"log4Net.xml\\\");\\nif (app.Environment.IsDevelopment(\", \"))\\n{\\napp.UseDeveloperExceptionPage();\\n}\\nelse\\n{\\napp.UseExceptionHandler(\\\"/Home/Error\\\");\\n}\\n// Middlewa\", \"re for Application_BeginRequest\\napp.Use((ctx, next) =>\\n{\\nLogicalThreadContext.Properties[\\\"activityid\", \"\\\"] = new ActivityIdHelper(ctx);\\nLogicalThreadContext.Properties[\\\"requestinfo\\\"] = new WebRequestInfo(\", \"ctx);\\nreturn next();\\n});\\napp.UseStaticFiles();\\napp.UseRouting();\\napp.UseEndpoints(endpoints =>\\n{\\nend\", \"points.MapBlazorHub();\\nendpoints.MapFallbackToPage(\\\"/_Host\\\");\\n});\\nConfigDataBase(app);\\n82 CHAPTER 14\", \" | Migrate from ASP.NET Web Forms to Blazorvoid ConfigDataBase(IApplicationBuilder app)\\n{\\nusing (var\", \" scope = app.ApplicationServices.CreateScope())\\n{\\nvar initializer =\\nscope.ServiceProvider.GetService\", \"<IDatabaseInitializer<CatalogDBContext>>();\\nif (initializer != null)\\n{\\nDatabase.SetInitializer(initi\", \"alizer);\\n}\\n}\\n}\\napp.Run();\\nOne significant change you may notice from Web Forms is the prominence of \", \"dependency injection\\n(DI). DI has been a guiding principle in the ASP.NET Core design. It supports c\", \"ustomization of almost\\nall aspects of the ASP.NET Core framework. There\\u2019s even a built-in service pr\", \"ovider that can be used\\nfor many scenarios. If more customization is required, it can be supported b\", \"y many community\\nprojects. For example, you can carry forward your third-party DI library investment\", \".\\nIn the original eShop app, there\\u2019s some configuration for session management. Since server-side\\nBl\", \"azor uses ASP.NET Core SignalR for communication, the session state isn\\u2019t supported as the\\nconnectio\", \"ns may occur independent of an HTTP context. An app that uses the session state requires\\nrearchitect\", \"ing before running as a Blazor app.\\nFor more information about app startup, see App startup.\\nMigrate\", \" HTTP modules and handlers to middleware\\nHTTP modules and handlers are common patterns in Web Forms \", \"to control the HTTP request pipeline.\\nClasses that implement IHttpModule or IHttpHandler could be re\", \"gistered and process incoming\\nrequests. Web Forms configure modules and handlers in the web.config f\", \"ile. Web Forms is also heavily\\nbased on app lifecycle event handling. ASP.NET Core uses middleware i\", \"nstead. Middleware is\\nregistered in the Configure method of the Startup class. Middleware execution \", \"order is determined by\\nthe registration order.\\nIn the Enable startup process section, a lifecycle ev\", \"ent was raised by Web Forms as the\\nApplication_BeginRequest method. This event isn\\u2019t available in AS\", \"P.NET Core. One way to achieve this\\nbehavior is to implement middleware as seen in the Startup.cs fi\", \"le example. This middleware does the\\nsame logic and then transfers control to the next handler in th\", \"e middleware pipeline.\\nFor more information on migrating modules and handlers, see Migrate HTTP hand\", \"lers and modules to\\nASP.NET Core middleware.\\n83 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazo\", \"rMigrate static files\\nTo serve static files (for example, HTML, CSS, images, and JavaScript), the fi\", \"les must be exposed by\\nmiddleware. Calling the UseStaticFiles method enables the serving of static f\", \"iles from the web root\\npath. The default web root directory is wwwroot, but it can be customized. As\", \" included in the\\nProgram.cs file:\\n...\\napp.UseStaticFiles();\\n...\\nThe eShop project enables basic stat\", \"ic file access. There are many customizations available for static\\nfile access. For information on e\", \"nabling default files or a file browser, see Static files in ASP.NET Core.\\nMigrate runtime bundling \", \"and minification setup\\nBundling and minification are performance optimization techniques for reducin\", \"g the number and size\\nof server requests to retrieve certain file types. JavaScript and CSS often un\", \"dergo some form of\\nbundling or minification before being sent to the client. In ASP.NET Web Forms, t\", \"hese optimizations\\nare handled at run time. The optimization conventions are defined an App_Start/Bu\", \"ndleConfig.cs file.\\nIn ASP.NET Core, a more declarative approach is adopted. A file lists the files \", \"to be minified, along\\nwith specific minification settings.\\nFor more information on bundling and mini\", \"fication, see Bundle and minify static assets in ASP.NET\\nCore.\\nMigrate ASPX pages\\nA page in a Web Fo\", \"rms app is a file with the .aspx extension. A Web Forms page can often be mapped\\nto a component in B\", \"lazor. A Razor component is authored in a file with the .razor extension. For the\\neShop project, fiv\", \"e pages are converted to a Razor page.\\nFor example, the details view comprises three files in the We\", \"b Forms project: Details.aspx,\\nDetails.aspx.cs, and Details.aspx.designer.cs. When converting to Bla\", \"zor, the code-behind and markup\\nare combined into Details.razor. Razor compilation (equivalent to wh\", \"at\\u2019s in .designer.cs files) is stored\\nin the obj directory and isn\\u2019t, by default, viewable in Soluti\", \"on Explorer. The Web Forms page consists\\nof the following markup:\\n<%@ Page Title=\\\"Details\\\" Language=\", \"\\\"C#\\\" MasterPageFile=\\\"~/Site.Master\\\"\\nAutoEventWireup=\\\"true\\\" CodeBehind=\\\"Details.aspx.cs\\\"\\nInherits=\\\"eS\", \"hopLegacyWebForms.Catalog.Details\\\" %>\\n<asp:Content ID=\\\"Details\\\" ContentPlaceHolderID=\\\"MainContent\\\" r\", \"unat=\\\"server\\\">\\n<h2 class=\\\"esh-body-title\\\">Details</h2>\\n<div class=\\\"container\\\">\\n<div class=\\\"row\\\">\\n84 \", \"CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor<asp:Image runat=\\\"server\\\" CssClass=\\\"col-md-6 es\", \"h-picture\\\" ImageUrl='<%#\\\"/Pics/\\\"\\n+ product.PictureFileName%>' />\\n<dl class=\\\"col-md-6 dl-horizontal\\\">\", \"\\n<dt>Name\\n</dt>\\n<dd>\\n<asp:Label runat=\\\"server\\\" Text='<%#product.Name%>' />\\n</dd>\\n<dt>Description\\n</d\", \"t>\\n<dd>\\n<asp:Label runat=\\\"server\\\" Text='<%#product.Description%>' />\\n</dd>\\n<dt>Brand\\n</dt>\\n<dd>\\n<asp\", \":Label runat=\\\"server\\\" Text='<%#product.CatalogBrand.Brand%>' />\\n</dd>\\n<dt>Type\\n</dt>\\n<dd>\\n<asp:Label\", \" runat=\\\"server\\\" Text='<%#product.CatalogType.Type%>' />\\n</dd>\\n<dt>Price\\n</dt>\\n<dd>\\n<asp:Label CssCla\", \"ss=\\\"esh-price\\\" runat=\\\"server\\\"\\nText='<%#product.Price%>' />\\n</dd>\\n<dt>Picture name\\n</dt>\\n<dd>\\n<asp:La\", \"bel runat=\\\"server\\\" Text='<%#product.PictureFileName%>' />\\n</dd>\\n<dt>Stock\\n</dt>\\n<dd>\\n<asp:Label runa\", \"t=\\\"server\\\" Text='<%#product.AvailableStock%>' />\\n</dd>\\n<dt>Restock\\n</dt>\\n<dd>\\n<asp:Label runat=\\\"serv\", \"er\\\" Text='<%#product.RestockThreshold%>' />\\n</dd>\\n<dt>Max stock\\n</dt>\\n85 CHAPTER 14 | Migrate from A\", \"SP.NET Web Forms to Blazor<dd>\\n<asp:Label runat=\\\"server\\\" Text='<%#product.MaxStockThreshold%>' />\\n</\", \"dd>\\n</dl>\\n</div>\\n<div class=\\\"form-actions no-color esh-link-list\\\">\\n<a runat=\\\"server\\\" href='<%# GetRo\", \"uteUrl(\\\"EditProductRoute\\\", new {id\\n=product.Id}) %>' class=\\\"esh-link-item\\\">Edit\\n</a>\\n|\\n<a runat=\\\"ser\", \"ver\\\" href=\\\"~\\\" class=\\\"esh-link-item\\\">Back to list\\n</a>\\n</div>\\n</div>\\n</asp:Content>\\nThe preceding mar\", \"kup\\u2019s code-behind includes the following code:\\nusing eShopLegacyWebForms.Models;\\nusing eShopLegacyWe\", \"bForms.Services;\\nusing log4net;\\nusing System;\\nusing System.Web.UI;\\nnamespace eShopLegacyWebForms.Cat\", \"alog\\n{\\npublic partial class Details : System.Web.UI.Page\\n{\\nprivate static readonly ILog _log =\\nLogMa\", \"nager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);\\nprotected CatalogIte\", \"m product;\\npublic ICatalogService CatalogService { get; set; }\\nprotected void Page_Load(object sende\", \"r, EventArgs e)\\n{\\nvar productId = Convert.ToInt32(Page.RouteData.Values[\\\"id\\\"]);\\n_log.Info($\\\"Now load\", \"ing... /Catalog/Details.aspx?id={productId}\\\");\\nproduct = CatalogService.FindCatalogItem(productId);\\n\", \"this.DataBind();\\n}\\n}\\n}\\nWhen converted to Blazor, the Web Forms page translates to the following code\", \":\\n@page \\\"/Catalog/Details/{id:int}\\\"\\n@inject ICatalogService CatalogService\\n@inject ILogger<Details> \", \"Logger\\n<h2 class=\\\"esh-body-title\\\">Details</h2>\\n<div class=\\\"container\\\">\\n<div class=\\\"row\\\">\\n86 CHAPTER \", \"14 | Migrate from ASP.NET Web Forms to Blazor<img class=\\\"col-md-6 esh-picture\\\" src=\\\"@($\\\"/Pics/{_item\", \".PictureFileName}\\\")\\\">\\n<dl class=\\\"col-md-6 dl-horizontal\\\">\\n<dt>\\nName\\n</dt>\\n<dd>\\n@_item.Name\\n</dd>\\n<dt\", \">\\nDescription\\n</dt>\\n<dd>\\n@_item.Description\\n</dd>\\n<dt>\\nBrand\\n</dt>\\n<dd>\\n@_item.CatalogBrand.Brand\\n</\", \"dd>\\n<dt>\\nType\\n</dt>\\n<dd>\\n@_item.CatalogType.Type\\n</dd>\\n<dt>\\nPrice\\n</dt>\\n<dd>\\n@_item.Price\\n</dd>\\n<dt>\", \"\\nPicture name\\n</dt>\\n<dd>\\n@_item.PictureFileName\\n</dd>\\n<dt>\\nStock\\n</dt>\\n<dd>\\n@_item.AvailableStock\\n</\", \"dd>\\n<dt>\\nRestock\\n</dt>\\n87 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazor<dd>\\n@_item.RestockTh\", \"reshold\\n</dd>\\n<dt>\\nMax stock\\n</dt>\\n<dd>\\n@_item.MaxStockThreshold\\n</dd>\\n</dl>\\n</div>\\n<div class=\\\"form\", \"-actions no-color esh-link-list\\\">\\n<a href=\\\"@($\\\"/Catalog/Edit/{_item.Id}\\\")\\\" class=\\\"esh-link-item\\\">\\nEd\", \"it\\n</a>\\n|\\n<a href=\\\"/\\\" class=\\\"esh-link-item\\\">\\nBack to list\\n</a>\\n</div>\\n</div>\\n@code {\\nprivate Catalog\", \"Item _item;\\n[Parameter]\\npublic int Id { get; set; }\\nprotected override void OnInitialized()\\n{\\nLogger\", \".LogInformation(\\\"Now loading... /Catalog/Details/{Id}\\\", Id);\\n_item = CatalogService.FindCatalogItem(\", \"Id);\\n}\\n}\\nNotice that the code and markup are in the same file. Any required services are made access\", \"ible with\\nthe @inject attribute. Per the @page directive, this page can be accessed at the Catalog/D\", \"etails/{id}\\nroute. The value of the route\\u2019s {id} placeholder has been constrained to an integer. As \", \"described in the\\nrouting section, unlike Web Forms, a Razor component explicitly states its route an\", \"d any parameters\\nthat are included. Many Web Forms controls may not have exact counterparts in Blazo\", \"r. There\\u2019s often\\nan equivalent HTML snippet that will serve the same purpose. For example, the <asp:\", \"Label /> control\\ncan be replaced with an HTML <label> element.\\nModel validation in Blazor\\nIf your We\", \"b Forms code includes validation, you can transfer much of what you have with little-to-no\\nchanges. \", \"A benefit to running in Blazor is that the same validation logic can be run without needing\\ncustom J\", \"avaScript. Data annotations enable easy model validation.\\n88 CHAPTER 14 | Migrate from ASP.NET Web F\", \"orms to BlazorFor example, the Create.aspx page has a data entry form with validation. An example sn\", \"ippet would\\nlook like this:\\n<div class=\\\"form-group\\\">\\n<label class=\\\"control-label col-md-2\\\">Name</lab\", \"el>\\n<div class=\\\"col-md-3\\\">\\n<asp:TextBox ID=\\\"Name\\\" runat=\\\"server\\\" CssClass=\\\"form-control\\\"></asp:TextB\", \"ox>\\n<asp:RequiredFieldValidator runat=\\\"server\\\" ControlToValidate=\\\"Name\\\"\\nDisplay=\\\"Dynamic\\\"\\nCssClass=\\\"\", \"field-validation-valid text-danger\\\" ErrorMessage=\\\"The Name field is\\nrequired.\\\" />\\n</div>\\n</div>\\nIn B\", \"lazor, the equivalent markup is provided in a Create.razor file:\\n<EditForm Model=\\\"_item\\\" OnValidSubm\", \"it=\\\"@...\\\">\\n<DataAnnotationsValidator />\\n<div class=\\\"form-group\\\">\\n<label class=\\\"control-label col-md-\", \"2\\\">Name</label>\\n<div class=\\\"col-md-3\\\">\\n<InputText class=\\\"form-control\\\" @bind-Value=\\\"_item.Name\\\" />\\n<\", \"ValidationMessage For=\\\"(() => _item.Name)\\\" />\\n</div>\\n</div>\\n...\\n</EditForm>\\nThe EditForm context inc\", \"ludes validation support and can be wrapped around an input. Data\\nannotations are a common way to ad\", \"d validation. Such validation support can be added via the\\nDataAnnotationsValidator component. For m\", \"ore information on this mechanism, see ASP.NET Core\\nBlazor forms and validation.\\nMigrate configurati\", \"on\\nIn a Web Forms project, configuration data is most commonly stored in the web.config file. The\\nco\", \"nfiguration data is accessed with ConfigurationManager. Services were often required to parse\\nobject\", \"s. With .NET Framework 4.7.2, composability was added to the configuration via\\nConfigurationBuilders\", \". These builders allowed developers to add various sources for the configuration\\nthat was then compo\", \"sed at run time to retrieve the necessary values.\\nASP.NET Core introduced a flexible configuration s\", \"ystem that allows you to define the configuration\\nsource or sources used by your app and deployment.\", \" The ConfigurationBuilder infrastructure that you\\nmay be using in your Web Forms app was modeled aft\", \"er the concepts used in the ASP.NET Core\\nconfiguration system.\\nThe following snippet demonstrates ho\", \"w the Web Forms eShop project uses web.config to store\\nconfiguration values:\\n<configuration>\\n<config\", \"Sections>\\n<section name=\\\"entityFramework\\\"\\n89 CHAPTER 14 | Migrate from ASP.NET Web Forms to Blazorty\", \"pe=\\\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework,\\nVersion=6.0.0.0,\", \" Culture=neutral, PublicKeyToken=b77a5c561934e089\\\"\\nrequirePermission=\\\"false\\\" />\\n</configSections>\\n<c\", \"onnectionStrings>\\n<add name=\\\"CatalogDBContext\\\" connectionString=\\\"Data Source=(localdb)\\\\MSSQLLocalDB;\", \"\\nInitial Catalog=Microsoft.eShopOnContainers.Services.CatalogDb; Integrated Security=True;\\nMultipleA\", \"ctiveResultSets=True;\\\" providerName=\\\"System.Data.SqlClient\\\" />\\n</connectionStrings>\\n<appSettings>\\n<a\", \"dd key=\\\"UseMockData\\\" value=\\\"true\\\" />\\n<add key=\\\"UseCustomizationData\\\" value=\\\"false\\\" />\\n</appSettings>\", \"\\n</configuration>\\nIt\\u2019s common for secrets, such as database connection strings, to be stored within \", \"the web.config. The\\nsecrets are inevitably persisted in unsecure locations, such as source control. \", \"With Blazor on ASP.NET\\nCore, the preceding XML-based configuration is replaced with the following JS\", \"ON:\\n{\\n\\\"ConnectionStrings\\\": {\\n\\\"CatalogDBContext\\\": \\\"Data Source=(localdb)\\\\\\\\MSSQLLocalDB; Initial\\nCatal\", \"og=Microsoft.eShopOnContainers.Services.CatalogDb; Integrated Security=True;\\nMultipleActiveResultSet\", \"s=True;\\\"\\n},\\n\\\"UseMockData\\\": true,\\n\\\"UseCustomizationData\\\": false\\n}\\nJSON is the default configuration f\", \"ormat; however, ASP.NET Core supports many other formats,\\nincluding XML. There are also several comm\", \"unity-supported formats.\\nYou can access configuration values from the builder in Program.cs:\\nif (bui\", \"lder.Configuration.GetValue<bool>(\\\"UseMockData\\\"))\\n{\\nbuilder.Services.AddSingleton<ICatalogService, C\", \"atalogServiceMock>();\\n}\\nelse\\n{\\nbuilder.Services.AddScoped<ICatalogService, CatalogService>();\\nbuilde\", \"r.Services.AddScoped<IDatabaseInitializer<CatalogDBContext>,\\nCatalogDBInitializer>();\\nbuilder.Servic\", \"es.AddSingleton<CatalogItemHiLoGenerator>();\\nbuilder.Services.AddScoped(_ => new\\nCatalogDBContext(bu\", \"ilder.Configuration.GetConnectionString(\\\"CatalogDBContext\\\")));\\n}\\nBy default, environment variables, \", \"JSON files (appsettings.json and appsettings.{Environment}.json), and\\ncommand-line options are regis\", \"tered as valid configuration sources in the configuration object. The\\nconfiguration sources can be a\", \"ccessed via Configuration[key]. A more advanced technique is to bind\\nthe configuration data to objec\", \"ts using the options pattern. For more information on configuration\\nand the options pattern, see Con\", \"figuration in ASP.NET Core and Options pattern in ASP.NET Core,\\nrespectively.\\n90 CHAPTER 14 | Migrat\", \"e from ASP.NET Web Forms to BlazorMigrate data access\\nData access is an important aspect of any app.\", \" The eShop project stores catalog information in a\\ndatabase and retrieves the data with Entity Frame\", \"work (EF) 6. Since EF 6 is supported in .NET 5, the\\nproject can continue to use it.\\nThe following EF\", \"-related changes were necessary to eShop:\\n\\u2022 In .NET Framework, the DbContext object accepts a string\", \" of the form name=ConnectionString\\nand uses the connection string from ConfigurationManager.AppSetti\", \"ngs[ConnectionString] to\\nconnect. In .NET Core, this isn\\u2019t supported. The connection string must be \", \"supplied.\\n\\u2022 The database was accessed in a synchronous way. Though this works, scalability may suffe\", \"r.\\nThis logic should be moved to an asynchronous pattern.\\nAlthough there isn\\u2019t the same native suppo\", \"rt for dataset binding, Blazor provides flexibility and power\\nwith its C# support in a Razor page. F\", \"or example, you can perform calculations and display the result.\\nFor more information on data patter\", \"ns in Blazor, see the Data access chapter.\\nArchitectural changes\\nFinally, there are some important a\", \"rchitectural differences to consider when migrating to Blazor. Many\\nof these changes are applicable \", \"to anything based on .NET Core or ASP.NET Core.\\nBecause Blazor is built on .NET Core, there are cons\", \"iderations in ensuring support on .NET Core. Some\\nof the major changes include the removal of the fo\", \"llowing features:\\n\\u2022 Multiple AppDomains\\n\\u2022 Remoting\\n\\u2022 Code Access Security (CAS)\\n\\u2022 Security Transpare\", \"ncy\\nFor more information on techniques to identify necessary changes to support running on .NET Core\", \",\\nsee Port your code from .NET Framework to .NET Core.\\nASP.NET Core is a reimagined version of ASP.N\", \"ET and has some changes that may not initially seem\\nobvious. The main changes are:\\n\\u2022 No synchronizat\", \"ion context, which means there\\u2019s no HttpContext.Current,\\nThread.CurrentPrincipal, or other static ac\", \"cessors\\n\\u2022 No shadow copying\\n\\u2022 No request queue\\nMany operations in ASP.NET Core are asynchronous, whi\", \"ch allows easier off-loading of I/O-bound\\ntasks. It\\u2019s important to never block by using Task.Wait() \", \"or Task.GetResult(), which can quickly exhaust\\nthread pool resources.\\n91 CHAPTER 14 | Migrate from A\", \"SP.NET Web Forms to BlazorMigration conclusion\\nAt this point, you\\u2019ve seen many examples of what it t\", \"akes to move a Web Forms project to Blazor. For\\na full example, see the eShopOnBlazor project.\\n92 CH\", \"APTER 14 | Migrate from ASP.NET Web Forms to Blazor\"]"