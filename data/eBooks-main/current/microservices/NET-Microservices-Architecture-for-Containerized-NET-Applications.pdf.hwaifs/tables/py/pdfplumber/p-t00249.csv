,0
0,// EF Core DbContext
1,"public class OrderingContext : DbContext, IUnitOfWork"
2,{
3,// ...
4,public async Task<bool> SaveEntitiesAsync(CancellationToken cancellationToken =
5,default(CancellationToken))
6,{
7,// Dispatch Domain Events collection.
8,// Choices:
9,// A) Right BEFORE committing data (EF SaveChanges) into the DB. This makes
10,// a single transaction including side effects from the domain event
11,// handlers that are using the same DbContext with Scope lifetime
12,// B) Right AFTER committing data (EF SaveChanges) into the DB. This makes
13,// multiple transactions. You will need to handle eventual consistency and
14,// compensatory actions in case of failures.
15,await _mediator.DispatchDomainEventsAsync(this);
16,
17,"// After this line runs, all the changes (from the Command Handler and Domain"
18,// event handlers) performed through the DbContext will be committed
19,var result = await base.SaveChangesAsync();
20,}
21,}
