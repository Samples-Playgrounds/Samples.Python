,0
0,"[Route(""items"")]"
1,[HttpPost]
2,public async Task<IActionResult> UpdateProduct([FromBody]CatalogItem product)
3,{
4,var item = await _context.CatalogItems.SingleOrDefaultAsync(
5,i => i.Id == product.Id);
6,// ...
7,if (item.Price != product.Price)
8,{
9,var oldPrice = item.Price;
10,item.Price = product.Price;
11,_context.CatalogItems.Update(item);
12,"var @event = new ProductPriceChangedIntegrationEvent(item.Id,"
13,"item.Price,"
14,oldPrice);
15,// Commit changes in original transaction
16,await _context.SaveChangesAsync();
17,// Publish integration event to the event bus
18,// (RabbitMQ or a service bus underneath)
