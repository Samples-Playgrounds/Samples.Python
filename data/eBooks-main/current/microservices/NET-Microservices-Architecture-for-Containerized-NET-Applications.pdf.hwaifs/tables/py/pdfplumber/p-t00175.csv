,0
0,"// Copyright (c) .NET Foundation. Licensed under the Apache License, Version 2.0."
1,/// <summary>
2,"/// Base class for implementing a long running <see cref=""IHostedService""/>."
3,/// </summary>
4,"public abstract class BackgroundService : IHostedService, IDisposable"
5,{
6,private Task _executingTask;
7,private readonly CancellationTokenSource _stoppingCts =
8,new CancellationTokenSource();
9,
10,protected abstract Task ExecuteAsync(CancellationToken stoppingToken);
11,
12,public virtual Task StartAsync(CancellationToken cancellationToken)
13,{
14,// Store the task we're executing
15,_executingTask = ExecuteAsync(_stoppingCts.Token);
16,
17,"// If the task is completed then return it,"
18,// this will bubble cancellation and failure to the caller
19,if (_executingTask.IsCompleted)
20,{
21,return _executingTask;
22,}
23,
24,// Otherwise it's running
25,return Task.CompletedTask;
26,}
27,
28,public virtual async Task StopAsync(CancellationToken cancellationToken)
29,{
30,// Stop called without start
31,if (_executingTask == null)
32,{
33,return;
34,}
35,
