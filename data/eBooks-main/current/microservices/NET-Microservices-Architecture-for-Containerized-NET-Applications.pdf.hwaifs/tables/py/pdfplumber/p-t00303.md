|    | 0                                                              |
|---:|:---------------------------------------------------------------|
|  0 | public class ValidatorBehavior<TRequest, TResponse>            |
|  1 | : IPipelineBehavior<TRequest, TResponse>                       |
|  2 | {                                                              |
|  3 | private readonly IValidator<TRequest>[] _validators;           |
|  4 | public ValidatorBehavior(IValidator<TRequest>[] validators) => |
|  5 | _validators = validators;                                      |
|  6 |                                                                |
|  7 | public async Task<TResponse> Handle(TRequest request,          |
|  8 | RequestHandlerDelegate<TResponse> next)                        |
|  9 | {                                                              |
| 10 | var failures = _validators                                     |
| 11 | .Select(v => v.Validate(request))                              |
| 12 | .SelectMany(result => result.Errors)                           |
| 13 | .Where(error => error != null)                                 |
| 14 | .ToList();                                                     |
| 15 |                                                                |
| 16 | if (failures.Any())                                            |
| 17 | {                                                              |
| 18 | throw new OrderingDomainException(                             |
| 19 | $"Command Validation Errors for type {typeof(TRequest).Name}", |
| 20 | new ValidationException("Validation exception", failures));    |
| 21 | }                                                              |
| 22 |                                                                |
| 23 | var response = await next();                                   |
| 24 | return response;                                               |
| 25 | }                                                              |
| 26 | }                                                              |