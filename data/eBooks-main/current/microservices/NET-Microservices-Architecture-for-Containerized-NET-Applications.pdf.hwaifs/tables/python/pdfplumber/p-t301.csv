,0
0,}
1,
2,"public async Task<bool> Handle(CreateOrderCommand message, CancellationToken"
3,cancellationToken)
4,{
5,// Add Integration event to clean the basket
6,var orderStartedIntegrationEvent = new
7,OrderStartedIntegrationEvent(message.UserId);
8,await
9,_orderingIntegrationEventService.AddAndSaveEventAsync(orderStartedIntegrationEvent);
10,
11,// Add/Update the Buyer AggregateRoot
12,// DDD patterns comment: Add child entities and value-objects through the Order
13,Aggregate-Root
14,"// methods and constructor so validations, invariants and business logic"
15,// make sure that consistency is preserved across the whole aggregate
16,"var address = new Address(message.Street, message.City, message.State,"
17,"message.Country, message.ZipCode);"
18,"var order = new Order(message.UserId, message.UserName, address,"
19,"message.CardTypeId, message.CardNumber, message.CardSecurityNumber, message.CardHolderName,"
20,message.CardExpiration);
21,
22,foreach (var item in message.OrderItems)
23,{
24,"order.AddOrderItem(item.ProductId, item.ProductName, item.UnitPrice,"
25,"item.Discount, item.PictureUrl, item.Units);"
26,}
27,
28,"_logger.LogInformation(""----- Creating Order - Order: {@Order}"", order);"
29,
30,_orderRepository.Add(order);
31,
32,return await _orderRepository.UnitOfWork
33,.SaveEntitiesAsync(cancellationToken);
34,}
35,}
