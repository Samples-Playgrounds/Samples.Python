,0
0,"[Route(""api/v1/[controller]"")]"
1,public class CatalogController : ControllerBase
2,{
3,private readonly CatalogContext _catalogContext;
4,private readonly CatalogSettings _settings;
5,private readonly ICatalogIntegrationEventService _catalogIntegrationEventService;
6,
7,public CatalogController(
8,"CatalogContext context,"
9,"IOptionsSnapshot<CatalogSettings> settings,"
10,ICatalogIntegrationEventService catalogIntegrationEventService)
11,{
12,_catalogContext = context ?? throw new ArgumentNullException(nameof(context));
13,_catalogIntegrationEventService = catalogIntegrationEventService
14,?? throw new ArgumentNullException(nameof(catalogIntegrationEventService));
15,
16,_settings = settings.Value;
17,context.ChangeTracker.QueryTrackingBehavior = QueryTrackingBehavior.NoTracking;
18,}
19,
20,// GET api/v1/[controller]/items[?pageSize=3&pageIndex=10]
21,[HttpGet]
22,"[Route(""items"")]"
23,"[ProducesResponseType(typeof(PaginatedItemsViewModel<CatalogItem>),"
24,(int)HttpStatusCode.OK)]
25,"[ProducesResponseType(typeof(IEnumerable<CatalogItem>), (int)HttpStatusCode.OK)]"
26,[ProducesResponseType((int)HttpStatusCode.BadRequest)]
27,public async Task<IActionResult> ItemsAsync(
28,"[FromQuery]int pageSize = 10,"
29,"[FromQuery]int pageIndex = 0,"
30,string ids = null)
31,{
32,if (!string.IsNullOrEmpty(ids))
33,{
34,var items = await GetItemsByIdsAsync(ids);
35,
36,if (!items.Any())
37,{
38,"return BadRequest(""ids value invalid. Must be comma-separated list of"
39,"numbers"");"
40,}
41,
42,return Ok(items);
43,}
44,
45,var totalItems = await _catalogContext.CatalogItems
46,.LongCountAsync();
47,
48,var itemsOnPage = await _catalogContext.CatalogItems
49,.OrderBy(c => c.Name)
50,.Skip(pageSize * pageIndex)
