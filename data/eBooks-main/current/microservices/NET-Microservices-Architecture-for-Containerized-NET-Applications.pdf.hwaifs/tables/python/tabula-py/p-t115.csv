,}
0,
1,"public async Task<bool> Handle(CreateOrderCommand message, CancellationToken"
2,cancellationToken)
3,{
4,// Add Integration event to clean the basket
5,var orderStartedIntegrationEvent = new
6,OrderStartedIntegrationEvent(message.UserId);
7,await
8,_orderingIntegrationEventService.AddAndSaveEventAsync(orderStartedIntegrationEvent);
9,
10,// Add/Update the Buyer AggregateRoot
11,// DDD patterns comment: Add child entities and value-objects through the Order
12,Aggregate-Root
13,"// methods and constructor so validations, invariants and business logic"
14,// make sure that consistency is preserved across the whole aggregate
15,"var address = new Address(message.Street, message.City, message.State,"
16,"message.Country, message.ZipCode);"
17,"var order = new Order(message.UserId, message.UserName, address,"
18,"message.CardTypeId, message.CardNumber, message.CardSecurityNumber, message.CardHolderName,"
19,message.CardExpiration);
20,
21,foreach (var item in message.OrderItems)
22,{
23,"order.AddOrderItem(item.ProductId, item.ProductName, item.UnitPrice,"
24,"item.Discount, item.PictureUrl, item.Units);"
25,}
26,
27,"_logger.LogInformation(""----- Creating Order - Order: {@Order}"", order);"
28,
29,_orderRepository.Add(order);
30,
31,return await _orderRepository.UnitOfWork
32,.SaveEntitiesAsync(cancellationToken);
33,}
34,}
