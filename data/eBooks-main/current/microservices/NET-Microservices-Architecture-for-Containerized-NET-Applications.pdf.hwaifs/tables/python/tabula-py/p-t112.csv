,protected virtual R CreateResultForDuplicateRequest()
0,{
1,return default(R);
2,}
3,
4,/// <summary>
5,/// This method handles the command. It just ensures that no other request exists with
6,"the same ID, and if this is the case"
7,/// just enqueues the original inner command.
8,/// </summary>
9,"/// <param name=""message"">IdentifiedCommand which contains both original command &"
10,request ID</param>
11,/// <returns>Return value of inner command or default value if request same ID was
12,found</returns>
13,"public async Task<R> Handle(IdentifiedCommand<T, R> message, CancellationToken"
14,cancellationToken)
15,{
16,var alreadyExists = await _requestManager.ExistAsync(message.Id);
17,if (alreadyExists)
18,{
19,return CreateResultForDuplicateRequest();
20,}
21,else
22,{
23,await _requestManager.CreateRequestForCommandAsync<T>(message.Id);
24,try
25,{
26,var command = message.Command;
27,var commandName = command.GetGenericTypeName();
28,var idProperty = string.Empty;
29,var commandId = string.Empty;
30,
31,switch (command)
32,{
33,case CreateOrderCommand createOrderCommand:
34,idProperty = nameof(createOrderCommand.UserId);
35,commandId = createOrderCommand.UserId;
36,break;
37,
38,case CancelOrderCommand cancelOrderCommand:
39,idProperty = nameof(cancelOrderCommand.OrderNumber);
40,"commandId = $""{cancelOrderCommand.OrderNumber}"";"
41,break;
42,
43,case ShipOrderCommand shipOrderCommand:
44,idProperty = nameof(shipOrderCommand.OrderNumber);
45,"commandId = $""{shipOrderCommand.OrderNumber}"";"
46,break;
47,
48,default:
49,"idProperty = ""Id?"";"
50,"commandId = ""n/a"";"
51,break;
52,}
53,
54,_logger.LogInformation(
55,"""----- Sending command: {CommandName} - {IdProperty}: {CommandId}"
56,"({@Command})"","
57,"commandName,"
58,"idProperty,"
59,"commandId,"
