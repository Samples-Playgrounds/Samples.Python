,0
0,// Use of an EF Core resiliency strategy when using multiple DbContexts
1,// within an explicit transaction
2,// See:
3,// https://learn.microsoft.com/ef/core/miscellaneous/connection-resiliency
4,var strategy = _catalogContext.Database.CreateExecutionStrategy();
5,await strategy.ExecuteAsync(async () =>
6,{
7,// Achieving atomicity between original Catalog database operation and the
8,// IntegrationEventLog thanks to a local transaction
9,using (var transaction = _catalogContext.Database.BeginTransaction())
10,{
11,_catalogContext.CatalogItems.Update(catalogItem);
12,await _catalogContext.SaveChangesAsync();
13,
14,// Save to EventLog only if product price changed
15,if (raiseProductPriceChangedEvent)
16,{
17,await _integrationEventLogService.SaveEventAsync(priceChangedEvent);
18,transaction.Commit();
19,}
20,}
21,});
