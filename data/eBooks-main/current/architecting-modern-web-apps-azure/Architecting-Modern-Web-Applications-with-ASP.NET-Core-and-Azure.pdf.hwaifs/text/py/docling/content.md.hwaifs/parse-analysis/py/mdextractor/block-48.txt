// Use of an EF Core resiliency strategy when using multiple DbContexts // within an explicit transaction // See: // https://learn.microsoft.com/ef/core/miscellaneous/connection-resiliency var strategy = _catalogContext.Database.CreateExecutionStrategy(); await strategy.ExecuteAsync(async () => { // Achieving atomicity between original Catalog database operation and the // IntegrationEventLog thanks to a local transaction using (var transaction = _catalogContext.Database.BeginTransaction()) { _catalogContext.CatalogItems.Update(catalogItem); await _catalogContext.SaveChangesAsync(); // Save to EventLog only if product price changed if (raiseProductPriceChangedEvent) { await _integrationEventLogService.SaveEventAsync(priceChangedEvent); transaction.Commit(); } } });