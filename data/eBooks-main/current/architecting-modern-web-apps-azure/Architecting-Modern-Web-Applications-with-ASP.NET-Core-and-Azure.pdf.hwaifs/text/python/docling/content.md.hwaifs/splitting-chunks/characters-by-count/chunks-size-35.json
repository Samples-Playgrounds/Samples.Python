"[\"<!-- image -->\\n\\n## Architecting Modern Web Applications with ASPNET Core and Microsoft Azure\\n\\n<!-- i\", \"mage -->\\n\\nSteve \\\"ardalis\\\" Smith\\n\\nEDITION v8.0 - Updated to ASP.NET Core 8.0\\n\\nRefer changelog for the\", \" book updates and community contributions.\\n\\nPUBLISHED BY\\n\\nMicrosoft Developer Division, .NET, and Vi\", \"sual Studio product teams\\n\\nA division of Microsoft Corporation\\n\\nOne Microsoft Way\\n\\nRedmond, Washingt\", \"on 98052-6399\\n\\nCopyright \\u00a9 2023 by Microsoft Corporation\\n\\nAll rights reserved. No part of the conten\", \"ts of this book may be reproduced or transmitted in any form or by any means without the written per\", \"mission of the publisher.\\n\\nThis book is provided 'as -is' and expresses the author's views and opini\", \"ons. The views, opinions, and information expressed in this book, including URL and other Internet w\", \"ebsite references, may change without notice.\\n\\nSome examples depicted herein are provided for illust\", \"ration only and are fictitious. No real association or connection is intended or should be inferred.\", \"\\n\\nMicrosoft and the trademarks listed at https://www.microsoft.com on the 'Trademarks' webpage are t\", \"rademarks of the Microsoft group of companies.\\n\\nMac and macOS are trademarks of Apple Inc.\\n\\nThe Dock\", \"er whale logo is a registered trademark of Docker, Inc. Used by permission.\\n\\nAll other marks and log\", \"os are property of their respective owners.\\n\\nAuthor:\\n\\nSteve 'ardalis' Smith - Software Architect and\", \" Trainer - Ardalis.com\\n\\nEditors:\\n\\nMaira Wenzel\\n\\n## Action links\\n\\n- This e-book is also available in \", \"a PDF format (English version only) Download\\n- Clone/Fork the reference application eShopOnWeb on Gi\", \"tHub\\n\\n## Introduction\\n\\n.NET 8 and ASP.NET Core offer several advantages over traditional .NET develo\", \"pment. You should use .NET 8 for your server applications if some or all of the following are import\", \"ant to your application's success:\\n\\n- Cross-platform support.\\n- Use of microservices.\\n- Use of Docke\", \"r containers.\\n- High performance and scalability requirements.\\n- Side-by-side versioning of .NET ver\", \"sions by application on the same server.\\n\\nTraditional .NET 4.x apps can and do support many of these\", \" requirements, but ASP.NET Core and .NET 8 have been optimized to offer improved support for the abo\", \"ve scenarios.\\n\\nMore and more organizations are choosing to host their web applications in the cloud \", \"using services like Microsoft Azure. You should consider hosting your application in the cloud if th\", \"e following are important to your application or organization:\\n\\n- Reduced investment in data center \", \"costs (hardware, software, space, utilities, server management, etc.)\\n- Flexible pricing (pay based \", \"on usage, not for idle capacity).\\n- Extreme reliability.\\n- Improved app mobility; easily change wher\", \"e and how your app is deployed.\\n- Flexible capacity; scale up or down based on actual needs.\\n\\nBuildi\", \"ng web applications with ASP.NET Core, hosted in Azure, offers many competitive advantages over trad\", \"itional alternatives. ASP.NET Core is optimized for modern web application development practices and\", \" cloud hosting scenarios. In this guide, you'll le arn how to architect your ASP.NET Core applicatio\", \"ns to best take advantage of these capabilities.\\n\\n## Version\\n\\nThis guide has been revised to cover .\", \"NET 8.0 version along with many additional updates related to the same 'wave' of technologies (that \", \"is, Azure and additional third -party technologies) coinciding in time with the .NET 8.0 release. Th\", \"at's why the book version has also been updated to version 8.0 .\\n\\n## Purpose\\n\\nThis guide provides en\", \"d-to-end guidance on building monolithic web applications using ASP.NET Core and Azure. In this cont\", \"ext, 'monolithic' refers to the fact that these applications are deployed as a single unit, not as a\", \" collection of interacting services and applications. In some contexts, the term monolith may be use\", \"d as a pejorative, but in the vast majority of situations a single application is much easier to bui\", \"ld, deploy, and debug than an app composed of many different services, while still achieving the bus\", \"iness requirements.\\n\\nThis guide is complementary to ' .NET Microservices. Architecture for Container\", \"ized .NET Applications ' , which focuses more on Docker, microservices, and deployment of containers\", \" to host enterprise applications.\\n\\n## .NET Microservices. Architecture for Containerized .NET Applic\", \"ations\\n\\n- e-book\\n\\nhttps://aka.ms/MicroservicesEbook\\n\\n- Sample Application\\n\\nhttps://aka.ms/microservi\", \"cesarchitecture\\n\\n## Who should use this guide\\n\\nThe audience for this guide is mainly developers, dev\", \"elopment leads, and architects who are interested in building modern web applications using Microsof\", \"t technologies and services in the cloud.\\n\\nA secondary audience is technical decision makers who are\", \" already familiar ASP.NET or Azure and are looking for information on whether it makes sense to upgr\", \"ade to ASP.NET Core for new or existing projects.\\n\\n## How you can use this guide\\n\\nThis guide has bee\", \"n condensed into a relatively small document that focuses on building web applications with modern .\", \"NET technologies and Azure. As such, it can be read in its entirety to provide a foundation of under\", \"standing such applications and their technical considerations. The guide, along with its sample appl\", \"ication, can also serve as a starting point or reference. Use the associated sample application as a\", \" template for your own applications, or to see how you might organize your application's component p\", \"arts. Refer back to the guide's principles and coverage of architecture and technology options and d\", \"ecision considerations when you're weighing these choices for your own application.\\n\\nFeel free to fo\", \"rward this guide to your team to help ensure a common understanding of these considerations and oppo\", \"rtunities. Having everybody working from a common set of terminology and underlying principles helps\", \" ensure consistent application of architectural patterns and practices.\\n\\n## References\\n\\n- Choosing b\", \"etween .NET and .NET Framework for server apps\\n\\nhttps://learn.microsoft.com/dotnet/standard/choosing\", \"-core-framework-server\\n\\n## Contents\\n\\n| Characteristics of Modern Web Applications...................\", \".................................................... 1                                              \", \"                                   |\\n|--------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-----------------------------------|\\n| Reference application: eShopOnWeb............................\", \"..................................................................................................1 \", \"                                   |\\n| Reference Application .......................................\", \"....................................................................................................\", \"............2                      |\\n| Cloud-hosted and scalable ...................................\", \"....................................................................................................\", \"...........2                       |\\n| Cross platform...............................................\", \"....................................................................................................\", \"........................2          |\\n| Modular and loosely coupled..................................\", \"....................................................................................................\", \".......3                           |\\n| Easily tested with automated tests ..........................\", \"....................................................................................................\", \".....3                             |\\n| Traditional and SPA behaviors supported .....................\", \"................................................................................................3   \", \"                                   |\\n| Simple development and deployment............................\", \"................................................................................................4   \", \"                                   |\\n| Traditional ASP.NET and Web Forms............................\", \"...................................................................................................4\", \"                                   |\\n| Blazor.......................................................\", \"....................................................................................................\", \".................................4 |\\n| References - Modern Web Applications ........................\", \"...........................................................................................4        \", \"                                   |\\n| Choose Between Traditional Web Apps and Single Page Apps (SPA\", \"s).............................                                                                     \", \"                                   |\\n| 6                                                            \", \"                                                                                                    \", \"                                   |\\n| Blazor.......................................................\", \"....................................................................................................\", \".................................7 |\\n| When to choose traditional web apps .........................\", \"...................................................................................................7\", \"                                   |\\n| When to choose SPAs..........................................\", \"....................................................................................................\", \"..............8                    |\\n| References - SPA Frameworks..................................\", \"....................................................................................................\", \".8                                 |\\n| When to choose Blazor .......................................\", \"....................................................................................................\", \"..............9                    |\\n| Decision table...............................................\", \"....................................................................................................\", \".........................9         |\\n| Other considerations.........................................\", \"....................................................................................................\", \".................9                 |\\n| Architectural principles.....................................\", \".................................................................... 11                             \", \"                                   |\\n| Common design principles ....................................\", \"....................................................................................................\", \"....... 11                         |\\n| Separation of concerns.......................................\", \"....................................................................................................\", \".......11                          |\\n| Encapsulation................................................\", \"....................................................................................................\", \".................11                |\\n| Dependency inversion.........................................\", \"....................................................................................................\", \".......12                          |\\n| Explicit dependencies........................................\", \"....................................................................................................\", \".........14                        |\\n| Single responsibility .......................................\", \"....................................................................................................\", \".............14                    |\\n| Don't repeat yourself (DRY) .................................\", \"....................................................................................................\", \"....15                             |\\n\\n| Persistence ignorance ......................................\", \"....................................................................................................\", \"..........15                                                                                        \", \"                                 |    |\\n|-----------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-----------------------------------|----|\\n| Bounded contexts........................................\", \"....................................................................................................\", \"................16                                                                                  \", \"                                     |    |\\n| Additional resources..................................\", \"....................................................................................................\", \"......................                                                                              \", \"                                       | 16 |\\n| Common web application architectures ...............\", \"..............................................................                                      \", \"                                                                                                    \", \"                                         | 17 |\\n| What is a monolithic application?.................\", \"....................................................................................................\", \".............                                                                                       \", \"                                           | 17 |\\n| All-in-one applications ........................\", \"....................................................................................................\", \"...........................                                                                         \", \"                                             | 17 |\\n| What are layers?..............................\", \"....................................................................................................\", \"..................................                                                                  \", \"                                               | 18 |\\n| Traditional 'N - Layer' architecture applica\", \"tions ..............................................................................................\", \"..........                                                                                          \", \"                                                 | 19 |\\n| Clean architecture........................\", \"....................................................................................................\", \".....................................                                                               \", \"                                                   | 23 |\\n| Organizing code in Clean Architecture ..\", \"....................................................................................................\", \".............28                                                                                     \", \"                                                     |    |\\n| Monolithic applications and containers\", \"....................................................................................................\", \"...................                                                                                 \", \"                                                       | 30 |\\n| Monolithic application deployed as a\", \" container .........................................................................................\", \"........31                                                                                          \", \"                                                         |    |\\n| Docker support....................\", \"....................................................................................................\", \"..............................................                                                      \", \"                                                           | 33 |\\n| Troubleshooting Docker problems.\", \"....................................................................................................\", \"......................34                                                                            \", \"                                                             |    |\\n| Other web application architec\", \"tural styles........................................................................................\", \".....................34                                                                             \", \"                                                               |    |\\n| References - Common web arch\", \"itectures...........................................................................................\", \"...................34                                                                               \", \"                                                                 |    |\\n| Common client-side web tec\", \"hnologies...............................................................................            \", \"                                                                                                    \", \"                                                                   | 36 |\\n| HTML....................\", \"....................................................................................................\", \"..................................................................                                  \", \"                                                                     | 36 |\\n| CSS...................\", \"....................................................................................................\", \".......................................................................                             \", \"                                                                       | 36 |\\n| CSS preprocessors ..\", \"....................................................................................................\", \".....................................................37                                             \", \"                                                                         |    |\\n| JavaScript .......\", \"....................................................................................................\", \"......................................................................                              \", \"                                                                           | 38 |\\n| Legacy web apps \", \"with jQuery ........................................................................................\", \".............................................38                                                     \", \"                                                                             |    |\\n| jQuery vs a SP\", \"A Framework.........................................................................................\", \"................................................38                                                  \", \"                                                                               |    |\\n| Angular SPAs\", \"....................................................................................................\", \"..................................................................39                                \", \"                                                                                 |    |\\n| React.....\", \"....................................................................................................\", \".............................................................................40                     \", \"                                                                                   |    |\\n| Vue.....\", \"....................................................................................................\", \"................................................................................40                  \", \"                                                                                     |    |\\n| Blazor\", \" WebAssembly........................................................................................\", \"..............................................................41                                    \", \"                                                                                       |    |\\n| Choo\", \"sing a SPA Framework................................................................................\", \".........................................................41                                         \", \"                                                                                         |    |\\n| Re\", \"ferences - Client Web Technologies..................................................................\", \".................................................42                                                 \", \"                                                                                           |    |\\n| \", \"Develop ASP.NET Core MVC apps.......................................................................\", \"................ 43 MVC and Razor Pages.............................................................\", \"............................................................................................ | 43 |\\n\", \"\\n| Why Razor Pages?.................................................................................\", \"...........................................................................44                 |     \", \"                                                                                                    \", \"                                                             |\\n|------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"--------------------------------------------------------|-------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-----------------------|\\n| When to use MVC..........................................................\", \"..................................................................................................44\", \"                  |                                                                                 \", \"                                                                                     |\\n| Mapping req\", \"uests to responses .................................................................................\", \"....................................................                            | 44                \", \"                                                                                                    \", \"                                               |\\n| Keeping controllers under control ...............\", \"....................................................................................................\", \".........46                               |                                                         \", \"                                                                                                    \", \"         |\\n| References - Mapping Requests to Responses ............................................\", \".......................................................48                                           \", \"    |                                                                                               \", \"                                                                       |\\n| Working with dependencies\", \"....................................................................................................\", \".........................................                         | 48                              \", \"                                                                                                    \", \"                                 |\\n| Declare your dependencies......................................\", \"....................................................................................................\", \"49                          |                                                                       \", \"                                                                                               |\\n| S\", \"tructuring the application .........................................................................\", \"......................................................................                    | 50      \", \"                                                                                                    \", \"                                                         |\\n| Feature organization...................\", \"....................................................................................................\", \"................................51                  |                                               \", \"                                                                                                    \", \"                   |\\n| APIs and Blazor applications.................................................\", \".......................................................................................53           \", \"              |                                                                                     \", \"                                                                                 |\\n| Cross-cutting c\", \"oncerns.............................................................................................\", \".....................................................54                     |                       \", \"                                                                                                    \", \"                                           |\\n| References - Structuring applications ...............\", \"....................................................................................................\", \"..57                                  |                                                             \", \"                                                                                                    \", \"     |\\n| Security ..................................................................................\", \"................................................................................................... \", \"| 57                                                                                                \", \"                                                                   |\\n| Identity ....................\", \"....................................................................................................\", \".........................................................57   |                                     \", \"                                                                                                    \", \"                             |\\n| Authentication.....................................................\", \"....................................................................................................\", \"..........60            |                                                                           \", \"                                                                                           |\\n| Refer\", \"ences - Authentication..............................................................................\", \"..........................................................61                          |             \", \"                                                                                                    \", \"                                                     |\\n| Authorization .............................\", \"....................................................................................................\", \"....................................61          |                                                   \", \"                                                                                                    \", \"               |\\n| References - Security............................................................\", \"..........................................................................................64        \", \"          |                                                                                         \", \"                                                                             |\\n| Client communicatio\", \"n...................................................................................................\", \"......................................................                  | 64                        \", \"                                                                                                    \", \"                                       |\\n| References - Client Communication .......................\", \".................................................................................................65 \", \"                                  |                                                                 \", \"                                                                                                    \", \" |\\n| Domain-driven design - Should you apply it?....................................................\", \"......................................................                                          | 65\", \"                                                                                                    \", \"                                                               |\\n| When should you apply DDD........\", \"....................................................................................................\", \"..........................66                              |                                         \", \"                                                                                                    \", \"                         |\\n| When shouldn't you apply DDD ..........................................\", \"......................................................................................66            \", \"                    |                                                                               \", \"                                                                                       |\\n| Reference\", \"s - Domain-Driven Design ...........................................................................\", \"............................................67                                    |                 \", \"                                                                                                    \", \"                                                 |\\n| Deployment.....................................\", \"....................................................................................................\", \"....................................        | 67                                                    \", \"                                                                                                    \", \"           |\\n| References - Deployment..............................................................\", \"...............................................................................68                   \", \"      |                                                                                             \", \"                                                                         |\\n| Working with Data in AS\", \"P.NET Core Apps......................................................................... 69         \", \"                                                                    | Working with Data in ASP.NET C\", \"ore Apps......................................................................... 69                \", \"                                   |\\n| Entity Framework Core (for relational databases).............\", \".......................................................................................             \", \"                              | 69                                                                  \", \"                                                                                                 |\\n|\", \" The DbContext                                                                                      \", \"                                                                                            | ......\", \"....................................................................................................\", \"........................................................69 |\\n| Configuring EF Core..................\", \"....................................................................................................\", \"..................................70                  |                                             \", \"                                                                                                    \", \"                     |\\n| Fetching and storing Data..................................................\", \"..........................................................................................71        \", \"                |                                                                                   \", \"                                                                                   |\\n| Fetching rela\", \"ted data............................................................................................\", \"..........................................................72                  |                     \", \"                                                                                                    \", \"                                             |\\n\\n| Encapsulating data ...............................\", \"....................................................................................................\", \".......................73                  |                                                        \", \"                                                                                                    \", \"                      |\\n|---------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-------------------|--------------------------------------------------------------------------------\", \"--------------------------------------------------------------------------------------------------|\\n\", \"| Resilient connections.............................................................................\", \".........................................................................74                    |    \", \"                                                                                                    \", \"                                                                          |\\n| References - Entity Fr\", \"amework Core........................................................................................\", \"................................76                                     |                            \", \"                                                                                                    \", \"                                                  |\\n| EF Core or micro-ORM? ........................\", \"....................................................................................................\", \".........................                      | 76                                                 \", \"                                                                                                    \", \"                          |\\n| SQL or NoSQL..........................................................\", \"....................................................................................................\", \"..........             | 77                                                                         \", \"                                                                                                    \", \"  |\\n| Azure Cosmos DB...............................................................................\", \"..................................................................................                 |\", \" 78                                                                                                 \", \"                                                                              |\\n| Other persistence \", \"options.............................................................................................\", \"....................................................                       | 79                     \", \"                                                                                                    \", \"                                                      |\\n| Caching...................................\", \"....................................................................................................\", \"..............................................     | 80                                             \", \"                                                                                                    \", \"                              |\\n| ASP.NET Core response caching.....................................\", \"...........................................................................................80       \", \"                           |                                                                        \", \"                                                                                                    \", \"      |\\n| Data caching .............................................................................\", \".........................................................................................81         \", \"   |                                                                                                \", \"                                                                                  |\\n| Getting data t\", \"o Blazor WebAssembly apps...........................................................................\", \".....................................                                          | 83                 \", \"                                                                                                    \", \"                                                          |\\n| Test ASP.NET Core MVC apps ...........\", \"...................................................................................                 \", \"                                                       | 85                                         \", \"                                                                                                    \", \"                                  |\\n| Kinds of automated tests......................................\", \"....................................................................................................\", \".........                      | 85                                                                 \", \"                                                                                                    \", \"          |\\n| Unit tests............................................................................\", \"..................................................................................................85\", \"       |                                                                                            \", \"                                                                                      |\\n| Integratio\", \"n tests.............................................................................................\", \"...................................................................85              |                \", \"                                                                                                    \", \"                                                              |\\n| Functional tests..................\", \"....................................................................................................\", \"...........................................86              |                                        \", \"                                                                                                    \", \"                                      |\\n| Testing Pyramid...........................................\", \"....................................................................................................\", \".................86                |                                                                \", \"                                                                                                    \", \"              |\\n| What to test......................................................................\", \"..................................................................................................87\", \"           |                                                                                        \", \"                                                                                          |\\n| Organi\", \"zing test projects..................................................................................\", \"...................................................................                    | 88         \", \"                                                                                                    \", \"                                                                  |\\n| Test naming...................\", \"....................................................................................................\", \".................................................89            |                                    \", \"                                                                                                    \", \"                                          |\\n| Unit testing ASP.NET Core apps .......................\", \"....................................................................................................\", \"..........                             | 91                                                         \", \"                                                                                                    \", \"                  |\\n| Integration testing ASP.NET Core apps ........................................\", \"...............................................................................                     \", \"               | 92                                                                                 \", \"                                                                                              |\\n| Fu\", \"nctional testing ASP.NET Core apps..................................................................\", \".......................................................                                    | 92     \", \"                                                                                                    \", \"                                                                      |\\n| References - Test ASP.NET \", \"Core MVC apps.......................................................................................\", \"...................95                                              |                                \", \"                                                                                                    \", \"                                              |\\n| Development process for Azure ....................\", \"......................................................................                              \", \"                                           | 96                                                     \", \"                                                                                                    \", \"                      |\\n| Vision ...................................................................\", \"....................................................................................................\", \".................. | 96                                                                             \", \"                                                                                                  |\\n\", \"| Development environment for ASP.NET Core apps ....................................................\", \"...........................................                                                    | 96 \", \"                                                                                                    \", \"                                                                          |\\n| Development tools choi\", \"ces: IDE or editor..................................................................................\", \"............................96                                         |                            \", \"                                                                                                    \", \"                                                  |\\n| Development workflow for Azure-hosted ASP.NET \", \"Core apps..........................................................................                 \", \"                                               | 97                                                 \", \"                                                                                                    \", \"                          |\\n| Initial setup.........................................................\", \"....................................................................................................\", \"............97         |                                                                            \", \"                                                                                                    \", \"  |\\n| Workflow for developing Azure-hosted ASP.NET Core applications ...............................\", \"...........................98                                                                      |\", \"                                                                                                    \", \"                                                                              |\\n| References        \", \"                                                                                                    \", \"                                                                           | .......................\", \"....................................................................................................\", \"..................................................100 |\\n\\n| Azure hosting recommendations for ASP.NET\", \" Core web apps......................................101                                             \", \"                                                     |\\n|--------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"---------------------------------------------------|\\n| Web applications ............................\", \"....................................................................................................\", \"................................101              |\\n| App Service Web Apps ..........................\", \"....................................................................................................\", \"..................101                          |\\n| App Service Web Apps for Containers .............\", \"....................................................................................................\", \".103                                         |\\n| Azure Kubernetes Service ..........................\", \"....................................................................................................\", \".............106                           |\\n| Azure Virtual Machines...............................\", \"....................................................................................................\", \".............107                         |\\n| Logical processes......................................\", \"....................................................................................................\", \"......................107              |\\n| Data.....................................................\", \"....................................................................................................\", \".................................107 |\\n| Architecture recommendations...............................\", \"....................................................................................................\", \"..108                              |\\n\\n## Characteristics of Modern Web Applications\\n\\n'\\u2026 with proper \", \"design, the features come cheaply. This approach is arduous, but continues to succeed.'\\n\\n- Dennis Ri\", \"tchie\\n\\nModern web applications have higher user expectations and greater demands than ever before. T\", \"oday's web apps are expected to be available 24/7 from anywhere in the world, and usable from virtua\", \"lly any device or screen size. Web applications must be secure, flexible, and scalable to meet spike\", \"s in demand. Increasingly, complex scenarios should be handled by rich user experiences built on the\", \" client using JavaScript, and communicating efficiently through web APIs.\\n\\nASP.NET Core is optimized\", \" for modern web applications and cloud-based hosting scenarios. Its modular design enables applicati\", \"ons to depend on only those features they actually use, improving application security and performan\", \"ce while reducing hosting resource requirements.\\n\\n## Reference application: eShopOnWeb\\n\\nThis guidanc\", \"e includes a reference application, eShopOnWeb , that demonstrates some of the principles and recomm\", \"endations. The application is a simple online store, which supports browsing through a catalog of sh\", \"irts, coffee mugs, and other marketing items. The reference application is deliberately simple in or\", \"der to make it easy to understand.\\n\\nCatalog - Microsoft.eSh X\\n\\n+\\n\\nlocalhost: 5106\\n\\ne\\n\\neSHOP\\n\\nOnWeb\\n\\n\", \"ALL T-SHIRTS\\n\\nON SALE\\n\\nTHIS WEEKEND\\n\\nBRAND\\n\\nAll\\n\\nV\\n\\n[ADD TO CART 1\\n\\n\\u2022NET BOT BLACK SWEATSHIRT\\n\\nFigur\", \"e 2-1. eShopOnWeb\\n\\n<!-- image -->\\n\\n## Reference Application\\n\\n- eShopOnWeb https://github.com/dotnet/\", \"eShopOnWeb\\n\\n## Cloud-hosted and scalable\\n\\nASP.NET Core is optimized for the cloud (public cloud, pri\", \"vate cloud, any cloud) because it is lowmemory and high-throughput. The smaller footprint of ASP.NET\", \" Core applications means you can host more of them on the same hardware, and you pay for fewer resou\", \"rces when using pay-as-yougo cloud hosting services. The higher-throughput means you can serve more \", \"customers from an application given the same hardware, further reducing the need to invest in server\", \"s and hosting infrastructure.\\n\\n## Cross platform\\n\\nASP.NET Core is cross-platform and can run on Linu\", \"x, macOS, and Windows. This capability opens up many new options for both the development and deploy\", \"ment of apps built with ASP.NET Core.\\n\\nLogin\\n\\nDocker containers - both Linux and Windows - can host \", \"ASP.NET Core applications, allowing them to take advantage of the benefits of containers and microse\", \"rvices.\\n\\n## Modular and loosely coupled\\n\\nNuGet packages are first-class citizens in .NET Core, and A\", \"SP.NET Core apps are composed of many libraries through NuGet. This granularity of functionality hel\", \"ps ensure apps only depend on and deploy functionality they actually require, reducing their footpri\", \"nt and security vulnerability surface area.\\n\\nASP.NET Core also fully supports dependency injection, \", \"both internally and at the application level. Interfaces can have multiple implementations that can \", \"be swapped out as needed. Dependency injection allows apps to loosely couple to those interfaces, ra\", \"ther than specific implementations, making them easier to extend, maintain, and test.\\n\\n## Easily tes\", \"ted with automated tests\\n\\nASP.NET Core applications support unit testing, and their loose coupling a\", \"nd support for dependency injection makes it easy to swap infrastructure concerns with fake implemen\", \"tations for test purposes. ASP.NET Core also ships with a TestServer that can be used to host apps i\", \"n memory. Functional tests can then make requests to this in-memory server, exercising the full appl\", \"ication stack (including middleware, routing, model binding, filters, etc.) and receiving a response\", \", all in a fraction of the time it would take to host the app on a real server and make requests thr\", \"ough the network layer. These tests are especially easy to write, and valuable, for APIs, which are \", \"increasingly important in modern web applications.\\n\\n## Traditional and SPA behaviors supported\\n\\nTrad\", \"itional web applications have involved little client-side behavior, but instead have relied on the s\", \"erver for all navigation, queries, and updates the app might need to make. Each new operation made b\", \"y the user would be translated into a new web request, with the result being a full page reload in t\", \"he end user's browser. Classic Model -View-Controller (MVC) frameworks typically follow this approac\", \"h, with each new request corresponding to a different controller action, which in turn would work wi\", \"th a model and return a view. Some individual operations on a given page might be enhanced with AJAX\", \" (Asynchronous JavaScript and XML) functionality, but the overall architecture of the app used many \", \"different MVC views and URL endpoints. In addition, ASP.NET Core MVC also supports Razor Pages, a si\", \"mpler way to organize MVC-style pages.\\n\\nSingle Page Applications (SPAs), by contrast, involve very f\", \"ew dynamically generated server-side page loads (if any). Many SPAs are initialized within a static \", \"HTML file that loads the necessary JavaScript libraries to start and run the app. These apps make he\", \"avy usage of web APIs for their data needs and can provide much richer user experiences. Blazor WebA\", \"ssembly provides a means of building SPAs using .NET code, which then runs in the client's browser.\\n\", \"\\nMany web applications involve a combination of traditional web application behavior (typically for \", \"content) and SPAs (for interactivity). ASP.NET Core supports both MVC (Views or Page based) and web \", \"APIs in the same application, using the same set of tools and underlying framework libraries.\\n\\n## Si\", \"mple development and deployment\\n\\nASP.NET Core applications can be written using simple text editors \", \"and command-line interfaces, or full-featured development environments like Visual Studio. Monolithi\", \"c applications are typically deployed to a single endpoint. Deployments can easily be automated to o\", \"ccur as part of a continuous integration (CI) and continuous delivery (CD) pipeline. In addition to \", \"traditional CI/CD tools, Microsoft Azure has integrated support for git repositories and can automat\", \"ically deploy updates as they are made to a specified git branch or tag. Azure DevOps provides a ful\", \"l-featured CI/CD build and deployment pipeline, and GitHub Actions provide another option for projec\", \"ts hosted there.\\n\\n## Traditional ASP.NET and Web Forms\\n\\nIn addition to ASP.NET Core, traditional ASP\", \".NET 4.x continues to be a robust and reliable platform for building web applications. ASP.NET suppo\", \"rts MVC and Web API development models, as well as Web Forms, which is well suited to rich page-base\", \"d application development and features a rich third-party component ecosystem. Microsoft Azure has g\", \"reat longstanding support for ASP.NET 4.x applications, and many developers are familiar with this p\", \"latform.\\n\\n## Blazor\\n\\nBlazor is included with ASP.NET Core 3.0 and later. It provides a new mechanism\", \" for building rich interactive web client applications using Razor, C#, and ASP.NET Core. It offers \", \"another solution to consider when developing modern web applications. There are two versions of Blaz\", \"or to consider: server-side and client-side.\\n\\nServer-side Blazor was released in 2019 with ASP.NET C\", \"ore 3.0. As its name implies, it runs on the server, rendering changes to the client document back t\", \"o the browser over the network. Server-side Blazor provides a rich client experience without requiri\", \"ng client-side JavaScript and without requiring separate page loads for each client page interaction\", \". Changes in the loaded page are requested from and processed by the server and then sent back to th\", \"e client using SignalR.\\n\\nClient-side Blazor, released in 2020, eliminates the need to render changes\", \" on the server. Instead, it leverages WebAssembly to run .NET code within the client. The client can\", \" still make API calls to the server if needed to request data, but all client-side behavior runs in \", \"the client via WebAssembly, which is already supported by all major browsers and is just a JavaScrip\", \"t library.\\n\\n## References -Modern Web Applications\\n\\n- Introduction to ASP.NET Core https://learn.mic\", \"rosoft.com/aspnet/core/\\n\\n- Testing in ASP.NET Core https://learn.microsoft.com/aspnet/core/testing/\\n\", \"- Blazor - Get Started https://blazor.net/docs/get-started.html\\n\\n## Choose Between Traditional Web A\", \"pps and Single Page Apps (SPAs)\\n\\n'Atwood's Law: Any application that can be written in JavaScript, w\", \"ill eventually be written in JavaScript.'\\n\\n- Jeff Atwood\\n\\nThere are two general approaches to buildi\", \"ng web applications today: traditional web applications that perform most of the application logic o\", \"n the server, and single-page applications (SPAs) that perform most of the user interface logic in a\", \" web browser, communicating with the web server primarily using web APIs. A hybrid approach is also \", \"possible, the simplest being host one or more rich SPA-like subapplications within a larger traditio\", \"nal web application.\\n\\n## Use traditional web applications when:\\n\\n- Your application's client -side r\", \"equirements are simple or even read-only.\\n- Your application needs to function in browsers without J\", \"avaScript support.\\n- Your application is public-facing and benefits from search engine discovery and\", \" referrals.\\n\\n## Use a SPA when:\\n\\n- Your application must expose a rich user interface with many feat\", \"ures.\\n- Your team is familiar with JavaScript, TypeScript, or Blazor WebAssembly development.\\n- Your\", \" application must already expose an API for other (internal or public) clients.\\n\\nAdditionally, SPA f\", \"rameworks require greater architectural and security expertise. They experience greater churn due to\", \" frequent updates and new client frameworks than traditional web applications. Configuring automated\", \" build and deployment processes and utilizing deployment options like containers may be more difficu\", \"lt with SPA applications than traditional web apps.\\n\\nImprovements in user experience made possible b\", \"y the SPA approach must be weighed against these considerations.\\n\\n## Blazor\\n\\nASP.NET Core includes a\", \" model for building rich, interactive, and composable user interfaces called Blazor. Blazor server-s\", \"ide allows developers to build UI with C# and Razor on the server and for the UI to be interactively\", \" connected to the browser in real-time using a persistent SignalR connection. Blazor WebAssembly int\", \"roduces another option for Blazor apps, allowing them to run in the browser using WebAssembly. Becau\", \"se it's real .NET code running on WebAssembly, you can reuse code and libraries from server-side par\", \"ts of your application.\\n\\nBlazor provides a new, third option to consider when evaluating whether to \", \"build a purely serverrendered web application or a SPA. You can build rich, SPA-like client-side beh\", \"aviors using Blazor, without the need for significant JavaScript development. Blazor applications ca\", \"n call APIs to request data or perform server-side operations. They can interoperate with JavaScript\", \" where necessary to take advantage of JavaScript libraries and frameworks.\\n\\nConsider building your w\", \"eb application with Blazor when:\\n\\n- Your application must expose a rich user interface\\n- Your team i\", \"s more comfortable with .NET development than JavaScript or TypeScript development\\n\\nIf you have an e\", \"xisting web forms application you're considering migrating to .NET Core or the latest .NET, you may \", \"wish to review the free e-book, Blazor for Web Forms Developers to see whether it makes sense to con\", \"sider migrating it to Blazor.\\n\\nFor more information about Blazor, see Get started with Blazor.\\n\\n## W\", \"hen to choose traditional web apps\\n\\nThe following section is a more detailed explanation of the prev\", \"iously stated reasons for picking traditional web applications.\\n\\n## Your application has simple, pos\", \"sibly read-only, client-side requirements\\n\\nMany web applications are primarily consumed in a read-on\", \"ly fashion by the vast majority of their users. Read-only (or read-mostly) applications tend to be m\", \"uch simpler than those applications that maintain and manipulate a great deal of state. For example,\", \" a search engine might consist of a single entry point with a textbox and a second page for displayi\", \"ng search results. Anonymous users can easily make requests, and there is little need for client-sid\", \"e logic. Likewise, a blog or content management system' s public-facing application usually consists\", \" mainly of content with little clientside behavior. Such applications are easily built as traditiona\", \"l server-based web applications, which perform logic on the web server and render HTML to be display\", \"ed in the browser. The fact that each unique page of the site has its own URL that can be bookmarked\", \" and indexed by search engines (by default, without having to add this functionality as a separate f\", \"eature of the application) is also a clear benefit in such scenarios.\\n\\nYour application needs to fun\", \"ction in browsers without JavaScript support\\n\\nWeb applications that need to function in browsers wit\", \"h limited or no JavaScript support should be written using traditional web app workflows (or at leas\", \"t be able to fall back to such behavior). SPAs require client-side JavaScript in order to function; \", \"if it's not available, SPAs are not a good choice.\\n\\n## Your team is unfamiliar with JavaScript or Ty\", \"peScript development techniques\\n\\nIf your team is unfamiliar with JavaScript or TypeScript, but is fa\", \"miliar with server-side web application development, then they will probably be able to deliver a tr\", \"aditional web app more quickly than a SPA. Unless learning to program SPAs is a goal, or the user ex\", \"perience afforded by a SPA is required, traditional web apps are a more productive choice for teams \", \"who are already familiar with building them.\\n\\n## When to choose SPAs\\n\\nThe following section is a mor\", \"e detailed explanation of when to choose a Single Page Applications style of development for your we\", \"b app.\\n\\n## Your application must expose a rich user interface with many features\\n\\nSPAs can support r\", \"ich clientside functionality that doesn't require reloading the page as users take actions or naviga\", \"te between areas of the app. SPAs can load more quickly, fetching data in the background, and indivi\", \"dual user actions are more responsive since full page reloads are rare. SPAs can support incremental\", \" updates, saving partially completed forms or documents without the user having to click a button to\", \" submit a form. SPAs can support rich client-side behaviors, such as drag-and-drop, much more readil\", \"y than traditional applications. SPAs can be designed to run in a disconnected mode, making updates \", \"to a client-side model that are eventually synchronized back to the server once a connection is re-e\", \"stablished. Choose a SPA-style application if you r app's requirements include rich functionality th\", \"at goes beyond what typical HTML forms offer.\\n\\nFrequently, SPAs need to implement features that are \", \"built into traditional web apps, such as displaying a meaningful URL in the address bar reflecting t\", \"he current operation (and allowing users to bookmark or deep link to this URL to return to it). SPAs\", \" al so should allow users to use the browser's back and forward buttons with results that won't surp\", \"rise them.\\n\\n## Your team is familiar with JavaScript and/or TypeScript development\\n\\nWriting SPAs req\", \"uires familiarity with JavaScript and/or TypeScript and client-side programming techniques and libra\", \"ries. Your team should be competent in writing modern JavaScript using a SPA framework like Angular.\", \"\\n\\n## References -SPA Frameworks\\n\\n- Angular : https://angular.io\\n\\n- React : https://reactjs.org/\\n\\n- V\", \"ue.js : https://vuejs.org/\\n\\n## Your application must already expose an API for other (internal or pu\", \"blic) clients\\n\\nIf you're already supporting a web API for use by other clients, it may require less \", \"effort to create a SPA implementation that leverages these APIs rather than reproducing the logic in\", \" server-side form. SPAs make extensive use of web APIs to query and update data as users interact wi\", \"th the application.\\n\\n## When to choose Blazor\\n\\nThe following section is a more detailed explanation \", \"of when to choose Blazor for your web app.\\n\\n## Your application must expose a rich user interface\\n\\nL\", \"ike JavaScript-based SPAs, Blazor applications can support rich client behavior without page reloads\", \". These applications are more responsive to users, fetching only the data (or HTML) required to resp\", \"ond to a given user interaction. Designed properly, server-side Blazor apps can be configured to run\", \" as client-side Blazor apps with minimal changes once this feature is supported.\\n\\n## Your team is mo\", \"re comfortable with .NET development than JavaScript or TypeScript development\\n\\nMany developers are \", \"more productive with .NET and Razor than with client-side languages like JavaScript or TypeScript. S\", \"ince the server-side of the application is already being developed with .NET, using Blazor ensures e\", \"very .NET developer on the team can understand and potentially build the behavior of the front end o\", \"f the application.\\n\\n## Decision table\\n\\nThe following decision table summarizes some of the basic fac\", \"tors to consider when choosing between a traditional web application, a SPA, or a Blazor app.\\n\\n| Fac\", \"tor                                               | Traditional Web App   | Single Page Application \", \"  | Blazor App   |\\n|------------------------------------------------------|-----------------------|-\", \"--------------------------|--------------|\\n| Required Team Familiarity with JavaScript/TypeScript | \", \"Minimal               | Required                  | Minimal      |\\n| Support Browsers without Script\", \"ing                   | Supported             | Not Supported             | Supporte d   |\\n| Minimal\", \" Client-Side Application Behavior             | Well-Suited           | Overkill                  | \", \"Viable       |\\n| Rich, Complex User Interface Requirements            | Limited               | Well\", \"-Suited               | Well- Suited |\\n\\n## Other considerations\\n\\nTraditional Web Apps tend to be sim\", \"pler and have better Search Engine Optimization (SEO) criteria than SPA apps. Search engine bots can\", \" easily consume content from traditional apps, while support for indexing SPAs may be lacking or lim\", \"ited. If your app benefits from public discovery by search engines, this is often an important consi\", \"deration.\\n\\nIn addition, unless you've built a management tool for your SPA's content, it may require\", \" developers to make changes. Traditional Web Apps are often easier for non-developers to make change\", \"s to, since much of the content is simply HTML and may not require a build process to preview or eve\", \"n deploy. If non-developers in your organization are likely to need to maintain the content of the a\", \"pp, a traditional web app may be a better choice.\\n\\nSPAs shine when the app has complex interactive f\", \"orms or other user interaction features. For complex apps that require authentication to use, and th\", \"us aren't accessible by public search engine spiders, SPAs are a great option in many cases.\\n\\n## Arc\", \"hitectural principles\\n\\n'If builders built buildings the way programmers wrote programs, then the fir\", \"st woodpecker that came along would destroy civilization.'\\n\\n- Gerald Weinberg\\n\\nYou should architect \", \"and design software solutions with maintainability in mind. The principles outlined in this section \", \"can help guide you toward architectural decisions that will result in clean, maintainable applicatio\", \"ns. Generally, these principles will guide you toward building applications out of discrete componen\", \"ts that are not tightly coupled to other parts of your application, but rather communicate through e\", \"xplicit interfaces or messaging systems.\\n\\n## Common design principles\\n\\n## Separation of concerns\\n\\nA \", \"guiding principle when developing is Separation of Concerns . This principle asserts that software s\", \"hould be separated based on the kinds of work it performs. For instance, consider an application tha\", \"t includes logic for identifying noteworthy items to display to the user, and which formats such ite\", \"ms in a particular way to make them more noticeable. The behavior responsible for choosing which ite\", \"ms to format should be kept separate from the behavior responsible for formatting the items, since t\", \"hese behaviors are separate concerns that are only coincidentally related to one another.\\n\\nArchitect\", \"urally, applications can be logically built to follow this principle by separating core business beh\", \"avior from infrastructure and user-interface logic. Ideally, business rules and logic should reside \", \"in a separate project, which should not depend on other projects in the application. This separation\", \" helps ensure that the business model is easy to test and can evolve without being tightly coupled t\", \"o low-level implementation details (it also helps if infrastructure concerns depend on abstractions \", \"defined in the business layer). Separation of concerns is a key consideration behind the use of laye\", \"rs in application architectures.\\n\\n## Encapsulation\\n\\nDifferent parts of an application should use enc\", \"apsulation to insulate them from other parts of the application. Application components and layers s\", \"hould be able to adjust their internal implementation without breaking their collaborators as long a\", \"s external contracts are not violated. Proper use of encapsulation helps achieve loose coupling and \", \"modularity in application designs, since objects and packages can be replaced with alternative imple\", \"mentations so long as the same interface is maintained.\\n\\nIn classes, encapsulation is achieved by li\", \"miting outside access to the class's internal state. If an outside actor wants to manipulate the sta\", \"te of the object, it should do so through a well-defined function (or property setter), rather than \", \"having direct access to the private state of the object. Likewise, application components and applic\", \"ations themselves should expose well-defined interfaces for their collaborators to use, rather than \", \"allowing their state to be modified directly. This approach frees the application's internal design \", \"to evolve over time without worrying that doing so will break collaborators, so long as the public c\", \"ontracts are maintained.\\n\\nMutable global state is antithetical to encapsulation. A value fetched fro\", \"m mutable global state in one function cannot be relied upon to have the same value in another funct\", \"ion (or even further in the same function). Understanding concerns with mutable global state is one \", \"of the reasons programming languages like C# have support for different scoping rules, which are use\", \"d everywhere from statements to methods to classes. It's worth noting that data -driven architecture\", \"s which rely on a central database for integration within and between applications are, themselves, \", \"choosing to depend on the mutable global state represented by the database. A key consideration in d\", \"omain-driven design and clean architecture is how to encapsulate access to data, and how to ensure a\", \"pplication state is not made invalid by direct access to its persistence format.\\n\\n## Dependency inve\", \"rsion\\n\\nThe direction of dependency within the application should be in the direction of abstraction,\", \" not implementation details. Most applications are written such that compile-time dependency flows i\", \"n the direction of runtime execution, producing a direct dependency graph. That is, if class A calls\", \" a method of class B and class B calls a method of class C, then at compile time class A will depend\", \" on class B, and class B will depend on class C, as shown in Figure 4-1.\\n\\nDirect Dependency Graph\\n\\nF\", \"igure 4-1. Direct dependency graph.\\n\\n<!-- image -->\\n\\nApplying the dependency inversion principle all\", \"ows A to call methods on an abstraction that B implements, making it possible for A to call B at run\", \" time, but for B to depend on an interface controlled by A at compile time (thus, inverting the typi\", \"cal compile-time dependency). At run time, the flow of program execution remains unchanged, but the \", \"introduction of interfaces means that different implementations of these interfaces can easily be pl\", \"ugged in.\\n\\nInverted Dependency Graph\\n\\nCompile Time\\n\\nClass A\\n\\nReferences\\n\\nInterface B\\n\\nInterface C\\n\\nF\", \"igure 4-2. Inverted dependency graph.\\n\\n<!-- image -->\\n\\nDependency inversion is a key part of buildin\", \"g loosely coupled applications, since implementation details can be written to depend on and impleme\", \"nt higher-level abstractions, rather than the other way around. The resulting applications are more \", \"testable, modular, and maintainable as a result. The practice of dependency injection is made possib\", \"le by following the dependency inversion principle.\\n\\n## Explicit dependencies\\n\\nMethods and classes s\", \"hould explicitly require any collaborating objects they need in order to function correctly. It is c\", \"alled the Explicit Dependencies Principle. Class constructors provide an opportunity for classes to \", \"identify the things they need in order to be in a valid state and to function properly. If you defin\", \"e classes that can be constructed and called, but that will only function properly if certain global\", \" or infrastructure components are in place, these classes are being dishonest with their clients. Th\", \"e constructor contract is telling the client that it only needs the things specified (possibly nothi\", \"ng if the class is just using a parameterless constructor), but then at runtime it turns out the obj\", \"ect really did need something else.\\n\\nBy following the explicit dependencies principle, your classes \", \"and methods are being honest with their clients about what they need in order to function. Following\", \" the principle makes your code more selfdocumenting and your coding contracts more user-friendly, si\", \"nce users will come to trust that as long as they provide what's required in the form of method or c\", \"onstructor parameters, the objects they're working with will behave correctly at run time.\\n\\n## Singl\", \"e responsibility\\n\\nThe single responsibility principle applies to object-oriented design, but can als\", \"o be considered as an architectural principle similar to separation of concerns. It states that obje\", \"cts should have only one responsibility and that they should have only one reason to change. Specifi\", \"cally, the only situation in which the object should change is if the manner in which it performs it\", \"s one responsibility must be\\n\\nRun Time\\n\\nClass A\\n\\nControl Flow\\n\\nInterface B\\n\\nClass B\\n\\nControl Flow\\n\\nI\", \"nterface\\n\\nClass C\\n\\nupdated. Following this principle helps to produce more loosely coupled and modul\", \"ar systems, since many kinds of new behavior can be implemented as new classes, rather than by addin\", \"g additional responsibility to existing classes. Adding new classes is always safer than changing ex\", \"isting classes, since no code yet depends on the new classes.\\n\\nIn a monolithic application, we can a\", \"pply the single responsibility principle at a high level to the layers in the application. Presentat\", \"ion responsibility should remain in the UI project, while data access responsibility should be kept \", \"within an infrastructure project. Business logic should be kept in the application core project, whe\", \"re it can be easily tested and can evolve independently from other responsibilities.\\n\\nWhen this prin\", \"ciple is applied to application architecture and taken to its logical endpoint, you get microservice\", \"s. A given microservice should have a single responsibility. If you need to extend the behavior of a\", \" system, it's usually better to do it by a dding additional microservices, rather than by adding res\", \"ponsibility to an existing one.\\n\\nLearn more about microservices architecture\\n\\n## Don't repeat yourse\", \"lf (DRY)\\n\\nThe application should avoid specifying behavior related to a particular concept in multip\", \"le places as this practice is a frequent source of errors. At some point, a change in requirements w\", \"ill require changing this behavior. It's likely that at least one instance of the behavior will fail\", \" to be updated, and the system will behave inconsistently.\\n\\nRather than duplicating logic, encapsula\", \"te it in a programming construct. Make this construct the single authority over this behavior, and h\", \"ave any other part of the application that requires this behavior use the new construct.\\n\\n## Note\\n\\nA\", \"void binding together behavior that is only coincidentally repetitive. For example, just because two\", \" different constants both have the same value, that doesn't mean you should have only one constant, \", \"if conceptually they're referring to different things. Duplication is always preferable to coupling \", \"to the wrong abstraction.\\n\\n## Persistence ignorance\\n\\nPersistence ignorance (PI) refers to types that\", \" need to be persisted, but whose code is unaffected by the choice of persistence technology. Such ty\", \"pes in .NET are sometimes referred to as Plain Old CLR Objects (POCOs), because they do not need to \", \"inherit from a particular base class or implement a particular interface. Persistence ignorance is v\", \"aluable because it allows the same business model to be persisted in multiple ways, offering additio\", \"nal flexibility to the application. Persistence choices might change over time, from one database te\", \"chnology to another, or additional forms of persistence might be required in addition to whatever th\", \"e application started with (for example, using a Redis cache or Azure Cosmos DB in addition to a rel\", \"ational database).\\n\\nSome examples of violations of this principle include:\\n\\n- A required base class.\", \"\\n- A required interface implementation.\\n- Classes responsible for saving themselves (such as the Act\", \"ive Record pattern).\\n- Required parameterless constructor.\\n- Properties requiring virtual keyword.\\n-\", \" Persistence-specific required attributes.\\n\\nThe requirement that classes have any of the above featu\", \"res or behaviors adds coupling between the types to be persisted and the choice of persistence techn\", \"ology, making it more difficult to adopt new data access strategies in the future.\\n\\n## Bounded conte\", \"xts\\n\\nBounded contexts are a central pattern in Domain-Driven Design. They provide a way of tackling \", \"complexity in large applications or organizations by breaking it up into separate conceptual modules\", \". Each conceptual module then represents a context that is separated from other contexts (hence, bou\", \"nded), and can evolve independently. Each bounded context should ideally be free to choose its own n\", \"ames for concepts within it, and should have exclusive access to its own persistence store.\\n\\nAt a mi\", \"nimum, individual web applications should strive to be their own bounded context, with their own per\", \"sistence store for their business model, rather than sharing a database with other applications. Com\", \"munication between bounded contexts occurs through programmatic interfaces, rather than through a sh\", \"ared database, which allows for business logic and events to take place in response to changes that \", \"take place. Bounded contexts map closely to microservices, which also are ideally implemented as the\", \"ir own individual bounded contexts.\\n\\n## Additional resources\\n\\n- Principles\\n- Bounded Context\\n\\n## Com\", \"mon web application architectures\\n\\n'If you think good architecture is expensive, try bad architectur\", \"e.' - Brian Foote and Joseph Yoder\\n\\nMost traditional .NET applications are deployed as single units \", \"corresponding to an executable or a single web application running within a single IIS appdomain. Th\", \"is approach is the simplest deployment model and serves many internal and smaller public application\", \"s very well. However, even given this single unit of deployment, most non-trivial business applicati\", \"ons benefit from some logical separation into several layers.\\n\\n## What is a monolithic application?\\n\", \"\\nA monolithic application is one that is entirely self-contained, in terms of its behavior. It may i\", \"nteract with other services or data stores in the course of performing its operations, but the core \", \"of its behavior runs within its own process and the entire application is typically deployed as a si\", \"ngle unit. If such an application needs to scale horizontally, typically the entire application is d\", \"uplicated across multiple servers or virtual machines.\\n\\n## All-in-one applications\\n\\nThe smallest pos\", \"sible number of projects for an application architecture is one. In this architecture, the entire lo\", \"gic of the application is contained in a single project, compiled to a single assembly, and deployed\", \" as a single unit.\\n\\nA new ASP.NET Core project, whether created in Visual Studio or from the command\", \" line, starts out as a simple 'all -inone' monolith. It contains all of the behavior of the applicat\", \"ion, including presentation, business, and data access logic. Figure 5-1 shows the file structure of\", \" a single-project app.\\n\\nVS Solution Structure\\n\\nSolution Explorer\\n\\nSearch Solution Explorer (Ctri+:) \", \"|\\n\\na] Solution 'MonolithSample' (1 project)\\n\\n4 5 MonolithSample\\n\\n\\u2022 Connected Services\\n\\n\\u2022 Dependencie\", \"s\\n\\n* Properties\\n\\n* wwwroot\\n\\n\\u2022 Controllers\\n\\n\\u2022 Data\\n\\n\\u2022 Migrations\\n\\n4 \\u2022 Models i deletonocontes\\n\\nI Acco\", \"untViewModels\\n\\nI ManageViewModels co ApplicationUser.cs\\n\\n* \\u2022 Services\\n\\nC\\u2022 IEmailSender.cs c\\u2022 ISmsSen\", \"der.cs\\n\\nC MessageServices.cs\\n\\n] Views\\n\\nAccount\\n\\nHome\\n\\n\\u2022 Manage\\n\\nI Shared\\n\\n\\u2022\\\\_Viewimports.cshtml\\n\\n\\u2022\\\\_\", \"ViewStart.cshtml y2 app.config\\n\\nIT appsettings.json fT bower.json\\n\\nbundleconfig.json c* Program.cs\\n\\n\", \"C\\\" Startup.cs\\n\\nFigure 5-1. A single project ASP.NET Core app.\\n\\n<!-- image -->\\n\\nIn a single project s\", \"cenario, separation of concerns is achieved through the use of folders. The default template include\", \"s separate folders for MVC pattern responsibilities of Models, Views, and Controllers, as well as ad\", \"ditional folders for Data and Services. In this arrangement, presentation details should be limited \", \"as much as possible to the Views folder, and data access implementation details should be limited to\", \" classes kept in the Data folder. Business logic should reside in services and classes within the Mo\", \"dels folder.\\n\\nAlthough simple, the singleproject monolithic solution has some disadvantages. As the \", \"project's size and complexity grows, the number of files and folders will continue to grow as well. \", \"User interface (UI) concerns (models, views, controllers) reside in m ultiple folders, which aren't \", \"grouped together alphabetically. This issue only gets worse when additional UI-level constructs, suc\", \"h as Filters or ModelBinders, are added in their own folders. Business logic is scattered between th\", \"e Models and Services fold ers, and there's no clear indication of which classes in which folders sh\", \"ould depend on which others. This lack of organization at the project level frequently leads to spag\", \"hetti code.\\n\\nTo address these issues, applications often evolve into multi-project solutions, where \", \"each project is considered to reside in a particular layer of the application.\\n\\n## What are layers?\\n\", \"\\nAs applications grow in complexity, one way to manage that complexity is to break up the applicatio\", \"n according to its responsibilities or concerns. This approach follows the separation of concerns pr\", \"inciple and can help keep a growing codebase organized so that developers can easily find where cert\", \"ain functionality is implemented. Layered architecture offers a number of advantages beyond just cod\", \"e organization, though.\\n\\nBy organizing code into layers, common low-level functionality can be reuse\", \"d throughout the application. This reuse is beneficial because it means less code needs to be writte\", \"n and because it can allow the application to standardize on a single implementation, following the \", \"don't repeat yourself (DRY) principle.\\n\\nWith a layered architecture, applications can enforce restri\", \"ctions on which layers can communicate with other layers. This architecture helps to achieve encapsu\", \"lation. When a layer is changed or replaced, only those layers that work with it should be impacted.\", \" By limiting which layers depend on which other layers, the impact of changes can be mitigated so th\", \"at a single change doesn't impact the entire application.\\n\\nLayers (and encapsulation) make it much e\", \"asier to replace functionality within the application. For example, an application might initially u\", \"se its own SQL Server database for persistence, but later could choose to use a cloud-based persiste\", \"nce strategy, or one behind a web API. If the application has properly encapsulated its persistence \", \"implementation within a logical layer, that SQL Server-specific layer could be replaced by a new one\", \" implementing the same public interface.\\n\\nIn addition to the potential of swapping out implementatio\", \"ns in response to future changes in requirements, application layers can also make it easier to swap\", \" out implementations for testing purposes. Instead of having to write tests that operate against the\", \" real data layer or UI layer of the application, these layers can be replaced at test time with fake\", \" implementations that provide known responses to requests. This approach typically makes tests much \", \"easier to write and much faster to run when compared t o running tests against the application's rea\", \"l infrastructure.\\n\\nLogical layering is a common technique for improving the organization of code in \", \"enterprise software applications, and there are several ways in which code can be organized into lay\", \"ers.\\n\\n## Note\\n\\nLayers represent logical separation within the application. In the event that applica\", \"tion logic is physically distributed to separate servers or processes, these separate physical deplo\", \"yment targets are referred to as tiers . It's possible, and quite common, to have an N -Layer applic\", \"ation that is deployed to a single tier.\\n\\n## Traditional 'N -Layer' architecture applications\\n\\nThe m\", \"ost common organization of application logic into layers is shown in Figure 5-2.\\n\\nApplication Layers\", \"\\n\\nFigure 5-2. Typical application layers.\\n\\n<!-- image -->\\n\\nThese layers are frequently abbreviated a\", \"s UI, BLL (Business Logic Layer), and DAL (Data Access Layer). Using this architecture, users make r\", \"equests through the UI layer, which interacts only with the BLL. The BLL, in turn, can call the DAL \", \"for data access requests. The UI layer shouldn't make any requests to the DAL directly, nor should i\", \"t interact with persistence directly through other means. Likewise, the BLL should only interact wit\", \"h persistence by going through the DAL. In this way, each layer has its own well-known responsibilit\", \"y.\\n\\nOne disadvantage of this traditional layering approach is that compile-time dependencies run fro\", \"m the top to the bottom. That is, the UI layer depends on the BLL, which depends on the DAL. This me\", \"ans that the BLL, which usually holds the most important logic in the application, is dependent on d\", \"ata access implementation details (and often on the existence of a database). Testing business logic\", \" in such an architecture is often difficult, requiring a test database. The dependency inversion pri\", \"nciple can be us ed to address this issue, as you'll see in the next section.\\n\\nFigure 5-3 shows an e\", \"xample solution, breaking the application into three projects by responsibility (or layer).\\n\\nCreate \", \"and Deploy\\n\\nVS Solution Structure\\n\\nSolution Explorer\\n\\nA 6. -\\n\\nSearch Solution Explorer (Ctri+:)\\n\\n10.\", \"5.- a Solution 'eShopOnWeb' (3 projects)\\n\\nsTc\\n\\nD / ca ApplicationCore\\n\\n4 [ca) Infrastructure\\n\\n\\u2022 == D\", \"ependencies\\n\\nMigrations\\n\\nD + C\\\" CatalogContext.cs\\n\\nD + C\\\" CatalogContextSeed.cs\\n\\n4 \\u203a Web\\n\\n\\u2022 Connecte\", \"d Services\\n\\n\\u2022 Dependencies\\n\\n\\u2022 a J Properties\\n\\n\\u2022 a wwwroot\\n\\nControllers\\n\\nPics\\n\\nServices\\n\\nViewModels\\n\\n\", \"Views adJ appsettings.json\\n\\n\\u2022 adJ bower.json adJ bundleconfig.json\\n\\nVisual Studio\\n\\nD a C\\\" CatalogSet\", \"tings.cs\\n\\nD a c\\\" Program.cs\\n\\nD a C\\\" Startup.cs tests\\n\\nFigure 5-3. A simple monolithic application wi\", \"th three projects.\\n\\n<!-- image -->\\n\\nAlthough this application uses several projects for organization\", \"al purposes, it's still deployed as a single unit and its clients will interact with it as a single \", \"web app. This allows for very simple deployment process. Figure 5-4 shows how such an app might be h\", \"osted using Azure.\\n\\nFigure 5-4. Simple deployment of Azure Web App\\n\\n<!-- image -->\\n\\nAs application n\", \"eeds grow, more complex and robust deployment solutions may be required. Figure 5-5 shows an example\", \" of a more complex deployment plan that supports additional capabilities.\\n\\nWeb app in\\n\\nAzure App Ser\", \"vice\\n\\naccess token\\n\\nAzure Active\\n\\nDirectory authenticate\\n\\nIP address validate\\n\\ndeployment\\n\\nSource co\", \"ntrol\\n\\nAzure SQL Database\\n\\nSQL\\n\\nlogical server\\n\\nFigure 5-5. Deploying a web app to an Azure App Serv\", \"ice\\n\\n<!-- image -->\\n\\nInternally, this project's organization into multiple projects based on respons\", \"ibility improves the maintainability of the application.\\n\\nThis unit can be scaled up or out to take \", \"advantage of cloud-based on-demand scalability. Scaling up means adding additional CPU, memory, disk\", \" space, or other resources to the server(s) hosting your app. Scaling out means adding additional in\", \"stances of such servers, whether these are physical servers, virtual machines, or containers. When y\", \"our app is hosted across multiple instances, a load balancer is used to assign requests to individua\", \"l app instances.\\n\\nThe simplest approach to scaling a web application in Azure is to configure scalin\", \"g manually in the application's App Service Plan. Figure 5 -6 shows the appropriate Azure dashboard \", \"screen to configure how many instances are serving an app.\\n\\nApp Service Plan\\n\\nServicePlan\\n\\nApp Servi\", \"ce plan\\n\\nDelete\\n\\nEssentials ^\\n\\nResource group demoase1-rg\\n\\nLocation testase1 - Central US\\n\\nStatus\\n\\nR\", \"eady\\n\\nSubscription name\\n\\nPurple Demo Subscription\\n\\nSubscription ID\\n\\nedcc99a4-b7f9-4b5e-a9a1-3034c51d\", \"b496\\n\\nUsage\\n\\nFile System Storage\\n\\nSERVICEPLAN\\n\\n0.01%\\n\\nEstimated spend\\n\\nView your spending in your Ap\", \"p Service\\n\\nEnvironment settings\\n\\n* - \\u2022 x\\n\\nScale setting\\n\\nServicePlan\\n\\nA\\n\\nSave\\n\\nDiscard\\n\\nFigure 5-6. \", \"App Service Plan scaling in Azure.\\n\\n<!-- image -->\\n\\n## Clean architecture\\n\\nApplications that follow \", \"the Dependency Inversion Principle as well as the Domain-Driven Design (DDD) principles tend to arri\", \"ve at a similar architecture. This architecture has gone by many names over the years. One of the fi\", \"rst names was Hexagonal Architecture, followed by Ports-and-Adapters. More recently, it's been cited\", \" as the Onion Architecture or Clean Architecture. The latter name, Clean Architecture, is used as th\", \"e name for this architecture in this e-book.\\n\\nThe eShopOnWeb reference application uses the Clean Ar\", \"chitecture approach in organizing its code into projects. You can find a solution template you can u\", \"se as a starting point for your own ASP.NET Core solutions in the ardalis/cleanarchitecture GitHub r\", \"epository or by installing the template from NuGet.\\n\\nClean architecture puts the business logic and \", \"application model at the center of the application. Instead of having business logic depend on data \", \"access or other infrastructure concerns, this dependency is inverted: infrastructure and implementat\", \"ion details depend on the Application Core. This functionality is achieved by defining abstractions,\", \" or interfaces, in the Application Core, which are then implemented by types defined in the Infrastr\", \"ucture layer. A common way of visualizing this architecture is to use a series of concentric circles\", \", similar to an onion. Figure 5-7 shows an example of this style of architectural representation.\\n\\n-\", \" \\u2022 x\\n\\nClean Architecture Layers (Onion view)\\n\\nUser Interface\\n\\nControllers\\n\\nView Models\\n\\nDomain Servi\", \"ces\\n\\nFigure 5-7. Clean Architecture; onion view\\n\\n<!-- image -->\\n\\nIn this diagram, dependencies flow \", \"toward the innermost circle. The Application Core takes its name from its position at the core of th\", \"is diagram. And you can see on the diagram that the Application Core has no dependencies on other ap\", \"plication layers. The application's entities and interfaces are at the very center. Just outside, bu\", \"t still in the Application Core, are domain services, which typically implement interfaces defined i\", \"n the inner circle. Outside of the Application Core, both the UI and the Infrastructure layers depen\", \"d on the Application Core, but not on one another (necessarily).\\n\\nFigure 5-8 shows a more traditiona\", \"l horizontal layer diagram that better reflects the dependency between the UI and other layers.\\n\\nCle\", \"an Architecture Layers\\n\\n## User Interface\\n\\nFigure 5-8. Clean Architecture; horizontal layer view\\n\\n<!\", \"-- image -->\\n\\nNote that the solid arrows represent compile-time dependencies, while the dashed arrow\", \" represents a runtime-only dependency. With the clean architecture, the UI layer works with interfac\", \"es defined in the Application Core at compile time, and ideally shouldn't know about the implementat\", \"ion types defined in the Infrastructure layer. At run time, however, these implementation types are \", \"required for the app to execute, so they need to be present and wired up to the Application Core int\", \"erfaces via dependency injection.\\n\\nFigure 59 shows a more detailed view of an ASP.NET Core applicati\", \"on's architecture when built following these recommendations.\\n\\nOptional Compile-Time Dependency\\n\\nCom\", \"pile-Time Dependency\\n\\nASPNET Core Architecture\\n\\nClean Architecture Layers (Onion view)\\n\\nASP.NET Core\", \" Web App\\n\\nResponse\\n\\nASPNET Core\\n\\nApplication Core Project\\n\\nUser Interface\\n\\nControllers\\n\\nFigure 5-9. \", \"ASP.NET Core architecture diagram following Clean Architecture.\\n\\n<!-- image -->\\n\\nBecause the Applica\", \"tion Core doesn't depend on Infrastructure, it's very easy to write automated unit tests for this la\", \"yer. Figures 5-10 and 5-11 show how tests fit into this architecture.\\n\\nFigure 5-10. Unit testing App\", \"lication Core in isolation.\\n\\n<!-- image -->\\n\\nView Models\\n\\nInfrastructure Project\\n\\nControllers\\n\\nViewM\", \"odels\\n\\nViews\\n\\nInterfaces\\n\\nPOCO\\n\\nEntities\\n\\nBusiness\\n\\nServices\\n\\nCompile Time Dependency\\n\\nRun Time Depe\", \"ndency\\n\\nSMS Service\\n\\nClean Architecture Layers (Onion view)\\n\\nUser Interface\\n\\nFigure 5-11. Integratio\", \"n testing Infrastructure implementations with external dependencies.\\n\\n<!-- image -->\\n\\nSince the UI l\", \"ayer doesn't have any direct dependency on types defined in the Infrastructure project, it's likewis\", \"e very easy to swap out implementations, either to facilitate testing or in response to changing app\", \"lication requirements. ASP.NET Core's buil t-in use of and support for dependency injection makes th\", \"is architecture the most appropriate way to structure non-trivial monolithic applications.\\n\\nFor mono\", \"lithic applications, the Application Core, Infrastructure, and UI projects are all run as a single a\", \"pplication. The runtime application architecture might look something like Figure 5-12.\\n\\nASPNET Core\", \" Architecture\\n\\nASP.NET Core Web App\\n\\n(Kestrel/Weblistener Host)\\n\\n## Model Validation Filter\\n\\nRespons\", \"e\\n\\nCaching Filter\\n\\nInMemory\\n\\nData Cache\\n\\nEF Core\\n\\nDbContext\\n\\nData Sources\\n\\nSQL\\n\\n<!-- image -->\\n\\nIIS \", \"Reverse\\n\\nProxy\\n\\nEF Core\\n\\nProvider\\n\\nFigure 5-12. A sample ASP.NET Core app's runtime architecture.\\n\\n#\", \"# Organizing code in Clean Architecture\\n\\nIn a Clean Architecture solution, each project has clear re\", \"sponsibilities. As such, certain types belong in each project and you'll frequently find folders cor\", \"responding to these types in the appropriate project.\\n\\n## Application Core\\n\\nThe Application Core hol\", \"ds the business model, which includes entities, services, and interfaces. These interfaces include a\", \"bstractions for operations that will be performed using Infrastructure, such as data access, file sy\", \"stem access, network calls, etc. Sometimes services or interfaces defined at this layer will need to\", \" work with non-entity types that have no dependencies on UI or Infrastructure. These can be defined \", \"as simple Data Transfer Objects (DTOs).\\n\\n## Application Core types\\n\\n- Entities (business model class\", \"es that are persisted)\\n- Aggregates (groups of entities)\\n- Interfaces\\n- Domain Services\\n- Specificat\", \"ions\\n- Custom Exceptions and Guard Clauses\\n- Domain Events and Handlers\\n\\n{}\\n\\ne =\\n\\nClient\\n\\n## Infrast\", \"ructure\\n\\nThe Infrastructure project typically includes data access implementations. In a typical ASP\", \".NET Core web application, these implementations include the Entity Framework (EF) DbContext, any EF\", \" Core Migration objects that have been defined, and data access implementation classes. The most com\", \"mon way to abstract data access implementation code is through the use of the Repository design patt\", \"ern.\\n\\nIn addition to data access implementations, the Infrastructure project should contain implemen\", \"tations of services that must interact with infrastructure concerns. These services should implement\", \" interfaces defined in the Application Core, and so Infrastructure should have a reference to the Ap\", \"plication Core project.\\n\\n## Infrastructure types\\n\\n- EF Core types (DbContext, Migration)\\n- Data acce\", \"ss implementation types (Repositories)\\n- Infrastructure-specific services (for example, FileLogger o\", \"r SmtpNotifier)\\n\\n## UI Layer\\n\\nThe user interface layer in an ASP.NET Core MVC application is the ent\", \"ry point for the application. This project should reference the Application Core project, and its ty\", \"pes should interact with infrastructure strictly through interfaces defined in Application Core. No \", \"direct instantiation of or static calls to the Infrastructure layer types should be allowed in the U\", \"I layer.\\n\\n## UI Layer types\\n\\n- Controllers\\n- Custom Filters\\n- Custom Middleware\\n- Views\\n- ViewModels\", \"\\n- Startup\\n\\nThe Startup class or Program.cs file is responsible for configuring the application, and\", \" for wiring up implementation types to interfaces. The place where this logic is performed is known \", \"as the app's composition root , and is what allows dependency injection to work properly at run time\", \".\\n\\n## Note\\n\\nIn order to wire up dependency injection during app startup, the UI layer project may ne\", \"ed to reference the Infrastructure project. This dependency can be eliminated, most easily by using \", \"a custom DI container that has built-in support for loading types from assemblies. For the purposes \", \"of this sample, the simplest approach is to allow the UI project to reference the Infrastructure pro\", \"ject (but developers should limit actual references to types in the Infrastructure project to the ap\", \"p's composition root).\\n\\nMonolithic Containerized application\\n\\nApp 1 = 1 Container\\n\\nA monolithic appl\", \"ication has most of its functionality within\\n\\na single process/container that is componentized with \", \"internal\\n\\n## Monolithic applications and containers\\n\\nYou can build a single and monolithic-deploymen\", \"t based Web Application or Service and deploy it as a container. Within the application, it might no\", \"t be monolithic but organized into several libraries, components, or layers. Externally, it's a sing\", \"le contai ner with a single process, single web application, or single service.\\n\\nTo manage this mode\", \"l, you deploy a single container to represent the application. To scale, just add additional copies \", \"with a load balancer in front. The simplicity comes from managing a single deployment in a single co\", \"ntainer or VM.\\n\\n<!-- image -->\\n\\nYou can include multiple components/libraries or internal layers wit\", \"hin each container, as illustrated in Figure 5-13. But, following the container principle of \\\\_'a co\", \"ntainer does one thing, and does it in one process\\\\_', the monolithic pattern might be a conflict.\\n\\n\", \"The downside of this approach comes if/when the application grows, requiring it to scale. If the ent\", \"ire application scales, it's not really a problem. However, in most cases, a few parts of the applic\", \"ation are the choke points requiring scaling, while other components are used less.\\n\\nUsing the typic\", \"al eCommerce example, what you likely need to scale is the product information component. Many more \", \"customers browse products than purchase them. More customers use their basket than use the payment p\", \"ipeline. Fewer customers add comments or view their purchase history. And you likely only have a han\", \"dful of employees, in a single region, that need to manage the content and marketing campaigns. By s\", \"caling the monolithic design, all the code is deployed multiple times.\\n\\nIn addition to the 'scale ev\", \"erything' problem, changes to a single component require complete retesting of the entire applicatio\", \"n, and a complete redeployment of all the instances.\\n\\nThe monolithic approach is common, and many or\", \"ganizations are developing with this architectural approach. Many are having good enough results, wh\", \"ile others are hitting limits. Many designed their applications in this model, because the tools and\", \" infrastructure were too difficult to build serviceoriented architectures (SOA), and they didn't see\", \" the need until the app grew. If you find you're hitting\\n\\nHost 1\\n\\n(Server/VM)\\n\\nHost 2\\n\\n(Server/VM)\\n\\n\", \"Host 3\\n\\n(Server/VM)\\n\\nBrowser or\\n\\nClient app\\n\\nArchitecture in Docker infrastructure for monolithic ap\", \"plications\\n\\nthe limits of the monolithic approach, breaking up the app to enable it to better levera\", \"ge containers and microservices may be the next logical step.\\n\\nAzure\\n\\n## Host 1 (VM)\\n\\n<!-- image -->\", \"\\n\\nDeploying monolithic applications in Microsoft Azure can be achieved using dedicated VMs for each \", \"instance. Using Azure Virtual Machine Scale Sets, you can easily scale the VMs. Azure App Services c\", \"an run monolithic applications and easily scale instances without having to manage the VMs. Azure Ap\", \"p Services can run single instances of Docker containers as well, simplifying the deployment. Using \", \"Docker, you can deploy a single VM as a Docker host, and run multiple instances. Using the Azure bal\", \"ancer, as shown in the Figure 5-14, you can manage scaling.\\n\\nThe deployment to the various hosts can\", \" be managed with traditional deployment techniques. The Docker hosts can be managed with commands li\", \"ke docker run performed manually, or through automation such as Continuous Delivery (CD) pipelines.\\n\", \"\\n## Monolithic application deployed as a container\\n\\nThere are benefits of using containers to manage\", \" monolithic application deployments. Scaling the instances of containers is far faster and easier th\", \"an deploying additional VMs. Even when using virtual machine scale sets to scale VMs, they take time\", \" to create. When deployed as app instances, the configuration of the app is managed as part of the V\", \"M.\\n\\nDeploying updates as Docker images is far faster and network efficient. Docker Images typically \", \"start in seconds, speeding rollouts. Tearing down a Docker instance is as easy as issuing a docker s\", \"top command, typically completing in less than a second.\\n\\nAs containers are inherently immutable by \", \"design, you never need to worry about corrupted VMs, whereas update scripts might forget to account \", \"for some specific configuration or file left on the disk.\\n\\nYou can use Docker containers for a monol\", \"ithic deployment of simpler web applications. This approach improves continuous integration and cont\", \"inuous deployment pipelines and helps achieve deployment-toproduction success. No more 'It works on \", \"my machine, wh y does it not work in production?'\\n\\nA microservices-based architecture has many benef\", \"its, but those benefits come at a cost of increased complexity. In some cases, the costs outweigh th\", \"e benefits, so a monolithic deployment application running in a single container or in just a few co\", \"ntainers is a better option.\\n\\nA monolithic application might not be easily decomposable into well-se\", \"parated microservices. Microservices should work independently of each other to provide a more resil\", \"ient application. If you can't deliver independent feature slices of the application, separating it \", \"only adds complexity.\\n\\nAn application might not yet need to scale features independently. Many appli\", \"cations, when they need to scale beyond a single instance, can do so through the relatively simple p\", \"rocess of cloning that entire instance. The additional work to separate the application into discret\", \"e services provides a minimal benefit when scaling full instances of the application is simple and c\", \"ost-effective.\\n\\nEarly in the development of an application, you might not have a clear idea where th\", \"e natural functional boundaries are. As you develop a minimum viable product, the natural separation\", \" might not yet have emerged. Some of these conditions might be temporary. You might start by creatin\", \"g a monolithic application, and later separate some features to be developed and deployed as microse\", \"rvices. Other conditions might be essential to the application's problem space, meaning that the app\", \"lication might never be broken into multiple microservices.\\n\\nSeparating an application into many dis\", \"crete processes also introduces overhead. There's more complexity in separating features into differ\", \"ent processes. The communication protocols become more complex. Instead of method calls, you must us\", \"e asynchronous communications between services. As you move to a microservices architecture, you nee\", \"d to add many of the building blocks implemented in the microservices version of the eShopOnContaine\", \"rs application: event bus handling, message resiliency and retries, eventual consistency, and more.\\n\", \"\\nThe much simpler eShopOnWeb reference application supports single-container monolithic container us\", \"age. The application includes one web application that includes traditional MVC views, web APIs, and\", \" Razor Pages. Optionally, you can run the application's Blazor -based admin component, which require\", \"s a separate API project to run as well.\\n\\nThe application can be launched from the solution root usi\", \"ng the docker-compose build and dockercompose up commands. This command configures a container for t\", \"he web instance, using the Dockerfile found in the web project's root, and runs the container on a s\", \"pecified port. You can download the source for this application from GitHub and run it locally. Even\", \" this monolithic application benefits from being deployed in a container environment.\\n\\nFor one, the \", \"containerized deployment means that every instance of the application runs in the same environment. \", \"This approach includes the developer environment where early testing and development take place. The\", \" development team can run the application in a containerized environment that matches the production\", \" environment.\\n\\nIn addition, containerized applications scale out at a lower cost. Using a container \", \"environment enables greater resource sharing than traditional VM environments.\\n\\nFinally, containeriz\", \"ing the application forces a separation between the business logic and the storage server. As the ap\", \"plication scales out, the multiple containers will all rely on a single physical storage medium. Thi\", \"s storage medium would typically be a high-availability server running a SQL Server database.\\n\\n## Do\", \"cker support\\n\\nThe eShopOnWeb project runs on .NET. Therefore, it can run in either Linux-based or Wi\", \"ndows-based containers. Note that for Docker deployment, you want to use the same host type for SQL \", \"Server. Linux-based containers allow a smaller footprint and are preferred.\\n\\nYou can use Visual Stud\", \"io 2017 or later to add Docker support to an existing application by rightclicking on a project in S\", \"olution Explorer and choosing Add &gt; Docker Support . This step adds the files required and modifi\", \"es the project to use them. The current eShopOnWeb sample already has these files in place.\\n\\nThe sol\", \"ution-level docker-compose.yml file contains information about what images to build and what contain\", \"ers to launch. The file allows you to use the docker-compose command to launch multiple applications\", \" at the same time. In this case, it is only launching the Web project. You can also use it to config\", \"ure dependencies, such as a separate database container.\\n\\n```\\nversion : '3' services : eshopwebmvc :\", \" image : eshopwebmvc build : context : . dockerfile : src/Web/Dockerfile environment : -ASPNETCORE_E\", \"NVIRONMENT=Development ports : -\\\"5106:5106\\\" networks : default : external : name : nat\\n```\\n\\nThe dock\", \"er-compose.yml file references the Dockerfile in the Web project. The Dockerfile is used to specify \", \"which base container will be used and how the application will be configured on it. The Web' Dockerf\", \"ile:\\n\\n```\\nFROM mcr.microsoft.com/dotnet/sdk:8.0 AS build WORKDIR /app COPY *.sln . COPY . . WORKDIR \", \"/app/src/Web RUN dotnet restore\\n```\\n\\n```\\nRUN dotnet publish -c Release -o out FROM mcr.microsoft.com\", \"/dotnet/aspnet:8.0 AS runtime WORKDIR /app COPY --from=build /app/src/Web/out ./ ENTRYPOINT [\\\"dotnet\", \"\\\", \\\"Web.dll\\\"]\\n```\\n\\n## Troubleshooting Docker problems\\n\\nOnce you run the containerized application, i\", \"t continues to run until you stop it. You can view which containers are running with the docker ps c\", \"ommand. You can stop a running container by using the docker stop command and specifying the contain\", \"er ID.\\n\\nNote that running Docker containers may be bound to ports you might otherwise try to use in \", \"your development environment. If you try to run or debug an application using the same port as a run\", \"ning Docker container, you'll get an error stating that the server can't bind to that port. Once aga\", \"in, stopping the container should resolve the issue.\\n\\nIf you want to add Docker support to your appl\", \"ication using Visual Studio, make sure Docker Desktop is running when you do so. The wizard won't ru\", \"n correctly if Docker Desktop isn't running when you start the wizard. In addition, the wizard exami\", \"nes your current container choice to add the correct Docker support. If you want to add, support for\", \" Windows Containers, you need to run the wizard while you have Docker Desktop running with Windows C\", \"ontainers configured. If you want to add, support for Linux containers, run the wizard while you hav\", \"e Docker running with Linux containers configured.\\n\\n## Other web application architectural styles\\n\\n-\", \" Web-Queue-Worker: The core components of this architecture are a web front end that serves client r\", \"equests, and a worker that performs resource-intensive tasks, long-running workflows, or batch jobs.\", \" The web front end communicates with the worker through a message queue.\\n- N-tier: An N-tier archite\", \"cture divides an application into logical layers and physical tiers.\\n- Microservice: A microservices\", \" architecture consists of a collection of small, autonomous services. Each service is self-contained\", \" and should implement a single business capability within a bounded context.\\n\\n## References -Common \", \"web architectures\\n\\n- The Clean Architecture https://blog.cleancoder.com/uncle-bob/2012/08/13/the-cle\", \"an-architecture.html\\n- The Onion Architecture\\n\\nhttps://jeffreypalermo.com/blog/the-onion-architectur\", \"e-part-1/\\n\\n- The Repository Pattern\\n\\nhttps://deviq.com/repository-pattern/\\n\\n- Clean Architecture Sol\", \"ution Template\\n\\nhttps://github.com/ardalis/cleanarchitecture\\n\\n- Architecting Microservices e-book ht\", \"tps://aka.ms/MicroservicesEbook\\n- DDD (Domain-Driven Design) https://learn.microsoft.com/dotnet/arch\", \"itecture/microservices/microservice-ddd-cqrspatterns/\\n\\n## Common client-side web technologies\\n\\n'Webs\", \"ites should look good from the inside and out.' - Paul Cookson\\n\\nASP.NET Core applications are web ap\", \"plications and they typically rely on client-side web technologies like HTML, CSS, and JavaScript. B\", \"y separating the content of the page (the HTML) from its layout and styling (the CSS), and its behav\", \"ior (via JavaScript), complex web apps can leverage the Separation of Concerns principle. Future cha\", \"nges to the structure, design, or behavior of the application can be made more easily when these con\", \"cerns are not intertwined.\\n\\nWhile HTML and CSS are relatively stable, JavaScript, by means of the ap\", \"plication frameworks and utilities developers work with to build web-based applications, is evolving\", \" at breakneck speed. This chapter looks at a few ways that JavaScript is used by web developers and \", \"provides a high-level overview of the Angular and React client-side libraries.\\n\\n## Note\\n\\nBlazor prov\", \"ides an alternative to JavaScript frameworks for building rich, interactive client user interfaces.\\n\", \"\\n## HTML\\n\\nHTML is the standard markup language used to create web pages and web applications. Its el\", \"ements form the building blocks of pages, representing formatted text, images, form inputs, and othe\", \"r structures. When a browser makes a request to a URL, whether fetching a page or an application, th\", \"e first thing that is returned is an HTML document. This HTML document may reference or include addi\", \"tional information about its look and layout in the form of CSS, or behavior in the form of JavaScri\", \"pt.\\n\\n## CSS\\n\\nCSS (Cascading Style Sheets) is used to control the look and layout of HTML elements. C\", \"SS styles can be applied directly to an HTML element, defined separately on the same page, or define\", \"d in a separate file and referenced by the page. Styles cascade based on how they are used to select\", \" a given HTML element. For instance, a style might apply to an entire document, but would be overrid\", \"den by a\\n\\nCSS Specificity style that applied to a particular element. Likewise, an element-specific \", \"style would be overridden by a style that applied to a CSS class that was applied to the element, wh\", \"ich in turn would be overridden by a style targeting a specific instance of that element (via its ID\", \"). Figure 6-1\\n\\nFigure 6-1. CSS Specificity rules, in order.\\n\\n<!-- image -->\\n\\nIt's best to keep style\", \"s in their own separate stylesheet files, and to use selection -based cascading to implement consist\", \"ent and reusable styles within the application. Placing style rules within HTML should be avoided, a\", \"nd applying styles to specific individual elements (rather than whole classes of elements, or elemen\", \"ts that have had a particular CSS class applied to them) should be the exception, not the rule.\\n\\n## \", \"CSS preprocessors\\n\\nCSS stylesheets lack support for conditional logic, variables, and other programm\", \"ing language features. Thus, large stylesheets often include quite a bit of repetition, as the same \", \"color, font, or other setting is applied to many different variations of HTML elements and CSS class\", \"es. CSS preprocessors can help your stylesheets follow the DRY principle by adding support for varia\", \"bles and logic.\\n\\nThe most popular CSS preprocessors are Sass and LESS. Both extend CSS and are backw\", \"ard compatible with it, meaning that a plain CSS file is a valid Sass or LESS file. Sass is Ruby-bas\", \"ed and LESS is JavaScript based, and both typically run as part of your local development process. B\", \"oth have command-line tools available, as well as built-in support in Visual Studio for running them\", \" using Gulp or Grunt tasks.\\n\\n## JavaScript\\n\\nJavaScript is a dynamic, interpreted programming languag\", \"e that has been standardized in the ECMAScript language specification. It is the programming languag\", \"e of the web. Like CSS, JavaScript can be defined as attributes within HTML elements, as blocks of s\", \"cript within a page, or in separate files. Just like CSS, it's recommended to organize JavaScript in\", \"to separate files, keeping it separated as much as possible from the HTML found on individual web pa\", \"ges or application views.\\n\\nWhen working with JavaScript in your web application, there are a few tas\", \"ks that you'll commonly need to perform:\\n\\n- Selecting an HTML element and retrieving and/or updating\", \" its value.\\n- Querying a Web API for data.\\n- Sending a command to a Web API (and responding to a cal\", \"lback with its result).\\n- Performing validation.\\n\\nYou can perform all of these tasks with JavaScript\", \" alone, but many libraries exist to make these tasks easier. One of the first and most successful of\", \" these libraries is jQuery, which continues to be a popular choice for simplifying these tasks on we\", \"b pages. For Single Page Applications (SPAs), jQuery doesn't provide many of the desired features th\", \"at Angular and React offer.\\n\\n## Legacy web apps with jQuery\\n\\nAlthough ancient by JavaScript framewor\", \"k standards, jQuery continues to be a commonly used library for working with HTML/CSS and building a\", \"pplications that make AJAX calls to web APIs. However, jQuery operates at the level of the browser d\", \"ocument object model (DOM), and by default offers only an imperative, rather than declarative, model\", \".\\n\\nFor example, imagine that if a textbox's value exceeds 10, an element on the page should be made \", \"visible. In jQuery, this functionality would typically be implemented by writing an event handler wi\", \"th code that would inspect the textbox's value and set the visibility of the target element based on\", \" that value. This process is an imperative, code-based approach. Another framework might instead use\", \" databinding to bind the visibility of the element to the value of the textbox declaratively. This a\", \"pproach would not require writing any code, but instead only requires decorating the elements involv\", \"ed with data binding attributes. As client-side behaviors grow more complex, data binding approaches\", \" frequently result in simpler solutions with less code and conditional complexity.\\n\\n## jQuery vs a S\", \"PA Framework\\n\\n| Factor                   | jQuery   | Angular   |\\n|--------------------------|------\", \"----|-----------|\\n| Abstracts the DOM        | Yes      | Yes       |\\n| AJAX Support             | Y\", \"es      | Yes       |\\n| Declarative Data Binding | No       | Yes       |\\n| MVC-style Routing       \", \" | No       | Yes       |\\n\\n| Factor            | jQuery   | Angular   |\\n|-------------------|-------\", \"---|-----------|\\n| Templating        | No       | Yes       |\\n| Deep-Link Routing | No       | Yes  \", \"     |\\n\\nMost of the features jQuery lacks intrinsically can be added with the addition of other libr\", \"aries. However, a SPA framework like Angular provides these features in a more integrated fashion, s\", \"ince it's been designed with all of them in mind from the start. Also, jQuery is an imperative libra\", \"ry, meaning that you need to call jQuery functions in order to do anything with jQuery. Much of the \", \"work and functionality that SPA frameworks provide can be done declaratively, requiring no actual co\", \"de to be written.\\n\\nData binding is a great example of this functionality. In jQuery, it usually only\", \" takes one line of code to get the value of a DOM element or to set an element's value. However, you\", \" have to write this code anytime you need to change the value of the element, and sometimes this wil\", \"l occur in multiple functions on a page. Another common example is element visibility. In jQuery, th\", \"ere might be many different places where you'd write code to control whether certain elements were v\", \"isible. In each of these cases, when using data binding, no code would need to be written. You'd sim\", \"ply bind the value or visibility of the elements in question to a viewmodel on the page, and changes\", \" to that viewmodel would automatically be reflected in the bound elements.\\n\\n## Angular SPAs\\n\\nAngular\", \" remains one of the world's most popular JavaScript frameworks. Since Angular 2, the team rebuilt th\", \"e framework from the ground up (using TypeScript) and rebranded from the original AngularJS name to \", \"Angular. Now several years old, the redesigned Angular continues to be a robust framework for buildi\", \"ng Single Page Applications.\\n\\nAngular applications are built from components. Components combine HTM\", \"L templates with special objects and control a portion of the page. A simple component from Angular'\", \"s docs is shown here:\\n\\n```\\nimport { Component } from '@angular/core'; @Component({ selector: 'my-app\", \"', template: `<h1>Hello {{name}}</h1>` }) export class AppComponent { name = 'Angular'; }\\n```\\n\\nCompo\", \"nents are defined using the @Component decorator function, which takes in metadata about the compone\", \"nt. The selector property identifies the ID of the element on the page where this component will be \", \"displayed. The template property is a simple HTML template that includes a placeholder that correspo\", \"nds to the component's name property, defined on the last line.\\n\\nBy working with components and temp\", \"lates, instead of DOM elements, Angular apps can operate at a higher level of abstraction and with l\", \"ess overall code than apps written using just JavaScript (also called 'vanilla JS') or with jQuery. \", \"Angular also imposes some order on how you organize your clientside script files. By convention, Ang\", \"ular apps use a common folder structure, with module and\\n\\ncomponent script files located in an app f\", \"older. Angular scripts concerned with building, deploying, and testing the app are typically located\", \" in a higher-level folder.\\n\\nYou can develop Angular apps by using a CLI. Getting started with Angula\", \"r development locally (assuming you already have git and npm installed) consists of simply cloning a\", \" repo from GitHub and running npm install and npm start. Beyond this, Angular ships its own CLI, whi\", \"ch can create projects, add files, and assist with testing, bundling, and deployment tasks. This CLI\", \" friendliness makes Angular especially compatible with ASP.NET Core, which also features great CLI s\", \"upport.\\n\\nMicrosoft has developed a reference application, eShopOnContainers, which includes an Angul\", \"ar SPA implementation. This app includes Angular modules to manage the online store's shopping baske\", \"t, load and display items from its catalog, and handling order creation. You can view and download t\", \"he sample application from GitHub.\\n\\n## React\\n\\nUnlike Angular, which offers a full Model-View-Control\", \"ler pattern implementation, React is only concerned with views. It's not a framework, just a library\", \", so to build a SPA you'll need to leverage additional libraries. There are a number of libraries th\", \"at are designed to be used with React to produce rich single page applications.\\n\\nOne of React's most\", \" important features is its use of a virtual DOM. The virtual DOM provides React with several advanta\", \"ges, including performance (the virtual DOM can optimize which parts of the actual DOM need to be up\", \"dated) and testability (no need to have a browser to test React and its interactions with its virtua\", \"l DOM).\\n\\nReact is also unusual in how it works with HTML. Rather than having a strict separation bet\", \"ween code and markup (with references to JavaScript appearing in HTML attributes perhaps), React add\", \"s HTML directly within its JavaScript code as JSX. JSX is HTML-like syntax that can compile down to \", \"pure JavaScript. For example:\\n\\n```\\n<ul> { authors.map(author => <li key={author.id}>{author.name}</l\", \"i> )} </ul>\\n```\\n\\nIf you already know JavaScript, learning React should be easy. There isn't nearly a\", \"s much learning curve or special syntax involved as with Angular or other popular libraries.\\n\\nBecaus\", \"e React isn't a full framework, you'll typically want other libraries to handle things like routing,\", \" web API calls, and dependency management. The nice thing is, you can pick the best library for each\", \" of these, but the disadvantage is that you need to make all of these decisions and verify all of yo\", \"ur chosen libraries work well together when you're done. If you want a good starting point, you can \", \"use a starter kit like React Slingshot, which prepackages a set of compatible libraries together wit\", \"h React.\\n\\n## Vue\\n\\nFrom its getting started guide, 'Vue is a progressive framework for building user \", \"interfaces. Unlike other monolithic frameworks, Vue is designed from the ground up to be incremental\", \"ly adoptable. The\\n\\ncore library is focused on the view layer only, and is easy to pick up and integr\", \"ate with other libraries or existing projects. On the other hand, Vue is perfectly capable of poweri\", \"ng sophisticated SinglePage Applications when used in combination with mod ern tooling and supportin\", \"g libraries.'\\n\\nGetting started with Vue simply requires including its script within an HTML file:\\n\\n`\", \"``\\n<!-- development version, includes helpful console warnings --> < script src =\\\"https://cdn.jsdeli\", \"vr.net/npm/vue/dist/vue.js\\\"></ script > With the framework added, you're then able to declaratively \", \"render data to the DOM using Vue's straightforward templating syntax: < div id =\\\"app\\\"> {{ message }}\", \" </ div > and then adding the following script: var app = new Vue({ el: '#app', data: { message: 'He\", \"llo Vue!' } })\\n```\\n\\nThis is enough to render \\\"Hello Vue!\\\" on the page. Note, however, that Vue isn't\", \" simply rendering the message to the div once. It supports databinding and dynamic updates such that\", \" if the value of message changes, the value in the &lt;div&gt; is immediately updated to reflect it.\", \"\\n\\nOf course, this only scratches the surface of what Vue is capable of. It's gained a great deal of \", \"popularity in the last several years and has a large community. There's a huge and growing list of s\", \"upporting components and libraries that work with Vue to extend it as well. If you're looking to add\", \" client-side behavior to your web application or considering building a full SPA, Vue is worth inves\", \"tigating.\\n\\n## Blazor WebAssembly\\n\\nUnlike other JavaScript frameworks, Blazor WebAssembly is a single\", \"-page app (SPA) framework for building interactive client-side web apps with .NET. Blazor WebAssembl\", \"y uses open web standards without plugins or recompiling code into other languages. Blazor WebAssemb\", \"ly works in all modern web browsers, including mobile browsers.\\n\\nRunning .NET code inside web browse\", \"rs is made possible by WebAssembly (abbreviated wasm). WebAssembly is a compact bytecode format opti\", \"mized for fast download and maximum execution speed. WebAssembly is an open web standard and is supp\", \"orted in web browsers without plugins.\\n\\nWebAssembly code can access the full functionality of the br\", \"owser via JavaScript, called JavaScript interoperability, often shortened to JavaScript interop or J\", \"S interop. .NET code executed via WebAssembly in the browser runs in the browser's JavaScript sandbo\", \"x with the protections that the sandbox provides against malicious actions on the client machine.\\n\\nF\", \"or more information, see Introduction to ASP.NET Core Blazor.\\n\\n## Choosing a SPA Framework\\n\\nWhen con\", \"sidering which option will work best to support your SPA, keep in mind the following considerations:\", \"\\n\\n- Is your team familiar with the framework and its dependencies (including TypeScript in some case\", \"s)?\\n- How opinionated is the framework, and do you agree with its default way of doing things?\\n- Doe\", \"s it (or a companion library) include all of the features your app requires?\\n- Is it well documented\", \"?\\n- How active is its community? Are new projects being built with it?\\n- How active is its core team\", \"? Are issues being resolved and new versions shipped regularly?\\n\\nFrameworks continue to evolve with \", \"breakneck speed. Use the considerations listed above to help mitigate the risk of choosing a framewo\", \"rk you'll later regret being dependent upon. If you're particularly risk-averse, consider a framewor\", \"k that offers commercial support and/or is being developed by a large enterprise.\\n\\n## References -Cl\", \"ient Web Technologies\\n\\n| \\u2022   | HTML and CSS https://www.w3.org/standards/webdesign/htmlcss          \", \"                                                                                                  |\\n\", \"|-----|---------------------------------------------------------------------------------------------\", \"---------------------------------------------------------------------------|\\n| \\u2022   | Sass vs. LESS h\", \"ttps://www.keycdn.com/blog/sass-vs-less/                                                            \", \"                                                    |\\n| \\u2022   | Styling ASP.NET Core Apps with LESS, S\", \"ass, and Font Awesome https://learn.microsoft.com/aspnet/core/client-side/less-sass-fa              \", \"                             |\\n| \\u2022   | Client-Side Development in ASP.NET Core https://learn.microso\", \"ft.com/aspnet/core/client-side/                                                                     \", \"      |\\n| \\u2022   | jQuery https://jquery.com/                                                          \", \"                                                                                   |\\n| \\u2022   | Angular\", \" https://angular.io/                                                                                \", \"                                                            |\\n| \\u2022   | React https://reactjs.org/    \", \"                                                                                                    \", \"                                     |\\n| \\u2022   | Vue https://vuejs.org/                               \", \"                                                                                                    \", \"              |\\n| \\u2022   | Angular vs React vs Vue: Which Framework to Choose in 2020 https://www.codei\", \"nwp.com/blog/angular-vs-vue-vs-react/                                                      |\\n| \\u2022   |\", \" The Top JavaScript Frameworks for Front-End Development in 2020 https://www.freecodecamp.org/news/c\", \"omplete-guide-for-front-end-developers-javascript- frameworks-2019/ |\\n\\n## Develop ASP.NET Core MVC a\", \"pps\\n\\n'It's not important to get it right the first time. It's vitally important to get it right the \", \"last time.' -Andrew Hunt and David Thomas\\n\\nASP.NET Core is a cross-platform, open-source framework f\", \"or building modern cloud-optimized web applications. ASP.NET Core apps are lightweight and modular, \", \"with built-in support for dependency injection, enabling greater testability and maintainability. Co\", \"mbined with MVC, which supports building modern web APIs in addition to view-based apps, ASP.NET Cor\", \"e is a powerful framework with which to build enterprise web applications.\\n\\n## MVC and Razor Pages\\n\\n\", \"ASP.NET Core MVC offers many features that are useful for building web-based APIs and apps. The term\", \" MVC stands for 'Model -ViewController', a UI pattern that breaks up the responsibilities of respond\", \"ing to user requests into several parts. In addition to following this pattern, you can also impleme\", \"nt features in your ASP.NET Core apps as Razor Pages.\\n\\nRazor Pages are built into ASP.NET Core MVC, \", \"and use the same features for routing, model binding, filters, authorization, etc. However, instead \", \"of having separate folders and files for Controllers, Models, Views, etc. and using attribute-based \", \"routing, Ra zor Pages are placed in a single folder ('/Pages'), route based on their relative locati\", \"on in this folder, and handle requests with handlers instead of controller actions. As a result, whe\", \"n working with Razor Pages, all of the files and classes you need are typically colocated, not sprea\", \"d throughout the web project.\\n\\nLearn more about how MVC, Razor Pages, and related patterns are appli\", \"ed in the eShopOnWeb sample application.\\n\\nWhen you create a new ASP.NET Core App, you should have a \", \"plan in mind for the kind of app you want to build. When creating a new project, in your IDE or usin\", \"g the dotnet new CLI command, you will choose from several templates. The most common project templa\", \"tes are Empty, Web API, Web App, and Web App (Model-View-Controller). Although you can only make thi\", \"s decision when you first create a project, it's not an irrevocable decision. The Web API project us\", \"es standard Model -ViewController controllers -it just lacks Views by default. Likewise, the default\", \" Web App template uses Razor Pages, and so also lacks a Views folder. You can add a Views folder to \", \"these projects later to support view-based behavior. Web API and Model-ViewController projects don't\", \" include a Pages\\n\\nfolder by default, but you can add one later to support Razor Pages-based behavior\", \". You can think of these three templates as supporting three different kinds of default user interac\", \"tion: data (web API), page-based, and view-based. However, you can mix and match any or all of these\", \" templates within a single project if you wish.\\n\\n## Why Razor Pages?\\n\\nRazor Pages is the default app\", \"roach for new web applications in Visual Studio. Razor Pages offers a simpler way of building page-b\", \"ased application features, such as non-SPA forms. Using controllers and views, it was common for app\", \"lications to have very large controllers that worked with many different dependencies and view model\", \"s and returned many different views. This resulted in more complexity and often resulted in controll\", \"ers that didn't follow the Single Responsibility Principle or Open/Closed Principles effectively. Ra\", \"zor Pages addresses this issue by encapsulating the server-side logic for a given logical 'page' in \", \"a web application with its Razor markup. A Razor Page that has no serverside logic can only consist \", \"of a Razor file (for instance, 'Index.cshtml'). However, most non -trivial Razor Pages will have an \", \"associated page model class, which by convention is named the same as the Razor file with a '.cs' ex\", \"tension (for example, 'Index.cshtml.cs').\\n\\nA Razor Page's page model combines the responsibilities o\", \"f an MVC controller and a viewmodel. Instead of handling requests with controller action methods, pa\", \"ge model handlers like 'OnGet()' are executed, rendering their associated page by default. Razor Pag\", \"es simplifies the process of building individual pages in an ASP.NET Core app, while still providing\", \" all the architectural features of ASP.NET Core MVC. They're a good default choice for new page -bas\", \"ed functionality.\\n\\n## When to use MVC\\n\\nIf you're building web APIs, the MVC pattern makes more sense\", \" than trying to use Razor Pages. If your project will only expose web API endpoints, you should idea\", \"lly start from the Web API project template. Otherwise, it's easy to add controllers and associ ated\", \" API endpoints to any ASP.NET Core app. Use the viewbased MVC approach if you're migrating an existi\", \"ng application from ASP.NET MVC 5 or earlier to ASP.NET Core MVC and you want to do so with the leas\", \"t amount of effort. Once you've made the initial migration, you can evaluate whether it makes sense \", \"to adopt Razor Pages for new features or even as a wholesale migration. For more information about p\", \"orting .NET 4.x apps to .NET 8, see Porting Existing ASP.NET Apps to ASP.NET Core eBook.\\n\\nWhether yo\", \"u choose to build your web app using Razor Pages or MVC views, your app will have similar performanc\", \"e and will include support for dependency injection, filters, model binding, validation, and so on.\\n\", \"\\n## Mapping requests to responses\\n\\nAt its heart, ASP.NET Core apps map incoming requests to outgoing\", \" responses. At a low level, this mapping is done with middleware, and simple ASP.NET Core apps and m\", \"icroservices may be comprised solely of custom middleware. When using ASP.NET Core MVC, you can work\", \" at a somewhat higher level, thinking in terms of routes , controllers , and actions . Each incoming\", \" request is compared with the application's routing table, and if a matching route is found, the ass\", \"ociated action\\n\\nmethod (belonging to a controller) is called to handle the request. If no matching r\", \"oute is found, an error handler (in this case, returning a NotFound result) is called.\\n\\nASP.NET Core\", \" MVC apps can use conventional routes, attribute routes, or both. Conventional routes are defined in\", \" code, specifying routing conventions using syntax like in the example below:\\n\\n```\\napp.UseEndpoints(\", \"endpoints => { endpoints.MapControllerRoute(name: \\\"default\\\", pattern: \\\"{controller=Home}/{action=Ind\", \"ex}/{id?}\\\"); });\\n```\\n\\nIn this example, a route named 'default' has been added to the routing table. \", \"It defines a route template with placeholders for controller, action, and id. The controller and act\", \"ion placeholders have the default specified (Home and Index, respectively), and the id placeholder i\", \"s optional (by virtue of a '?' applied to it). The convention defined here states that the first par\", \"t of a request should correspond to the name of the controller, the second part to the action, and t\", \"hen if necessary a third part will represent an ID parameter. Conventional routes are typically defi\", \"ned in one place for the application, such as in Program.cs where the request middleware pipeline is\", \" configured.\\n\\nAttribute routes are applied to controllers and actions directly, rather than specifie\", \"d globally. This approach has the advantage of making them much more discoverable when you're lookin\", \"g at a particular method, but does mean that routing information is not kept in one place in the app\", \"lication. With attribute routes, you can easily specify multiple routes for a given action, as well \", \"as combine routes between controllers and actions. For example:\\n\\n```\\n[Route(\\\"Home\\\")] public class Ho\", \"meController : Controller { [Route(\\\"\\\")] // Combines to define the route template \\\"Home\\\" [Route(\\\"Inde\", \"x\\\")] // Combines to define route template \\\"Home/Index\\\" [Route(\\\"/\\\")] // Does not combine, defines the\", \" route template \\\"\\\" public IActionResult Index() {} }\\n```\\n\\nRoutes can be specified on [HttpGet] and s\", \"imilar attributes, avoiding the need to add separate [Route] attributes. Attribute routes can also u\", \"se tokens to reduce the need to repeat controller or action names, as shown below:\\n\\n```\\n[Route(\\\"[con\", \"troller]\\\")] public class ProductsController : Controller { [Route(\\\"\\\")] // Matches 'Products' [Route(\", \"\\\"Index\\\")] // Matches 'Products/Index' public IActionResult Index() {} }\\n```\\n\\nRazor Pages don't use a\", \"ttribute routing. You can specify additional route template information for a Razor Page as part of \", \"its @page directive:\\n\\n```\\n@page \\\"{id:int}\\\"\\n```\\n\\nIn the previous example, the page in question would \", \"match a route with an integer id parameter. For example, the Products.cshtml page located in the roo\", \"t of /Pages would respond to requests like this one:\\n\\n## /Products/123\\n\\nOnce a given request has bee\", \"n matched to a route, but before the action method is called, ASP.NET Core MVC will perform model bi\", \"nding and model validation on the request. Model binding is responsible for converting incoming HTTP\", \" data into the .NET types specified as parameters of the action method to be called. For example, if\", \" the action method expects an int id parameter, model binding will attempt to provide this parameter\", \" from a value provided as part of the request. To do so, model binding looks for values in a posted \", \"form, values in the route itself, and query string values. Assuming an id value is found, it will be\", \" converted to an integer before being passed into the action method.\\n\\nAfter binding the model but be\", \"fore calling the action method, model validation occurs. Model validation uses optional attributes o\", \"n the model type, and can help ensure that the provided model object conforms to certain data requir\", \"ements. Certain values may be specified as required, or limited to a certain length or numeric range\", \", etc. If validation attributes are specified but the model does not conform to their requirements, \", \"the property ModelState.IsValid will be false, and the set of failing validation rules will be avail\", \"able to send to the client making the request.\\n\\nIf you're using model validation, you should be sure\", \" to always check that the model is valid before performing any state-altering commands, to ensure yo\", \"ur app is not corrupted by invalid data. You can use a filter to avoid the need to add code for this\", \" validation in every action. ASP.NET Core MVC filters offer a way of intercepting groups of requests\", \", so that common policies and cross-cutting concerns can be applied on a targeted basis. Filters can\", \" be applied to individual actions, whole controllers, or globally for an application.\\n\\nFor web APIs,\", \" ASP.NET Core MVC supports content negotiation , allowing requests to specify how responses should b\", \"e formatted. Based on headers provided in the request, actions returning data will format the respon\", \"se in XML, JSON, or another supported format. This feature enables the same API to be used by multip\", \"le clients with different data format requirements.\\n\\nWeb API projects should consider using the [Api\", \"Controller] attribute, which can be applied to individual controllers, to a base controller class, o\", \"r to the entire assembly. This attribute adds automatic model validation checking and any action wit\", \"h an invalid model will return a BadRequest with the details of the validation errors. The attribute\", \" also requires all actions have an attribute route, rather than using a conventional route, and retu\", \"rns more detailed ProblemDetails information in response to errors.\\n\\n## Keeping controllers under co\", \"ntrol\\n\\nFor page-based applications, Razor Pages do a great job of keeping controllers from getting t\", \"oo large. Each individual page is given its own files and classes dedicated just to its handler(s). \", \"Prior to the introduction of Razor Pages, many view-centric applications would have large controller\", \" classes responsible for many different actions and views. These classes would naturally grow to hav\", \"e many responsibilities and dependencies, making them harder to maintain. If you find your view-base\", \"d\\n\\ncontrollers are growing too large, consider refactoring them to use Razor Pages, or introducing a\", \" pattern like a mediator.\\n\\nThe mediator design pattern is used to reduce coupling between classes wh\", \"ile allowing communication between them. In ASP.NET Core MVC applications, this pattern is frequentl\", \"y employed to break up controllers into smaller pieces by using handlers to do the work of action me\", \"thods. The popular MediatR NuGet package is often used to accomplish this. Typically, controllers in\", \"clude many different action methods, each of which may require certain dependencies. The set of all \", \"dependencies required by any action must be passed into the controller's constructor. When using Med\", \"iatR, the only dependency a controller will typically have is an instance of the mediator. Each acti\", \"on then uses the mediator instance to send a message, which is processed by a handler. The handler i\", \"s specific to a single action and thus only needs the dependencies required by that action. An examp\", \"le of a controller using MediatR is shown here:\\n\\n```\\npublic class OrderController : Controller { pri\", \"vate readonly IMediator _mediator; public OrderController(IMediator mediator) { _mediator = mediator\", \"; } [HttpGet] public async Task<IActionResult> MyOrders() { var viewModel = await _mediator.Send( ne\", \"w GetMyOrders(User.Identity.Name)); return View(viewModel); } // other actions implemented similarly\", \" }\\n```\\n\\nIn the MyOrders action, the call to Send a GetMyOrders message is handled by this class:\\n\\n``\", \"`\\npublic class GetMyOrdersHandler : IRequestHandler<GetMyOrders, IEnumerable<OrderViewModel>> { priv\", \"ate readonly IOrderRepository _orderRepository; public GetMyOrdersHandler(IOrderRepository orderRepo\", \"sitory) { _orderRepository = orderRepository; } public async Task<IEnumerable<OrderViewModel>> Handl\", \"e(GetMyOrders request, CancellationToken cancellationToken) { var specification = new CustomerOrders\", \"WithItemsSpecification(request.UserName); var orders = await _orderRepository.ListAsync(specificatio\", \"n); return orders.Select(o => new OrderViewModel { OrderDate = o.OrderDate, OrderItems = o.OrderItem\", \"s?.Select(oi => new OrderItemViewModel() { PictureUrl = oi.ItemOrdered.PictureUri, ProductId = oi.It\", \"emOrdered.CatalogItemId, ProductName = oi.ItemOrdered.ProductName, UnitPrice = oi.UnitPrice, Units =\", \" oi.Units\\n```\\n\\n```\\n}).ToList(), OrderNumber = o.Id, ShippingAddress = o.ShipToAddress, Total = o.Tot\", \"al() }); } }\\n```\\n\\nThe end result of this approach is for controllers to be much smaller and focused \", \"primarily on routing and model binding, while individual handlers are responsible for the specific t\", \"asks needed by a given endpoint. This approach can also be achieved without MediatR by using the Api\", \"Endpoints NuGet package, which attempts to bring to API controllers the same benefits Razor Pages br\", \"ings to viewbased controllers.\\n\\n## References -Mapping Requests to Responses\\n\\n- \\u2022\\n- Routing to Contr\", \"oller Actions\\n\\nhttps://learn.microsoft.com/aspnet/core/mvc/controllers/routing\\n\\n- Model Binding\\n\\nhtt\", \"ps://learn.microsoft.com/aspnet/core/mvc/models/model-binding\\n\\n- Model Validation\\n\\nhttps://learn.mic\", \"rosoft.com/aspnet/core/mvc/models/validation\\n\\n- Filters\\n\\nhttps://learn.microsoft.com/aspnet/core/mvc\", \"/controllers/filters\\n\\n- ApiController Attribute\\n- https://learn.microsoft.com/aspnet/core/web-api/\\n\\n\", \"## Working with dependencies\\n\\nASP.NET Core has built-in support for and internally makes use of a te\", \"chnique known as dependency injection. Dependency injection is a technique that enables loose coupli\", \"ng between different parts of an application. Looser coupling is desirable because it makes it easie\", \"r to isolate parts of the application, allowing for testing or replacement. It also makes it less li\", \"kely that a change in one part of the application will have an unexpected impact somewhere else in t\", \"he application. Dependency injection is based on the dependency inversion principle, and is often ke\", \"y to achieving the open/closed principle. When evaluating how your application works with its depend\", \"encies, beware of the static cling code smell, and remember the aphorism ' new is glue .'\\n\\nStatic cl\", \"ing occurs when your classes make calls to static methods, or access static properties, which have s\", \"ide effects or dependencies on infrastructure. For example, if you have a method that calls a static\", \" method, which in turn writes to a database, your method is tightly coupled to the database. Anythin\", \"g that breaks that database call will break your method. Testing such methods is notoriously difficu\", \"lt, since such tests either require commercial mocking libraries to mock the static calls, or can on\", \"ly be tested with a test database in place. Static calls that don't have any dependence on infrastru\", \"cture, especially those calls that are completely stateless, are fine to call and have no impact on \", \"coupling or testability (beyond coupling code to the static call itself).\\n\\nMany developers understan\", \"d the risks of static cling and global state, but will still tightly couple their code to specific i\", \"mplementations through direct instantiation. 'New is glue' is meant to be a reminder of this couplin\", \"g, and not a general condemnation of the use of the new keyword. Just as with static method calls, n\", \"ew instances of types that have no external dependencies typically do not tightly couple code to imp\", \"lementation details or make testing more difficult. But each time a class is instantiated, take just\", \" a brief moment to consider whether it makes sense to hard-code that specific instance in that parti\", \"cular location, or if it would be a better design to request that instance as a dependency.\\n\\n## Decl\", \"are your dependencies\\n\\nASP.NET Core is built around having methods and classes declare their depende\", \"ncies, requesting them as arguments. ASP.NET applications are typically set up in Program.cs or in a\", \" Startup class.\\n\\n## Note\\n\\nConfiguring apps completely in Program.cs is the default approach for .NET\", \" 6 (and later) and Visual Studio 2022 apps. Project templates have been updated to help you get star\", \"ted with this new approach. ASP.NET Core projects can still use a Startup class, if desired.\\n\\n## Con\", \"figure services in Program.cs\\n\\nFor very simple apps, you can wire up dependencies directly in Progra\", \"m.cs file using a WebApplicationBuilder. Once all needed services have been added, the builder is us\", \"ed to create the app.\\n\\n```\\nvar builder = WebApplication.CreateBuilder(args); // Add services to the \", \"container. builder.Services.AddRazorPages(); var app = builder.Build();\\n```\\n\\n## Configure services i\", \"n Startup.cs\\n\\nThe Startup.cs is itself configured to support dependency injection at several points.\", \" If you're using a Startup class, you can give it a constructor and it can request dependencies thro\", \"ugh it, like so:\\n\\n```\\npublic class Startup { public Startup(IHostingEnvironment env) { var builder =\", \" new ConfigurationBuilder() .SetBasePath(env.ContentRootPath) .AddJsonFile(\\\"appsettings.json\\\", optio\", \"nal: false , reloadOnChange: true ) .AddJsonFile($\\\"appsettings.{env.EnvironmentName}.json\\\", optional\", \": true ); } }\\n```\\n\\nThe Startup class is interesting in that there are no explicit type requirements \", \"for it. It doesn't inherit from a special Startup base class, nor does it implement any particular i\", \"nterface. You can give it a constructor, or not, and you can specify as many parameters on the const\", \"ructor as you want. When\\n\\nthe web host you've configured for your application starts, it will call t\", \"he Startup class (if you've told it to use one), and will use dependency injection to populate any d\", \"ependencies the Startup class requires. Of course, if you request parameters that aren't configured \", \"in the services container used by ASP.NET Core, you'll get an exception, but as long as you stick to\", \" dependencies the container knows about, you can request anything you want.\\n\\nDependency injection is\", \" built into your ASP.NET Core apps right from the start, when you create the Startup instance. It do\", \"esn't stop there for the Startup class. You can also request dependencies in the Configure method:\\n\\n\", \"```\\npublic void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFac\", \"tory) { }\\n```\\n\\nThe ConfigureServices method is the exception to this behavior; it must take just one\", \" parameter of type IServiceCollection. It doesn't really need to support dependency injection, since\", \" on the one hand it is responsible for adding objects to the services container, and on the other it\", \" has access to all currently configured services via the IServiceCollection parameter. Thus, you can\", \" work with dependencies defined in the ASP.NET Core services collection in every part of the Startup\", \" class, either by requesting the needed service as a parameter or by working with the IServiceCollec\", \"tion in ConfigureServices.\\n\\n## Note\\n\\nIf you need to ensure certain services are available to your St\", \"artup class, you can configure them using an IWebHostBuilder and its ConfigureServices method inside\", \" the CreateDefaultBuilder call.\\n\\nThe Startup class is a model for how you should structure other par\", \"ts of your ASP.NET Core application, from Controllers to Middleware to Filters to your own Services.\", \" In each case, you should follow the Explicit Dependencies Principle, requesting your dependencies r\", \"ather than directly creating them, and leveraging dependency injection throughout your application. \", \"Be careful of where and how you directly instantiate implementations, especially services and object\", \"s that work with infrastructure or have side effects. Prefer working with abstractions defined in yo\", \"ur application core and passed in as arguments to hardcoding references to specific implementation t\", \"ypes.\\n\\n## Structuring the application\\n\\nMonolithic applications typically have a single entry point. \", \"In the case of an ASP.NET Core web application, the entry point will be the ASP.NET Core web project\", \". However, that doesn't mean the solution should consist of just a single project. It's useful to br\", \"eak up the application into different layers in order to follow separation of concerns. Onc e broken\", \" up into layers, it's helpful to go beyond folders to separate projects, which can help achieve bett\", \"er encapsulation. The best approach to achieve these goals with an ASP.NET Core application is a var\", \"iation of the Clean Architecture discussed in ch apter 5. Following this approach, the application's\", \" solution will comprise separate libraries for the UI, Infrastructure, and ApplicationCore.\\n\\nIn addi\", \"tion to these projects, separate test projects are included as well (Testing is discussed in Chapter\", \" 9).\\n\\nThe application's object model and interfaces should be placed in the ApplicationCore project.\", \" This project will have as few dependencies as possible (and none on specific infrastructure concern\", \"s), and the other projects in the solution will reference it. Business entities that need to be pers\", \"isted are defined in the ApplicationCore project, as are services that do not directly depend on inf\", \"rastructure.\\n\\nImplementation details, such as how persistence is performed or how notifications migh\", \"t be sent to a user, are kept in the Infrastructure project. This project will reference implementat\", \"ion-specific packages such as Entity Framework Core, but should not expose details about these imple\", \"mentations outside of the project. Infrastructure services and repositories should implement interfa\", \"ces that are defined in the ApplicationCore project, and its persistence implementations are respons\", \"ible for retrieving and storing entities defined in ApplicationCore.\\n\\nThe ASP.NET Core UI project is\", \" responsible for any UI level concerns, but should not include business logic or infrastructure deta\", \"ils. In fact, ideally it shouldn't even have a dependency on the Infrastructure project, which will \", \"help ensure no dependency between the two projects is introduced accidentally. This can be achieved \", \"using a third-party DI container like Autofac, which allows you to define DI rules in Module classes\", \" in each project.\\n\\nAnother approach to decoupling the application from implementation details is to \", \"have the application call microservices, perhaps deployed in individual Docker containers. This prov\", \"ides even greater separation of concerns and decoupling than leveraging DI between two projects, but\", \" has additional complexity.\\n\\n## Feature organization\\n\\nBy default, ASP.NET Core applications organize\", \" their folder structure to include Controllers and Views, and frequently ViewModels. Client-side cod\", \"e to support these server-side structures is typically stored separately in the wwwroot folder. Howe\", \"ver, large applications may encounter problems with this organization, since working on any given fe\", \"ature often requires jumping between these folders. This gets more and more difficult as the number \", \"of files and subfolders in each folder grows, resulting in a great deal of scrolling through Solutio\", \"n Explorer. One solution to this problem is to organize application code by feature instead of by fi\", \"le type. This organizational style is typically referred to as feature folders or feature slices (se\", \"e also: Vertical Slices).\\n\\nASP.NET Core MVC supports Areas for this purpose. Using areas, you can cr\", \"eate separate sets of Controllers and Views folders (as well as any associated models) in each Area \", \"folder. Figure 7-1 shows an example folder structure, using Areas.\\n\\n\\u2022 8E\\n\\n\\u2022 B\\n\\nwwwroot\\n\\n\\u00ab 8\\n\\nAreas\\n\\n\", \"Basket\\n\\nBlog\\n\\nCatalog\\n\\n8\\n\\n8 Search\\n\\nGames\\n\\n\\u2022 &amp; D\\n\\nIdentity\\n\\n\\u2022 82] Configuration\\n\\nControllers\\n\\n\\u2022 \", \"8[\\n\\nExtensions\\n\\n\\u2022 &amp;C Features\\n\\n\\u2022 BC HealthChecks\\n\\n\\u2022 &amp;C Interfaces\\n\\n\\u2022 82] Pages\\n\\n\\u2022 8[\\n\\nServic\", \"es\\n\\nViewModels\\n\\nViews\\n\\nAccount\\n\\nFigure 7-1. Sample Area Organization\\n\\n<!-- image -->\\n\\nWhen using Are\", \"as, you must use attributes to decorate your controllers with the name of the area to which they bel\", \"ong:\\n\\n```\\n[Area(\\\"Catalog\\\")] public class HomeController {}\\n```\\n\\nYou also need to add area support to\", \" your routes:\\n\\n```\\napp.UseEndpoints(endpoints => { endpoints.MapControllerRoute(name: \\\"areaRoute\\\", p\", \"attern: \\\"{area:exists}/{controller=Home}/{action=Index}/{id?}\\\"); endpoints.MapControllerRoute(name: \", \"\\\"default\\\", pattern: \\\"{controller=Home}/{action=Index}/{id?}\\\"); });\\n```\\n\\nIn addition to the built-in \", \"support for Areas, you can also use your own folder structure, and conventions in place of attribute\", \"s and custom routes. This would allow you to have feature folders that didn't include separate folde\", \"rs for Views, Controllers, e tc., keeping the hierarchy flatter and making it easier to see all rela\", \"ted files in a single place for each feature. For APIs, folders can be used to replace controllers, \", \"and each folder can contain all of the API Endpoints and their associated DTOs.\\n\\nASP.NET Core uses b\", \"uilt-in convention types to control its behavior. You can modify or replace these conventions. For e\", \"xample, you can create a convention that will automatically get the feature name for a given control\", \"ler based on its namespace (which typically correlates to the folder in which the controller is loca\", \"ted):\\n\\n```\\npublic class FeatureConvention : IControllerModelConvention { public void Apply(Controlle\", \"rModel controller) { controller.Properties.Add(\\\"feature\\\", GetFeatureName(controller.ControllerType))\", \"; } private string GetFeatureName(TypeInfo controllerType) { string[] tokens = controllerType.FullNa\", \"me.Split('.'); if (!tokens.Any(t => t == \\\"Features\\\")) return \\\"\\\"; string featureName = tokens .SkipWh\", \"ile(t => !t.Equals(\\\"features\\\", StringComparison.CurrentCultureIgnoreCase)) .Skip(1) .Take(1) .FirstO\", \"rDefault(); return featureName; } }\\n```\\n\\nYou then specify this convention as an option when you add \", \"support for MVC to your application in ConfigureServices (or in Program.cs ):\\n\\n```\\n// ConfigureServi\", \"ces services.AddMvc(o => o.Conventions.Add( new FeatureConvention())); // Program.cs builder.Service\", \"s.AddMvc(o => o.Conventions.Add( new FeatureConvention()));\\n```\\n\\nASP.NET Core MVC also uses a conven\", \"tion to locate views. You can override it with a custom convention so that views will be located in \", \"your feature folders (using the feature name provided by the FeatureConvention, above). You can lear\", \"n more about this approach and download a working sample from the MSDN Magazine article, Feature Sli\", \"ces for ASP.NET Core MVC.\\n\\n## APIs and Blazor applications\\n\\nIf your application includes a set of we\", \"b APIs, which must be secured, these APIs should ideally be configured as a separate project from yo\", \"ur View or Razor Pages application. Separating APIs, especially public APIs, from your server-side w\", \"eb application has a number of benefits. These applications often will have unique deployment and lo\", \"ad characteristics. They're also very likely to adopt different mechanisms for security, with standa\", \"rd form-based applications leveraging cookiebased authentication and APIs most likely using token-ba\", \"sed authentication.\\n\\nAdditionally, Blazor applications, whether using Blazor Server or Blazor WebAss\", \"embly, should be built as separate projects. The applications have different runtime characteristics\", \" as well as security models. They're likely to share common types with the se rver-side web applicat\", \"ion (or API project), and these types should be defined in a common shared project.\\n\\nThe addition of\", \" a Blazor WebAssembly admin interface to eShopOnWeb required adding several new projects. The Blazor\", \" WebAssembly project itself, BlazorAdmin. A new set of public API endpoints, used by BlazorAdmin and\", \" configured to use token-based authentication, is defined in the PublicApi project. And certain shar\", \"ed types used by both of these projects are kept in a new BlazorShared project.\\n\\nOne might ask, why \", \"add a separate BlazorShared project when there is already a common ApplicationCore project that coul\", \"d be used to share any types required by both PublicApi and BlazorAdmin? The answer is that this pro\", \"ject includes all of the application' s business logic and is thus much larger than necessary and al\", \"so much more likely to need to be kept secure on the server. Remember that any library referenced by\", \" BlazorAdmin will be downloaded to users' browsers when they load the Blazor application.\\n\\nDepending\", \" on whether one is using the Backends-For-Frontends (BFF) pattern, the APIs consumed by the Blazor W\", \"ebAssembly app may not share their types 100% with Blazor. In particular, a public API that's meant \", \"to be consumed by many different clients may define its own request and result types, rather than sh\", \"aring them in a client-specific shared project. In the eShopOnWeb sample, the assumption is being ma\", \"de that the PublicApi project is, in fact, hosting a public API, so not all of its request and respo\", \"nse types come from the BlazorShared project.\\n\\n## Cross-cutting concerns\\n\\nAs applications grow, it b\", \"ecomes increasingly important to factor out cross-cutting concerns to eliminate duplication and main\", \"tain consistency. Some examples of cross-cutting concerns in ASP.NET Core applications are authentic\", \"ation, model validation rules, output caching, and error handling, though there are many others. ASP\", \".NET Core MVC filters allow you to run code before or after certain steps in the request processing \", \"pipeline. For instance, a filter can run before and after model binding, before and after an action,\", \" or before and after an action's result. You can also use an authorization filter to control access \", \"to the rest of the pipeline. Figures 7-2 shows how request execution flows through filters, if confi\", \"gured.\\n\\nMiddleware\\n\\nAuthorization filter\\n\\nResource filter\\n\\nException filter\\n\\nModel binding\\n\\nAction f\", \"ilter (before)\\n\\nAction execution\\n\\nAction filter (after)\\n\\nResult filter\\n\\nResult execution\\n\\nFigure 7-2\", \". Request execution through filters and request pipeline.\\n\\n<!-- image -->\\n\\nFilters are usually imple\", \"mented as attributes, so you can apply them to controllers or actions (or even globally). When added\", \" in this fashion, filters specified at the action level override or build upon filters specified at \", \"the controller level, which themselves override global filters. For example, the [Route] attribute c\", \"an be used to build up routes between controllers and actions. Likewise, authorization can be config\", \"ured at the controller level, and then overridden by individual actions, as the following sample dem\", \"onstrates:\\n\\n```\\n[Authorize] public class AccountController : Controller { [AllowAnonymous] // overri\", \"des the Authorize attribute public async Task<IActionResult> Login() {} public async Task<IActionRes\", \"ult> ForgotPassword() {} }\\n```\\n\\nThe first method, Login, uses the [AllowAnonymous] filter (attribute\", \") to override the Authorize filter set at the controller level. The ForgotPassword action (and any o\", \"ther action in the class that doesn't have an AllowAnonymous attribute) will require an authenticate\", \"d request.\\n\\nFilters can be used to eliminate duplication in the form of common error handling polici\", \"es for APIs. For example, a typical API policy is to return a NotFound response to requests referenc\", \"ing keys that do not exist, and a BadRequest response if model validation fails. The following examp\", \"le demonstrates these two policies in action:\\n\\n```\\n[HttpPut(\\\"{id}\\\")] public async Task<IActionResult\", \"> Put(int id, [FromBody]Author author) {\\n```\\n\\n```\\nif ((await _authorRepository.ListAsync()).All(a =>\", \" a.Id != id)) { return NotFound(id); } if (!ModelState.IsValid) { return BadRequest(ModelState); } a\", \"uthor.Id = id; await _authorRepository.UpdateAsync(author); return Ok(); }\\n```\\n\\nDon't allow your act\", \"ion methods to become cluttered with conditional code like this. Instead, pull the policies into fil\", \"ters that can be applied on an as-needed basis. In this example, the model validation check, which s\", \"hould occur anytime a command is sent to the API, can be replaced by the following attribute:\\n\\n```\\np\", \"ublic class ValidateModelAttribute : ActionFilterAttribute { public override void OnActionExecuting(\", \"ActionExecutingContext context) { if (!context.ModelState.IsValid) { context.Result = new BadRequest\", \"ObjectResult(context.ModelState); } } }\\n```\\n\\nYou can add the ValidateModelAttribute to your project \", \"as a NuGet dependency by including the Ardalis.ValidateModel package. For APIs, you can use the ApiC\", \"ontroller attribute to enforce this behavior without the need for a separate ValidateModel filter.\\n\\n\", \"Likewise, a filter can be used to check if a record exists and return a 404 before the action is exe\", \"cuted, eliminating the need to perform these checks in the action. Once you've pulled out common con\", \"ventions and organized your solution to separate infrastructure code and business logic from your UI\", \", your MVC action methods should be extremely thin:\\n\\n```\\n[HttpPut(\\\"{id}\\\")] [ValidateAuthorExists] pu\", \"blic async Task<IActionResult> Put(int id, [FromBody]Author author) { await _authorRepository.Update\", \"Async(author); return Ok(); }\\n```\\n\\nYou can read more about implementing filters and download a worki\", \"ng sample from the MSDN Magazine article, Real-World ASP.NET Core MVC Filters.\\n\\nIf you find that you\", \" have a number of common responses from APIs based on common scenarios like validation errors (Bad R\", \"equest), resource not found, and server errors, you might consider using a result abstraction. The r\", \"esult abstraction would be returned by services consumed by API endpoints, and the controller action\", \" or endpoint would use a filter to translate these into IActionResults.\\n\\n## References -Structuring \", \"applications\\n\\n- Areas https://learn.microsoft.com/aspnet/core/mvc/controllers/areas\\n- MSDN Magazine \", \"-Feature Slices for ASP.NET Core MVC https://learn.microsoft.com/archive/msdn-magazine/2016/septembe\", \"r/asp-net-core-featureslices-for-asp-net-core-mvc\\n- Filters https://learn.microsoft.com/aspnet/core/\", \"mvc/controllers/filters\\n- MSDN Magazine -Real World ASP.NET Core MVC Filters https://learn.microsoft\", \".com/archive/msdn-magazine/2016/august/asp-net-core-real-worldasp-net-core-mvc-filters\\n- Result in e\", \"ShopOnWeb https://github.com/dotnet-architecture/eShopOnWeb/wiki/Patterns#result\\n\\n## Security\\n\\nSecur\", \"ing web applications is a large topic, with many considerations. At its most basic level, security i\", \"nvolves ensuring you know who a given request is coming from, and then ensuring that the request onl\", \"y has access to resources it should. Authentication is the process of comparing credentials provided\", \" with a request to those in a trusted data store, to see if the request should be treated as coming \", \"from a known entity. Authorization is the process of restricting access to certain resources based o\", \"n user identity. A third security concern is protecting requests from eavesdropping by third parties\", \", for which you should at least ensure that SSL is used by your application.\\n\\n## Identity\\n\\nASP.NET C\", \"ore Identity is a membership system you can use to support login functionality for your application.\", \" It has support for local user accounts as well as external login provider support from providers li\", \"ke Microsoft Account, Twitter, Facebook, Google, and more. In addition to ASP.NET Core Identity, you\", \"r application can use windows authentication, or a third-party identity provider like Identity Serve\", \"r.\\n\\nASP.NET Core Identity is included in new project templates if the Individual User Accounts optio\", \"n is selected. This template includes support for registration, login, external logins, forgotten pa\", \"sswords, and additional functionality.\\n\\nAdditional information\\n\\nASP.NET Core Web App c*\\n\\nFramework O\", \"\\n\\nNET 7.0 (Standard Term Support)\\n\\nAuthentication type O\\n\\nNone\\n\\nNone\\n\\nIndividual Accounts\\n\\nMicrosoft\", \" identity platform\\n\\nWindows\\n\\nLinux\\n\\nDo not use top-level statements f\\n\\nLinux macos\\n\\nWindows\\n\\nCloud\\n\\n\", \"Service\\n\\nWeb\\n\\nFigure 7-3. Select Individual User Accounts to have Identity preconfigured.\\n\\n<!-- imag\", \"e -->\\n\\nIdentity support is configured in Program.cs or Startup, and includes configuring services as\", \" well as middleware.\\n\\n## Configure Identity in Program.cs\\n\\nIn Program.cs , you configure services fr\", \"om the WebHostBuilder instance, and then once the app is created, you configure its middleware. The \", \"key points to note are the call to AddDefaultIdentity for required services and the UseAuthenticatio\", \"n and UseAuthorization calls which add required middleware.\\n\\n```\\nvar builder = WebApplication.Create\", \"Builder(args); // Add services to the container. var connectionString = builder.Configuration.GetCon\", \"nectionString(\\\"DefaultConnection\\\"); builder.Services.AddDbContext<ApplicationDbContext>(options => o\", \"ptions.UseSqlServer(connectionString)); builder.Services.AddDatabaseDeveloperPageExceptionFilter(); \", \"builder.Services.AddDefaultIdentity<IdentityUser>(options => options.SignIn.RequireConfirmedAccount \", \"= true ) .AddEntityFrameworkStores<ApplicationDbContext>(); builder.Services.AddRazorPages(); var ap\", \"p = builder.Build(); // Configure the HTTP request pipeline. if (app.Environment.IsDevelopment())\\n``\", \"`\\n\\nX\\n\\n```\\n{ app.UseMigrationsEndPoint(); } else { app.UseExceptionHandler(\\\"/Error\\\"); // The default \", \"HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspn\", \"etcore-hsts. app.UseHsts(); } app.UseHttpsRedirection(); app.UseStaticFiles(); app.UseRouting(); app\", \".UseAuthentication(); app.UseAuthorization(); app.MapRazorPages(); app.Run();\\n```\\n\\n## Configuring Id\", \"entity in app startup\\n\\n```\\n// Add framework services. builder.Services.AddDbContext<ApplicationDbCon\", \"text>(options => options.UseSqlServer(Configuration.GetConnectionString(\\\"DefaultConnection\\\"))); buil\", \"der.Services.AddIdentity<ApplicationUser, IdentityRole>() .AddEntityFrameworkStores<ApplicationDbCon\", \"text>() .AddDefaultTokenProviders(); builder.Services.AddMvc(); var app = builder.Build(); if (app.E\", \"nvironment.IsDevelopment()) { app.UseMigrationsEndPoint(); } else { app.UseExceptionHandler(\\\"/Error\\\"\", \"); app.UseHsts(); } app.UseHttpsRedirection(); app.UseStaticFiles(); app.UseRouting(); app.UseAuthen\", \"tication(); app.UseAuthorization(); app.MapRazorPages();\\n```\\n\\nIt's important that UseAuthentication \", \"and UseAuthorization appear before MapRazorPages. When configuring Identity services, you'll notice \", \"a call to AddDefaultTokenProviders. This has nothing to do with tokens that may be used to secure we\", \"b communications, but instead refers to providers that create prompts that can be sent to users via \", \"SMS or email in order for them to confirm their identity.\\n\\nYou can learn more about configuring two-\", \"factor authentication and enabling external login providers from the official ASP.NET Core docs.\\n\\n##\", \" Authentication\\n\\nAuthentication is the process of determining who is accessing the system. If you're\", \" using ASP.NET Core Identity and the configuration methods shown in the previous section, it will au\", \"tomatically configure some authentication defaults in the application. However, you can also configu\", \"re these defaults manually, or override the ones set by AddIdentity. If you're using Identity, it co\", \"nfigures cookie-based authentication as the default scheme .\\n\\nIn web-based authentication, there are\", \" typically up to five actions that may be performed in the course of authenticating a client of a sy\", \"stem. These are:\\n\\n- Authenticate. Use the information provided by the client to create an identity f\", \"or them to use within the application.\\n- Challenge. This action is used to require the client to ide\", \"ntify themselves.\\n- Forbid. Inform the client they are forbidden from performing an action.\\n- Sign-i\", \"n. Persist the existing client in some way.\\n- Sign-out. Remove the client from persistence.\\n\\nThere a\", \"re a number of common techniques for performing authentication in web applications. These are referr\", \"ed to as schemes. A given scheme will define actions for some or all of the above options. Some sche\", \"mes only support a subset of actions, and may require a separate scheme to perform those it does not\", \" support. For example, the OpenIdConnect (OIDC) scheme doesn't support Sign -in or Sign-out, but is \", \"commonly configured to use Cookie authentication for this persistence.\\n\\nIn your ASP.NET Core applica\", \"tion, you can configure a DefaultAuthenticateScheme as well as optional specific schemes for each of\", \" the actions described above. For example, DefaultChallengeScheme, DefaultForbidScheme, etc. Calling\", \" AddIdentity&lt;TUser,TRole&gt; configures a number of aspects of the application and adds many requ\", \"ired services. It also includes this call to configure the authentication scheme:\\n\\n```\\nbuilder.Servi\", \"ces.AddAuthentication(options => { options.DefaultAuthenticateScheme = IdentityConstants.Application\", \"Scheme; options.DefaultChallengeScheme = IdentityConstants.ApplicationScheme; options.DefaultSignInS\", \"cheme = IdentityConstants.ExternalScheme; });\\n```\\n\\nThese schemes use cookies for persistence and red\", \"irection to login pages for authentication by default. These schemes are appropriate for web applica\", \"tions that interact with users via web browsers, but not recommended for APIs. Instead, APIs will ty\", \"pically use another form of authentication, such as JWT bearer tokens.\\n\\nWeb APIs are consumed by cod\", \"e, such as HttpClient in .NET applications and equivalent types in other frameworks. These clients e\", \"xpect a usable response from an API call, or a status code indicating what, if any, problem has occu\", \"rred. These clients are not interacting through a browser and do not render or interact with any HTM\", \"L that an API might return. Thus, it is not appropriate for API endpoints to redirect their clients \", \"to login pages if they are not authenticated. Another scheme is more appropriate.\\n\\nTo configure auth\", \"entication for APIs, you might set up authentication like the following, used by the PublicApi proje\", \"ct in the eShopOnWeb reference application:\\n\\n```\\nbuilder.Services .AddAuthentication(config => { con\", \"fig.DefaultScheme = JwtBearerDefaults.AuthenticationScheme; }) .AddJwtBearer(config => { config.Requ\", \"ireHttpsMetadata = false ; config.SaveToken = true ; config.TokenValidationParameters = new TokenVal\", \"idationParameters { ValidateIssuerSigningKey = true , IssuerSigningKey = new SymmetricSecurityKey(ke\", \"y), ValidateIssuer = false , ValidateAudience = false }; });\\n```\\n\\nWhile it is possible to configure \", \"multiple different authentication schemes within a single project, it is much simpler to configure a\", \" single default scheme. For this reason, among others, the eShopOnWeb reference application separate\", \"s its APIs into their own project, PublicApi, separate from the main Web project that includes the a\", \"pplication's views and Razor Pages.\\n\\n## Authentication in Blazor apps\\n\\nBlazor Server applications ca\", \"n leverage the same authentication features as any other ASP.NET Core application. Blazor WebAssembl\", \"y applications cannot use the built-in Identity and Authentication providers, however, since they ru\", \"n in the browser. Blazor WebAssembly applications can store user authentication status locally and c\", \"an access claims to determine what actions users should be able to perform. However, all authenticat\", \"ion and authorization checks should be performed on the server regardless of any logic implemented i\", \"nside the Blazor WebAssembly app, since users can easily bypass the app and interact with the APIs d\", \"irectly.\\n\\n## References -Authentication\\n\\n- Authentication Actions and Defaults https://stackoverflow\", \".com/a/52493428\\n- Authentication and Authorization for SPAs https://learn.microsoft.com/aspnet/core/\", \"security/authentication/identity-api-authorization\\n- ASP.NET Core Blazor Authentication and Authoriz\", \"ation https://learn.microsoft.com/aspnet/core/blazor/security/\\n- Security: Authentication and Author\", \"ization in ASP.NET Web Forms and Blazor https://learn.microsoft.com/dotnet/architecture/blazor-for-w\", \"eb-forms-developers/securityauthentication-authorization\\n\\n## Authorization\\n\\nThe simplest form of aut\", \"horization involves restricting access to anonymous users. This functionality can be achieved by app\", \"lying the [Authorize] attribute to certain controllers or actions. If roles are\\n\\nbeing used, the att\", \"ribute can be further extended to restrict access to users who belong to certain roles, as shown:\\n\\n`\", \"``\\n[Authorize(Roles = \\\"HRManager,Finance\\\")] public class SalaryController : Controller { }\\n```\\n\\nIn t\", \"his case, users belonging to either the HRManager or Finance roles (or both) would have access to th\", \"e SalaryController. To require that a user belong to multiple roles (not just one of several), you c\", \"an apply the attribute multiple times, specifying a required role each time.\\n\\nSpecifying certain set\", \"s of roles as strings in many different controllers and actions can lead to undesirable repetition. \", \"At a minimum, define constants for these string literals and use the constants anywhere you need to \", \"specify the string. You can also configure authorization policies, which encapsulate authorization r\", \"ules, and then specify the policy instead of individual roles when applying the [Authorize] attribut\", \"e:\\n\\n```\\n[Authorize(Policy = \\\"CanViewPrivateReport\\\")] public IActionResult ExecutiveSalaryReport() { \", \"return View(); }\\n```\\n\\nUsing policies in this way, you can separate the kinds of actions being restri\", \"cted from the specific roles or rules that apply to it. Later, if you create a new role that needs t\", \"o have access to certain resources, you can just update a policy, rather than updating every list of\", \" roles on every [Authorize] attribute.\\n\\n## Claims\\n\\nClaims are name value pairs that represent proper\", \"ties of an authenticated user. For example, you might store users' employee number as a claim. Claim\", \"s can then be used as part of authorization policies. You could create a policy called 'EmployeeOnly\", \"' that requires the existence of a claim called \\\"EmployeeNumber\\\", as shown in this example:\\n\\n```\\npub\", \"lic void ConfigureServices(IServiceCollection services) { services.AddMvc(); services.AddAuthorizati\", \"on(options => { options.AddPolicy(\\\"EmployeeOnly\\\", policy => policy.RequireClaim(\\\"EmployeeNumber\\\")); \", \"}); }\\n```\\n\\nThis policy could then be used with the [Authorize] attribute to protect any controller a\", \"nd/or action, as described above.\\n\\n## Securing web APIs\\n\\nMost web APIs should implement a token-base\", \"d authentication system. Token authentication is stateless and designed to be scalable. In a token-b\", \"ased authentication system, the client must first authenticate with the authentication provider. If \", \"successful, the client is issued a token, which is simply\\n\\nToken-Based Authentication\\n\\nUser a crypto\", \"graphically meaningful string of characters. The most common format for tokens is JSON Web Token, or\", \" JWT (often pronounced 'jot'). When the client then needs to issue a request to an API, it adds this\", \" token as a header on the request. The server then validates the token found in the request header b\", \"efore completing the request. Figure 7-4 demonstrates this process.\\n\\n## Web Client\\n\\nFigure 7-4. Toke\", \"n-based authentication for Web APIs.\\n\\n<!-- image -->\\n\\nYou can create your own authentication service\", \", integrate with Azure AD and OAuth, or implement a service using an open-source tool like IdentityS\", \"erver.\\n\\nJWT tokens can embed claims about the user, which can be read on the client or server. You c\", \"an use a tool like jwt.io to view the contents of a JWT token. Do not store sensitive data like pass\", \"words or keys in JTW tokens, since their contents are easily read.\\n\\nWhen using JWT tokens with SPA o\", \"r Blazor WebAssembly applications, you must store the token somewhere on the client and then add it \", \"to every API call. This activity is typically done as a header, as the following code demonstrates:\\n\", \"\\n```\\n// AuthService.cs in BlazorAdmin project of eShopOnWeb private async Task SetAuthorizationHeade\", \"r() { var token = await GetToken(); _httpClient.DefaultRequestHeaders.Authorization = new Authentica\", \"tionHeaderValue(\\\"Bearer\\\", token); }\\n```\\n\\nAfter calling the above method, requests made with the \\\\_ht\", \"tpClient will have the token embedded in the request's headers, allowing the server -side API to aut\", \"henticate and authorize the request.\\n\\n## Custom Security\\n\\n| Caution                                 \", \"                                        |\\n|---------------------------------------------------------\", \"------------------------|\\n| As a general rule, avoid implementing your own custom security implement\", \"ations. |\\n\\nBe especially careful about 'rolling your own' implementation of cryptography, user membe\", \"rship, or token generation system. There are many commercial and open-source alternatives available,\", \" which will almost certainly have better security than a custom implementation.\\n\\n## References -Secu\", \"rity\\n\\n- Security Docs Overview\\n\\nhttps://learn.microsoft.com/aspnet/core/security/\\n\\n- Enforcing SSL i\", \"n an ASP.NET Core App\\n\\nhttps://learn.microsoft.com/aspnet/core/security/enforcing-ssl\\n\\n- Introductio\", \"n to Identity\\n\\nhttps://learn.microsoft.com/aspnet/core/security/authentication/identity\\n\\n- Introduct\", \"ion to Authorization\\n\\nhttps://learn.microsoft.com/aspnet/core/security/authorization/introduction\\n\\n-\", \" Authentication and Authorization for API Apps in Azure App Service\\n\\nhttps://learn.microsoft.com/azu\", \"re/app-service-api/app-service-api-authentication\\n\\n- Identity Server\\n\\nhttps://github.com/IdentitySer\", \"ver\\n\\n## Client communication\\n\\nIn addition to serving pages and responding to requests for data via w\", \"eb APIs, ASP.NET Core apps can communicate directly with connected clients. This outbound communicat\", \"ion can use a variety of transport technologies, the most common being WebSockets. ASP.NET Core Sign\", \"alR is a library that makes it simple to add real-time server-to-client communication functionality \", \"to your applications. SignalR supports a variety of transport technologies, including WebSockets, an\", \"d abstracts away many of the implementation details from the developer.\\n\\nReal-time client communicat\", \"ion, whether using WebSockets directly or other techniques, are useful in a variety of application s\", \"cenarios. Some examples include:\\n\\n- Live chat room applications\\n- Monitoring applications\\n- Job prog\", \"ress updates\\n- Notifications\\n- Interactive forms applications\\n\\nWhen building client communication in\", \"to your applications, there are typically two components:\\n\\n- Server-side connection manager (SignalR\", \" Hub, WebSocketManager WebSocketHandler)\\n- Client-side library\\n\\nClients aren't limited to browsers m\", \"obile apps, console apps, and other native apps can also communicate using SignalR/WebSockets. The f\", \"ollowing simple program echoes all content sent to a chat application to the console, as part of a W\", \"ebSocketManager sample application:\\n\\n```\\npublic class Program { private static Connection _connectio\", \"n; public static void Main(string[] args) { StartConnectionAsync(); _connection.On(\\\"receiveMessage\\\",\", \" (arguments) => { Console.WriteLine($\\\"{arguments[0]} said: {arguments[1]}\\\"); }); Console.ReadLine();\", \" StopConnectionAsync(); } public static async Task StartConnectionAsync() { _connection = new Connec\", \"tion(); await _connection.StartConnectionAsync(\\\"ws://localhost:65110/chat\\\"); } public static async T\", \"ask StopConnectionAsync() { await _connection.StopConnectionAsync(); } }\\n```\\n\\nConsider ways in which\", \" your applications communicate directly with client applications, and consider whether realtime comm\", \"unication would improve your app's user experience.\\n\\n## References -Client Communication\\n\\n- \\u2022\\n- ASP.\", \"NET Core SignalR https://github.com/dotnet/aspnetcore/tree/main/src/SignalR\\n- WebSocket Manager\\n- ht\", \"tps://github.com/radu-matei/websocket-manager\\n\\n## Domain-driven design -Should you apply it?\\n\\nDomain\", \"-Driven Design (DDD) is an agile approach to building software that emphasizes focusing on the busin\", \"ess domain . It places a heavy emphasis on communication and interaction with business domain expert\", \"(s) who can relate to the developers how the real-world system works. For example, if you're buildin\", \"g a system that handles stock trades, your domain expert might be an exp erienced stock broker. DDD \", \"is designed to address large, complex business problems, and is often not appropriate for smaller, s\", \"impler applications, as the investment in understanding and modeling the domain is not worth it.\\n\\nWh\", \"en building software following a DDD approach, your team (including non-technical stakeholders and c\", \"ontributors) should develop a ubiquitous language for the problem space. That is, the same terminolo\", \"gy should be used for the real-world concept being modeled, the software equivalent, and any structu\", \"res that might exist to persist the concept (for example, database tables). Thus, the concepts descr\", \"ibed in the ubiquitous language should form the basis for your domain model .\\n\\nYour domain model com\", \"prises objects that interact with one another to represent the behavior of the system. These objects\", \" may fall into the following categories:\\n\\n- Entities, which represent objects with a thread of ident\", \"ity. Entities are typically stored in persistence with a key by which they can later be retrieved.\\n-\", \" Aggregates, which represent groups of objects that should be persisted as a unit.\\n- Value objects, \", \"which represent concepts that can be compared on the basis of the sum of their property values. For \", \"example, DateRange consisting of a start and end date.\\n- Domain events, which represent things happe\", \"ning within the system that are of interest to other parts of the system.\\n\\nA DDD domain model should\", \" encapsulate complex behavior within the model. Entities, in particular, should not merely be collec\", \"tions of properties. When the domain model lacks behavior and merely represents the state of the sys\", \"tem, it is said to be an anemic model, which is undesirable in DDD.\\n\\nIn addition to these model type\", \"s, DDD typically employs a variety of patterns:\\n\\n- Repository, for abstracting persistence details.\\n\", \"- Factory, for encapsulating complex object creation.\\n- Services, for encapsulating complex behavior\", \" and/or infrastructure implementation details.\\n- Command, for decoupling issuing commands and execut\", \"ing the command itself.\\n- Specification, for encapsulating query details.\\n\\nDDD also recommends the u\", \"se of the Clean Architecture discussed previously, allowing for loose coupling, encapsulation, and c\", \"ode that can easily be verified using unit tests.\\n\\n## When should you apply DDD\\n\\nDDD is well suited \", \"to large applications with significant business (not just technical) complexity. The application sho\", \"uld require the knowledge of domain experts. There should be significant behavior in the domain mode\", \"l itself, representing business rules and interactions beyond simply storing and retrieving the curr\", \"ent state of various records from data stores.\\n\\n## When shouldn't you apply DDD\\n\\nDDD involves invest\", \"ments in modeling, architecture, and communication that may not be warranted for smaller application\", \"s or applications that are essentially just CRUD (create/read/update/delete). If you choose to appro\", \"ach your application following DDD, but find that your domain has an anemic model with no behavior, \", \"you may need to rethink your approach. Either your application may not\\n\\nInternet\\n\\nHTTP\\n\\nReverse prox\", \"y server:\\n\\nIIS, Nginx, Apache\\n\\nHTTP\\n\\nKestrel\\n\\nASP.NET Core application\\n\\nHttpContext\\n\\nApplication cod\", \"e need DDD, or you may need assistance refactoring your application to encapsulate business logic in\", \" the domain model, rather than in your database or user interface.\\n\\nA hybrid approach would be to on\", \"ly use DDD for the transactional or more complex areas of the application, but not for simpler CRUD \", \"or readonly portions of the application. For instance, you don't need the constraints of an Aggregat\", \"e if you're querying da ta to display a report or to visualize data for a dashboard. It's perfectly \", \"acceptable to have a separate, simpler read model for such requirements.\\n\\n## References -Domain-Driv\", \"en Design\\n\\n- DDD in Plain English (StackOverflow Answer)\\n\\nhttps://stackoverflow.com/questions/122239\", \"2/can-someone-explain-domain-driven-designddd-in-plain-english-please/1222488#1222488\\n\\n## Deployment\", \"\\n\\nThere are a few steps involved in the process of deploying your ASP.NET Core application, regardle\", \"ss of where it will be hosted. The first step is to publish the application, which can be done using\", \" the dotnet publish CLI command. This step will compile the application and place all of the files n\", \"eeded to run the application into a designated folder. When you deploy from Visual Studio, this step\", \" is performed for you automatically. The publish folder contains .exe and .dll files for the applica\", \"tion and its dependencies. A self-contained application will also include a version of the .NET runt\", \"ime. ASP.NET Core applications will also include configuration files, static client assets, and MVC \", \"views.\\n\\nASP.NET Core applications are console applications that must be started when the server boot\", \"s and restarted if the application (or server) crashes. A process manager can be used to automate th\", \"is process. The most common process managers for ASP.NET Core are Nginx and Apache on Linux and IIS \", \"or Windows Service on Windows.\\n\\nIn addition to a process manager, ASP.NET Core applications may use \", \"a reverse proxy server. A reverse proxy server receives HTTP requests from the Internet and forwards\", \" them to Kestrel after some preliminary handling. Reverse proxy servers provide a layer of security \", \"for the application. Kestrel also doesn't support hosting multiple applications on the same port, so\", \" techniques like host headers cannot be used with it to enable hosting multiple applications on the \", \"same port and IP address.\\n\\nFigure 7-5. ASP.NET hosted in Kestrel behind a reverse proxy server\\n\\n<!--\", \" image -->\\n\\nAnother scenario in which a reverse proxy can be helpful is to secure multiple applicati\", \"ons using SSL/HTTPS. In this case, only the reverse proxy would need to have SSL configured. Communi\", \"cation between the reverse proxy server and Kestrel could take place over HTTP, as shown in Figure 7\", \"-6.\\n\\nInternet\\n\\nHTTPS\\n\\nReverse proxy server:\\n\\nIIS, Nginx, Apache\\n\\n\\u2022\\n\\nASP.NET Core application\\n\\nHttpCo\", \"ntext\\n\\nApplication code\\n\\nFigure 7-6. ASP.NET hosted behind an HTTPS-secured reverse proxy server\\n\\n<!\", \"-- image -->\\n\\nAn increasingly popular approach is to host your ASP.NET Core application in a Docker \", \"container, which then can be hosted locally or deployed to Azure for cloud-based hosting. The Docker\", \" container could contain your application code, running on Kestrel, and would be deployed behind a r\", \"everse proxy server, as shown above.\\n\\nIf you're hosting your application on Azure, you can use Micro\", \"soft Azure Application Gateway as a dedicated virtual appliance to provide several services. In addi\", \"tion to acting as a reverse proxy for individual applications, Application Gateway can also offer th\", \"e following features:\\n\\n- HTTP load balancing\\n- SSL offload (SSL only to Internet)\\n- End to End SSL\\n-\", \" Multi-site routing (consolidate up to 20 sites on a single Application Gateway)\\n- Web application f\", \"irewall\\n- Websocket support\\n- Advanced diagnostics\\n\\nLearn more about Azure deployment options in Cha\", \"pter 10.\\n\\n## References -Deployment\\n\\n- Hosting and Deployment Overview\\n\\nhttps://learn.microsoft.com/\", \"aspnet/core/publishing/\\n\\n- When to use Kestrel with a reverse proxy\\n\\nhttps://learn.microsoft.com/asp\", \"net/core/fundamentals/servers/kestrel#when-to-use-kestrelwith-a-reverse-proxy\\n\\n- Host ASP.NET Core a\", \"pps in Docker\\n- https://learn.microsoft.com/aspnet/core/publishing/docker\\n- Introducing Azure Applic\", \"ation Gateway\\n\\nhttps://learn.microsoft.com/azure/application-gateway/application-gateway-introductio\", \"n\\n\\nHTTP\\n\\nKestrel\\n\\n## Working with Data in ASP.NET Core Apps\\n\\n'Data is a precious thing and will last\", \" longer than the systems themselves.'\\n\\nTim Berners-Lee\\n\\nData access is an important part of almost a\", \"ny software application. ASP.NET Core supports various data access options, including Entity Framewo\", \"rk Core (and Entity Framework 6 as well), and can work with any .NET data access framework. The choi\", \"ce of which data access framework to use depends on the application's needs. Abstracting these choic\", \"es from the ApplicationCore and UI projects, and encapsulating implementation details in Infrastruct\", \"ure, helps to produce loosely coupled, testable software.\\n\\n## Entity Framework Core (for relational \", \"databases)\\n\\nIf you're writing a new ASP.NET Core application that needs to work with relational data\", \", then Entity Framework Core (EF Core) is the recommended way for your application to access its dat\", \"a. EF Core is an object-relational mapper (O/RM) that enables .NET developers to persist objects to \", \"and from a data source. It eliminates the need for most of the data access code developers would typ\", \"ically need to write. Like ASP.NET Core, EF Core has been rewritten from the ground up to support mo\", \"dular cross-platform applications. You add it to your application as a NuGet package, configure it d\", \"uring app startup, and request it through dependency injection wherever you need it.\\n\\nTo use EF Core\", \" with a SQL Server database, run the following dotnet CLI command:\\n\\ndotnet add package Microsoft.Ent\", \"ityFrameworkCore.SqlServer\\n\\nTo add support for an InMemory data source, for testing:\\n\\ndotnet add pac\", \"kage Microsoft.EntityFrameworkCore.InMemory\\n\\n## The DbContext\\n\\nTo work with EF Core, you need a subc\", \"lass of DbContext. This class holds properties representing collections of the entities your applica\", \"tion will work with. The eShopOnWeb sample includes a CatalogContext with collections for items, bra\", \"nds, and types:\\n\\n```\\npublic class CatalogContext : DbContext { public CatalogContext(DbContextOption\", \"s<CatalogContext> options) : base (options) { } public DbSet<CatalogItem> CatalogItems { get ; set ;\", \" } public DbSet<CatalogBrand> CatalogBrands { get ; set ; } public DbSet<CatalogType> CatalogTypes {\", \" get ; set ; } }\\n```\\n\\nYour DbContext must have a constructor that accepts DbContextOptions and pass \", \"this argument to the base DbContext constructor. If you have only one DbContext in your application,\", \" you can pass an instance of DbContextOptions, but if you have more than one you must use the generi\", \"c DbContextOptions&lt;T&gt; type, passing in your DbContext type as the generic parameter.\\n\\n## Confi\", \"guring EF Core\\n\\nIn your ASP.NET Core application, you'll typically configure EF Core in Program.cs w\", \"ith your application's other dependencies. EF Core uses a DbContextOptionsBuilder, which supports se\", \"veral helpful extension methods to streamline its configuration. To configure CatalogContext to use \", \"a SQL Server database with a connection string defined in Configuration, you would add the following\", \" code:\\n\\n```\\nbuilder.Services.AddDbContext<CatalogContext>( options => options.UseSqlServer( builder.\", \"Configuration.GetConnectionString(\\\"DefaultConnection\\\")));\\n```\\n\\nTo use the in-memory database:\\n\\n```\\nb\", \"uilder.Services.AddDbContext<CatalogContext>(options => options.UseInMemoryDatabase());\\n```\\n\\nOnce yo\", \"u have installed EF Core, created a DbContext child type, and added the type to the application's se\", \"rvices, you are ready to use EF Core. You can request an instance of your DbContext type in any serv\", \"ice that needs it and start working with your persisted entities using LINQ as if they were simply i\", \"n a collection. EF Core does the work of translating your LINQ expressions into SQL queries to store\", \" and retrieve your data.\\n\\nYou can see the queries EF Core is executing by configuring a logger and e\", \"nsuring its level is set to at least Information, as shown in Figure 8-1.\\n\\nC:\\\\Program Files\\\\dotnet\\\\d\", \"otnet.exe\\n\\nHosting environment: Development\\n\\nContent root path: C:\\\\dev\\\\github\\\\eShopOnWeb\\\\src\\\\Web\\n\\nNo\", \"w listening on: http://0.0.0.0:5106\\n\\nApplication started. Press Ctrl+C to shut down.\\n\\ninfo: Microsof\", \"t.AspNetCore.Hosting.Internal.WebHost[1]\\n\\ninfo: Microsoft.AspNetCore.Mvc.Internal.ControllerActionIn\", \"voker[1]\\n\\nRequest starting HTTP/1.1 GET http://localhost:5106/\\n\\nState is Valid info: Microsoft.Entit\", \"yFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]\\n\\nSELECT COUNT\\\\_BIG(*)\\n\\nExecuted DbCommand\", \" (20ms) [Parameters=[], CommandType=\\\"Text'\\n\\nFROM [Catalog] AS [c]\\n\\ninfo: Microsoft.EntityFrameworkCo\", \"re.Storage.IRelationalCommandBuilderFactory[1]\\n\\nExecuted DbCommand (53ms) [Parameters= [@\\n\\nPrice]\\n\\nF\", \"ROM [Catalog] AS [c]\\n\\nORDER BY (SELECT 1)\\n\\nOFFSET @\\\\_P\\\\_0 ROWS FETCH NEXT @\\\\_P\\\\_1 ROWS ONLY\\n\\ninfo: M\", \"icrosoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]\\n\\nSELECT [c]. [Id], [c]. [Br\", \"and]\\n\\ninfo: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]\\n\\nFROM [Catalog\", \"Brand] AS [c]\\n\\nExecuted DbCommand (Oms) [Parameters=[], CommandType='Text'\\n\\nFROM [CatalogType] AS [c\", \"]\\n\\n<!-- image -->\\n\\nSELECT [c]. [Id], [c]. [Type]\\n\\ninfo: Microsoft.AspNetCore.Mvc.ViewFeatures.Intern\", \"al.ViewResultExecutor[1]\\n\\nFigure 8-1. Logging EF Core queries to the console\\n\\n## Fetching and storin\", \"g Data\\n\\nTo retrieve data from EF Core, you access the appropriate property and use LINQ to filter th\", \"e result. You can also use LINQ to perform projection, transforming the result from one type to anot\", \"her. The following example would retrieve CatalogBrands, ordered by name, filtered by their Enabled \", \"property, and projected onto a SelectListItem type:\\n\\n```\\nvar brandItems = await _context.CatalogBran\", \"ds .Where(b => b.Enabled) .OrderBy(b => b.Name) .Select(b => new SelectListItem { Value = b.Id, Text\", \" = b.Name }) .ToListAsync();\\n```\\n\\nIt's important in the above example to add the call to ToListAsync\", \" in order to execute the query immediately. Otherwise, the statement will assign an IQueryable&lt;Se\", \"lectListItem&gt; to brandItems, which will not be executed until it is enumerated. There are pros an\", \"d cons to returning IQueryable results from methods. It allows the query EF Core will construct to b\", \"e further modified, but can also result in errors that only occur at run time, if operations are add\", \"ed to the query that EF Core cannot translate. It's generally safer to pass any filters into the met\", \"hod performing the data access, and return back an in-memory collection (for example, List&lt;T&gt;)\", \" as the result.\\n\\nEF Core tracks changes on entities it fetches from persistence. To save changes to \", \"a tracked entity, you just call the SaveChangesAsync method on the DbContext, making sure it's the s\", \"ame DbContext instance that was used to fetch the entity. Adding and removing entities is directly d\", \"one on the appropriate DbSet property, again with a call to SaveChangesAsync to execute the database\", \" commands. The following example demonstrates adding, updating, and removing entities from persisten\", \"ce.\\n\\n```\\n// create var newBrand = new CatalogBrand() { Brand = \\\"Acme\\\" }; _context.Add(newBrand); awa\", \"it _context.SaveChangesAsync(); // read and update var existingBrand = _context.CatalogBrands.Find(1\", \"); existingBrand.Brand = \\\"Updated Brand\\\"; await _context.SaveChangesAsync(); // read and delete (alt\", \"ernate Find syntax) var brandToDelete = _context.Find<CatalogBrand>(2); _context.CatalogBrands.Remov\", \"e(brandToDelete); await _context.SaveChangesAsync();\\n```\\n\\nEF Core supports both synchronous and asyn\", \"c methods for fetching and saving. In web applications, it's recommended to use the async/await patt\", \"ern with the async methods, so that web server threads are not blocked while waiting for data access\", \" operations to complete.\\n\\nFor more information, see Buffering and Streaming.\\n\\n## Fetching related da\", \"ta\\n\\nWhen EF Core retrieves entities, it populates all of the properties that are stored directly wit\", \"h that entity in the database. Navigation properties, such as lists of related entities, are not pop\", \"ulated and may have their value set to null. This process ensures EF Core is not fetching more data \", \"than is needed, which is especially important for web applications, which must quickly process reque\", \"sts and return responses in an efficient manner. To include relationships with an entity using eager\", \" loading , you specify the property using the Include extension method on the query, as shown:\\n\\n```\\n\", \"// .Include requires using Microsoft.EntityFrameworkCore var brandsWithItems = await _context.Catalo\", \"gBrands .Include(b => b.Items) .ToListAsync();\\n```\\n\\nYou can include multiple relationships, and you \", \"can also include subrelationships using ThenInclude. EF Core will execute a single query to retrieve\", \" the resulting set of entities. Alternately you can include navigation properties of navigation prop\", \"erties b y passing a '.' -separated string to the .Include() extension method, like so:\\n\\n```\\n.Includ\", \"e(\\\"Items.Products\\\")\\n```\\n\\nIn addition to encapsulating filtering logic, a specification can specify t\", \"he shape of the data to be returned, including which properties to populate. The eShopOnWeb sample i\", \"ncludes several specifications that demonstrate encapsulating eager loading information within the s\", \"pecification. You can see how the specification is used as part of a query here:\\n\\n```\\n// Includes al\", \"l expression-based includes query = specification.Includes.Aggregate(query, (current, include) => cu\", \"rrent.Include(include)); // Include any string-based include statements query = specification.Includ\", \"eStrings.Aggregate(query, (current, include) => current.Include(include));\\n```\\n\\nAnother option for l\", \"oading related data is to use explicit loading . Explicit loading allows you to load additional data\", \" into an entity that has already been retrieved. Since this approach involves a separate request to \", \"the database, it's not recommended for web applications, which should minimize the number of databas\", \"e round trips made per request.\\n\\nLazy loading is a feature that automatically loads related data as \", \"it is referenced by the application. EF Core has added support for lazy loading in version 2.1. Lazy\", \" loading is not enabled by default and requires installing the Microsoft.EntityFrameworkCore.Proxies\", \". As with explicit loading, lazy loading should typically be disabled for web applications, since it\", \"s use will result in additional database queries being made within each web request. Unfortunately, \", \"the overhead incurred by lazy loading often goes unnoticed at development time, when the latency is \", \"small and often the data sets used for testing are small. However, in production, with more users, m\", \"ore data, and more latency, the additional database requests can often result in poor performance fo\", \"r web applications that make heavy use of lazy loading.\\n\\n## Avoid Lazy Loading Entities in Web Appli\", \"cations\\n\\nIt's a good idea to test your application while examining the actual database queries it ma\", \"kes. Under certain circumstances, EF Core may make many more queries or a more expensive query than \", \"is optimal for the application. One such problem is known as a Cartesian Explosion. The EF Core team\", \" makes available the AsSplitQuery method as one of several ways to tune runtime behavior.\\n\\n## Encaps\", \"ulating data\\n\\nEF Core supports several features that allow your model to properly encapsulate its st\", \"ate. A common problem in domain models is that they expose collection navigation properties as publi\", \"cly accessible list types. This problem allows any collaborator to manipulate the contents of these \", \"collection types, which may bypass important business rules related to the collection, possibly leav\", \"ing the object in an invalid state. The solution to this problem is to expose read-only access to re\", \"lated collections, and explicitly provide methods defining ways in which clients can manipulate them\", \", as in this example:\\n\\n```\\npublic class Basket : BaseEntity { public string BuyerId { get ; set ; } \", \"private readonly List<BasketItem> _items = new List<BasketItem>(); public IReadOnlyCollection<Basket\", \"Item> Items => _items.AsReadOnly(); public void AddItem(int catalogItemId, decimal unitPrice, int qu\", \"antity = 1) { var existingItem = Items.FirstOrDefault(i => i.CatalogItemId == catalogItemId); if (ex\", \"istingItem == null ) { _items.Add( new BasketItem() { CatalogItemId = catalogItemId, Quantity = quan\", \"tity, UnitPrice = unitPrice }); } else existingItem.Quantity += quantity; } }\\n```\\n\\nThis entity type \", \"doesn't expose a public List or ICollection property, but instead exposes an IReadOnlyCollection typ\", \"e that wraps the underlying List type. When using this pattern, you can indicate to Entity Framework\", \" Core to use the backing field like so:\\n\\n```\\nprivate void ConfigureBasket(EntityTypeBuilder<Basket> \", \"builder) { var navigation = builder.Metadata.FindNavigation(nameof(Basket.Items)); navigation.SetPro\", \"pertyAccessMode(PropertyAccessMode.Field); }\\n```\\n\\nAnother way in which you can improve your domain m\", \"odel is by using value objects for types that lack identity and are only distinguished by their prop\", \"erties. Using such types as properties of your entities can help keep logic specific to the value ob\", \"ject where it belongs, and can avoid duplicate logic between multiple entities that use the same con\", \"cept. In Entity Framework Core, you can persist value objects in the same table as their owning enti\", \"ty by configuring the type as an owned entity, like so:\\n\\n```\\nprivate void ConfigureOrder(EntityTypeB\", \"uilder<Order> builder) { builder.OwnsOne(o => o.ShipToAddress); }\\n```\\n\\nIn this example, the ShipToAd\", \"dress property is of type Address. Address is a value object with several properties such as Street \", \"and City. EF Core maps the Order object to its table with one column per Address property, prefixing\", \" each column name with the name of the property. In this example, the Order table would include colu\", \"mns such as ShipToAddress\\\\_Street and ShipToAddress\\\\_City. It's also possible to store owned types i\", \"n separate tables, if desired.\\n\\nLearn more about owned entity support in EF Core.\\n\\n## Resilient conn\", \"ections\\n\\nExternal resources like SQL databases may occasionally be unavailable. In cases of temporar\", \"y unavailability, applications can use retry logic to avoid raising an exception. This technique is \", \"commonly referred to as connection resiliency . You can implement your own retry with exponential ba\", \"ckoff technique by attempting to retry with an exponentially increasing wait time, until a maximum r\", \"etry count has been reached. This technique embraces the fact that cloud resources might intermitten\", \"tly be unavailable for short periods of time, resulting in the failure of some requests.\\n\\nFor Azure \", \"SQL DB, Entity Framework Core already provides internal database connection resiliency and retry log\", \"ic. But you need to enable the Entity Framework execution strategy for each DbContext connection if \", \"you want to have resilient EF Core connections.\\n\\nFor instance, the following code at the EF Core con\", \"nection level enables resilient SQL connections that are retried if the connection fails.\\n\\n```\\nbuild\", \"er.Services.AddDbContext<OrderingContext>(options => { options.UseSqlServer(builder.Configuration[\\\"C\", \"onnectionString\\\"], sqlServerOptionsAction: sqlOptions => { sqlOptions.EnableRetryOnFailure( maxRetry\", \"Count: 5,\\n```\\n\\n```\\nmaxRetryDelay: TimeSpan.FromSeconds(30), errorNumbersToAdd: null ); } ); });\\n```\\n\", \"\\n## Execution strategies and explicit transactions using BeginTransaction and multiple DbContexts\\n\\nW\", \"hen retries are enabled in EF Core connections, each operation you perform using EF Core becomes its\", \" own retryable operation. Each query and each call to SaveChangesAsync will be retried as a unit if \", \"a transient failure occurs.\\n\\nHowever, if your code initiates a transaction using BeginTransaction, y\", \"ou are defining your own group of operations that need to be treated as a unit; everything inside th\", \"e transaction has to be rolled back if a failure occurs. You will see an exception like the followin\", \"g if you attempt to execute that transaction when using an EF execution strategy (retry policy) and \", \"you include several SaveChangesAsync from multiple DbContexts in it.\\n\\nSystem.InvalidOperationExcepti\", \"on: The configured execution strategy SqlServerRetryingExecutionStrategy does not support user initi\", \"ated transactions. Use the execution strategy returned by DbContext.Database.CreateExecutionStrategy\", \"() to execute all the operations in the transaction as a retryable unit.\\n\\nThe solution is to manuall\", \"y invoke the EF execution strategy with a delegate representing everything that needs to be executed\", \". If a transient failure occurs, the execution strategy will invoke the delegate again. The followin\", \"g code shows how to implement this approach:\\n\\n```\\n// Use of an EF Core resiliency strategy when usin\", \"g multiple DbContexts // within an explicit transaction // See: // https://learn.microsoft.com/ef/co\", \"re/miscellaneous/connection-resiliency var strategy = _catalogContext.Database.CreateExecutionStrate\", \"gy(); await strategy.ExecuteAsync(async () => { // Achieving atomicity between original Catalog data\", \"base operation and the // IntegrationEventLog thanks to a local transaction using (var transaction =\", \" _catalogContext.Database.BeginTransaction()) { _catalogContext.CatalogItems.Update(catalogItem); aw\", \"ait _catalogContext.SaveChangesAsync(); // Save to EventLog only if product price changed if (raiseP\", \"roductPriceChangedEvent) { await _integrationEventLogService.SaveEventAsync(priceChangedEvent); tran\", \"saction.Commit(); } } });\\n```\\n\\nThe first DbContext is the \\\\_catalogContext and the second DbContext \", \"is within the \\\\_integrationEventLogService object. Finally, the Commit action would be performed mul\", \"tiple DbContexts and using an EF Execution Strategy.\\n\\n## References -Entity Framework Core\\n\\n- EF Cor\", \"e Docs https://learn.microsoft.com/ef/\\n- EF Core: Related Data https://learn.microsoft.com/ef/core/q\", \"uerying/related-data\\n- Avoid Lazy Loading Entities in ASPNET Applications https://ardalis.com/avoid-\", \"lazyloading-entities-in-asp-net-applications\\n\\n## EF Core or micro-ORM?\\n\\nWhile EF Core is a great cho\", \"ice for managing persistence, and for the most part encapsulates database details from application d\", \"evelopers, it isn't the only choice. Another popular open -source alternative is Dapper, a so-called\", \" micro-ORM. A micro-ORM is a lightweight, less full-featured tool for mapping objects to data struct\", \"ures. In the case of Dapper, its design goals focus on performance, rather than fully encapsulating \", \"the underlying queries it uses to retrieve and update data. Because it doesn't abstract SQL from the\", \" developer, Dapper is 'closer to the metal' and lets developers write the exact queries they want to\", \" use for a given data access operation.\\n\\nEF Core has two significant features it provides which sepa\", \"rate it from Dapper but also add to its performance overhead. The first is the translation from LINQ\", \" expressions into SQL. These translations are cached, but even so there is overhead in performing th\", \"em the first time. The second is change tracking on entities (so that efficient update statements ca\", \"n be generated). This behavior can be turned off for specific queries by using the AsNoTracking exte\", \"nsion. EF Core also generates SQL queries that usually are very efficient and in any case perfectly \", \"acceptable from a performance standpoint, but if you need fine control over the precise query to be \", \"executed, you can pass in custom SQL (or execute a stored procedure) using EF Core, too. In this cas\", \"e, Dapper still outperforms EF Core, but only very slightly. Current performance benchmark data for \", \"a variety of data access methods can be found on the Dapper site.\\n\\nTo see how the syntax for Dapper \", \"varies from EF Core, consider these two versions of the same method for retrieving a list of items:\\n\", \"\\n```\\n// EF Core private readonly CatalogContext _context; public async Task<IEnumerable<CatalogType>\", \"> GetCatalogTypes() { return await _context.CatalogTypes.ToListAsync(); } // Dapper private readonly\", \" SqlConnection _conn; public async Task<IEnumerable<CatalogType>> GetCatalogTypesWithDapper() { retu\", \"rn await _conn.QueryAsync<CatalogType>(\\\"SELECT * FROM CatalogType\\\"); }\\n```\\n\\nIf you need to build mor\", \"e complex object graphs with Dapper, you need to write the associated queries yourself (as opposed t\", \"o adding an Include as you would in EF Core). This functionality is supported through various syntax\", \"es, including a feature called Multi Mapping that lets you map individual rows to multiple mapped ob\", \"jects. For example, given a class Post with a property Owner of type User, the following SQL would r\", \"eturn all of the necessary data:\\n\\n```\\nselect * from #Posts p left join #Users u on u. Id = p.OwnerId\", \" Order by p. Id\\n```\\n\\nEach returned row includes both User and Post data. Since the User data should \", \"be attached to the Post data via its Owner property, the following function is used:\\n\\n```\\n(post, use\", \"r) => { post.Owner = user; return post; }\\n```\\n\\nThe full code listing to return a collection of posts\", \" with their Owner property populated with the associated user data would be:\\n\\n```\\nvar sql = @\\\"select\", \" * from #Posts p left join #Users u on u.Id = p.OwnerId Order by p.Id\\\"; var data = connection.Query<\", \"Post, User, Post>(sql, (post, user) => { post.Owner = user; return post;});\\n```\\n\\nBecause it offers l\", \"ess encapsulation, Dapper requires developers know more about how their data is stored, how to query\", \" it efficiently, and write more code to fetch it. When the model changes, instead of simply creating\", \" a new migration (another EF Core feature), and/or updating mapping information in one place in a Db\", \"Context, every query that is impacted must be updated. These queries have no compile-time guarantees\", \", so they may break at run time in response to changes to the model or database, making errors more \", \"difficult to detect quickly. In exchange for these tradeoffs, Dapper offers extremely fast performan\", \"ce.\\n\\nFor most applications, and most parts of almost all applications, EF Core offers acceptable per\", \"formance. Thus, its developer productivity benefits are likely to outweigh its performance overhead.\", \" For queries that can benefit from caching, the actual query may only be executed a tiny percentage \", \"of the time, making relatively small query performance differences moot.\\n\\n## SQL or NoSQL\\n\\nTradition\", \"ally, relational databases like SQL Server have dominated the marketplace for persistent data storag\", \"e, but they are not the only solution available. NoSQL databases like MongoDB offer a different appr\", \"oach to storing objects. Rather than mapping objects to tables and rows, another option is to serial\", \"ize the entire object graph, and store the result. The benefits of this approach, at least initially\", \", are simplicity and performance. It's simpler to store a single serialized object with a key than t\", \"o decompose the object into many tables with relationships and update rows that may have changed sin\", \"ce the object was last retrieved from the database. Likewise, fetching and deserializing a single ob\", \"ject from a key-based store is typically much faster and easier than complex joins or multiple datab\", \"ase queries required to fully compose the same object from a relational database. The lack of locks \", \"or transactions or a fixed schema also makes NoSQL databases amenable to scaling across many machine\", \"s, supporting very large datasets.\\n\\nOn the other hand, NoSQL databases (as they are typically called\", \") have their drawbacks. Relational databases use normalization to enforce consistency and avoid dupl\", \"ication of data. This approach reduces the total size of the database and ensures that updates to sh\", \"ared data are available immediately throughout the database. In a relational database, an Address ta\", \"ble might reference a\\n\\nCountry table by ID, such that if the name of a country/region were changed, \", \"the address records would benefit from the update without themselves having to be updated. However, \", \"in a NoSQL database, Address, and its associated Country might be serialized as part of many stored \", \"objects. An update to a country/region name would require all such objects to be updated, rather tha\", \"n a single row. Relational databases can also ensure relational integrity by enforcing rules like fo\", \"reign keys. NoSQL databases typically do not offer such constraints on their data.\\n\\nAnother complexi\", \"ty NoSQL databases must deal with is versioning. When an object's properties change, it may not be a\", \"ble to be deserialized from past versions that were stored. Thus, all existing objects that have a s\", \"erialized (previous) version of the object must be updated to conform to its new schema. This approa\", \"ch is not conceptually different from a relational database, where schema changes sometimes require \", \"update scripts or mapping updates. However, the number of entries that must be modified is often muc\", \"h greater in the NoSQL approach, because there is more duplication of data.\\n\\nIt's possible in NoSQL \", \"databases to store multiple versions of objects, something fixed schema relational databases typical\", \"ly do not support. However, in this case, your application code will need to account for the existen\", \"ce of previous versions of objects, adding additional complexity.\\n\\nNoSQL databases typically do not \", \"enforce ACID, which means they have both performance and scalability benefits over relational databa\", \"ses. They're well suited to extremely large datasets and objects that are not well suited to storage\", \" in normalized table structures. There is no reason why a single application cannot take advantage o\", \"f both relational and NoSQL databases, using each where it is best suited.\\n\\n## Azure Cosmos DB\\n\\nAzur\", \"e Cosmos DB is a fully managed NoSQL database service that offers cloud-based schema-free data stora\", \"ge. Azure Cosmos DB is built for fast and predictable performance, high availability, elastic scalin\", \"g, and global distribution. Despite being a NoSQL database, developers can use rich and familiar SQL\", \" query capabilities on JSON data. All resources in Azure Cosmos DB are stored as JSON documents. Res\", \"ources are managed as items , which are documents containing metadata, and feeds , which are collect\", \"ions of items. Figure 8-2 shows the relationship between different Azure Cosmos DB resources.\\n\\nAzure\", \" Cosmos DB\\n\\nAccount\\n\\nDatabase\\n\\n/dbs/(id}\\n\\nCollections\\n\\n/colls/(id)\\n\\nDocuments\\n\\n/docs/(id}\\n\\nU\\n\\nAttach\", \"ments\\n\\nFigure 8-2. Azure Cosmos DB resource organization.\\n\\n<!-- image -->\\n\\nThe Azure Cosmos DB query\", \" language is a simple yet powerful interface for querying JSON documents. The language supports a su\", \"bset of ANSI SQL grammar and adds deep integration of JavaScript object, arrays, object construction\", \", and function invocation.\\n\\n## References -Azure Cosmos DB\\n\\n- Azure Cosmos DB Introduction https://l\", \"earn.microsoft.com/azure/cosmos-db/introduction\\n\\n## Other persistence options\\n\\nIn addition to relati\", \"onal and NoSQL storage options, ASP.NET Core applications can use Azure Storage to store various dat\", \"a formats and files in a cloud-based, scalable fashion. Azure Storage is massively scalable, so you \", \"can start out storing small amounts of data and scale up to storing hundreds or terabytes if your ap\", \"plication requires it. Azure Storage supports four kinds of data:\\n\\n- Blob Storage for unstructured t\", \"ext or binary storage, also referred to as object storage.\\n- Table Storage for structured datasets, \", \"accessible via row keys.\\n- Queue Storage for reliable queue-based messaging.\\n\\n- File Storage for sha\", \"red file access between Azure virtual machines and on-premises applications.\\n\\n## References -Azure S\", \"torage\\n\\n- Azure Storage Introduction https://learn.microsoft.com/azure/storage/common/storageintrodu\", \"ction\\n\\n## Caching\\n\\nIn web applications, each web request should be completed in the shortest time po\", \"ssible. One way to achieve this functionality is to limit the number of external calls the server mu\", \"st make to complete the request. Caching involves storing a copy of data on the server (or another d\", \"ata store that is more easily queried than the source of the data). Web applications, and especially\", \" non-SPA traditional web applications, need to build the entire user interface with every request. T\", \"his approach frequently involves making many of the same database queries repeatedly from one user r\", \"equest to the next. In most cases, this data changes rarely, so there is little reason to constantly\", \" request it from the database. ASP.NET Core supports response caching, for caching entire pages, and\", \" data caching, which supports more granular caching behavior.\\n\\nWhen implementing caching, it's impor\", \"tant to keep in mind separation of concerns. Avoid implementing caching logic in your data access lo\", \"gic, or in your user interface. Instead, encapsulate caching in its own classes, and use configurati\", \"on to manage its behavior. This approach follows the Open/Closed and Single Responsibility principle\", \"s, and will make it easier for you to manage how you use caching in your application as it grows.\\n\\n#\", \"# ASP.NET Core response caching\\n\\nASP.NET Core supports two levels of response caching. The first lev\", \"el does not cache anything on the server, but adds HTTP headers that instruct clients and proxy serv\", \"ers to cache responses. This functionality is implemented by adding the ResponseCache attribute to i\", \"ndividual controllers or actions:\\n\\n```\\n[ResponseCache(Duration = 60)] public IActionResult Contact()\", \" { ViewData[\\\"Message\\\"] = \\\"Your contact page.\\\"; return View(); }\\n```\\n\\nThe previous example will resul\", \"t in the following header being added to the response, instructing clients to cache the result for u\", \"p to 60 seconds.\\n\\n```\\nCache-Control: public,max-age=60\\n```\\n\\nIn order to add server-side in-memory ca\", \"ching to the application, you must reference the Microsoft.AspNetCore.ResponseCaching NuGet package,\", \" and then add the Response Caching middleware. This middleware is configured with services and middl\", \"eware during app startup:\\n\\n```\\nbuilder.Services.AddResponseCaching(); // other code omitted, includi\", \"ng building the app app.UseResponseCaching();\\n```\\n\\nThe Response Caching Middleware will automaticall\", \"y cache responses based on a set of conditions, which you can customize. By default, only 200 (OK) r\", \"esponses requested via GET or HEAD methods are cached. In addition, requests must have a response wi\", \"th a Cache-Control: public header, and cannot include headers for Authorization or Set-Cookie. See a\", \" complete list of the caching conditions used by the response caching middleware.\\n\\n## Data caching\\n\\n\", \"Rather than (or in addition to) caching full web responses, you can cache the results of individual \", \"data queries. For this functionality, you can use in memory caching on the web server, or use a dist\", \"ributed cache. This section will demonstrate how to implement in memory caching.\\n\\nAdd support for me\", \"mory (or distributed) caching with the following code:\\n\\n```\\nbuilder.Services.AddMemoryCache(); build\", \"er.Services.AddMvc();\\n```\\n\\nBe sure to add the Microsoft.Extensions.Caching.Memory NuGet package as w\", \"ell.\\n\\nOnce you've added the service, you request IMemoryCache via dependency injection wherever you \", \"need to access the cache. In this example, the CachedCatalogService is using the Proxy (or Decorator\", \") design pattern, by providing an alternative implementation of ICatalogService that controls access\", \" to (or adds behavior to) the underlying CatalogService implementation.\\n\\n```\\npublic class CachedCata\", \"logService : ICatalogService { private readonly IMemoryCache _cache; private readonly CatalogService\", \" _catalogService; private static readonly string _brandsKey = \\\"brands\\\"; private static readonly stri\", \"ng _typesKey = \\\"types\\\"; private static readonly TimeSpan _defaultCacheDuration = TimeSpan.FromSecond\", \"s(30); public CachedCatalogService( IMemoryCache cache, CatalogService catalogService) { _cache = ca\", \"che; _catalogService = catalogService; } public async Task<IEnumerable<SelectListItem>> GetBrands() \", \"{ return await _cache.GetOrCreateAsync(_brandsKey, async entry => { entry.SlidingExpiration = _defau\", \"ltCacheDuration; return await _catalogService.GetBrands(); }); } public async Task<Catalog> GetCatal\", \"ogItems(int pageIndex, int itemsPage, int? brandID,\\n```\\n\\n```\\nint? typeId) { string cacheKey = $\\\"item\", \"s-{pageIndex}-{itemsPage}-{brandID}-{typeId}\\\"; return await _cache.GetOrCreateAsync(cacheKey, async \", \"entry => { entry.SlidingExpiration = _defaultCacheDuration; return await _catalogService.GetCatalogI\", \"tems(pageIndex, itemsPage, brandID, typeId); }); } public async Task<IEnumerable<SelectListItem>> Ge\", \"tTypes() { return await _cache.GetOrCreateAsync(_typesKey, async entry => { entry.SlidingExpiration \", \"= _defaultCacheDuration; return await _catalogService.GetTypes(); }); } }\\n```\\n\\nTo configure the appl\", \"ication to use the cached version of the service, but still allow the service to get the instance of\", \" CatalogService it needs in its constructor, you would add the following lines in Program.cs :\\n\\n```\\n\", \"builder.Services.AddMemoryCache(); builder.Services.AddScoped<ICatalogService, CachedCatalogService>\", \"(); builder.Services.AddScoped<CatalogService>();\\n```\\n\\nWith this code in place, the database calls t\", \"o fetch the catalog data will only be made once per minute, rather than on every request. Depending \", \"on the traffic to the site, this can have a significant impact on the number of queries made to the \", \"database, and the average page load time for the home page that currently depends on all three of th\", \"e queries exposed by this service.\\n\\nAn issue that arises when caching is implemented is stale data -\", \"that is, data that has changed at the source but an out-of-date version remains in the cache. A simp\", \"le way to mitigate this issue is to use small cache durations, since for a busy application there is\", \" a limited additional benefit to extending the length data is cached. For example, consider a page t\", \"hat makes a single database query, and is requested 10 times per second. If this page is cached for \", \"one minute, it will result in the number of database queries made per minute to drop from 600 to 1, \", \"a reduction of 99.8%. If instead the cache duration was made one hour, the overall reduction would b\", \"e 99.997%, but now the likelihood and potential age of stale data are both increased dramatically.\\n\\n\", \"Another approach is to proactively remove cache entries when the data they contain is updated. Any i\", \"ndividual entry can be removed if its key is known:\\n\\n```\\n_cache.Remove(cacheKey);\\n```\\n\\nIf your appli\", \"cation exposes functionality for updating entries that it caches, you can remove the corresponding c\", \"ache entries in your code that performs the updates. Sometimes there may be many different entries t\", \"hat depend on a particular set of data. In that case, it can be useful to create dependencies betwee\", \"n cache entries, by using a CancellationChangeToken. With a CancellationChangeToken, you can expire \", \"multiple cache entries at once by canceling the token.\\n\\nAdmin - Catalog - Microsoft.eSh x\\n\\n+\\n\\n\\u2022 loca\", \"lhost:44315/Admin eShopOnWeb Admin\\n\\nHome admin@microsoft.com\\n\\n\\u2022 Logout\\n\\nManage Product Catalog\\n\\n```\\n\", \"// configure CancellationToken and add entry to cache var cts = new CancellationTokenSource(); _cach\", \"e.Set(\\\"cts\\\", cts); _cache.Set(cacheKey, itemToCache, new CancellationChangeToken(cts.Token)); // els\", \"ewhere, expire the cache by cancelling the token\\\\ _cache.Get<CancellationTokenSource>(\\\"cts\\\").Cancel(\", \"); Id Name Description Price 12 Actions\\n```\\n\\n-\\n\\nGuest\\n\\nAbout eShopOnWeb\\n\\nEdit\\n\\nDelete\\n\\nCaching can d\", \"ramatically improve the performance of web pages that repeatedly request the same values from the da\", \"tabase. Be sure to measure data access and page performance before applying caching, and only apply \", \"caching where you see a need for improvement. Caching consumes web server memory resources and incre\", \"ases the complexity of the application, so it's important you don't prematurely optimize using this \", \"technique. .NET Black &amp; White Mug 8.50 Edit Delete\\n\\n## Getting data to Blazor WebAssembly apps\\n\\n\", \"If you're building apps that use Blazor Server, you can use Entity Framework and other direct data a\", \"ccess technologies as they've been discussed thus far in this chapter. However, when building Blazor\", \" WebAssembly apps, like other SPA frameworks, you will need a different strategy for data access. Ty\", \"pically, these applications access data and interact with the server through web API endpoints.\\n\\nIf \", \"the data or operations being performed are sensitive, be sure to review the section on security in t\", \"he previous chapter and protect your APIs against unauthorized access.\\n\\nYou'll find an example of a \", \"Blazor WebAssembly app in the eShopOnWeb reference application, in the BlazorAdmin project. This pro\", \"ject is hosted within the eShopOnWeb Web project, and allows users in the Administrators group to ma\", \"nage the items in the store. You can see a screenshot of the application in Figure 8-3.\\n\\nFigure 8-3.\", \" eShopOnWeb Catalog Admin Screenshot.\\n\\n<!-- image -->\\n\\nWhen fetching data from web APIs within a Bla\", \"zor WebAssembly app, you just use an instance of HttpClient as you would in any .NET application. Th\", \"e basic steps involved are to create the request to send (if necessary, usually for POST or PUT requ\", \"ests), await the request itself, verify the status code, and deserialize the response. If you're goi\", \"ng to make many requests to a given set of APIs, it's a good idea to encapsulate your APIs and confi\", \"gure the HttpClient base address centrally. This way, if you need to adjust any of these settings be\", \"tween environments, you can make the changes in just one place. You should add support for this serv\", \"ice in your Program.Main:\\n\\n```\\nbuilder.Services.AddScoped(sp => new HttpClient { BaseAddress = new U\", \"ri(builder.HostEnvironment.BaseAddress) });\\n```\\n\\nIf you need to access services securely, you should\", \" access a secure token and configure the HttpClient to pass this token as an Authentication header w\", \"ith every request:\\n\\n```\\n_httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderVa\", \"lue(\\\"Bearer\\\", token);\\n```\\n\\nThis activity can be done from any component that has the HttpClient inje\", \"cted into it, provided that HttpClient wasn't added to the application's services with a Transient l\", \"ifetime. Every reference to HttpClient in the application references the same instance, so changes t\", \"o it in one component flow through the entire application. A good place to perform this authenticati\", \"on check (followed by specifying the token) is in a shared component like the main navigation for th\", \"e site. Learn more about this approach in the BlazorAdmin project in the eShopOnWeb reference applic\", \"ation.\\n\\nOne benefit of Blazor WebAssembly over traditional JavaScript SPAs is that you don't need to\", \" keep copies of your data transfer objects(DTOs) synchronized. Your Blazor WebAssembly project and y\", \"our web API project can both share the same DTOs in a common shared project. This approach eliminate\", \"s some of the friction involved in developing SPAs.\\n\\nTo quickly get data from an API endpoint, you c\", \"an use the built-in helper method, GetFromJsonAsync. There are similar methods for POST, PUT, etc. T\", \"he following shows how to get a CatalogItem from an API endpoint using a configured HttpClient in a \", \"Blazor WebAssembly app:\\n\\n```\\nvar item = await _httpClient.GetFromJsonAsync<CatalogItem>($\\\"catalog-it\", \"ems/{id}\\\");\\n```\\n\\nOnce you have the data you need, you'll typically track changes locally. When you w\", \"ant to make updates to the backend data store, you'll call additional web APIs for this purpose.\\n\\n##\", \" References -Blazor Data\\n\\n- Call a web API from ASP.NET Core Blazor https://learn.microsoft.com/aspn\", \"et/core/blazor/callweb-api\\n\\n## Test ASP.NET Core MVC apps\\n\\n'If you don't like unit testing your prod\", \"uct, most likely your customers won't like to test it, either.' \\\\_-Anonymous-\\n\\nSoftware of any compl\", \"exity can fail in unexpected ways in response to changes. Thus, testing after making changes is requ\", \"ired for all but the most trivial (or least critical) applications. Manual testing is the slowest, l\", \"east reliable, most expensive way t o test software. Unfortunately, if applications aren't designed \", \"to be testable, it can be the only means of testing available. Applications written to follow the ar\", \"chitectural principles laid out in chapter 4 should be largely unit testable. ASP.NET Core applicati\", \"ons support automated integration and functional testing.\\n\\n## Kinds of automated tests\\n\\nThere are ma\", \"ny kinds of automated tests for software applications. The simplest, lowest level test is the unit t\", \"est. At a slightly higher level, there are integration tests and functional tests. Other kinds of te\", \"sts, such as UI tests, load tests, stress tests, and smoke tests, are beyond the scope of this docum\", \"ent.\\n\\n## Unit tests\\n\\nA unit test tests a single part of your application's logic. One can further de\", \"scribe it by listing some of the things that it isn't. A unit test doesn't test how your code works \", \"with dependencies or infrastructure -that's what integration tests are for. A unit test doesn't test\", \" the framework your code is written on -you should a ssume it works or, if you find it doesn't, file\", \" a bug and code a workaround. A unit test runs completely in memory and in process. It doesn't commu\", \"nicate with the file system, the network, or a database. Unit tests should only test your code.\\n\\nUni\", \"t tests, by virtue of the fact that they test only a single unit of your code, with no external depe\", \"ndencies, should execute extremely fast. Thus, you should be able to run test suites of hundreds of \", \"unit tests in a few seconds. Run them frequently, ideally before every push to a shared source contr\", \"ol repository, and certainly with every automated build on your build server.\\n\\n## Integration tests\\n\", \"\\nAlthough it's a good idea to encapsulate your code that interacts with infrastructure like database\", \"s and file systems, you will still have some of that code, and you will probably want to test it.\\n\\nA\", \"dditionally, you should verify that your code's layers interact as you expect when your application'\", \"s dependencies are fully resolved. This functionality is the responsibility of integration tests. In\", \"tegration tests tend to be slower and more difficult to set up than unit tests, because they often d\", \"epend on external dependencies and infrastructure. Thus, you should avoid testing things that could \", \"be tested with unit tests in integration tests. If you can test a given scenario with a unit test, y\", \"ou should test it with a unit test. If you can't, then consider using an integration test.\\n\\nIntegrat\", \"ion tests will often have more complex setup and teardown procedures than unit tests. For example, a\", \"n integration test that goes against an actual database will need a way to return the database to a \", \"known state before each test run. As new tests are added and the production database schema evolves,\", \" these test scripts will tend to grow in size and complexity. In many large systems, it is impractic\", \"al to run full suites of integration tests on developer workstations before checking in changes to s\", \"hared source control. In these cases, integration tests may be run on a build server.\\n\\n## Functional\", \" tests\\n\\nIntegration tests are written from the perspective of the developer, to verify that some com\", \"ponents of the system work correctly together. Functional tests are written from the perspective of \", \"the user, and verify the correctness of the system based on its requirements. The following excerpt \", \"offers a useful analogy for how to think about functional tests, compared to unit tests:\\n\\n'Many time\", \"s the development of a system is likened to the building of a house. While this analogy isn't quite \", \"correct, we can extend it for the purposes of understanding the difference between unit and function\", \"al tests. Unit testing is analogous to a build ing inspector visiting a house's construction site. H\", \"e is focused on the various internal systems of the house, the foundation, framing, electrical, plum\", \"bing, and so on. He ensures (tests) that the parts of the house will work correctly and safely, that\", \" is, meet the building code. Functional tests in this scenario are analogous to the homeowner visiti\", \"ng this same construction site. He assumes that the internal systems will behave appropriately, that\", \" the building inspector is performing his task. The homeowner is focused on what it will be like to \", \"live in this house. He is concerned with how the house looks, are the various rooms a comfortable si\", \"ze, does the house fit the family's needs, are the windows in a good spot to catch the morning sun. \", \"The homeowner i s performing functional tests on the house. He has the user's perspective. The build\", \"ing inspector is performing unit tests on the house. He has the builder's perspective.'\\n\\n## Source: \", \"Unit Testing versus Functional Tests\\n\\nI'm fond of saying 'As developers, we fail in two ways: we bui\", \"ld the thing wrong, or we build the wrong thing.' Unit tests ensure you are building the thing right\", \"; functional tests ensure you are building the right thing.\\n\\nSince functional tests operate at the s\", \"ystem level, they may require some degree of UI automation. Like integration tests, they usually wor\", \"k with some kind of test infrastructure as well. This activity makes them slower and more brittle th\", \"an unit and integration tests. You should have only as many functional tests as you need to be confi\", \"dent the system is behaving as users expect.\\n\\n## Testing Pyramid\\n\\nMartin Fowler wrote about the test\", \"ing pyramid, an example of which is shown in Figure 9-1.\\n\\nFigure 9-1. Testing Pyramid\\n\\n<!-- image --\", \">\\n\\nThe different layers of the pyramid, and their relative sizes, represent different kinds of tests\", \" and how many you should write for your application. As you can see, the recommendation is to have a\", \" large base of unit tests, supported by a smaller layer of integration tests, with an even smaller l\", \"ayer of functional tests. Each layer should ideally only have tests in it that cannot be performed a\", \"dequately at a lower layer. Keep the testing pyramid in mind when you are trying to decide which kin\", \"d of test you need for a particular scenario.\\n\\n## What to test\\n\\nA common problem for developers who \", \"are inexperienced with writing automated tests is coming up with what to test. A good starting point\", \" is to test conditional logic. Anywhere you have a method with behavior that changes based on a cond\", \"itional statement (if-else, switch, and so on), you should be able to come up with at least a couple\", \" of tests that confirm the correct behavior for certain conditions. If your code has error condition\", \"s, it's good to write at least one test for the 'happy path' through the cod e (with no errors), and\", \" at least one test for the 'sad path' (with errors or atypical results) to confirm your application \", \"behaves as expected in the face of errors. Finally, try to focus on testing things that can fail, ra\", \"ther than focusing on metrics like code coverage. More code coverage is better than less, generally.\", \" However, writing a few more tests of a complex and business-critical method is usually a better use\", \" of time than writing tests for auto-properties just to improve test code coverage metrics.\\n\\ntests\\n\\n\", \"::::::::\\n\\nSolution Explorer******\\n\\nSearch Solution Explorer (Ctri+;)\\n\\n## Organizing test projects So\", \"lution 'eShopOnWeb' (10 of 10 projects)\\n\\n5\\u0413C\\n\\nP 8\\n\\nC#\\n\\n\\u2022 8@\\n\\nC#\\n\\n8\\n\\nTest projects can be organized h\", \"owever works best for you. It's a good idea to separate tests by type (unit test, integration test) \", \"and by what they are testing (by project, by namespace). Whether this separation consists of folders\", \" within a single test project, or multiple test projects, is a design decision. One project is simpl\", \"est, but for large projects with many tests, or in order to more easily run different sets of tests,\", \" you might want to have several different test projects. Many teams organize test projects based on \", \"the project they are testing, which for applications with more than a few projects can result in a l\", \"arge number of test projects, especially if you still break these down according to what kind of tes\", \"ts are in each project. A compromise approach is to have one project per kind of test, per applicati\", \"on, with folders inside the test projects to indicate the project (and class) being tested.\\n\\nA commo\", \"n approach is to organize the application projects under a 'src' folder, and the application's test \", \"projects under a parallel 'tests' folder. You can create matching solution folders in Visual Studio,\", \" if you find this organization useful.\\n\\nFigure 9-2. Test organization in your solution\\n\\n<!-- image -\", \"->\\n\\nYou can use whichever test framework you prefer. The xUnit framework works well and is what all \", \"of the ASP.NET Core and EF Core tests are written in. You can add an xUnit test project in Visual St\", \"udio using the template shown in Figure 9-3, or from the CLI using dotnet new xunit.\\n\\nAdd a new proj\", \"ect\\n\\nRecent project templates\\n\\nASP.NET Core Web App\\n\\nBlazor Server App\\n\\nBlazor WebAssembly App\\n\\nEl x\", \"Unit Test Project\\n\\n5j ASP.NET Web Application (NET\\n\\nFramework)\\n\\nASP.NET Clean Architecture Solution\\n\", \"\\n(Steve Smith @ardalis, Erik Dahl)\\n\\n#N Class Library xunit\\n\\nAll languages\\n\\nAll platforms\\n\\nAll projec\", \"t types\\n\\nFigure 9-3. Add an xUnit Test Project in Visual Studio\\n\\n<!-- image -->\\n\\n## Test naming\\n\\nNam\", \"e your tests in a consistent fashion, with names that indicate what each test does. One approach I'v\", \"e had great success with is to name test classes according to the class and method they are testing.\", \" This approach results in many small test classes, but it makes it extremely clear what each test is\", \" responsible for. With the test class name set up, to identify the class and method to be tested, th\", \"e test method name can be used to specify the behavior being tested. This name should include the ex\", \"pected behavior and any inputs or assumptions that should yield this behavior. Some example test nam\", \"es:\\n\\n- CatalogControllerGetImage.CallsImageServiceWithId\\n- CatalogControllerGetImage.LogsWarningGive\", \"nImageMissingException\\n- CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess\\n- CatalogC\", \"ontrollerGetImage.ReturnsNotFoundResultGivenImageMissingException\\n\\nA variation of this approach ends\", \" each test class name with 'Should' and modifies the tense slightly:\\n\\n- CatalogControllerGetImage Sh\", \"ould . Call ImageServiceWithId\\n- CatalogControllerGetImage Should . Log WarningGivenImageMissingExce\", \"ption\\n\\nx-\\n\\nClear all\\n\\nX\\n\\ntests\\n\\n\\u00ab 8\\n\\nFunctionalTests\\n\\n\\u2022 do\\n\\nDependencies\\n\\nPublicApi\\n\\nSome teams find\", \" the second naming approach clearer, though slightly more verbose. In any case, try to use a naming \", \"convention that provides insight into test behavior, so that when one or more tests fail, it's obvio\", \"us from their names what cases have faile d. Avoid naming your tests vaguely, such as ControllerTest\", \"s.Test1, as these names offer no value when you see them in test results.\\n\\n\\u2022 B C# OrderControllerlnd\", \"ex.cs\\n\\nIf you follow a naming convention like the one above that produces many small test classes, i\", \"t's a good idea to further organize your tests using folders and namespaces. Figure 9-4 shows one ap\", \"proach to organizing tests by folder within several test projects.\\n\\n\\u2022 Sd Dependencies\\n\\n\\u2022 8E Reposito\", \"ries\\n\\n\\u2022 8C\\n\\nI Unitlests\\n\\n\\u2022 So Dependencies\\n\\n1 8E Entities\\n\\n\\u2022 8\\n\\n\\u2022 AC\\n\\n\\u2022 BC Services\\n\\n\\u2022 BT\\n\\n\\u2022 B Build\", \"ers\\n\\nFigure 9-4. Organizing test classes by folder based on class being tested.\\n\\n<!-- image -->\\n\\nIf \", \"a particular application class has many methods being tested (and thus many test classes), it may ma\", \"ke sense to place these classes in a folder corresponding to the application class. This organizatio\", \"n is no different than how you might organize files into folders elsewhere. If you have more than th\", \"ree\\n\\nor four related files in a folder containing many other files, it's often helpful to move them \", \"into their own subfolder.\\n\\n## Unit testing ASP.NET Core apps\\n\\nIn a well-designed ASP.NET Core applic\", \"ation, most of the complexity and business logic will be encapsulated in business entities and a var\", \"iety of services. The ASP.NET Core MVC app itself, with its controllers, filters, viewmodels, and vi\", \"ews, should require few unit tests. Much of the functionality of a given action lies outside the act\", \"ion method itself. Testing whether routing or global error handling work correctly cannot be done ef\", \"fectively with a unit test. Likewise, any filters, including model validation and authentication and\", \" authorization filters, cannot be unit tested with a test targeting a controller's action method. Wi\", \"thout these sources of behavior, most action methods should be trivially small, delegating the bulk \", \"of their work to services that can be tested independent of the controller that uses them.\\n\\nSometime\", \"s you'll need to refactor your code in order to unit test it. Frequently this activity involves iden\", \"tifying abstractions and using dependency injection to access the abstraction in the code you'd like\", \" to test, rather than coding directly against infrastructure. For example, consider this easy action\", \" method for displaying images:\\n\\n```\\n[HttpGet(\\\"[controller]/pic/{id}\\\")] public IActionResult GetImage\", \"(int id) { var contentRoot = _env.ContentRootPath + \\\"//Pics\\\"; var path = Path.Combine(contentRoot, i\", \"d + \\\".png\\\"); Byte[] b = System.IO.File.ReadAllBytes(path); return File(b, \\\"image/png\\\"); }\\n```\\n\\nUnit \", \"testing this method is made difficult by its direct dependency on System.IO.File, which it uses to r\", \"ead from the file system. You can test this behavior to ensure it works as expected, but doing so wi\", \"th real files is an integration test. It's worth noting you can't unit test this method's route-you'\", \"ll see how to do this testing with a functional test shortly.\\n\\nIf you can't unit test the file syste\", \"m behavior directly, and you can't test the route, what is there to test? Well, after refactoring to\", \" make unit testing possible, you may discover some test cases and missing behavior, such as error ha\", \"ndling. What does the method do when a file isn't found? W hat should it do? In this example, the re\", \"factored method looks like this:\\n\\n```\\n[HttpGet(\\\"[controller]/pic/{id}\\\")] public IActionResult GetIma\", \"ge(int id) { byte[] imageBytes; try { imageBytes = _imageService.GetImageBytesById(id); } catch (Cat\", \"alogImageMissingException ex) { _logger.LogWarning($\\\"No image found for id: {id}\\\"); return NotFound(\", \"); }\\n```\\n\\n```\\nreturn File(imageBytes, \\\"image/png\\\"); }\\n```\\n\\n\\\\_logger and \\\\_imageService are both inje\", \"cted as dependencies. Now you can test that the same ID that is passed to the action method is passe\", \"d to \\\\_imageService, and that the resulting bytes are returned as part of the FileResult. You can al\", \"so test that error logging is happening as expected, and that a NotFound result is returned if the i\", \"mage is missing, assuming this behavior is important application behavior (that is, not just tempora\", \"ry code the developer added to diagnose an issue). The actual file logic has moved into a separate i\", \"mplementation service, and has been augmented to return an application-specific exception for the ca\", \"se of a missing file. You can test this implementation independently, using an integration test.\\n\\nIn\", \" most cases, you'll want to use global exception handlers in your controllers, so the amount of logi\", \"c in them should be minimal and probably not worth unit testing. Do most of your testing of controll\", \"er actions using functional tests and the TestServer class described below.\\n\\n## Integration testing \", \"ASP.NET Core apps\\n\\nMost of the integration tests in your ASP.NET Core apps should be testing service\", \"s and other implementation types defined in your Infrastructure project. For example, you could test\", \" that EF Core was successfully updating and retrieving the data that you expect from your data acces\", \"s classes residing in the Infrastructure project. The best way to test that your ASP.NET Core MVC pr\", \"oject is behaving correctly is with functional tests that run against your app running in a test hos\", \"t.\\n\\n## Functional testing ASP.NET Core apps\\n\\nFor ASP.NET Core applications, the TestServer class mak\", \"es functional tests fairly easy to write. You configure a TestServer using a WebHostBuilder (or Host\", \"Builder) directly (as you normally do for your application), or with the WebApplicationFactory type \", \"(available since version 2.1). Try to match your test host to your production host as closely as pos\", \"sible, so your tests exercise behavior similar to what the app will do in production. The WebApplica\", \"tionFactory class is helpful for configuring the TestServ er's ContentRoot, which is used by ASP.NET\", \" Core to locate static resource like Views.\\n\\nYou can create simple functional tests by creating a te\", \"st class that implements IClassFixture&lt;WebApplicationFactory&lt;TEntryPoint&gt;&gt;, where TEntry\", \"Point is your web application's Startup class. With this interface in place, your test fixture can c\", \"reate a clien t using the factory's CreateClient method:\\n\\n```\\npublic class BasicWebTests : IClassFix\", \"ture<WebApplicationFactory<Program>> { protected readonly HttpClient _client; public BasicWebTests(W\", \"ebApplicationFactory<Program> factory) { _client = factory.CreateClient(); }\\n```\\n\\n```\\n// write tests\", \" that use _client\\n```\\n\\n```\\n}\\n```\\n\\n## Tip\\n\\nIf you're using minimal API configuration in your Program.\", \"cs file, by default the class will be declared internal and won't be accessible from the test projec\", \"t. You can choose any other instance class in your web project instead, or add this to your Program.\", \"cs file:\\n\\n]{custom-style=Code}`csharp // Make the implicit Program class public so test projects can\", \" access it public partial class Program { } [`\\n\\nFrequently, you'll want to perform some additional c\", \"onfiguration of your site before each test runs, such as configuring the application to use an in-me\", \"mory data store and then seeding the application with test data. To achieve this functionality, crea\", \"te your own subclass of\\n\\nWebApplicationFactory&lt;TEntryPoint&gt; and override its ConfigureWebHost \", \"method. The example below is from the eShopOnWeb FunctionalTests project and is used as part of the \", \"tests on the main web application.\\n\\n```\\nusing Microsoft.AspNetCore.Hosting; using Microsoft.AspNetCo\", \"re.Identity; using Microsoft.AspNetCore.Mvc.Testing; using Microsoft.EntityFrameworkCore; using Micr\", \"osoft.eShopWeb.Infrastructure.Data; using Microsoft.eShopWeb.Infrastructure.Identity; using Microsof\", \"t.eShopWeb.Web; using Microsoft.Extensions.DependencyInjection; using Microsoft.Extensions.Logging; \", \"using System; namespace Microsoft.eShopWeb.FunctionalTests.Web; public class WebTestFixture : WebApp\", \"licationFactory<Startup> { protected override void ConfigureWebHost(IWebHostBuilder builder) { build\", \"er.UseEnvironment(\\\"Testing\\\"); builder.ConfigureServices(services => { services.AddEntityFrameworkInM\", \"emoryDatabase(); // Create a new service provider. var provider = services .AddEntityFrameworkInMemo\", \"ryDatabase() .BuildServiceProvider(); // Add a database context (ApplicationDbContext) using an in-m\", \"emory // database for testing. services.AddDbContext<CatalogContext>(options => { options.UseInMemor\", \"yDatabase(\\\"InMemoryDbForTesting\\\"); options.UseInternalServiceProvider(provider); }); services.AddDbC\", \"ontext<AppIdentityDbContext>(options => {\\n```\\n\\n```\\noptions.UseInMemoryDatabase(\\\"Identity\\\"); options.\", \"UseInternalServiceProvider(provider); }); // Build the service provider. var sp = services.BuildServ\", \"iceProvider(); // Create a scope to obtain a reference to the database // context (ApplicationDbCont\", \"ext). using (var scope = sp.CreateScope()) { var scopedServices = scope.ServiceProvider; var db = sc\", \"opedServices.GetRequiredService<CatalogContext>(); var loggerFactory = scopedServices.GetRequiredSer\", \"vice<ILoggerFactory>(); var logger = scopedServices .GetRequiredService<ILogger<WebTestFixture>>(); \", \"// Ensure the database is created. db.Database.EnsureCreated(); try { // Seed the database with test\", \" data. CatalogContextSeed.SeedAsync(db, loggerFactory).Wait(); // seed sample user data var userMana\", \"ger = scopedServices.GetRequiredService<UserManager<ApplicationUser>>(); var roleManager = scopedSer\", \"vices.GetRequiredService<RoleManager<IdentityRole>>(); AppIdentityDbContextSeed.SeedAsync(userManage\", \"r, roleManager).Wait(); } catch (Exception ex) { logger.LogError(ex, $\\\"An error occurred seeding the\", \" \\\" + \\\"database with test messages. Error: {ex.Message}\\\"); } } }); } }\\n```\\n\\nTests can make use of thi\", \"s custom WebApplicationFactory by using it to create a client and then making requests to the applic\", \"ation using this client instance. The application will have data seeded that can be used as part of \", \"the test's assertions. The foll owing test verifies that the home page of the eShopOnWeb application\", \" loads correctly and includes a product listing that was added to the application as part of the see\", \"d data.\\n\\n```\\nusing Microsoft.eShopWeb.FunctionalTests.Web; using System.Net.Http; using System.Threa\", \"ding.Tasks; using Xunit; namespace Microsoft.eShopWeb.FunctionalTests.WebRazorPages; [Collection(\\\"Se\", \"quential\\\")] public class HomePageOnGet : IClassFixture<WebTestFixture> { public HomePageOnGet(WebTes\", \"tFixture factory) {\\n```\\n\\n```\\nClient = factory.CreateClient(); } public HttpClient Client { get ; } [\", \"Fact] public async Task ReturnsHomePageWithProductListing() { // Arrange & Act var response = await \", \"Client.GetAsync(\\\"/\\\"); response.EnsureSuccessStatusCode(); var stringResponse = await response.Conten\", \"t.ReadAsStringAsync(); // Assert Assert.Contains(\\\".NET Bot Black Sweatshirt\\\", stringResponse); } }\\n`\", \"``\\n\\nThis functional test exercises the full ASP.NET Core MVC / Razor Pages application stack, includ\", \"ing all middleware, filters, and binders that may be in place. It verifies that a given route ('/') \", \"returns the expected success status code and HTML output. It does so without setting up a real web s\", \"erver, and avoids much of the brittleness that using a real web server for testing can experience (f\", \"or example, problems with firewall settings). Functional tests that run against TestServer are usual\", \"ly slower than integration and unit tests, but are much faster than tests that would run over the ne\", \"twork to a test web server. Use functional tests to ensure your application's front -end stack is wo\", \"rking as expected. These tests are especially useful when you find duplication in your controllers o\", \"r pages and you address the duplication by adding filters. Ideally, this refactoring won't change th\", \"e behavior of the application, and a suite of functional tests will verify this is the case.\\n\\n## Ref\", \"erences -Test ASP.NET Core MVC apps\\n\\n- Testing in ASP.NET Core\\n\\nhttps://learn.microsoft.com/aspnet/c\", \"ore/testing/\\n\\n- \\u2022\\n- Unit Test Naming Convention\\n\\nhttps://ardalis.com/unit-test-naming-convention\\n\\n- \", \"Testing EF Core\\n\\nhttps://learn.microsoft.com/ef/core/miscellaneous/testing/\\n\\n- \\u2022\\n- Integration tests\", \" in ASP.NET Core https://learn.microsoft.com/aspnet/core/test/integration-tests\\n\\n## Development proc\", \"ess for Azure\\n\\n'With the cloud, individuals and small businesses can snap their fingers and instantl\", \"y set up enterpriseclass services.'\\n\\n- Roy Stephan\\n\\n## Vision\\n\\nDevelop well-designed ASP .NET Core a\", \"pplications the way you like, using Visual Studio or the dotnet CLI and Visual Studio Code or your e\", \"ditor of choice.\\n\\n## Development environment for ASP.NET Core apps\\n\\n## Development tools choices: ID\", \"E or editor\\n\\nWhether you prefer a full and powerful IDE or a lightweight and agile editor, Microsoft\", \" has you covered when developing ASP.NET Core applications.\\n\\nVisual Studio 2022. Visual Studio 2022 \", \"is the best-in-class IDE for developing applications for ASP.NET Core. It offers a host of features \", \"that increase developer productivity. You can use it to develop the application, then analyze its pe\", \"rformance and other characteristics. The integrated debugger lets you pause code execution and step \", \"back and forth through code on the fly as it's running. Its support for hot reloads allows you to co\", \"ntinue working with your app where you left off, even after making code changes, without having to r\", \"estart the app. The built-in test runner lets you organize your tests and their results and can even\", \" perform live unit testing while you're coding. Using Live Share, you can collaborate in real-time w\", \"ith other developers, sharing your code session seamlessly over the network. And when you're ready, \", \"Visual Studio includes everything you need to publish your application to Azure or wherever you migh\", \"t host it.\\n\\n## Download Visual Studio 2022\\n\\nVisual Studio Code and dotnet CLI (Cross-Platform Tools \", \"for Mac, Linux, and Windows). If you prefer a lightweight and cross-platform editor supporting any d\", \"evelopment language, you can use Microsoft Visual Studio Code and the dotnet CLI. These products pro\", \"vide a simple yet robust experience that\\n\\nstreamlines the developer workflow. Additionally, Visual S\", \"tudio Code supports extensions for C# and web development, providing intellisense and shortcut-tasks\", \" within the editor.\\n\\nDownload the .NET SDK Download Visual Studio Code\\n\\n## Development workflow for \", \"Azure-hosted ASP.NET Core apps\\n\\nThe application development lifecycle starts from each developer's m\", \"achine, coding the app using their preferred language and testing it locally. Developers may choose \", \"their preferred source control system and can configure Continuous Integration (CI) and/or Continuou\", \"s Delivery/Deployment (CD) using a build server or based on built-in Azure features.\\n\\nTo get started\", \" with developing an ASP.NET Core application using CI/CD, you can use Azure DevOps Services or your \", \"organization's own Team Foundation Server (TFS). GitHub Actions provide another option for easily bu\", \"ilding and deploying apps to Azure, for apps whose code is hosted on GitHub.\\n\\n## Initial setup\\n\\nTo c\", \"reate a release pipeline for your app, you need to have your application code in source control. Set\", \" up a local repository and connect it to a remote repository in a team project. Follow these instruc\", \"tions:\\n\\n- Share your code with Git and Visual Studio or\\n- Share your code with TFVC and Visual Studi\", \"o\\n\\nCreate an Azure App Service where you'll deploy your application. Create a Web App by going to th\", \"e App Services blade on the Azure portal. Click +Add, select the Web App template, click Create, and\", \" provide a name and other details. The web app will be accessible from {name}.azurewebsites.net.\\n\\nMi\", \"crosoft Azure New &gt; Web + Mobile\\n\\nNew\\n\\nMARKETPLACE\\n\\nCompute\\n\\nNetworking\\n\\nStorage\\n\\nWeb + Mobile\\n\\nD\", \"atabases\\n\\nX\\n\\nWeb + Mobile\\n\\nFigure 10-1. Creating a new Azure App Service Web App in the Azure Portal\", \".\\n\\n<!-- image -->\\n\\nYour CI build process will perform an automated build whenever new code is commit\", \"ted to the project's source control repository. This process gives you immediate feedback that the c\", \"ode builds (and, ideally, passes automated tests) and can potentially be deployed. This CI build wil\", \"l produce a web deploy package artifact and publish it for consumption by your CD process.\\n\\n## Defin\", \"e your CI build process\\n\\nBe sure to enable continuous integration so the system will queue a build w\", \"henever someone on your team commits new code. Test the build and verify that it is producing a web \", \"deploy package as one of its artifacts.\\n\\nWhen a build succeeds, your CD process will deploy the resu\", \"lts of your CI build to your Azure web app. To configure this step, you create and configure a Relea\", \"se , which will deploy to your Azure App Service.\\n\\n## Deploy an Azure web app\\n\\nOnce your CI/CD pipel\", \"ine is configured, you can easily make updates to your web app and commit them to source control to \", \"have them deployed.\\n\\n## Workflow for developing Azure-hosted ASP.NET Core applications\\n\\nOnce you hav\", \"e configured your Azure account and your CI/CD process, developing Azure-hosted ASP.NET Core applica\", \"tions is simple. The following are the basic steps you usually take when building an ASP.NET Core ap\", \"p, hosted in Azure App Service as a Web App, as illustrated in Figure 10-2.\\n\\n+\\n\\nSQL\\n\\nCode\\n\\nTest\\n\\nRun\", \"\\n\\nDebug\\n\\nCommit end-to-end development / deployment workflow\\n\\n2\\n\\nApplication\\n\\nCode Repo\\n\\n(SCC)\\n\\nDA\\n\\n\", \"3.\\n\\nBuild, Cl,\\n\\nIntegrate, Test\\n\\nVSTS\\n\\n4.\\n\\nCD, Deploy\\n\\nVSTS\\n\\n5.\\n\\nRun, Manage\\n\\nApp Service\\n\\nWeb App\\n\\n\", \"## Microsoft Azure\\n\\n<!-- image -->\\n\\nCode\\n\\nPush\\n\\nInner-Loop\\n\\nDev Environment\\n\\nFigure 10-2. Step-by-st\", \"ep workflow for building ASP.NET Core apps and hosting them in Azure\\n\\n## Step 1. Local dev environme\", \"nt inner loop\\n\\nDeveloping your ASP.NET Core application for deployment to Azure is no different from\", \" developing your application otherwise. Use the local development environment you're comfortable wit\", \"h, whether that's Visual Studio 2019 or the dotnet CLI and Visual Studi o Code or your preferred edi\", \"tor. You can write code, run and debug your changes, run automated tests, and make local commits to \", \"source control until you're ready to push your changes to your shared source control repository.\\n\\n##\", \" Step 2. Application code repository\\n\\nWhenever you're ready to share your code with your team, you s\", \"hould push your changes from your local source repository to your team's shared source repository. I\", \"f you've been working in a custom branch, this step usually involves merging your code into a shared\", \" branch (perhaps by means of a pull request).\\n\\n## Step 3. Build Server: Continuous integration. buil\", \"d, test, package\\n\\nA new build is triggered on the build server whenever a new commit is made to the \", \"shared application code repository. As part of the CI process, this build should fully compile the a\", \"pplication and run automated tests to confirm everything is working as expected. The end result of t\", \"he CI process should be a packaged version of the web app, ready for deployment.\\n\\n## Step 4. Build S\", \"erver: Continuous delivery\\n\\nOnce a build has succeeded, the CD process will pick up the build artifa\", \"cts produced. This process will include a web deploy package. The build server will deploy this pack\", \"age to Azure App Service,\\n\\nreplacing any existing service with the newly created one. Typically this\", \" step targets a staging environment, but some applications deploy directly to production through a C\", \"D process.\\n\\n## Step 5. Azure App Service Web App\\n\\nOnce deployed, the ASP.NET Core application runs w\", \"ithin the context of an Azure App Service Web App. This Web App can be monitored and further configu\", \"red using the Azure Portal.\\n\\n## Step 6. Production monitoring and diagnostics\\n\\nWhile the Web App is \", \"running, you can monitor the health of the application and collect diagnostics and user behavior dat\", \"a. Application Insights is included in Visual Studio, and offers automatic instrumentation for ASP.N\", \"ET apps. It can provide you with information on usage, exceptions, requests, performance, and logs.\\n\", \"\\n## References\\n\\n## Build and Deploy Your ASP.NET Core App to Azure\\n\\nhttps://learn.microsoft.com/azur\", \"e/devops/build-release/apps/aspnet/build-aspnet-core\\n\\n## Azure hosting recommendations for ASP.NET C\", \"ore web apps\\n\\n'Line -of-business leaders everywhere are bypassing IT departments to get applications\", \" from the cloud (also known as SaaS) and paying for them like they would a magazine subscription. An\", \"d when the service is no longer required, they can cancel the subscription with no equipment left un\", \"used in the corner.'\\n\\n- Daryl Plummer, Gartner analyst\\n\\nWhatever your application's needs and archit\", \"ecture, Microsoft Azure can support it. Your hosting needs can be as simple as a static website or a\", \" sophisticated application made up of dozens of services. For ASP.NET Core monolithic web applicatio\", \"ns and supporting services, there are several well-known configurations that are recommended. The re\", \"commendations on this article are grouped based on the kind of resource to be hosted, whether full a\", \"pplications, individual processes, or data.\\n\\n## Web applications\\n\\nWeb applications can be hosted wit\", \"h:\\n\\n- App Service Web Apps\\n- Containers (several options)\\n- Virtual Machines (VMs)\\n\\nOf these, App Se\", \"rvice Web Apps is the recommended approach for most scenarios, including simple container-based apps\", \". For microservice architectures, consider a container-based approach. If you need more control over\", \" the machines running your application, consider Azure Virtual Machines.\\n\\n## App Service Web Apps\\n\\nA\", \"pp Service Web Apps offers a fully managed platform optimized for hosting web applications. It's a p\", \"latform as a service (PaaS) offering that lets you focus on your business logic, while Azure takes c\", \"are of the infrastructure needed to run and scale the app. Some key features of App Service Web Apps\", \":\\n\\n<!-- image -->\\n\\nExisting\\n\\n.NET applications (on-prem.)\\n\\nMonolithic or N-Tier\\n\\nCloud\\n\\nInfrastructu\", \"re-Ready\\n\\nMonolithic or N-Tier\\n\\nCloud-Optimized\\n\\nExisting .NET apps\\n\\nMonolithic or N-Tier\\n\\n- DevOps \", \"optimization (continuous integration and delivery, multiple environments, A/B testing, scripting sup\", \"port).\\n\\nMVC\\n\\n- Global scale and high availability.\\n\\nAzure Container Instance\\n\\n- Connections to SaaS \", \"platforms and your on-premises data.\\n\\nSignalR\\n\\n- Security and compliance.\\n- Visual Studio integratio\", \"n.\\n\\nWCF\\n\\nTools (Puppet, Chef, etc.)\\n\\nAzure App Service is the best choice for most web apps. Deploym\", \"ent and management are integrated into the platform, sites can scale quickly to handle high traffic \", \"loads, and the built-in load balancing and traffic manager provide high availability. You can move e\", \"xisting sites to Azure App Service easily with an online migration tool. You can use an open-source \", \"app from the Web Application Gallery, or create a new site using the framework and tools of your cho\", \"ice. The WebJobs feature makes it easy to add background job processing to your App Service web app.\", \" If you have an existing ASP.NET application hosted onpremises using a local database, there's a cle\", \"ar path to migrate. You can use App Service Web App with an Azure SQL Database (or secure access to \", \"your on-premises database server, if preferred). Migrate / Rehost Modernize\\n\\n<!-- image -->\\n\\nIn most\", \" cases, moving from a locally hosted ASP.NET app to an App Service Web App is a straightforward proc\", \"ess. Little or no modification should be required of the app itself, and it can quickly start to tak\", \"e advantage of the many features that Azure App Service Web Apps offer.\\n\\nWindows Containers\\n\\nOn VMs\\n\", \"\\nAzure SQL DB\\n\\nA\\n\\nAzure Active\\n\\nDirectory\\n\\nInternet\\n\\nDNS:\\n\\nAzure DNS\\n\\nApp Service plan\\n\\nAzure SQL Da\", \"tabase\\n\\nSQL\\n\\nIn addition to apps that are not optimized for the cloud, Azure App Service Web Apps ar\", \"e an excellent solution for many simple monolithic (non-distributed) applications, such as many ASP.\", \"NET Core apps. In this approach, the architecture is basic and simple to understand and manage:\\n\\n<!-\", \"- image -->\\n\\nA small number of resources in a single resource group is typically sufficient to manag\", \"e such an app. Apps that are typically deployed as a single unit, rather than those apps that are ma\", \"de up of many separate processes, are good candidates for this basic architectural approach. Though \", \"architecturally simple, this approach still allows the hosted app to scale both up (more resources p\", \"er node) and out (more hosted nodes) to meet any increase in demand. With autoscale, the app can be \", \"configured to automatically adjust the number of nodes hosting the app based on demand and average l\", \"oad across nodes.\\n\\n## App Service Web Apps for Containers\\n\\nIn addition to support for hosting web ap\", \"ps directly, App Service Web Apps for Containers can be used to run containerized applications on Wi\", \"ndows and Linux. Using this service, you can easily deploy and run containerized applications that c\", \"an scale with your business. The apps have all of the features of App Service Web Apps listed above.\", \" In addition, Web Apps for Containers supports streamlined CI/CD with Docker Hub, Azure Container Re\", \"gistry, and GitHub. You can use Azure DevOps to define build and deployment pipelines that publish c\", \"hanges to a registry. These changes can then be tested in a staging environment and automatically de\", \"ployed to production using deployment slots, allowing zero-downtime upgrades. Rolling back to previo\", \"us versions can be done just as easily.\\n\\nThere are a few scenarios where Web Apps for Containers mak\", \"es the most sense. If you have existing apps that you can containerize, whether in Windows or Linux \", \"containers, you can host these easily using this toolset. Just publish your container and then confi\", \"gure Web Apps for Containers to pull the latest version of that image from your registry of choice. \", \"This is a 'lift and shift' approach to migrating from classic app hosting models to a cloud-optimize\", \"d model.\\n\\nExisting\\n\\n.NET applications (on-prem.)\\n\\nMonolithic or N-Tier\\n\\nASP.NET\\n\\nMVC\\n\\nvveDrons\\n\\nWeb \", \"API\\n\\nSignalR\\n\\nWeb Pages\\n\\nWCF\\n\\nRelational Database\\n\\n(SQL, Oracle, MySQL, etc.)\\n\\nMicrosoft\\n\\nCloud\\n\\nInf\", \"rastructure-Ready\\n\\nMonolithic or N-Tier\\n\\nCloud-Optimized\\n\\nExisting NET apps\\n\\nMonolithic or N-Tier\\n\\n<\", \"!-- image -->\\n\\n.NET\\n\\nThis approach also works well if your development team is able to move to a con\", \"tainer-based development process. The 'inner loop' of developing apps with containers includes build\", \"ing the app with containers. Changes made to the code as well as to container configuration are push\", \"ed to source control, and an automated build is responsible for publishing new container images to a\", \" registry like Docker Hub or Azure Container Registry. These images are then used as the basis for a\", \"dditional development, as well as for deployments to production, as shown in the following diagram:\\n\", \"\\nEnd to End Docker DevOps Lifecycle Workflow\\n\\n4.\\n\\nCD, deploy\\n\\nBuild, Cl,\\n\\n5.\\n\\nRun, manage\\n\\n## integr\", \"ate, test Microsoft\\n\\nAzure DevOps\\n\\nAzure\\n\\nAzure DevOps\\n\\n<!-- image -->\\n\\n2\\n\\nApplication code repo\\n\\n(S\", \"CC)\\n\\nCode\\n\\nPush\\n\\nInner loop\\n\\nDev environment\\n\\nDeveloping with containers offers many advantages, esp\", \"ecially when containers are used in production. The same container configuration is used to host the\", \" app in each environment in which it runs, from the local development machine to build and test syst\", \"ems to production. This approach greatly reduces the likelihood of defects resulting from difference\", \"s in machine configuration or software versions. Developers can also use whatever tools they're most\", \" productive with, including the operating system, since containers can run on any OS. In some cases,\", \" distributed applications involving many containers may be very resource-intensive to run on a singl\", \"e development machine. In this scenario, it may make sense to upgrade to using Kubernetes and Azure \", \"Dev Spaces, covered in the next section.\\n\\nAs portions of larger applications are broken up into thei\", \"r own smaller, independent microservices , additional design patterns can be used to improve app beh\", \"avior. Instead of working directly with individual services, an API gateway can simplify access and \", \"decouple the client from its back end. Having separate service back ends for different front ends al\", \"so allows services to evolve in concert with their consumers. Common services can be accessed via a \", \"separate sidecar container, which might include common client connectivity libraries using the ambas\", \"sador pattern.\\n\\nAzure\\n\\nWeb Apps for\\n\\nContainers\\n\\nCode, run,\\n\\ndebug\\n\\nClient application\\n\\nStrangler\\n\\nA\", \"PI Gateway\\n\\nGateway\\n\\nRouting\\n\\nMicroservices application\\n\\nBackends for\\n\\nFrontends\\n\\nMicroservice for d\", \"esktop\\n\\nRemote service\\n\\n<!-- image -->\\n\\nLearn more about design patterns to consider when building m\", \"icroservice-based systems.\\n\\n## Azure Kubernetes Service\\n\\nAzure Kubernetes Service (AKS) manages your\", \" hosted Kubernetes environment, making it quick and easy to deploy and manage containerized applicat\", \"ions without container orchestration expertise. It also eliminates the burden of ongoing operations \", \"and maintenance by provisioning, upgrading, and scaling resources on-demand, without taking your app\", \"lications offline.\\n\\nAKS reduces the complexity and operational overhead of managing a Kubernetes clu\", \"ster by offloading much of that responsibility to Azure. As a hosted Kubernetes service, Azure handl\", \"es critical tasks like health monitoring and maintenance for you. Also, you pay only for the agent n\", \"odes within your clusters, not for the masters. As a managed Kubernetes service, AKS provides:\\n\\n- Au\", \"tomated Kubernetes version upgrades and patching.\\n- Easy cluster scaling.\\n- Self-healing hosted cont\", \"rol plane (masters).\\n- Cost savings - pay only for running agent pool nodes.\\n\\nWith Azure handling th\", \"e management of the nodes in your AKS cluster, you no longer need to perform many tasks manually, li\", \"ke cluster upgrades. Because Azure handles these critical maintenance tasks for you, AKS doesn't pro\", \"vide direct access (such as with S SH) to the cluster.\\n\\nTeams who are leveraging AKS can also take a\", \"dvantage of Azure Dev Spaces. Azure Dev Spaces helps teams to focus on the development and rapid ite\", \"ration of their microservice application by allowing teams to work directly with their entire micros\", \"ervices architecture or application running in AKS. Azure Dev Spaces also provides a way to independ\", \"ently update portions of your microservices architecture in isolation without affecting the rest of \", \"the AKS cluster or other developers.\\n\\nGateway\\n\\nSidecar\\n\\nAmbassador\\n\\nhttp://dev.myapp.eus.azds.io bik\", \"esharingweb\\n\\n<!-- image -->\\n\\n## Azure Dev Spaces:\\n\\n- Minimize local machine setup time and resource \", \"requirements\\n- Allow teams to iterate more rapidly\\n- Reduce the number of integration environments r\", \"equired by a team\\n- Remove the need to mock certain services in a distributed system when developing\", \"/testing\\n\\n## Learn more about Azure Dev Spaces\\n\\n## Azure Virtual Machines\\n\\nIf you have an existing a\", \"pplication that would require substantial modifications to run in App Service, you could choose Virt\", \"ual Machines in order to simplify migrating to the cloud. However, correctly configuring, securing, \", \"and maintaining VMs requires much more time and IT expertise compared to Azure App Ser vice. If you'\", \"re considering Azure Virtual Machines, make sure you take into account the ongoing maintenance effor\", \"t required to patch, update, and manage your VM environment. Azure Virtual Machines is infrastructur\", \"e as a service (IaaS), while App Service is PaaS. You should also consider whether deploying your ap\", \"p as a Windows Container to Web App for Containers might be a viable option for your scenario.\\n\\n## L\", \"ogical processes\\n\\nIndividual logical processes that can be decoupled from the rest of the applicatio\", \"n may be deployed independently to Azure Functions in a 'serverless' manner. Azure Functions lets yo\", \"u just write the code you need for a given problem, without worrying about the application or infras\", \"tructure to run it. You can choose from a variety of programming languages, including C#, F#, Node.j\", \"s, Python, and PHP, allowing you to pick the most productive language for the task at hand. Like mos\", \"t cloud-based solutions, you pay only for the amount of time your use, and you can trust Azure Funct\", \"ions to scale up as needed.\\n\\n## Data\\n\\nAzure offers a wide variety of data storage options, so that y\", \"our application can use the appropriate data provider for the data in question.\\n\\nBrowser\\n\\nSitecore C\", \"ontent\\n\\nFor transactional, relational data, Azure SQL Databases are the best option. For high perfor\", \"mance read-mostly data, a Redis cache backed by an Azure SQL Database is a good solution.\\n\\non Azure \", \"SQL\\n\\non Azure SQL\\n\\nUnstructured JSON data can be stored in a variety of ways, from SQL Database colu\", \"mns to Blobs or Tables in Azure Storage, to Azure Cosmos DB. Of these, Azure Cosmos DB offers the be\", \"st querying functionality, and is the recommended option for large numbers of JSON-based documents t\", \"hat must support querying.\\n\\nTransient command- or event-based data used to orchestrate application b\", \"ehavior can use Azure Service Bus or Azure Storage Queues. Azure Service Bus offers more flexibility\", \" and is the recommended service for non-trivial messaging within and between applications.\\n\\n## Archi\", \"tecture recommendations\\n\\nYour application's requirements should dictate its architecture. There are \", \"many different Azure services available. Choosing the right one is an important decision. Microsoft \", \"offers a gallery of reference architectures to help identify typical architectures optimized for com\", \"mon scenarios. You may find a reference architecture that map s closely to your application's requir\", \"ements, or at least offers a starting point.\\n\\nFigure 11-1 shows an example reference architecture. T\", \"his diagram describes a recommended architecture approach for a Sitecore content management system w\", \"ebsite optimized for marketing.\\n\\nFigure 11-1. Sitecore marketing website reference architecture.\\n\\n<!\", \"-- image -->\\n\\n## References -Azure hosting recommendations\\n\\n- Azure Solution Architectures https://a\", \"zure.microsoft.com/solutions/architecture/\\n\\n- Azure Basic Web Application Architecture https://learn\", \".microsoft.com/azure/architecture/reference-architectures/app-service-webapp/basic-web-app\\n- Design \", \"Patterns for Microservices https://learn.microsoft.com/azure/architecture/microservices/design/patte\", \"rns\\n- Azure Developer Guide https://azure.microsoft.com/campaigns/developer-guide/\\n- Web Apps overvi\", \"ew https://learn.microsoft.com/azure/app-service/app-service-web-overview\\n- Web App for Containers h\", \"ttps://azure.microsoft.com/services/app-service/containers/\\n- Introduction to Azure Kubernetes Servi\", \"ce (AKS) https://learn.microsoft.com/azure/aks/intro-kubernetes\"]"