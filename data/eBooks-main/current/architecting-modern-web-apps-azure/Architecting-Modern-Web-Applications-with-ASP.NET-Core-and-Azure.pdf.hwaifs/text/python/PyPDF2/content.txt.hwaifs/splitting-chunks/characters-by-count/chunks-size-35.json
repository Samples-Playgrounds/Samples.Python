"[\" \\n  \\nEDITION v8.0  - Updated to ASP.NET Core 8.0  \\nRefer changelog  for the book updates and communi\", \"ty contributions.  \\nPUBLISHED BY  \\nMicrosoft Developer Division, .NET, and Visual Studio product tea\", \"ms  \\nA division of Microsoft Corporation  \\nOne Microsoft Way  \\nRedmond, Washington 98052 -6399  \\nCop\", \"yright \\u00a9 2023 by Microsoft Corporation  \\nAll rights reserved. No part of the contents of this book m\", \"ay be reproduced or transmitted in any \\nform or by any means without the written permission of the p\", \"ublisher.  \\nThis book is provided \\u201cas -is\\u201d and expresses the author\\u2019s views and opinions. The views,\", \" opinions, and \\ninformation expressed in this book, including URL and other Internet website referen\", \"ces, may change \\nwithout notice.  \\nSome examples depicted herein are provided for illustration only \", \"and are fictitious. No real association \\nor connection is intended or should be inferred.  \\nMicrosof\", \"t and the trademarks listed at https://www.microsoft.com  on the \\u201cTrademarks\\u201d webpage are \\ntrademark\", \"s of the Microsoft group of companies.  \\nMac and macOS are trademarks of Apple Inc.  \\nThe Docker wha\", \"le logo is a registered trademark of Docker, Inc.  Used by permission.  \\nAll other marks and logos a\", \"re property of their respective owners.  \\nAuthor:  \\nSteve \\u201cardalis\\u201d Smith  - Software Architect and \", \"Trainer - Ardalis.com  \\nEditors:  \\nMaira Wenzel  \\nAction links  \\n\\u2022 This e -book is also available in\", \" a PDF format (English version only) Download  \\n\\u2022 Clone/Fork the reference application eShopOnWeb on\", \" GitHub  \\nIntroduction  \\n.NET 8 and ASP.NET Core offer several advantages over traditional .NET deve\", \"lopment. You should use \\n.NET 8 for your server applications if some or all of the following are imp\", \"ortant to your application\\u2019s \\nsuccess:  \\n\\u2022 Cross -platform support.  \\u2022 Use of microservices.  \\n\\u2022 Use\", \" of Docker containers.  \\n\\u2022 High performance and scalability requirements.  \\n\\u2022 Side-by-side versionin\", \"g of .NET versions by application on the same server.  \\nTraditional .NET 4.x apps can and do support\", \" many of these requirements, but ASP.NET Core and .NET \\n8 have been optimized to offer improved supp\", \"ort for the above scenarios.  \\nMore and more organizations are choosing to host their web applicatio\", \"ns in the cloud using services \\nlike Microsoft Azure. You should consider hosting your application i\", \"n the cloud if the following are \\nimportant to your application or organization:  \\n\\u2022 Reduced investm\", \"ent in data center costs (hardware, software, space, utilities, server \\nmanagement, etc.)  \\n\\u2022 Flexib\", \"le pricing (pay based on usage, not for idle capacity).  \\n\\u2022 Extreme reliability.  \\n\\u2022 Improved app mo\", \"bility; easily change where and how your app is deployed.  \\n\\u2022 Flexible capacity; scale up or down ba\", \"sed on actual needs.  \\nBuilding web applications with ASP.NET Core, hosted in Azure, offers many com\", \"petitive advantages \\nover traditional alternatives. ASP.NET Core is optimized for modern web applica\", \"tion development \\npractices and cloud hosting scenarios. In this guide, you\\u2019ll le arn how to archite\", \"ct your ASP.NET Core \\napplications to best take advantage of these capabilities.  \\nVersion  \\nThis gu\", \"ide has been revised to cover .NET 8.0  version along with many additional updates related to \\nthe s\", \"ame \\u201cwave\\u201d of technologies (that is, Azure and additional third -party technologies) coinciding in \\n\", \"time with the .NET 8.0 release. That\\u2019s why the book version has also been updated to version 8.0. \\nP\", \"urpose  \\nThis guide provides end -to-end guidance on building monolithic  web applications using ASP\", \".NET \\nCore and Azure. In this context, \\u201cmonolithic\\u201d refers to the fact that these applications are d\", \"eployed as \\na single unit, not as a collection of interacting services and applications. In some con\", \"texts, the term \\nmonolith  may be used as a pejorative, but in the vast majority of situations a sin\", \"gle application is \\nmuch easier to build, deploy, and debug than an app composed of many different s\", \"ervices, while still \\nachievi ng the business requirements.  \\nThis guide is complementary to \\u201c.NET M\", \"icroservices. Architecture for Containerized .NET Applications \\u201d, \\nwhich focuses more on Docker, mic\", \"roservices, and deployment of containers to host enterprise \\napplications.  .NET Microservices. Arch\", \"itecture for Containerized .NET Applications  \\n\\u2022 e-book  \\nhttps://aka.ms/MicroservicesEbook  \\n\\u2022 Samp\", \"le Application  \\nhttps://aka.ms/microservicesarchitecture  \\nWho should use this guide  \\nThe audience\", \" for this guide is mainly developers, development leads, and architects who are \\ninterested in build\", \"ing modern web applications using Microsoft technologies and services in the \\ncloud.  \\nA secondary a\", \"udience is technical decision makers who are already familiar ASP.NET or Azure and are \\nlooking for \", \"information on whether it makes sense to upgrade to ASP.NET Core for new or existing \\nprojects.  \\nHo\", \"w you can use this guide  \\nThis guide has been condensed into a relatively small document that focus\", \"es on building web \\napplications with modern .NET technologies and Azure. As such, it can be read in\", \" its entirety to \\nprovide a foundation of understanding such applications and their t echnical consi\", \"derations. The \\nguide, along with its sample application, can also serve as a starting point or refe\", \"rence. Use the \\nassociated sample application as a template for your own applications, or to see how\", \" you might \\norganize your application\\u2019s compo nent parts. Refer back to the guide\\u2019s principles and c\", \"overage of \\narchitecture and technology options and decision considerations when you\\u2019re weighing the\", \"se choices \\nfor your own application.  \\nFeel free to forward this guide to your team to help ensure \", \"a common understanding of these \\nconsiderations and opportunities. Having everybody working from a c\", \"ommon set of terminology and \\nunderlying principles helps ensure consistent application of archite c\", \"tural patterns and practices.  \\nReferences  \\n\\u2022 Choosing between .NET and .NET Framework for server a\", \"pps  \\nhttps://learn.microsoft.com/dotnet/standard/choosing -core-framework -server   \\ni Contents   \\n\", \"Contents  \\nCharacteristics of Modern Web Applications  ................................ ............\", \".................... ....... 1 \\nReference application: eShopOnWeb  ................................ \", \"................................ ................................ ..............................  1 \", \"\\nReference Application  ................................ ................................ ..........\", \"...................... ................................ .......................  2 \\nCloud -hosted an\", \"d scalable  ................................ ................................ ......................\", \".......... ................................ ..................  2 \\nCross platform  .................\", \"............... ................................ ................................ ..................\", \".............. ................................ ...........  2 \\nModular and loosely coupled  .......\", \"......................... ................................ ................................ ........\", \"........................ .............  3 \\nEasily tested with automated tests  .....................\", \"........... ................................ ................................ ......................\", \".......... ... 3 \\nTraditional and SPA behaviors supported  ................................ ........\", \"........................ ................................ .....................  3 \\nSimple developme\", \"nt and deployment  ................................ ................................ ...............\", \"................. ............................  4 \\nTraditional ASP.NET and Web Forms  ..............\", \".................. ................................ ................................ ...............\", \"................  4 \\nBlazor  ................................ ................................ .....\", \"........................... ................................ ................................ ......\", \"......................  4 \\nReferences \\u2013 Modern Web Applications  ................................ ..\", \".............................. ................................ ...................  4 \\nChoose Betwe\", \"en Traditional Web Apps and Single Page Apps (SPAs)  .............................  6 \\nBlazor  .....\", \"........................... ................................ ................................ ......\", \".......................... ................................ ............................  7 \\nWhen to\", \" choose traditional web apps  ................................ ................................ ....\", \"............................ ............................  7 \\nWhen to choose SPAs  .................\", \"............... ................................ ................................ ..................\", \".............. ............................  8 \\nReferences \\u2013 SPA Frameworks  .......................\", \"......... ................................ ................................ ........................\", \"........ ....... 8 \\nWhen to choose Blazor  ................................ ........................\", \"........ ................................ ................................ .........................\", \"  9 \\nDecision table  ................................ ................................ .............\", \"................... ................................ ................................ ............  \", \"9 \\nOther considerations  ................................ ................................ .........\", \"....................... ................................ ..............................  9 \\nArchitec\", \"tural principles  ................................ ................................ ................\", \"................ .........  11 \\nCommon design principles  ................................ .........\", \"....................... ................................ ................................ ..........\", \".....  11 \\nSeparation of concerns  ................................ ................................\", \" ................................ ................................ ..................  11 \\nEncapsula\", \"tion  ................................ ................................ ............................\", \".... ................................ ................................ ..... 11 \\nDependency inversio\", \"n  ................................ ................................ ...............................\", \". ................................ ....................  12 \\nExplicit dependencies  ................\", \"................ ................................ ................................ .................\", \"............... .....................  14 \\nSingle responsibility  ................................ .\", \"............................... ................................ ................................ ..\", \"......................  14 \\nDon\\u2019t repeat yourself (DRY)  ................................ ..........\", \"...................... ................................ ................................ ......... 1\", \"5  \\nii Contents  Persistence ignorance  ................................ ...........................\", \"..... ................................ ................................ ....................  15 \\nBo\", \"unded contexts  ................................ ................................ ..................\", \".............. ................................ ............................  16 \\nAdditional resourc\", \"es  ................................ ................................ ..............................\", \".. ................................ ............................  16 \\nCommon web application archite\", \"ctures  ................................ ................................ .............  17 \\nWhat is\", \" a monolithic application?  ................................ ................................ ......\", \".......................... ................................ .. 17 \\nAll-in-one applications  ........\", \"........................ ................................ ................................ .........\", \"....................... .......................  17 \\nWhat are layers?  .............................\", \"... ................................ ................................ ..............................\", \".. ................................ .... 18 \\nTraditional \\u201cN -Layer\\u201d architecture applications  .....\", \"........................... ................................ ................................ ......\", \".. 19 \\nClean architecture  ................................ ................................ .......\", \"......................... ................................ ................................ . 23 \\nOr\", \"ganizing code in Clean Architecture  ................................ ..............................\", \".. ................................ ...................  28 \\nMonolithic applications and containers \", \" ................................ ................................ ................................ \", \".......................  30 \\nMonolithic application deployed as a container  .......................\", \"......... ................................ ................................ . 31 \\nDocker support  ..\", \".............................. ................................ ................................ ...\", \"............................. ................................ ...... 33 \\nTroubleshooting Docker pro\", \"blems  ................................ ................................ ...........................\", \"..... ...........................  34 \\nOther web application architectural styles  .................\", \"............... ................................ ................................ .............  34 \", \"\\nReferences \\u2013 Common web architectures  ................................ ...........................\", \"..... ................................ ..............  34 \\nCommon client -side web technologies  ...\", \"............................. ................................ ...............  36 \\nHTML  ..........\", \"...................... ................................ ................................ ...........\", \"..................... ................................ ..........................  36 \\nCSS .........\", \"....................... ................................ ................................ ..........\", \"...................... ................................ ..............................  36 \\nCSS prep\", \"rocessors  ................................ ................................ .......................\", \"......... ................................ ...........................  37 \\nJavaScript  ............\", \".................... ................................ ................................ .............\", \"................... ................................ .................  38 \\nLegacy web apps with jQu\", \"ery  ................................ ................................ .............................\", \"... ................................ ..... 38 \\njQuery vs a SPA Framework  ..........................\", \"...... ................................ ................................ ...........................\", \"..... ......... 38 \\nAngular SPAs  ................................ ................................ \", \"................................ ................................ ................................ .\", \"..... 39 \\nReact  ................................ ................................ .................\", \"............... ................................ ................................ ..................\", \"....  40 \\nVue ................................ ................................ ....................\", \"............ ................................ ................................ .....................\", \"....  40 \\nBlazor WebAssembly  ................................ ................................ ....\", \"............................ ................................ ......................  41 \\nChoosing a\", \" SPA Framework  ................................ ................................ ..................\", \".............. ................................ ......... 41 \\nReferences \\u2013 Client Web Technologies  \", \"................................ ................................ ................................ .\", \"..................  42 \\nDevelop ASP.NET Core MVC apps  ................................ ............\", \".................... .......................  43 \\nMVC and Razor Pages  .............................\", \"... ................................ ................................ ..............................\", \".. .........................  43  \\niii Contents  Why Razor Pages? ................................ .\", \"............................... ................................ ................................ ..\", \"..........................  44 \\nWhen to use MVC  ................................ ..................\", \".............. ................................ ................................ ...................\", \".........  44 \\nMapping requests to responses  ................................ .....................\", \"........... ................................ ................................ ..... 44 \\nKeeping cont\", \"rollers under control  ................................ ................................ ...........\", \"..................... ............................  46 \\nReferences \\u2013 Mapping Requests to Responses  \", \"................................ ................................ ................................ .\", \".. 48 \\nWorking with dependencies  ................................ ................................ \", \"................................ ................................ .............  48 \\nDeclare your de\", \"pendencies  ................................ ................................ ......................\", \".......... ................................ ..........  49 \\nStructuring the application  ...........\", \"..................... ................................ ................................ ............\", \".................... ...............  50 \\nFeature organization  ................................ ...\", \"............................. ................................ ................................ ....\", \"...................  51 \\nAPIs and Blazor applications  ................................ ............\", \".................... ................................ ................................ ........ 53 \\n\", \"Cross -cutting concerns  ................................ ................................ .........\", \"....................... ................................ ..................  54 \\nReferences \\u2013 Struct\", \"uring applications  ................................ ................................ ..............\", \".................. .....................  57 \\nSecurity  ................................ ...........\", \"..................... ................................ ................................ ............\", \".................... .....................  57 \\nIdentity  ................................ .........\", \"....................... ................................ ................................ ..........\", \"...................... .................  57 \\nAuthentication  ................................ .....\", \"........................... ................................ ................................ ......\", \".......................... ... 60 \\nReferences \\u2013 Authentication  ................................ ...\", \"............................. ................................ ................................ ....\", \".... 61 \\nAuthorization  ................................ ................................ ..........\", \"...................... ................................ ................................ ..... 61 \\nR\", \"eferences \\u2013 Security  ................................ ................................ ............\", \".................... ................................ ......................  64 \\nClient communicati\", \"on  ................................ ................................ ..............................\", \".. ................................ .........................  64 \\nReferences \\u2013 Client Communication\", \"  ................................ ................................ ................................\", \" ........................  65 \\nDomain -driven design \\u2013 Should you apply it?  .......................\", \"......... ................................ ................................ ..........  65 \\nWhen sho\", \"uld you apply DDD  ................................ ................................ ...............\", \"................. ................................ ...... 66 \\nWhen shouldn\\u2019t you apply DDD  ........\", \"........................ ................................ ................................ .........\", \".......................  66 \\nReferences \\u2013 Domain -Driven Design  ................................ ..\", \".............................. ................................ .......................  67 \\nDeploym\", \"ent  ................................ ................................ .............................\", \"... ................................ ................................ .............  67 \\nReferences \", \"\\u2013 Deployment  ................................ ................................ ....................\", \"............ ................................ .............  68 \\nWorking with Data in ASP.NET Core A\", \"pps  ................................ ................................ .........  69 \\nEntity Framewo\", \"rk Core (for relational databases)  ................................ ...............................\", \". ................................ .... 69 \\nThe DbContext  ................................ ........\", \"........................ ................................ ................................ .........\", \"....................... .. 69 \\nConfiguring EF Core  ................................ ...............\", \"................. ................................ ................................ ................\", \"........  70 \\nFetching and storing Data  ................................ ..........................\", \"...... ................................ ................................ ............  71 \\nFetching \", \"related data  ................................ ................................ ....................\", \"............ ................................ ......................  72  \\niv Contents  Encapsulatin\", \"g data  ................................ ................................ ..........................\", \"...... ................................ ..........................  73 \\nResilient connections  .....\", \"........................... ................................ ................................ ......\", \".......................... ......................  74 \\nReferences \\u2013 Entity Framework Core  .........\", \"....................... ................................ ................................ ..........\", \"..............  76 \\nEF Core or micro -ORM?  ................................ .......................\", \"......... ................................ ................................ .....................  7\", \"6 \\nSQL or NoSQL  ................................ ................................ .................\", \"............... ................................ ................................ ........ 77 \\nAzure\", \" Cosmos DB  ................................ ................................ ......................\", \".......... ................................ ................................ . 78 \\nOther persistence\", \" options  ................................ ................................ ........................\", \"........ ................................ .................  79 \\nCaching  ..........................\", \"...... ................................ ................................ ...........................\", \"..... ................................ .....................  80 \\nASP.NET Core response caching  ...\", \"............................. ................................ ................................ ....\", \"............................  80 \\nData caching  ................................ ...................\", \"............. ................................ ................................ ....................\", \"............ ...... 81 \\nGetting data to Blazor WebAssembly apps  ................................ ..\", \".............................. ................................ ................  83 \\nTest ASP.NET C\", \"ore MVC apps  ................................ ................................ ....................\", \"..........  85 \\nKinds of automated tests  ................................ .........................\", \"....... ................................ ................................ ...................  85 \\nU\", \"nit tests  ................................ ................................ .......................\", \"......... ................................ ................................ ..............  85 \\nInte\", \"gration tests  ................................ ................................ ...................\", \"............. ................................ ................................  85 \\nFunctional test\", \"s  ................................ ................................ ...............................\", \". ................................ ................................ . 86 \\nTesting Pyramid  .........\", \"....................... ................................ ................................ ..........\", \"...................... ................................  86 \\nWhat to test  .........................\", \"....... ................................ ................................ ..........................\", \"...... ................................ ........ 87 \\nOrganizing test projects  .....................\", \"........... ................................ ................................ ......................\", \".......... .....................  88 \\nTest naming  ................................ ................\", \"................ ................................ ................................ .................\", \"............... ........ 89 \\nUnit testing ASP.NET Core apps  ................................ ......\", \".......................... ................................ ................................ ..... 9\", \"1 \\nIntegration testing ASP.NET Core apps  ................................ .........................\", \"....... ................................ .......................  92 \\nFunctional testing ASP.NET Cor\", \"e apps  ................................ ................................ ..........................\", \"...... .........................  92 \\nReferences \\u2013 Test ASP.NET Core MVC apps  .....................\", \"........... ................................ ................................ ..........  95 \\nDevelo\", \"pment process for Azure  ................................ ................................ .........\", \".................  96 \\nVision  ................................ ................................ ...\", \"............................. ................................ ................................ ....\", \".....................  96 \\nDevelopment environment for ASP.NET Core apps  ..........................\", \"...... ................................ ...............................  96 \\nDevelopment tools choic\", \"es: IDE or editor  ................................ ................................ ...............\", \"................. ..............  96 \\nDevelopment workflow for Azure -hosted ASP.NET Core apps  ....\", \"............................ ................................ ..........  97 \\nInitial setup  .......\", \"......................... ................................ ................................ ........\", \"........................ ................................ ......... 97 \\nWorkflow for developing Azur\", \"e -hosted ASP.NET Core applications  ................................ ..........................  98\", \" \\nReferences  ................................ ................................ ....................\", \"............ ................................ ................................ .............  100  \\n\", \"v Contents  Azure hosting recommendations for ASP.NET Core web apps  ...............................\", \". ...... 101 \\nWeb applications  ................................ ................................ ..\", \".............................. ................................ ................................  10\", \"1 \\nApp Service Web Apps  ................................ ................................ .........\", \"....................... ................................ ................  101 \\nApp Service Web Apps\", \" for Containers  ................................ ................................ .................\", \"............... ..................  103 \\nAzure Kubernetes Service  ................................ \", \"................................ ................................ ................................ .\", \"..........  106 \\nAzure Virtual Machines  ................................ ..........................\", \"...... ................................ ................................ ................  107 \\nLogi\", \"cal processes  ................................ ................................ ...................\", \"............. ................................ ................................  107 \\nData  ........\", \"........................ ................................ ................................ .........\", \"....................... ................................ ..........................  107 \\nArchitectu\", \"re recommendations  ................................ ................................ ..............\", \".................. ................................ ..... 108  \\n1 CHAPTER 1 | Characteristics of Mod\", \"ern Web Applications  \\n CHAPTER  1 \\nCharacteristics of Modern \\nWeb Applications  \\n\\u201c\\u2026 with proper des\", \"ign, the features come cheaply. This approach is arduous, but continues to \\nsucceed.\\u201d  \\n- Dennis Rit\", \"chie  \\nModern web applications have higher user expectations and greater demands than ever before. \\n\", \"Today\\u2019s web apps are expected to be available 24/7 from anywhere in the world, and usable from \\nvirt\", \"ually any device or screen size. Web applications must be secure,  flexible, and scalable to meet \\ns\", \"pikes in demand. Increasingly, complex scenarios should be handled by rich user experiences built on\", \" \\nthe client using JavaScript, and communicating efficiently through web APIs.  \\nASP.NET Core is opt\", \"imized for modern web applications and cloud -based hosting scenarios. Its \\nmodular design enables a\", \"pplications to depend on only those features they actually use, improving \\napplication security and \", \"performance while reducing hosting resou rce requirements.  \\nReference application: eShopOnWeb  \\nThi\", \"s guidance includes a reference application, eShopOnWeb , that demonstrates some of the \\nprinciples \", \"and recommendations. The application is a simple online store, which supports browsing \\nthrough a ca\", \"talog of shirts, coffee mugs, and other marketing items. The reference application is \\ndeliberately \", \"simple in order  to make it easy to understand.   \\n2 CHAPTER 1 | Characteristics of Modern Web Appli\", \"cations  \\n  \\nFigure 2 -1. eShopOnWeb  \\nReference Application  \\n\\u2022 eShopOnWeb  \\nhttps://github.com/dot\", \"net/eShopOnWeb  \\nCloud -hosted and scalable  \\nASP.NET Core is optimized for the cloud (public cloud,\", \" private cloud, any cloud) because it is low -\\nmemory and high-throughput. The smaller footprint of \", \"ASP.NET Core applications means you can \\nhost more of them on the same hardware, and you pay for few\", \"er resources when using pay -as-you-\\ngo cloud hosting services. The higher -throughput means you can\", \" serve more custom ers from an \\napplication given the same hardware, further reducing the need to in\", \"vest in servers and hosting \\ninfrastructure.  \\nCross platform  \\nASP.NET Core is cross -platform and \", \"can run on Linux, macOS, and Windows. This capability opens up \\nmany new options for both the develo\", \"pment and deployment of apps built with ASP.NET Core. \\n \\n3 CHAPTER 1 | Characteristics of Modern Web\", \" Applications  \\n Docker containers - both Linux and Windows - can host ASP.NET Core applications, al\", \"lowing them to \\ntake advantage of the benefits of containers and microservices . \\nModular and loosel\", \"y coupled  \\nNuGet packages are first -class citizens in .NET Core, and ASP.NET Core apps are compose\", \"d of many \\nlibraries through NuGet. This granularity of functionality helps ensure apps only depend \", \"on and \\ndeploy functionality they actually require, reducing their foot print and security vulnerabi\", \"lity surface \\narea.  \\nASP.NET Core also fully supports dependency injection , both internally and at\", \" the application level. \\nInterfaces can have multiple implementations that can be swapped out as nee\", \"ded. Dependency \\ninjection allows apps to loosely couple to those interfaces, rather than specific i\", \"mplementations, \\nmaking them easier  to extend, maintain, and test.  \\nEasily tested with automated t\", \"ests  \\nASP.NET Core applications support unit testing, and their loose coupling and support for depe\", \"ndency \\ninjection makes it easy to swap infrastructure concerns with fake implementations for test p\", \"urposes. \\nASP.NET Core also ships with a TestServer that can be u sed to host apps in memory. Functi\", \"onal tests \\ncan then make requests to this in -memory server, exercising the full application stack \", \"(including \\nmiddleware, routing, model binding, filters, etc.) and receiving a response, all in a fr\", \"action of the time \\nit wou ld take to host the app on a real server and make requests through the ne\", \"twork layer. These \\ntests are especially easy to write, and valuable, for APIs, which are increasing\", \"ly important in modern \\nweb applications.  \\nTraditional and SPA behaviors supported  \\nTraditional we\", \"b applications have involved little client -side behavior, but instead have relied on the \\nserver fo\", \"r all navigation, queries, and updates the app might need to make. Each new operation made \\nby the u\", \"ser would be translated into a new web reques t, with the result being a full page reload in the \\nen\", \"d user\\u2019s browser. Classic Model -View -Controller (MVC) frameworks typically follow this approach, \\n\", \"with each new request corresponding to a different controller action, which in turn would work with \", \"a \\nmode l and return a view. Some individual operations on a given page might be enhanced with AJAX \", \"\\n(Asynchronous JavaScript and XML) functionality, but the overall architecture of the app used many \", \"\\ndifferent MVC views and URL endpoints. In addition, ASP.NET Core MVC also supports Razor Pages, a \\n\", \"simpler way to organize MVC -style pages.  \\nSingle Page Applications (SPAs), by contrast, involve ve\", \"ry few dynamically generated server -side page \\nloads (if any). Many SPAs are initialized within a s\", \"tatic HTML file that loads the necessary JavaScript \\nlibraries to start and run the app. These apps \", \"mak e heavy usage of web APIs for their data needs and \\ncan provide much richer user experiences. Bl\", \"azor WebAssembly provides a means of building SPAs \\nusing .NET code, which then runs in the client\\u2019s\", \" browser.   \\n4 CHAPTER 1 | Characteristics of Modern Web Applications  \\n Many web applications invol\", \"ve a combination of traditional web application behavior (typically for \\ncontent) and SPAs (for inte\", \"ractivity). ASP.NET Core supports both MVC (Views or Page based) and web \\nAPIs in the same applicati\", \"on, using the same set of tools  and underlying framework libraries.  \\nSimple development and deploy\", \"ment  \\nASP.NET Core applications can be written using simple text editors and command -line interfac\", \"es, or \\nfull-featured development environments like Visual Studio. Monolithic applications are typic\", \"ally \\ndeployed to a single endpoint. Deployments can easily be aut omated to occur as part of a cont\", \"inuous \\nintegration (CI) and continuous delivery (CD) pipeline. In addition to traditional CI/CD too\", \"ls, Microsoft \\nAzure has integrated support for git repositories and can automatically deploy update\", \"s as they are \\nmade to a s pecified git branch or tag. Azure DevOps provides a full -featured CI/CD \", \"build and \\ndeployment pipeline, and GitHub Actions provide another option for projects hosted there.\", \"  \\nTraditional ASP.NET and Web Forms  \\nIn addition to ASP.NET Core, traditional ASP.NET 4.x continue\", \"s to be a robust and reliable platform for \\nbuilding web applications. ASP.NET supports MVC and Web \", \"API development models, as well as Web \\nForms, which is well suited to rich page -based applicatio n\", \" development and features a rich third -party \\ncomponent ecosystem. Microsoft Azure has great longst\", \"anding support for ASP.NET 4.x applications, \\nand many developers are familiar with this platform.  \", \"\\nBlazor  \\nBlazor is included with ASP.NET Core 3.0 and later. It provides a new mechanism for buildi\", \"ng rich \\ninteractive web client applications using Razor, C#, and ASP.NET Core. It offers another so\", \"lution to \\nconsider when developing modern web applications. There a re two versions of Blazor to co\", \"nsider: \\nserver -side and client -side. \\nServer -side Blazor was released in 2019 with ASP.NET Core \", \"3.0. As its name implies, it runs on the \\nserver, rendering changes to the client document back to t\", \"he browser over the network. Server -side \\nBlazor provides a rich client experience without requirin\", \"g  client -side JavaScript and without requiring \\nseparate page loads for each client page interacti\", \"on. Changes in the loaded page are requested from \\nand processed by the server and then sent back to\", \" the client using SignalR.  \\nClient -side Blazor, released in 2020, eliminates the need to render ch\", \"anges on the server. Instead, it \\nleverages WebAssembly to run .NET code within the client. The clie\", \"nt can still make API calls to the \\nserver if needed to request data, but all client -side behavior \", \"runs in the client via WebAssembly, which \\nis already supported by all major browsers and is just a \", \"JavaScript library.  \\nReferences \\u2013 Modern Web Applications  \\n\\u2022 Introduction to ASP.NET Core  \\nhttps:\", \"//learn.microsoft.com/aspnet/core/   \\n5 CHAPTER 1 | Characteristics of Modern Web Applications  \\n \\u2022 \", \"Testing in ASP.NET Core  \\nhttps://learn.microsoft.com/aspnet/core/testing/  \\n\\u2022 Blazor - Get Started \", \" \\nhttps://blazor.net/docs/get -started.html   \\n6 CHAPTER 2 | Choose Between Traditional Web Apps and\", \" Single Page Apps (SPAs)  \\n CHAPTER  2 \\nChoose Between \\nTraditional Web Apps and \\nSingle Page Apps (\", \"SPAs)  \\n\\u201cAtwood\\u2019s Law: Any application that can be written in JavaScript, will eventually be written\", \" in \\nJavaScript.\\u201d  \\n- Jeff Atwood  \\nThere are two general approaches to building web applications to\", \"day: traditional web applications \\nthat perform most of the application logic on the server, and sin\", \"gle -page applications (SPAs) that \\nperform most of the user interface logic in a web browser, commu\", \"nicating with the web server \\nprimarily using web APIs. A hybrid approach is also possible, the simp\", \"lest being host one or more rich \\nSPA-like subapplications within a larger traditional web applicati\", \"on.  \\nUse traditional web applications when:  \\n\\u2022 Your application\\u2019s client -side requirements are si\", \"mple or even read -only.  \\n\\u2022 Your application needs to function in browsers without JavaScript suppo\", \"rt.  \\n\\u2022 Your application is public -facing and benefits from search engine discovery and referrals. \", \" \\nUse a SPA when:  \\n\\u2022 Your application must expose a rich user interface with many features.  \\n\\u2022 You\", \"r team is familiar with JavaScript, TypeScript, or Blazor WebAssembly development.  \\n\\u2022 Your applicat\", \"ion must already expose an API for other (internal or public) clients.  \\nAdditionally, SPA framework\", \"s require greater architectural and security expertise. They experience \\ngreater churn due to freque\", \"nt updates and new client frameworks than traditional web applications. \\nConfiguring automated build\", \" and deployment processes and u tilizing deployment options like \\ncontainers may be more difficult w\", \"ith SPA applications than traditional web apps.  \\nImprovements in user experience made possible by t\", \"he SPA approach must be weighed against these \\nconsiderations.   \\n7 CHAPTER 2 | Choose Between Tradi\", \"tional Web Apps and Single Page Apps (SPAs)  \\n Blazor  \\nASP.NET Core includes a model for building r\", \"ich, interactive, and composable user interfaces called \\nBlazor. Blazor server -side allows develope\", \"rs to build UI with C# and Razor on the server and for the UI \\nto be interactively connected to the \", \"browser in real -time using a persistent SignalR connection. Blazor \\nWebAssembly introduces another \", \"option for Blazor apps, allowing them to run in the browser using \\nWebAssembly. Because it\\u2019s real .N\", \"ET code running on WebAssembly, you can reuse code and libraries \\nfrom serv er-side parts of your ap\", \"plication.  \\nBlazor provides a new, third option to consider when evaluating whether to build a pure\", \"ly server -\\nrendered web application or a SPA. You can build rich, SPA -like client -side behaviors \", \"using Blazor, \\nwithout the need for significant JavaScript development. Bl azor applications can cal\", \"l APIs to request \\ndata or perform server -side operations. They can interoperate with JavaScript wh\", \"ere necessary to take \\nadvantage of JavaScript libraries and frameworks.  \\nConsider building your we\", \"b application with Blazor when:  \\n\\u2022 Your application must expose a rich user interface  \\n\\u2022 Your team\", \" is more comfortable with .NET development than JavaScript or TypeScript \\ndevelopment  \\nIf you have \", \"an existing web forms application you\\u2019re considering migrating to .NET Core or the latest \\n.NET, you\", \" may wish to review the free e -book, Blazor for Web Forms Developers  to see whether it \\nmakes sens\", \"e to consider migrating it to Blazor.  \\nFor more information about Blazor, see Get started with Blaz\", \"or . \\nWhen to choose traditional web apps  \\nThe following section is a more detailed explanation of \", \"the previously stated reasons for picking \\ntraditional web applications.  \\nYour application has simp\", \"le, possibly read -only, client -side requirements  \\nMany web applications are primarily consumed in\", \" a read -only fashion by the vast majority of their \\nusers. Read -only (or read -mostly) application\", \"s tend to be much simpler than those applications that \\nmaintain and manipulate a great deal of stat\", \"e. For example , a search engine might consist of a single \\nentry point with a textbox and a second \", \"page for displaying search results. Anonymous users can \\neasily make requests, and there is little n\", \"eed for client -side logic. Likewise, a blog or content \\nmanagement system\\u2019 s public -facing applica\", \"tion usually consists mainly of content with little client -\\nside behavior. Such applications are ea\", \"sily built as traditional server -based web applications, which \\nperform logic on the web server and\", \" render HTML to be displayed in the b rowser. The fact that each \\nunique page of the site has its ow\", \"n URL that can be bookmarked and indexed by search engines (by \\ndefault, without having to add this \", \"functionality as a separate feature of the application) is also a clear \\nbenefit in such scenario s.\", \" \\nYour application needs to function in browsers without JavaScript support   \\n8 CHAPTER 2 | Choose \", \"Between Traditional Web Apps and Single Page Apps (SPAs)  \\n Web applications that need to function i\", \"n browsers with limited or no JavaScript support should be \\nwritten using traditional web app workfl\", \"ows (or at least be able to fall back to such behavior). SPAs \\nrequire client -side JavaScript in or\", \"der to function; if  it\\u2019s not available, SPAs are not a good choice.  \\nYour team is unfamiliar with \", \"JavaScript or TypeScript development techniques  \\nIf your team is unfamiliar with JavaScript or Type\", \"Script, but is familiar with server -side web application \\ndevelopment, then they will probably be a\", \"ble to deliver a traditional web app more quickly than a \\nSPA. Unless learning to program SPAs is a \", \"goal, or the user experience afforded by a SPA is required, \\ntraditional web apps are a more product\", \"ive choice for teams who are already familiar with building \\nthem.  \\nWhen to choose SPAs  \\nThe follo\", \"wing section is a more detailed explanation of when to choose a Single Page Applications \\nstyle of d\", \"evelopment for your web app.  \\nYour application must expose a rich user interface with many features\", \"  \\nSPAs can support rich client -side functionality that doesn\\u2019t require reloading the page as users\", \" take \\nactions or navigate between areas of the app. SPAs can load more quickly, fetching data in th\", \"e \\nbackground, and individual user actions are more responsive  since full page reloads are rare. SP\", \"As can \\nsupport incremental updates, saving partially completed forms or documents without the user \", \"having \\nto click a button to submit a form. SPAs can support rich client -side behaviors, such as dr\", \"ag -and-drop, \\nmuch more  readily than traditional applications. SPAs can be designed to run in a di\", \"sconnected mode, \\nmaking updates to a client -side model that are eventually synchronized back to th\", \"e server once a \\nconnection is re -established. Choose a SPA -style application if you r app\\u2019s requi\", \"rements include rich \\nfunctionality that goes beyond what typical HTML forms offer.  \\nFrequently, SP\", \"As need to implement features that are built into traditional web apps, such as \\ndisplaying a meanin\", \"gful URL in the address bar reflecting the current operation (and allowing users to \\nbookmark or dee\", \"p link to this URL to return to it). SPAs al so should allow users to use the browser\\u2019s \\nback and fo\", \"rward buttons with results that won\\u2019t surprise them.  \\nYour team is familiar with JavaScript and/or \", \"TypeScript development  \\nWriting SPAs requires familiarity with JavaScript and/or TypeScript and cli\", \"ent -side programming \\ntechniques and libraries. Your team should be competent in writing modern Jav\", \"aScript using a SPA \\nframework like Angular.  \\nReferences \\u2013 SPA Frameworks  \\n\\u2022 Angular : https://ang\", \"ular.io  \\n\\u2022 React : https://reactjs.org/  \\n\\u2022 Vue.js : https://vuejs.org/  \\nYour application must alr\", \"eady expose an API for other (internal or public) clients   \\n9 CHAPTER 2 | Choose Between Traditiona\", \"l Web Apps and Single Page Apps (SPAs)  \\n If you\\u2019re already supporting a web API for use by other cl\", \"ients, it may require less effort to create a \\nSPA implementation that leverages these APIs rather t\", \"han reproducing the logic in server -side form. \\nSPAs make extensive use of web APIs to query and up\", \"date data as users interact with the  application.  \\nWhen to choose Blazor  \\nThe following section i\", \"s a more detailed explanation of when to choose Blazor for your web app.  \\nYour application must exp\", \"ose a rich user interface  \\nLike JavaScript -based SPAs, Blazor applications can support rich client\", \" behavior without page reloads. \\nThese applications are more responsive to users, fetching only the \", \"data (or HTML) required to respond \\nto a given user interaction. Designed properly, ser ver-side Bla\", \"zor apps can be configured to run as \\nclient -side Blazor apps with minimal changes once this featur\", \"e is supported.  \\nYour team is more comfortable with .NET development than JavaScript or TypeScript \", \"\\ndevelopment  \\nMany developers are more productive with .NET and Razor than with client -side langua\", \"ges like \\nJavaScript or TypeScript. Since the server -side of the application is already being devel\", \"oped with .NET, \\nusing Blazor ensures every .NET developer on the team can understand and potentiall\", \"y build the \\nbehavior of the front end of the application.  \\nDecision table  \\nThe following decision\", \" table summarizes some of the basic factors to consider when choosing \\nbetween a traditional web app\", \"lication, a SPA, or a Blazor app.  \\nFactor  Traditional Web \\nApp Single Page \\nApplication  Blazor \\nA\", \"pp \\nRequired Team Familiarity with \\nJavaScript/TypeScript  Minimal  Required  Minimal  \\nSupport Brow\", \"sers without Scripting  Supported  Not Supported  Supporte\\nd \\nMinimal Client -Side Application Behav\", \"ior  Well -Suited  Overkill  Viable  \\nRich, Complex User Interface \\nRequirements  Limited  Well -Sui\", \"ted  Well -\\nSuited  \\nOther considerations  \\nTraditional Web Apps tend to be simpler and have better \", \"Search Engine Optimization (SEO) criteria \\nthan SPA apps. Search engine bots can easily consume cont\", \"ent from traditional apps, while support \\nfor indexing SPAs may be lacking or limited. If your app b\", \"en efits from public discovery by search \\nengines, this is often an important consideration.   \\n10 C\", \"HAPTER 2 | Choose Between Traditional Web Apps and Single Page Apps (SPAs)  \\n In addition, unless yo\", \"u\\u2019ve built a management tool for your SPA\\u2019s content, it may require developers \\nto make changes. Tra\", \"ditional Web Apps are often easier for non -developers to make changes to, since \\nmuch of the conten\", \"t is simply HTML and may not require a build process to preview or even deploy. If \\nnon-developers i\", \"n your organization are likely to need to maintain the content of the app, a \\ntraditional web app ma\", \"y be a better choice.  \\nSPAs shine when the app has complex interactive forms or other user interact\", \"ion features. For \\ncomplex apps that require authentication to use, and thus aren\\u2019t accessible by pu\", \"blic search engine \\nspiders, SPAs are a great option in many cases.   \\n11 CHAPTER 3 | Architectural \", \"principles  \\n CHAPTER  3 \\nArchitectural principles  \\n\\u201cIf builders built buildings the way programmer\", \"s wrote programs, then the first woodpecker that \\ncame along would destroy civilization.\\u201d  \\n- Gerald\", \" Weinberg  \\nYou should architect and design software solutions with maintainability in mind. The pri\", \"nciples \\noutlined in this section can help guide you toward architectural decisions that will result\", \" in clean, \\nmaintainable applications. Generally, these principles wil l guide you toward building a\", \"pplications out \\nof discrete components that are not tightly coupled to other parts of your applicat\", \"ion, but rather \\ncommunicate through explicit interfaces or messaging systems.  \\nCommon design princ\", \"iples  \\nSeparation of concerns  \\nA guiding principle when developing is Separation of Concerns . Thi\", \"s principle asserts that software \\nshould be separated based on the kinds of work it performs. For i\", \"nstance, consider an application that \\nincludes logic for identifying noteworthy items to display to\", \" the user, and which formats such items in \\na particul ar way to make them more noticeable. The beha\", \"vior responsible for choosing which items to \\nformat should be kept separate from the behavior respo\", \"nsible for formatting the items, since these \\nbehavi ors are separate concerns that are only coincid\", \"entally related to one another.  \\nArchitecturally, applications can be logically built to follow thi\", \"s principle by separating core business \\nbehavior from infrastructure and user -interface logic. Ide\", \"ally, business rules and logic should reside in \\na separate project, which should not depend on othe\", \"r projects in the application. This separation \\nhelps ensure that the business model is easy to test\", \" and can evolve without being tightly coupled to \\nlow-level implementation details (it also helps if\", \" infrastructure concerns depend on abstractions \\ndefined in the business layer). Separation of conce\", \"rns is a key consideration behind the use of layers \\nin application architectures.  \\nEncapsulation  \", \"\\nDifferent parts of an application should use encapsulation  to insulate them from other parts of th\", \"e \\napplication. Application components and layers should be able to adjust their internal implementa\", \"tion \\nwithout breaking their collaborators as long as external contracts are not violated. Proper us\", \"e of \\nencapsulation  helps achieve loose coupling and modularity in application designs, since objec\", \"ts and \\npackages can be replaced with alternative implementations so long as the same interface is \\n\", \"maintained.   \\n12 CHAPTER 3 | Architectural principles  \\n In classes, encapsulation is achieved by l\", \"imiting outside access to the class\\u2019s internal state. If an \\noutside actor wants to manipulate the s\", \"tate of the object, it should do so through a well -defined \\nfunction (or property setter), rather t\", \"han having direct access to the private state of the object. \\nLikewise, application components and a\", \"pplications themselves shoul d expose well -defined interfaces \\nfor their collaborators to use, rath\", \"er than allowing their state to be modified directly. This approach \\nfrees the application\\u2019s interna\", \"l design to evolve over time without worrying that doing so will break \\ncollaborators, so  long as t\", \"he public contracts are maintained.  \\nMutable global state is antithetical to encapsulation. A value\", \" fetched from mutable global state in one \\nfunction cannot be relied upon to have the same value in \", \"another function (or even further in the \\nsame function). Understanding concerns with mutable gl oba\", \"l state is one of the reasons programming \\nlanguages like C# have support for different scoping rule\", \"s, which are used everywhere from \\nstatements to methods to classes. It\\u2019s worth noting that data -dr\", \"iven architectures which rely on a \\ncentral database for integration within and between applications\", \" are, themselves, choosing to depend \\non the mutable global state represented by the database. A key\", \" consideration in domain -driven \\ndesign and clean architecture is how to encapsulate access to data\", \", and how to ens ure application \\nstate is not made invalid by direct access to its persistence form\", \"at.  \\nDependency inversion  \\nThe direction of dependency within the application should be in the dir\", \"ection of abstraction, not \\nimplementation details. Most applications are written such that compile \", \"-time dependency flows in the \\ndirection of runtime execution, producing a direct depend ency graph.\", \" That is, if class A calls a method \\nof class B and class B calls a method of class C, then at compi\", \"le time class A will depend on class B, \\nand class B will depend on class C, as shown in Figure 4 -1\", \".  \\n13 CHAPTER 3 | Architectural principles  \\n  \\nFigure 4 -1. Direct dependency graph.  \\nApplying th\", \"e dependency inversion principle allows A to call methods on an abstraction that B \\nimplements, maki\", \"ng it possible for A to call B at run time, but for B to depend on an interface \\ncontrolled by A at \", \"compile time (thus, inverting  the typical compile -time dependency). At run time, the \\nflow of prog\", \"ram execution remains unchanged, but the introduction of interfaces means that different \\nimplementa\", \"tions of these interfaces can easily be plugged in.  \\n \\n14 CHAPTER 3 | Architectural principles  \\n  \", \"\\nFigure 4 -2. Inverted dependency graph.  \\nDependency inversion  is a key part of building loosely c\", \"oupled applications, since implementation \\ndetails can be written to depend on and implement higher \", \"-level abstractions, rather than the other \\nway around. The resulting applications are more testable\", \", modular, and maintain able as a result. The \\npractice of dependency injection  is made possible by\", \" following the dependency inversion principle.  \\nExplicit dependencies  \\nMethods and classes should \", \"explicitly require any collaborating objects they need in order to \\nfunction correctly.  It is calle\", \"d the Explicit Dependencies Principle . Class constructors provide an \\nopportunity for classes to id\", \"entify the things they need in order to be in a valid state and to function \\nproperly. If you define\", \" classes that can be constructed and called, but that will only function properly \\nif certain glo ba\", \"l or infrastructure components are in place, these classes are being dishonest  with their \\nclients.\", \" The constructor contract is telling the client that it only needs the things specified (possibly \\nn\", \"othing if the class is just using a parameterless constructor), but then at runtime it turns out the\", \" \\nobject really did need something els e. \\nBy following the explicit dependencies principle, your cl\", \"asses and methods are being honest with their \\nclients about what they need in order to function. Fo\", \"llowing the principle makes your code more self -\\ndocumenting and your coding contracts more user -f\", \"riendly, since users will come to trust that as long \\nas they provide what\\u2019s required in the form of\", \" method or constructor parameters, the objects they\\u2019re \\nworking with will behave correctly at run ti\", \"me.  \\nSingle responsibility  \\nThe single responsibility principle applies to object -oriented design\", \", but can also be considered as an \\narchitectural principle similar to separation of concerns. It st\", \"ates that objects should have only one \\nresponsibility and that they should have only one  reason to\", \" change. Specifically, the only situation in \\nwhich the object should change is if the manner in whi\", \"ch it performs its one responsibility must be \\n \\n15 CHAPTER 3 | Architectural principles  \\n updated.\", \" Following this principle helps to produce more loosely coupled and modular systems, since \\nmany kin\", \"ds of new behavior can be implemented as new classes, rather than by adding additional \\nresponsibili\", \"ty to existing classes. Adding new classes is alwa ys safer than changing existing classes, \\nsince n\", \"o code yet depends on the new classes.  \\nIn a monolithic application, we can apply the single respon\", \"sibility principle at a high level to the layers \\nin the application. Presentation responsibility sh\", \"ould remain in the UI project, while data access \\nresponsibility should be kept within an infrastru \", \"cture project. Business logic should be kept in the \\napplication core project, where it can be easil\", \"y tested and can evolve independently from other \\nresponsibilities.  \\nWhen this principle is applied\", \" to application architecture and taken to its logical endpoint, you get \\nmicroservices. A given micr\", \"oservice should have a single responsibility. If you need to extend the \\nbehavior of a system, it\\u2019s \", \"usually better to do it by a dding additional microservices, rather than by \\nadding responsibility t\", \"o an existing one.  \\nLearn more about microservices architecture  \\nDon\\u2019t repeat yourself (DRY)  \\nThe\", \" application should avoid specifying behavior related to a particular concept in multiple places as \", \"\\nthis practice is a frequent source of errors. At some point, a change in requirements will require \", \"\\nchanging this behavior. It\\u2019s likely that at least one instance of the behavior will fail to be upda\", \"ted, and \\nthe system will behave inconsistently.  \\nRather than duplicating logic, encapsulate it in \", \"a programming construct. Make this construct the \\nsingle authority over this behavior, and have any \", \"other part of the application that requires this \\nbehavior use the new construct.  \\nNote  \\nAvoid bin\", \"ding together behavior that is only coincidentally repetitive. For example, just because two \\ndiffer\", \"ent constants both have the same value, that doesn\\u2019t mean you should have only one constant, if \\ncon\", \"ceptually they\\u2019re referring to different things. Duplication is always preferable to coupling to the\", \" \\nwrong abstraction.  \\nPersistence ignorance  \\nPersistence ignorance  (PI) refers to types that need\", \" to be persisted, but whose code is unaffected by \\nthe choice of persistence technology. Such types \", \"in .NET are sometimes referred to as Plain Old CLR \\nObjects (POCOs), because they do not need to inh\", \"erit from a particular base  class or implement a \\nparticular interface. Persistence ignorance is va\", \"luable because it allows the same business model to be \\npersisted in multiple ways, offering additio\", \"nal flexibility to the application. Persistence choices might \\nchange over time, from one database t\", \"echnology to another, or additional forms of persistence might \\nbe required in addition to whatever \", \"the application started with (for example, using a Redis cache or \\nAzure Cosmos DB in addition to a \", \"relational database).  \\nSome examples of violations of this principle include:   \\n16 CHAPTER 3 | Arc\", \"hitectural principles  \\n \\u2022 A required base class.  \\n\\u2022 A required interface implementation.  \\n\\u2022 Class\", \"es responsible for saving themselves (such as the Active Record pattern).  \\n\\u2022 Required parameterless\", \" constructor.  \\n\\u2022 Properties requiring virtual keyword.  \\n\\u2022 Persistence -specific required attribute\", \"s.  \\nThe requirement that classes have any of the above features or behaviors adds coupling between \", \"the \\ntypes to be persisted and the choice of persistence technology, making it more difficult to ado\", \"pt new \\ndata access strategies in the future.  \\nBounded contexts  \\nBounded contexts  are a central p\", \"attern in Domain -Driven Design. They provide a way of tackling \\ncomplexity in large applications or\", \" organizations by breaking it up into separate conceptual modules. \\nEach conceptual module then repr\", \"esents a context that is separated from oth er contexts (hence, \\nbounded), and can evolve independen\", \"tly. Each bounded context should ideally be free to choose its \\nown names for concepts within it, an\", \"d should have exclusive access to its own persistence store.  \\nAt a minimum, individual web applicat\", \"ions should strive to be their own bounded context, with their \\nown persistence store for their busi\", \"ness model, rather than sharing a database with other applications. \\nCommunication between bounded c\", \"ontexts occurs throug h programmatic interfaces, rather than \\nthrough a shared database, which allow\", \"s for business logic and events to take place in response to \\nchanges that take place. Bounded conte\", \"xts map closely to microservices, which also are ideally \\nimplemented as their ow n individual bound\", \"ed contexts.  \\nAdditional resources  \\n\\u2022 Principles  \\n\\u2022 Bounded Context   \\n17 CHAPTER 4 | Common web \", \"application architectures  \\n CHAPTER  4 \\nCommon web application \\narchitectures  \\n\\u201cIf you think good \", \"architecture is expensive, try bad architecture.\\u201d - Brian Foote and Joseph Yoder  \\nMost traditional \", \".NET applications are deployed as single units corresponding to an executable or a \\nsingle web appli\", \"cation running within a single IIS appdomain. This approach is the simplest \\ndeployment model and se\", \"rves many internal and smaller public applications very well. However, even \\ngiven this single unit \", \"of deployment, most non -trivial business applications  benefit from some logical \\nseparation into s\", \"everal layers.  \\nWhat is a monolithic application?  \\nA monolithic application is one that is entirel\", \"y self -contained, in terms of its behavior. It may interact \\nwith other services or data stores in \", \"the course of performing its operations, but the core of its \\nbehavior runs within its own process a\", \"nd the entir e application is typically deployed as a single unit. If \\nsuch an application needs to \", \"scale horizontally, typically the entire application is duplicated across \\nmultiple servers or virtu\", \"al machines.  \\nAll-in-one applications  \\nThe smallest possible number of projects for an application\", \" architecture is one. In this architecture, the \\nentire logic of the application is contained in a s\", \"ingle project, compiled to a single assembly, and \\ndeployed as a single unit.  \\nA new ASP.NET Core p\", \"roject, whether created in Visual Studio or from the command line, starts out as \\na simple \\u201call -in-\", \"one\\u201d monolith. It contains all of the behavior of the application, including \\npresentation, business\", \", and data access logic. Figure 5 -1 sho ws the file structure of a single -project \\napp.  \\n18 CHAPT\", \"ER 4 | Common web application architectures  \\n  \\nFigure 5 -1. A single project ASP.NET Core app.  \\nI\", \"n a single project scenario, separation of concerns is achieved through the use of folders. The defa\", \"ult \\ntemplate includes separate folders for MVC pattern responsibilities of Models, Views, and Contr\", \"ollers, \\nas well as additional folders for Data and Servi ces. In this arrangement, presentation det\", \"ails should be \\nlimited as much as possible to the Views folder, and data access implementation deta\", \"ils should be \\nlimited to classes kept in the Data folder. Business logic should reside in services \", \"and classes with in \\nthe Models folder.  \\nAlthough simple, the single -project monolithic solution h\", \"as some disadvantages. As the project\\u2019s size \\nand complexity grows, the number of files and folders \", \"will continue to grow as well. User interface (UI) \\nconcerns (models, views, controllers) reside in \", \"m ultiple folders, which aren\\u2019t grouped together \\nalphabetically. This issue only gets worse when ad\", \"ditional UI -level constructs, such as Filters or \\nModelBinders, are added in their own folders. Bus\", \"iness logic is scattered between the Models and \\nServices fold ers, and there\\u2019s no clear indication \", \"of which classes in which folders should depend on \\nwhich others. This lack of organization at the p\", \"roject level frequently leads to spaghetti code . \\nTo address these issues, applications often evolv\", \"e into multi -project solutions, where each project is \\nconsidered to reside in a particular layer  \", \"of the application.  \\nWhat are layers?  \\nAs applications grow in complexity, one way to manage that \", \"complexity is to break up the application \\naccording to its responsibilities or concerns. This appro\", \"ach follows the separation of concerns \\nprinciple and can help keep a growing codebase organized so \", \" that developers can easily find where \\ncertain functionality is implemented. Layered architecture o\", \"ffers a number of advantages beyond just \\ncode organization, though.  \\n \\n19 CHAPTER 4 | Common web a\", \"pplication architectures  \\n By organizing code into layers, common low -level functionality can be r\", \"eused throughout the \\napplication. This reuse is beneficial because it means less code needs to be w\", \"ritten and because it can \\nallow the application to standardize on a single implementat ion, followi\", \"ng the don\\u2019t repeat yourself \\n(DRY)  principle.  \\nWith a layered architecture, applications can enfo\", \"rce restrictions on which layers can communicate \\nwith other layers. This architecture helps to achi\", \"eve encapsulation. When a layer is changed or \\nreplaced, only those layers that work with it should \", \"be impac ted. By limiting which layers depend on \\nwhich other layers, the impact of changes can be m\", \"itigated so that a single change doesn\\u2019t impact the \\nentire application.  \\nLayers (and encapsulation\", \") make it much easier to replace functionality within the application. For \\nexample, an application \", \"might initially use its own SQL Server database for persistence, but later could \\nchoose to use a cl\", \"oud -based persistence strategy, o r one behind a web API. If the application has \\nproperly encapsul\", \"ated its persistence implementation within a logical layer, that SQL Server -specific \\nlayer could b\", \"e replaced by a new one implementing the same public interface.  \\nIn addition to the potential of sw\", \"apping out implementations in response to future changes in \\nrequirements, application layers can al\", \"so make it easier to swap out implementations for testing \\npurposes. Instead of having to write test\", \"s that operate against t he real data layer or UI layer of the \\napplication, these layers can be rep\", \"laced at test time with fake implementations that provide known \\nresponses to requests. This approac\", \"h typically makes tests much easier to write and much faster to \\nrun when compared t o running tests\", \" against the application\\u2019s real infrastructure.  \\nLogical layering is a common technique for improvi\", \"ng the organization of code in enterprise software \\napplications, and there are several ways in whic\", \"h code can be organized into layers.  \\nNote  \\nLayers  represent logical separation within the applic\", \"ation. In the event that application logic is \\nphysically distributed to separate servers or process\", \"es, these separate physical deployment targets are \\nreferred to as tiers. It\\u2019s possible, and quite c\", \"ommon, to have an N -Layer application that is deployed \\nto a single tier.  \\nTraditional \\u201cN -Layer\\u201d \", \"architecture applications  \\nThe most common organization of application logic into layers is shown i\", \"n Figure 5 -2.  \\n20 CHAPTER 4 | Common web application architectures  \\n  \\nFigure 5 -2. Typical appli\", \"cation layers.  \\nThese layers are frequently abbreviated as UI, BLL (Business Logic Layer), and DAL \", \"(Data Access Layer). \\nUsing this architecture, users make requests through the UI layer, which inter\", \"acts only with the BLL. \\nThe BLL, in turn, can call the DAL for data access  requests. The UI layer \", \"shouldn\\u2019t make any requests to \\nthe DAL directly, nor should it interact with persistence directly t\", \"hrough other means. Likewise, the BLL \\nshould only interact with persistence by going through the DA\", \"L. In this way, each layer has its  own \\nwell-known responsibility.  \\nOne disadvantage of this tradi\", \"tional layering approach is that compile -time dependencies run from \\nthe top to the bottom. That is\", \", the UI layer depends on the BLL, which depends on the DAL. This \\nmeans that the BLL, which usually\", \" holds the most important log ic in the application, is dependent on \\ndata access implementation det\", \"ails (and often on the existence of a database). Testing business logic \\nin such an architecture is \", \"often difficult, requiring a test database. The dependency inversion principle \\ncan be us ed to addr\", \"ess this issue, as you\\u2019ll see in the next section.  \\nFigure 5 -3 shows an example solution, breaking\", \" the application into three projects by responsibility \\n(or layer).  \\n \\n21 CHAPTER 4 | Common web ap\", \"plication architectures  \\n  \\nFigure 5 -3. A simple monolithic application with three projects.  \\nAlt\", \"hough this application uses several projects for organizational purposes, it\\u2019s still deployed as a \\n\", \"single unit and its clients will interact with it as a single web app. This allows for very simple \\n\", \"deployment process. Figure 5 -4 shows how such an app mi ght be hosted using Azure.  \\n \\nFigure 5 -4.\", \" Simple deployment of Azure Web App  \\nAs application needs grow, more complex and robust deployment \", \"solutions may be required. Figure \\n5-5 shows an example of a more complex deployment plan that suppo\", \"rts additional capabilities.  \\n \\n22 CHAPTER 4 | Common web application architectures  \\n  \\nFigure 5 -\", \"5. Deploying a web app to an Azure App Service  \\nInternally, this project\\u2019s organization into multip\", \"le projects based on responsibility improves the \\nmaintainability of the application.  \\nThis unit ca\", \"n be scaled up or out to take advantage of cloud -based on -demand scalability. Scaling up \\nmeans ad\", \"ding additional CPU, memory, disk space, or other resources to the server(s) hosting your \\napp. Scal\", \"ing out means adding additional instances of suc h servers, whether these are physical \\nservers, vir\", \"tual machines, or containers. When your app is hosted across multiple instances, a load \\nbalancer is\", \" used to assign requests to individual app instances.  \\nThe simplest approach to scaling a web appli\", \"cation in Azure is to configure scaling manually in the \\napplication\\u2019s App Service Plan. Figure 5 -6\", \" shows the appropriate Azure dashboard screen to configure \\nhow many instances are serving an app.  \", \"\\n \\n23 CHAPTER 4 | Common web application architectures  \\n  \\nFigure 5 -6. App Service Plan scaling in\", \" Azure.  \\nClean architecture  \\nApplications that follow the Dependency Inversion Principle as well a\", \"s the Domain -Driven Design \\n(DDD) principles tend to arrive at a similar architecture. This archite\", \"cture has gone by many names \\nover the years. One of the first names was Hexagonal Archite cture, fo\", \"llowed by Ports -and-Adapters. \\nMore recently, it\\u2019s been cited as the Onion Architecture  or Clean A\", \"rchitecture . The latter name, Clean \\nArchitecture, is used as the name for this architecture in thi\", \"s e -book.  \\nThe eShopOnWeb reference application uses the Clean Architecture approach in organizing\", \" its code \\ninto projects. You can find a solution template you can use as a starting point for your \", \"own ASP.NET \\nCore solutions in the ardalis/cleanarchitecture  GitHub repository or by installing the\", \" template from \\nNuGet . \\nClean architecture puts the business logic and application model at the cen\", \"ter of the application. \\nInstead of having business logic depend on data access or other infrastruct\", \"ure concerns, this \\ndependency is inverted: infrastructure and implementation detai ls depend on the\", \" Application Core. \\nThis functionality is achieved by defining abstractions, or interfaces, in the A\", \"pplication Core, which are \\nthen implemented by types defined in the Infrastructure layer. A common \", \"way of visualizing this \\narchitecture is to  use a series of concentric circles, similar to an onion\", \". Figure 5 -7 shows an example of \\nthis style of architectural representation.  \\n \\n24 CHAPTER 4 | Co\", \"mmon web application architectures  \\n  \\nFigure 5 -7. Clean Architecture; onion view  \\nIn this diagra\", \"m, dependencies flow toward the innermost circle. The Application Core takes its name \\nfrom its posi\", \"tion at the core of this diagram. And you can see on the diagram that the Application \\nCore has no d\", \"ependencies on other application layers. The application\\u2019s entities and interfaces are at \\nthe very \", \"center. Just outside, but still in the Application Cor e, are domain services, which typically \\nimpl\", \"ement interfaces defined in the inner circle. Outside of the Application Core, both the UI and the \\n\", \"Infrastructure layers depend on the Application Core, but not on one another (necessarily).  \\nFigure\", \" 5 -8 shows a more traditional horizontal layer diagram that better reflects the dependency \\nbetween\", \" the UI and other layers.  \\n \\n25 CHAPTER 4 | Common web application architectures  \\n  \\nFigure 5 -8. \", \"Clean Architecture; horizontal layer view  \\nNote that the solid arrows represent compile -time depen\", \"dencies, while the dashed arrow represents a \\nruntime -only dependency. With the clean architecture,\", \" the UI layer works with interfaces defined in \\nthe Application Core at compile time, and ideally sh\", \"ouldn\\u2019t know about the implementation types \\ndefined in the Infrastructure layer. At run tim e, howe\", \"ver, these implementation types are required for \\nthe app to execute, so they need to be present and\", \" wired up to the Application Core interfaces via \\ndependency injection.  \\nFigure 5 -9 shows a more d\", \"etailed view of an ASP.NET Core application\\u2019s architecture when built \\nfollowing these recommendatio\", \"ns.  \\n \\n26 CHAPTER 4 | Common web application architectures  \\n  \\nFigure 5 -9. ASP.NET Core architect\", \"ure diagram following Clean Architecture.  \\nBecause the Application Core doesn\\u2019t depend on Infrastru\", \"cture, it\\u2019s very easy to write automated unit \\ntests for this layer. Figures 5 -10 and 5 -11 show ho\", \"w tests fit into this architecture.  \\n \\nFigure 5 -10. Unit testing Application Core in isolation.  \\n\", \" \\n27 CHAPTER 4 | Common web application architectures  \\n  \\nFigure 5 -11. Integration testing Infrast\", \"ructure implementations with external dependencies.  \\nSince the UI layer doesn\\u2019t have any direct dep\", \"endency on types defined in the Infrastructure project, \\nit\\u2019s likewise very easy to swap out impleme\", \"ntations, either to facilitate testing or in response to \\nchanging application requirements. ASP.NET\", \" Core\\u2019s buil t-in use of and support for dependency \\ninjection makes this architecture the most appr\", \"opriate way to structure non -trivial monolithic \\napplications.  \\nFor monolithic applications, the A\", \"pplication Core, Infrastructure, and UI projects are all run as a single \\napplication. The runtime a\", \"pplication architecture might look something like Figure 5 -12. \\n \\n28 CHAPTER 4 | Common web applica\", \"tion architectures  \\n  \\nFigure 5 -12. A sample ASP.NET Core app\\u2019s runtime architecture.  \\nOrganizing\", \" code in Clean Architecture  \\nIn a Clean Architecture solution, each project has clear responsibilit\", \"ies. As such, certain types belong \\nin each project and you\\u2019ll frequently find folders corresponding\", \" to these types in the appropriate \\nproject.  \\nApplication Core  \\nThe Application Core holds the bus\", \"iness model, which includes entities, services, and interfaces. These \\ninterfaces include abstractio\", \"ns for operations that will be performed using Infrastructure, such as data \\naccess, file system acc\", \"ess, network calls, etc.  Sometimes services or interfaces defined at this layer will \\nneed to work \", \"with non -entity types that have no dependencies on UI or Infrastructure. These can be \\ndefined as s\", \"imple Data Transfer Objects (DTOs).  \\nApplication Core types  \\n\\u2022 Entities (business model classes th\", \"at are persisted)  \\n\\u2022 Aggregates (groups of entities)  \\n\\u2022 Interfaces  \\n\\u2022 Domain Services  \\n\\u2022 Specifi\", \"cations  \\n\\u2022 Custom Exceptions and Guard Clauses  \\n\\u2022 Domain Events and Handlers  \\n \\n29 CHAPTER 4 | Co\", \"mmon web application architectures  \\n Infrastructure  \\nThe Infrastructure project typically includes\", \" data access implementations. In a typical ASP.NET Core \\nweb application, these implementations incl\", \"ude the Entity Framework (EF) DbContext, any EF Core \\nMigration objects that have been defined, and \", \"data access i mplementation classes. The most common \\nway to abstract data access implementation cod\", \"e is through the use of the Repository design pattern . \\nIn addition to data access implementations,\", \" the Infrastructure project should contain implementations \\nof services that must interact with infr\", \"astructure concerns. These services should implement interfaces \\ndefined in the Application Core, an\", \"d so Infrastruc ture should have a reference to the Application Core \\nproject.  \\nInfrastructure type\", \"s  \\n\\u2022 EF Core types (DbContext, Migration)  \\n\\u2022 Data access implementation types (Repositories)  \\n\\u2022 I\", \"nfrastructure -specific services (for example, FileLogger or SmtpNotifier)  \\nUI Layer  \\nThe user int\", \"erface layer in an ASP.NET Core MVC application is the entry point for the application. This \\nprojec\", \"t should reference the Application Core project, and its types should interact with infrastructure \\n\", \"strictly through interfaces defined in Applica tion Core. No direct instantiation of or static calls\", \" to the \\nInfrastructure layer types should be allowed in the UI layer.  \\nUI Layer types  \\n\\u2022 Controll\", \"ers  \\n\\u2022 Custom Filters  \\n\\u2022 Custom Middleware  \\n\\u2022 Views  \\n\\u2022 ViewModels  \\n\\u2022 Startup  \\nThe Startup clas\", \"s or Program.cs  file is responsible for configuring the application, and for wiring up \\nimplementat\", \"ion types to interfaces. The place where this logic is performed is known as the app\\u2019s \\ncomposition \", \"root , and is what allows dependency injection to work properly at run time.  \\nNote  \\nIn order to wi\", \"re up dependency injection during app startup, the UI layer project may need to \\nreference the Infra\", \"structure project. This dependency can be eliminated, most easily by using a \\ncustom DI container th\", \"at has built -in support for loading types fr om assemblies. For the purposes of \\nthis sample, the s\", \"implest approach is to allow the UI project to reference the Infrastructure project \\n(but developers\", \" should limit actual references to types in the Infrastructure project to the app\\u2019s \\ncomposition roo\", \"t).   \\n30 CHAPTER 4 | Common web application architectures  \\n Monolithic applications and containers\", \"  \\nYou can build a single and monolithic -deployment based Web Application or Service and deploy it \", \"as \\na container. Within the application, it might not be monolithic but organized into several libra\", \"ries, \\ncomponents, or layers. Externally, it\\u2019s a single contai ner with a single process, single web\", \" application, \\nor single service.  \\nTo manage this model, you deploy a single container to represent\", \" the application. To scale, just add \\nadditional copies with a load balancer in front. The simplicit\", \"y comes from managing a single \\ndeployment in a single container or VM.  \\n \\nYou can include multiple\", \" components/libraries or internal layers within each container, as illustrated in \\nFigure 5 -13. But\", \", following the container principle of _\\u201ca container does one thing, and does it in one \\nprocess_\\u201d, \", \"the monolithic pattern might be a conflict.  \\nThe downside of this approach comes if/when the applic\", \"ation grows, requiring it to scale. If the entire \\napplication scales, it\\u2019s not really a problem. Ho\", \"wever, in most cases, a few parts of the application are \\nthe choke points requiring scaling, while \", \"othe r components are used less.  \\nUsing the typical eCommerce example, what you likely need to scal\", \"e is the product information \\ncomponent. Many more customers browse products than purchase them. Mor\", \"e customers use their \\nbasket than use the payment pipeline. Fewer customers add comments or view th\", \"eir purchase history. \\nAnd you likely only have a handful of employees, in a single region, that nee\", \"d to manage the content \\nand marketing campaigns. By scaling the monolithic design, all the code is \", \"deployed multiple times.  \\nIn addition to the \\u201cscale everything\\u201d problem, changes to a single compon\", \"ent require complete \\nretesting of the entire application, and a complete redeployment of all the in\", \"stances.  \\nThe monolithic approach is common, and many organizations are developing with this archit\", \"ectural \\napproach. Many are having good enough results, while others are hitting limits. Many design\", \"ed their \\napplications in this model, because the tools and infrastru cture were too difficult to bu\", \"ild service -\\noriented architectures (SOA), and they didn\\u2019t see the need until the app grew. If you \", \"find you\\u2019re hitting \\n \\n31 CHAPTER 4 | Common web application architectures  \\n the limits of the mono\", \"lithic approach, breaking up the app to enable it to better leverage containers \\nand microservices m\", \"ay be the next logical step.  \\n \\nDeploying monolithic applications in Microsoft Azure can be achieve\", \"d using dedicated VMs for each \\ninstance. Using Azure Virtual Machine Scale Sets , you can easily sc\", \"ale the VMs. Azure App Services  can \\nrun monolithic applications and easily scale instances without\", \" having to manage the VMs. Azure App \\nServices can run single instances of Docker containers as well\", \", simplifying the deployment. Using \\nDocker, you can deploy a single VM as a Docker host, a nd run m\", \"ultiple instances. Using the Azure \\nbalancer, as shown in the Figure 5 -14, you can manage scaling. \", \" \\nThe deployment to the various hosts can be managed with traditional deployment techniques. The \\nDo\", \"cker hosts can be managed with commands like docker run  performed manually, or through \\nautomation \", \"such as Continuous Delivery (CD) pipelines.  \\nMonolithic application deployed as a container  \\nThere\", \" are benefits of using containers to manage monolithic application deployments. Scaling the \\ninstanc\", \"es of containers is far faster and easier than deploying additional VMs. Even when using virtual \\nma\", \"chine scale sets to scale VMs, they take time to crea te. When deployed as app instances, the \\nconfi\", \"guration of the app is managed as part of the VM.  \\nDeploying updates as Docker images is far faster\", \" and network efficient. Docker Images typically start \\nin seconds, speeding rollouts. Tearing down a\", \" Docker instance is as easy as issuing a docker stop \\ncommand, typically completing in less than a s\", \"econd.  \\n \\n32 CHAPTER 4 | Common web application architectures  \\n As containers are inherently immut\", \"able by design, you never need to worry about corrupted VMs, \\nwhereas update scripts might forget to\", \" account for some specific configuration or file left on the disk.  \\nYou can use Docker containers f\", \"or a monolithic deployment of simpler web applications. This \\napproach improves continuous integrati\", \"on and continuous deployment pipelines and helps achieve \\ndeployment -to-production success. No more\", \" \\u201cIt works on my machine, wh y does it not work in \\nproduction?\\u201d  \\nA microservices -based architectu\", \"re has many benefits, but those benefits come at a cost of increased \\ncomplexity. In some cases, the\", \" costs outweigh the benefits, so a monolithic deployment application \\nrunning in a single container \", \"or in just a few container s is a better option.  \\nA monolithic application might not be easily deco\", \"mposable into well -separated microservices. \\nMicroservices should work independently of each other \", \"to provide a more resilient application. If you \\ncan\\u2019t deliver independent feature slices of the app\", \"lication, separating it only adds complexity.  \\nAn application might not yet need to scale features \", \"independently. Many applications, when they \\nneed to scale beyond a single instance, can do so throu\", \"gh the relatively simple process of cloning that \\nentire instance. The additional work to separate t\", \"he application into discrete services provides a \\nminimal benefit when scaling full instances of the\", \" application is simple and cost -effective.  \\nEarly in the development of an application, you might \", \"not have a clear idea where the natural \\nfunctional boundaries are. As you develop a minimum viable \", \"product, the natural separation might \\nnot yet have emerged. Some of these conditions might be tempo\", \"rary . You might start by creating a \\nmonolithic application, and later separate some features to be\", \" developed and deployed as \\nmicroservices. Other conditions might be essential to the application\\u2019s \", \"problem space, meaning that \\nthe application might never be brok en into multiple microservices.  \\nS\", \"eparating an application into many discrete processes also introduces overhead. There\\u2019s more \\ncomple\", \"xity in separating features into different processes. The communication protocols become \\nmore compl\", \"ex. Instead of method calls, you must use asynchronous co mmunications between \\nservices. As you mov\", \"e to a microservices architecture, you need to add many of the building blocks \\nimplemented in the m\", \"icroservices version of the eShopOnContainers application: event bus handling, \\nmessage resiliency a\", \"nd retries, event ual consistency, and more.  \\nThe much simpler eShopOnWeb reference application  su\", \"pports single -container monolithic container \\nusage. The application includes one web application t\", \"hat includes traditional MVC views, web APIs, \\nand Razor Pages. Optionally, you can run the applicat\", \"ion\\u2019s Blazor -based admin component, which \\nrequires a sep arate API project to run as well.  \\nThe a\", \"pplication can be launched from the solution root using the docker -compose build and docker -\\ncompo\", \"se up commands. This command configures a container for the web instance, using the \\nDockerfile foun\", \"d in the web project\\u2019s root, and runs the container on a specified port. You can \\ndownload the sourc\", \"e for this application from GitHub and run it locally. Even this monolithic \\napplication benefits fr\", \"om being deployed in a container environment.  \\nFor one, the containerized deployment means that eve\", \"ry instance of the application runs in the same \\nenvironment. This approach includes the developer e\", \"nvironment where early testing and \\ndevelopment take place. The development team can run the applica\", \"tion i n a containerized \\nenvironment that matches the production environment.   \\n33 CHAPTER 4 | Com\", \"mon web application architectures  \\n In addition, containerized applications scale out at a lower co\", \"st. Using a container environment \\nenables greater resource sharing than traditional VM environments\", \".  \\nFinally, containerizing the application forces a separation between the business logic and the s\", \"torage \\nserver. As the application scales out, the multiple containers will all rely on a single phy\", \"sical storage \\nmedium. This storage medium would typically be a high -availability server running a \", \"SQL Server \\ndatabase.  \\nDocker support  \\nThe eShopOnWeb project runs on .NET. Therefore, it can run \", \"in either Linux -based or Windows -based \\ncontainers. Note that for Docker deployment, you want to u\", \"se the same host type for SQL Server. \\nLinux -based containers allow a smaller footprint and are pre\", \"fe rred. \\nYou can use Visual Studio 2017 or later to add Docker support to an existing application b\", \"y right -\\nclicking on a project in Solution Explorer  and choosing Add > Docker Support . This step \", \"adds the \\nfiles required and modifies the project to use them. The current eShopOnWeb sample already\", \" has \\nthese files in place.  \\nThe solution -level docker -compose.yml file contains information abou\", \"t what images to build and \\nwhat containers to launch. The file allows you to use the docker -compos\", \"e command to launch \\nmultiple applications at the same time. In this case, it is only launc hing the\", \" Web project. You can also \\nuse it to configure dependencies, such as a separate database container.\", \"  \\nversion : '3' \\n \\nservices : \\n  eshopwebmvc : \\n    image : eshopwebmvc  \\n    build : \\n      contex\", \"t : . \\n      dockerfile : src/Web/Dockerfile  \\n    environment : \\n      - ASPNETCORE_ENVIRONMENT=Dev\", \"elopment  \\n    ports : \\n      - \\\"5106:5106\\\"  \\n \\nnetworks : \\n  default : \\n    external : \\n      name \", \": nat \\nThe docker -compose.yml file references the Dockerfile in the Web project. The Dockerfile is \", \"used to \\nspecify which base container will be used and how the application will be configured on it.\", \" The Web\\u2019 \\nDockerfile:  \\nFROM mcr.microsoft.com/dotnet/sdk:8.0 AS build \\nWORKDIR /app \\n \\nCOPY *.sln \", \". \\nCOPY . . \\nWORKDIR /app/src/Web  \\nRUN dotnet restore  \\n34 CHAPTER 4 | Common web application archi\", \"tectures  \\n  \\nRUN dotnet publish -c Release -o out \\n \\nFROM mcr.microsoft.com/dotnet/aspnet:8.0 AS ru\", \"ntime \\nWORKDIR /app \\nCOPY --from=build  /app/src/Web/out ./  \\n \\nENTRYPOINT  [\\\"dotnet\\\" , \\\"Web.dll\\\" ] \", \"\\nTroubleshooting Docker problems  \\nOnce you run the containerized application, it continues to run u\", \"ntil you stop it. You can view which \\ncontainers are running with the docker ps command. You can sto\", \"p a running container by using the \\ndocker stop command and specifying the container ID.  \\nNote that\", \" running Docker containers may be bound to ports you might otherwise try to use in your \\ndevelopment\", \" environment. If you try to run or debug an application using the same port as a running \\nDocker con\", \"tainer, you\\u2019ll get an error stating that the serv er can\\u2019t bind to that port. Once again, \\nstopping \", \"the container should resolve the issue.  \\nIf you want to add Docker support to your application usin\", \"g Visual Studio, make sure Docker Desktop \\nis running when you do so. The wizard won\\u2019t run correctly\", \" if Docker Desktop isn\\u2019t running when you \\nstart the wizard. In addition, the wizard examines your c\", \"urrent container choice to add the correct  \\nDocker support. If you want to add, support for Windows\", \" Containers, you need to run the wizard \\nwhile you have Docker Desktop running with Windows Containe\", \"rs configured. If you want to add, \\nsupport for Linux containers, run the wizard while you have Dock\", \"er  running with Linux containers \\nconfigured.  \\nOther web application architectural styles  \\n\\u2022 Web-\", \"Queue -Worker : The core components of this architecture are a web front end that \\nserves client req\", \"uests, and a worker that performs resource -intensive tasks, long -running \\nworkflows, or batch jobs\", \". The web front end communicates with the worker through a \\nmessage queue.  \\n\\u2022 N-tier: An N -tier ar\", \"chitecture divides an application into logical layers and physical tiers.  \\n\\u2022 Microservice : A micro\", \"services architecture consists of a collection of small, autonomous \\nservices. Each service is self \", \"-contained and should implement a single business capability \\nwithin a bounded context.  \\nReferences\", \" \\u2013 Common web architectures  \\n\\u2022 The Clean Architecture  \\nhttps://blog.cleancoder.com/uncle -bob/2012\", \"/08/13/the -clean -architecture.html  \\n\\u2022 The Onion Architecture  \\nhttps://jeffreypalermo.com/blog/th\", \"e -onion -architecture -part-1/ \\n\\u2022 The Repository Pattern  \\nhttps://deviq.com/repository -pattern/  \", \"\\n\\u2022 Clean Architecture Solution Template  \\nhttps://github.com/ardalis/cleanarchitecture   \\n35 CHAPTER\", \" 4 | Common web application architectures  \\n \\u2022 Architecting Microservices e -book  \\nhttps://aka.ms/M\", \"icroservicesEbook  \\n\\u2022 DDD (Domain -Driven Design)  \\nhttps://learn.microsoft.com/dotnet/architecture/\", \"microservices/microservice -ddd-cqrs-\\npatterns/   \\n36 CHAPTER 5 | Common client -side web technologi\", \"es  \\n CHAPTER  5 \\nCommon client -side web \\ntechnologies  \\n\\u201cWebsites should look good from the inside\", \" and out.\\u201d - Paul Cookson  \\nASP.NET Core applications are web applications and they typically rely o\", \"n client -side web \\ntechnologies like HTML, CSS, and JavaScript. By separating the content of the pa\", \"ge (the HTML) from \\nits layout and styling (the CSS), and its behavior (via JavaScript) , complex we\", \"b apps can leverage the \\nSeparation of Concerns principle. Future changes to the structure, design, \", \"or behavior of the \\napplication can be made more easily when these concerns are not intertwined.  \\nW\", \"hile HTML and CSS are relatively stable, JavaScript, by means of the application frameworks and \\nuti\", \"lities developers work with to build web -based applications, is evolving at breakneck speed. This \\n\", \"chapter looks at a few ways that JavaScript is used by web  developers and provides a high -level \\no\", \"verview of the Angular and React client -side libraries.  \\nNote  \\nBlazor provides an alternative to \", \"JavaScript frameworks for building rich, interactive client user \\ninterfaces.  \\nHTML  \\nHTML is the s\", \"tandard markup language used to create web pages and web applications. Its elements \\nform the buildi\", \"ng blocks of pages, representing formatted text, images, form inputs, and other \\nstructures. When a \", \"browser makes a request to a URL, whether fetching a page  or an application, the \\nfirst thing that \", \"is returned is an HTML document. This HTML document may reference or include \\nadditional information\", \" about its look and layout in the form of CSS, or behavior in the form of \\nJavaScript.  \\nCSS \\nCSS (C\", \"ascading Style Sheets) is used to control the look and layout of HTML elements. CSS styles can \\nbe a\", \"pplied directly to an HTML element, defined separately on the same page, or defined in a \\nseparate f\", \"ile and referenced by the page. Styles cascade based  on how they are used to select a given \\nHTML e\", \"lement. For instance, a style might apply to an entire document, but would be overridden by a  \\n37 C\", \"HAPTER 5 | Common client -side web technologies  \\n style that applied to a particular element. Likew\", \"ise, an element -specific style would be overridden by a \\nstyle that applied to a CSS class that was\", \" applied to the element, which in turn would be overridden \\nby a style targeting a specific instance\", \" of that e lement (via its ID). Figure 6 -1 \\n \\nFigure 6 -1. CSS Specificity rules, in order.  \\nIt\\u2019s \", \"best to keep styles in their own separate stylesheet files, and to use selection -based cascading to\", \" \\nimplement consistent and reusable styles within the application. Placing style rules within HTML \\n\", \"should be avoided, and applying styles to specific ind ividual elements (rather than whole classes o\", \"f \\nelements, or elements that have had a particular CSS class applied to them) should be the excepti\", \"on, \\nnot the rule.  \\nCSS preprocessors  \\nCSS stylesheets lack support for conditional logic, variabl\", \"es, and other programming language \\nfeatures. Thus, large stylesheets often include quite a bit of r\", \"epetition, as the same color, font, or other \\nsetting is applied to many different variations of HT \", \"ML elements and CSS classes. CSS preprocessors \\ncan help your stylesheets follow the DRY principle  \", \"by adding support for variables and logic.  \\nThe most popular CSS preprocessors are Sass and LESS. B\", \"oth extend CSS and are backward \\ncompatible with it, meaning that a plain CSS file is a valid Sass o\", \"r LESS file. Sass is Ruby -based and \\nLESS is JavaScript based, and both typically run as part of yo\", \"ur local development process. Both have \\ncommand -line tools available, as well as built -in support\", \" in Visual Studio for running them using Gulp \\nor Grunt tasks.  \\n \\n38 CHAPTER 5 | Common client -sid\", \"e web technologies  \\n JavaScript  \\nJavaScript is a dynamic, interpreted programming language that ha\", \"s been standardized in the \\nECMAScript language specification. It is the programming language of the\", \" web. Like CSS, JavaScript \\ncan be defined as attributes within HTML elements, as blocks of s cript \", \"within a page, or in separate \\nfiles. Just like CSS, it\\u2019s recommended to organize JavaScript into se\", \"parate files, keeping it separated as \\nmuch as possible from the HTML found on individual web pages \", \"or application views.  \\nWhen working with JavaScript in your web application, there are a few tasks \", \"that you\\u2019ll commonly \\nneed to perform:  \\n\\u2022 Selecting an HTML element and retrieving and/or updating \", \"its value.  \\n\\u2022 Querying a Web API for data.  \\n\\u2022 Sending a command to a Web API (and responding to a \", \"callback with its result).  \\n\\u2022 Performing validation.  \\nYou can perform all of these tasks with Java\", \"Script alone, but many libraries exist to make these tasks \\neasier. One of the first and most succes\", \"sful of these libraries is jQuery, which continues to be a \\npopular choice for simplifying these tas\", \"ks on web page s. For Single Page Applications (SPAs), jQuery \\ndoesn\\u2019t provide many of the desired f\", \"eatures that Angular and React offer.  \\nLegacy web apps with jQuery  \\nAlthough ancient by JavaScript\", \" framework standards, jQuery continues to be a commonly used library \\nfor working with HTML/CSS and \", \"building applications that make AJAX calls to web APIs. However, \\njQuery operates at the level of th\", \"e browser document object mo del (DOM), and by default offers only \\nan imperative, rather than decla\", \"rative, model.  \\nFor example, imagine that if a textbox\\u2019s value exceeds 10, an element on the page s\", \"hould be made \\nvisible. In jQuery, this functionality would typically be implemented by writing an e\", \"vent handler with \\ncode that would inspect the textbox\\u2019s value and set the visibility of the target \", \"element based on that \\nvalue. This process is an imperative, code -based approach. Another framework\", \" might instead use \\ndatabinding to bind the visibility of the element to the value of the textbox de\", \"claratively. This \\napproach would n ot require writing any code, but instead only requires decoratin\", \"g the elements \\ninvolved with data binding attributes. As client -side behaviors grow more complex, \", \"data binding \\napproaches frequently result in simpler solutions with less code and conditional compl\", \"exity.  \\njQuery vs a SPA Framework  \\nFactor  jQuery  Angular  \\nAbstracts the DOM  Yes Yes \\nAJAX Supp\", \"ort  Yes Yes \\nDeclarative Data Binding  No Yes \\nMVC -style Routing  No Yes  \\n39 CHAPTER 5 | Common c\", \"lient -side web technologies  \\n Factor  jQuery  Angular  \\nTemplating  No Yes \\nDeep -Link Routing  No\", \" Yes \\nMost of the features jQuery lacks intrinsically can be added with the addition of other librar\", \"ies. \\nHowever, a SPA framework like Angular provides these features in a more integrated fashion, si\", \"nce it\\u2019s \\nbeen designed with all of them in mind from the start. Also, jQuer y is an imperative libr\", \"ary, meaning \\nthat you need to call jQuery functions in order to do anything with jQuery. Much of th\", \"e work and \\nfunctionality that SPA frameworks provide can be done declaratively, requiring no actual\", \" code to be \\nwritten.  \\nData binding is a great example of this functionality. In jQuery, it usually\", \" only takes one line of code to \\nget the value of a DOM element or to set an element\\u2019s value. Howeve\", \"r, you have to write this code \\nanytime you need to change the value of the elemen t, and sometimes \", \"this will occur in multiple \\nfunctions on a page. Another common example is element visibility. In j\", \"Query, there might be many \\ndifferent places where you\\u2019d write code to control whether certain eleme\", \"nts were visible. In each of \\nthese cases,  when using data binding, no code would need to be writte\", \"n. You\\u2019d simply bind the value \\nor visibility of the elements in question to a viewmodel  on the pag\", \"e, and changes to that viewmodel \\nwould automatically be reflected in the bound elements.  \\nAngular \", \"SPAs  \\nAngular remains one of the world\\u2019s most popular JavaScript frameworks. Since Angular 2, the t\", \"eam \\nrebuilt the framework from the ground up (using TypeScript ) and rebranded from the original \\nA\", \"ngularJS name to Angular. Now several years old, the redesigned Angular continues to be a robust \\nfr\", \"amework for building Single Page Applications.  \\nAngular applications are built from components. Com\", \"ponents combine HTML templates with special \\nobjects and control a portion of the page. A simple com\", \"ponent from Angular\\u2019s docs is shown here:  \\nimport { Component } from '@angular/core' ; \\n \\n@Componen\", \"t ({ \\n    selector : 'my-app', \\n    template : `<h1>Hello {{name}}</h1>`  \\n}) \\n \\nexport class AppCom\", \"ponent { name = 'Angular' ; } \\nComponents are defined using the @Component decorator function, which\", \" takes in metadata about \\nthe component. The selector property identifies the ID of the element on t\", \"he page where this \\ncomponent will be displayed. The template property is a simple HTML template tha\", \"t includes a \\nplaceholder that corresponds to the component\\u2019s name property, defined on the last lin\", \"e.  \\nBy working with components and templates, instead of DOM elements, Angular apps can operate at \", \"a \\nhigher level of abstraction and with less overall code than apps written using just JavaScript (a\", \"lso \\ncalled \\u201cvanilla JS\\u201d) or with jQuery. Angular also imposes some order on how you organize your c\", \"lient -\\nside script files. By convention, Angular apps use a common folder structure, with module an\", \"d  \\n40 CHAPTER 5 | Common client -side web technologies  \\n component script files located in an app \", \"folder. Angular scripts concerned with building, deploying, \\nand testing the app are typically locat\", \"ed in a higher -level folder.  \\nYou can develop Angular apps by using a CLI. Getting started with An\", \"gular development locally \\n(assuming you already have git and npm installed) consists of simply clon\", \"ing a repo from GitHub and \\nrunning npm install and npm start. Beyond this, Angular ships its own CL\", \"I, which can create projects, \\nadd files, and assist with testing, bundling, and deployment tasks. T\", \"his CLI friendliness makes Angular \\nespecially compatible with ASP.NET Core, which also features gre\", \"at CLI support.  \\nMicrosoft has developed a reference application, eShopOnContainers, which includes\", \" an Angular SPA \\nimplementation. This app includes Angular modules to manage the online store\\u2019s shop\", \"ping basket, \\nload and display items from its catalog, and handling order cr eation. You can view an\", \"d download the \\nsample application from GitHub . \\nReact  \\nUnlike Angular, which offers a full Model \", \"-View -Controller pattern implementation, React is only \\nconcerned with views. It\\u2019s not a framework,\", \" just a library, so to build a SPA you\\u2019ll need to leverage \\nadditional libraries. There are a number\", \" of libraries that  are designed to be used with React to \\nproduce rich single page applications.  \\n\", \"One of React\\u2019s most important features is its use of a virtual DOM. The virtual DOM provides React \\n\", \"with several advantages, including performance (the virtual DOM can optimize which parts of the \\nact\", \"ual DOM need to be updated) and testability (no need to ha ve a browser to test React and its \\ninter\", \"actions with its virtual DOM).  \\nReact is also unusual in how it works with HTML. Rather than having\", \" a strict separation between code \\nand markup (with references to JavaScript appearing in HTML attri\", \"butes perhaps), React adds HTML \\ndirectly within its JavaScript code as JSX. JSX is HTML -like synta\", \"x that can compile down to pure \\nJavaScript. For example:  \\n<ul> \\n{ authors .map(author => \\n    <li \", \"key={author.id}>{author.name}</li> \\n)} \\n</ul> \\nIf you already know JavaScript, learning React should\", \" be easy. There isn\\u2019t nearly as much learning \\ncurve or special syntax involved as with Angular or o\", \"ther popular libraries.  \\nBecause React isn\\u2019t a full framework, you\\u2019ll typically want other librarie\", \"s to handle things like routing, \\nweb API calls, and dependency management. The nice thing is, you c\", \"an pick the best library for each \\nof these, but the disadvantage is that you need t o make all of t\", \"hese decisions and verify all of your \\nchosen libraries work well together when you\\u2019re done. If you \", \"want a good starting point, you can use \\na starter kit like React Slingshot, which prepackages a set\", \" of compatible libraries together with Reac t. \\nVue \\nFrom its getting started guide, \\u201cVue is a progr\", \"essive framework for building user interfaces. Unlike \\nother monolithic frameworks, Vue is designed \", \"from the ground up to be incrementally adoptable. The  \\n41 CHAPTER 5 | Common client -side web techn\", \"ologies  \\n core library is focused on the view layer only, and is easy to pick up and integrate with\", \" other libraries \\nor existing projects. On the other hand, Vue is perfectly capable of powering soph\", \"isticated Single -\\nPage Applications when used in combination with mod ern tooling and supporting li\", \"braries.\\u201d  \\nGetting started with Vue simply requires including its script within an HTML file:  \\n<!-\", \"- development version, includes helpful console warnings --> \\n<script src=\\\"https://cdn.jsdelivr.net/\", \"npm/vue/dist/vue.js\\\" ></script> \\nWith the framework added, you\\u2019re then able to declaratively render \", \"data to the DOM using \\nVue\\u2019s straightforward templating syntax:  \\n<div id=\\\"app\\\"> \\n  {{ message }}  \\n\", \"</div> \\nand then adding the following script:  \\nvar app = new Vue({ \\n  el: '#app', \\n  data: { \\n    m\", \"essage: 'Hello Vue!'  \\n  } \\n}) \\nThis is enough to render \\\"Hello Vue!\\\" on the page. Note, however, th\", \"at Vue isn\\u2019t simply rendering the \\nmessage to the div once. It supports databinding and dynamic upda\", \"tes such that if the value of \\nmessage changes, the value in the <div> is immediately upda ted to re\", \"flect it.  \\nOf course, this only scratches the surface of what Vue is capable of. It\\u2019s gained a grea\", \"t deal of \\npopularity in the last several years and has a large community. There\\u2019s a huge and growin\", \"g list of \\nsupporting components and libraries  that work with Vue to extend it as well. If you\\u2019re l\", \"ooking to add \\nclient -side behavior to your web application or considering building a full SPA, Vue\", \" is worth \\ninvestigating.  \\nBlazor WebAssembly  \\nUnlike other JavaScript frameworks, Blazor WebAssem\", \"bly is a single -page app (SPA) framework for \\nbuilding interactive client -side web apps with .NET.\", \" Blazor WebAssembly uses open web standards \\nwithout plugins or recompiling code into other language\", \"s. Blazor  WebAssembly works in all modern \\nweb browsers, including mobile browsers.  \\nRunning .NET \", \"code inside web browsers is made possible by WebAssembly (abbreviated wasm). \\nWebAssembly is a compa\", \"ct bytecode format optimized for fast download and maximum execution \\nspeed. WebAssembly is an open \", \"web standard and is supported in web browsers  without plugins.  \\nWebAssembly code can access the fu\", \"ll functionality of the browser via JavaScript, called JavaScript \\ninteroperability, often shortened\", \" to JavaScript interop or JS interop. .NET code executed via \\nWebAssembly in the browser runs in the\", \" browser\\u2019s JavaScript sandbox with the protections that the \\nsandbox provides against malicious acti\", \"ons on the client machine.  \\nFor more information, see Introduction to ASP.NET Core Blazor . \\nChoosi\", \"ng a SPA Framework  \\nWhen considering which option will work best to support your SPA, keep in mind \", \"the following \\nconsiderations:   \\n42 CHAPTER 5 | Common client -side web technologies  \\n \\u2022 Is your t\", \"eam familiar with the framework and its dependencies (including TypeScript in some \\ncases)?  \\n\\u2022 How \", \"opinionated is the framework, and do you agree with its default way of doing things?  \\n\\u2022 Does it (or\", \" a companion library) include all of the features your app requires?  \\n\\u2022 Is it well documented?  \\n\\u2022 \", \"How active is its community? Are new projects being built with it?  \\n\\u2022 How active is its core team? \", \"Are issues being resolved and new versions shipped regularly?  \\nFrameworks continue to evolve with b\", \"reakneck speed. Use the considerations listed above to help \\nmitigate the risk of choosing a framewo\", \"rk you\\u2019ll later regret being dependent upon. If you\\u2019re \\nparticularly risk -averse, consider a framew\", \"ork that offers commerc ial support and/or is being \\ndeveloped by a large enterprise.  \\nReferences \\u2013\", \" Client Web Technologies  \\n\\u2022 HTML and CSS  \\nhttps://www.w3.org/standards/webdesign/htmlcss  \\n\\u2022 Sass \", \"vs.  LESS  \\nhttps://www.keycdn.com/blog/sass -vs-less/ \\n\\u2022 Styling ASP.NET Core Apps with LESS, Sass,\", \" and Font Awesome  \\nhttps://learn.microsoft.com/aspnet/core/client -side/less -sass-fa \\n\\u2022 Client -Si\", \"de Development in ASP.NET Core  \\nhttps://learn.microsoft.com/aspnet/core/client -side/  \\n\\u2022 jQuery  \\n\", \"https://jquery.com/  \\n\\u2022 Angular  \\nhttps://angular.io/  \\n\\u2022 React  \\nhttps://reactjs.org/  \\n\\u2022 Vue \\nhttp\", \"s://vuejs.org/  \\n\\u2022 Angular vs React vs Vue: Which Framework to Choose in 2020  \\nhttps://www.codeinwp\", \".com/blog/angular -vs-vue-vs-react/  \\n\\u2022 The Top JavaScript Frameworks for Front -End Development in \", \"2020  \\nhttps://www.freecodecamp.org/news/complete -guide -for-front -end-developers -javascript -\\nfr\", \"ameworks -2019/   \\n43 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n CHAPTER  6 \\nDevelop ASP.NET Core \", \"\\nMVC apps  \\n\\u201cIt\\u2019s not important to get it right the first time. It\\u2019s vitally important to get it rig\", \"ht the last time.\\u201d - \\nAndrew Hunt and David Thomas  \\nASP.NET Core is a cross -platform, open -source\", \" framework for building modern cloud -optimized web \\napplications. ASP.NET Core apps are lightweight\", \" and modular, with built -in support for dependency \\ninjection, enabling greater testability and mai\", \"ntainability. C ombined with MVC, which supports \\nbuilding modern web APIs in addition to view -base\", \"d apps, ASP.NET Core is a powerful framework \\nwith which to build enterprise web applications.  \\nMVC\", \" and Razor Pages  \\nASP.NET Core MVC offers many features that are useful for building web -based API\", \"s and apps. The \\nterm MVC stands for \\u201cModel -View -Controller\\u201d, a UI pattern that breaks up the resp\", \"onsibilities of \\nresponding to user requests into several parts. In addition to following this patte\", \"rn, you can also \\nimplement features in your ASP.NET Core apps as Razor Pages.  \\nRazor Pages are bui\", \"lt into ASP.NET Core MVC, and use the same features for routing, model binding, \\nfilters, authorizat\", \"ion, etc. However, instead of having separate folders and files for Controllers, Models, \\nViews, etc\", \". and using attribute -based routing, Ra zor Pages are placed in a single folder (\\u201c/Pages\\u201d), \\nroute \", \"based on their relative location in this folder, and handle requests with handlers instead of \\ncontr\", \"oller actions. As a result, when working with Razor Pages, all of the files and classes you need ar \", \"e \\ntypically colocated, not spread throughout the web project.  \\nLearn more about how MVC, Razor Pag\", \"es, and related patterns are applied in the eShopOnWeb \\nsample application . \\nWhen you create a new \", \"ASP.NET Core App, you should have a plan in mind for the kind of app you \\nwant to build. When creati\", \"ng a new project, in your IDE or using the dotnet new CLI command, you \\nwill choose from several tem\", \"plates. The most common project temp lates are Empty, Web API, Web \\nApp, and Web App (Model -View -C\", \"ontroller). Although you can only make this decision when you first \\ncreate a project, it\\u2019s not an i\", \"rrevocable decision. The Web API project uses standard Model -View -\\nController controllers \\u2013 it jus\", \" t lacks Views by default. Likewise, the default Web App template uses \\nRazor Pages, and so also lac\", \"ks a Views folder. You can add a Views folder to these projects later to \\nsupport view -based behavi\", \"or. Web API and Model -View -Controller projects don\\u2019t include  a Pages  \\n44 CHAPTER 6 | Develop ASP\", \".NET Core MVC apps  \\n folder by default, but you can add one later to support Razor Pages -based beh\", \"avior. You can think of \\nthese three templates as supporting three different kinds of default user i\", \"nteraction: data (web API), \\npage -based, and view -based. However, you can mix and  match any or al\", \"l of these templates within a \\nsingle project if you wish.  \\nWhy Razor Pages?  \\nRazor Pages is the d\", \"efault approach for new web applications in Visual Studio. Razor Pages offers a \\nsimpler way of buil\", \"ding page -based application features, such as non -SPA forms. Using controllers \\nand views, it was \", \"common for applications to have very lar ge controllers that worked with many \\ndifferent dependencie\", \"s and view models and returned many different views. This resulted in more \\ncomplexity and often res\", \"ulted in controllers that didn\\u2019t follow the Single Responsibility Principle or \\nOpen/Closed Principl\", \" es effectively. Razor Pages addresses this issue by encapsulating the server -side \\nlogic for a giv\", \"en logical \\u201cpage\\u201d in a web application with its Razor markup. A Razor Page that has no \\nserver -side\", \" logic can only consist of a Razor file (for instance, \\u201cIndex .cshtml\\u201d). However, most non -\\ntrivial\", \" Razor Pages will have an associated page model class, which by convention is named the same \\nas the\", \" Razor file with a \\u201c.cs\\u201d extension (for example, \\u201cIndex.cshtml.cs\\u201d).  \\nA Razor Page\\u2019s page model com\", \"bines the responsibilities of an MVC controller and a viewmodel. \\nInstead of handling requests with \", \"controller action methods, page model handlers like \\u201cOnGet()\\u201d are \\nexecuted, rendering their associa\", \"ted page by default. Razor Pa ges simplifies the process of building \\nindividual pages in an ASP.NET\", \" Core app, while still providing all the architectural features of ASP.NET \\nCore MVC. They\\u2019re a good\", \" default choice for new page -based functionality.  \\nWhen to use MVC  \\nIf you\\u2019re building web APIs, \", \"the MVC pattern makes more sense than trying to use Razor Pages. If your \\nproject will only expose w\", \"eb API endpoints, you should ideally start from the Web API project \\ntemplate. Otherwise, it\\u2019s easy \", \"to add controllers and associ ated API endpoints to any ASP.NET Core \\napp. Use the view -based MVC a\", \"pproach if you\\u2019re migrating an existing application from ASP.NET MVC \\n5 or earlier to ASP.NET Core M\", \"VC and you want to do so with the least amount of effort. Once you\\u2019ve \\nmade the initial mi gration, \", \"you can evaluate whether it makes sense to adopt Razor Pages for new \\nfeatures or even as a wholesal\", \"e migration. For more information about porting .NET 4.x apps to .NET \\n8, see Porting Existing ASP.N\", \"ET Apps to ASP.NET Core eBook . \\nWhether you choose to build your web app using Razor Pages or MVC v\", \"iews, your app will have \\nsimilar performance and will include support for dependency injection, fil\", \"ters, model binding, \\nvalidation, and so on.  \\nMapping requests to responses  \\nAt its heart, ASP.NET\", \" Core apps map incoming requests to outgoing responses. At a low level, this \\nmapping is done with m\", \"iddleware, and simple ASP.NET Core apps and microservices may be \\ncomprised solely of custom middlew\", \"are. When using ASP.NET Core MVC, you  can work at a \\nsomewhat higher level, thinking in terms of ro\", \"utes , controllers , and actions . Each incoming request is \\ncompared with the application\\u2019s routing\", \" table, and if a matching route is found, the associated action  \\n45 CHAPTER 6 | Develop ASP.NET Cor\", \"e MVC apps  \\n method (belonging to a controller) is called to handle the request. If no matching rou\", \"te is found, an \\nerror handler (in this case, returning a NotFound result) is called.  \\nASP.NET Core\", \" MVC apps can use conventional routes, attribute routes, or both. Conventional routes \\nare defined i\", \"n code, specifying routing conventions  using syntax like in the example below:  \\napp.UseEndpoints (\", \"endpoints => \\n{ \\n    endpoints .MapControllerRoute (name: \\\"default\\\" , pattern: \\n\\\"{controller=Home}/{\", \"action=Index}/{id?}\\\" ); \\n}); \\nIn this example, a route named \\u201cdefault\\u201d has been added to the routing\", \" table. It defines a route \\ntemplate with placeholders for controller, action, and id. The controlle\", \"r and action placeholders have \\nthe default specified (Home and Index, respectively), an d the id pl\", \"aceholder is optional (by virtue of a \\n\\u201c?\\u201d applied to it). The convention defined here states that t\", \"he first part of a request should correspond \\nto the name of the controller, the second part to the \", \"action, and then if necessary a third part will  \\nrepresent an ID parameter. Conventional routes are\", \" typically defined in one place for the application, \\nsuch as in Program.cs  where the request middl\", \"eware pipeline is configured.  \\nAttribute routes are applied to controllers and actions directly, ra\", \"ther than specified globally. This \\napproach has the advantage of making them much more discoverable\", \" when you\\u2019re looking at a \\nparticular method, but does mean that routing information is no t kept in\", \" one place in the application. \\nWith attribute routes, you can easily specify multiple routes for a \", \"given action, as well as combine \\nroutes between controllers and actions. For example:  \\n[Route(\\\"Hom\", \"e\\\")] \\npublic class HomeController : Controller  \\n{ \\n    [Route(\\\"\\\")] // Combines to define the route \", \"template \\\"Home\\\"  \\n    [Route(\\\"Index\\\")] // Combines to define route template \\\"Home/Index\\\"  \\n    [Rout\", \"e(\\\"/\\\")] // Does not combine, defines the route template \\\"\\\"  \\n    public IActionResult Index() {} \\n} \", \"\\nRoutes can be specified on [HttpGet] and similar attributes, avoiding the need to add separate [Rou\", \"te] \\nattributes. Attribute routes can also use tokens to reduce the need to repeat controller or act\", \"ion \\nnames, as shown below:  \\n[Route(\\\"[controller]\\\" )] \\npublic class ProductsController : Controller\", \"  \\n{ \\n    [Route(\\\"\\\")] // Matches 'Products'  \\n    [Route(\\\"Index\\\")] // Matches 'Products/Index'  \\n   \", \" public IActionResult Index() {} \\n} \\nRazor Pages don\\u2019t use attribute routing. You can specify additi\", \"onal route template information for a \\nRazor Page as part of its @page directive:  \\n@page \\\"{id:int}\\\"\", \"   \\n46 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n In the previous example, the page in question wo\", \"uld match a route with an integer id parameter. For \\nexample, the Products.cshtml  page located in t\", \"he root of /Pages would respond to requests like this \\none: \\n/Products/123  \\nOnce a given request ha\", \"s been matched to a route, but before the action method is called, ASP.NET \\nCore MVC will perform mo\", \"del binding  and model validation  on the request. Model binding is \\nresponsible for converting inco\", \"ming HTTP data into the .NET types specified as parameters of the \\naction method to be called. For e\", \"xample, if the action method expects an int id parameter, model \\nbinding will attempt to prov ide th\", \"is parameter from a value provided as part of the request. To do so, \\nmodel binding looks for values\", \" in a posted form, values in the route itself, and query string values. \\nAssuming an id value is fou\", \"nd, it will be converted to an integer before being passed into the action \\nmethod.  \\nAfter binding \", \"the model but before calling the action method, model validation occurs. Model \\nvalidation uses opti\", \"onal attributes on the model type, and can help ensure that the provided model \\nobject conforms to c\", \"ertain data requirements. Certain values may  be specified as required, or limited \\nto a certain len\", \"gth or numeric range, etc. If validation attributes are specified but the model does not \\nconform to\", \" their requirements, the property ModelState.IsValid will be false, and the set of failing \\nvalidati\", \"on r ules will be available to send to the client making the request.  \\nIf you\\u2019re using model valida\", \"tion, you should be sure to always check that the model is valid before \\nperforming any state -alter\", \"ing commands, to ensure your app is not corrupted by invalid data. You can \\nuse a filter to avoid th\", \"e need to add code for this validation in every action. ASP.NET Core MVC filters \\noffer a way of int\", \"ercepting groups of requests, so that common policies and cross -cutting concerns \\ncan be applied on\", \" a targeted basis. Filters can be applied to in dividual actions, whole controllers, or \\nglobally fo\", \"r an application.  \\nFor web APIs, ASP.NET Core MVC supports content negotiation , allowing requests \", \"to specify how \\nresponses should be formatted. Based on headers provided in the request, actions ret\", \"urning data will \\nformat the response in XML, JSON, or another supported format. This feature enable\", \"s the same API to \\nbe used by multiple clients with different data format requirements.  \\nWeb API pr\", \"ojects should consider using the [ApiController] attribute, which can be applied to \\nindividual cont\", \"rollers, to a base controller class, or to the entire assembly. This attribute adds \\nautomatic model\", \" validation checking and any action with an inva lid model will return a BadRequest \\nwith the detail\", \"s of the validation errors. The attribute also requires all actions have an attribute route, \\nrather\", \" than using a conventional route, and returns more detailed ProblemDetails information in \\nresponse \", \"to error s. \\nKeeping controllers under control  \\nFor page -based applications, Razor Pages do a grea\", \"t job of keeping controllers from getting too \\nlarge. Each individual page is given its own files an\", \"d classes dedicated just to its handler(s). Prior to \\nthe introduction of Razor Pages, many view -ce\", \"ntric app lications would have large controller classes \\nresponsible for many different actions and \", \"views. These classes would naturally grow to have many \\nresponsibilities and dependencies, making th\", \"em harder to maintain. If you find your view -based  \\n47 CHAPTER 6 | Develop ASP.NET Core MVC apps  \", \"\\n controllers are growing too large, consider refactoring them to use Razor Pages, or introducing a \", \"\\npattern like a mediator.  \\nThe mediator design pattern is used to reduce coupling between classes w\", \"hile allowing \\ncommunication between them. In ASP.NET Core MVC applications, this pattern is frequen\", \"tly employed \\nto break up controllers into smaller pieces by using handlers  to do the work of actio\", \"n methods. The \\npopular MediatR NuGet package  is often used to accomplish this. Typically, controll\", \"ers include many \\ndifferent action methods, each of which may require certain dependencies. The set \", \"of all \\ndependencies required by any action must be passed into the controller\\u2019s constructor. When u\", \"sing  \\nMediatR, the only dependency a controller will typically have is an instance of the mediator.\", \" Each \\naction then uses the mediator instance to send a message, which is processed by a handler. Th\", \"e \\nhandler is specific to a single action and thus only needs th e dependencies required by that act\", \"ion. An \\nexample of a controller using MediatR is shown here:  \\npublic class OrderController : Contr\", \"oller  \\n{ \\n    private readonly  IMediator _mediator ; \\n \\n    public OrderController (IMediator medi\", \"ator ) \\n    { \\n        _mediator = mediator ; \\n    } \\n \\n    [HttpGet] \\n    public async Task <IActio\", \"nResult > MyOrders () \\n    { \\n        var viewModel = await _mediator .Send(new GetMyOrders (User.Id\", \"entity .Name)); \\n        return View(viewModel ); \\n    } \\n    // other actions implemented similarly\", \"  \\n} \\nIn the MyOrders action, the call to Send a GetMyOrders message is handled by this class:  \\npub\", \"lic class GetMyOrdersHandler : IRequestHandler <GetMyOrders , IEnumerable <OrderViewModel >> \\n{ \\n   \", \" private readonly  IOrderRepository _orderRepository ; \\n    public GetMyOrdersHandler (IOrderReposit\", \"ory orderRepository ) \\n    { \\n        _orderRepository = orderRepository ; \\n    } \\n \\n  public async \", \"Task <IEnumerable <OrderViewModel >> Handle(GetMyOrders request , \\nCancellationToken cancellationTok\", \"en ) \\n    { \\n        var specification = new CustomerOrdersWithItemsSpecification (request.UserName \", \"); \\n        var orders = await _orderRepository .ListAsync (specification ); \\n        return orders.\", \"Select(o => new OrderViewModel  \\n            { \\n                OrderDate = o.OrderDate , \\n         \", \"       OrderItems = o.OrderItems ?.Select(oi => new OrderItemViewModel () \\n                  { \\n    \", \"                PictureUrl = oi.ItemOrdered .PictureUri , \\n                    ProductId = oi.ItemOr\", \"dered .CatalogItemId , \\n                    ProductName = oi.ItemOrdered .ProductName , \\n           \", \"         UnitPrice = oi.UnitPrice , \\n                    Units = oi.Units  \\n48 CHAPTER 6 | Develop A\", \"SP.NET Core MVC apps  \\n                   }).ToList(), \\n                OrderNumber = o.Id, \\n       \", \"         ShippingAddress = o.ShipToAddress , \\n                Total = o.Total() \\n        }); \\n    } \", \"\\n} \\nThe end result of this approach is for controllers to be much smaller and focused primarily on r\", \"outing \\nand model binding, while individual handlers are responsible for the specific tasks needed b\", \"y a given \\nendpoint. This approach can also be achieved withou t MediatR by using the ApiEndpoints N\", \"uGet \\npackage , which attempts to bring to API controllers the same benefits Razor Pages brings to v\", \"iew -\\nbased controllers.  \\nReferences \\u2013 Mapping Requests to Responses  \\n\\u2022 Routing to Controller Acti\", \"ons  \\nhttps://learn.microsoft.com/aspnet/core/mvc/controllers/routing  \\n\\u2022 Model Binding  \\nhttps://le\", \"arn.microsoft.com/aspnet/core/mvc/models/model -binding  \\n\\u2022 Model Validation  \\nhttps://learn.microso\", \"ft.com/aspnet/core/mvc/models/validation  \\n\\u2022 Filters  \\nhttps://learn.microsoft.com/aspnet/core/mvc/c\", \"ontrollers/filters  \\n\\u2022 ApiController Attribute  \\nhttps://learn.microsoft.com/aspnet/core/web -api/ \\n\", \"Working with dependencies  \\nASP.NET Core has built -in support for and internally makes use of a tec\", \"hnique known as dependency \\ninjection . Dependency injection is a technique that enables loose coupl\", \"ing between different parts of \\nan application. Looser coupling is desirable because it makes it eas\", \"ier to isolate parts of the \\napplication, allowing for testing or replacement. It also makes it less\", \" likely that a change in one part of \\nthe application will have an unexpected impact somewhere else \", \"in the application. Dependency \\ninjection is based on the dependency inversion principle, and is oft\", \"en key to achieving the \\nopen/closed principle. When ev aluating how your application works with its\", \" dependencies, beware of \\nthe static cling  code smell, and remember the aphorism \\u201c new is glue .\\u201d \\n\", \"Static cling occurs when your classes make calls to static methods, or access static properties, whi\", \"ch \\nhave side effects or dependencies on infrastructure. For example, if you have a method that call\", \"s a \\nstatic method, which in turn writes to a database, yo ur method is tightly coupled to the datab\", \"ase. \\nAnything that breaks that database call will break your method. Testing such methods is notori\", \"ously \\ndifficult, since such tests either require commercial mocking libraries to mock the static ca\", \"lls, or can \\nonly be tested with a test database in place. Static calls that don\\u2019t have any dependen\", \"ce on \\ninfrastructure, especially those calls that are completely stateless, are fine to call and ha\", \"ve no impact \\non coupling or testability (beyond coupling code to the static  call itself).   \\n49 CH\", \"APTER 6 | Develop ASP.NET Core MVC apps  \\n Many developers understand the risks of static cling and \", \"global state, but will still tightly couple their \\ncode to specific implementations through direct i\", \"nstantiation. \\u201cNew is glue\\u201d is meant to be a reminder \\nof this coupling, and not a general condemnat\", \"i on of the use of the new keyword. Just as with static \\nmethod calls, new instances of types that h\", \"ave no external dependencies typically do not tightly \\ncouple code to implementation details or make\", \" testing more difficult. But each time a class is \\ninstantiat ed, take just a brief moment to consid\", \"er whether it makes sense to hard -code that specific \\ninstance in that particular location, or if i\", \"t would be a better design to request that instance as a \\ndependency.  \\nDeclare your dependencies  \\n\", \"ASP.NET Core is built around having methods and classes declare their dependencies, requesting \\nthem\", \" as arguments. ASP.NET applications are typically set up in Program.cs  or in a Startup class.  \\nNot\", \"e  \\nConfiguring apps completely in Program.cs  is the default approach for .NET 6 (and later) and Vi\", \"sual \\nStudio 2022 apps. Project templates have been updated to help you get started with this new \\na\", \"pproach. ASP.NET Core projects can still use a Startup class, if desired.  \\nConfigure services in Pr\", \"ogram.cs  \\nFor very simple apps, you can wire up dependencies directly in Program.cs  file using a \\n\", \"WebApplicationBuilder. Once all needed services have been added, the builder is used to create the \\n\", \"app. \\nvar builder = WebApplication .CreateBuilder (args); \\n \\n// Add services to the container.  \\nbui\", \"lder.Services .AddRazorPages (); \\n \\nvar app = builder.Build(); \\nConfigure services in Startup.cs  \\nT\", \"he Startup.cs  is itself configured to support dependency injection at several points. If you\\u2019re usi\", \"ng a \\nStartup class, you can give it a constructor and it can request dependencies through it, like \", \"so:  \\npublic class Startup \\n{ \\n    public Startup(IHostingEnvironment env ) \\n    { \\n        var buil\", \"der = new ConfigurationBuilder () \\n            .SetBasePath (env.ContentRootPath ) \\n            .Add\", \"JsonFile (\\\"appsettings.json\\\" , optional : false, reloadOnChange : true) \\n            .AddJsonFile ($\", \"\\\"appsettings.{env.EnvironmentName}.json\\\" , optional : true); \\n    } \\n} \\nThe Startup class is interes\", \"ting in that there are no explicit type requirements for it. It doesn\\u2019t inherit \\nfrom a special Star\", \"tup base class, nor does it implement any particular interface. You can give it a \\nconstructor, or n\", \"ot, and you can specify as man y parameters on the constructor as you want. When  \\n50 CHAPTER 6 | De\", \"velop ASP.NET Core MVC apps  \\n the web host you\\u2019ve configured for your application starts, it will c\", \"all the Startup class (if you\\u2019ve told it \\nto use one), and will use dependency injection to populate\", \" any dependencies the Startup class \\nrequires. Of course, if you request parameters that aren\\u2019t conf\", \"igured in the services container used by \\nASP.NET Core, you\\u2019ll get an exception, but as long as you \", \"stick to dependencies the container knows \\nabout, you can request anything you want.  \\nDependency in\", \"jection is built into your ASP.NET Core apps right from the start, when you create the \\nStartup inst\", \"ance. It doesn\\u2019t stop there for the Startup class. You can also request dependencies in the \\nConfigu\", \"re method:  \\npublic void Configure (IApplicationBuilder app , \\n    IHostingEnvironment env , \\n    IL\", \"oggerFactory loggerFactory ) \\n{ \\n \\n} \\nThe ConfigureServices method is the exception to this behavior\", \"; it must take just one parameter of \\ntype IServiceCollection. It doesn\\u2019t really need to support dep\", \"endency injection, since on the one hand \\nit is responsible for adding objects to the services c ont\", \"ainer, and on the other it has access to all \\ncurrently configured services via the IServiceCollecti\", \"on parameter. Thus, you can work with \\ndependencies defined in the ASP.NET Core services collection \", \"in every part of the Startup class, either \\nby requestin g the needed service as a parameter or by w\", \"orking with the IServiceCollection in \\nConfigureServices.  \\nNote  \\nIf you need to ensure certain ser\", \"vices are available to your Startup class, you can configure them using \\nan IWebHostBuilder and its \", \"ConfigureServices method inside the CreateDefaultBuilder call.  \\nThe Startup class is a model for ho\", \"w you should structure other parts of your ASP.NET Core \\napplication, from Controllers to Middleware\", \" to Filters to your own Services. In each case, you should \\nfollow the Explicit Dependencies Princip\", \"le , requesting your dependencies rather than directly creating \\nthem, and leveraging dependency inj\", \"ection throughout your application. Be careful of where and how \\nyou directly instantiate implementa\", \"tions, especially services and objects that work with infrast ructure \\nor have side effects. Prefer \", \"working with abstractions defined in your application core and passed in as \\narguments to hardcoding\", \" references to specific implementation types.  \\nStructuring the application  \\nMonolithic application\", \"s typically have a single entry point. In the case of an ASP.NET Core web \\napplication, the entry po\", \"int will be the ASP.NET Core web project. However, that doesn\\u2019t mean the \\nsolution should consist of\", \" just a single project. It\\u2019s useful to break up the application into different \\nlayers in order to f\", \"ollow separation of concerns. Onc e broken up into layers, it\\u2019s helpful to go beyond \\nfolders to sep\", \"arate projects, which can help achieve better encapsulation. The best approach to \\nachieve these goa\", \"ls with an ASP.NET Core application is a variation of the Clean Architecture \\ndiscussed in ch apter \", \"5. Following this approach, the application\\u2019s solution will comprise separate \\nlibraries for the UI,\", \" Infrastructure, and ApplicationCore.   \\n51 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n In addition\", \" to these projects, separate test projects are included as well (Testing is discussed in \\nChapter 9)\", \".  \\nThe application\\u2019s object model and interfaces should be placed in the ApplicationCore project. T\", \"his \\nproject will have as few dependencies as possible (and none on specific infrastructure concerns\", \"), and \\nthe other projects in the solution will reference it. Business entities that need to be pers\", \"isted are \\ndefined in the ApplicationCore project, as are services that do not directly depend on in\", \"frastructure.  \\nImplementation details, such as how persistence is performed or how notifications mi\", \"ght be sent to a \\nuser, are kept in the Infrastructure project. This project will reference implemen\", \"tation -specific \\npackages such as Entity Framework Core, but should not ex pose details about these\", \" implementations \\noutside of the project. Infrastructure services and repositories should implement \", \"interfaces that are \\ndefined in the ApplicationCore project, and its persistence implementations are\", \" responsible for \\nretrieving and st oring entities defined in ApplicationCore.  \\nThe ASP.NET Core UI\", \" project is responsible for any UI level concerns, but should not include business \\nlogic or infrast\", \"ructure details. In fact, ideally it shouldn\\u2019t even have a dependency on the Infrastructure \\nproject\", \", which will help ensure no dependency between the two projects is introduced accidentally. \\nThis ca\", \"n be achieved using a third -party DI container like Autofac, which allows you to define DI rules \\ni\", \"n Module classes in each project.  \\nAnother approach to decoupling the application from implementati\", \"on details is to have the \\napplication call microservices, perhaps deployed in individual Docker con\", \"tainers. This provides even \\ngreater separation of concerns and decoupling than leveraging DI betwee\", \"n two projects, but has \\nadditional complexity.  \\nFeature organization  \\nBy default, ASP.NET Core ap\", \"plications organize their folder structure to include Controllers and Views, \\nand frequently ViewMod\", \"els. Client -side code to support these server -side structures is typically stored \\nseparately in t\", \"he wwwroot folder. However, large  applications may encounter problems with this \\norganization, sinc\", \"e working on any given feature often requires jumping between these folders. This \\ngets more and mor\", \"e difficult as the number of files and subfolders in each folder grows, resulting in a \\ngreat  deal \", \"of scrolling through Solution Explorer. One solution to this problem is to organize \\napplication cod\", \"e by feature  instead of by file type. This organizational style is typically referred to as \\nfeatur\", \"e folders or feature slices  (see also: Vertical Slices ). \\nASP.NET Core MVC supports Areas for this\", \" purpose. Using areas, you can create separate sets of \\nControllers and Views folders (as well as an\", \"y associated models) in each Area folder. Figure 7 -1 shows \\nan example folder structure, using Area\", \"s.   \\n52 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n  \\nFigure 7 -1. Sample Area Organization  \\nWhen\", \" using Areas, you must use attributes to decorate your controllers with the name of the area to \\nwhi\", \"ch they belong:  \\n[Area(\\\"Catalog\\\" )] \\npublic class HomeController  \\n{} \\nYou also need to add area su\", \"pport to your routes:  \\napp.UseEndpoints (endpoints => \\n{ \\n    endpoints .MapControllerRoute (name: \", \"\\\"areaRoute\\\" , pattern: \\n\\\"{area:exists}/{controller=Home}/{action=Index}/{id?}\\\" ); \\n    endpoints .Ma\", \"pControllerRoute (name: \\\"default\\\" , pattern: \\n\\\"{controller=Home}/{action=Index}/{id?}\\\" ); \\n}); \\nIn a\", \"ddition to the built -in support for Areas, you can also use your own folder structure, and \\nconvent\", \"ions in place of attributes and custom routes. This would allow you to have feature folders \\nthat di\", \"dn\\u2019t include separate folders for Views, Controllers, e tc., keeping the hierarchy flatter and \\nmaki\", \"ng it easier to see all related files in a single place for each feature. For APIs, folders can be u\", \"sed \\nto replace controllers, and each folder can contain all of the API Endpoints and their associat\", \"ed DTOs.  \\n \\n53 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n ASP.NET Core uses built -in convention \", \"types to control its behavior. You can modify or replace these \\nconventions. For example, you can cr\", \"eate a convention that will automatically get the feature name \\nfor a given controller based on its \", \"namespace (which typ ically correlates to the folder in which the \\ncontroller is located):  \\npublic \", \"class FeatureConvention : IControllerModelConvention  \\n{ \\n    public void Apply(ControllerModel cont\", \"roller ) \\n    { \\n        controller .Properties .Add(\\\"feature\\\" , \\n        GetFeatureName (controller\", \" .ControllerType )); \\n    } \\n \\n    private string GetFeatureName (TypeInfo controllerType ) \\n    { \\n\", \"        string[] tokens = controllerType .FullName .Split('.'); \\n        if (!tokens.Any(t => t == \\\"\", \"Features\\\" )) return \\\"\\\"; \\n        string featureName = tokens \\n            .SkipWhile (t => !t.Equals\", \"(\\\"features\\\" , \\nStringComparison .CurrentCultureIgnoreCase )) \\n            .Skip(1) \\n            .Tak\", \"e(1) \\n            .FirstOrDefault (); \\n        return featureName ; \\n    } \\n} \\nYou then specify this\", \" convention as an option when you add support for MVC to your application in \\nConfigureServices (or \", \"in Program.cs ): \\n// ConfigureServices  \\nservices .AddMvc(o => o.Conventions .Add(new FeatureConvent\", \"ion ())); \\n \\n// Program.cs  \\nbuilder.Services .AddMvc(o => o.Conventions .Add(new FeatureConvention \", \"())); \\nASP.NET Core MVC also uses a convention to locate views. You can override it with a custom \\nc\", \"onvention so that views will be located in your feature folders (using the feature name provided by \", \"\\nthe FeatureConvention, above). You can learn more about this app roach and download a working \\nsamp\", \"le from the MSDN Magazine article, Feature Slices for ASP.NET Core MVC . \\nAPIs and Blazor applicatio\", \"ns  \\nIf your application includes a set of web APIs, which must be secured, these APIs should ideall\", \"y be \\nconfigured as a separate project from your View or Razor Pages application. Separating APIs, \\n\", \"especially public APIs, from your server -side web application h as a number of benefits. These \\napp\", \"lications often will have unique deployment and load characteristics. They\\u2019re also very likely to \\na\", \"dopt different mechanisms for security, with standard form -based applications leveraging cookie -\\nb\", \"ased authentication and AP Is most likely using token -based authentication.  \\nAdditionally, Blazor \", \"applications, whether using Blazor Server or Blazor WebAssembly, should be built \\nas separate projec\", \"ts. The applications have different runtime characteristics as well as security models. \\nThey\\u2019re lik\", \"ely to share common types with the se rver-side web application (or API project), and these \\ntypes s\", \"hould be defined in a common shared project.   \\n54 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n The \", \"addition of a Blazor WebAssembly admin interface to eShopOnWeb required adding several new \\nprojects\", \". The Blazor WebAssembly project itself, BlazorAdmin. A new set of public API endpoints, used \\nby Bl\", \"azorAdmin and configured to use token -based authentica tion, is defined in the PublicApi project. \\n\", \"And certain shared types used by both of these projects are kept in a new BlazorShared project.  \\nOn\", \"e might ask, why add a separate BlazorShared project when there is already a common \\nApplicationCore\", \" project that could be used to share any types required by both PublicApi and \\nBlazorAdmin? The answ\", \"er is that this project includes all of the application\\u2019 s business logic and is thus \\nmuch larger t\", \"han necessary and also much more likely to need to be kept secure on the server. \\nRemember that any \", \"library referenced by BlazorAdmin will be downloaded to users\\u2019 browsers when \\nthey load the Blazor a\", \"pplication.  \\nDepending on whether one is using the Backends -For-Frontends (BFF) pattern , the APIs\", \" consumed by \\nthe Blazor WebAssembly app may not share their types 100% with Blazor. In particular, \", \"a public API \\nthat\\u2019s meant to be consumed by many different clients may define its own request and r\", \"esult types, \\nrather than sharing them in a clien t-specific shared project. In the eShopOnWeb sampl\", \"e, the \\nassumption is being made that the PublicApi project is, in fact, hosting a public API, so no\", \"t all of its \\nrequest and response types come from the BlazorShared project.  \\nCross -cutting concer\", \"ns  \\nAs applications grow, it becomes increasingly important to factor out cross -cutting concerns t\", \"o \\neliminate duplication and maintain consistency. Some examples of cross -cutting concerns in ASP.N\", \"ET \\nCore applications are authentication, model validation rules,  output caching, and error handlin\", \"g, \\nthough there are many others. ASP.NET Core MVC filters  allow you to run code before or after ce\", \"rtain \\nsteps in the request processing pipeline. For instance, a filter can run before and after mod\", \"el binding, \\nbefore and after an action, or before and after an action\\u2019s result. You can also use an\", \" authorization \\nfilter to control access to the rest of the pipeline. Figures 7 -2 shows how request\", \" execution flows \\nthrough filters, if configured.   \\n55 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n\", \"  \\nFigure 7 -2. Request execution through filters and request pipeline.  \\nFilters are usually implem\", \"ented as attributes, so you can apply them to controllers or actions (or even \\nglobally). When added\", \" in this fashion, filters specified at the action level override or build upon filters \\nspecified at\", \" the controller level, which the mselves override global filters. For example, the [Route] \\nattribut\", \"e can be used to build up routes between controllers and actions. Likewise, authorization can \\nbe co\", \"nfigured at the controller level, and then overridden by individual actions, as the followi ng \\nsamp\", \"le demonstrates:  \\n[Authorize ] \\npublic class AccountController : Controller  \\n{ \\n    [AllowAnonymou\", \"s ] // overrides the Authorize attribute  \\n    public async Task <IActionResult > Login() {} \\n    pu\", \"blic async Task <IActionResult > ForgotPassword () {} \\n} \\nThe first method, Login, uses the [AllowAn\", \"onymous] filter (attribute) to override the Authorize filter \\nset at the controller level. The Forgo\", \"tPassword action (and any other action in the class that doesn\\u2019t \\nhave an AllowAnonymous attribute) \", \"will require an authenticated request.  \\nFilters can be used to eliminate duplication in the form of\", \" common error handling policies for APIs. \\nFor example, a typical API policy is to return a NotFound\", \" response to requests referencing keys that \\ndo not exist, and a BadRequest response if model valid \", \"ation fails. The following example \\ndemonstrates these two policies in action:  \\n[HttpPut(\\\"{id}\\\")] \\n\", \"public async Task <IActionResult > Put(int id, [FromBody ]Author author ) \\n{ \\n \\n56 CHAPTER 6 | Devel\", \"op ASP.NET Core MVC apps  \\n     if ((await _authorRepository .ListAsync ()).All(a => a.Id != id)) \\n \", \"   { \\n        return NotFound (id); \\n    } \\n    if (!ModelState .IsValid) \\n    { \\n        return Bad\", \"Request (ModelState ); \\n    } \\n    author.Id = id; \\n    await _authorRepository .UpdateAsync (author\", \"); \\n    return Ok(); \\n} \\nDon\\u2019t allow your action methods to become cluttered with conditional code l\", \"ike this. Instead, pull the \\npolicies into filters that can be applied on an as -needed basis. In th\", \"is example, the model validation \\ncheck, which should occur anytime a command is sen t to the API, c\", \"an be replaced by the following \\nattribute:  \\npublic class ValidateModelAttribute : ActionFilterAttr\", \"ibute  \\n{ \\n    public override  void OnActionExecuting (ActionExecutingContext context ) \\n    { \\n   \", \"     if (!context.ModelState .IsValid) \\n        { \\n            context.Result = new BadRequestObject\", \"Result (context.ModelState ); \\n        } \\n    } \\n} \\nYou can add the ValidateModelAttribute to your p\", \"roject as a NuGet dependency by including the \\nArdalis.ValidateModel  package. For APIs, you can use\", \" the ApiController attribute to enforce this \\nbehavior without the need for a separate ValidateModel\", \" filter.  \\nLikewise, a filter can be used to check if a record exists and return a 404 before the ac\", \"tion is executed, \\neliminating the need to perform these checks in the action. Once you\\u2019ve pulled ou\", \"t common \\nconventions and organized your solution to separate infrast ructure code and business logi\", \"c from your \\nUI, your MVC action methods should be extremely thin:  \\n[HttpPut(\\\"{id}\\\")] \\n[ValidateAut\", \"horExists ] \\npublic async Task <IActionResult > Put(int id, [FromBody ]Author author ) \\n{ \\n    await\", \" _authorRepository .UpdateAsync (author); \\n    return Ok(); \\n} \\nYou can read more about implementing\", \" filters and download a working sample from the MSDN \\nMagazine article, Real-World ASP.NET Core MVC \", \"Filters . \\nIf you find that you have a number of common responses from APIs based on common scenario\", \"s like \\nvalidation errors (Bad Request), resource not found, and server errors, you might consider u\", \"sing a \\nresult  abstraction. The result abstraction would be returned by services consumed by API en\", \"dpoints, \\nand the controller action or endpoint would use a filter to translate these into IActionRe\", \"sults.   \\n57 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n References \\u2013 Structuring applications  \\n\\u2022 \", \"Areas  \\nhttps://learn.microsoft.com/aspnet/core/mvc/controllers/areas  \\n\\u2022 MSDN Magazine \\u2013 Feature Sl\", \"ices for ASP.NET Core MVC  \\nhttps://learn.microsoft.com/archive/msdn -magazine/2016/september/asp -n\", \"et-core-feature -\\nslices -for-asp-net-core-mvc \\n\\u2022 Filters  \\nhttps://learn.microsoft.com/aspnet/core/\", \"mvc/controllers/filters  \\n\\u2022 MSDN Magazine \\u2013 Real World ASP.NET Core MVC Filters  \\nhttps://learn.micr\", \"osoft.com/archive/msdn -magazine/2016/august/asp -net-core-real-world -\\nasp-net-core-mvc-filters  \\n\\u2022\", \" Result in eShopOnWeb  \\nhttps://github.com/dotnet -architecture/eShopOnWeb/wiki/Patterns#result  \\nSe\", \"curity  \\nSecuring web applications is a large topic, with many considerations. At its most basic lev\", \"el, security \\ninvolves ensuring you know who a given request is coming from, and then ensuring that \", \"the request \\nonly has access to resources it should. Authentication  is the process of comparing cre\", \"dentials \\nprovided with a request to those in a trusted data store, to see if the request should be \", \"treated as \\ncoming from a known entity. Authorization is the process of restricting access to certai\", \"n resources \\nbased on user identity. A third security concern is protecting requests from eavesdropp\", \"ing by third \\nparties, for which you should at least ensure that SSL is used by your application . \\n\", \"Identity  \\nASP.NET Core Identity is a membership system you can use to support login functionality f\", \"or your \\napplication. It has support for local user accounts as well as external login provider supp\", \"ort from \\nproviders like Microsoft Account, Twitter, Facebook, Google , and more. In addition to ASP\", \".NET Core \\nIdentity, your application can use windows authentication, or a third -party identity pro\", \"vider like \\nIdentity Server . \\nASP.NET Core Identity is included in new project templates if the Ind\", \"ividual User Accounts option is \\nselected. This template includes support for registration, login, e\", \"xternal logins, forgotten passwords, \\nand additional functionality.   \\n58 CHAPTER 6 | Develop ASP.NE\", \"T Core MVC apps  \\n  \\nFigure 7 -3. Select Individual User Accounts to have Identity preconfigured.  \\n\", \"Identity support is configured in Program.cs  or Startup, and includes configuring services as well \", \"as \\nmiddleware.  \\nConfigure Identity in Program.cs  \\nIn Program.cs , you configure services from the\", \" WebHostBuilder instance, and then once the app is \\ncreated, you configure its middleware. The key p\", \"oints to note are the call to AddDefaultIdentity for \\nrequired services and the UseAuthentication an\", \"d UseAuthorization calls which add required \\nmiddleware.  \\nvar builder = WebApplication .CreateBuild\", \"er (args); \\n \\n// Add services to the container.  \\nvar connectionString = builder.Configuration .GetC\", \"onnectionString (\\\"DefaultConnection\\\" ); \\nbuilder.Services .AddDbContext <ApplicationDbContext >(opti\", \"ons => \\n    options.UseSqlServer (connectionString )); \\nbuilder.Services .AddDatabaseDeveloperPageEx\", \"ceptionFilter (); \\n \\nbuilder.Services .AddDefaultIdentity <IdentityUser >(options => \\noptions.SignIn\", \".RequireConfirmedAccount  = true) \\n    .AddEntityFrameworkStores <ApplicationDbContext >(); \\nbuilder\", \".Services .AddRazorPages (); \\n \\nvar app = builder.Build(); \\n \\n// Configure the HTTP request pipeline\", \".  \\nif (app.Environment .IsDevelopment ()) \\n \\n59 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n { \\n   \", \" app.UseMigrationsEndPoint (); \\n} \\nelse \\n{ \\n  app.UseExceptionHandler (\\\"/Error\\\" ); \\n  // The default\", \" HSTS value is 30 days. You may want to change this for production \\nscenarios, see https://aka.ms/as\", \"pnetcore -hsts. \\n  app.UseHsts(); \\n} \\n \\napp.UseHttpsRedirection (); \\napp.UseStaticFiles (); \\n \\napp.U\", \"seRouting (); \\n \\napp.UseAuthentication (); \\napp.UseAuthorization (); \\n \\napp.MapRazorPages (); \\n \\napp\", \".Run(); \\nConfiguring Identity in app startup  \\n// Add framework services.  \\nbuilder.Services .AddDbC\", \"ontext <ApplicationDbContext >(options => \\n    options.UseSqlServer (Configuration .GetConnectionStr\", \"ing (\\\"DefaultConnection\\\" ))); \\nbuilder.Services .AddIdentity <ApplicationUser , IdentityRole >() \\n  \", \"  .AddEntityFrameworkStores <ApplicationDbContext >() \\n    .AddDefaultTokenProviders (); \\nbuilder.Se\", \"rvices .AddMvc(); \\n \\nvar app = builder.Build(); \\n \\nif (app.Environment .IsDevelopment ()) \\n{ \\n    ap\", \"p.UseMigrationsEndPoint (); \\n} \\nelse \\n{ \\n    app.UseExceptionHandler (\\\"/Error\\\" ); \\n    app.UseHsts()\", \"; \\n} \\n \\napp.UseHttpsRedirection (); \\napp.UseStaticFiles (); \\n \\napp.UseRouting (); \\n \\napp.UseAuthenti\", \"cation (); \\napp.UseAuthorization (); \\n \\napp.MapRazorPages (); \\nIt\\u2019s important that UseAuthentication\", \" and UseAuthorization appear before MapRazorPages. When \\nconfiguring Identity services, you\\u2019ll notic\", \"e a call to AddDefaultTokenProviders. This has nothing to do \\nwith tokens that may be used to secure\", \" web communications, but instead refers to providers that \\ncreate prompts that can be sent to users \", \"via SMS or email in order for them to confirm their identity.   \\n60 CHAPTER 6 | Develop ASP.NET Core\", \" MVC apps  \\n You can learn more about configuring two -factor authentication  and enabling external \", \"login providers  \\nfrom the official ASP.NET Core docs.  \\nAuthentication  \\nAuthentication is the proc\", \"ess of determining who is accessing the system. If you\\u2019re using ASP.NET \\nCore Identity and the confi\", \"guration methods shown in the previous section, it will automatically \\nconfigure some authentication\", \" defaults in the application. Ho wever, you can also configure these \\ndefaults manually, or override\", \" the ones set by AddIdentity. If you\\u2019re using Identity, it configures \\ncookie -based authentication \", \"as the default scheme . \\nIn web -based authentication, there are typically up to five actions that m\", \"ay be performed in the \\ncourse of authenticating a client of a system. These are:  \\n\\u2022 Authenticate. \", \"Use the information provided by the client to create an identity for them to use \\nwithin the applica\", \"tion.  \\n\\u2022 Challenge. This action is used to require the client to identify themselves.  \\n\\u2022 Forbid. I\", \"nform the client they are forbidden from performing an action.  \\n\\u2022 Sign-in. Persist the existing cli\", \"ent in some way.  \\n\\u2022 Sign-out. Remove the client from persistence.  \\nThere are a number of common te\", \"chniques for performing authentication in web applications. These \\nare referred to as schemes. A giv\", \"en scheme will define actions for some or all of the above options. \\nSome schemes only support a sub\", \"set of actions, and may req uire a separate scheme to perform those \\nit does not support. For exampl\", \"e, the OpenId -Connect (OIDC) scheme doesn\\u2019t support Sign -in or \\nSign-out, but is commonly configur\", \"ed to use Cookie authentication for this persistence.  \\nIn your ASP.NET Core application, you can co\", \"nfigure a DefaultAuthenticateScheme as well as optional \\nspecific schemes for each of the actions de\", \"scribed above. For example, DefaultChallengeScheme, \\nDefaultForbidScheme, etc. Calling AddIdentity<T\", \"User,TRole>  configures a number of aspects of the \\napplication and adds many required services. It \", \"also includes this call to configure the authentication \\nscheme:  \\nbuilder.Services .AddAuthenticati\", \"on (options => \\n{ \\n    options.DefaultAuthenticateScheme  = IdentityConstants .ApplicationScheme ; \\n\", \"    options.DefaultChallengeScheme  = IdentityConstants .ApplicationScheme ; \\n    options.DefaultSig\", \"nInScheme  = IdentityConstants .ExternalScheme ; \\n}); \\nThese schemes use cookies for persistence and\", \" redirection to login pages for authentication by \\ndefault. These schemes are appropriate for web ap\", \"plications that interact with users via web browsers, \\nbut not recommended for APIs. Instead, APIs w\", \"ill typically  use another form of authentication, such as \\nJWT bearer tokens.  \\nWeb APIs are consum\", \"ed by code, such as HttpClient in .NET applications and equivalent types in other \\nframeworks. These\", \" clients expect a usable response from an API call, or a status code indicating what, \\nif any, probl\", \"em has occurred. These clients are not interacting through a browser and do not render or \\ninteract \", \"with any HTML that an API might return. Thus, it is not appropriate for API endpoints to \\nredirect t\", \"heir clients to login pages if they are not authenticated. Another scheme is more appropriate.   \\n61\", \" CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n To configure authentication for APIs, you might set up\", \" authentication like the following, used by the \\nPublicApi project in the eShopOnWeb reference appli\", \"cation:  \\nbuilder.Services  \\n    .AddAuthentication (config => \\n    { \\n      config.DefaultScheme  =\", \" JwtBearerDefaults .AuthenticationScheme ; \\n    }) \\n    .AddJwtBearer (config => \\n    { \\n        con\", \"fig.RequireHttpsMetadata  = false; \\n        config.SaveToken  = true; \\n        config.TokenValidatio\", \"nParameters  = new TokenValidationParameters  \\n        { \\n            ValidateIssuerSigningKey = tru\", \"e, \\n            IssuerSigningKey = new SymmetricSecurityKey (key), \\n            ValidateIssuer = fal\", \"se, \\n            ValidateAudience = false \\n        }; \\n    }); \\nWhile it is possible to configure mu\", \"ltiple different authentication schemes within a single project, it is \\nmuch simpler to configure a \", \"single default scheme. For this reason, among others, the eShopOnWeb \\nreference application separate\", \"s its APIs into their own project, PublicApi, separate from the main Web \\nproject that includes the \", \"application\\u2019s views and Razor Pages.  \\nAuthentication in Blazor apps  \\nBlazor Server applications ca\", \"n leverage the same authentication features as any other ASP.NET Core \\napplication. Blazor WebAssemb\", \"ly applications cannot use the built -in Identity and Authentication \\nproviders, however, since they\", \" run in the browser. Blazor We bAssembly applications can store user \\nauthentication status locally \", \"and can access claims to determine what actions users should be able to \\nperform. However, all authe\", \"ntication and authorization checks should be performed on the server \\nregardless of any lo gic imple\", \"mented inside the Blazor WebAssembly app, since users can easily \\nbypass the app and interact with t\", \"he APIs directly.  \\nReferences \\u2013 Authentication  \\n\\u2022 Authentication Actions and Defaults  \\nhttps://st\", \"ackoverflow.com/a/52493428  \\n\\u2022 Authentication and Authorization for SPAs  \\nhttps://learn.microsoft.c\", \"om/aspnet/core/security/authentication/identity -api-authorization  \\n\\u2022 ASP.NET Core Blazor Authentic\", \"ation and Authorization  \\nhttps://learn.microsoft.com/aspnet/core/blazor/security/  \\n\\u2022 Security: Aut\", \"hentication and Authorization in ASP.NET Web Forms and Blazor  \\nhttps://learn.microsoft.com/dotnet/a\", \"rchitecture/blazor -for-web-forms -developers/security -\\nauthentication -authorization  \\nAuthorizati\", \"on  \\nThe simplest form of authorization involves restricting access to anonymous users. This functio\", \"nality \\ncan be achieved by applying the [Authorize] attribute to certain controllers or actions. If \", \"roles are  \\n62 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n being used, the attribute can be further\", \" extended to restrict access to users who belong to certain \\nroles, as shown:  \\n[Authorize (Roles = \", \"\\\"HRManager,Finance\\\" )] \\npublic class SalaryController : Controller  \\n{ \\n \\n} \\nIn this case, users bel\", \"onging to either the HRManager or Finance roles (or both) would have access to \\nthe SalaryController\", \". To require that a user belong to multiple roles (not just one of several), you can \\napply the attr\", \"ibute multiple times, specifying a required role each time.  \\nSpecifying certain sets of roles as st\", \"rings in many different controllers and actions can lead to \\nundesirable repetition. At a minimum, d\", \"efine constants for these string literals and use the constants \\nanywhere you need to specify the st\", \"ring. You can also c onfigure authorization policies, which \\nencapsulate authorization rules, and th\", \"en specify the policy instead of individual roles when applying \\nthe [Authorize] attribute:  \\n[Autho\", \"rize (Policy = \\\"CanViewPrivateReport\\\" )] \\npublic IActionResult ExecutiveSalaryReport () \\n{ \\n    retu\", \"rn View(); \\n} \\nUsing policies in this way, you can separate the kinds of actions being restricted fr\", \"om the specific roles \\nor rules that apply to it. Later, if you create a new role that needs to have\", \" access to certain resources, \\nyou can just update a policy, rather than updating every list of role\", \"s on every [Authorize] attribute.  \\nClaims  \\nClaims are name value pairs that represent properties o\", \"f an authenticated user. For example, you \\nmight store users\\u2019 employee number as a claim. Claims can\", \" then be used as part of authorization \\npolicies. You could create a policy called \\u201cEmployeeOnly\\u201d th\", \"at requires the existence of a claim called \\n\\\"EmployeeNumber\\\", as shown in this example:  \\npublic vo\", \"id ConfigureServices (IServiceCollection services ) \\n{ \\n    services .AddMvc(); \\n    services .AddAu\", \"thorization (options => \\n    { \\n        options.AddPolicy (\\\"EmployeeOnly\\\" , policy => policy.Require\", \"Claim (\\\"EmployeeNumber\\\" )); \\n    }); \\n} \\nThis policy could then be used with the [Authorize] attribu\", \"te to protect any controller and/or action, \\nas described above.  \\nSecuring web APIs  \\nMost web APIs\", \" should implement a token -based authentication system. Token authentication is \\nstateless and desig\", \"ned to be scalable. In a token -based authentication system, the client must first \\nauthenticate wit\", \"h the authentication provider. If successful, t he client is issued a token, which is simply  \\n63 CH\", \"APTER 6 | Develop ASP.NET Core MVC apps  \\n a cryptographically meaningful string of characters. The \", \"most common format for tokens is JSON Web \\nToken, or JWT (often pronounced \\u201cjot\\u201d). When the client t\", \"hen needs to issue a request to an API, it \\nadds this token as a header on the request. The server t\", \"h en validates the token found in the request \\nheader before completing the request. Figure 7 -4 dem\", \"onstrates this process.  \\n \\nFigure 7 -4. Token -based authentication for Web APIs.  \\nYou can create \", \"your own authentication service, integrate with Azure AD and OAuth, or implement a \\nservice using an\", \" open -source tool like IdentityServer . \\nJWT tokens can embed claims about the user, which can be r\", \"ead on the client or server. You can use a \\ntool like jwt.io  to view the contents of a JWT token. D\", \"o not store sensitive data like passwords or keys \\nin JTW tokens, since their contents are easily re\", \"ad.  \\nWhen using JWT tokens with SPA or Blazor WebAssembly applications, you must store the token \\ns\", \"omewhere on the client and then add it to every API call. This activity is typically done as a heade\", \"r, as \\nthe following code demonstrates:  \\n// AuthService.cs in BlazorAdmin project of eShopOnWeb  \\np\", \"rivate async Task SetAuthorizationHeader () \\n{ \\n      var token = await GetToken (); \\n      _httpCli\", \"ent .DefaultRequestHeaders .Authorization  = new \\nAuthenticationHeaderValue (\\\"Bearer\\\" , token); \\n} \\n\", \"After calling the above method, requests made with the _httpClient will have the token embedded in \\n\", \"the request\\u2019s headers, allowing the server -side API to authenticate and authorize the request.  \\n \\n\", \"64 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n Custom Security  \\nCaution  \\nAs a general rule, avoid\", \" implementing your own custom security implementations.  \\nBe especially careful about \\u201crolling your \", \"own\\u201d implementation of cryptography, user membership, or \\ntoken generation system. There are many co\", \"mmercial and open -source alternatives available, which \\nwill almost certainly have better security \", \"than a custom imp lementation.  \\nReferences \\u2013 Security  \\n\\u2022 Security Docs Overview  \\nhttps://learn.mi\", \"crosoft.com/aspnet/core/security/  \\n\\u2022 Enforcing SSL in an ASP.NET Core App  \\nhttps://learn.microsoft\", \".com/aspnet/core/security/enforcing -ssl \\n\\u2022 Introduction to Identity  \\nhttps://learn.microsoft.com/a\", \"spnet/core/security/authentication/identity  \\n\\u2022 Introduction to Authorization  \\nhttps://learn.micros\", \"oft.com/aspnet/core/security/authorization/introduction  \\n\\u2022 Authentication and Authorization for API\", \" Apps in Azure App Service  \\nhttps://learn.microsoft.com/azure/app -service -api/app -service -api-a\", \"uthentication  \\n\\u2022 Identity Server  \\nhttps://github.com/IdentityServer  \\nClient communication  \\nIn ad\", \"dition to serving pages and responding to requests for data via web APIs, ASP.NET Core apps can \\ncom\", \"municate directly with connected clients. This outbound communication can use a variety of \\ntranspor\", \"t technologies, the most common being WebSockets. ASP .NET Core SignalR is a library that \\nmakes it \", \"simple to add real -time server -to-client communication functionality to your applications. \\nSignal\", \"R supports a variety of transport technologies, including WebSockets, and abstracts away many \\nof th\", \"e implementatio n details from the developer.  \\nReal-time client communication, whether using WebSoc\", \"kets directly or other techniques, are useful in \\na variety of application scenarios. Some examples \", \"include:  \\n\\u2022 Live chat room applications  \\n\\u2022 Monitoring applications  \\n\\u2022 Job progress updates  \\n\\u2022 No\", \"tifications  \\n\\u2022 Interactive forms applications  \\nWhen building client communication into your applic\", \"ations, there are typically two components:   \\n65 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n \\u2022 Ser\", \"ver -side connection manager (SignalR Hub, WebSocketManager WebSocketHandler)  \\n\\u2022 Client -side libra\", \"ry  \\nClients aren\\u2019t limited to browsers \\u2013 mobile apps, console apps, and other native apps can also \", \"\\ncommunicate using SignalR/WebSockets. The following simple program echoes all content sent to a \\nch\", \"at application to the console, as part of a WebSocketManager sa mple application:  \\npublic class Pro\", \"gram \\n{ \\n    private static Connection _connection ; \\n    public static void Main(string[] args) \\n  \", \"  { \\n        StartConnectionAsync (); \\n        _connection .On(\\\"receiveMessage\\\" , (arguments ) => \\n \", \"       { \\n            Console.WriteLine ($\\\"{arguments[0]} said: {arguments[1]}\\\" ); \\n        }); \\n   \", \"     Console.ReadLine (); \\n        StopConnectionAsync (); \\n    } \\n \\n    public static async Task St\", \"artConnectionAsync () \\n    { \\n        _connection = new Connection (); \\n        await _connection .S\", \"tartConnectionAsync (\\\"ws://localhost:65110/chat\\\" ); \\n    } \\n \\n    public static async Task StopConne\", \"ctionAsync () \\n    { \\n        await _connection .StopConnectionAsync (); \\n    } \\n} \\nConsider ways in\", \" which your applications communicate directly with client applications, and consider \\nwhether real -\", \"time communication would improve your app\\u2019s user experience.  \\nReferences \\u2013 Client Communication  \\n\\u2022\", \" ASP.NET Core SignalR  \\nhttps://github.com/dotnet/aspnetcore/tree/main/src/SignalR  \\n\\u2022 WebSocket Man\", \"ager  \\nhttps://github.com/radu -matei/websocket -manager  \\nDomain -driven design \\u2013 Should you apply \", \"it?  \\nDomain -Driven Design (DDD) is an agile approach to building software that emphasizes focusing\", \" on \\nthe business domain . It places a heavy emphasis on communication and interaction with business\", \" \\ndomain expert(s) who can relate to the developers how the real -world system works. For example, i\", \"f \\nyou\\u2019re building a system that handles stock trades, your domain expert might be an exp erienced s\", \"tock \\nbroker. DDD is designed to address large, complex business problems, and is often not appropri\", \"ate \\nfor smaller, simpler applications, as the investment in understanding and modeling the domain i\", \"s not \\nworth it.   \\n66 CHAPTER 6 | Develop ASP.NET Core MVC apps  \\n When building software following\", \" a DDD approach, your team (including non -technical stakeholders \\nand contributors) should develop \", \"a ubiquitous language  for the problem space. That is, the same \\nterminology should be used for the \", \"real -world concept being modeled, the software equivalent, and \\nany structures that might exist to \", \"persist the concept (for example, database tables). Thus, the \\nconcepts described in the ubiquitous \", \"language should form the basis for your domain model . \\nYour domain model comprises objects that int\", \"eract with one another to represent the behavior of the \\nsystem. These objects may fall into the fol\", \"lowing categories:  \\n\\u2022 Entities , which represent objects with a thread of identity. Entities are ty\", \"pically stored in \\npersistence with a key by which they can later be retrieved.  \\n\\u2022 Aggregates , whi\", \"ch represent groups of objects that should be persisted as a unit.  \\n\\u2022 Value objects , which represe\", \"nt concepts that can be compared on the basis of the sum of \\ntheir property values. For example, Dat\", \"eRange consisting of a start and end date.  \\n\\u2022 Domain events , which represent things happening with\", \"in the system that are of interest to \\nother parts of the system.  \\nA DDD domain model should encaps\", \"ulate complex behavior within the model. Entities, in particular, \\nshould not merely be collections \", \"of properties. When the domain model lacks behavior and merely \\nrepresents the state of the system, \", \"it is said to be an anemic model , which is undesirable in DDD.  \\nIn addition to these model types, \", \"DDD typically employs a variety of patterns:  \\n\\u2022 Repository , for abstracting persistence details.  \", \"\\n\\u2022 Factory , for encapsulating complex object creation.  \\n\\u2022 Services , for encapsulating complex beh\", \"avior and/or infrastructure implementation details.  \\n\\u2022 Command , for decoupling issuing commands an\", \"d executing the command itself.  \\n\\u2022 Specification , for encapsulating query details.  \\nDDD also reco\", \"mmends the use of the Clean Architecture discussed previously, allowing for loose \\ncoupling, encapsu\", \"lation, and code that can easily be verified using unit tests.  \\nWhen should you apply DDD  \\nDDD is \", \"well suited to large applications with significant business (not just technical) complexity. The \\nap\", \"plication should require the knowledge of domain experts. There should be significant behavior in \\nt\", \"he domain model itself, representing business rules  and interactions beyond simply storing and \\nret\", \"rieving the current state of various records from data stores.  \\nWhen shouldn\\u2019t you apply DDD  \\nDDD \", \"involves investments in modeling, architecture, and communication that may not be warranted \\nfor sma\", \"ller applications or applications that are essentially just CRUD (create/read/update/delete). If \\nyo\", \"u choose to approach your application following DDD, b ut find that your domain has an anemic \\nmodel\", \" with no behavior, you may need to rethink your approach. Either your application may not  \\n67 CHAPT\", \"ER 6 | Develop ASP.NET Core MVC apps  \\n need DDD, or you may need assistance refactoring your applic\", \"ation to encapsulate business logic in \\nthe domain model, rather than in your database or user inter\", \"face.  \\nA hybrid approach would be to only use DDD for the transactional or more complex areas of th\", \"e \\napplication, but not for simpler CRUD or read -only portions of the application. For instance, yo\", \"u don\\u2019t \\nneed the constraints of an Aggregate if you\\u2019re querying da ta to display a report or to vis\", \"ualize data \\nfor a dashboard. It\\u2019s perfectly acceptable to have a separate, simpler read model for s\", \"uch \\nrequirements.  \\nReferences \\u2013 Domain -Driven Design  \\n\\u2022 DDD in Plain English (StackOverflow Answ\", \"er)  \\nhttps://stackoverflow.com/questions/1222392/can -someone -explain -domain -driven -design -\\ndd\", \"d-in-plain -english -please/1222488#1222488  \\nDeployment  \\nThere are a few steps involved in the pro\", \"cess of deploying your ASP.NET Core application, regardless \\nof where it will be hosted. The first s\", \"tep is to publish the application, which can be done using the \\ndotnet publish CLI command. This ste\", \"p will compile the application and plac e all of the files needed to \\nrun the application into a des\", \"ignated folder. When you deploy from Visual Studio, this step is \\nperformed for you automatically. T\", \"he publish folder contains .exe and .dll files for the application and \\nits dependencies. A self -co\", \"ntained application will also include a version of the .NET runtime. ASP.NET \\nCore applications will\", \" also include configuration files, static client assets, and MVC views.  \\nASP.NET Core applications \", \"are console applications that must be started when the server boots and \\nrestarted if the applicatio\", \"n (or server) crashes. A process manager can be used to automate this \\nprocess. The most common proc\", \"ess managers for ASP.NET Core ar e Nginx and Apache on Linux and \\nIIS or Windows Service on Windows.\", \"  \\nIn addition to a process manager, ASP.NET Core applications may use a reverse proxy server. A \\nre\", \"verse proxy server receives HTTP requests from the Internet and forwards them to Kestrel after \\nsome\", \" preliminary handling. Reverse proxy servers provide a layer of security for the application. \\nKestr\", \"el also doesn\\u2019t support hosting multiple applications on the same port, so techniques like host \\nhea\", \"ders cannot be used with it to enable hosting multiple applications on the same port and IP \\naddress\", \".  \\n \\nFigure 7 -5. ASP.NET hosted in Kestrel behind a reverse proxy server  \\nAnother scenario in whi\", \"ch a reverse proxy can be helpful is to secure multiple applications using \\nSSL/HTTPS. In this case,\", \" only the reverse proxy would need to have SSL configured. Communication \\nbetween the reverse proxy \", \"server and Kestrel could take place  over HTTP, as shown in Figure 7 -6. \\n \\n68 CHAPTER 6 | Develop A\", \"SP.NET Core MVC apps  \\n  \\nFigure 7 -6. ASP.NET hosted behind an HTTPS -secured reverse proxy server \", \" \\nAn increasingly popular approach is to host your ASP.NET Core application in a Docker container, \\n\", \"which then can be hosted locally or deployed to Azure for cloud -based hosting. The Docker container\", \" \\ncould contain your application code, running on Kestrel, an d would be deployed behind a reverse \\n\", \"proxy server, as shown above.  \\nIf you\\u2019re hosting your application on Azure, you can use Microsoft A\", \"zure Application Gateway as a \\ndedicated virtual appliance to provide several services. In addition \", \"to acting as a reverse proxy for \\nindividual applications, Application Gateway can also of fer the f\", \"ollowing features:  \\n\\u2022 HTTP load balancing  \\n\\u2022 SSL offload (SSL only to Internet)  \\n\\u2022 End to End SSL\", \"  \\n\\u2022 Multi -site routing (consolidate up to 20 sites on a single Application Gateway)  \\n\\u2022 Web applic\", \"ation firewall  \\n\\u2022 Websocket support  \\n\\u2022 Advanced diagnostics  \\nLearn more about Azure deployment op\", \"tions in Chapter 10 . \\nReferences \\u2013 Deployment  \\n\\u2022 Hosting and Deployment Overview  \\nhttps://learn.m\", \"icrosoft.com/aspnet/core/publishing/  \\n\\u2022 When to use Kestrel with a reverse proxy  \\nhttps://learn.mi\", \"crosoft.com/aspnet/core/fundamentals/servers/kestrel#when -to-use-kestrel -\\nwith-a-reverse -proxy  \\n\", \"\\u2022 Host ASP.NET Core apps in Docker  \\nhttps://learn.microsoft.com/aspnet/core/publishing/docker  \\n\\u2022 I\", \"ntroducing Azure Application Gateway  \\nhttps://learn.microsoft.com/azure/application -gateway/applic\", \"ation -gateway -introduction  \\n \\n69 CHAPTER 7 | Working with Data in ASP.NET Core Apps  \\n CHAPTER  7\", \" \\nWorking with Data in \\nASP.NET Core Apps  \\n\\u201cData is a precious thing and will last longer than the \", \"systems themselves.\\u201d  \\nTim Berners -Lee \\nData access is an important part of almost any software app\", \"lication. ASP.NET Core supports various \\ndata access options, including Entity Framework Core (and E\", \"ntity Framework 6 as well), and can work \\nwith any .NET data access framework. The choice of which d\", \"ata access framework to use depends on \\nthe application\\u2019s needs. Abstracting these choices from the \", \"ApplicationCore and UI projects, and \\nencapsulating implementation details in Infrastructure, helps \", \"to produce loosely coupled, testable \\nsoftware.  \\nEntity Framework Core (for relational databases)  \", \"\\nIf you\\u2019re writing a new ASP.NET Core application that needs to work with relational data, then Enti\", \"ty \\nFramework Core (EF Core) is the recommended way for your application to access its data. EF Core\", \" is \\nan object -relational mapper (O/RM) that enables .NET d evelopers to persist objects to and fro\", \"m a \\ndata source. It eliminates the need for most of the data access code developers would typically\", \" need \\nto write. Like ASP.NET Core, EF Core has been rewritten from the ground up to support modular\", \" \\ncross -platform app lications. You add it to your application as a NuGet package, configure it dur\", \"ing \\napp startup, and request it through dependency injection wherever you need it.  \\nTo use EF Core\", \" with a SQL Server database, run the following dotnet CLI command:  \\ndotnet add package Microsoft.En\", \"tityFrameworkCore.SqlServer  \\nTo add support for an InMemory data source, for testing:  \\ndotnet add \", \"package Microsoft.EntityFrameworkCore.InMemory  \\nThe DbContext  \\nTo work with EF Core, you need a su\", \"bclass of DbContext . This class holds properties representing \\ncollections of the entities your app\", \"lication will work with. The eShopOnWeb sample includes a \\nCatalogContext with collections for items\", \", brands, and types:   \\n70 CHAPTER 7 | Working with Data in ASP.NET Core Apps  \\n public class Catalo\", \"gContext : DbContext  \\n{ \\n  public CatalogContext (DbContextOptions <CatalogContext > options) : bas\", \"e(options) \\n  { \\n \\n  } \\n \\n  public DbSet<CatalogItem > CatalogItems { get; set; } \\n  public DbSet<Ca\", \"talogBrand > CatalogBrands { get; set; } \\n  public DbSet<CatalogType > CatalogTypes { get; set; } \\n}\", \" \\nYour DbContext must have a constructor that accepts DbContextOptions and pass this argument to \\nth\", \"e base DbContext constructor. If you have only one DbContext in your application, you can pass an \\ni\", \"nstance of DbContextOptions, but if you have more than one y ou must use the generic \\nDbContextOptio\", \"ns<T> type, passing in your DbContext type as the generic parameter.  \\nConfiguring EF Core  \\nIn your\", \" ASP.NET Core application, you\\u2019ll typically configure EF Core in Program.cs  with your \\napplication\\u2019\", \"s other dependencies. EF Core uses a DbContextOptionsBuilder, which supports several \\nhelpful extens\", \"ion methods to streamline its configuration. To configure CatalogContext to use a SQL \\nServer databa\", \"se with a connection string defined  in Configuration, you would add the following code:  \\nbuilder.S\", \"ervices .AddDbContext <CatalogContext >( \\n    options => options.UseSqlServer ( \\n        builder.Con\", \"figuration .GetConnectionString (\\\"DefaultConnection\\\" ))); \\nTo use the in -memory database:  \\nbuilder\", \".Services .AddDbContext <CatalogContext >(options => \\n    options.UseInMemoryDatabase ()); \\nOnce you\", \" have installed EF Core, created a DbContext child type, and added the type to the \\napplication\\u2019s se\", \"rvices, you are ready to use EF Core. You can request an instance of your DbContext \\ntype in any ser\", \"vice that needs it and start working with your per sisted entities using LINQ as if they \\nwere simpl\", \"y in a collection. EF Core does the work of translating your LINQ expressions into SQL \\nqueries to s\", \"tore and retrieve your data.  \\nYou can see the queries EF Core is executing by configuring a logger \", \"and ensuring its level is set to at \\nleast Information, as shown in Figure 8 -1.  \\n71 CHAPTER 7 | Wo\", \"rking with Data in ASP.NET Core Apps  \\n  \\nFigure 8 -1. Logging EF Core queries to the console  \\nFetc\", \"hing and storing Data  \\nTo retrieve data from EF Core, you access the appropriate property and use L\", \"INQ to filter the result. \\nYou can also use LINQ to perform projection, transforming the result from\", \" one type to another. The \\nfollowing example would retrieve CatalogBrands, ordered  by name, filtere\", \"d by their Enabled property, \\nand projected onto a SelectListItem type:  \\nvar brandItems = await _co\", \"ntext .CatalogBrands  \\n    .Where(b => b.Enabled) \\n    .OrderBy(b => b.Name) \\n    .Select(b => new S\", \"electListItem { \\n        Value = b.Id, Text = b.Name }) \\n    .ToListAsync (); \\nIt\\u2019s important in the\", \" above example to add the call to ToListAsync in order to execute the query \\nimmediately. Otherwise,\", \" the statement will assign an IQueryable<SelectListItem> to brandItems, \\nwhich will not be executed \", \"until it is enumerated. There are pro s and cons to returning IQueryable \\nresults from methods. It a\", \"llows the query EF Core will construct to be further modified, but can also \\nresult in errors that o\", \"nly occur at run time, if operations are added to the query that EF Core cannot \\ntranslate. It\\u2019s gen\", \"erally safer to pass any filters into the method performing the data access, and return \\nback an in \", \"-memory collection (for example, List<T>) as the result.  \\nEF Core tracks changes on entities it fet\", \"ches from persistence. To save changes to a tracked entity, you \\njust call the SaveChangesAsync meth\", \"od on the DbContext, making sure it\\u2019s the same DbContext \\ninstance that was used to fetch the entity\", \". Adding and remo ving entities is directly done on the \\nappropriate DbSet property, again with a ca\", \"ll to SaveChangesAsync to execute the database \\ncommands. The following example demonstrates adding,\", \" updating, and removing entities from \\npersistence.  \\n \\n72 CHAPTER 7 | Working with Data in ASP.NET \", \"Core Apps  \\n // create  \\nvar newBrand = new CatalogBrand () { Brand = \\\"Acme\\\" }; \\n_context .Add(newBr\", \"and ); \\nawait _context .SaveChangesAsync (); \\n \\n// read and update  \\nvar existingBrand = _context .C\", \"atalogBrands .Find(1); \\nexistingBrand .Brand = \\\"Updated Brand\\\" ; \\nawait _context .SaveChangesAsync (\", \"); \\n \\n// read and delete (alternate Find syntax)  \\nvar brandToDelete = _context .Find<CatalogBrand >\", \"(2); \\n_context .CatalogBrands .Remove(brandToDelete ); \\nawait _context .SaveChangesAsync (); \\nEF Cor\", \"e supports both synchronous and async methods for fetching and saving. In web applications, \\nit\\u2019s re\", \"commended to use the async/await pattern with the async methods, so that web server threads \\nare not\", \" blocked while waiting for data access operations to  complete.  \\nFor more information, see Bufferin\", \"g and Streaming . \\nFetching related data  \\nWhen EF Core retrieves entities, it populates all of the \", \"properties that are stored directly with that \\nentity in the database. Navigation properties, such a\", \"s lists of related entities, are not populated and \\nmay have their value set to null. This process e\", \"n sures EF Core is not fetching more data than is \\nneeded, which is especially important for web app\", \"lications, which must quickly process requests and \\nreturn responses in an efficient manner. To incl\", \"ude relationships with an entity using eager loading , \\nyou sp ecify the property using the Include \", \"extension method on the query, as shown:  \\n// .Include requires using Microsoft.EntityFrameworkCore \", \" \\nvar brandsWithItems = await _context .CatalogBrands  \\n    .Include(b => b.Items) \\n    .ToListAsync\", \" (); \\nYou can include multiple relationships, and you can also include subrelationships using ThenIn\", \"clude. \\nEF Core will execute a single query to retrieve the resulting set of entities. Alternately y\", \"ou can include \\nnavigation properties of navigation properties b y passing a \\u2018.\\u2019 -separated string t\", \"o the .Include() \\nextension method, like so:  \\n    .Include(\\\"Items.Products\\\" ) \\nIn addition to encap\", \"sulating filtering logic, a specification can specify the shape of the data to be \\nreturned, includi\", \"ng which properties to populate. The eShopOnWeb sample includes several \\nspecifications that demonst\", \"rate encapsulating eager loading infor mation within the specification. You \\ncan see how the specifi\", \"cation is used as part of a query here:  \\n// Includes all expression -based includes  \\nquery = speci\", \"fication .Includes .Aggregate (query, \\n            (current, include) => current.Include(include)); \", \"\\n \\n// Include any string -based include statements  \\nquery = specification .IncludeStrings .Aggregat\", \"e (query, \\n            (current, include) => current.Include(include));  \\n73 CHAPTER 7 | Working wit\", \"h Data in ASP.NET Core Apps  \\n Another option for loading related data is to use explicit loading . \", \"Explicit loading allows you to load \\nadditional data into an entity that has already been retrieved.\", \" Since this approach involves a separate \\nrequest to the database, it\\u2019s not recommended for web appl\", \"ications, which should minimize the \\nnumber of database round trips made per request.  \\nLazy loading\", \"  is a feature that automatically loads related data as it is referenced by the application. EF \\nCor\", \"e has added support for lazy loading in version 2.1. Lazy loading is not enabled by default and \\nreq\", \"uires installing the Microsoft.EntityFrameworkCore.Proxies.  As with explicit loading, lazy loading \", \"\\nshould typically be disabled for web applications, since its use will result in additional database\", \" \\nqueries being made within each web request. Unfortunately, the overhead incurred by lazy loading \\n\", \"often g oes unnoticed at development time, when the latency is small and often the data sets used fo\", \"r \\ntesting are small. However, in production, with more users, more data, and more latency, the \\nadd\", \"itional database requests can often result in poor performance for  web applications that make \\nheav\", \"y use of lazy loading.  \\nAvoid Lazy Loading Entities in Web Applications  \\nIt\\u2019s a good idea to test \", \"your application while examining the actual database queries it makes. Under \\ncertain circumstances,\", \" EF Core may make many more queries or a more expensive query than is \\noptimal for the application. \", \"One such problem is known as a Cartesian Explosion . The EF Core team \\nmakes available the AsSplitQu\", \"ery method  as one of several ways to tune runtime behavior.  \\nEncapsulating data  \\nEF Core supports\", \" several features that allow your model to properly encapsulate its state. A common \\nproblem in doma\", \"in models is that they expose collection navigation properties as publicly accessible \\nlist types. T\", \"his problem allows any collaborator to man ipulate the contents of these collection types, \\nwhich ma\", \"y bypass important business rules related to the collection, possibly leaving the object in an \\ninva\", \"lid state. The solution to this problem is to expose read -only access to related collections, and \\n\", \"explicitly provide methods defining ways in which clients can manipulate them, as in this example:  \", \"\\npublic class Basket : BaseEntity  \\n{ \\n  public string BuyerId { get; set; } \\n  private readonly  Li\", \"st<BasketItem > _items = new List<BasketItem >(); \\n  public IReadOnlyCollection <BasketItem > Items \", \"=> _items.AsReadOnly (); \\n \\n  public void AddItem(int catalogItemId , decimal unitPrice , int quanti\", \"ty = 1) \\n  { \\n    var existingItem = Items.FirstOrDefault (i => i.CatalogItemId  == catalogItemId );\", \" \\n    if (existingItem == null) \\n    { \\n      _items.Add(new BasketItem () \\n      { \\n        Catalog\", \"ItemId = catalogItemId , \\n        Quantity = quantity , \\n        UnitPrice = unitPrice  \\n      }); \\n\", \"    }  \\n    else existingItem .Quantity  += quantity ; \\n  } \\n}  \\n74 CHAPTER 7 | Working with Data in\", \" ASP.NET Core Apps  \\n This entity type doesn\\u2019t expose a public List or ICollection property, but ins\", \"tead exposes an \\nIReadOnlyCollection type that wraps the underlying List type. When using this patte\", \"rn, you can \\nindicate to Entity Framework Core to use the backing field like so:  \\nprivate void Conf\", \"igureBasket (EntityTypeBuilder <Basket> builder) \\n{ \\n  var navigation = builder.Metadata .FindNaviga\", \"tion (nameof(Basket.Items)); \\n \\n  navigation .SetPropertyAccessMode (PropertyAccessMode .Field); \\n} \", \"\\nAnother way in which you can improve your domain model is by using value objects for types that \\nla\", \"ck identity and are only distinguished by their properties. Using such types as properties of your \\n\", \"entities can help keep logic specific to the value object where it belongs, and can avoid duplicate \", \"logic \\nbetween multiple entities that use the same concept. In Entity Framework Core, you can persis\", \"t value \\nobjects in the same table as their owning entity by configuring the type as an owned entity\", \", like so:  \\nprivate void ConfigureOrder (EntityTypeBuilder <Order> builder) \\n{ \\n  builder.OwnsOne(o\", \" => o.ShipToAddress ); \\n} \\nIn this example, the ShipToAddress property is of type Address. Address i\", \"s a value object with several \\nproperties such as Street and City. EF Core maps the Order object to \", \"its table with one column per \\nAddress property, prefixing each column name with the name of the pro\", \"perty. In this example, the \\nOrder table would include columns such as ShipToAddress_Street and Ship\", \"ToAddress_City. It\\u2019s also \\npossible to store owned types in separate tables, if desired.  \\nLearn mor\", \"e about owned entity support in EF Core . \\nResilient connections  \\nExternal resources like SQL datab\", \"ases may occasionally be unavailable. In cases of temporary \\nunavailability, applications can use re\", \"try logic to avoid raising an exception. This technique is \\ncommonly referred to as connection resil\", \"iency . You can implement your own retry with exponential \\nbackoff  technique by attempting to retry\", \" with an exponentially increasing wait time, until a maximum \\nretry count has been reached. This tec\", \"hnique embraces the fact that cloud resources might \\nintermittently be unavailable for short periods\", \" of time, resulting in th e failure of some requests.  \\nFor Azure SQL DB, Entity Framework Core alre\", \"ady provides internal database connection resiliency \\nand retry logic. But you need to enable the En\", \"tity Framework execution strategy for each DbContext \\nconnection if you want to have resilient EF Co\", \"re connections . \\nFor instance, the following code at the EF Core connection level enables resilient\", \" SQL connections that \\nare retried if the connection fails.  \\nbuilder.Services .AddDbContext <Orderi\", \"ngContext >(options => \\n{ \\n    options.UseSqlServer (builder.Configuration [\\\"ConnectionString\\\" ], \\n \", \"       sqlServerOptionsAction : sqlOptions => \\n        { \\n            sqlOptions .EnableRetryOnFailu\", \"re ( \\n            maxRetryCount : 5,  \\n75 CHAPTER 7 | Working with Data in ASP.NET Core Apps  \\n     \", \"        maxRetryDelay : TimeSpan .FromSeconds (30), \\n            errorNumbersToAdd : null); \\n       \", \" } \\n    ); \\n}); \\nExecution strategies and explicit transactions using BeginTransaction and multiple \", \"\\nDbContexts  \\nWhen retries are enabled in EF Core connections, each operation you perform using EF C\", \"ore becomes \\nits own retryable operation. Each query and each call to SaveChangesAsync will be retri\", \"ed as a unit if a \\ntransient failure occurs.  \\nHowever, if your code initiates a transaction using B\", \"eginTransaction, you are defining your own group \\nof operations that need to be treated as a unit; e\", \"verything inside the transaction has to be rolled back \\nif a failure occurs. You will see an excepti\", \"on li ke the following if you attempt to execute that \\ntransaction when using an EF execution strate\", \"gy (retry policy) and you include several \\nSaveChangesAsync from multiple DbContexts in it.  \\nSystem\", \".InvalidOperationException: The configured execution strategy \\nSqlServerRetryingExecutionStrategy do\", \"es not support user initiated transactions. Use the execution \\nstrategy returned by DbContext.Databa\", \"se.CreateExecutionStrategy() to execute all the oper ations in \\nthe transaction as a retryable unit.\", \"  \\nThe solution is to manually invoke the EF execution strategy with a delegate representing everyth\", \"ing \\nthat needs to be executed. If a transient failure occurs, the execution strategy will invoke th\", \"e delegate \\nagain. The following code shows how to implement this approach:  \\n// Use of an EF Core r\", \"esiliency strategy when using multiple DbContexts  \\n// within an explicit transaction  \\n// See: \\n// \", \"https://learn.microsoft.com/ef/core/miscellaneous/connection -resiliency  \\nvar strategy = _catalogCo\", \"ntext .Database .CreateExecutionStrategy (); \\nawait strategy .ExecuteAsync (async () => \\n{ \\n  // Ach\", \"ieving atomicity between original Catalog database operation and the  \\n  // IntegrationEventLog than\", \"ks to a local transaction  \\n  using (var transaction = _catalogContext .Database .BeginTransaction (\", \")) \\n  { \\n    _catalogContext .CatalogItems .Update(catalogItem ); \\n    await _catalogContext .SaveCh\", \"angesAsync (); \\n \\n    // Save to EventLog only if product price changed  \\n    if (raiseProductPriceC\", \"hangedEvent ) \\n    { \\n      await _integrationEventLogService .SaveEventAsync (priceChangedEvent ); \", \"\\n      transaction .Commit(); \\n    } \\n  } \\n}); \\nThe first DbContext is the _catalogContext and the s\", \"econd DbContext is within the \\n_integrationEventLogService object. Finally, the Commit action would \", \"be performed multiple \\nDbContexts and using an EF Execution Strategy.   \\n76 CHAPTER 7 | Working with\", \" Data in ASP.NET Core Apps  \\n References \\u2013 Entity Framework Core  \\n\\u2022 EF Core Docs  https://learn.mic\", \"rosoft.com/ef/  \\n\\u2022 EF Core: Related Data  https://learn.microsoft.com/ef/core/querying/related -data\", \" \\n\\u2022 Avoid Lazy Loading Entities in ASPNET Applications  https://ardalis.com/avoid -lazy-\\nloading -en\", \"tities -in-asp-net-applications  \\nEF Core or micro -ORM?  \\nWhile EF Core is a great choice for manag\", \"ing persistence, and for the most part encapsulates \\ndatabase details from application developers, i\", \"t isn\\u2019t the only choice. Another popular open -source \\nalternative is Dapper , a so -called micro -O\", \"RM. A micro -ORM is a lightweight, less full -featured tool for \\nmapping objects to data structures.\", \" In the case of Dapper, its design goals focus on performance, \\nrather than fully encapsulating the \", \"underlying queries it uses to retrieve and update data. Because it \\ndoesn\\u2019t abstract SQL from the de\", \"veloper, Dapper is \\u201ccloser to the metal\\u201d and lets developers write the \\nexact queries they want to u\", \"se for a given data access operation.  \\nEF Core has two significant features it provides which separ\", \"ate it from Dapper but also add to its \\nperformance overhead. The first is the translation from LINQ\", \" expressions into SQL. These translations \\nare cached, but even so there is overhead in performing  \", \"them the first time. The second is change \\ntracking on entities (so that efficient update statements\", \" can be generated). This behavior can be \\nturned off for specific queries by using the AsNoTracking \", \" extension. EF Core also generates SQL \\nqueries that usually are very efficient and in any case perf\", \"ectly acceptable from a performance \\nstandpoint, but if you need fine control over the precise query\", \" to be executed, you can pass in custom \\nSQL (or execute a stored procedure) using EF Core, too. In \", \"this case, Dapper still outperforms EF Core, \\nbut only very slightly. Current performance benchmark \", \"data for a variety of data access methods can \\nbe found on the Dapper site . \\nTo see how the syntax \", \"for Dapper varies from EF Core, consider these two versions of the same \\nmethod for retrieving a lis\", \"t of items:  \\n// EF Core  \\nprivate readonly  CatalogContext _context ; \\npublic async Task <IEnumerab\", \"le <CatalogType >> GetCatalogTypes () \\n{ \\n  return await _context .CatalogTypes .ToListAsync (); \\n} \", \"\\n \\n// Dapper  \\nprivate readonly  SqlConnection _conn ; \\npublic async Task <IEnumerable <CatalogType \", \">> GetCatalogTypesWithDapper () \\n{ \\n  return await _conn .QueryAsync <CatalogType >(\\\"SELECT * FROM C\", \"atalogType\\\" ); \\n} \\nIf you need to build more complex object graphs with Dapper, you need to write th\", \"e associated \\nqueries yourself (as opposed to adding an Include as you would in EF Core). This funct\", \"ionality is \\nsupported through various syntaxes, including a feature called M ulti Mapping that lets\", \" you map \\nindividual rows to multiple mapped objects. For example, given a class Post with a propert\", \"y Owner of \\ntype User, the following SQL would return all of the necessary data:   \\n77 CHAPTER 7 | W\", \"orking with Data in ASP.NET Core Apps  \\n select * from #Posts p  \\nleft join #Users u on u.Id = p.Own\", \"erId  \\nOrder by p.Id \\nEach returned row includes both User and Post data. Since the User data should\", \" be attached to the \\nPost data via its Owner property, the following function is used:  \\n(post, user\", \") => { post.Owner = user; return post; } \\nThe full code listing to return a collection of posts with\", \" their Owner property populated with the \\nassociated user data would be:  \\nvar sql = @\\\"select * from\", \" #Posts p  \\nleft join #Users u on u .Id = p.OwnerId \\nOrder by p .Id\\\"; \\nvar data = connection .Query<\", \"Post, User, Post>(sql, \\n(post, user) => { post.Owner = user; return post;}); \\nBecause it offers less\", \" encapsulation, Dapper requires developers know more about how their data is \\nstored, how to query i\", \"t efficiently, and write more code to fetch it. When the model changes, instead \\nof simply creating \", \"a new migration (another EF Core fea ture), and/or updating mapping information \\nin one place in a D\", \"bContext, every query that is impacted must be updated. These queries have no \\ncompile -time guarant\", \"ees, so they may break at run time in response to changes to the model or \\ndatabase, making error s \", \"more difficult to detect quickly. In exchange for these tradeoffs, Dapper \\noffers extremely fast per\", \"formance.  \\nFor most applications, and most parts of almost all applications, EF Core offers accepta\", \"ble \\nperformance. Thus, its developer productivity benefits are likely to outweigh its performance \\n\", \"overhead. For queries that can benefit from caching, the actual query may only be executed a tiny \\np\", \"ercentage of the time, making relatively small query performance differences moot.  \\nSQL or NoSQL  \\n\", \"Traditionally, relational databases like SQL Server have dominated the marketplace for persistent da\", \"ta \\nstorage, but they are not the only solution available. NoSQL databases like MongoDB  offer a dif\", \"ferent \\napproach to storing objects. Rather than mapping objects to tables and rows, another option \", \"is to \\nserialize the entire object graph, and store the result. The benefits of this approach, at le\", \"ast initially, \\nare simplicity and performance.  It\\u2019s simpler to store a single serialized object wi\", \"th a key than to \\ndecompose the object into many tables with relationships and update rows that may \", \"have changed \\nsince the object was last retrieved from the database. Likewise, fetching and deserial\", \"izing a single \\nobject from a key -based store is typically much faster and easier than complex join\", \"s or multiple \\ndatabase queries required to fully compose the same object from a relational database\", \". The lack of \\nlocks or transactions or a fixed schema also makes NoSQL databases amenable to scalin\", \"g across many \\nmachines, supporting very large datasets.  \\nOn the other hand, NoSQL databases (as th\", \"ey are typically called) have their drawbacks. Relational \\ndatabases use normalization to enforce co\", \"nsistency and avoid duplication of data. This approach \\nreduces the total size of the database and e\", \"nsures that updat es to shared data are available \\nimmediately throughout the database. In a relatio\", \"nal database, an Address table might reference a  \\n78 CHAPTER 7 | Working with Data in ASP.NET Core \", \"Apps  \\n Country table by ID, such that if the name of a country/region were changed, the address rec\", \"ords \\nwould benefit from the update without themselves having to be updated. However, in a NoSQL \\nda\", \"tabase, Address, and its associated Country might be serialized as  part of many stored objects. An \", \"\\nupdate to a country/region name would require all such objects to be updated, rather than a single \", \"\\nrow. Relational databases can also ensure relational integrity by enforcing rules like foreign keys\", \". \\nNoSQL databases typical ly do not offer such constraints on their data.  \\nAnother complexity NoSQ\", \"L databases must deal with is versioning. When an object\\u2019s properties \\nchange, it may not be able to\", \" be deserialized from past versions that were stored. Thus, all existing \\nobjects that have a serial\", \"ized (previous) version of the obje ct must be updated to conform to its new \\nschema. This approach \", \"is not conceptually different from a relational database, where schema \\nchanges sometimes require up\", \"date scripts or mapping updates. However, the number of entries that \\nmust be modified is often  muc\", \"h greater in the NoSQL approach, because there is more duplication of \\ndata.  \\nIt\\u2019s possible in NoSQ\", \"L databases to store multiple versions of objects, something fixed schema \\nrelational databases typi\", \"cally do not support. However, in this case, your application code will need to \\naccount for the exi\", \"stence of previous versions of object s, adding additional complexity.  \\nNoSQL databases typically d\", \"o not enforce ACID , which means they have both performance and \\nscalability benefits over relationa\", \"l databases. They\\u2019re well suited to extremely large datasets and \\nobjects that are not well suited t\", \"o storage in normalized table structures. There is no reason why a \\nsingle app lication cannot take \", \"advantage of both relational and NoSQL databases, using each where it \\nis best suited.  \\nAzure Cosmo\", \"s DB  \\nAzure Cosmos DB is a fully managed NoSQL database service that offers cloud -based schema -fr\", \"ee \\ndata storage. Azure Cosmos DB is built for fast and predictable performance, high availability, \", \"elastic \\nscaling, and global distribution. Despite being a NoSQL da tabase, developers can use rich \", \"and familiar \\nSQL query capabilities on JSON data. All resources in Azure Cosmos DB are stored as JS\", \"ON \\ndocuments. Resources are managed as items , which are documents containing metadata, and feeds ,\", \" \\nwhich are collections of it ems. Figure 8 -2 shows the relationship between different Azure Cosmos\", \" DB \\nresources.   \\n79 CHAPTER 7 | Working with Data in ASP.NET Core Apps  \\n  \\nFigure 8 -2. Azure Cos\", \"mos DB resource organization.  \\nThe Azure Cosmos DB query language is a simple yet powerful interfac\", \"e for querying JSON \\ndocuments. The language supports a subset of ANSI SQL grammar and adds deep int\", \"egration of \\nJavaScript object, arrays, object construction, and function invocation.  \\nReferences \\u2013\", \" Azure Cosmos DB  \\n\\u2022 Azure Cosmos DB Introduction https://learn.microsoft.com/azure/cosmos -db/intro\", \"duction  \\nOther persistence options  \\nIn addition to relational and NoSQL storage options, ASP.NET C\", \"ore applications can use Azure \\nStorage to store various data formats and files in a cloud -based, s\", \"calable fashion. Azure Storage is \\nmassively scalable, so you can start out storing small amounts  o\", \"f data and scale up to storing \\nhundreds or terabytes if your application requires it. Azure Storage\", \" supports four kinds of data:  \\n\\u2022 Blob Storage for unstructured text or binary storage, also referre\", \"d to as object storage.  \\n\\u2022 Table Storage for structured datasets, accessible via row keys.  \\n\\u2022 Queu\", \"e Storage for reliable queue -based messaging.  \\n \\n80 CHAPTER 7 | Working with Data in ASP.NET Core \", \"Apps  \\n \\u2022 File Storage for shared file access between Azure virtual machines and on -premises \\nappli\", \"cations.  \\nReferences \\u2013 Azure Storage  \\n\\u2022 Azure Storage Introduction https://learn.microsoft.com/azu\", \"re/storage/common/storage -\\nintroduction  \\nCaching  \\nIn web applications, each web request should be\", \" completed in the shortest time possible. One way to \\nachieve this functionality is to limit the num\", \"ber of external calls the server must make to complete the \\nrequest. Caching involves storing a copy\", \" of data on the server (or another data store that is more \\neasily queried than the source of the da\", \"ta). Web applications, an d especially non -SPA traditional web \\napplications, need to build the ent\", \"ire user interface with every request. This approach frequently \\ninvolves making many of the same da\", \"tabase queries repeatedly from one user request to the next. In \\nmost cases, this data  changes rare\", \"ly, so there is little reason to constantly request it from the \\ndatabase. ASP.NET Core supports res\", \"ponse caching, for caching entire pages, and data caching, which \\nsupports more granular caching beh\", \"avior.  \\nWhen implementing caching, it\\u2019s important to keep in mind separation of concerns. Avoid \\nim\", \"plementing caching logic in your data access logic, or in your user interface. Instead, encapsulate \", \"\\ncaching in its own classes, and use configuration to manage its be havior. This approach follows th\", \"e \\nOpen/Closed and Single Responsibility principles, and will make it easier for you to manage how y\", \"ou \\nuse caching in your application as it grows.  \\nASP.NET Core response caching  \\nASP.NET Core supp\", \"orts two levels of response caching. The first level does not cache anything on the \\nserver, but add\", \"s HTTP headers that instruct clients and proxy servers to cache responses. This \\nfunctionality is im\", \"plemented by adding the ResponseCache att ribute to individual controllers or \\nactions:  \\n[ResponseC\", \"ache (Duration = 60)] \\npublic IActionResult Contact() \\n{ \\n  ViewData [\\\"Message\\\" ] = \\\"Your contact pa\", \"ge.\\\" ; \\n  return View(); \\n} \\nThe previous example will result in the following header being added to\", \" the response, instructing \\nclients to cache the result for up to 60 seconds.  \\nCache-Control: publi\", \"c,max -age=60 \\nIn order to add server -side in -memory caching to the application, you must referenc\", \"e the \\nMicrosoft.AspNetCore.ResponseCaching NuGet package, and then add the Response Caching \\nmiddle\", \"ware. This middleware is configured with services and middleware during app  startup:   \\n81 CHAPTER \", \"7 | Working with Data in ASP.NET Core Apps  \\n builder.Services .AddResponseCaching (); \\n \\n// other c\", \"ode omitted, including building the app  \\n \\napp.UseResponseCaching (); \\nThe Response Caching Middlew\", \"are will automatically cache responses based on a set of conditions, \\nwhich you can customize. By de\", \"fault, only 200 (OK) responses requested via GET or HEAD methods \\nare cached. In addition, requests \", \"must have a response with a Ca che-Control: public header, and \\ncannot include headers for Authoriza\", \"tion or Set -Cookie. See a complete list of the caching conditions \\nused by the response caching mid\", \"dleware . \\nData caching  \\nRather than (or in addition to) caching full web responses, you can cache \", \"the results of individual data \\nqueries. For this functionality, you can use in memory caching on th\", \"e web server, or use a distributed \\ncache . This section will demonstrate how to implement in memory\", \" caching.  \\nAdd support for memory (or distributed) caching with the following code:  \\nbuilder.Servi\", \"ces .AddMemoryCache (); \\nbuilder.Services .AddMvc(); \\nBe sure to add the Microsoft.Extensions.Cachin\", \"g.Memory NuGet package as well.  \\nOnce you\\u2019ve added the service, you request IMemoryCache via depend\", \"ency injection wherever you \\nneed to access the cache. In this example, the CachedCatalogService is \", \"using the Proxy (or Decorator) \\ndesign pattern, by providing an alternative implementation of ICatal\", \"ogService that controls access to \\n(or adds behavior to) the underlying CatalogService implementatio\", \"n.  \\npublic class CachedCatalogService : ICatalogService  \\n{ \\n  private readonly  IMemoryCache _cach\", \"e ; \\n  private readonly  CatalogService _catalogService ; \\n  private static readonly  string _brands\", \"Key = \\\"brands\\\" ; \\n  private static readonly  string _typesKey = \\\"types\\\"; \\n  private static readonly \", \" TimeSpan _defaultCacheDuration = TimeSpan .FromSeconds (30); \\n \\n  public CachedCatalogService ( \\n  \", \"    IMemoryCache cache , \\n      CatalogService catalogService ) \\n  { \\n    _cache = cache; \\n    _cata\", \"logService = catalogService ; \\n  } \\n \\n  public async Task <IEnumerable <SelectListItem >> GetBrands \", \"() \\n  { \\n    return await _cache .GetOrCreateAsync (_brandsKey , async entry => \\n    { \\n      entry.\", \"SlidingExpiration  = _defaultCacheDuration ; \\n      return await _catalogService .GetBrands (); \\n   \", \" }); \\n  } \\n \\n  public async Task <Catalog> GetCatalogItems (int pageIndex , int itemsPage , int? bra\", \"ndID,  \\n82 CHAPTER 7 | Working with Data in ASP.NET Core Apps  \\n int? typeId) \\n  { \\n    string cache\", \"Key = $\\\"items-{pageIndex} -{itemsPage} -{brandID} -{typeId}\\\" ; \\n    return await _cache .GetOrCreate\", \"Async (cacheKey , async entry => \\n      { \\n        entry.SlidingExpiration  = _defaultCacheDuration \", \"; \\n        return await _catalogService .GetCatalogItems (pageIndex , itemsPage , brandID, \\ntypeId);\", \" \\n      }); \\n  } \\n \\n  public async Task <IEnumerable <SelectListItem >> GetTypes () \\n  { \\n    return\", \" await _cache .GetOrCreateAsync (_typesKey , async entry => \\n    { \\n      entry.SlidingExpiration  =\", \" _defaultCacheDuration ; \\n      return await _catalogService .GetTypes (); \\n    }); \\n  } \\n} \\nTo conf\", \"igure the application to use the cached version of the service, but still allow the service to get \\n\", \"the instance of CatalogService it needs in its constructor, you would add the following lines in \\nPr\", \"ogram.cs : \\nbuilder.Services .AddMemoryCache (); \\nbuilder.Services .AddScoped <ICatalogService , Cac\", \"hedCatalogService >(); \\nbuilder.Services .AddScoped <CatalogService >(); \\nWith this code in place, t\", \"he database calls to fetch the catalog data will only be made once per \\nminute, rather than on every\", \" request. Depending on the traffic to the site, this can have a significant \\nimpact on the number of\", \" queries made to the database, a nd the average page load time for the home \\npage that currently dep\", \"ends on all three of the queries exposed by this service.  \\nAn issue that arises when caching is imp\", \"lemented is stale data  \\u2013 that is, data that has changed at the \\nsource but an out -of-date version \", \"remains in the cache. A simple way to mitigate this issue is to use \\nsmall cache durations, since fo\", \"r a busy application there is a limited additional benefit to extending \\nthe length  data is cached.\", \" For example, consider a page that makes a single database query, and is \\nrequested 10 times per sec\", \"ond. If this page is cached for one minute, it will result in the number of \\ndatabase queries made p\", \"er minute to drop from 600 to 1, a reduction of 99.8%. If instead the cache \\nduration was made one h\", \"our, the overall reduction would be 99.997%, but now the likelihood and \\npotential age of stale data\", \" are both increased dramatically.  \\nAnother approach is to proactively remove cache entries when the\", \" data they contain is updated. Any \\nindividual entry can be removed if its key is known:  \\n_cache.Re\", \"move(cacheKey ); \\nIf your application exposes functionality for updating entries that it caches, you\", \" can remove the \\ncorresponding cache entries in your code that performs the updates. Sometimes there\", \" may be many \\ndifferent entries that depend on a particular set of data. In that case, it can be use\", \"ful to create \\ndependencies between cache entries, by using a CancellationChangeToken. With a \\nCance\", \"llationChangeToken, you can expire multiple cache entries at once by canceling the token.   \\n83 CHAP\", \"TER 7 | Working with Data in ASP.NET Core Apps  \\n // configure CancellationToken and add entry to ca\", \"che  \\nvar cts = new CancellationTokenSource (); \\n_cache.Set(\\\"cts\\\", cts); \\n_cache.Set(cacheKey , item\", \"ToCache , new CancellationChangeToken (cts.Token)); \\n \\n// elsewhere, expire the cache by cancelling \", \"the token \\\\ \\n_cache.Get<CancellationTokenSource >(\\\"cts\\\").Cancel(); \\nCaching can dramatically improve\", \" the performance of web pages that repeatedly request the same \\nvalues from the database. Be sure to\", \" measure data access and page performance before applying \\ncaching, and only apply caching where you\", \" see a need for improvement. Caching consumes web \\nserver memory resources and increases the complex\", \"ity of the application, so it\\u2019s important you don\\u2019t \\nprematurely optimize using this tech nique.  \\nG\", \"etting data to Blazor WebAssembly apps  \\nIf you\\u2019re building apps that use Blazor Server, you can use\", \" Entity Framework and other direct data \\naccess technologies as they\\u2019ve been discussed thus far in t\", \"his chapter. However, when building Blazor \\nWebAssembly apps, like other SPA frameworks, you will n \", \"eed a different strategy for data access. \\nTypically, these applications access data and interact wi\", \"th the server through web API endpoints.  \\nIf the data or operations being performed are sensitive, \", \"be sure to review the section on security in \\nthe previous chapter  and protect your APIs against un\", \"authorized access.  \\nYou\\u2019ll find an example of a Blazor WebAssembly app in the eShopOnWeb reference \", \"application , in the \\nBlazorAdmin project. This project is hosted within the eShopOnWeb Web project,\", \" and allows users in \\nthe Administrators group to manage the items in the store. You can see a scree\", \"nshot of the \\napplication in Figure 8 -3. \\n \\nFigure 8 -3. eShopOnWeb Catalog Admin Screenshot.  \\n \\n8\", \"4 CHAPTER 7 | Working with Data in ASP.NET Core Apps  \\n When fetching data from web APIs within a Bl\", \"azor WebAssembly app, you just use an instance of \\nHttpClient as you would in any .NET application. \", \"The basic steps involved are to create the request to \\nsend (if necessary, usually for POST or PUT r\", \"equests), awai t the request itself, verify the status code, \\nand deserialize the response. If you\\u2019r\", \"e going to make many requests to a given set of APIs, it\\u2019s a good \\nidea to encapsulate your APIs and\", \" configure the HttpClient base address centrally. This way, if you \\nneed t o adjust any of these set\", \"tings between environments, you can make the changes in just one \\nplace. You should add support for \", \"this service in your Program.Main:  \\nbuilder.Services .AddScoped (sp => new HttpClient  \\n  { \\n    Ba\", \"seAddress = new Uri(builder.HostEnvironment .BaseAddress ) \\n  }); \\nIf you need to access services se\", \"curely, you should access a secure token and configure the HttpClient \\nto pass this token as an Auth\", \"entication header with every request:  \\n_httpClient .DefaultRequestHeaders .Authorization  = \\n  new \", \"AuthenticationHeaderValue (\\\"Bearer\\\" , token); \\nThis activity can be done from any component that has\", \" the HttpClient injected into it, provided that \\nHttpClient wasn\\u2019t added to the application\\u2019s servic\", \"es with a Transient lifetime. Every reference to \\nHttpClient in the application references the same \", \"insta nce, so changes to it in one component flow \\nthrough the entire application. A good place to p\", \"erform this authentication check (followed by \\nspecifying the token) is in a shared component like t\", \"he main navigation for the site. Learn more about \\nthis approach in the BlazorAdmin project in the e\", \"ShopOnWeb reference application . \\nOne benefit of Blazor WebAssembly over traditional JavaScript SPA\", \"s is that you don\\u2019t need to keep \\ncopies of your data transfer objects(DTOs) synchronized. Your Blaz\", \"or WebAssembly project and your \\nweb API project can both share the same DTOs in a common sha red pr\", \"oject. This approach eliminates \\nsome of the friction involved in developing SPAs.  \\nTo quickly get \", \"data from an API endpoint, you can use the built -in helper method, GetFromJsonAsync. \\nThere are sim\", \"ilar methods for POST, PUT, etc. The following shows how to get a CatalogItem from an \\nAPI endpoint \", \"using a configured HttpClient in a Blazor We bAssembly app:  \\nvar item = await _httpClient .GetFromJ\", \"sonAsync <CatalogItem >($\\\"catalog -items/{id}\\\" ); \\nOnce you have the data you need, you\\u2019ll typically\", \" track changes locally. When you want to make \\nupdates to the backend data store, you\\u2019ll call additi\", \"onal web APIs for this purpose.  \\nReferences \\u2013 Blazor Data  \\n\\u2022 Call a web API from ASP.NET Core Blaz\", \"or https://learn.microsoft.com/aspnet/core/blazor/call -\\nweb-api  \\n85 CHAPTER 8 | Test ASP.NET Core \", \"MVC apps  \\n CHAPTER  8 \\nTest ASP.NET Core MVC \\napps \\n\\u201cIf you don\\u2019t like unit testing your product, m\", \"ost likely your customers won\\u2019t like to test it, either.\\u201d  _- \\nAnonymous - \\nSoftware of any complexi\", \"ty can fail in unexpected ways in response to changes. Thus, testing after \\nmaking changes is requir\", \"ed for all but the most trivial (or least critical) applications. Manual testing is \\nthe slowest, le\", \"ast reliable, most expensive way t o test software. Unfortunately, if applications aren\\u2019t \\ndesigned \", \"to be testable, it can be the only means of testing available. Applications written to follow \\nthe a\", \"rchitectural principles laid out in chapter 4  should be largely unit testable. ASP.NET Core \\napplic\", \"ations support automated integration and functional testing.  \\nKinds of automated tests  \\nThere are \", \"many kinds of automated tests for software applications. The simplest, lowest level test is \\nthe uni\", \"t test. At a slightly higher level, there are integration tests and functional tests. Other kinds of\", \" \\ntests, such as UI tests, load tests, stress te sts, and smoke tests, are beyond the scope of this \", \"document.  \\nUnit tests  \\nA unit test tests a single part of your application\\u2019s logic. One can furthe\", \"r describe it by listing some of \\nthe things that it isn\\u2019t. A unit test doesn\\u2019t test how your code w\", \"orks with dependencies or \\ninfrastructure \\u2013 that\\u2019s what integration tests are for. A unit test doesn\", \"\\u2019t test the framework your code \\nis written on \\u2013 you should a ssume it works or, if you find it does\", \"n\\u2019t, file a bug and code a workaround. \\nA unit test runs completely in memory and in process. It doe\", \"sn\\u2019t communicate with the file system, the \\nnetwork, or a database. Unit tests should only test your\", \" code.  \\nUnit tests, by virtue of the fact that they test only a single unit of your code, with no e\", \"xternal \\ndependencies, should execute extremely fast. Thus, you should be able to run test suites of\", \" hundreds \\nof unit tests in a few seconds. Run them frequently, ide ally before every push to a shar\", \"ed source \\ncontrol repository, and certainly with every automated build on your build server.  \\nInte\", \"gration tests  \\nAlthough it\\u2019s a good idea to encapsulate your code that interacts with infrastructur\", \"e like databases \\nand file systems, you will still have some of that code, and you will probably wan\", \"t to test it.  \\n86 CHAPTER 8 | Test ASP.NET Core MVC apps  \\n Additionally, you should verify that yo\", \"ur code\\u2019s layers interact as you expect when your application\\u2019s \\ndependencies are fully resolved. Th\", \"is functionality is the responsibility of integration tests. Integration \\ntests tend to be slower an\", \"d more difficult to  set up than unit tests, because they often depend on \\nexternal dependencies and\", \" infrastructure. Thus, you should avoid testing things that could be tested \\nwith unit tests in inte\", \"gration tests. If you can test a given scenario with a unit test, you should t est it \\nwith a unit t\", \"est. If you can\\u2019t, then consider using an integration test.  \\nIntegration tests will often have more\", \" complex setup and teardown procedures than unit tests. For \\nexample, an integration test that goes \", \"against an actual database will need a way to return the \\ndatabase to a known state before each test\", \" run. As new tests a re added and the production database \\nschema evolves, these test scripts will t\", \"end to grow in size and complexity. In many large systems, it is \\nimpractical to run full suites of \", \"integration tests on developer workstations before checking in \\nchanges to share d source control. I\", \"n these cases, integration tests may be run on a build server.  \\nFunctional tests  \\nIntegration test\", \"s are written from the perspective of the developer, to verify that some components of \\nthe system w\", \"ork correctly together. Functional tests are written from the perspective of the user, and \\nverify t\", \"he correctness of the system based on its requirements. The following excerpt offers a useful \\nanalo\", \"gy for how to think about functional tests, compared to unit tests:  \\n\\u201cMany times the development of\", \" a system is likened to the building of a house. While this analogy \\nisn\\u2019t quite correct, we can ext\", \"end it for the purposes of understanding the difference between unit \\nand functional tests. Unit tes\", \"ting is analogous to a build ing inspector visiting a house\\u2019s construction \\nsite. He is focused on t\", \"he various internal systems of the house, the foundation, framing, electrical, \\nplumbing, and so on.\", \" He ensures (tests) that the parts of the house will work correctly and safely, that \\nis, meet the b\", \"uilding code. Functional tests in this scenario are analogous to the homeowner visiting \\nthis same c\", \"onstruction site. He assumes that the internal systems will behave appropriately, that the \\nbuilding\", \" inspector is performing his task. The homeown er is focused on what it will be like to live in \\nthi\", \"s house. He is concerned with how the house looks, are the various rooms a comfortable size, does \\nt\", \"he house fit the family\\u2019s needs, are the windows in a good spot to catch the morning sun. The \\nhomeo\", \"wner i s performing functional tests on the house. He has the user\\u2019s perspective. The building \\ninsp\", \"ector is performing unit tests on the house. He has the builder\\u2019s perspective.\\u201d  \\nSource: Unit Testi\", \"ng versus Functional Tests  \\nI\\u2019m fond of saying \\u201cAs developers, we fail in two ways: we build the th\", \"ing wrong, or we build the \\nwrong thing.\\u201d Unit tests ensure you are building the thing right; functi\", \"onal tests ensure you are \\nbuilding the right thing.  \\nSince functional tests operate at the system \", \"level, they may require some degree of UI automation. \\nLike integration tests, they usually work wit\", \"h some kind of test infrastructure as well. This activity \\nmakes them slower and more brittle than u\", \"nit and integ ration tests. You should have only as many \\nfunctional tests as you need to be confide\", \"nt the system is behaving as users expect.  \\nTesting Pyramid  \\nMartin Fowler wrote about the testing\", \" pyramid, an example of which is shown in Figure 9 -1.  \\n87 CHAPTER 8 | Test ASP.NET Core MVC apps  \", \"\\n  \\nFigure 9 -1. Testing Pyramid  \\nThe different layers of the pyramid, and their relative sizes, re\", \"present different kinds of tests and how \\nmany you should write for your application. As you can see\", \", the recommendation is to have a large \\nbase of unit tests, supported by a smaller layer of integra\", \"tion tests, with an even smaller layer of \\nfunctional tests. Each layer should ideally only have tes\", \"ts in it that cannot be performed adequately at \\na lower layer. Keep the testing pyramid in mind whe\", \"n you are trying to decide which kind of test you \\nneed for a particular scenario.  \\nWhat to test  \\n\", \"A common problem for developers who are inexperienced with writing automated tests is coming up \\nwit\", \"h what to test. A good starting point is to test conditional logic. Anywhere you have a method with \", \"\\nbehavior that changes based on a conditional statement (i f-else, switch, and so on), you should be\", \" \\nable to come up with at least a couple of tests that confirm the correct behavior for certain cond\", \"itions. \\nIf your code has error conditions, it\\u2019s good to write at least one test for the \\u201chappy path\", \"\\u201d through the \\ncode (with no errors), and at least one test for the \\u201csad path\\u201d (with errors or atypi\", \"cal results) to \\nconfirm your application behaves as expected in the face of errors. Finally, try to\", \" focus on testing \\nthings that can fail, rather than focusing on metrics lik e code coverage. More c\", \"ode coverage is better \\nthan less, generally. However, writing a few more tests of a complex and bus\", \"iness -critical method is \\nusually a better use of time than writing tests for auto -properties just\", \" to improve test code coverage \\nmetric s. \\n \\n88 CHAPTER 8 | Test ASP.NET Core MVC apps  \\n Organizing\", \" test projects  \\nTest projects can be organized however works best for you. It\\u2019s a good idea to sepa\", \"rate tests by type \\n(unit test, integration test) and by what they are testing (by project, by names\", \"pace). Whether this \\nseparation consists of folders within a single test pr oject, or multiple test \", \"projects, is a design decision. \\nOne project is simplest, but for large projects with many tests, or\", \" in order to more easily run different \\nsets of tests, you might want to have several different test\", \" projects. Many teams organize tes t projects \\nbased on the project they are testing, which for appl\", \"ications with more than a few projects can result \\nin a large number of test projects, especially if\", \" you still break these down according to what kind of \\ntests are in each project. A compromise  appr\", \"oach is to have one project per kind of test, per \\napplication, with folders inside the test project\", \"s to indicate the project (and class) being tested.  \\nA common approach is to organize the applicati\", \"on projects under a \\u2018src\\u2019 folder, and the application\\u2019s \\ntest projects under a parallel \\u2018tests\\u2019 fold\", \"er. You can create matching solution folders in Visual Studio, if \\nyou find this organization useful\", \".  \\n \\nFigure 9 -2. Test organization in your solution  \\nYou can use whichever test framework you pre\", \"fer. The xUnit framework works well and is what all of \\nthe ASP.NET Core and EF Core tests are writt\", \"en in. You can add an xUnit test project in Visual Studio \\nusing the template shown in Figure 9 -3, \", \"or from the CLI  using dotnet new xunit.  \\n \\n89 CHAPTER 8 | Test ASP.NET Core MVC apps  \\n  \\nFigure 9\", \" -3. Add an xUnit Test Project in Visual Studio  \\nTest naming  \\nName your tests in a consistent fash\", \"ion, with names that indicate what each test does. One approach \\nI\\u2019ve had great success with is to n\", \"ame test classes according to the class and method they are testing. \\nThis approach results in many \", \"small test classes, bu t it makes it extremely clear what each test is \\nresponsible for. With the te\", \"st class name set up, to identify the class and method to be tested, the test \\nmethod name can be us\", \"ed to specify the behavior being tested. This name should include the \\nexpected be havior and any in\", \"puts or assumptions that should yield this behavior. Some example test \\nnames:  \\n\\u2022 CatalogController\", \"GetImage.CallsImageServiceWithId  \\n\\u2022 CatalogControllerGetImage.LogsWarningGivenImageMissingException\", \"  \\n\\u2022 CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess  \\n\\u2022 CatalogControllerGetImage.\", \"ReturnsNotFoundResultGivenImageMissingException  \\nA variation of this approach ends each test class \", \"name with \\u201cShould\\u201d and modifies the tense slightly:  \\n\\u2022 CatalogControllerGetImage Should .CallImageS\", \"erviceWithId  \\n\\u2022 CatalogControllerGetImage Should .LogWarningGivenImageMissingException  \\n \\n90 CHAPT\", \"ER 8 | Test ASP.NET Core MVC apps  \\n Some teams find the second naming approach clearer, though slig\", \"htly more verbose. In any case, try \\nto use a naming convention that provides insight into test beha\", \"vior, so that when one or more tests \\nfail, it\\u2019s obvious from their names what cases have faile d. A\", \"void naming your tests vaguely, such as \\nControllerTests.Test1, as these names offer no value when y\", \"ou see them in test results.  \\nIf you follow a naming convention like the one above that produces ma\", \"ny small test classes, it\\u2019s a \\ngood idea to further organize your tests using folders and namespaces\", \". Figure 9 -4 shows one \\napproach to organizing tests by folder within several test projec ts. \\n \\nFi\", \"gure 9 -4. Organizing test classes by folder based on class being tested.  \\nIf a particular applicat\", \"ion class has many methods being tested (and thus many test classes), it may \\nmake sense to place th\", \"ese classes in a folder corresponding to the application class. This organization \\nis no different t\", \"han how you might organize files i nto folders elsewhere. If you have more than three \\n \\n91 CHAPTER \", \"8 | Test ASP.NET Core MVC apps  \\n or four related files in a folder containing many other files, it\\u2019\", \"s often helpful to move them into their \\nown subfolder.  \\nUnit testing ASP.NET Core apps  \\nIn a well\", \" -designed ASP.NET Core application, most of the complexity and business logic will be \\nencapsulated\", \" in business entities and a variety of services. The ASP.NET Core MVC app itself, with its \\ncontroll\", \"ers, filters, viewmodels, and views, should requir e few unit tests. Much of the functionality of a \", \"\\ngiven action lies outside the action method itself. Testing whether routing or global error handlin\", \"g \\nwork correctly cannot be done effectively with a unit test. Likewise, any filters, including mode\", \"l \\nvalidat ion and authentication and authorization filters, cannot be unit tested with a test targe\", \"ting a \\ncontroller\\u2019s action method. Without these sources of behavior, most action methods should be\", \" \\ntrivially small, delegating the bulk of their work to services that  can be tested independent of \", \"the \\ncontroller that uses them.  \\nSometimes you\\u2019ll need to refactor your code in order to unit test \", \"it. Frequently this activity involves \\nidentifying abstractions and using dependency injection to ac\", \"cess the abstraction in the code you\\u2019d \\nlike to test, rather than coding directly against in frastru\", \"cture. For example, consider this easy action \\nmethod for displaying images:  \\n[HttpGet(\\\"[controller\", \"]/pic/{id}\\\" )] \\npublic IActionResult GetImage (int id) \\n{ \\n  var contentRoot = _env.ContentRootPath \", \" + \\\"//Pics\\\" ; \\n  var path = Path.Combine(contentRoot , id + \\\".png\\\"); \\n  Byte[] b = System.IO.File.Re\", \"adAllBytes (path); \\n  return File(b, \\\"image/png\\\" ); \\n} \\nUnit testing this method is made difficult b\", \"y its direct dependency on System.IO.File, which it uses to \\nread from the file system. You can test\", \" this behavior to ensure it works as expected, but doing so with \\nreal files is an integration test.\", \" It\\u2019s worth no ting you can\\u2019t unit test this method\\u2019s route \\u2014you\\u2019ll see how \\nto do this testing with\", \" a functional test shortly.  \\nIf you can\\u2019t unit test the file system behavior directly, and you can\\u2019\", \"t test the route, what is there to \\ntest? Well, after refactoring to make unit testing possible, you\", \" may discover some test cases and \\nmissing behavior, such as error handling. What does the method do\", \" when a file isn\\u2019t found? W hat \\nshould it do? In this example, the refactored method looks like thi\", \"s:  \\n[HttpGet(\\\"[controller]/pic/{id}\\\" )] \\npublic IActionResult GetImage (int id) \\n{ \\n  byte[] imageB\", \"ytes ; \\n  try \\n  { \\n    imageBytes = _imageService .GetImageBytesById (id); \\n  } \\n  catch (CatalogIm\", \"ageMissingException ex ) \\n  { \\n    _logger.LogWarning ($\\\"No image found for id: {id}\\\" ); \\n    return\", \" NotFound (); \\n  }  \\n92 CHAPTER 8 | Test ASP.NET Core MVC apps  \\n   return File(imageBytes , \\\"image/\", \"png\\\" ); \\n} \\n_logger and _imageService are both injected as dependencies. Now you can test that the s\", \"ame ID that \\nis passed to the action method is passed to _imageService, and that the resulting bytes\", \" are returned \\nas part of the FileResult. You can also test that error  logging is happening as expe\", \"cted, and that a \\nNotFound result is returned if the image is missing, assuming this behavior is imp\", \"ortant application \\nbehavior (that is, not just temporary code the developer added to diagnose an is\", \"sue). The actual file \\nlogic h as moved into a separate implementation service, and has been augment\", \"ed to return an \\napplication -specific exception for the case of a missing file. You can test this i\", \"mplementation \\nindependently, using an integration test.  \\nIn most cases, you\\u2019ll want to use global \", \"exception handlers in your controllers, so the amount of logic \\nin them should be minimal and probab\", \"ly not worth unit testing. Do most of your testing of controller \\nactions using functional tests and\", \" the TestServer class described below.  \\nIntegration testing ASP.NET Core apps  \\nMost of the integra\", \"tion tests in your ASP.NET Core apps should be testing services and other \\nimplementation types defi\", \"ned in your Infrastructure project. For example, you could test that EF Core \\nwas successfully updat\", \"ing and retrieving the data that you expect  from your data access classes \\nresiding in the Infrastr\", \"ucture project. The best way to test that your ASP.NET Core MVC project is \\nbehaving correctly is wi\", \"th functional tests that run against your app running in a test host.  \\nFunctional testing ASP.NET C\", \"ore apps  \\nFor ASP.NET Core applications, the TestServer class makes functional tests fairly easy to\", \" write. You \\nconfigure a TestServer using a WebHostBuilder (or HostBuilder) directly (as you normall\", \"y do for your \\napplication), or with the WebApplicationFactory type ( available since version 2.1). \", \"Try to match your \\ntest host to your production host as closely as possible, so your tests exercise \", \"behavior similar to what \\nthe app will do in production. The WebApplicationFactory class is helpful \", \"for configuring the \\nTestServ er\\u2019s ContentRoot, which is used by ASP.NET Core to locate static resou\", \"rce like Views.  \\nYou can create simple functional tests by creating a test class that implements \\nI\", \"ClassFixture<WebApplicationFactory<TEntryPoint>>, where TEntryPoint is your web application\\u2019s \\nStart\", \"up class. With this interface in place, your test fixture can create a clien t using the factory\\u2019s \\n\", \"CreateClient method:  \\npublic class BasicWebTests : IClassFixture <WebApplicationFactory <Program>> \", \"\\n{ \\n  protected  readonly  HttpClient _client ; \\n \\n  public BasicWebTests (WebApplicationFactory <Pr\", \"ogram> factory) \\n  { \\n    _client = factory.CreateClient (); \\n  } \\n  \\n93 CHAPTER 8 | Test ASP.NET Co\", \"re MVC apps  \\n   // write tests that use _client  \\n} \\n \\n \\nTip \\nIf you\\u2019re using minimal API configura\", \"tion in your Program.cs  file, by default the class will be declared \\ninternal and won\\u2019t be accessib\", \"le from the test project. You can choose any other instance class in your \\nweb project instead, or a\", \"dd this to your Program.cs  file: \\n]{custom -style=Code}`csharp // Make the implicit Program class p\", \"ublic so test projects can access it \\npublic partial class Program { } [`  \\nFrequently, you\\u2019ll want \", \"to perform some additional configuration of your site before each test runs, \\nsuch as configuring th\", \"e application to use an in -memory data store and then seeding the application \\nwith test data. To a\", \"chieve this functionality, create y our own subclass of \\nWebApplicationFactory<TEntryPoint> and over\", \"ride its ConfigureWebHost method. The example \\nbelow is from the eShopOnWeb FunctionalTests project \", \"and is used as part of the tests on the main \\nweb application.  \\nusing Microsoft .AspNetCore .Hostin\", \"g; \\nusing Microsoft .AspNetCore .Identity ; \\nusing Microsoft .AspNetCore .Mvc.Testing; \\nusing Micros\", \"oft .EntityFrameworkCore ; \\nusing Microsoft .eShopWeb .Infrastructure .Data; \\nusing Microsoft .eShop\", \"Web .Infrastructure .Identity ; \\nusing Microsoft .eShopWeb .Web; \\nusing Microsoft .Extensions .Depen\", \"dencyInjection ; \\nusing Microsoft .Extensions .Logging; \\nusing System; \\n \\nnamespace  Microsoft .eSho\", \"pWeb .FunctionalTests .Web; \\npublic class WebTestFixture : WebApplicationFactory <Startup> \\n{ \\n  pro\", \"tected  override  void ConfigureWebHost (IWebHostBuilder builder ) \\n  { \\n    builder.UseEnvironment \", \"(\\\"Testing\\\" ); \\n \\n    builder.ConfigureServices (services => \\n    { \\n      services .AddEntityFramewo\", \"rkInMemoryDatabase (); \\n \\n      // Create a new service provider.  \\n      var provider = services  \\n\", \"            .AddEntityFrameworkInMemoryDatabase () \\n            .BuildServiceProvider (); \\n \\n      /\", \"/ Add a database context (ApplicationDbContext) using an in -memory \\n      // database for testing. \", \" \\n      services .AddDbContext <CatalogContext >(options => \\n      { \\n        options.UseInMemoryDat\", \"abase (\\\"InMemoryDbForTesting\\\" ); \\n        options.UseInternalServiceProvider (provider ); \\n      });\", \" \\n \\n      services .AddDbContext <AppIdentityDbContext >(options => \\n      {  \\n94 CHAPTER 8 | Test A\", \"SP.NET Core MVC apps  \\n         options.UseInMemoryDatabase (\\\"Identity\\\" ); \\n        options.UseInter\", \"nalServiceProvider (provider ); \\n      }); \\n \\n      // Build the service provider.  \\n      var sp = \", \"services .BuildServiceProvider (); \\n \\n      // Create a scope to obtain a reference to the database \", \" \\n      // context (ApplicationDbContext).  \\n      using (var scope = sp.CreateScope ()) \\n      { \\n \", \"       var scopedServices = scope.ServiceProvider ; \\n        var db = scopedServices .GetRequiredSer\", \"vice <CatalogContext >(); \\n        var loggerFactory = scopedServices .GetRequiredService <ILoggerFa\", \"ctory >(); \\n \\n        var logger = scopedServices  \\n            .GetRequiredService <ILogger<WebTest\", \"Fixture >>(); \\n \\n        // Ensure the database is created.  \\n        db.Database .EnsureCreated ();\", \" \\n \\n        try \\n        { \\n          // Seed the database with test data.  \\n          CatalogContex\", \"tSeed .SeedAsync (db, loggerFactory ).Wait(); \\n \\n          // seed sample user data  \\n          var \", \"userManager = \\nscopedServices .GetRequiredService <UserManager <ApplicationUser >>(); \\n          var\", \" roleManager = scopedServices .GetRequiredService <RoleManager <IdentityRole >>(); \\n          AppIde\", \"ntityDbContextSeed .SeedAsync (userManager , roleManager ).Wait(); \\n        } \\n        catch (Except\", \"ion ex ) \\n        { \\n          logger.LogError (ex, $\\\"An error occurred seeding the \\\"  + \\n          \", \"          \\\"database with test messages. Error: {ex.Message}\\\" ); \\n        } \\n      } \\n    }); \\n  } \\n}\", \" \\nTests can make use of this custom WebApplicationFactory by using it to create a client and then \\nm\", \"aking requests to the application using this client instance. The application will have data seeded \", \"\\nthat can be used as part of the test\\u2019s assertions. The foll owing test verifies that the home page \", \"of the \\neShopOnWeb application loads correctly and includes a product listing that was added to the \", \"\\napplication as part of the seed data.  \\nusing Microsoft .eShopWeb .FunctionalTests .Web; \\nusing Sys\", \"tem.Net.Http; \\nusing System.Threading .Tasks; \\nusing Xunit; \\n \\nnamespace  Microsoft .eShopWeb .Funct\", \"ionalTests .WebRazorPages ; \\n[Collection (\\\"Sequential\\\" )] \\npublic class HomePageOnGet : IClassFixtur\", \"e <WebTestFixture > \\n{ \\n  public HomePageOnGet (WebTestFixture factory ) \\n  {  \\n95 CHAPTER 8 | Test \", \"ASP.NET Core MVC apps  \\n     Client = factory.CreateClient (); \\n  } \\n \\n  public HttpClient Client { \", \"get; } \\n \\n  [Fact] \\n  public async Task ReturnsHomePageWithProductListing () \\n  { \\n    // Arrange & \", \"Act  \\n    var response = await Client .GetAsync (\\\"/\\\"); \\n    response .EnsureSuccessStatusCode (); \\n \", \"   var stringResponse = await response .Content.ReadAsStringAsync (); \\n \\n    // Assert  \\n    Assert.\", \"Contains (\\\".NET Bot Black Sweatshirt\\\" , stringResponse ); \\n  } \\n} \\nThis functional test exercises th\", \"e full ASP.NET Core MVC / Razor Pages application stack, including all \\nmiddleware, filters, and bin\", \"ders that may be in place. It verifies that a given route (\\u201c/\\u201d) returns the \\nexpected success status\", \" code and HTML output. It  does so without setting up a real web server, and \\navoids much of the bri\", \"ttleness that using a real web server for testing can experience (for example, \\nproblems with firewa\", \"ll settings). Functional tests that run against TestServer are usually slower than \\nintegration and \", \"unit tests, but are much faster than tests that would run over the network to a test \\nweb server. Us\", \"e functional tests to ensure your application\\u2019s front -end stack is working as expected. \\nThese test\", \"s are especially useful when you find duplic ation in your controllers or pages and you \\naddress the\", \" duplication by adding filters. Ideally, this refactoring won\\u2019t change the behavior of the \\napplicat\", \"ion, and a suite of functional tests will verify this is the case.  \\nReferences \\u2013 Test ASP.NET Core \", \"MVC apps  \\n\\u2022 Testing in ASP.NET Core  \\nhttps://learn.microsoft.com/aspnet/core/testing/  \\n\\u2022 Unit Tes\", \"t Naming Convention  \\nhttps://ardalis.com/unit -test-naming -convention  \\n\\u2022 Testing EF Core  \\nhttps:\", \"//learn.microsoft.com/ef/core/miscellaneous/testing/  \\n\\u2022 Integration tests in ASP.NET Core  \\nhttps:/\", \"/learn.microsoft.com/aspnet/core/test/integration -tests   \\n96 CHAPTER 9 | Development process for A\", \"zure  \\n CHAPTER  9 \\nDevelopment process for \\nAzure  \\n\\u201cWith the cloud, individuals and small business\", \"es can snap their fingers and instantly set up enterprise -\\nclass services.\\u201d  \\n- Roy Stephan  \\nVisio\", \"n  \\nDevelop well -designed ASP .NET Core applications the way you like, using Visual Studio or the d\", \"otnet \\nCLI and Visual Studio Code or your editor of choice.  \\nDevelopment environment for ASP.NET Co\", \"re apps  \\nDevelopment tools choices: IDE or editor  \\nWhether you prefer a full and powerful IDE or a\", \" lightweight and agile editor, Microsoft has you \\ncovered when developing ASP.NET Core applications.\", \"  \\nVisual Studio 2022.  Visual Studio 2022 is the best -in-class IDE for developing applications for\", \" \\nASP.NET Core. It offers a host of features that increase developer productivity. You can use it to\", \" \\ndevelop the application, then analyze its performance and other characteristics.  The integrated \\n\", \"debugger lets you pause code execution and step back and forth through code on the fly as it\\u2019s \\nrunn\", \"ing. Its support for hot reloads allows you to continue working with your app where you left off, \\ne\", \"ven after making code c hanges, without having to restart the app. The built -in test runner lets yo\", \"u \\norganize your tests and their results and can even perform live unit testing while you\\u2019re coding.\", \" Using \\nLive Share, you can collaborate in real -time with other developers, sharing  your code sess\", \"ion \\nseamlessly over the network. And when you\\u2019re ready, Visual Studio includes everything you need \", \"to \\npublish your application to Azure or wherever you might host it.  \\nDownload Visual Studio 2022  \", \"\\nVisual Studio Code and dotnet CLI  (Cross -Platform Tools for Mac, Linux, and Windows). If you pref\", \"er \\na lightweight and cross -platform editor supporting any development language, you can use Micros\", \"oft \\nVisual Studio Code and the dotnet CLI. These products provide a simple yet robust experien ce t\", \"hat  \\n97 CHAPTER 9 | Development process for Azure  \\n streamlines the developer workflow. Additional\", \"ly, Visual Studio Code supports extensions for C# and \\nweb development, providing intellisense and s\", \"hortcut -tasks within the editor.  \\nDownload the .NET SDK  \\nDownload Visual Studio Code  \\nDevelopmen\", \"t workflow for Azure -hosted ASP.NET \\nCore apps  \\nThe application development lifecycle starts from \", \"each developer\\u2019s machine, coding the app using \\ntheir preferred language and testing it locally. Dev\", \"elopers may choose their preferred source control \\nsystem and can configure Continuous Integration (\", \"CI) and/ or Continuous Delivery/Deployment (CD) \\nusing a build server or based on built -in Azure fe\", \"atures.  \\nTo get started with developing an ASP.NET Core application using CI/CD, you can use Azure \", \"DevOps \\nServices or your organization\\u2019s own Team Foundation Server (TFS). GitHub Actions provide ano\", \"ther \\noption for easily building and deploying apps to Azure, for ap ps whose code is hosted on GitH\", \"ub.  \\nInitial setup  \\nTo create a release pipeline for your app, you need to have your application c\", \"ode in source control. \\nSet up a local repository and connect it to a remote repository in a team pr\", \"oject. Follow these \\ninstructions:  \\n\\u2022 Share your code with Git and Visual Studio  or \\n\\u2022 Share your \", \"code with TFVC and Visual Studio  \\nCreate an Azure App Service where you\\u2019ll deploy your application.\", \" Create a Web App by going to the \\nApp Services blade on the Azure portal. Click +Add, select the We\", \"b App template, click Create, and \\nprovide a name and other details. The web app will be acce ssible\", \" from {name}.azurewebsites.net.   \\n98 CHAPTER 9 | Development process for Azure  \\n  \\nFigure 10 -1. C\", \"reating a new Azure App Service Web App in the Azure Portal.  \\nYour CI build process will perform an\", \" automated build whenever new code is committed to the \\nproject\\u2019s source control repository. This pr\", \"ocess gives you immediate feedback that the code builds \\n(and, ideally, passes automated tests) and \", \"can potentially be de ployed. This CI build will produce a \\nweb deploy package artifact and publish \", \"it for consumption by your CD process.  \\nDefine your CI build process  \\nBe sure to enable continuous\", \" integration so the system will queue a build whenever someone on your \\nteam commits new code. Test \", \"the build and verify that it is producing a web deploy package as one of \\nits artifacts.  \\nWhen a bu\", \"ild succeeds, your CD process will deploy the results of your CI build to your Azure web \\napp. To co\", \"nfigure this step, you create and configure a Release , which will deploy to your Azure App \\nService\", \".  \\nDeploy an Azure web app  \\nOnce your CI/CD pipeline is configured, you can easily make updates to\", \" your web app and commit \\nthem to source control to have them deployed.  \\nWorkflow for developing Az\", \"ure -hosted ASP.NET Core applications  \\nOnce you have configured your Azure account and your CI/CD p\", \"rocess, developing Azure -hosted \\nASP.NET Core applications is simple. The following are the basic s\", \"teps you usually take when building \\nan ASP.NET Core app, hosted in Azure App Service as a Web App, \", \" as illustrated in Figure 10 -2. \\n \\n99 CHAPTER 9 | Development process for Azure  \\n  \\nFigure 10 -2. \", \"Step-by-step workflow for building ASP.NET Core apps and hosting them in Azure  \\nStep 1. Local dev e\", \"nvironment inner loop  \\nDeveloping your ASP.NET Core application for deployment to Azure is no diffe\", \"rent from developing \\nyour application otherwise. Use the local development environment you\\u2019re comfo\", \"rtable with, whether \\nthat\\u2019s Visual Studio 2019 or the dotnet CLI and Visual Studi o Code or your pr\", \"eferred editor. You can \\nwrite code, run and debug your changes, run automated tests, and make local\", \" commits to source \\ncontrol until you\\u2019re ready to push your changes to your shared source control re\", \"pository.  \\nStep 2. Application code repository  \\nWhenever you\\u2019re ready to share your code with your\", \" team, you should push your changes from your \\nlocal source repository to your team\\u2019s shared source \", \"repository. If you\\u2019ve been working in a custom \\nbranch, this step usually involves merging your code\", \" into a shared branch (perhaps by means of a pull \\nrequest ). \\nStep 3. Build Server: Continuous inte\", \"gration. build, test, package  \\nA new build is triggered on the build server whenever a new commit i\", \"s made to the shared \\napplication code repository. As part of the CI process, this build should full\", \"y compile the application \\nand run automated tests to confirm everything is working as exp ected. Th\", \"e end result of the CI \\nprocess should be a packaged version of the web app, ready for deployment.  \", \"\\nStep 4. Build Server: Continuous delivery  \\nOnce a build has succeeded, the CD process will pick up\", \" the build artifacts produced. This process will \\ninclude a web deploy package. The build server wil\", \"l deploy this package to Azure App Service, \\n \\n100 CHAPTER 9 | Development process for Azure  \\n repl\", \"acing any existing service with the newly created one. Typically this step targets a staging \\nenviro\", \"nment, but some applications deploy directly to production through a CD process.  \\nStep 5. Azure App\", \" Service Web App  \\nOnce deployed, the ASP.NET Core application runs within the context of an Azure A\", \"pp Service Web \\nApp. This Web App can be monitored and further configured using the Azure Portal.  \\n\", \"Step 6. Production monitoring and diagnostics  \\nWhile the Web App is running, you can monitor the he\", \"alth of the application and collect diagnostics \\nand user behavior data. Application Insights is inc\", \"luded in Visual Studio, and offers automatic \\ninstrumentation for ASP.NET apps. It can provide you w\", \"ith in formation on usage, exceptions, requests, \\nperformance, and logs.  \\nReferences  \\nBuild and De\", \"ploy Your ASP.NET Core App to Azure  \\nhttps://learn.microsoft.com/azure/devops/build -release/apps/a\", \"spnet/build -aspnet -core  \\n101 CHAPTER 10 | Azure hosting recommendations for ASP.NET Core web apps\", \"  \\n CHAPTER  10 \\nAzure hosting \\nrecommendations for \\nASP.NET Core web apps  \\n\\u201cLine -of-business lead\", \"ers everywhere are bypassing IT departments to get applications from the cloud \\n(also known as SaaS)\", \" and paying for them like they would a magazine subscription. And when the \\nservice is no longer req\", \"uired, they can cancel the subscription with no equipment left unused in the \\ncorner.\\u201d  \\n- Daryl Plu\", \"mmer, Gartner analyst  \\nWhatever your application\\u2019s needs and architecture, Microsoft Azure can supp\", \"ort it. Your hosting \\nneeds can be as simple as a static website or a sophisticated application made\", \" up of dozens of \\nservices. For ASP.NET Core monolithic web applications and suppo rting services, t\", \"here are several \\nwell-known configurations that are recommended. The recommendations on this articl\", \"e are grouped \\nbased on the kind of resource to be hosted, whether full applications, individual pro\", \"cesses, or data.  \\nWeb applications  \\nWeb applications can be hosted with:  \\n\\u2022 App Service Web Apps \", \" \\n\\u2022 Containers (several options)  \\n\\u2022 Virtual Machines (VMs)  \\nOf these, App Service Web Apps is the \", \"recommended approach for most scenarios, including simple \\ncontainer -based apps. For microservice a\", \"rchitectures, consider a container -based approach. If you \\nneed more control over the machines runn\", \"ing your application, consider Azure Virtual Machines.  \\nApp Service Web Apps  \\nApp Service Web Apps\", \" offers a fully managed platform optimized for hosting web applications. It\\u2019s a \\nplatform as a servi\", \"ce (PaaS) offering that lets you focus on your business logic, while Azure takes care \\nof the infras\", \"tructure needed to run and scale the a pp. Some key features of App Service Web Apps:   \\n102 CHAPTER\", \" 10 | Azure hosting recommendations for ASP.NET Core web apps  \\n \\u2022 DevOps optimization (continuous i\", \"ntegration and delivery, multiple environments, A/B \\ntesting, scripting support).  \\n\\u2022 Global scale a\", \"nd high availability.  \\n\\u2022 Connections to SaaS platforms and your on -premises data.  \\n\\u2022 Security and\", \" compliance.  \\n\\u2022 Visual Studio integration.  \\nAzure App Service is the best choice for most web apps\", \". Deployment and management are integrated \\ninto the platform, sites can scale quickly to handle hig\", \"h traffic loads, and the built -in load balancing \\nand traffic manager provide high availability. Yo\", \"u can  move existing sites to Azure App Service easily \\nwith an online migration tool. You can use a\", \"n open -source app from the Web Application Gallery, or \\ncreate a new site using the framework and t\", \"ools of your choice. The WebJobs feature makes it easy to \\nadd bac kground job processing to your Ap\", \"p Service web app. If you have an existing ASP.NET \\napplication hosted on -premises using a local da\", \"tabase, there\\u2019s a clear path to migrate. You can use \\nApp Service Web App with an Azure SQL Database\", \" (or secure access to your  on-premises database \\nserver, if preferred).  \\n \\nIn most cases, moving f\", \"rom a locally hosted ASP.NET app to an App Service Web App is a \\nstraightforward process. Little or \", \"no modification should be required of the app itself, and it can \\nquickly start to take advantage of\", \" the many features that Azure App S ervice Web Apps offer.  \\n \\n103 CHAPTER 10 | Azure hosting recomm\", \"endations for ASP.NET Core web apps  \\n In addition to apps that are not optimized for the cloud, Azu\", \"re App Service Web Apps are an excellent \\nsolution for many simple monolithic (non -distributed) app\", \"lications, such as many ASP.NET Core apps. \\nIn this approach, the architecture is basic and simple  \", \"to understand and manage:  \\n \\nA small number of resources in a single resource group is typically su\", \"fficient to manage such an app. \\nApps that are typically deployed as a single unit, rather than thos\", \"e apps that are made up of many \\nseparate processes, are good candidates for this basic architectura\", \"l approach . Though architecturally \\nsimple, this approach still allows the hosted app to scale both\", \" up (more resources per node) and out \\n(more hosted nodes) to meet any increase in demand. With auto\", \"scale, the app can be configured to \\nautomatically adjust the number of nodes hosting the app based \", \"on demand and average load across \\nnodes.  \\nApp Service Web Apps for Containers  \\nIn addition to sup\", \"port for hosting web apps directly, App Service Web Apps for Containers  can be \\nused to run contain\", \"erized applications on Windows and Linux. Using this service, you can easily \\ndeploy and run contain\", \"erized applications that can scale with your business. The apps have all of the \\nfeatures of App Ser\", \"vice Web Apps listed above. In addition, Web Apps for Containers supports \\nstreamlined CI/CD with Do\", \"cker Hub, Azure Container Registry, and GitHub. You can use Azure DevOps \\nto define build and deploy\", \"ment pipelines that publish changes to a registry. These changes can then \\nbe tested in a staging en\", \"vironment and automatically deployed to production using deployment slots, \\nallowing zero -downtime \", \"upgrades. Rolling back to previous versions can be done just as easily.  \\nThere are a few scenarios \", \"where Web Apps for Containers makes the most sense. If you have existing \\napps that you can containe\", \"rize, whether in Windows or Linux containers, you can host these easily \\nusing this toolset. Just pu\", \"blish your container and then co nfigure Web Apps for Containers to pull the \\nlatest version of that\", \" image from your registry of choice. This is a \\u201clift and shift\\u201d approach to migrating \\nfrom classic \", \"app hosting models to a cloud -optimized model.  \\n \\n104 CHAPTER 10 | Azure hosting recommendations f\", \"or ASP.NET Core web apps  \\n  \\nThis approach also works well if your development team is able to move\", \" to a container -based \\ndevelopment process. The \\u201cinner loop\\u201d of developing apps with containers inc\", \"ludes building the app \\nwith containers. Changes made to the code as well as to container  configura\", \"tion are pushed to source \\ncontrol, and an automated build is responsible for publishing new contain\", \"er images to a registry like \\nDocker Hub or Azure Container Registry. These images are then used as \", \"the basis for additional \\ndevelopment, as well as  for deployments to production, as shown in the fo\", \"llowing diagram:  \\n \\n105 CHAPTER 10 | Azure hosting recommendations for ASP.NET Core web apps  \\n  \\nD\", \"eveloping with containers offers many advantages, especially when containers are used in \\nproduction\", \". The same container configuration is used to host the app in each environment in which it \\nruns, fr\", \"om the local development machine to build and test system s to production. This approach \\ngreatly re\", \"duces the likelihood of defects resulting from differences in machine configuration or \\nsoftware ver\", \"sions. Developers can also use whatever tools they\\u2019re most productive with, including the \\noperating\", \" system, since co ntainers can run on any OS. In some cases, distributed applications \\ninvolving man\", \"y containers may be very resource -intensive to run on a single development machine. In \\nthis scenar\", \"io, it may make sense to upgrade to using Kubernetes and Azure Dev Spaces, co vered in \\nthe next sec\", \"tion.  \\nAs portions of larger applications are broken up into their own smaller, independent microse\", \"rvices , \\nadditional design patterns can be used to improve app behavior. Instead of working directl\", \"y with \\nindividual services, an API gateway  can simplify access and decouple the client from its ba\", \"ck end. \\nHaving separate service back ends for different front ends also allows services to evolve i\", \"n concert \\nwith their consumers. Common services can be accessed via a separate sidecar  container, \", \"which might \\ninclude common client connectivity libraries using the ambassador  pattern.  \\n \\n106 CHA\", \"PTER 10 | Azure hosting recommendations for ASP.NET Core web apps  \\n  \\nLearn more about design patte\", \"rns to consider when building microservice -based systems.  \\nAzure Kubernetes Service  \\nAzure Kubern\", \"etes Service (AKS) manages your hosted Kubernetes environment, making it quick and \\neasy to deploy a\", \"nd manage containerized applications without container orchestration expertise. It \\nalso eliminates \", \"the burden of ongoing operations and maintenance by provisioning, upgrading, and \\nscaling resources \", \"on -demand, without taking your applications offline.  \\nAKS reduces the complexity and operational o\", \"verhead of managing a Kubernetes cluster by \\noffloading much of that responsibility to Azure. As a h\", \"osted Kubernetes service, Azure handles critical \\ntasks like health monitoring and maintenance for y\", \"ou. Also, you pay only for the agent nodes within \\nyour clusters, not for the masters. As a managed \", \"Kubernetes service, AKS provides:  \\n\\u2022 Automated Kubernetes version upgrades and patching.  \\n\\u2022 Easy c\", \"luster scaling.  \\n\\u2022 Self-healing hosted control plane (masters).  \\n\\u2022 Cost savings - pay only for run\", \"ning agent pool nodes.  \\nWith Azure handling the management of the nodes in your AKS cluster, you no\", \" longer need to \\nperform many tasks manually, like cluster upgrades. Because Azure handles these cri\", \"tical maintenance \\ntasks for you, AKS doesn\\u2019t provide direct access (such as with S SH) to the clust\", \"er.  \\nTeams who are leveraging AKS can also take advantage of Azure Dev Spaces. Azure Dev Spaces hel\", \"ps \\nteams to focus on the development and rapid iteration of their microservice application by allow\", \"ing \\nteams to work directly with their entire microservices arch itecture or application running in \", \"AKS. Azure \\nDev Spaces also provides a way to independently update portions of your microservices ar\", \"chitecture \\nin isolation without affecting the rest of the AKS cluster or other developers.  \\n \\n107 \", \"CHAPTER 10 | Azure hosting recommendations for ASP.NET Core web apps  \\n  \\nAzure Dev Spaces:  \\n\\u2022 Mini\", \"mize local machine setup time and resource requirements  \\n\\u2022 Allow teams to iterate more rapidly  \\n\\u2022 \", \"Reduce the number of integration environments required by a team  \\n\\u2022 Remove the need to mock certain\", \" services in a distributed system when developing/testing  \\nLearn more about Azure Dev Spaces  \\nAzur\", \"e Virtual Machines  \\nIf you have an existing application that would require substantial modification\", \"s to run in App Service, \\nyou could choose Virtual Machines in order to simplify migrating to the cl\", \"oud. However, correctly \\nconfiguring, securing, and maintaining VMs requires much more time and IT e\", \"xpertise compared to \\nAzure App Ser vice. If you\\u2019re considering Azure Virtual Machines, make sure yo\", \"u take into account the \\nongoing maintenance effort required to patch, update, and manage your VM en\", \"vironment. Azure \\nVirtual Machines is infrastructure as a service (IaaS), while App Service is  PaaS\", \". You should also \\nconsider whether deploying your app as a Windows Container to Web App for Contain\", \"ers might be a \\nviable option for your scenario.  \\nLogical processes  \\nIndividual logical processes \", \"that can be decoupled from the rest of the application may be deployed \\nindependently to Azure Funct\", \"ions in a \\u201cserverless\\u201d manner. Azure Functions lets you just write the \\ncode you need for a given pr\", \"oblem, without worrying about  the application or infrastructure to run it. \\nYou can choose from a v\", \"ariety of programming languages, including C#, F#, Node.js, Python, and \\nPHP, allowing you to pick t\", \"he most productive language for the task at hand. Like most cloud -based \\nsolutions, you p ay only f\", \"or the amount of time your use, and you can trust Azure Functions to scale up \\nas needed.  \\nData \\nAz\", \"ure offers a wide variety of data storage options, so that your application can use the appropriate \", \"\\ndata provider for the data in question.  \\n \\n108 CHAPTER 10 | Azure hosting recommendations for ASP.\", \"NET Core web apps  \\n For transactional, relational data, Azure SQL Databases are the best option. Fo\", \"r high performance \\nread-mostly data, a Redis cache backed by an Azure SQL Database is a good soluti\", \"on.  \\nUnstructured JSON data can be stored in a variety of ways, from SQL Database columns to Blobs \", \"or \\nTables in Azure Storage, to Azure Cosmos DB. Of these, Azure Cosmos DB offers the best querying \", \"\\nfunctionality, and is the recommended option for large numbers of JSON -based documents that must \\n\", \"support querying.  \\nTransient command - or event -based data used to orchestrate application behavio\", \"r can use Azure \\nService Bus or Azure Storage Queues. Azure Service Bus offers more flexibility and \", \"is the \\nrecommended service for non -trivial messaging within and between applica tions.  \\nArchitect\", \"ure recommendations  \\nYour application\\u2019s requirements should dictate its architecture. There are man\", \"y different Azure \\nservices available. Choosing the right one is an important decision. Microsoft of\", \"fers a gallery of \\nreference architectures to help identify typical architectures optimized for comm\", \"on scenarios. You \\nmay find a reference architecture that map s closely to your application\\u2019s requir\", \"ements, or at least \\noffers a starting point.  \\nFigure 11 -1 shows an example reference architecture\", \". This diagram describes a recommended \\narchitecture approach for a Sitecore content management syst\", \"em website optimized for marketing.  \\n \\nFigure 11 -1. Sitecore marketing website reference architect\", \"ure.  \\nReferences \\u2013 Azure hosting recommendations  \\n\\u2022 Azure Solution Architectures  \\nhttps://azure.m\", \"icrosoft.com/solutions/architecture/  \\n \\n109 CHAPTER 10 | Azure hosting recommendations for ASP.NET \", \"Core web apps  \\n \\u2022 Azure Basic Web Application Architecture  \\nhttps://learn.microsoft.com/azure/arch\", \"itecture/reference -architectures/app -service -web-\\napp/basic -web-app \\n\\u2022 Design Patterns for Micro\", \"services  \\nhttps://learn.microsoft.com/azure/architecture/microservices/design/patterns  \\n\\u2022 Azure De\", \"veloper Guide  \\nhttps://azure.microsoft.com/campaigns/developer -guide/  \\n\\u2022 Web Apps overview  \\nhttp\", \"s://learn.microsoft.com/azure/app -service/app -service -web-overview  \\n\\u2022 Web App for Containers  \\nh\", \"ttps://azure.microsoft.com/services/app -service/containers/  \\n\\u2022 Introduction to Azure Kubernetes Se\", \"rvice (AKS)  \\nhttps://learn.microsoft.com/azure/aks/intro -kubernetes  \"]"