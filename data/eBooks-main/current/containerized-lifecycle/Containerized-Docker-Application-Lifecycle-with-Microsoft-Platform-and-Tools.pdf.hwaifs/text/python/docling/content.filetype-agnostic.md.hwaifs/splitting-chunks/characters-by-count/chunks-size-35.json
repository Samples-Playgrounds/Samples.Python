"[\"<!-- image -->\\n\\nContainerized Docker Application Lifecycle with Microsoft Platform and Tools\\n\\n<!-- i\", \"mage -->\\n\\nCesar de la Torre Microsoft Corp.\\n\\nEDITION v6.0.0 -Updated to ASP.NET Core 6.0\\n\\nRefer chan\", \"gelog for the book updates and community contributions.\\n\\nThis guide is a general overview for develo\", \"ping and deploying containerized ASP.NET Core applications with Docker, using the Microsoft platform\", \" and tools. The guide includes a high-level introduction to Azure DevOps, for implementing CI/CD pip\", \"elines, as well as Azure Container Registry (ACR) and Azure Kubernetes Services AKS for deployment.\\n\", \"\\nFor low -level, development-related details you can see the .NET Microservices: Architecture for Co\", \"ntainerized .NET Applications guide and it related reference application eShopOnContainers .\\n\\n## Cre\", \"dits\\n\\nAuthor:\\n\\nCesar de la Torre, Sr. PM, .NET product team, Microsoft Corp.\\n\\nAcquisitions Editor:\\n\\n\", \"Janine Patrick\\n\\nDevelopmental Editor:\\n\\nBob Russell, Solutions Professional at Microsoft\\n\\n## Octal Pu\", \"blishing, Inc.\\n\\nEditorial Production:\\n\\nDianne Russell\\n\\n## Octal Publishing, Inc.\\n\\nCopyeditor:\\n\\nBob R\", \"ussell, Solutions Professional at Microsoft\\n\\nParticipants and reviewers:\\n\\nNish Anil, Sr. Program Man\", \"ager, .NET team, Microsoft\\n\\nMiguel Veloso, Software Development Engineer at Plain Concepts\\n\\nSumit Gh\", \"osh, Principal Consultant at Neudesic\\n\\nColin Dembovsky, DevOps Practice Lead, Cognizant Microsoft Bu\", \"siness Group\\n\\n## Copyright\\n\\nPUBLISHED BY\\n\\nMicrosoft Developer Division, .NET and Visual Studio produ\", \"ct teams\\n\\nA division of Microsoft Corporation\\n\\nOne Microsoft Way\\n\\nRedmond, Washington 98052-6399\\n\\nCo\", \"pyright \\u00a9 2022 by Microsoft Corporation\\n\\nAll rights reserved. No part of the contents of this book m\", \"ay be reproduced or transmitted in any form or by any means without the written permission of the pu\", \"blisher.\\n\\nThis book is provided \\\"as-is\\\" and expresses the author's views and opinions. The views, op\", \"inions, and information expressed in this book, including URL and other Internet website references,\", \" may change without notice.\\n\\nSome examples depicted herein are provided for illustration only and ar\", \"e fictitious. No real association or connection is intended or should be inferred.\\n\\nMicrosoft and th\", \"e trademarks listed at https://www.microsoft.com on the \\\"Trademarks\\\" webpage are trademarks of the M\", \"icrosoft group of companies.\\n\\nMac and macOS are trademarks of Apple Inc.\\n\\nThe Docker whale logo is a\", \" registered trademark of Docker, Inc. Used by permission.\\n\\nAll other marks and logos are property of\", \" their respective owners.\\n\\n## Contents\\n\\n| Overview of Containers and Docker ........................\", \"..............................................................  1                                   \", \"                                   |\\n|--------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"--------------------------------|\\n| Learn Docker ................................ ..................\", \".............................................. .....................................................\", \"........... .............. 2 |\\n| Comparing Docker containers with virtual machines .................\", \"............................................... ........................... 3                       \", \"                          |\\n| A simple analogy ................................ ....................\", \"............................................ ................................ ......................\", \"........... 4          |\\n| Learn Docker specific terminologies  ....................................\", \"............................ ................................ ................................ 4    \", \"                    |\\n| Learn docker containers, images, and registries  ...........................\", \"..... ................................................................ ......... 6                  \", \"                 |\\n| Road to modern applications based on containers  ..............................\", \".. ................................ ................................... 8                           \", \"              |\\n| Introduction to the Docker application life cycle  ...............................\", \".................................  9                                                                \", \"           |\\n| Containers as the foundation for DevOps collaboration  ..............................\", \".................................. ......................... 9                                      \", \"        |\\n| Challenges in the application life cycle when using Docker.  ...........................\", \"..................................... ..........  10                                                \", \"     |\\n| Introduction to a generic end-to-end Docker application life cycle workflow  ..............\", \".................. .......  11                                                                      \", \"  |\\n| Benefits of DevOps for containerized applications  ................................ ..........\", \"...................... ............................  12                                            |\", \"\\n| Introduction to the Microsoft platform and tools for containerized apps  .....................  1\", \"3                                                                                               |\\n| \", \"Design Docker applications  ................................................................ .......\", \"......................................................... ..............  17                 |\\n| Com\", \"mon container design principles ................................ ...................................\", \"............................. ...........................  18                             |\\n| Contai\", \"ner equals a process  ................................................................ .............\", \"................................................... ..........  18                     |\\n| Monolithi\", \"c applications  ................................................................ ...................\", \"............................................. ......................  18            |\\n| Monolithic a\", \"pplication deployed as a container ................................ ................................\", \"................................ .  21                                           |\\n| Publish a singl\", \"e Docker container app to Azure App Service  .......................................................\", \"......... ........  21                                                        |\\n| State and data in \", \"Docker applications ................................ ...............................................\", \"................. ..........................  22                           |\\n| Service - oriented ap\", \"plications  ................................................................ .......................\", \"......................................... ..........  25                |\\n| Orchestrating microservi\", \"ces and multi-container applications for high scalability and availability ....  25                 \", \"                                                                     |\\n| Using container-based orche\", \"strators in Azure ................................ .................................................\", \"............... .....  28                                         |\\n| Using Azure Kubernetes Service\", \"  ................................................................ ................................ \", \"................................  29                           |\\n| ................................ \", \"................................ ...............................                                    \", \"                                                            |\\n| Get started with Azure Kubernetes Se\", \"rvice (AKS)  31                                                                                     \", \"                                                         |\\n\\n<!-- image -->\\n\\n| Deploy with Helm chart\", \"s into Kubernetes clusters ................................ ................................ .......\", \"......................                                                                              \", \"                                                                      | 31                          \", \"                                                                              |\\n|-------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"--------------------------------------------------------------------------|-------------------------\", \"----------------------------------------------------------------------------------|\\n| Additional res\", \"ources  ................................................................ ...........................\", \"..................................... .......................                                       \", \"                                                                              | 32                  \", \"                                                                                      |\\n| Using Azur\", \"e Service Fabric  ................................................................ .................\", \"............................................... ...........                                         \", \"                                                                                  | 32              \", \"                                                                                          |\\n| Statel\", \"ess versus stateful microservices  ................................ ................................\", \"................................ ....................                                               \", \"                                                                                      | 35          \", \"                                                                                              |\\n| Us\", \"ing Azure Service Fabric Mesh ................................................................ .....\", \"........................... ...............................                                         \", \"                                                                                          | 36      \", \"                                                                                                  |\\n\", \"| Choosing orchestrators in Azure  ................................................................ \", \"................................ ...............................                                    \", \"                                                                                              | 37  \", \"                                                                                                    \", \"  |\\n| Deploy to Azure Kubernetes Service (AKS)  ................................ ...................\", \"............................................. ................                                      \", \"                                                                                                  | \", \"38                                                                                                  \", \"      |\\n| Create the AKS environment in Azure  ................................ ....................\", \"............................................ .....................                                  \", \"                                                                                                    \", \"  | 38                                                                                              \", \"          |\\n| Create the AKS cluster ...............................................................\", \". ................................................................ ....................             \", \"                                                                                                    \", \"      | 38                                                                                          \", \"              |\\n| Development environment for Docker apps  ................................ ........\", \"........................................................ .............                              \", \"                                                                                                    \", \"          | 40                                                                                      \", \"                  |\\n| Development tools choices: IDE or editor ................................ ....\", \"............................................................ ..............                         \", \"                                                                                                    \", \"              | 40                                                                                  \", \"                      |\\n| Language and framework choices  ..........................................\", \"...................... ................................ ............................                \", \"                                                                                                    \", \"                  | 41                                                                              \", \"                          |\\n| Inner - loop development workflow for Docker apps  ...................\", \"............. ................................ ..............................                       \", \"                                                                                                    \", \"                      | 41                                                                          \", \"                              |\\n| Building a single app within a Docker container using Visual Studi\", \"o Code and Docker CLI .............                                                                 \", \"                                                                                                    \", \"                          | 42                                                                      \", \"                                  |\\n| Use Docker Tools in Visual Studio on Windows .................\", \"............... ................................................................ .......            \", \"                                                                                                    \", \"                              | 52                                                                  \", \"                                      |\\n| Configure your local environment  ........................\", \"........................................ ................................ ..........................\", \"..                                                                                                  \", \"                                  | 52                                                              \", \"                                          |\\n| Docker support in Visual Studio  .....................\", \"........................................... ................................ .......................\", \".........                                                                                           \", \"                                      | 52                                                          \", \"                                              |\\n| Configure Docker tools ...........................\", \"..................................... ..............................................................\", \".. ..................                                                                               \", \"                                          | 55                                                      \", \"                                                  |\\n| Using Windows PowerShell commands in a DockerF\", \"ile to set up Windows Containers (Docker  standard based) ................................ .........\", \"....................................................... ............................................\", \"....................                          | .....  56                                           \", \"                                                      |\\n| Build ASP.NET Core applications deployed a\", \"s Linux containers into an AKS/Kubernetes orchestrator .............................................\", \"................... ................................................................ ...............\", \"................................................. | ......  57                                      \", \"                                                          |\\n| Creating the ASP.NET Core Project usin\", \"g Visual Studio 2022 ................................................................ ........      \", \"                                                                                                    \", \"                                                      | 57                                          \", \"                                                              |\\n| Register the Solution in an Azure \", \"Container Registry (ACR)  ................................................................ .........\", \".                                                                                                   \", \"                                                          | 66                                      \", \"                                                                  |\\n| Docker application DevOps work\", \"flow with Microsoft tools .............................................  74                         \", \"                                                                                                    \", \"                                                              | Docker application DevOps workflow w\", \"ith Microsoft tools .............................................  74 |\\n| Steps in the outer-loop De\", \"vOps workflow for a Docker application ................................ ............................\", \"...                                                                                                 \", \"                                                                  | 75                              \", \"                                                                          |\\n| Step 1: Inner - loop d\", \"evelopment workflow ................................ ...............................................\", \"................. ............                                                                      \", \"                                                                      | 76                          \", \"                                                                              |\\n| Step 2: Source - C\", \"ode Control integration and management with Azure DevOps Services and Git 76                        \", \"                                                                                                    \", \"                                                                          |                         \", \"                                                                                  |\\n| Step 3: Build,\", \" CI, Integrate, and Test with Azure DevOps Services/GitHub and Docker ......................        \", \"                                                                                                    \", \"                                                                              | 76                  \", \"                                                                                      |\\n| Step 4: CD\", \", Deploy ................................ ................................ .........................\", \"....................................... ...........................                                 \", \"                                                                                  | 83              \", \"                                                                                          |\\n| Step 5\", \": Run and manage ................................................................ ..................\", \".............................................. ...............                                      \", \"                                                                                      | 89          \", \"                                                                                              |\\n| St\", \"ep 6: Monitor and diagnose  ................................................................        \", \"                                                                                                    \", \"                                                                                          | ........\", \"........................................................ ....  89                                 |\\n\", \"\\n<!-- image -->\\n\\n| Create CI/CD pipelines in Azure DevOps Services for a .NET application on Contain\", \"ers and  deploying to a Kubernetes cluster .........................................................\", \"....... ................................................................ .  89   |\\n|----------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-----------------------------------------------|\\n| Run, manage, and monitor Docker production enviro\", \"nments  ........................................  93                                                \", \"                                                                                                    \", \"             |\\n| Run composed and microservices-based applications in production environments  .....\", \"..........................  93                                                                      \", \"                                                                               |\\n| Introduction to o\", \"rchestrators, schedulers, and container clusters  ................................ .................\", \"..............  93                                                                                  \", \"                                             |\\n| Manage production Docker environments  ............\", \".................... ................................................................ ..............\", \"..  94                                                                                              \", \"           |\\n| Container Service and management tools ................................ .............\", \"................................................... .............  94                               \", \"                                                                             |\\n| Azure Service Fabri\", \"c  ................................ ................................ ...............................\", \"................................. ........................  95                                      \", \"                                           |\\n| Monitor containerized application services  .........\", \"....................... ................................................................ ...........\", \"....  96                                                                                            \", \"         |\\n| Azure Monitor  ................................ .......................................\", \"......................... ................................................................ ...  96  \", \"                                                                           |\\n| Security and backup s\", \"ervices ................................................................ ...........................\", \"..................................... .......  96                                                   \", \"                                         |\\n| Containerized Docker Application Lifecycle key takeaway\", \"s .............................................  98                                                 \", \"                                                                                                    \", \"       |\\n\\n## Overview of Containers and Docker\\n\\nContainerization is an approach to software developm\", \"ent in which an application or service, its dependencies, and its configuration (abstracted as deplo\", \"yment manifest files) are packaged together as a container image. You then can test the containerize\", \"d application as a unit and deploy it as a container image instance to the host operating system (OS\", \").\\n\\nJust as shipping containers allow goods to be transported by ship, train, or truck regardless of\", \" the cargo inside, software containers act as a standard unit of software deployment that can contai\", \"n different code and dependencies. Containerizing software this way enables developers and IT profes\", \"sionals to deploy them across environments with little or no modification.\\n\\nContainers also isolate \", \"applications from each other on a shared OS. Containerized applications run on top of a container ho\", \"st that in turn runs on the OS (Linux or Windows). Containers therefore have a much smaller footprin\", \"t than virtual machine (VM) images.\\n\\nEach container can run a whole web application or a service, as\", \" shown in Figure 1-1. In this example, Docker host is a container host, and App1, App2, Svc1, and Sv\", \"c2 are containerized applications or services.\\n\\nFigure 1 -1. Multiple containers running on a contai\", \"ner host\\n\\n<!-- image -->\\n\\nAnother benefit you can derive from containerization is scalability. You c\", \"an scale out quickly by creating new containers for short-term tasks. From an application point of v\", \"iew, instantiating an image (creating a container) is similar to instantiating a process like a serv\", \"ice or web app. For reliability, however, when you run multiple instances of the same image across m\", \"ultiple host servers, you typically want each container (image instance) to run in a different host \", \"server or VM in different fault domains.\\n\\nIn short, containers offer the benefits of isolation, port\", \"ability, agility, scalability, and control across the entire application lifecycle workflow. The mos\", \"t important benefit is the environment isolation provided between Dev and Ops.\\n\\nDockerized App\\n\\n## L\", \"earn Docker\\n\\nWindows Server\\n\\nContainer\\n\\nLinux\\n\\nDocker is an open-source project for automating the d\", \"eployment of applications as portable, selfsufficient containers that can run on the cloud or on -pr\", \"emises. Docker is also a company that promotes and evolves this technology, working in collaboration\", \" with cloud, Linux, and Windows vendors, including Microsoft.\\n\\nFigure 1 -2. Docker deploys container\", \"s at all layers of the hybrid cloud\\n\\n<!-- image -->\\n\\nAs shown in the above diagram, Docker container\", \"s can run anywhere, on-premises in the customer datacenter, in an external service provider or in th\", \"e cloud, on Azure. Docker image containers can also run natively on Linux and Windows. However, Wind\", \"ows images can run only on Windows hosts and Linux images can run on Linux hosts and Windows hosts (\", \"using a Hyper-V Linux VM, so far), where host means a server or a VM.\\n\\nDevelopers can use developmen\", \"t environments on Windows, Linux, or macOS. On the development computer, the developer runs a Docker\", \" host where Docker images are deployed, including the app and its dependencies. Developers who work \", \"on Linux or on the Mac, use a Docker host that's Linuxbased, and they can only create images for Lin\", \"ux containers. (Developers working on the Mac can edit code or run the Docker command -line interfac\", \"e (CLI) from macOS, but as of this writing, containers don't run directly on macOS.) Developers who \", \"work on Windows can create images for either Linux or Windows Containers.\\n\\nTo host containers in dev\", \"elopment environments and provide additional developer tools, Docker ships Docker Desktop for Window\", \"s or for macOS. These products install the necessary VM (the Docker host) to host the containers.\\n\\nT\", \"o run Windows Containers, there are two types of runtimes:\\n\\n- Windows Server Containers provide appl\", \"ication isolation through process and namespace isolation technology. A Windows Server Container sha\", \"res a kernel with the container host and with all containers running on the host.\\n- Hyper-V Containe\", \"rs expand on the isolation provided by Windows Server Containers by running each container in a high\", \"ly optimized virtual machine. In this configuration, the kernel of the container host isn't shared w\", \"ith the Hyper-V Containers, providing better isolation.\\n\\nCustomer\\n\\nDatacenter\\n\\nApp 1\\n\\nBins/Libs\\n\\nGue\", \"st OS\\n\\nVMs\\n\\nApp 2\\n\\nBins/Libs\\n\\nApp 3\\n\\nBins/Libs\\n\\nAppl\\n\\nBins/Libs\\n\\nContainers\\n\\nApp2\\n\\nBins/Libs\\n\\nApp3\\n\\n\", \"Bins/Libs\\n\\nThe images for these containers are created and work just the same way. The difference is\", \" in how the container is created from the image\\u2014running a Hyper-V Container requires an extra parame\", \"ter. For details, see Hyper-V Containers .\\n\\nOS\\n\\n## Comparing Docker containers with virtual machines\", \"\\n\\nFigure 1-3 shows a comparison between VMs and Docker containers.\\n\\nInfrastructure\\n\\nVMs include the \", \"application, the required libraries and binaries, and a full guest OS.\\n\\nFull virtualization is much \", \"heavier than containerization.\\n\\nFigure 1 -3. Comparison of traditional virtual machines to Docker co\", \"ntainers\\n\\n<!-- image -->\\n\\nAs shown in the above diagram, for VMs, there are three base layers in the\", \" host server. From the bottom -up: Infrastructure, Host Operating System, and a Hypervisor. On top o\", \"f all that, each VM has its own OS and all necessary libraries. On the other hand, for Docker, the h\", \"ost server only has the Infrastructure and the OS. On top of that, the container engine keeps contai\", \"ners isolated, but lets them share the single base OS's services.\\n\\nBecause containers require far fe\", \"wer resources (for example, they don't need a full OS), they're easy to deploy and they start fast. \", \"This allows you to have higher density, meaning that it allows you to run more services on the same \", \"hardware unit, thereby reducing costs.\\n\\nAs a side effect of running on the same kernel, you get less\", \" isolation than VMs.\\n\\nThe main goal of an image is to ensure the same environment (dependencies) acr\", \"oss different deployments. This means that you can debug it on your machine and then deploy it to an\", \"other machine, the same environment guaranteed.\\n\\nA container image is a way to package an app or ser\", \"vice and deploy it in a reliable and reproducible way. You could say that Docker isn't only a techno\", \"logy but also a philosophy and a process.\\n\\nWhen using Docker, you won't hear developers say, \\\"It wor\", \"ks on my machine, why not in production?\\\" They can just say, \\\"It runs on Docker\\\", because the packag\", \"ed Docker application can be executed on any supported Docker environment, and it runs the way it wa\", \"s intended to on all deployment targets (such as Dev, QA, staging, and production).\\n\\n## A simple ana\", \"logy\\n\\nPerhaps a simple analogy can help getting the grasp of the core concept of Docker.\\n\\nLet's go b\", \"ack in time to the 1950s for a moment. There were no word processors, and the photocopiers were used\", \" everywhere (well, kind of).\\n\\nImagine you're responsible for quickly issuing batches of letters as r\", \"equired, to mail them to customers, using real paper and envelopes, to be delivered physically to ea\", \"ch customer's address (there was no email back then).\\n\\nAt some point, you realize the letters are ju\", \"st a composition of a large set of paragraphs, which are picked and arranged as needed, according to\", \" the purpose of the letter, so you devise a system to issue letters quickly, expecting to get a heft\", \"y raise.\\n\\nThe system is simple:\\n\\n1. You begin with a deck of transparent sheets containing one parag\", \"raph each.\\n2. To issue a set of letters, you pick the sheets with the paragraphs you need, then you \", \"stack and align them so they look and read fine.\\n3. Finally, you place the set in the photocopier an\", \"d press start to produce as many letters as required.\\n\\nSo, simplifying, that\\u2019s the core idea of Dock\", \"er.\\n\\nIn Docker, each layer is the resulting set of changes that happen to the filesystem after execu\", \"ting a command, such as, installing a program.\\n\\nSo, when you \\\"look\\\" at the filesystem after the laye\", \"r has been copied, you see all the files, included the layer when the program was installed.\\n\\nYou ca\", \"n think of an image as an auxiliary read-only hard disk ready to be installed in a \\\"computer\\\" where \", \"the operating system is already installed.\\n\\nSimilarly, you can think of a container as the \\\"computer\", \"\\\" with the image hard disk installed. The container, just like a computer, can be powered on or off.\", \"\\n\\n## Learn Docker specific terminologies\\n\\nThis section lists terms and definitions you should be fam\", \"iliar with before getting deeper into Docker. For further definitions, see the extensive glossary pr\", \"ovided by Docker.\\n\\nContainer image: A package with all the dependencies and information needed to cr\", \"eate a container. An image includes all the dependencies (such as frameworks) plus deployment and ex\", \"ecution\\n\\nconfiguration to be used by a container runtime. Usually, an image derives from multiple ba\", \"se images that are layers stacked on top of each other to form the container's filesystem. An image \", \"is immutable once it has been created.\\n\\nDockerfile: A text file that contains instructions for build\", \"ing a Docker image. It's like a batch script, the first line states the base image to begin with and\", \" then follow the instructions to install required programs, copy files, and so on, until you get the\", \" working environment you need.\\n\\nBuild: The action of building a container image based on the informa\", \"tion and context provided by its Dockerfile, plus additional files in the folder where the image is \", \"built. You can build images with the following Docker command:\\n\\ndocker build\\n\\nContainer: An instance\", \" of a Docker image. A container represents the execution of a single application, process, or servic\", \"e. It consists of the contents of a Docker image, an execution environment, and a standard set of in\", \"structions. When scaling a service, you create multiple instances of a container from the same image\", \". Or a batch job can create multiple containers from the same image, passing different parameters to\", \" each instance.\\n\\nVolumes: Offer a writable filesystem that the container can use. Since images are r\", \"ead-only but most programs need to write to the filesystem, volumes add a writable layer, on top of \", \"the container image, so the programs have access to a writable filesystem. The program doesn't know \", \"it's accessing a layered filesystem, it's just the filesystem as usual. Volumes live in the host sys\", \"tem and are managed by Docker.\\n\\nTag: A mark or label you can apply to images so that different image\", \"s or versions of the same image (depending on the version number or the target environment) can be i\", \"dentified.\\n\\nMulti -stage Build: Is a feature, since Docker 17.05 or higher, that helps to reduce the\", \" size of the final images. For example, a large base image, containing the SDK can be used for compi\", \"ling and publishing and then a small runtime-only base image can be used to host the application.\\n\\nR\", \"epository (repo): A collection of related Docker images, labeled with a tag that indicates the image\", \" version. Some repos contain multiple variants of a specific image, such as an image containing SDKs\", \" (heavier), an image containing only runtimes (lighter), etc. Those variants can be marked with tags\", \". A single repo can contain platform variants, such as a Linux image and a Windows image.\\n\\nRegistry:\", \" A service that provides access to repositories. The default registry for most public images is Dock\", \"er Hub (owned by Docker as an organization). A registry usually contains repositories from multiple \", \"teams. Companies often have private registries to store and manage images they've created. Azure Con\", \"tainer Registry is another example.\\n\\nMulti -arch image: For multi-architecture, it's a feature that \", \"simplifies the selection of the appropriate image, according to the platform where Docker is running\", \". For example, when a Dockerfile requests a base image FROM mcr.microsoft.com/dotnet/sdk:6.0 from th\", \"e registry, it actually gets 6.0nanoserver-20H2 , 6.0 -nanoserver-1809 or 6.0 -bullseye-slim, depend\", \"ing on the operating system and version where Docker is running.\\n\\nDocker Hub: A public registry to u\", \"pload images and work with them. Docker Hub provides Docker image hosting, public or private registr\", \"ies, build triggers and web hooks, and integration with GitHub and Bitbucket.\\n\\nAzure Container Regis\", \"try: A public resource for working with Docker images and its components in Azure. This provides a r\", \"egistry that's close to your deployments in Azure and that gives you control over access, making it \", \"possible to use your Azure Active Directory groups and permissions.\\n\\nDocker Trusted Registry (DTR): \", \"A Docker registry service (from Docker) that can be installed onpremises so it lives within the orga\", \"nization's datacenter and network. It's convenient for private images that should be managed within \", \"the enterprise. Docker Trusted Registry is included as part of the Docker Datacenter product.\\n\\nDocke\", \"r Desktop: Development tools for Windows and macOS for building, running, and testing containers loc\", \"ally. Docker Desktop for Windows provides development environments for both Linux and Windows Contai\", \"ners. The Linux Docker host on Windows is based on a Hyper-V virtual machine. The host for Windows C\", \"ontainers is directly based on Windows. Docker Desktop for Mac is based on the Apple Hypervisor fram\", \"ework and the xhyve hypervisor, which provides a Linux Docker host virtual machine on macOS. Docker \", \"Desktop for Windows and for Mac replaces Docker Toolbox, which was based on Oracle VirtualBox.\\n\\nComp\", \"ose: A command-line tool and YAML file format with metadata for defining and running multicontainer \", \"applications. You define a single application based on multiple images with one or more .yml files t\", \"hat can override values depending on the environment. After you've created the definitions, you can \", \"deploy the whole multi-container application with a single command (docker-compose up) that creates \", \"a container per image on the Docker host.\\n\\nCluster: A collection of Docker hosts exposed as if it we\", \"re a single virtual Docker host, so that the application can scale to multiple instances of the serv\", \"ices spread across multiple hosts within the cluster. Docker clusters can be created with Kubernetes\", \", Azure Service Fabric, Docker Swarm and Mesosphere DC/OS.\\n\\nOrchestrator: A tool that simplifies the\", \" management of clusters and Docker hosts. Orchestrators enable you to manage their images, container\", \"s, and hosts through a command-line interface (CLI) or a graphical UI. You can manage container netw\", \"orking, configurations, load balancing, service discovery, high availability, Docker host configurat\", \"ion, and more. An orchestrator is responsible for running, distributing, scaling, and healing worklo\", \"ads across a collection of nodes. Typically, orchestrator products are the same products that provid\", \"e cluster infrastructure, like Kubernetes and Azure Service Fabric, among other offerings in the mar\", \"ket.\\n\\n## Learn docker containers, images, and registries\\n\\nWhen using Docker, you create an app or se\", \"rvice and package it and its dependencies into a container image. An image is a static representatio\", \"n of the app or service and its configuration and dependencies.\\n\\nTo run the app or service, the app'\", \"s image is instantiated to create a container, which will be running on the Docker host. Containers \", \"are initially tested in a development environment or PC.\\n\\nRegistry\\n\\nStores many static images\\n\\nStati\", \"c, persisted container image\\n\\nImage instance running an app process (service/web)\\n\\nHosted Docker\\n\\nRe\", \"gistry\\n\\nDocker Trusted\\n\\nOn-Premises\\n\\n('n\\\" private organizations)\\n\\nYou store images in a registry tha\", \"t acts as a library of images. You need a registry when deploying to production orchestrators. Docke\", \"r maintains a public registry via Docker Hub; other vendors provide registries for different collect\", \"ions of images, including Azure Container Registry. Alternatively, enterprises can have a private re\", \"gistry on-premises for their own Docker images.\\n\\nDocker Trusted\\n\\nFigure 1-4 shows how images and reg\", \"istries in Docker relate to other components. It also shows the multiple registry offerings from ven\", \"dors.\\n\\nAzure Container\\n\\nFigure 1 -4. Taxonomy of Docker terms and concepts\\n\\n<!-- image -->\\n\\nThe regi\", \"stry is like a bookshelf where images are stored and available to be pulled for building containers \", \"to run services or web apps. There are private Docker registries on-premises and on the public cloud\", \". Docker Hub is a public registry maintained by Docker, along the Docker Trusted Registry an enterpr\", \"ise-grade solution, Azure offers the Azure Container Registry. AWS, Google and others also have cont\", \"ainer registries.\\n\\nBy putting images in a registry, you can store static and immutable application b\", \"its, including all of their dependencies, at a framework level. You then can version and deploy imag\", \"es in multiple environments and thus provide a consistent deployment unit.\\n\\nPrivate image registries\", \", either hosted on-premises or in the cloud, are recommended when:\\n\\n- Your images must not be shared\", \" publicly due to confidentiality.\\n- You want to have minimum network latency between your images and\", \" your chosen deployment environment. For example, if your production environment is Azure, you proba\", \"bly want to store your images in Azure Container Registry so that network latency is minimal. In a s\", \"imilar way, if your production environment is on-premises, you might want to have an onpremises Dock\", \"er Trusted Registry available within the same local network.\\n\\n## Road to modern applications based o\", \"n containers\\n\\nYou're probably reading this book because you're planning the development of new appli\", \"cations or you're assessing the impact of using Docker, Containers, and new approaches like Microser\", \"vices in your company.\\n\\nThe adoption of new development paradigms must be taken with caution before \", \"starting a project, to assess the impact on your dev teams, your budget, or your infrastructure.\\n\\nMi\", \"crosoft has been working on rich guidance, sample applications, and a suite of e-books that can help\", \" you make an informed decision and guide your team through a successful development, deployment, and\", \" operations of your new applications.\\n\\nThis book belongs to a Microsoft suite of guides that cover m\", \"any of the needs and challenges you'll face during the process of developing new modern applications\", \" based on containers.\\n\\nYou can find additional Microsoft e -books related to Docker containers in th\", \"e list below:\\n\\n- .NET Microservices: Architecture for Containerized .NET Applications https://learn.\", \"microsoft.com/dotnet/architecture/microservices/\\n- Modernize existing .NET applications with Azure c\", \"loud and Windows Containers https://learn.microsoft.com/dotnet/architecture/modernize-with-azure-con\", \"tainers/\\n\\nDevelopers and\\n\\nArchitects\\n\\nPlatform for\\n\\nDocker Apps\\n\\nDevelop/Design\\n\\n\\u2192 Collaboration +\\n\\n\", \"DevOps for\\n\\nDocker Apps\\n\\n- IT Operations\\n\\nManagement and Monitoring\\n\\n## Introduction to the Docker a\", \"pplication life cycle\\n\\nThe life cycle of containerized applications is a journey that begins with th\", \"e developer. The developer chooses to implement containers and Docker because it eliminates friction\", \"s in deployments and IT operations, which ultimately helps everyone to be more agile, more productiv\", \"e end-to-end, and faster.\\n\\n## Containers as the foundation for DevOps collaboration\\n\\nBy the very nat\", \"ure of the containers and Docker technology, developers can share their software and dependencies ea\", \"sily with IT operations and production environments while eliminating the typical \\\"it works on my ma\", \"chine\\\" excuse. Containers solve application conflicts between different environments. Indirectly, co\", \"ntainers and Docker bring developers and IT operations closer together, making it easier for them to\", \" collaborate effectively. Adopting the container workflow provides many customers with the DevOps co\", \"ntinuity they've sought but previously had to implement via more complex configuration for release a\", \"nd build pipelines. Containers simplify the build/test/deploy pipelines in DevOps.\\n\\nFigure 2 -1. Mai\", \"n workloads per \\\"personas\\\" in the life cycle for containerized Docker applications\\n\\n<!-- image -->\\n\\n\", \"With Docker containers, developers own what's within the container (application and service, and dep\", \"endencies to frameworks and components) and how the containers and services behave together as an ap\", \"plication composed by a collection of services. The interdependencies of the multiple containers are\", \" defined in a docker -compose.yml file, or what could be called a deployment manifest . Meanwhile, I\", \"T operations teams (IT professionals and management) can focus on the management\\n\\nof production envi\", \"ronments; infrastructure; scalability; monitoring; and, ultimately, ensuring that the applications a\", \"re delivering properly for the end users, without having to know the contents of the various contain\", \"ers. Hence, the name \\\"container,\\\" recalling the analogy to real-world shipping containers. Thus, the\", \" owners of a container's content need not concern themselves with how the container will be shipped,\", \" and the shipping company transports a container from its point of origin to its destination without\", \" knowing or caring about the contents. In a similar manner, developers can create and own the conten\", \"ts within a Docker container without the need to concern themselves with the \\\"transport\\\" mechanisms.\", \"\\n\\nIn the pillar on the left side of Figure 2-1, developers write and run code locally in Docker cont\", \"ainers by using Docker for Windows or Mac. They define the operating environment for the code by usi\", \"ng a Dockerfile that specifies the base operating system to run as well as the build steps for build\", \"ing their code into a Docker image. The developers define how one or more images will interoperate u\", \"sing the aforementioned docker -compose.yml file deployment manifest. As they complete their local d\", \"evelopment, they push their application code plus the Docker configuration files to the code reposit\", \"ory of their choice (that is, Git repository).\\n\\nThe DevOps pillar defines the build\\u2013Continuous Integ\", \"ration (CI) pipelines using the Dockerfile provided in the code repository. The CI system pulls the \", \"base container images from the selected Docker registry and builds the custom Docker images for the \", \"application. The images then are validated and pushed to the Docker registry used for the deployment\", \"s to multiple environments.\\n\\nIn the pillar on the right, operations teams manage deployed applicatio\", \"ns and infrastructure in production while monitoring the environment and applications so that they c\", \"an provide feedback and insights to the development team about how the application might be improved\", \". Container apps are typically run in production using container orchestrators like Kubernetes, wher\", \"e usually Helm charts are used to configure deployment units, instead of docker-compose files.\\n\\nThe \", \"two teams are collaborating through a foundational platform (Docker containers) that provides a sepa\", \"ration of concerns as a contract, while greatly improving the two teams' collaboration in the applic\", \"ation life cycle. The developers own the container contents, its operating environment, and the cont\", \"ainer interdependencies, whereas the operations teams take the built images along with the manifest \", \"and runs them in their orchestration system.\\n\\n## Challenges in the application life cycle when using\", \" Docker.\\n\\nThere are many reasons that will increase the number of containerized applications in the \", \"upcoming years, and one of these reasons is the creation of applications based on microservices.\\n\\nDu\", \"ring the last 15 years, the use of web services has been the base of thousands of applications, and \", \"probably, after a few years, you'll find the same situation with microservice-based applications run\", \"ning on Docker containers.\\n\\nIt is also worth to mention that you can also use Docker containers for \", \"monolithic applications and you still get most of the benefits of Docker. Containers are not targeti\", \"ng only microservices.\\n\\nThe use of Docker containerization and microservices causes new challenges i\", \"n the development process of your organizations and therefore, you need a solid strategy to maintain\", \" many containers\\n\\n2\\n\\nApplication Code\\n\\nRepository (SCC)\\n\\nCode Push\\n\\n10\\n\\n1\\n\\n01\\n\\n10\\n\\nBuild, CI\\n\\nIntegr\", \"ate, Test and microservices running on production systems. Eventually, enterprise applications will \", \"have hundreds or thousands of containers/instances running in production.\\n\\nDocker Registry\\n\\nThese ch\", \"allenges create new demands when using DevOps tools, so you'll have to define new processes in your \", \"DevOps activities, and find answers for the following type of questions:\\n\\nDev Environment\\n\\nCode\\n\\nRun\", \"\\n\\nDebug\\n\\nInner Loop\\n\\n6\\n\\n- Which tools can I use for development, CI/CD, management and operations??\\n\", \"\\nDiagnose\\n\\n- How can my company manage errors in containers when running in production?\\n- How can we\", \" change pieces of our software in production with minimum downtime?\\n- How can we scale and monitor o\", \"ur production system?\\n- How can we include the testing and deployment of containers in our release p\", \"ipeline?\\n- How can we use Open Source tools/platforms for containers in Microsoft Azure?\\n\\nIf you can\", \" answer all those questions, you'll be better prepared to move your applications (existing or new ap\", \"ps) to Docker containers.\\n\\n## Introduction to a generic end-to-end Docker application life cycle wor\", \"kflow\\n\\nFigure 2-2 presents a more detailed workflow for a Docker application life cycle, focusing in\", \" this instance on specific DevOps activities and assets.\\n\\nFigure 2 -2. High -level workflow for the \", \"Docker containerized application life cycle\\n\\n<!-- image -->\\n\\nEverything begins with the developer, w\", \"ho starts writing code in the inner-loop workflow. The innerloop stage is where developers define ev\", \"erything that happens before pushing code into the code repository (for example, a source control sy\", \"stem such as Git). After it's committed, the repository triggers Continuous Integration (CI) and the\", \" rest of the workflow.\\n\\n4\\n\\nCD, Deploy\\n\\n5\\n\\nRun, Manage\\n\\nThe inner loop consists of typical steps like\", \" \\\"code,\\\" \\\"run,\\\" \\\"test,\\\" and \\\"debug,\\\" plus the additional steps needed right before running the app l\", \"ocally. This is the developer's process to run and test the app as a Docker container. The inner -lo\", \"op workflow will be explained in the sections that follow.\\n\\nTaking a step back to look at the end-to\", \"-end workflow, the DevOps workflow is more than a technology or a tool set, it's a mindset that requ\", \"ires cultural evolution. It's people, processes, and the appropriate tools to make your application \", \"life cycle faster and more predictable. Enterprises that adopt a containerized workflow typically re\", \"structure their organizations to represent people and processes that match the containerized workflo\", \"w.\\n\\nPracticing DevOps can help teams respond faster together to competitive pressures by replacing e\", \"rror-prone manual processes with automation, which results in improved traceability and repeatable w\", \"orkflows. Organizations also can manage environments more efficiently and realize cost savings with \", \"a combination of on -premises and cloud resources as well as tightly integrated tooling.\\n\\nWhen imple\", \"menting your DevOps workflow for Docker applications, you'll see that Docker technologies are presen\", \"t in almost every stage of the workflow, from your development box while working in the inner loop (\", \"code, run, debug), the build-test-CI phase, and, finally, the deployment of those containers to the \", \"staging and production environments.\\n\\nImprovement of quality practices helps to identify defects ear\", \"ly in the development cycle, which reduces the cost of fixing them. By including the environment and\", \" dependencies in the image and adopting a philosophy of deploying the same image across multiple env\", \"ironments, you promote a discipline of extracting the environment-specific configurations making dep\", \"loyments more reliable.\\n\\nRich data obtained through effective instrumentation (monitoring and diagno\", \"stics) provides insight into performance issues and user behavior to guide future priorities and inv\", \"estments.\\n\\nDevOps should be considered a journey, not a destination. It should be implemented increm\", \"entally through appropriately scoped projects from which you can demonstrate success, learn, and evo\", \"lve.\\n\\n## Benefits of DevOps for containerized applications\\n\\nHere are some of the most important bene\", \"fits provided by a solid DevOps workflow:\\n\\n- Deliver better -quality software, faster and with bette\", \"r compliance.\\n- Drive continuous improvement and adjustments earlier and more economically.\\n- Increa\", \"se transparency and collaboration among stakeholders involved in delivering and operating software.\\n\", \"- Control costs and utilize provisioned resources more effectively while minimizing security risks.\\n\", \"- Plug and play well with many of your existing DevOps investments, including investments in open -s\", \"ource.\\n\\n## Introduction to the Microsoft platform and tools for containerized apps\\n\\nVision: Create a\", \"n adaptable, enterprise-grade, containerized application life cycle that spans your development, IT \", \"operations, and production management.\\n\\nFigure 3-1 shows the main pillars in the life cycle of Docke\", \"r apps classified by the type of work delivered by multiple teams (app-development, DevOps infrastru\", \"cture processes, and IT management and operations). Usually, in the enterprise, the profiles of \\\"the\", \" persona\\\" responsible for each area are different. So are their skills.\\n\\nDevelopers and\\n\\nArchitects\\n\", \"\\nPlatform for\\n\\nDocker Apps\\n\\nDocker Engine\\n\\nVS and VS Code\\n\\n.NET Core /\\n\\nOther\\n\\nAzure\\n\\nKubernetes\\n\\nSe\", \"rvice\\n\\nDevelop/Design\\n\\n\\u203a Collaboration &lt;\\n\\nIT Operations\\n\\nFigure 3 -1. Main pillars in the life cy\", \"cle for containerized Docker applications with Microsoft platform and tools\\n\\n<!-- image -->\\n\\nA conta\", \"inerized Docker life -cycle workflow can be initially prescriptive based on \\\"by-default product choi\", \"ces,\\\" making it easier for developers to get started faster, but it's fundamental that under the hoo\", \"d there must be an open framework so that it will be a flexible workflow capable of adjusting to the\", \" different contexts from each organization or enterprise. The workflow infrastructure (components an\", \"d products) must be flexible enough to cover the environment that each company will have in the futu\", \"re, even being capable of swapping development or DevOps products to others. This flexibility, openn\", \"ess, and the broad choice of technologies in the platform and infrastructure are precisely the Micro\", \"soft priorities for containerized Docker applications, as explained in the chapters that follow.\\n\\nTa\", \"ble 3 -1 demonstrates that the intention of the Azure DevOps for containerized Docker applications i\", \"s to provide an open DevOps workflow so that you can choose what products to use for each phase (Mic\", \"rosoft or third-party) while providing a simplified workflow that provides \\\"by-default-products\\\" alr\", \"eady connected; thus, you can quickly get started with your enterprise-level DevOps workflow for Doc\", \"ker apps.\\n\\nTable 3 -1. DevOps workflows, open to any technology\\n\\n| Host                      | Micro\", \"soft technologies                                                                                   \", \"                        | Third-party (Azure pluggable)                                             \", \"                                                                |\\n|---------------------------|-----\", \"----------------------------------------------------------------------------------------------------\", \"-------------------------|--------------------------------------------------------------------------\", \"-----------------------------------------------------------------|\\n| Platform for  Docker apps | \\u2022 M\", \"icrosoft Visual Studio and  Visual Studio Code \\u2022 .NET \\u2022 Microsoft Azure Kubernetes  Service (AKS) \\u2022 \", \"Azure Container Registry\\\\ | \\u2022 Any code editor (for example, Sublime) \\u2022 Any language (Node.js, Java, \", \"Go, etc.) \\u2022 Any orchestrator and scheduler \\u2022 Any Docker registry\\\\ |\\n\\n| Host                        |\", \" Microsoft technologies                                                                             \", \"     | Third-party (Azure pluggable)                                                                \", \"                                                                   |\\n|-----------------------------|\", \"----------------------------------------------------------------------------------------------------\", \"-----|----------------------------------------------------------------------------------------------\", \"-------------------------------------------------------------------|\\n| DevOps for  Docker apps     |\", \" \\u2022 Azure DevOps Services \\u2022 Microsoft Team Foundation  Server \\u2022 GitHub \\u2022 Azure Kubernetes Service  (A\", \"KS)\\\\ | \\u2022 GitHub, Git, Subversion, etc. \\u2022 Jenkins, Chef, Puppet, Velocity, CircleCI,  TravisCI, etc. \", \"\\u2022 On - premises Docker Datacenter, Kubernetes,  Mesos DC/OS, etc.\\\\ |\\n| Management  and  monitoring |\", \" \\u2022 Azure Monitor                                                                                    \", \"     | \\u2022 Marathon, Chronos, etc.\\\\                                                                   \", \"                                                                   |\\n\\nThe Microsoft platform and too\", \"ls for containerized Docker apps, as defined in Table 3-1, comprise the following components:\\n\\n- Pla\", \"tform for Docker Apps development The development of a service, or collection of services that make \", \"up an \\\"app.\\\" The development platform provides all the work developers requires prior to pushing the\", \"ir code to a shared code repository. Developing services, deployed as containers, are similar to the\", \" development of the same apps or services without Docker. You continue to use your preferred languag\", \"e (.NET, Node.js, Go, etc.) and preferred editor or IDE like Visual Studio or Visual Studio Code. Ho\", \"wever, rather than consider Docker a deployment destination, you develop your services in the Docker\", \" environment. You build, run, test, and debug your code in containers locally, providing the destina\", \"tion environment at development time. By providing the destination environment locally, Docker conta\", \"iners set up what will drastically help you improve your DevOps life cycle. Visual Studio and Visual\", \" Studio Code have extensions to integrate Docker containers within your development process.\\n- DevOp\", \"s for Docker Apps Developers creating Docker applications can use Azure DevOps , GitHub or any other\", \" third-party product, like Jenkins, to build out a comprehensive automated application life-cycle ma\", \"nagement (ALM).\\n\\nWith Azure DevOps and/or GitHub, developers can create container-focused DevOps for\", \" a fast, iterative process that covers source-code control from anywhere (Azure DevOps-Git, GitHub, \", \"any remote Git repository, or Subversion), Continuous Integration (CI), internal unit tests, inter-c\", \"ontainer/service integration tests, Continuous Delivery (CD), and release management (RM). Developer\", \"s also can automate their Docker application releases into Azure Kubernetes Service (AKS), from deve\", \"lopment to staging and production environments.\\n\\n- Management and Monitoring IT can manage and monit\", \"or production applications and services in several ways, integrating both perspectives in a consolid\", \"ated experience.\\n- \\u2013 Azure portal Azure Kubernetes Service (AKS) helps you to set up and maintain yo\", \"ur Docker environments. You can also use other orchestrators to visualize and configure your cluster\", \".\\n- \\u2013 Docker tools You can manage your container applications using familiar tools. There's no need \", \"to change your existing Docker management practices to move container workloads to the cloud. Use th\", \"e application management tools you're\\n\\nalready familiar with and connect via the standard API endpoi\", \"nts for the orchestrator of your choice. You also can use other third-party tools to manage your Doc\", \"ker applications or even CLI Docker tools.\\n\\nEven if you're familiar with Linux commands, you can man\", \"age your container applications using Microsoft Windows and PowerShell with a Linux Subsystem comman\", \"d line and the products (Docker, Kubernetes\\u2026) clients running on this Linux Subsystem capability. Yo\", \"u'll learn more about using these tools under Linux Subsystem using your favorite Microsoft Windows \", \"OS later in this book.\\n\\n- \\u2013 Open-source tools Because AKS exposes the standard API endpoints for the\", \" orchestration engine, the most popular tools are compatible with AKS and, in most cases, will work \", \"out of the box\\u2014including visualizers, monitoring, command-line tools, and even future tools as they \", \"become available.\\n- \\u2013 GitHub Advanced Security GitHub Advanced Security offers a suite of tools for \", \"securing the software supply chain that can seamlessly integrate security into the daily workflow of\", \" teams developing containerized applications.\\n- \\u2013 Azure Monitor Is Azure's solution to monitor every\", \" angle of your production environment. You can monitor production Docker applications by just settin\", \"g up its SDK into your services so that you can get system-generated log data from the applications.\", \"\\n\\nThus, Microsoft offers a complete foundation for an end-to-end containerized Docker application li\", \"fe cycle. However, it's a collection of products and technologies that allow you to optionally selec\", \"t and integrate with existing tools and processes. The flexibility in a broad approach along with th\", \"e strength in the depth of capabilities place Microsoft in a strong position for containerized Docke\", \"r application development.\\n\\n## Designing and developing containerized apps using Docker and Microsof\", \"t Azure\\n\\nVision: Design and develop scalable solutions with Docker in mind.\\n\\nThere are many great-fi\", \"t use cases for containers, not just for microservices-oriented architectures, but also when you sim\", \"ply have regular services or web applications to run and you want to reduce frictions between develo\", \"pment and production environment deployments.\\n\\n## Design Docker applications\\n\\nChapter 1 introduced t\", \"he fundamental concepts regarding containers and Docker. That information is the basic level of info\", \"rmation you need to get started. But, enterprise applications can be complex and composed of multipl\", \"e services instead of a single service or container. For those optional use cases, you need to know \", \"additional approaches to design, such as Service-Oriented Architecture (SOA) and the more advanced m\", \"icroservices concepts and container orchestration concepts. The scope of this document is not limite\", \"d to microservices but to any Docker application life cycle, therefore, it does not explore microser\", \"vices architecture in depth because you can also use containers and Docker with regular SOA, backgro\", \"und tasks or jobs, or even with monolithic application deployment approaches.\\n\\nMore info To learn mo\", \"re about enterprise applications and microservices architecture in depth, read the guide NET Microse\", \"rvices: Architecture for Containerized .NET Applications that you can also download from https://aka\", \".ms/MicroservicesEbook .\\n\\nHowever, before you get into the application life cycle and DevOps, it's i\", \"mportant to know how you're going to design and construct your application and what are your design \", \"choices.\\n\\n## Common container design principles\\n\\nAhead of getting into the development process there\", \" are a few basic concepts worth mentioning with regard to how you use containers.\\n\\n## Container equa\", \"ls a process\\n\\nIn the container model, a container represents a single process. By defining a contain\", \"er as a process boundary, you begin to create the primitives used to scale, or batch-off, processes.\", \" When you run a Docker container, you'll see an ENTRYPOINT definition. This defines the process and \", \"the lifetime of the container. When the process completes, the container life-cycle ends. There are \", \"long-running processes, such as web servers, and short-lived processes, such as batch jobs, which mi\", \"ght have been implemented as Microsoft Azure WebJobs. If the process fails, the container ends, and \", \"the orchestrator takes over. If the orchestrator was instructed to keep five instances running and o\", \"ne fails, the orchestrator will create another container to replace the failed process. In a batch j\", \"ob, the process is started with parameters. When the process completes, the work is complete.\\n\\nYou m\", \"ight find a scenario in which you want multiple processes running in a single container. In any arch\", \"itecture document, there's never a \\\"never,\\\" nor is there always an \\\"always.\\\" For scenarios requiring\", \" multiple processes, a common pattern is to use Supervisor .\\n\\n## Monolithic applications\\n\\nIn this sc\", \"enario, you're building a single and monolithic web application or service and deploying it as a con\", \"tainer. Within the application, the structure might not be monolithic; it might comprise several lib\", \"raries, components, or even layers (application layer, domain layer, data access layer, etc.). Exter\", \"nally, it's a single container, like a single process, single web application, or single service.\\n\\nT\", \"o manage this model, you deploy a single container to represent the application. To scale it, just a\", \"dd a few more copies with a load balancer in front. The simplicity comes from managing a single depl\", \"oyment in a single container or virtual machine (VM).\\n\\nFollowing the principal that a container does\", \" one thing only, and does it in one process, the monolithic pattern is in conflict. You can include \", \"multiple components/libraries or internal layers within each container, as illustrated in Figure 4-1\", \".\\n\\nHost 1\\n\\n(Server/VM)\\n\\nHost 2\\n\\n(Server/VM)\\n\\nHost 3\\n\\n(Server/VM)\\n\\nApp 1 = 1 Container\\n\\nA monolithic \", \"app has most of its functionality within a\\n\\nsingle process/container that is componentized with\\n\\nint\", \"ernal layers or libraries.\\n\\nFigure 4 -1. An example of monolithic application architecture\\n\\n<!-- ima\", \"ge -->\\n\\nA monolithic app has all or most of its functionality within a single process or container a\", \"nd it's componentized in internal layers or libraries. The downside to this approach comes if or whe\", \"n the application grows, requiring it to scale. If the entire application scaled, it's not really a \", \"problem. However, in most cases, a few parts of the application are the choke points that require sc\", \"aling, whereas other components are used less.\\n\\nUsing the typical e-commerce example, what you likel\", \"y need is to scale the product information component. Many more customers browse products than purch\", \"ase them. More customers use their basket than use the payment pipeline. Fewer customers add comment\", \"s or view their purchase history. And you likely have only a handful of employees, in a single regio\", \"n, that need to manage the content and marketing campaigns. By scaling the monolithic design, all of\", \" the code is deployed multiple times.\\n\\nIn addition to the \\\"scale -everything\\\" problem, changes to a \", \"single component require complete retesting of the entire application as well as a complete redeploy\", \"ment of all the instances.\\n\\nThe monolithic approach is common, and many organizations are developing\", \" with this architectural method. Many enjoy good enough results, whereas others encounter limits. Ma\", \"ny designed their applications in this model because the tools and infrastructure were too difficult\", \" to build SOAs, and they didn't see the need\\u2014until the app grew.\\n\\nFrom an infrastructure perspective\", \", each server can run many applications within the same host and have an acceptable ratio of efficie\", \"ncy in your resources usage, as shown in Figure 4-2.\\n\\nHost\\n\\n(Server/VM)\\n\\nBrowser or\\n\\nClient App\\n\\nApp\", \" 1\\n\\nApp 3\\n\\nLoad Balancer\\n\\nHost 1 (VM)\\n\\nWindows or\\n\\nLinux\\n\\nHost 2 (VM)\\n\\nWindows or\\n\\nHost 3 (VM)\\n\\nWind\", \"ows or\\n\\nFigure 4 -2. A host running multiple apps/containers\\n\\n<!-- image -->\\n\\nLinux\\n\\nFinally, from a\", \"n availability perspective, monolithic applications must be deployed as a whole; that means that in \", \"case you must stop and start, all functionality and all users will be affected during the deployment\", \" window. In certain situations, the use of Azure and containers can minimize these situations and re\", \"duce the probability of downtime of your application, as you can see in Figure 4-3.\\n\\nYou can deploy \", \"monolithic applications in Azure by using dedicated VMs for each instance. Using Azure VM Scale Sets\", \", you can scale the VMs easily.\\n\\nYou can also use Azure App Services to run monolithic applications \", \"and easily scale instances without having to manage the VMs. Azure App Services can run single insta\", \"nces of Docker containers, as well, simplifying the deployment.\\n\\nYou can deploy multiple VMs as Dock\", \"er hosts and run any number of containers per VM. Then, by using an Azure Load Balancer, as illustra\", \"ted in the Figure 4-3, you can manage scaling.\\n\\nFigure 4 -3. Multiple hosts scaling out a single Doc\", \"ker application\\n\\n<!-- image -->\\n\\nYou can manage the deployment of the hosts themselves via tradition\", \"al deployment techniques.\\n\\nYou can manage Docker containers from the command line by using commands \", \"like docker run and docker -compose up, and you can also automate it in Continuous Delivery (CD) pip\", \"elines and deploy to Docker hosts from Azure DevOps Services, for instance.\\n\\nAzure\\n\\nApp 2\\n\\nApp 4\\n\\nJ\\n\", \"\\n## Monolithic application deployed as a container\\n\\nThere are benefits to using containers to manage\", \" monolithic deployments. Scaling the instances of containers is far faster and easier than deploying\", \" additional VMs.\\n\\nDeploying updates as Docker images is far faster and network efficient. Docker con\", \"tainers typically start in seconds, speeding rollouts. Tearing down a Docker container is as easy as\", \" invoking the docker stop command, typically completing in less than a second.\\n\\nBecause containers a\", \"re inherently immutable, by design, you never need to worry about corrupted VMs because an update sc\", \"ript forgot to account for some specific configuration or file left on disk.\\n\\nAlthough monolithic ap\", \"ps can benefit from Docker, we're touching on only the tips of the benefits. The larger benefits of \", \"managing containers come from deploying with container orchestrators that manage the various instanc\", \"es and life cycle of each container instance. Breaking up the monolithic application into subsystems\", \" that can be scaled, developed, and deployed individually is your entry point into the realm of micr\", \"oservices.\\n\\nTo learn about how to \\\"lift and shift\\\" monolithic applications with containers and how y\", \"ou can modernize your applications, you can read this additional Microsoft guide, Modernize existing\", \" .NET applications with Azure cloud and Windows Containers, which you can also download as PDF from \", \"https://aka.ms/LiftAndShiftWithContainersEbook .\\n\\n## Publish a single Docker container app to Azure \", \"App Service\\n\\nEither because you want to get a quick validation of a container deployed to Azure or b\", \"ecause the app is simply a single-container app, Azure App Services provides a great way to provide \", \"scalable single-container services.\\n\\nUsing Azure App Service is intuitive and you can get up and run\", \"ning quickly because it provides great Git integration to take your code, build it in Microsoft Visu\", \"al Studio, and directly deploy it to Azure. But, traditionally (with no Docker), if you needed other\", \" capabilities, frameworks, or dependencies that aren't supported in App Services, you needed to wait\", \" for it until the Azure team updates those dependencies in App Service or switched to other services\", \" like Service Fabric, Cloud Services, or even plain VMs, for which you have further control and can \", \"install a required component or framework for your application.\\n\\nNow, as shown in Figure 4-4, when u\", \"sing Visual Studio 2022, container support in Azure App Service gives you the ability to include wha\", \"tever you want in your app environment. If you added a dependency to your app, because you're runnin\", \"g it in a container, you get the capability of including those dependencies in your Dockerfile or Do\", \"cker image.\\n\\nPublish\\n\\nSelect existing or create a new Azure Container Registry\\n\\nTarget\\n\\nSpecific tar\", \"get\\n\\nApp Service\\n\\nContainer Registry\\n\\nFigure 4 -4. Publishing a container to Azure App Service from \", \"Visual Studio apps/containers\\n\\n<!-- image -->\\n\\nFigure 4-4 also shows that the publish flow pushes an\", \" image through a Container Registry, which can be the Azure Container Registry (a registry near to y\", \"our deployments in Azure and secured by Azure Active Directory groups and accounts) or any other Doc\", \"ker Registry like Docker Hub or on-premises registries.\\n\\n## State and data in Docker applications\\n\\nI\", \"n most cases, you can think of a container as an instance of a process. A process does not maintain \", \"persistent state. While a container can write to its local storage, assuming that an instance will b\", \"e around indefinitely is like assuming that a single location in memory will be durable. Container i\", \"mages, like processes, should be assumed to have multiple instances and that they will eventually be\", \" killed; if they're managed with a container orchestrator, it should be assumed that they might get \", \"moved from one node or VM to another.\\n\\nThe following solutions are used to manage persistent data in\", \" Docker applications:\\n\\nFrom the Docker host, as Docker Volumes:\\n\\n- Volumes are stored in an area of \", \"the host filesystem that's managed by Docker.\\n- Bind mounts can map to any folder in the host filesy\", \"stem, so access can't be controlled from a Docker process and can pose a security risk as a containe\", \"r could access sensitive OS folders.\\n\\n- tmpfs mounts are like virtual folders that only exist in the\", \" host's memory and are never written to the filesystem.\\n\\nFrom remote storage:\\n\\n- Azure Storage provi\", \"des geo-distributable storage, providing a good long-term persistence solution for containers.\\n- Rem\", \"ote relational databases like Azure SQL Database, NoSQL databases like Azure Cosmos DB, or cache ser\", \"vices like Redis .\\n\\nFrom the Docker container:\\n\\n- Docker provides a feature named the overlay file s\", \"ystem. This feature implements a copy-onwrite task that stores updated information to the root file \", \"system of the container. That information \\\"lays on top of\\\" the original image on which the container\", \" is based. If the container is deleted from the system, those changes are lost. Therefore, while it'\", \"s possible to save the state of a container within its local storage, designing a system based on th\", \"is feature would conflict with the premise of container design, which by default is stateless.\\n- How\", \"ever, Docker Volumes is now the preferred way to handle local data in Docker. If you need more infor\", \"mation about storage in containers, check on Docker storage drivers and About images, containers, an\", \"d storage drivers .\\n\\nThe following provides additional detail about these options.\\n\\nVolumes are dire\", \"ctories mapped from the host OS to directories in containers. When code in the container has access \", \"to the directory, that access is actually to a directory on the host OS. This directory is not tied \", \"to the lifetime of the container itself, and the directory is managed by Docker and isolated from th\", \"e core functionality of the host machine. Thus, data volumes are designed to persist data independen\", \"tly of the life of the container. If you delete a container or an image from the Docker host, the da\", \"ta persisted in the data volume is not deleted.\\n\\nVolumes can be named or anonymous (the default). Na\", \"med volumes are the evolution of Data Volume Containers and make it easy to share data between conta\", \"iners. Volumes also support volume drivers that allow you to store data on remote hosts, among other\", \" options.\\n\\nBind mounts have been available for a long time and allow the mapping of any folder to a \", \"mount point in a container. Bind mounts have more limitations than volumes and some important securi\", \"ty issues, so volumes are the recommended option.\\n\\ntmpfs mounts are virtual folders that live only i\", \"n the host's memory and are never written to the filesystem. They are fast and secure but use memory\", \" and are only meant for non-persistent data.\\n\\nAs shown in Figure 4-5, regular Docker volumes can be \", \"stored outside of the containers themselves but within the physical boundaries of the host server or\", \" VM. However, Docker containers cannot access a volume from one host server or VM to another. In oth\", \"er words, with these volumes, it isn't possible to manage data shared between containers that run on\", \" different Docker hosts, although it could be achieved with a volume driver that supports remote hos\", \"ts.\\n\\nBrowser or\\n\\nClient App\\n\\nLoad Balancer\\n\\nStateless\\n\\nContainer\\n\\nFigure 4 -5. Volumes and external \", \"data sources for container-based applications\\n\\n<!-- image -->\\n\\nIn addition, when Docker containers a\", \"re managed by an orchestrator, containers might \\\"move\\\" between hosts, depending on the optimizations\", \" performed by the cluster. Therefore, it isn't recommended that you use data volumes for business da\", \"ta. But they are a good mechanism to work with trace files, temporal files, or similar, that will no\", \"t impact business data consistency.\\n\\nRemote data sources and cache tools like Azure SQL Database, Az\", \"ure Cosmos DB, or a remote cache like Redis can be used in containerized applications the same way t\", \"hey are used when developing without containers. This is a proven way to store business application \", \"data.\\n\\nAzure Storage. Business data usually needs to be placed in external resources or databases, l\", \"ike Azure Storage. Azure Storage provides the following services in the cloud:\\n\\n- Blob storage store\", \"s unstructured object data. A blob can be any type of text or binary data, such as document or media\", \" files (images, audio, and video files). Blob storage is also referred to as Object storage.\\n- File \", \"storage offers shared storage for legacy applications using the standard SMB protocol. Azure virtual\", \" machines and cloud services can share file data across application components via mounted shares. O\", \"n -premises applications can access file data in a share via the File Service REST API.\\n- Table stor\", \"age stores structured datasets. Table storage is a NoSQL key-attribute data store, which allows rapi\", \"d development and fast access to large quantities of data.\\n\\nRelational databases and NoSQL databases\", \". There are many choices for external databases, from relational databases like SQL Server, PostgreS\", \"QL, Oracle, or NoSQL databases like Azure Cosmos DB, MongoDB, etc. These databases are not going to \", \"be explained as part of this guide since they are a different topic altogether.\\n\\nAzure\\n\\n## Service -\", \"oriented applications\\n\\nService -Oriented Architecture (SOA) was an overused term that meant many dif\", \"ferent things to different people. But as a common denominator, SOA means that you structure the arc\", \"hitecture of your application by decomposing it into several services (most commonly as HTTP service\", \"s) that can be classified in different types like subsystems or, in other cases, as tiers.\\n\\nToday, y\", \"ou can deploy those services as Docker containers, which solve deployment-related issues because all\", \" of the dependencies are included in the container image. However, when you need to scale out SOAs, \", \"you might encounter challenges if you're deploying based on single instances. This challenge can be \", \"handled using Docker clustering software or an orchestrator. You'll get to look at orchestrators in \", \"greater detail in the next section, when you explore microservices approaches.\\n\\nDocker containers ar\", \"e useful (but not required) for both traditional service-oriented architectures and the more advance\", \"d microservices architectures.\\n\\nAt the end of the day, the container clustering solutions are useful\", \" for both a traditional SOA architecture and for a more advanced microservices architecture in which\", \" each microservice owns its data model. And thanks to multiple databases, you can also scale out the\", \" data tier instead of working with monolithic databases shared by the SOA services. However, the dis\", \"cussion about splitting the data is purely about architecture and design.\\n\\n## Orchestrating microser\", \"vices and multi -container applications for high scalability and availability\\n\\nUsing orchestrators f\", \"or production-ready applications is essential if your application is based on microservices or split\", \" across multiple containers. As introduced previously, in a microservice-based approach, each micros\", \"ervice owns its model and data so that it will be autonomous from a development and deployment point\", \" of view. But even if you have a more traditional application that's composed of multiple services (\", \"like SOA), you'll also have multiple containers or services comprising a single business application\", \" that need to be deployed as a distributed system. These kinds of systems are complex to scale out a\", \"nd manage; therefore, you absolutely need an orchestrator if you want to have a production-ready and\", \" scalable multi-container application.\\n\\nFigure 4-6 illustrates deployment into a cluster of an appli\", \"cation composed of multiple microservices (containers).\\n\\n\\u2022 For each service instance, you use one co\", \"ntainer\\n\\n\\u2022 Docker images/containers are units of deployment\\n\\n\\u2022 A container is an instance of a docke\", \"r image\\n\\n\\u2022 A host (VM/server) handles many containers or\\n\\nFigure 4 -6. A cluster of containers\\n\\n<!--\", \" image -->\\n\\nIt looks like a logical approach. But how are you handling load balancing, routing, and \", \"orchestrating these composed applications?\\n\\nThe Docker CLI meets the needs of managing one container\", \" on one host, but it falls short when it comes to managing multiple containers deployed on multiple \", \"hosts for more complex distributed applications. In most cases, you need a management platform that \", \"will automatically start containers, scale out containers with multiple instances per image, suspend\", \" them, or shut them down when needed, and ideally also control how they access resources like the ne\", \"twork and data storage.\\n\\nTo go beyond the management of individual containers or simple composed app\", \"s and move toward larger enterprise applications with microservices, you must turn to orchestration \", \"and clustering platforms.\\n\\nFrom an architecture and development point of view, if you're building la\", \"rge, enterprise, microservices -based, applications, it's important to understand the following plat\", \"forms and products that support advanced scenarios:\\n\\n- Clusters and orchestrators. When you need to \", \"scale out applications across many Docker hosts, such as with a large microservices-based applicatio\", \"n, it's critical to be able to manage all of those hosts as a single cluster by abstracting the comp\", \"lexity of the underlying platform. That's what the container clusters and orchestrators provide. Exa\", \"mples of orchestrators are Azure Service Fabric and Kubernetes. Kubernetes is available in Azure thr\", \"ough Azure Kubernetes Service.\\n\\nVM\\n\\nApp 1\\n\\nApp 2\\n\\nServices\\n\\nMy Docker Images\\n\\n- Schedulers. Scheduli\", \"ng means to have the capability for an administrator to launch containers in a cluster, so scheduler\", \"s also provide a user interface for doing so. A cluster scheduler has several responsibilities: to u\", \"se the cluster's resources efficiently, to set the constraints provided by the user, to efficiently \", \"load-balance containers across nodes or hosts, and to be robust against errors while providing high \", \"availability.\\n\\nThe concepts of a cluster and a scheduler are closely related, so the products provid\", \"ed by different vendors often provide both sets of capabilities. The section below shows the most im\", \"portant platform and software choices you have for clusters and schedulers. These orchestrators are \", \"widely offered in public clouds like Azure.\\n\\n## Software platforms for container clustering, orchest\", \"ration, and scheduling\\n\\n<!-- image -->\\n\\n| Platform                       | Comments                 \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                    \", \"                                                      |\\n|--------------------------------|----------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------|\\n| Kubernetes                \", \"     | Kubernetes is an open-source product that  provides functionality that ranges from  cluster i\", \"nfrastructure and container  scheduling to orchestrating capabilities. It  lets you automate deploym\", \"ent, scaling,  and operations of application containers  across clusters of hosts. Kubernetes provid\", \"es a container-centric  infrastructure that groups application  containers into logical units for ea\", \"sy  management and discovery. Kubernetes is mature in Linux, less mature  in Windows. |\\n| Azure Kube\", \"rnetes Service (AKS) | Azure Kubernetes Service (AKS) is a  managed Kubernetes container  orchestrat\", \"ion service in Azure that  simplifies Kubernetes cluster\\u2019s  management, deployment, and  operations.\", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                    \", \"  |\\n\\nre Service Fa\\n\\nS\\n\\n<!-- image -->\\n\\n| Platform             | Comments                            \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                    \", \"                                                        |\\n|----------------------|------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"---------------------------------------------------------------------------|\\n| Azure Service Fabric \", \"| Service Fabric is a Microsoft microservices  platform for building applications. It\\u2019s an  orchestr\", \"ator of services and creates  clusters of machines. Service Fabric can  deploy services as container\", \"s or as plain  processes. It can even mix services in  processes with services in containers  within\", \" the same application and cluster. Service Fabric clusters can be deployed in  Azure, on-premises or\", \" in any cloud.  However, deployment in Azure is  simplified with a managed approach. Service Fabric \", \"provides additional and  optional prescriptive Service Fabric  programming models like stateful serv\", \"ices and Reliable Actors . Service Fabric is mature in Windows (years  evolving in Windows), less ma\", \"ture in Linux. Both Linux and Windows containers are  supported in Service Fabric since 2017. |\\n\\n<!-\", \"- image -->\\n\\nAzure Service Fabric Mesh | Azure Service Fabric Mesh offers the same reliability, miss\", \"ioncritical performance and scale as Service Fabric, but also offers a fully managed and serverless \", \"platform. You don't need to manage a cluster, VMs, storage or networking configuration. You just foc\", \"us on your application's development. Service Fabric Mesh supports both Windows and Linux containers\", \", allowing you to develop with any programming language and framework of your choice.\\n\\n## Azure Cont\", \"ainer Apps\\n\\n| Azure Container Apps is a\\n\\n<!-- image -->\\n\\nmanaged serverless container service for bu\", \"ilding and deploying modern apps at scale. |\\n\\n## Using container-based orchestrators in Azure\\n\\nSever\", \"al cloud vendors offer Docker containers support plus Docker clusters and orchestration support, inc\", \"luding Azure, Amazon EC2 Container Service, and Google Container Engine. Azure provides Docker\\n\\nclus\", \"ter and orchestrator support through Azure Kubernetes Service (AKS), Azure Service Fabric, and Azure\", \" Service Fabric Mesh.\\n\\n## Using Azure Kubernetes Service\\n\\nA Kubernetes cluster pools several Docker \", \"hosts and exposes them as a single virtual Docker host, so you can deploy multiple containers into t\", \"he cluster and scale-out with any number of container instances. The cluster will handle all the com\", \"plex management plumbing, like scalability, health, and so forth.\\n\\nAKS provides a way to simplify th\", \"e creation, configuration, and management of a cluster of virtual machines in Azure that are preconf\", \"igured to run containerized applications. Using an optimized configuration of popular open-source sc\", \"heduling and orchestration tools, AKS enables you to use your existing skills or draw on a large and\", \" growing body of community expertise to deploy and manage container-based applications on Microsoft \", \"Azure.\\n\\nAzure Kubernetes Service optimizes the configuration of popular Docker clustering open-sourc\", \"e tools and technologies specifically for Azure. You get an open solution that offers portability fo\", \"r both your containers and your application configuration. You select the size, the number of hosts,\", \" and the orchestrator tools, and AKS handles everything else.\\n\\nAKS\\n\\nKubernetes\\n\\nNode\\n\\nNode\\n\\nMaster N\", \"ode\\n\\nDNS\\n\\nScheduler\\n\\nFigure 4 -7. Kubernetes cluster's simplified structure and topology\\n\\n<!-- image\", \" -->\\n\\nFigure 4-7 shows the structure of a Kubernetes cluster where a master node (VM) controls most \", \"of the coordination of the cluster, and you can deploy containers to the rest of the nodes that are \", \"managed as a single pool from an application point of view. This allows you to scale to thousands or\", \" even tens of thousands of containers.\\n\\n## Development environment for Kubernetes\\n\\nIn the developmen\", \"t environment that Docker announced in July 2018, Kubernetes can also run in a single development ma\", \"chine (Windows 10 or macOS) by just installing Docker Desktop. You can later deploy to the cloud (AK\", \"S) for further integration tests, as shown in figure 4-8.\\n\\nPC/Development Environment\\n\\nWindows 10 or\", \" macOS\\n\\n'Docker Desktop' with local-dev Kubernetes cluster\\n\\nDocker Registry\\n\\nDocker Hub\\n\\nOr ACR\\n\\nFig\", \"ure 4 -8. Running Kubernetes in dev machine and the cloud\\n\\n<!-- image -->\\n\\n## Get started with Azure\", \" Kubernetes Service (AKS)\\n\\nTo begin using AKS, you deploy an AKS cluster from the Azure portal or by\", \" using the CLI. For more information on deploying a Kubernetes cluster to Azure, see Deploy an Azure\", \" Kubernetes Service (AKS) cluster .\\n\\nThere are no fees for any of the software installed by default \", \"as part of AKS. All default options are implemented with open-source software. AKS is available for \", \"multiple virtual machines in Azure. You're charged only for the compute instances you choose, as wel\", \"l as the other underlying infrastructure resources consumed, such as storage and networking. There a\", \"re no incremental charges for AKS itself.\\n\\nFor further implementation information on deployment to K\", \"ubernetes based on kubectl and original .yaml files, see Deploy to Azure Kubernetes Service (AKS) .\\n\", \"\\n## Deploy with Helm charts into Kubernetes clusters\\n\\nWhen deploying an application to a Kubernetes \", \"cluster, you can use the original kubectl.exe CLI tool using deployment files based on the native fo\", \"rmat (.yaml files), as already mentioned in the previous section. However, for more complex Kubernet\", \"es applications such as when deploying complex microservice -based applications, it's recommended to\", \" use Helm .\\n\\nHelm Charts helps you define, version, install, share, upgrade, or rollback even the mo\", \"st complex Kubernetes application. Helm is maintained by the Cloud Native Computing Foundation (CNCF\", \") in collaboration with Microsoft, Google, Bitnami, and the Helm contributor community.\\n\\nFor further\", \" implementation information on Helm charts and Kubernetes, see the section called Install eShopOnCon\", \"tainers using Helm .\\n\\nA Azure\\n\\nAzure Kubernetes Service (AKS)\\n\\n\\\"Managed Kubernetes\\\" for production\\n\\n\", \"## Additional resources\\n\\n- Getting started with Azure Kubernetes Service (AKS) https://learn.microso\", \"ft.com/azure/aks/kubernetes-walkthrough-portal\\n- Kubernetes. The official site. https://kubernetes.i\", \"o/\\n\\n## Using Azure Service Fabric\\n\\nAzure Service Fabric arose from Microsoft's transition from deliv\", \"ering \\\"box\\\" products, which were typically monolithic in style, to delivering services. The experien\", \"ce of building and operating large services at scale, such as Azure SQL Database, Azure Cosmos DB, A\", \"zure Service Bus, or Cortana's Backend, shaped Service Fabric. The platform evolved over time as mor\", \"e and more services adopted it. Importantly, Service Fabric had to run not only in Azure but also in\", \" standalone Windows Server deployments.\\n\\nThe aim of Service Fabric is to solve the hard problems of \", \"building and running a service and utilizing infrastructure resources efficiently, so that teams can\", \" solve business problems using a microservices approach.\\n\\nService Fabric provides two broad areas to\", \" help you build applications that use a microservices approach:\\n\\n- A platform that provides system s\", \"ervices to deploy, scale, upgrade, detect, and restart failed services, discover service location, m\", \"anage state, and monitor health. These system services in effect enable many of the characteristics \", \"of microservices described previously.\\n- Programming APIs, or frameworks, to help you build applicat\", \"ions as microservices: reliable actors and reliable services. You can choose any code to build your \", \"microservice, but these APIs make the job more straightforward, and they integrate with the platform\", \" at a deeper level. This way you can get health and diagnostics information, or you can take advanta\", \"ge of reliable state management.\\n\\nService Fabric is agnostic with respect to how you build your serv\", \"ice, and you can use any technology. However, it provides built-in programming APIs that make it eas\", \"ier to build microservices.\\n\\nAs shown in Figure 4-10, you can create and run microservices in Servic\", \"e Fabric either as simple processes or as Docker containers. It's also possible to mix container-bas\", \"ed microservices with process -based microservices within the same Service Fabric cluster.\\n\\nAzure Se\", \"rvice Fabric - Types of clusters\\n\\nService Fabric cluster\\n\\n\\u2022\\n\\nMicroservices as processes\\n\\nService Fab\", \"ric with Docker cluster\\n\\nFigure 4 -10. Deploying microservices as processes or as containers in Azur\", \"e Service Fabric\\n\\n<!-- image -->\\n\\nIn the first image, you see microservices as processes, where each\", \" node runs one process for each microservice. In the second image, you see microservices as containe\", \"rs, where each node runs Docker with several containers, one container per microservice. Service Fab\", \"ric clusters based on Linux and Windows hosts can run Docker Linux containers and Windows Containers\", \", respectively.\\n\\nFor up -to -date information about containers support in Azure Service Fabric, see \", \"Service Fabric and containers .\\n\\nService Fabric is a good example of a platform where you can define\", \" a different logical architecture (business microservices or Bounded Contexts) than the physical imp\", \"lementation. For example, if you implement Stateful Reliable Services in Azure Service Fabric, which\", \" are introduced in the next section, \\\" Stateless versus stateful microservices,\\\" you have a business\", \" microservice concept with multiple physical services.\\n\\nAs shown in Figure 4-10, and thinking from a\", \" logical/business microservice perspective, when implementing a Service Fabric Stateful Reliable Ser\", \"vice, you usually will need to implement two tiers of services. The first is the back -end stateful \", \"reliable service, which handles multiple partitions (each partition is a stateful service). The seco\", \"nd is the front-end service, or Gateway service, in charge of routing and data aggregation across mu\", \"ltiple partitions or stateful service instances. That Gateway service also handles client -side comm\", \"unication with retry loops accessing the back-end service. It's called a Gateway service if you impl\", \"ement your custom service, or alternatively you can also use the out -of -the -box Service Fabric re\", \"verse proxy .\\n\\nBusiness/logical\\n\\nBusiness/Logical Microservice microservice\\n\\n(Using Azure Service Fa\", \"bric and Containers)\\n\\n(Using Azure Service Fabric\\n\\nStateful Reliable Services)\\n\\nService Fabric Appli\", \"cation\\n\\nService/Container\\n\\nLogical Boundary of\\n\\n*Business Microservice\\n\\nPartition\\n\\nA\\n\\nFigure 4 -11. \", \"Business microservice with several stateful service instances and a custom gateway front end\\n\\n<!-- i\", \"mage -->\\n\\nIn any case, when you use Service Fabric Stateful Reliable Services, you also have a logic\", \"al or business microservice (Bounded Context) that's composed of multiple physical services. Each of\", \" them, the Gateway service, and Partition service could be implemented as ASP.NET Web API services, \", \"as shown in Figure 4-11. Service Fabric has prescription to support several stateful reliable servic\", \"es in containers.\\n\\nIn Service Fabric, you can group and deploy groups of services as a Service Fabri\", \"c Application, which is the unit of packaging and deployment for the orchestrator or cluster. Theref\", \"ore, the Service Fabric Application could be mapped to this autonomous business and logical microser\", \"vice boundary or Bounded Context, as well, so you could deploy these services autonomously.\\n\\n## Serv\", \"ice Fabric and containers\\n\\nWith regard to containers in Service Fabric, you can also deploy services\", \" in container images within a Service Fabric cluster. As Figure 4-12 shows, most of the time there w\", \"ill only be one container per service.\\n\\nFigure 4 -12. Business microservice with several services (c\", \"ontainers) in Service Fabric\\n\\n<!-- image -->\\n\\nSQL Server database\\n\\nBusiness/Logical Microservice\\n\\n(U\", \"sing Azure Service Fabric and Containers)\\n\\nService Fabric Application\\n\\nA Service Fabric application \", \"can run several containers accessing an external database and the whole set would be the logical bou\", \"ndary of a Business Microservice. However, so-called \\\"sidecar\\\" containers (two containers that must \", \"be deployed together as part of a logical service) are also possible in Service Fabric. The importan\", \"t thing is that a business microservice is the logical boundary around several cohesive elements. In\", \" many cases, it might be a single service with a single data model, but in some other cases you migh\", \"t have several physical services as well.\\n\\npartitions\\n\\nNote that you can mix services in processes, \", \"and services in containers, in the same Service Fabric application, as shown in Figure 4-13.\\n\\nFigure\", \" 4 -13. Business microservice mapped to a Service Fabric application with containers and stateful se\", \"rvices\\n\\n<!-- image -->\\n\\nFor more information about container support in Azure Service Fabric, see Se\", \"rvice Fabric and containers .\\n\\n## Stateless versus stateful microservices\\n\\nAs mentioned earlier, eac\", \"h microservice (logical Bounded Context) must own its domain model (data and logic). In the case of \", \"stateless microservices, the databases will be external, employing relational options like SQL Serve\", \"r, or NoSQL options like Azure Cosmos DB or MongoDB.\\n\\nBut the services themselves can also be statef\", \"ul in Service Fabric, which means that the data resides within the microservice. This data might exi\", \"st not just on the same server, but within the microservice process, in memory and persisted on hard\", \" drives and replicated to other nodes. Figure 4-14 shows the different approaches.\\n\\nStateless micros\", \"ervice with separate store\\n\\nStateless Services\\n\\nBusiness microservice A\\n\\nStateful Services\\n\\nBusiness\", \" microservice B\\n\\nFigure 4 -14. Stateless versus stateful microservices\\n\\n<!-- image -->\\n\\nIn stateless\", \" services, the state (persistence, database) is kept out of the microservice. In stateful services, \", \"state is kept inside the microservice. A stateless approach is perfectly valid and is easier to impl\", \"ement than stateful microservices, since the approach is similar to traditional and well-known patte\", \"rns. But stateless microservices impose latency between the process and data sources. They also invo\", \"lve more moving pieces when you're trying to improve performance with additional cache and queues. T\", \"he result is that you can end up with complex architectures that have too many tiers.\\n\\nIn contrast, \", \"stateful microservices can excel in advanced scenarios, because there's no latency between the domai\", \"n logic and data. Heavy data processing, gaming back ends, databases as a service, and other low -la\", \"tency scenarios all benefit from stateful services, which enable local state for faster access.\\n\\nSta\", \"teless and stateful services are complementary. For instance, as you can see in the right diagram in\", \" Figure 4-14, a stateful service can be split into multiple partitions. To access those partitions, \", \"you might need a stateless service acting as a gateway service that knows how to address each partit\", \"ion based on partition keys.\\n\\nStateful services do have drawbacks. They impose a high complexity lev\", \"el to be scaled out. Functionality that would usually be implemented by external database systems mu\", \"st be addressed for tasks such as data replication across stateful microservices and data partitioni\", \"ng. However, this is one of the areas where an orchestrator like Azure Service Fabric with its state\", \"ful reliable services can help the most \\u2014 by simplifying the development and lifecycle of stateful m\", \"icroservices using the Reliable Services API and Reliable Actors .\\n\\nOther microservice frameworks th\", \"at allow stateful services, support the Actor pattern, and improve fault tolerance and latency betwe\", \"en business logic and data are Microsoft Orleans, from Microsoft Research, and Akka.NET. Both framew\", \"orks are currently improving their support for Docker.\\n\\nRemember that Docker containers are themselv\", \"es stateless. If you want to implement a stateful service, you need one of the additional prescripti\", \"ve and higher-level frameworks noted earlier.\\n\\n## Using Azure Service Fabric Mesh\\n\\nAzure Service Fab\", \"ric Mesh is a fully managed service that enables developers to build and deploy mission critical app\", \"lications without managing any infrastructure. Use Service Fabric Mesh to build and run secure, dist\", \"ributed microservices applications that scale on demand.\\n\\nAzure Product\\n\\nAzure Kubernetes Service\\n\\n(\", \"AKS)\\n\\nOrchestrator\\n\\nKubernetes\\n\\nDescription\\n\\nDocker Registry\\n\\nKubernetes is an open-source platform \", \"for automating deployment, scaling, and\\n\\noperations of application containers across clusters of hos\", \"ts.\\n\\nPC/Development Environment\\n\\nWindows 10 or macoS\\n\\n(Cluster and Mesh)\\n\\nACS Engine: laas container\", \" infrastructure\\n\\nGood for\\n\\nCommon workloads\\n\\nIt's an OSS ecosystem\\n\\nA Azure\\n\\nMicroservices based on \", \"containers\\n\\nAzure Service Fabric Mesh\\n\\n(codename \\\"SeaBreeze\\\")\\n\\nMore mature:\\n\\nLess mature:\\n\\nAs shown \", \"in figure 4-15, applications hosted on Service Fabric Mesh run and scale without you worrying about \", \"the infrastructure powering it. \\\"Infrastructure is transparent\\\" and OSS More mature: containers b) M\", \"icroservices based on\\n\\nAKS: You pay for VMsin cluster microservices.\\n\\nVisual Studio\\n\\nMesh: PaaS/Serv\", \"erless platform or\\n\\n<!-- image -->\\n\\nLess mature: A\\n\\nplain processes\\n\\nFigure 4 -15. Deploying a micro\", \"service/containers application to Service Fabric Mesh\\n\\nUnder the covers, Service Fabric Mesh consist\", \"s of clusters of thousands of machines. All cluster operations are hidden from the developer. You si\", \"mply need to upload your containers and specify resources you need, availability requirements, and r\", \"esource limits. Service Fabric Mesh automatically allocates the infrastructure requested by your app\", \"lication deployment and also handles infrastructure failures, making sure your applications are high\", \"ly available. You only need to care about the health and responsiveness of your application, not the\", \" infrastructure.\\n\\nFor further information, see the Service Fabric Mesh documentation .\\n\\n## Choosing \", \"orchestrators in Azure\\n\\nThe following table provides guidance on what orchestrator to use depending \", \"on workloads and OS focus.\\n\\nFigure 4 -16. Orchestrator selection in Azure guidance\\n\\n<!-- image -->\\n\\n\", \"## Deploy to Azure Kubernetes Service (AKS)\\n\\nYou can interact with AKS using your preferred client o\", \"perating system (Windows, macOS, or Linux) with Azure command -line interface (Azure CLI) installed.\", \" For more details, refer Azure CLI documentation and Installation guide for the available environmen\", \"ts.\\n\\n## Create the AKS environment in Azure\\n\\nThere are several ways to create the AKS Environment. I\", \"t can be done by using Azure CLI commands or by using the Azure portal.\\n\\nHere you can explore some e\", \"xamples using the Azure CLI to create the cluster and the Azure portal to review the results. You al\", \"so need to have Kubectl and Docker in your development machine.\\n\\n## Create the AKS cluster\\n\\nCreate t\", \"he AKS cluster using this command (the resource group must exist):\\n\\naz aks create --resource-group e\", \"xplore-docker-aks-rg --name explore-docker-aks --nodevm-size Standard\\\\_B2s --node-count 1 --generate\", \"-ssh-keys --location westeurope\\n\\n## Note\\n\\nThe --node -vm-size and --node -count parameter values are\", \" good enough for a sample/dev application.\\n\\nAfter the creation job finishes, you can see:\\n\\n- The AKS\", \" cluster created in the initial resource group\\n- A new, related resource group, containing the resou\", \"rces related to the AKS cluster, as show in the following images.\\n\\nThe initial resource group, with \", \"the AKS cluster:\\n\\n= Microsoft Azure\\n\\nSearch resources, services, and docs (G+/)\\n\\nMicrosoft Azure\\n\\nSe\", \"arch resources, services, and docs (G+/)\\n\\nHome &gt; Resource groups &gt; explore-docker-aks-rg\\n\\nHome\", \" &gt; Resource groups &gt; MC\\\\_explore-docker-aks-rg\\\\_explore-docker-aks\\\\_westeurope\\n\\nResource group\", \"s\\n\\n\\u00ab\\n\\n\\u00ab\\n\\nX\\n\\nPersonal - GMail\\n\\nResource groups\\n\\nPersonal - GMail\\n\\n+ Add\\n\\n503 Manage view Y\\n\\n+ Add\\n\\nMa\", \"nage view v aks\\n\\naks\\n\\nName T.\\n\\nName Tu\\n\\n[9) explore-docker-aks-rg\\n\\n[\\u2022) explore-docker-aks-rg\\n\\n(9) MC\", \"\\\\_explore-docker-aks-rg\\\\_explore-doc... \\u2022\\u2022\\u2022\\n\\n[9) Mc\\\\_explore-docker-aks-rg\\\\_explore-doc... \\u2022\\u2022\\u2022\\n\\nPage\", \" 1 V of 1\\n\\nexplore-docker-aks-rg\\n\\nMC\\\\_explore-docker-aks-rg\\\\_explore-docker-aks\\\\_westeurope\\n\\nResourc\", \"e group\\n\\nResource group\\n\\n+ Add\\n\\nEE Edit columns\\n\\n\\u2022 Delete resource group Refresh \\u2192 Move\\n\\n+ Add\\n\\nEE E\", \"dit columns\\n\\n\\u00dc Delete resource group () Refresh \\u2192 Move\\n\\nSubscription (change) : Demo subscription\\n\\nS\", \"ubscription (change) : Demo subscription\\n\\nSubscription ID\\n\\nSubscription ID\\n\\n: -\\n\\n* Export to CSV | \\u00ae\", \" Assign tags\\n\\n\\u2022 Delete\\n\\n&amp; Export to CSV | \\u00ae Assign tags\\n\\nDelete &amp; Export template\\n\\nDeploymen\", \"ts : No deployments\\n\\nDeployments : 1 Succeeded\\n\\n<!-- image -->\\n\\nPage| 1 V| of1\\n\\nFigure 4 -17. AKS Re\", \"source Group view from Azure.\\n\\nThe AKS cluster resource group:\\n\\n<!-- image -->\\n\\nFigure 4 -18. AKS vi\", \"ew from Azure.\\n\\n<!-- image -->\\n\\nYou can also view the node created using Azure CLI and Kubectl.\\n\\nFir\", \"st, getting the credentials:\\n\\naz aks get-credentials --resource-group explore-docker-aks-rg --name e\", \"xplore-dockeraks\\n\\n\\u00bb\\n\\n&amp; Export template\\n\\n\\u2022 Feedback\\n\\n\\u2022 Feedback\\n\\n8 X\\n\\n* X\\n\\nmiguel@LAPTOP-MV:/mnt/\", \"c/Users/Miguel$ az aks get-credentials --resource-group explore-docker-aks-rg --name explore-docker-\", \"aks\\n\\nMerged \\\"explore-docker-aks\\\" as current context in /home/miguel/.kube/config miguel@LAPTOP-MV:/m\", \"nt/c/Users/Miguel$ kubectl get nodes\\n\\nmigue1@LAPTOP-MV:/mnt/c/Users/Miguel$\\n\\nNAME\\n\\nSTATUS\\n\\naks-nodep\", \"ool1-41297266-vmss000000\\n\\nReady migue1@LAPTOP-MV:/mnt/c/Users/Miguel$\\n\\nROLES\\n\\nagent\\n\\nAGE\\n\\n36m\\n\\nVERSI\", \"ON\\n\\nv1.15.10\\n\\nFigure 4 -19. aks get -credentials command result.\\n\\n<!-- image -->\\n\\nAnd then, getting \", \"nodes from Kubectl:\\n\\nkubectl get nodes\\n\\nFigure 4 -20. kubectl get nodes command result.\\n\\n<!-- image \", \"-->\\n\\n## Development environment for Docker apps\\n\\n## Development tools choices: IDE or editor\\n\\nNo mat\", \"ter if you prefer a full and powerful IDE or a lightweight and agile editor, Microsoft has you cover\", \"ed when it comes to developing Docker applications.\\n\\n## Visual Studio Code and Docker CLI (cross-pla\", \"tform tools for Mac, Linux, and Windows)\\n\\nIf you prefer a lightweight, cross-platform editor support\", \"ing any development language, you can use Visual Studio Code and Docker CLI. These products provide \", \"a simple yet robust experience, which is critical for streamlining the developer workflow. By instal\", \"ling \\\"Docker for Mac\\\" or \\\"Docker for Windows\\\" (development environment), Docker developers can use a\", \" single Docker CLI to build apps for both Windows or Linux (runtime environment). Plus, Visual Studi\", \"o Code supports extensions for Docker with IntelliSense for Dockerfiles and shortcut -tasks to run D\", \"ocker commands from the editor.\\n\\n## Note\\n\\nTo download Visual Studio Code, go to https://code.visuals\", \"tudio.com/download .\\n\\nTo download Docker for Mac and Windows, go to https://www.docker.com/products/\", \"docker .\\n\\n## Visual Studio with Docker Tools (Windows development machine)\\n\\nIt's recommended that yo\", \"u use Visual Studio 2022 or later with the built-in Docker Tools enabled. With Visual Studio, you ca\", \"n develop, run, and validate your applications directly in the chosen Docker environment. Press F5 t\", \"o debug your application (single container or multiple containers) directly in a Docker host, or pre\", \"ss Ctrl+F5 to edit and refresh your app without having to rebuild the container. It's the simplest a\", \"nd most powerful choice for Windows developers to create Docker containers for Linux or Windows.\\n\\n##\", \" Visual Studio for Mac (Mac development machine)\\n\\nYou can use Visual Studio for Mac when developing \", \"Docker-based applications. Visual Studio for Mac offers a richer IDE when compared to Visual Studio \", \"Code for Mac.\\n\\n## Language and framework choices\\n\\nYou can develop Docker applications using Microsof\", \"t tools with most modern languages. The following is an initial list, but you're not limited to it:\\n\", \"\\n- .NET and ASP.NET Core\\n- Node.js\\n- Go\\n- Java\\n- Ruby\\n- Python\\n\\nBasically, you can use any modern la\", \"nguage supported by Docker in Linux or Windows.\\n\\n## Inner -loop development workflow for Docker apps\", \"\\n\\nBefore triggering the outer-loop workflow spanning the entire DevOps cycle, it all begins on each \", \"developer's machine, coding the app itself, using their preferred languages or platforms, and testin\", \"g it locally (Figure 4-21). But in every case, you'll have an important point in common, no matter w\", \"hat language, framework, or platforms you choose. In this specific workflow, you're always developin\", \"g and testing Docker containers in no other environments, but locally.\\n\\nFigure 4 -21. Inner -loop de\", \"velopment context\\n\\n<!-- image -->\\n\\nThe container or instance of a Docker image will contain these co\", \"mponents:\\n\\n- An operating system selection (for example, a Linux distribution or Windows)\\n- Files ad\", \"ded by the developer (for example, app binaries)\\n- Configuration (for example, environment settings \", \"and dependencies)\\n- Instructions for what processes to run by Docker\\n\\nYou can set up the inner-loop \", \"development workflow that utilizes Docker as the process (described in the next section). Consider t\", \"hat the initial steps to set up the environment are not included, because you only need to do it onc\", \"e.\\n\\ngit push\\n\\n1\\n\\nCode\\n\\nYour App\\n\\n2\\n\\nWrite\\n\\nDockerFile(s)\\n\\n3\\n\\nCreate Images\\n\\nDefined at\\n\\nDockerFile(s\", \")\\n\\nMy\\n\\nImages\\n\\n5\\n\\nRun\\n\\nContainers/\\n\\nCompose App\\n\\nMy\\n\\nContainers\\n\\n## Building a single app within a D\", \"ocker container using Visual Studio Code and Docker CLI Images Local Docker My My\\n\\nContainer 1 Conta\", \"iner 2\\n\\nApps are made up from your own services plus additional libraries (dependencies).\\n\\nFigure 4-\", \"22 shows the basic steps that you usually need to carry out when building a Docker app, followed by \", \"detailed descriptions of each step.\\n\\n7\\n\\nPush or\\n\\nContinue\\n\\nDeveloping\\n\\nFigure 4 -22. High -level wor\", \"kflow for the life cycle for Docker containerized applications using Docker CLI\\n\\n<!-- image -->\\n\\n## \", \"Step 1: Start coding in Visual Studio Code and create your initial app/service baseline\\n\\nThe way you\", \" develop your application is similar to the way you do it without Docker. The difference is that whi\", \"le developing, you're deploying and testing your application or services running within Docker conta\", \"iners placed in your local environment (like a Linux VM or Windows).\\n\\n## Setting up your local envir\", \"onment\\n\\nWith the latest versions of Docker Desktop for Mac and Windows, it's easier than ever to dev\", \"elop Docker applications, and the setup is straightforward.\\n\\n<!-- image -->\\n\\n| Tip                  \", \"                                                                                             |\\n|----\", \"----------------------------------------------------------------------------------------------------\", \"-----------|\\n| For instructions on setting up Docker Desktop for Windows, go to https://docs.docker.\", \"com/docker\\u0002 for - windows/ . |\\n| For instructions on setting up Docker Desktop for Mac, go to https:\", \"//docs.docker.com/docker-for\\u0002 mac/ .           |\\n\\nIn addition, you'll need a code editor so that you\", \" can actually develop your application while using Docker CLI.\\n\\nDefine Services by Writing\\n\\ndocker-c\", \"ompose.yml http\\n\\naccess..\\n\\nTest App or\\n\\nMicroservices\\n\\nEXTENSIONS: MARKETPLACE\\n\\ndocker\\n\\nDocker 1.00\\n\", \"\\n\\u0424 42\\u041c * 4.5\\n\\nMakes it easy to create, manage, and debug containerized ap...\\n\\nMicrosoft\\n\\nInstall\\n\\n\\u2022 \", \"Extension: Docker X\\n\\ndocker\\n\\nDocker ms-azuretools.vscode-docker\\n\\nMicrosoft @ 4,284,613 | * **** Repo\", \"sitory License\\n\\nMakes it easy to create, manage, and debug containerized applications.\\n\\nInstall\\n\\nMic\", \"rosoft provides Visual Studio Code, which is a lightweight code editor that's supported on Windows, \", \"Linux, and macOS, and provides IntelliSense with support for many languages (JavaScript, .NET, Go, J\", \"ava, Ruby, Python, and most modern languages), debugging , integration with Git and extensions suppo\", \"rt. This editor is a great fit for macOS and Linux developers. In Windows, you also can use Visual S\", \"tudio.\\n\\n## Tip\\n\\nFor instructions on installing Visual Studio Code for Windows, Linux, or macOS, go t\", \"o https://code.visualstudio.com/docs/setup/setup-overview/ .\\n\\nFor instructions on setting up Docker \", \"for Mac, go to https://docs.docker.com/docker-for-mac/ .\\n\\nYou can work with Docker CLI and write you\", \"r code using any code editor, but using Visual Studio Code with the Docker extension makes it easy t\", \"o author Dockerfile and docker-compose.yml files in your workspace. You can also run tasks and scrip\", \"ts from the Visual Studio Code IDE to execute Docker commands using the Docker CLI underneath.\\n\\nThe \", \"Docker extension for VS Code provides the following features:\\n\\n- Automatic Dockerfile and docker -co\", \"mpose.yml file generation\\n- Syntax highlighting and hover tips for docker-compose.yml and Dockerfile\", \" files\\n- IntelliSense (completions) for Dockerfile and docker-compose.yml files\\n- Linting (errors an\", \"d warnings) for Dockerfile files\\n- Command Palette (F1) integration for the most common Docker comma\", \"nds\\n- Explorer integration for managing Images and Containers\\n- Deploy images from DockerHub and Azu\", \"re Container Registries to Azure App Service\\n\\nTo install the Docker extension, press Ctrl+Shift+P, t\", \"ype ext install, and then run the Install Extension command to bring up the Marketplace extension li\", \"st. Next, type docker to filter the results, and then select the Docker Support extension, as depict\", \"ed in Figure 4-23.\\n\\nFigure 4 -23. Installing the Docker Extension in Visual Studio Code\\n\\n<!-- image \", \"-->\\n\\n## Step 2: Create a DockerFile related to an existing image (plain OS or dev environments like \", \".NET, Node.js, and Ruby)\\n\\nYou'll need a DockerFile per custom image to be built and per container to\", \" be deployed. If your app is made up of single custom service, you'll need a single DockerFile. But \", \"if your app is composed of multiple services (as in a microservices architecture), you'll need one D\", \"ockerfile per service.\\n\\nThe DockerFile is commonly placed in the root folder of your app or service \", \"and contains the required commands so that Docker knows how to set up and run that app or service. Y\", \"ou can create your DockerFile and add it to your project along with your code (node.js, .NET, etc.),\", \" or, if you're new to the environment, take a look at the following Tip.\\n\\n## Tip\\n\\nYou can use the Do\", \"cker extension to guide you when using the Dockerfile and docker-compose.yml files related to your D\", \"ocker containers. Eventually, you'll probably write these kinds of files without this tool, but usin\", \"g the Docker extension is a good starting point that will accelerate your learning curve.\\n\\nIn Figure\", \" 4-24, you can see the steps to add the docker files to a project by using the Docker Extension for \", \"VS Code:\\n\\n1. Open the command palette, type \\\"docker\\\" and select \\\"Add Docker Files to Workspace\\\".\\n2. \", \"Select Application Platform (ASP.NET Core)\\n3. Select Operating System (Linux)\\n4. Include optional Do\", \"cker Compose files\\n5. Enter ports to publish (80, 443)\\n6. Select the project\\n\\n&gt; docker\\n\\nDocker: A\", \"dd Docker Files to Workspace...\\n\\nSelect Application Platform\\n\\n\\u2022NET: ASPINET Core (recently used)\\n\\nNo\", \"de.js\\n\\nSelect Operating System\\n\\nLinux (recently used)\\n\\nWindows\\n\\nInclude optional Docker Compose file\", \"s?\\n\\nYes (recently used)\\n\\nNo\\n\\n80, 443\\n\\n(Press 'Enter' to confirm or 'Escape' to cancel)\\n\\nSelect Proje\", \"ct src/WebApi/WebApi.csproj\\n\\nsrc/WebApp/WebApp.csproj explore-docker-vscode - Visual Studio Code\\n\\n1\\n\", \"\\nFigure 4 -24. Docker files added using the Add Docker files to Workspace command\\n\\n<!-- image -->\\n\\nW\", \"hen you add a DockerFile, you specify what base Docker image you'll be using (like using FROM mcr.mi\", \"crosoft.com/dotnet/aspnet). You'll usually build your custom image on top of a base image that you g\", \"et from any official repository at the Docker Hub registry (like an image for .NET or the one for No\", \"de.js).\\n\\n<!-- image -->\\n\\n## Use an existing official Docker image\\n\\nUsing an official repository of a\", \" language stack with a version number ensures that the same language features are available on all m\", \"achines (including development, testing, and production).\\n\\nThe following is a sample DockerFile for \", \"a .NET container:\\n\\nrecently used\\n\\n```\\nFROM mcr.microsoft.com/dotnet/aspnet:6.0 AS base WORKDIR /app \", \"EXPOSE 80 EXPOSE 443 FROM mcr.microsoft.com/dotnet/sdk:6.0 AS build WORKDIR /src COPY [\\\"src/WebApi/W\", \"ebApi.csproj\\\" , \\\"src/WebApi/\\\"] RUN dotnet restore \\\"src/WebApi/WebApi.csproj\\\" COPY . . WORKDIR \\\"/src/\", \"src/WebApi\\\" RUN dotnet build \\\"WebApi.csproj\\\" -c Release -o /app/build FROM build AS publish RUN dotn\", \"et publish \\\"WebApi.csproj\\\" -c Release -o /app/publish FROM base AS final WORKDIR /app COPY --from=pu\", \"blish /app/publish . ENTRYPOINT [\\\"dotnet\\\" , \\\"WebApi.dll\\\"]\\n```\\n\\nIn this case, the image is based on v\", \"ersion 6.0 of the official ASP.NET Core Docker image (multi-arch for Linux and Windows), as per the \", \"line FROM mcr.microsoft.com/dotnet/aspnet:6.0. (For more information about this topic, see the ASP.N\", \"ET Core Docker Image page and the .NET Docker Image page).\\n\\nIn the DockerFile, you can also instruct\", \" Docker to listen to the TCP port that you'll use at run time (such as port 80 or 443).\\n\\nYou can spe\", \"cify additional configuration settings in the Dockerfile, depending on the language and framework yo\", \"u're using. For instance, the ENTRYPOINT line with [\\\"dotnet\\\", \\\"WebMvcApplication.dll\\\"] tells Docker \", \"to run a .NET application. If you're using the SDK and the .NET CLI (dotnet CLI) to build and run th\", \"e .NET application, this setting would be different. The key point here is that the ENTRYPOINT line \", \"and other settings depend on the language and platform you choose for your application.\\n\\n```\\nTip For\", \" more information about building Docker images for .NET applications, see https://learn.microsoft.co\", \"m/dotnet/core/docker/build-container . To learn more about building your own images, go to https://d\", \"ocs.docker.com/engine/tutorials/dockerimages/ .\\n```\\n\\n## Use multi -arch image repositories\\n\\nA single\", \" image name in a repo can contain platform variants, such as a Linux image and a Windows image. This\", \" feature allows vendors like Microsoft (base image creators) to create a single repo to cover multip\", \"le platforms (that is, Linux and Windows). For example, the dotnet/aspnet repository available in th\", \"e Docker Hub registry provides support for Linux and Windows Nano Server by using the same image nam\", \"e.\\n\\nPulling the dotnet/aspnet image from a Windows host pulls the Windows variant, whereas pulling t\", \"he same image name from a Linux host pulls the Linux variant.\\n\\ndocker build -t webapi:latest\\n\\n[+]\\n\\nB\", \"uilding 73.9s (8/17)\\n\\n\\u2192\\n\\n\\u2192\\n\\n\\u2192\\n\\n[internal]\\n\\nload\\n\\n. dockerignore transferring\\n\\ncontext:\\n\\n35B\\n\\n[intern\", \"al]\\n\\nload build definition from Dockerfile\\n\\n\\u2192 transferring dockerfile: 32B\\n\\n\\u2192 [internal] load metada\", \"ta for mcr.microsoft.com/dotnet/sdk:5.0\\n\\n\\u2192 [internal] load metadata for mcr.microsoft.com/dotnet/asp\", \"net:5.0\\n\\n\\u2192\\n\\n\\u2192\\n\\n\\u2192\\n\\n\\u2192\\n\\n\\u2192\\n\\n\\u2192\\n\\n[internal] load build context\\n\\n## Create your base image from scratch\\n\\n\\u2192 \", \"resolve mcr.microsoft.com/dotnet/aspnet:5.0@sha256:c0b8b703634a9efc9c36743528b25f9c48feb16240e9c623a\", \"8454d8e616afc62\\n\\n\\u2192\\n\\nYou can create your own Docker base image from scratch as explained in this arti\", \"cle from Docker. This scenario is probably not the best for you if you're just starting with Docker,\", \" but if you want to set the specific bits of your own base image, you can do it.\\n\\nsha256:1d922f93bc4\", \"b6f844b3a260dd70d8e60020cbaf2b576e55ede53b5033d37@d59 99.97MB / 99.97MB\\n\\nsha256:35fdefe40e562c3e294f\", \"7c2b0ba65826b8888c556b90bfb50154985c8cdbelb2 12.64MB / 12.64MB\\n\\n## Step 3: Create your custom Docker\", \" images embedding your service in it\\n\\nFor each custom service that comprises your app, you'll need t\", \"o create a related image. If your app is made up of a single service or web app, you'll need just a \", \"single image.\\n\\n<!-- image -->\\n\\nTo create an image in your local environment and using the DockerFile\", \", you can use the docker build command, as shown in Figure 4-25, because it already tags the image f\", \"or you and builds the images for all services in the application with a simple command.\\n\\nFigure 4 -2\", \"5. Running docker build\\n\\n<!-- image -->\\n\\nOptionally, instead of directly running docker build from t\", \"he project folder, you first can generate a deployable folder with the .NET libraries needed by usin\", \"g the run dotnet publish command, and then run docker build.\\n\\nThis example creates a Docker image wi\", \"th the name webapi:latest (:latest is a tag, like a specific version). You can take this step for ea\", \"ch custom image you need to create for your composed Docker\\n\\n-f src/WebApi/Dockerfile .\\n\\n\\u203a docker im\", \"ages\\n\\nREPOSITORY\\n\\nwebapp webapi\\n\\nmcr.microsoft.com/dotnet/sdk mcr.microsoft.com/dotnet/aspnet\\n\\nTAG\\n\\n\", \"latest latest\\n\\n5.0\\n\\n5.0\\n\\nIMAGE ID\\n\\n14afabc6c02d faa96bdee09c\\n\\nacc2e9a7698d\\n\\n66792fe28528\\n\\nCREATED\\n\\n5\", \" minutes ago\\n\\n5 minutes ago\\n\\n20 hours ago\\n\\n20 hours ago\\n\\nSIZE\\n\\n210MB\\n\\n210MB\\n\\n616MB\\n\\n205MB\\n\\napplicati\", \"on with several containers. However, we'll see in the next section that it's easier to do this using\", \" docker-compose.\\n\\nYou can find the existing images in your local repository (your development machin\", \"e) by using the docker images command, as illustrated in Figure 4-26.\\n\\nFigure 4 -26. Viewing existin\", \"g images using docker images\\n\\n<!-- image -->\\n\\n## Step 4: Define your services in docker-compose.yml \", \"when building a composed Docker app with multiple services\\n\\nWith the docker -compose.yml file, you c\", \"an define a set of related services to be deployed as a composed application with the deployment com\", \"mands explained in the next step section.\\n\\nCreate that file in your main or root solution folder; it\", \" should have content similar to that shown in this docker -compose.yml file:\\n\\n```\\nversion: \\\"3.4\\\" ser\", \"vices: webapi: image: webapi build: context: . dockerfile: src/WebApi/Dockerfile ports: -51080:80 de\", \"pends_on: -redis environment: -ASPNETCORE_ENVIRONMENT=Development -ASPNETCORE_URLS=http://+:80 webap\", \"p: image: webapp build: context: . dockerfile: src/WebApp/Dockerfile ports: -50080:80 environment: -\", \"ASPNETCORE_ENVIRONMENT=Development -ASPNETCORE_URLS=http://+:80 -WebApiBaseAddress=http://webapi red\", \"is: image: redis\\n```\\n\\nIn this particular case, this file defines three services: the web API service\", \" (your custom service), a web application, and the Redis service (a popular cache service). Each ser\", \"vice will be deployed as a container, so you need to use a concrete Docker image for each. For this \", \"particular application:\\n\\n- The web API service is built from the DockerFile in the src/WebApi/Docker\", \"file directory.\\n- The host port 51080 is forwarded to the exposed port 80 on the webapi container.\\n-\", \" The web API service depends on the Redis service\\n- The web application accesses the web API service\", \" using the internal address: http://webapi.\\n- The Redis service uses the latest public redis image p\", \"ulled from the Docker Hub registry. Redis is a popular cache system for server-side applications.\\n\\n#\", \"# Step 5: Build and run your Docker app\\n\\nIf your app has only a single container, you just need to r\", \"un it by deploying it to your Docker Host (VM or physical server). However, if your app is made up o\", \"f multiple services, you need to compose it, t, too. Let's see the different options.\\n\\n## Option A: \", \"Run a single container or service\\n\\nYou can run the Docker image by using the docker run command, as \", \"shown here:\\n\\ndocker run -t -d -p 50080:80 webapp:latest\\n\\nFor this particular deployment, we'll be re\", \"directing requests sent to port 50080 on the host to the internal port 80.\\n\\n## Option B: Compose and\", \" run a multiple-container application\\n\\nIn most enterprise scenarios, a Docker application will be co\", \"mposed of multiple services. For these cases, you can run the docker-compose up command (Figure 4-27\", \"), which will use the dockercompose.yml file that you created previously. Running this command build\", \"s all custom images and deploys the composed application with all of its related containers.\\n\\n\\u203a dock\", \"er-compose up\\n\\nMy\\n\\nMy\\n\\nContainer 1 Container 2\\n\\nCreating explore-docker-vscode\\\\_webapp\\\\_1 ... done\\n\\n\", \"Creating explore-docker-vscode\\\\_webapi\\\\_l ... done\\n\\nAttaching to explore-docker-vscode\\\\_webapp\\\\_1, e\", \"xplore-docker-vscode\\\\_webapi\\\\_1\\n\\nwebapp\\\\_1\\n\\nwebapp\\\\_1\\n\\n, warn: Microsoft. AspNetCore. Dataprotection\", \" Repositories. FileSystemmlRepository 60]\\n\\nStoring keys in a directory '/root/.aspnet/DataProtection\", \"-Keys' that may not be ected data will be unavailable when container is destroyed.\\n\\nwebapp\\\\_1 |\\n\\nweb\", \"api\\\\_1\\n\\nwebapi\\\\_1\\n\\nwebapi\\\\_1\\n\\nwebapi\\\\_1\\n\\nwebapi\\\\_1\\n\\nwebapi\\\\_1\\n\\nwebapi\\\\_1\\n\\nwebapi\\\\_1\\n\\nwebapp\\\\_1\\n\\nweba\", \"pp\\\\_1\\n\\nwebapp\\\\_1\\n\\nwebapp\\\\_1\\n\\nwebapp\\\\_1\\n\\nwebapp\\\\_1\\n\\nwebapp\\\\_1\\n\\nwebapp\\\\_1\\n\\nFigure 4 -27. Results of ru\", \"nning the \\\"docker-compose up\\\" command\\n\\n<!-- image -->\\n\\nAfter you run docker-compose up, you deploy y\", \"our application and its related container(s) into your Docker Host, as illustrated in Figure 4-28, i\", \"n the VM representation.\\n\\nFigure 4 -28. VM with Docker containers deployed\\n\\n<!-- image -->\\n\\n## Step \", \"6: Test your Docker application (locally, in your local CD VM)\\n\\nThis step will vary depending on wha\", \"t your app is doing.\\n\\nIn a simple .NET Web API \\\"Hello World\\\" deployed as a single container or servi\", \"ce, you'd just need to access the service by providing the TCP port specified in the DockerFile.\\n\\nOn\", \" the Docker host, open a browser and navigate to that site; you should see your app/service running,\", \" as demonstrated in Figure 4-29.\\n\\n\\u203a curl http://localhost:51080/WeatherForecast lE Weather Forecast \", \"- WebApp\\n\\nStatusCode\\n\\nStatusDescription\\n\\n+\\n\\n\\u2022 G \\u2022 localhost:50080/WeatherForecast\\n\\n\\u2022 m G 0 0\\n\\n: [f\\\"d\", \"ate\\\": \\\"2021-01-06T12:13:43.7721387+00:00\\\", \\\"temperatureC\\\": 42, \\\"temperaturef\\\": 107, \\\"summary\\\": \\\"Chil\", \"ly\\\"}, {\\\"date\\\": \\\"2021-01-07T12:1\\n\\nWebApp Home Privacy ry\\\": \\\"Bracing ...\\n\\nRawContent\\n\\nForms\\n\\nHeaders\\n\\n\", \"Images\\n\\nInputFields\\n\\n: HTTP/1.1 200 OK\\n\\nTransfer-Encoding: chunked\\n\\nContent-Type: application/json; \", \"charset=utf-8\\n\\n: {}\\n\\n: {}\\n\\nData from: http://webapi/WeatherForecast\\n\\nLinks\\n\\n: {}\\n\\nParsedHtml\\n\\nDate\\n\\n\", \"RawContentLength\\n\\n: 512\\n\\n2020-04-22 17:32:17\\n\\n2020-04-23 17:32:17\\n\\n2020-04-24 17:32:17\\n\\n2020-04-25 1\", \"7:32:17\\n\\n2020-04-26 17:32:17\\n\\n\\u00a9 2020 - WebApp - Privacy\\n\\nFigure 4 -29. Testing your Docker applicati\", \"on locally by using the browser\\n\\n<!-- image -->\\n\\nNote that it's using port 50080, but internally it'\", \"s being redirected to port 80, because that's how it was deployed with docker compose, as explained \", \"earlier.\\n\\nYou can test this by using the browser using CURL from the terminal, as depicted in Figure\", \" 4-30.\\n\\nFigure 4 -30. Testing a Docker application locally by using CURL\\n\\n<!-- image -->\\n\\n## Debuggi\", \"ng a container running on Docker\\n\\nVisual Studio Code supports debugging Docker if you're using Node.\", \"js and other platforms like .NET containers.\\n\\n: 200\\n\\n0\\n\\nYou also can debug .NET or .NET Framework co\", \"ntainers in Docker when using Visual Studio for Windows or Mac, as described in the next section.\\n\\n|\", \" Tip                                                                                       |\\n|------\", \"-------------------------------------------------------------------------------------|\\n| To learn mo\", \"re about debugging Node.js Docker containers, see                              |\\n| https://learn.mic\", \"rosoft.com/archive/blogs/user_ed/visual-studio-code-new-features-13-big\\u0002 |\\n| debugging-updates-rich-\", \"object-hover-conditional-breakpoints-node-js-mono-more .           |\\n\\n## Use Docker Tools in Visual \", \"Studio on Windows\\n\\nThe developer workflow when using the Docker Tools included in Visual Studio 2022\", \" version 17.0 and later, is similar to using Visual Studio Code and Docker CLI (in fact, it's based \", \"on the same Docker CLI), but it's easier to get started, simplifies the process, and provides greate\", \"r productivity for the build, run, and compose tasks. It can also run and debug your containers via \", \"the usual F5 and Ctrl+F5keys from Visual Studio. You can even debug a whole solution if its containe\", \"rs are defined in the same docker -compose.yml file at the solution level.\\n\\n## Configure your local \", \"environment\\n\\nWith the latest versions of Docker for Windows, it's easier than ever to develop Docker\", \" applications because the setup is straightforward, as explained in the following references.\\n\\n## Ti\", \"p\\n\\nTo learn more about installing Docker for Windows, go to (https://docs.docker.com/docker-forwindo\", \"ws/).\\n\\n## Docker support in Visual Studio\\n\\nThere are two levels of Docker support you can add to a p\", \"roject. In ASP.NET Core projects, you can just add a Dockerfile file to the project by enabling Dock\", \"er support. The next level is container orchestration support, which adds a Dockerfile to the projec\", \"t (if it doesn't already exist) and a dockercompose.yml file at the solution level. Container orches\", \"tration support, via Docker Compose, is available in Visual Studio 2022 versions 17.0. Container orc\", \"hestration support is an opt-in feature in Visual Studio 2022 versions 17.0 or later. Visual Studio \", \"2022 also supports Kubernetes/Helm deployment.\\n\\nThe Add &gt; Docker Support and Add &gt; Container O\", \"rchestrator Support commands are located on the right-click menu (or context menu) of the project no\", \"de for an ASP.NET Core project in Solution Explorer, as shown in Figure 4-31:\\n\\n+a\\n\\n*-\\n\\nNew Item...\\n\\n\", \"Existing Item...\\n\\nNew Scaffolded Item...\\n\\nNew Folder\\n\\nApplication Insights Telemetry...\\n\\nContainer O\", \"rchestrator Support...\\n\\n\\u2022 Docker Support...\\n\\n\\u00ae Client-Side Library..\\n\\nSolution Explorer\\n\\n6. -\\n\\n0 -3\\n\", \"\\nSearch Solution Explorer (Ctrl+\\\")\\n\\nSolution 'docs-vs-images' (4 of 4 projects)\\n\\nX\\n\\nP\\n\\nNotifications\", \"\\n\\nFigure 4 -31. Adding Docker support to a Visual Studio project\\n\\n<!-- image -->\\n\\n## Add Docker supp\", \"ort\\n\\nBesides the option to add Docker support to an existing application, as shown in the previous s\", \"ection, you can also enable Docker support during project creation by selecting Enable Docker Suppor\", \"t in the New ASP.NET Core Web Application dialog box that opens after you click OK in the New Projec\", \"t dialog box, as shown in Figure 4-32.\\n\\nAdditional information\\n\\nASP.NET Core Web App\\n\\nFramework\\n\\nNET\", \" 6.0 (Long-term support)\\n\\nAuthentication type O\\n\\nNone\\n\\n/ Configure for HTTPS \\u00ae\\n\\nM Enable Docker O\\n\\nD\", \"ocker OS \\u00ae\\n\\nLinux\\n\\nLinux macOS\\n\\nWindows\\n\\nService\\n\\nWeb\\n\\nFigure 4 -32. Enable Docker support during pr\", \"oject creation in Visual Studio\\n\\n<!-- image -->\\n\\nWhen you add or enable Docker support, Visual Studi\", \"o adds a Dockerfile file to the project, that includes references to all required project from the s\", \"olution.\\n\\n## Add container orchestration support\\n\\nWhen you want to compose a multi-container solutio\", \"n, add container orchestration support to your projects. This lets you run and debug a group of cont\", \"ainers (a whole solution) at the same time if they're defined in the same docker-compose.yml file.\\n\\n\", \"To add container orchestration support, right-click on the project node in Solution Explorer, and ch\", \"oose Add &gt; Container Orchestration Support. Then choose Docker Compose to manage the containers.\\n\", \"\\nAfter you add container orchestration support to your project, you see a Dockerfile added to the pr\", \"oject and a docker-compose folder added to the solution in Solution Explorer, as shown in Figure 4 -\", \"33:\\n\\nX\\n\\nSolution Explorer\\n\\nSearch Solution Explorer (CtrI+\\\")\\n\\nSolution 'docs-vs-images' (4 of 4 proj\", \"ects)\\n\\n+\\n\\nP\\n\\nP\\n\\n<!-- image -->\\n\\n\\u2022--\\n\\n\\u2022-L\\n\\nC*\\n\\na C#\\n\\ndocker-compose\\n\\n\\u2022dockerignore\\n\\nFigure 4 -33. Doc\", \"ker files in Solution Explorer in Visual Studio\\n\\nIf docker -compose.yml already exists, Visual Studi\", \"o just adds the required lines of configuration code to it.\\n\\n## Configure Docker tools\\n\\nFrom the mai\", \"n menu, choose Tools &gt; Options, and expand Container Tools &gt; Settings. The container tools set\", \"tings appear.\\n\\n+\\n\\n+\\n\\nOptions\\n\\nSearch Options (Ctrl+E)\\n\\n\\u2022 Azure Service Authentication\\n\\n4 Container T\", \"ools\\n\\nGeneral\\n\\nSingle Project\\n\\nContainers Tool Window\\n\\nDocker Compose\\n\\n\\u2022 Cross Platform\\n\\n\\u2022 Database \", \"Tools\\n\\n\\u2022 F# Tools\\n\\n\\u2022 IntelliCode\\n\\nD Kubernetes Debugging Tools\\n\\n\\u2022 Live Share\\n\\n\\u2022 NuGet Package Manage\", \"r\\n\\n\\u2022 Service Fabric Tools\\n\\nD SQL Server Tools\\n\\n\\u2022 Test\\n\\n\\u2022 Text Templating\\n\\nD Web Forms Designer\\n\\nY Ge\", \"neral\\n\\nInstall Docker Desktop if needed Prompt me\\n\\nStart Docker Desktop if needed\\n\\nAlways\\n\\nFigure 4 \", \"-34. Docker Tools Options\\n\\n<!-- image -->\\n\\nFor more detailed configurations refer to Container Tools\", \" settings\\n\\n<!-- image -->\\n\\n## Using Windows PowerShell commands in a DockerFile to set up Windows Co\", \"ntainers (Docker standard based)\\n\\nWith Windows Containers, you can convert your existing Windows app\", \"lications to Docker images and deploy them with the same tools as the rest of the Docker ecosystem.\\n\", \"\\n?\\n\\nX\\n\\nTo use Windows Containers, you just need to write Windows PowerShell commands in the DockerFi\", \"le, as demonstrated in the following example:\\n\\n```\\nFROM mcr.microsoft.com/windows/servercore:ltsc201\", \"9 LABEL Description=\\\"IIS\\\" Vendor=\\\"Microsoft\\\" Version=\\\"10\\\" RUN powershell Get-WindowsFeature web-serv\", \"er RUN powershell Install-windowsfeature web-server RUN powershell add-windowsfeature web-asp-net45 \", \"CMD [ \\\"ping\\\" , \\\"localhost\\\" , \\\" -t\\\" ]\\n```\\n\\nIn this case, we're using Windows PowerShell to install a \", \"Windows Server Core base image as well as IIS.\\n\\nIn a similar way, you also could use Windows PowerSh\", \"ell commands to set up additional components like the traditional ASP.NET 4.x and .NET Framework 4.6\", \" or any other Windows software, as shown here:\\n\\nRUN powershell add-windowsfeature web-asp-net45\\n\\n## \", \"Build ASP.NET Core applications deployed as Linux containers into an AKS/Kubernetes orchestrator\\n\\nAz\", \"ure Kubernetes Services (AKS) is Azure's managed Kubernetes orchestrations services that simplify co\", \"ntainer deployment and management.\\n\\nThe main features of AKS are:\\n\\n- An Azure -hosted control plane.\", \"\\n- Automated upgrades.\\n- Self -healing.\\n- User -configurable scaling.\\n- Simpler user experience for \", \"both developers and cluster operators.\\n\\nThe following examples explore the creation of an ASP.NET Co\", \"re 6.0 application that runs on Linux and deploys to an AKS Cluster in Azure. Development is done us\", \"ing Visual Studio 2022 version 17.0.\\n\\n## Creating the ASP.NET Core Project using Visual Studio 2022\\n\", \"\\nASP.NET Core is a general-purpose development platform maintained by Microsoft and the .NET communi\", \"ty on GitHub. It's cross-platform, supporting Windows, macOS and Linux, and can be used in device, c\", \"loud, and embedded/IoT scenarios.\\n\\nThis example uses a couple of simple projects based on Visual Stu\", \"dio templates, so you don't need much additional knowledge to create the sample. You only have to cr\", \"eate the project using a standard template that includes all the elements to run a small project wit\", \"h a REST API and a Web App with Razor pages, using ASP.NET Core 6.0 technology.\\n\\nFor reference, you \", \"can download the sample from .NET Application Architecture's repo exploredocker .\\n\\nAdd a new project\", \"\\n\\nRecent project templates\\n\\nASP.NET Core Web APl\\n\\nASP.NET Core Web App\\n\\n&amp; ASP.NET Core Empty\\n\\nSe\", \"arch for templates (Alt+S)\\n\\nAll languages\\n\\nAll platforms\\n\\nWeb\\n\\nFigure 4 -35. Creating an ASP.NET Cor\", \"e Web Application in Visual Studio 2022.\\n\\n<!-- image -->\\n\\nTo create the sample project in Visual Stu\", \"dio, select File &gt; New &gt; Project, select the Web project type and then the ASP.NET Core Web Ap\", \"i template. You can also search for the template if you need it.\\n\\nThen enter the application name an\", \"d location as shown in the next image.\\n\\nP-\\n\\nClear all\\n\\nX\\n\\nConfigure your new project\\n\\nASP.NET Core W\", \"eb API\\n\\nProject name\\n\\nWebApi\\n\\nLocation\\n\\nC:\\\\src\\\\explore-docker\\n\\nSolution name explore-docker\\n\\n\\u2022 Place\", \" solution and project in the same directory\\n\\nLinux macos\\n\\nWindows\\n\\nCloud\\n\\nService\\n\\nWebAPI\\n\\nFigure 4 \", \"-36. Enter the project name and location in Visual Studio 2022.\\n\\n<!-- image -->\\n\\nVerify that you've \", \"selected ASP.NET Core 6.0 as the framework. .NET 6 is included in the latest release of Visual Studi\", \"o 2022 and is automatically installed and configured for you when you install Visual Studio.\\n\\nAdditi\", \"onal information\\n\\nASP.NET Core Web API\\n\\nFramework\\n\\n.NET 6.0 (Long-term support)\\n\\nAuthentication type\", \"\\n\\nNone\\n\\n/ Configure for HTTPS O\\n\\nEnable Docker\\n\\nDocker OS O\\n\\nLinux\\n\\nUse controllers uncheck to use m\", \"inimal APS) @ /\\n\\nEnable OpenAPI support O\\n\\nC#\\n\\nLinux macOS\\n\\nWindows\\n\\nCloud\\n\\nService\\n\\nWeb\\n\\nFigure 4 -\", \"37. Selecting ASP.NET CORE 6.0 and Web API project type\\n\\n<!-- image -->\\n\\nNotice Docker support is no\", \"t enabled now. You'll do that in the next step after the project creation. You'll also notice that b\", \"y default controller option is checked. You can uncheck that if you want to Create a minimal web API\", \" with ASP.NET Core .\\n\\nTo show you can \\\"Dockerize\\\" your project at any time, you'll add Docker suppor\", \"t now. So right-click on the project node in Solution Explorer and select Add &gt; Docker support on\", \" the context menu.\\n\\nDocker File Options\\n\\nTarget O5:\\n\\nLinux\\n\\nWindows\\n\\nNew Item...\\n\\nExisting Item...\\n\\n\", \"New Scaffolded Item...\\n\\nNew Folder\\n\\nApplication Insights Telemetry...\\n\\nContainer Orchestrator Suppor\", \"t...\\n\\nDocker Support...\\n\\nSolution Explorer\\n\\nSearch Solution Explorer (CtrI+\\\")\\n\\nSolution 'explore-doc\", \"ker' (1 of 1 project)\\n\\nFigure 4 -38 . Adding Docker support to an existing project\\n\\n<!-- image -->\\n\\n\", \"To complete adding Docker support, you can choose Windows or Linux. In this case, select Linux .\\n\\nFi\", \"gure 4 -39. Selecting Linux containers.\\n\\n<!-- image -->\\n\\n74 X\\n\\nSolution Explorer\\n\\n0 - 5\\n\\nSearch Solu\", \"tion Explorer (CtrI+\\\")\\n\\nWith these simple steps, you have your ASP.NET Core 6.0 application running \", \"on a Linux container.\\n\\nIn a similar way, you can also add a very simple WebApp project (Figure 4-40)\", \" to consume the web API endpoint, although the details can be seen in the code repo .\\n\\nAfter that, y\", \"ou add orchestrator support for your WebApi project as shown next, in image 4-40.\\n\\nNew Item...\\n\\nExis\", \"ting Item...\\n\\nNew Scaffolded Item...\\n\\nNew Folder\\n\\nApplication Insights Telemetry...\\n\\nContainer Orche\", \"strator Support...\\n\\nDocker Support...\\n\\nFigure 4 -40. Adding orchestrator support to WebApi project.\\n\", \"\\n<!-- image -->\\n\\nWhen you choose the Docker Compose option, which is fine for local development, Vis\", \"ual Studio adds the docker -compose project, with the docker-compose files as shown in image 4-41.\\n\\n\", \"\\u2022 = 4 x\\n\\nSolution Explorer\\n\\n0 = \\u015b\\n\\nSearch Solution Explorer (Ctri+\\\")\\n\\n*a Solution 'explore-docker' (\", \"3 of 3 projects)\\n\\nS\\u0413C\\n\\n<!-- image -->\\n\\nWebApi\\n\\nWebApp docker-compose\\n\\n\\u2022dockerignore\\n\\n+\\n\\nFigure 4 -41\", \". Adding orchestrator support to WebApi project.\\n\\nThe initial files added are similar to these ones:\", \"\\n\\ndocker -compose.yml\\n\\n```\\nversion: \\\"3.4\\\" services: webapi: image: ${DOCKER_REGISTRY-}webapi build: \", \"context: . dockerfile: WebApi/Dockerfile webapp: image: ${DOCKER_REGISTRY-}webapp build: context: . \", \"dockerfile: WebApp/Dockerfile\\n```\\n\\ndocker -compose.override.yml\\n\\n```\\nversion: \\\"3.4\\\" services: webapi\", \": environment: -ASPNETCORE_ENVIRONMENT=Development -ASPNETCORE_URLS=https://+:443;http://+:80 ports:\", \" -\\\"80\\\" -\\\"443\\\" volumes: -${APPDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro -${APPDATA}\", \"/ASP.NET/Https:/root/.aspnet/https:ro webapp: environment: -ASPNETCORE_ENVIRONMENT=Development -ASPN\", \"ETCORE_URLS=https://+:443;http://+:80 ports: -\\\"80\\\" -\\\"443\\\"\\n```\\n\\nCHAPTER 4 | Designing and developing \", \"containerized apps using Docker and Microsoft Azure\\n\\nP\\n\\n# +\\n\\n+\\n\\nLD\\n\\nDEBUG\\n\\nDebug\\n\\nTEST\\n\\nANALYZE\\n\\nAny\", \" CPU\\n\\nTOOLS\\n\\nEXTENSIONS\\n\\ndocker-compose\\n\\nHELP\\n\\nSearch (Ctrl+Q)\\n\\nlocker Compose +\\n\\n```\\nvolumes: -${AP\", \"PDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro -${APPDATA}/ASP.NET/Https:/root/.aspnet\", \"/https:ro\\n```\\n\\nTo run your app with Docker Compose, you just have to make a few tweaks to dockercomp\", \"ose.override.yml.\\n\\n```\\nservices: webapi: #... ports: -\\\"51080:80\\\" -\\\"51443:443\\\" #... webapp: environme\", \"nt: #... -WebApiBaseAddress=http://webapi ports: -\\\"50080:80\\\" -\\\"50443:443\\\" #...\\n```\\n\\nNow you can run \", \"your application with the F5 key, or by using the Play button, or the Ctrl+F5 key, selecting the doc\", \"ker-compose project, as shown in image 4-42.\\n\\nFigure 4 -42. Adding orchestrator support to WebApi pr\", \"oject.\\n\\n<!-- image -->\\n\\nWhen running the docker-compose application as explained, you get:\\n\\n1. The i\", \"mages built and containers created as per the docker-compose file.\\n2. The browser open in the addres\", \"s configured in the \\\"Properties\\\" dialog for the dockercompose project.\\n3. The Container window open \", \"(in Visual Studio 2022 version 17.0 and later).\\n4. Debugger support for all projects in the solution\", \", as shown in the following images.\\n\\nBrowser opened:\\n\\nWINDOW\\n\\nContainers + X\\n\\nI Weather Forecast - W\", \"ebApp\\n\\nContainers Images\\n\\nXI\\n\\n&lt; &gt;\\n\\nx+\\n\\n8 https://localhost:50443/weatherforecast\\n\\nSolution Con\", \"tainers\\n\\n\\u2022 WebApi\\n\\n\\u00a9 WebApp\\n\\nOther Containers\\n\\n\\u2022 explore-docker-vscode\\\\_webapi \\\\_1\\n\\nexplore-docker-v\", \"scode\\\\_webapp\\\\_1\\n\\nk&amp;s\\\\_nginx-ingress-controller\\\\_ nginx-ingress-controller-7fcf8df75d-jsj8v\\\\_ing\", \"ress-ng\\n\\nDate\\n\\n2020-04-23 15:35:35\\n\\n2020-04-24 15:35:35\\n\\n2020-04-25 15:35:35\\n\\n2020-04-26 15:35:35\\n\\n2\", \"020-04-27 15:35:35\\n\\n\\u00a9 2020 - WebApp - Privacy\\n\\nEnvironment Ports Logs Files\\n\\n= O Stream Logs\\n\\nWebApp\", \" Home Privacy warn: Microsoft.AspNetCore.DataProtection.Repositories.FileSystemXmlRepository[60]\\n\\nSt\", \"oring keys in a directory '/root/. aspnet/DataProtection-Keys' that may not be d warn: Microsoft.Asp\", \"NetCore.DataProtection.KeyManagement.XmLKeyManager [35]\\n\\nNo XML encryptor configured. Key {0703c955-\", \"80ff-4e98-a404-f12677a7d17d} may be pr\\n\\nFigure 4 -43. Browser window with an application running on \", \"multiple containers.\\n\\n<!-- image -->\\n\\nContainers window:\\n\\nFigure 4 -44. Visual Studio \\\"Containers\\\" w\", \"indow\\n\\n<!-- image -->\\n\\nThe Containers window lets you view running containers, browse available imag\", \"es, view environment variables, logs, and port mappings, inspect the filesystem, attach a debugger, \", \"or open a terminal window inside the container environment.\\n\\nAs you can see, the integration between\", \" Visual Studio 2022 and Docker is completely oriented to the developer's productivity.\\n\\nOf course, y\", \"ou can also list the images using the docker images command. You should see the webapi and webapp im\", \"ages with the dev tags created by the automatic deployment of our project with Visual Studio 2022.\\n\\n\", \"docker images\\n\\n-\\n\\nX\\n\\n\\u2022 docker images\\n\\nREPOSITORY\\n\\nFILE\\n\\nwebapi webapp\\n\\nmcr.microsoft.com/dotnet/sdk\\n\", \"\\n-mcr.microsoft.com/dotnet/aspnet\\n\\nServer Expl\\n\\nIMAGE ID\\n\\nDEBUG\\n\\nTEST\\n\\n301ede061ale\\n\\nDebug\\n\\n413e9355\", \"ed78\\n\\nacc2e9a7698d\\n\\nAny CPU\\n\\n66792fe28528\\n\\nDebua\\n\\nRelease\\n\\nFigure 4 -45. View of Docker images\\n\\n<!--\", \" image -->\\n\\n## Register the Solution in an Azure Container Registry (ACR)\\n\\nYou can upload the images\", \" to the Azure Container Registry (ACR), but you could also use Docker Hub or any other registry, so \", \"the images can be deployed to the AKS cluster from that registry.\\n\\n## Create an ACR instance\\n\\nRun th\", \"e following command from the az cli:\\n\\naz acr create --name exploredocker --resource-group explore-do\", \"cker-aks-rg --sku basic --admin -enabled\\n\\n<!-- image -->\\n\\n## Create the image in Release mode\\n\\nYou'l\", \"l now create the image in Release mode (ready for production) by changing to Release, as shown in Fi\", \"gure 4-46, and running the application as you did before.\\n\\nFigure 4 -46. Selecting Release Mode\\n\\n<!-\", \"- image -->\\n\\nIf you execute the docker images command, you'll see both images created, one for debug\", \" (dev) and the other for release (latest) mode.\\n\\n## Create a new Tag for the Image\\n\\nEach container i\", \"mage needs to be tagged with the loginServer name of the registry. This tag is used for routing when\", \" pushing container images to an image registry.\\n\\nYou can view the loginServer name from the Azure po\", \"rtal, taking the information from the Azure Container Registry\\n\\nEDIT\\n\\nVIEW\\n\\nTAG\\n\\nPROJECT\\n\\nlatest lat\", \"est\\n\\n5.0\\n\\n5.0\\n\\nBUILD\\n\\nCREATED\\n\\nANALYZE\\n\\nTOOLS\\n\\n5 minutes ago\\n\\n5 minutes ago\\n\\n25 hours ago\\n\\nSIZE\\n\\nEXT\", \"ENSIONS\\n\\n210MB\\n\\n210MB\\n\\n616MB\\n\\n\\u2022 Docker - G\\n\\n25 hours ago\\n\\n205MB\\n\\nWINDOW\\n\\nHELP\\n\\nSearch (\\n\\nPS: [Miguel\", \"]&gt; docker images\\n\\nA exploredocker - Microsoft Azure X l\\n\\nPS: [Miguel]&gt;az acr list --resource-g\", \"roup explore-docker-aks-rg --query \\\"[] - (acrLoginServer: loginServer)\\\" --output table\\n\\nREPOSITORY\\n\\n\", \"+\\n\\nAcrLoginServer webapp\\n\\n&lt; &gt;\\n\\nTAG\\n\\nlatest https://portal.azure.com/#@bb9b4755-8a8a-4..#\\n\\nexpl\", \"oredocker.azurecr.io/webapp webapi\\n\\n= Microsoft Azure\\n\\nSearch resources, services, and docs (G+/)\\n\\ne\", \"xploredocker.azurecr.io exploredocker.azurecr.io/webapi\\n\\nwebapp\\n\\nHome &gt; Microsoft.ContainerRegist\", \"ry | Overview &gt; exploredocker webapi\\n\\nexploredocker\\n\\nContainer registry\\n\\nP Search (Ctri+/)\\n\\nOverv\", \"iew\\n\\n\\u2022 Activity log\\n\\n\\u00b0 Access control (IAM)\\n\\nTags\\n\\n&amp; Quick start\\n\\nEvents v1\\n\\nlatest v1\\n\\ndev\\n\\nIMA\", \"GE ID\\n\\n11f2a7d7718c\\n\\n11f2a7d7718c db9979d4cfef\\n\\ndb9979d4cfef cba194e20cb9\\n\\nCREATED\\n\\n4 minutes ago\\n\\n4\", \" minutes ago\\n\\n4 minutes ago\\n\\n?\\n\\n4 minutes ago\\n\\nAbout an hour ago\\n\\nSIZE\\n\\n213MB\\n\\n213MB\\n\\n208MB\\n\\n208MB\\n\\n\", \"207MB\\n\\n7 X\\n\\nFigure 4 -47. View of the name of the Registry\\n\\n<!-- image -->\\n\\nOr by running the follow\", \"ing command:\\n\\n```\\naz acr list --resource-group <resource -group -name> --query \\\"[].{acrLoginServer:l\", \"oginServer}\\\" --output table\\n```\\n\\nFigure 4 -48. Get the name of the registry using az cli\\n\\n<!-- image\", \" -->\\n\\nIn both cases, you\\u2019ll obtain the name. In our example, exploredocker.azurecr.io.\\n\\nNow you can \", \"tag the image, taking the latest image (the Release image), with the command:\\n\\n```\\ndocker tag <image\", \"-name>:latest <login-server-name>/<image-name>:v1\\n```\\n\\nAfter running the docker tag command, list th\", \"e images with the docker images command, and you should see the image with the new tag.\\n\\nFigure 4 -4\", \"9. View of tagged images\\n\\n<!-- image -->\\n\\n## Push the image into the Azure ACR\\n\\nLog in to the Azure \", \"Container Registry\\n\\n```\\naz acr login --name exploredocker\\n```\\n\\nPush the image into the Azure ACR, us\", \"ing the following command:\\n\\n```\\ndocker push <login-server-name>/<image-name>:v1\\n```\\n\\nPS: [Miguel]&gt\", \";docker push exploredocker.azurecr.io/webapi:v1\\n\\nThe push refers to repository [exploredocker.azurec\", \"r.io/webapi]\\n\\n35e6bc6eeb8d: Pushed\\n\\n1754f2ec3a1a: Pushed\\n\\n8957624a4d9d: Pushed b21b0b2df887: Pushed\\n\", \"\\nThis command takes a while uploading the images but gives you feedback in the process. In the follo\", \"wing image, you can see the output from one image completed and another in progress.\\n\\nb60e5c3bcef2: \", \"Pushed\\n\\n```\\nv1: digest: sha256:0f9415358734702a89084b8461eed3c50047c5c347093c311eb8d32d15ad0fda size\", \": 1791 PS: [Miguel]>docker push exploredocker.azurecr.io/webapp:v1 The push refers to repository [ex\", \"ploredocker.azurecr.io/webapp] 33e7f8019853: Pushing [========== ===>] 5.322MB 1754f2ec3a1a: Prepari\", \"ng 8957624a4d9d: Preparing b21b0b2df887: Preparing 77362d5ab4dc: Preparing 974ff534c026: Waitingng b\", \"60e5c3bcef2: Waiting\\n```\\n\\nFigure 4 -50. Console output from the push command.\\n\\nTo deploy your multi-\", \"container app into your AKS cluster you need some manifest .yaml files that have, most of the proper\", \"ties taken from the docker-compose.yml and docker-compose.override.yml files.\\n\\n## deploy-webapi.yml\\n\", \"\\n```\\napiVersion: apps/v1 kind: Deployment metadata: name: webapi labels: app: weather-forecast spec:\", \" replicas: 1 selector: matchLabels: service: webapi template: metadata: labels: app: weather-forecas\", \"t service: webapi spec: containers: -name: webapi image: exploredocker.azurecr.io/webapi:v1 imagePul\", \"lPolicy: IfNotPresent ports: -containerPort: 80 protocol: TCP env: -name: ASPNETCORE_URLS value: htt\", \"p://+:80\\n```\\n\\nCHAPTER 4 | Designing and developing containerized apps using Docker and Microsoft Azu\", \"re\\n\\n```\\n---apiVersion: v1 kind: Service metadata: name: webapi labels: app: weather-forecast service\", \": webapi spec: ports: -port: 80 targetPort: 80 protocol: TCP selector: service: webapi deploy-webapp\", \".yml apiVersion: apps/v1 kind: Deployment metadata: name: webapp labels: app: weather-forecast spec:\", \" replicas: 1 selector: matchLabels: service: webapp template: metadata: labels: app: weather-forecas\", \"t service: webapp spec: containers: -name: webapp image: exploredocker.azurecr.io/webapp:v1 imagePul\", \"lPolicy: IfNotPresent ports: -containerPort: 80 protocol: TCP env: -name: ASPNETCORE_URLS value: htt\", \"p://+:80 -name: WebApiBaseAddress value: http://webapi ---apiVersion: v1 kind: Service metadata: nam\", \"e: webapp labels: app: weather-forecast service: webapp spec: type: LoadBalancer ports: -port: 80 ta\", \"rgetPort: 80 protocol: TCP selector: service: webapp\\n```\\n\\n## Note\\n\\nThe previous .yml files only enab\", \"le the HTTP ports, using the ASPNETCORE\\\\_URLS parameter, to avoid issues with the missing certificat\", \"e in the sample app.\\n\\n## Tip\\n\\nYou can see how to create the AKS Cluster for this sample in section D\", \"eploy to Azure Kubernetes Service (AKS) on this guide.\\n\\nNow you're almost ready to deploy using kube\", \"ctl, but first you must get the credentials from the AKS Cluster with this command:\\n\\naz aks get-cred\", \"entials --resource-group explore-docker-aks-rg --name explore-docker-aks\\n\\nFigure 4 -51. Getting cred\", \"entials from AKS into the kubectl environment.\\n\\nYou also have to allow the AKS cluster to pull image\", \"s from the ACR, using this command:\\n\\naz aks update --name explore-docker-aks --resource-group explor\", \"e-docker-aks-rg --attach-acr exploredocker\\n\\nThe previous command might take a couple of minutes to c\", \"omplete. Then, use the kubectl apply command to launch the deployments, and then kubectl get all to \", \"list the cluster objects.\\n\\n```\\nkubectl apply -f deploy-webapi.yml kubectl apply -f deploy-webapp.yml\", \" kubectl get all\\n```\\n\\nPS: [Miguel]&gt;kubectl apply -f deploy-webapi-yml deployment.apps/webapi crea\", \"ted\\n\\nservice/webapi created\\n\\nPS: [Miguel]&gt;kubectl apply -f deploy-webapp-yml\\n\\nFigure 4 -52. Deplo\", \"yment to Kubernetes\\n\\n<!-- image -->\\n\\nYou'll have to wait a while until the load balancer gets the ex\", \"ternal IP, checking with kubectl get services, and then the application should be available at that \", \"address, as shown in the next image:\\n\\nI Weather Forecast - WebApp\\n\\n\\u00d7 +\\n\\n&lt; \\u2192\\n\\n\\u2022 Not secure\\n\\nWebApp\", \" Home Privacy\\n\\nData from: http://webapi/WeatherForecast\\n\\nDate\\n\\n2020-04-24 12:04:18\\n\\n2020-04-25 12:04\", \":18\\n\\n2020-04-26 12:04:18\\n\\n2020-04-27 12:04:18\\n\\n2020-04-28 12:04:18\\n\\n\\u00a9 2020 - WebApp - Privacy\\n\\nFigur\", \"e 4 -53. Deployment to Kubernetes\\n\\n<!-- image -->\\n\\nWhen the deployment completes, you can access the\", \" Kubernetes Web UI with a local proxy, using an ssh tunnel.\\n\\nFirst you must create a ClusterRoleBind\", \"ing with the following command:\\n\\nkubectl create clusterrolebinding kubernetes-dashboard --clusterrol\", \"e=cluster-admin --serviceaccount=kube -system:kubernetes-dashboard\\n\\nAnd then this command to start t\", \"he proxy:\\n\\n```\\naz aks browse --resource-group exploredocker-aks-rg --name explore-docker-aks\\n```\\n\\nA \", \"browser window should open at http://127.0.0.1:8001 with a view similar to this one:\\n\\n13.95.149.3/We\", \"atherForecast\\n\\nLE Weather Forecast - WebApp x\\n\\nOverview - Kubernetes Dashboar X\\n\\n&lt; \\u2192\\n\\n+\\n\\n\\u00a9 127.0.\", \"0.1:8001/api/v1/namespaces/kube-sy.../\\n\\n\\u2022 kubernetes\\n\\n= Overview\\n\\nCluster\\n\\nNamespaces\\n\\nNodes\\n\\nPersis\", \"tent Volumes\\n\\nRoles\\n\\nStorage Classes\\n\\nNamespace default\\n\\nOverview\\n\\nWorkloads\\n\\nCron Jobs\\n\\nDaemon Sets\", \"\\n\\nDeployments\\n\\nJobs\\n\\nPods\\n\\nReplica Sets\\n\\nReplication Controllers\\n\\nStateful Sets\\n\\nDiscovery and Load \", \"Balancing\\n\\nIngresses\\n\\nQ Search\\n\\n1. = .\\n\\n\\u2022\\u2022\\u2022\\n\\n+ CREATE\\n\\nFigure 4 -54. View Kubernetes cluster informa\", \"tion\\n\\n<!-- image -->\\n\\nNow you have your ASP.NET Core application, running in Linux containers, and d\", \"eployed to an AKS cluster on Azure.\\n\\n## Note\\n\\nFor more information on deployment with Kubernetes see\", \":\\n\\nhttps://kubernetes.io/docs/reference/kubectl/cheatsheet/\\n\\n(#)\\n\\n## Docker application DevOps workf\", \"low with Microsoft tools\\n\\nMicrosoft Visual Studio, Azure DevOps Services and/or GitHub, Team Foundat\", \"ion Server, and Azure Monitor provide a comprehensive ecosystem for development and IT operations th\", \"at give your team the tools to manage projects and rapidly build, test, and deploy containerized app\", \"lications.\\n\\nTeams can choose which tools and platforms they want to use for end to end DevOps. With \", \"Visual Studio and Azure DevOps Services in the cloud, along with Team Foundation Server on-premises,\", \" development teams can productively build, test, and release containerized applications that target \", \"either Windows or Linux. Alternatively, teams can also use Visual Studio Code and GitHub. Teams can \", \"even use combinations: for example, storing source code in GitHub and using Azure Boards for work it\", \"em tracking and Azure Pipelines for CI/CD.\\n\\nMicrosoft tools can automate the pipeline for specific i\", \"mplementations of containerized applications\\u2014Docker, .NET, or any combination with other platforms\\u2014f\", \"rom global builds and Continuous Integration (CI) and tests with Azure DevOps Services, Team Foundat\", \"ion Server or GitHub, to Continuous Deployment (CD) to Docker environments (Development, Staging, Pr\", \"oduction), and to transmit analytics information about the services to the development team through \", \"Azure Monitor. Every code commit can initiate a build (CI) and automatically deploy the services to \", \"specific containerized environments (CD).\\n\\nDevelopers and testers can easily and quickly provision p\", \"roduction-like development and test environments based on Docker by using templates in Microsoft Azu\", \"re.\\n\\nThe complexity of containerized application development increases steadily depending on the bus\", \"iness complexity and scalability needs. A good example of this complexity are applications based on \", \"microservices architectures. To succeed in such an environment, your project must automate the entir\", \"e life cycle\\u2014not only the build and deployment, but it also must manage versions along with the coll\", \"ection of telemetry. Azure DevOps Services, GitHub and Azure offer the following capabilities:\\n\\n- Az\", \"ure DevOps Services/Team Foundation Server source code management (based on Git or Team Foundation V\", \"ersion Control), Agile planning (Agile, Scrum, and CMMI are supported), CI, release management, and \", \"other tools for Agile teams.\\n\\n2\\n\\nApplication Code\\n\\nRepository (SCC)\\n\\nCode Push\\n\\nInner\\n\\nLoop\\n\\n1\\n\\nCode\", \"\\n\\nRun\\n\\nValidate\\n\\nDebug\\n\\nDev Environment\\n\\n01\\n\\n10\\n\\n3\\n\\nBuild, CI\\n\\nIntegrate, Test\\n\\n4\\n\\nCD, Deploy\\n\\n5\\n\\nRu\", \"n, Manage\\n\\nAzure\\n\\nContainer Service\\n\\nService Fabric\\n\\nApp Services\\n\\n- Azure DevOps Services and Team \", \"Foundation Server include a powerful and growing ecosystem of first and third-party extensions with \", \"which you easily can construct a CI, build, test, delivery, and release management pipeline for micr\", \"oservices.\\n- GitHub or GitHub Enterprise Server offer similar capabilities, with source control base\", \"d on Git, Projects and Issues for project tracking, GitHub Actions for automating workflows includin\", \"g CI/CD, and GitHub Advanced Security for dependency, secret and vulnerability scanning.\\n- Run autom\", \"ated tests as part of your build pipeline in Azure DevOps Services or through GitHub Actions\\n- Azure\", \" DevOps Services/GitHub can tighten the DevOps life cycle with delivery to multiple environments, no\", \"t just for production environments, but also for testing, including A/B experimentation, canary rele\", \"ases, and so on.\\n- Organizations easily can provision Docker containers from private images stored i\", \"n Azure Container Registry along with any dependency on Azure components (Data, PaaS, etc.) using Az\", \"ure Resource Manager templates with tools they're already comfortable with.\\n\\n## Steps in the outer -\", \"loop DevOps workflow for a Docker application\\n\\nFigure 5-1 presents an end-to-end depiction of the st\", \"eps comprising the DevOps outer-loop workflow. It shows the \\\"outer loop\\\" of DevOps. When code is pus\", \"hed to the repo, a CI pipeline is started, then begins the CD pipeline, where the application gets d\", \"eployed. Metrics collected from deployed applications are fed back into the development workload, wh\", \"ere the \\\"inner loop\\\" occurs, so development teams have actual data to respond to user and business n\", \"eeds.\\n\\nFigure 5 -1. DevOps outer -loop workflow for Docker applications with Microsoft tools\\n\\n<!-- i\", \"mage -->\\n\\nNow, let\\u2019s examine each of these steps in greater detail.\\n\\n## Step 1: Inner-loop developme\", \"nt workflow\\n\\nThis step is explained in detail in Chapter 4, but, to recap, here is where the outer-l\", \"oop begins, the moment at which a developer pushes code to the source control management system (lik\", \"e Git) initiating CI pipeline actions.\\n\\n## Step 2: Source-Code Control integration and management wi\", \"th Azure DevOps Services and Git\\n\\nAt this step, you need to have a version-control system to gather \", \"a consolidated version of all the code coming from the different developers in the team.\\n\\nEven thoug\", \"h source-code control (SCC) and source-code management might seem second-nature to most developers, \", \"when creating Docker applications in a DevOps life cycle, it's critical to emphasize that you must n\", \"ot submit the Docker images with the application directly to the global Docker Registry (like Azure \", \"Container Registry or Docker Hub) from the developer's machine. On the contrary, the Docker images t\", \"o be released and deployed to production environments must be created solely on the source code that\", \"'s being integrated in your global build or CI pipeline based on your sourcecode repository (like Gi\", \"t).\\n\\nThe local images, generated by developers, should just be used by them when testing within thei\", \"r own machines. That's why it's critical to have the DevOps pipeline activated from the SCC code.\\n\\nA\", \"zure DevOps Services and Team Foundation Server support Git and Team Foundation Version Control. You\", \" can choose between them and use it for an end -to -end Microsoft experience. However, you can also \", \"manage your code in external repositories (like GitHub, on-premises Git repositories, or Subversion)\", \" and still be able to connect to it and get the code as the starting point for your DevOps CI pipeli\", \"ne. You can also use GitHub Actions for CI/CD pipelines.\\n\\n## Step 3: Build, CI, Integrate, and Test \", \"with Azure DevOps Services/GitHub and Docker\\n\\nCI has emerged as a standard for modern software testi\", \"ng and delivery. The Docker solution maintains a clear separation of concerns between the developmen\", \"t and operations teams. The immutability of Docker images ensures a repeatable deployment between wh\", \"at's developed, tested through CI, and run in production. Docker Engine deployed across the develope\", \"r laptops and test infrastructure makes the containers portable across environments.\\n\\nAt this point,\", \" after you have a version-control system with the correct code submitted, you need a build service t\", \"o pick up the code and run the global build and tests.\\n\\nThe internal workflow for this step (CI, bui\", \"ld, test) is about the construction of a CI pipeline consisting of your code repository (Git, etc.),\", \" your build server (Azure DevOps Services/GitHub), Docker Engine, and a Docker Registry.\\n\\nYou can us\", \"e Azure DevOps Services as the foundation for building your applications and setting your CI pipelin\", \"e, and for publishing the built \\\"artifacts\\\" to an \\\"artifacts repository,\\\" which is explained in the \", \"next step. Alternatively, you can use GitHub to implement the same workflow.\\n\\n2\\n\\nApplication Code\\n\\n0\", \"1\\n\\n3\\n\\nBuild, CI\\n\\nWhen using Docker for the deployment, the \\\"final artifacts\\\" to be deployed are Dock\", \"er images with your application or services embedded within them. Those images are pushed or publish\", \"ed to a Docker Registry (a private repository like the ones you can have in Azure Container Registry\", \", or a public one like Docker Hub Registry or GitHub Container Registry, which is commonly used for \", \"official base images).\\n\\nHere is the basic concept: The CI pipeline will be kicked-off by a commit to\", \" an SCC repository like Git. The commit will cause Azure DevOps Services/GitHub to run a build job w\", \"ithin a Docker container and, upon successful completion of that job, push a Docker image to the Doc\", \"ker Registry, as illustrated in Figure 5-2. The first part of the outer loop involves steps 1 to 3, \", \"from code, run, debug and validate, then the code repo up to the build and test CI step.\\n\\nInner\\n\\nLoo\", \"p\\n\\nDev Environment\\n\\nFigure 5 -2. The steps involved in CI\\n\\n<!-- image -->\\n\\nHere are the basic CI wor\", \"kflow steps with Docker and Azure DevOps Services:\\n\\n1. The developer pushes a commit to an SCC repos\", \"itory (Git/Azure DevOps Services, GitHub, etc.).\\n2. If you're using Azure DevOps Services or Git, CI\", \" is built in, which means that it's as simple as selecting a check box in Azure DevOps Services. If \", \"you're using an external SCC (like GitHub), a webhook will notify Azure DevOps Services of the updat\", \"e or push to Git/GitHub.\\n3. Azure DevOps Services pulls the SCC repository, including the Dockerfile\", \" describing the image, as well as the application and test code.\\n4. Azure DevOps Services builds a D\", \"ocker image and labels it with a build number.\\n5. Azure DevOps Services instantiates the Docker cont\", \"ainer within the provisioned Docker Host, and runs the appropriate tests.\\n6. If the tests are succes\", \"sful, the image is first relabeled to a meaningful name so that you know it's a \\\"blessed build\\\" (lik\", \"e \\\"/1.0.0\\\" or any other label), and then pushed up to your Docker Registry (Docker Hub, Azure Contai\", \"ner Registry, DTR, etc.)\\n\\nHere are the basic CI workflow steps with Docker and GitHub:\\n\\n1. The devel\", \"oper pushes a commit to a GitHub repo.\\n2. CI is built in, so Actions will trigger base on the event \", \"filters.\\n3. GitHub pulls the SCC repository, including the Dockerfile describing the image, as well \", \"as the application and test code.\\n4. GitHub builds a Docker image and labels it with a build number.\", \"\\n5. GitHub instantiates the Docker container within the provisioned Docker Host, and runs the approp\", \"riate tests.\\n6. If the tests are successful, the image is first relabeled to a meaningful name so th\", \"at you know it's a \\\"blessed build\\\" (like \\\"/1.0.0\\\" or any other label), and then pushed up to your Do\", \"cker Registry (Docker Hub, Azure Container Registry, DTR, etc.)\\n\\n## Implement a CI pipeline with Azu\", \"re DevOps Services and the Docker extension for Azure DevOps Services\\n\\nVisual Studio Azure DevOps Se\", \"rvices contains Build &amp; Release Templates that you can use in your CI/CD pipeline with which you\", \" can build Docker images, push Docker images to an authenticated Docker registry, run Docker images,\", \" or run other operations offered by the Docker CLI. It also adds a Docker Compose task that you can \", \"use to build, push, and run multi-container Docker applications, or run other operations offered by \", \"the Docker Compose CLI, as shown in Figure 5-3.\\n\\n* BikeSharing 360\\n\\nHome Code\\n\\nBuilds\\n\\nReleases\\n\\nTas\", \"k Groups Explorer\\n\\nBuild Definitions / Multicontainer Build\\n\\nBuild\\n\\nOptions Repository Variables\\n\\n\\u2022 \", \"Save\\n\\n&gt; Undo\\n\\n+ Add build step...\\n\\nRun a specific service\\n\\nDocker Compose\\n\\nRun a specific service\", \"\\n\\nDocker Compose\\n\\nBuild services docter\\n\\ndocker\\n\\nDocker Compose\\n\\nPublish Test Results **/TEST-* xml\\n\", \"\\nLet Publish Test Results\\n\\nPush services docter Docker Compose\\n\\nWrite service image digests docter D\", \"ocker Compose\\n\\n\\u2022\\n\\nCombine configuration docter Docker Compose\\n\\nCopy Files to: $(Build.StagingDirecto\", \"ry)\\n\\nCopy Files\\n\\n1\\n\\nPublish Artifact: docker-compose\\n\\nPublish Build Artifacts\\n\\nFigure 5 -3. The Dock\", \"er CI pipeline in Azure DevOps Services including Build &amp; Release Templates and associated tasks\", \".\\n\\n<!-- image -->\\n\\nYou can use these templates and tasks to construct your CI/CD artifacts to Build \", \"/ Test and Deploy in Azure Service Fabric, Azure Kubernetes Service, and similar offerings.\\n\\nWith th\", \"ese Visual Studio Team Services tasks, a build Linux-Docker Host/VM provisioned in Azure and your pr\", \"eferred Docker registry (Azure Container Registry, Docker Hub, private Docker DTR, or any other Dock\", \"er registry) you can assemble your Docker CI pipeline in a very consistent way.\\n\\n## Requirements:\\n\\n-\", \" Azure DevOps Services, or for on-premises installations, Team Foundation Server 2015 Update 3 or la\", \"ter.\\n- An Azure DevOps Services agent that has the Docker binaries.\\n- An easy way to create one of t\", \"hese agents is to use Docker to run a container based on the Azure DevOps Services agent Docker imag\", \"e.\\n\\n## Tip\\n\\nTo read more about assembling an Azure DevOps Services Docker CI pipeline and view the w\", \"alkthroughs, visit these sites:\\n\\n- Running a Visual Studio Team Services (Now Azure DevOps Services)\", \" agent as a Docker container:\\n\\nhttps://hub.docker.com/\\\\_/microsoft-azure-pipelines-vsts-agent\\n\\nTrigg\", \"ers General\\n\\n| \\u2022   | Building .NET Linux Docker images with Azure DevOps Services: https://learn.mic\", \"rosoft.com/archive/blogs/stevelasker/building-net-core-linux-docker\\u0002 images-with-visual-studio-team-\", \"services                         |\\n|-----|----------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-------------------------------------------------------|\\n| \\u2022   | Building a Linux-based Visual Studi\", \"o Team Service build machine with Docker support: https://www.donovanbrown.com/post/Building-a-Linux\", \"-Based-Visual-Studio-Team-Service\\u0002 Build - Machine - with - Docker - Support |\\n\\n## Implement a CI pi\", \"peline with GitHub Actions\\n\\nGitHub Actions allow you to create automation scripts that can build Doc\", \"ker images, push Docker images to an authenticated Docker registry, run Docker images, or run other \", \"operations offered by the Docker CLI.\\n\\nYou can use public Actions (such as Azure Login) and run (she\", \"ll) commands to construct your CI/CD artifacts to Build / Test and Deploy in Azure Service Fabric, A\", \"zure Kubernetes Service, and similar offerings.\\n\\nWith these Actions, a build Linux-Docker Host/VM pr\", \"ovisioned in Azure and your preferred Docker registry (Azure Container Registry, Docker Hub, private\", \" Docker DTR, or any other Docker registry) you can assemble your Docker CI pipeline in a very consis\", \"tent way.\\n\\n## Integrate, test, and validate multi-container Docker applications\\n\\nTypically, most Doc\", \"ker applications are composed of multiple containers rather than a single container. A good example \", \"is a microservices-oriented application for which you would have one container per microservice. But\", \", even without strictly following the microservices approach patterns, it's probable that your Docke\", \"r application would be composed of multiple containers or services.\\n\\nTherefore, after building the a\", \"pplication containers in the CI pipeline, you also need to deploy, integrate, and test the applicati\", \"on as a whole with all of its containers within an integration Docker host or even into a test clust\", \"er to which your containers are distributed.\\n\\nIf you're using a single host, you can use Docker comm\", \"ands such as docker-compose to build and deploy related containers to test and validate the Docker e\", \"nvironment in a single VM. But, if you're working with an orchestrator cluster like DC/OS, Kubernete\", \"s, or Docker Swarm, you need to deploy your containers through a different mechanism or orchestrator\", \", depending on your selected cluster/scheduler.\\n\\nThe following are several types of tests that you c\", \"an run against Docker containers:\\n\\n- Unit tests for Docker containers\\n- Testing groups of interrelat\", \"ed applications or microservices\\n- Test in production and \\\"canary\\\" releases\\n\\nThe important point is \", \"that when running integration and functional tests, you must run those tests from outside of the con\", \"tainers. Tests are not contained or run in the containers you're deploying, because the containers a\", \"re based on static images that should be exactly like the ones you'll be deploying to production.\\n\\nA\", \" practical option when testing more advanced scenarios, like including several clusters (test cluste\", \"r, staging cluster, and production cluster) is to publish the images to a registry, so it can be tes\", \"ted in various clusters.\\n\\n## Push the custom application Docker image into your global Docker Regist\", \"ry\\n\\nAfter the Docker images have been tested and validated, you'll want to tag and publish them to y\", \"our Docker registry. The Docker registry is a critical piece in the Docker application life cycle be\", \"cause it's the central place where you store your custom test (also known as \\\"blessed images\\\") to be\", \" deployed into QA and production environments.\\n\\nSimilar to how the application code stored in your S\", \"CC repository (Git, etc.) is your \\\"source of truth,\\\" the Docker registry is your \\\"source of truth\\\" f\", \"or your binary application or bits to be deployed to the QA or production environments.\\n\\nTypically, \", \"you might want to have your private repositories for your custom images either in a private reposito\", \"ry in Azure Container Registry or in an on-premises registry like Docker Trusted Registry, or in a p\", \"ublic-cloud registry with restricted access (like Docker Hub), although in this last case if your co\", \"de is not open source, you must trust the vendor's security. Either way, the method you use is simil\", \"ar and is based on the docker push command, as shown in Figure 5-4.\\n\\n3\\n\\ndocker push\\n\\nFigure 5 -4. Pu\", \"blishing custom images to Docker Registry\\n\\n<!-- image -->\\n\\n* BikeSharing360\\n\\nv Home Code Build &amp;\", \" Release ... @\\n\\nBuilds\\n\\nReleases Task Groups Explorer\\n\\nBuild Definitions / Multicontainer Build\\n\\nBui\", \"ld\\n\\nOptions\\n\\n\\u2022 Save \\u00bb\\n\\n2 Undo\\n\\n+ Add build step...\\n\\nnot built\\n\\nSearch work items\\n\\n# Summary 37 Queue\", \" new build\\n\\n\\u2022 Security\\n\\nHelp\\n\\nIn step 3, for building integration and testing (CI) you might publish\", \" the resulting docker images to a private or public registry. There are multiple offerings of Docker\", \" registries from cloud vendors like Azure Container Registry, Amazon Web Services Container Registry\", \", Google Container Registry, GitHub Container Registry, Quay Registry, and so on.\\n\\nRun a specific se\", \"rvice\\n\\nManage O\\n\\nUsing the Docker tasks, you can push a set of service images defined by a docker-co\", \"mpose.yml file, with multiple tags, to an authenticated Docker registry (like Azure Container Regist\", \"ry), as shown in Figure 5-5. Files docter Docker Compose\\n\\nPublish Test Results **/TEST-* xml\\n\\nIt Pub\", \"lish Test Result\\n\\nPush services docker Docker Compose\\n\\ndy Write service image digests docker Docker \", \"Compose\\n\\n&amp; Cockbine configuration\\n\\nDocker Compose\\n\\nCopy Files to: $(Build.StagingDirectory)\\n\\nCop\", \"y Files\\n\\nPublish Artifact: docker-compose\\n\\nPublish Build Artifacts\\n\\nFigure 5 -5. Using Azure DevOps \", \"Services to publishing custom images to a Docker Registry\\n\\n<!-- image -->\\n\\n## Tip\\n\\nFor more informat\", \"ion about Azure Container Registry, see https://aka.ms/azurecontainerregistry .\\n\\n## Step 4: CD, Depl\", \"oy\\n\\nThe immutability of Docker images ensures a repeatable deployment with what's developed, tested \", \"through CI, and run in production. After you have the application Docker images published in your Do\", \"cker registry (either private or public), you can deploy them to the several environments that you m\", \"ight have (production, QA, staging, etc.) from your CD pipeline by using Azure DevOps Services pipel\", \"ine tasks, Azure DevOps Services Release Management or GitHub Actions.\\n\\nEnvironment Variables\\n\\nAzure\", \"\\n\\nContainer\\n\\nRegistry\\n\\nDocker\\n\\nRegistry\\n\\nQA\\n\\nHowever, at this point it depends on what kind of Docke\", \"r application you're deploying. Deploying a simple application (from a composition and deployment po\", \"int of view) like a monolithic application comprising a few containers or services and deployed to a\", \" few servers or VMs is different from deploying a more complex application like a microservices-orie\", \"nted application with hyperscale capabilities. These two scenarios are explained in the following se\", \"ctions.\\n\\n## Deploying composed Docker applications to multiple Docker environments\\n\\nLet's look first\", \" at the less -complex scenario: deploying to simple Docker hosts (VMs or servers) in a single enviro\", \"nment or multiple environments (QA, staging, and production). In this scenario, internally your CD p\", \"ipeline can use docker-compose (from your Azure DevOps Services deployment tasks) to deploy the Dock\", \"er applications with its related set of containers or services, as illustrated in Figure 5-6.\\n\\nFigur\", \"e 5 -6. Deploying application containers to simple Docker host environments registry\\n\\n<!-- image -->\", \"\\n\\nFigure 5-7 highlights how you can connect your build CI to QA/test environments via Azure DevOps S\", \"ervices by clicking Docker Compose in the Add Task dialog box. However, when deploying to staging or\", \" production environments, you would usually use Release Management features handling multiple enviro\", \"nments (like QA, staging, and production). If you're deploying to single Docker hosts, it is using t\", \"he Azure DevOps Services \\\"Docker Compose\\\" task (which is invoking the docker-compose up command unde\", \"r the hood). If you're deploying to Azure Kubernetes Service (AKS), it uses the Docker\\n\\n5\\n\\nRun, Mana\", \"ge\\n\\n* Team Services / DockerPoC\\n\\nHOME\\n\\nCODE WORK\\n\\nBUILD\\n\\nTES\\n\\nDefinitions\\n\\nExplorer\\n\\nBuild Definitio\", \"ns / Plain Build e\\n\\nBuild\\n\\nOptions\\n\\nRepository\\n\\nVariables\\n\\n\\u2022 Save\\n\\n2 Undo\\n\\n+ Add build ste....\\n\\nNuGe\", \"t restore **)*.sin\\n\\nNuGet instoller\\n\\nBuild solution **|*.sin\\n\\nVisual Studio Build\\n\\nTest Assemblies *\", \"*\\\\(BuildCc\\n\\nVisual Studio Test\\n\\nPublish symbols path:\\n\\nIndex Sources &amp; Publish Symbols\\n\\nCopy Fil\", \"es to: S(build.artifact\\n\\nCopy Files\\n\\nPublish Artifact: drop\\n\\nPublish Build Artifacts\\n\\nAdd tasks\\n\\nAll\", \"\\n\\nBuild\\n\\nUtility\\n\\nTest\\n\\nAzureni wed App wepioyment\\n\\nDeploy the web project to the AzureRM Web App us\", \"ing Web Deploy\\n\\nCreate Octopus Release\\n\\nCreate a Release in Octopus Deploy\\n\\nDeployment task, as expl\", \"ained in the section that follows. Similar steps can be built for deployment using GitHub Actions. A\", \"dd\\n\\nDocker Compose\\n\\nFigure 5 -7. Adding a Docker Compose task in an Azure DevOps Services pipeline o\", \"r GitHub workflow\\n\\n<!-- image -->\\n\\nWhen you create a release in Azure DevOps Services, it takes a se\", \"t of input artifacts. These artifacts are intended to be immutable for the lifetime of the release, \", \"across all environments. When you introduce containers, the input artifacts identify images in a reg\", \"istry to deploy. Depending on how these images are identified, they are not guaranteed to remain the\", \" same throughout the duration of the release, the most obvious case being when you reference myimage\", \":latest from a docker-compose file.\\n\\nThe Azure DevOps Services templates give you the ability to gen\", \"erate build artifacts that contain specific registry image digests that are guaranteed to uniquely i\", \"dentify the same image binary. These are what you really want to use as input to a release. You can \", \"invoke docker-compose in a run step inside GitHub Actions to accomplish the same goal.\\n\\n## Managing \", \"releases to Docker environments by using Azure DevOps Services Release Management or GitHub Actions\\n\", \"\\nThrough the Azure DevOps Services templates, you can build a new image, publish it to a Docker regi\", \"stry, run it on Linux or Windows hosts, and use commands such as docker-compose to deploy multiple c\", \"ontainers as an entire application, all through the Azure DevOps Services Release Management capabil\", \"ities intended for multiple environments, as shown in Figure 5-8.\\n\\nSearch\\n\\nAdd\\n\\nAdd\\n\\nDefinition: Mul\", \"ticontainer Docker Releases PoC \\u00d8 | Releases\\n\\nEnvironments\\n\\nArtifacts Variables Triggers General Ret\", \"ention History\\n\\nU Save 1 + Release =\\n\\n+ Add environme.....\\n\\n-\\n\\nProduction ACS... ***\\n\\n1/1 tasks enab\", \"led\\n\\nQA Test Docker e...**\\n\\n1 / 1 tasks enabled\\n\\n081 S\\n\\n+ Add tasks\\n\\nRun on agent\\n\\nDeploy to QA/Test\", \" with Docker-Compose up\\n\\nDocker Compose\\n\\nDeploy to QA/Test with Docker-Compose up /\\n\\nDocker Registry\", \" Connection\\n\\nBikeSharing Images Registry\\n\\nDocker Compose File\\n\\n<!-- image -->\\n\\n**/docker-compose.yml\", \"\\n\\nFigure 5 -8. Configuring Azure DevOps Services Docker Compose tasks from Azure DevOps Services Rel\", \"ease Management\\n\\nHowever, keep in mind that the scenario shown in Figure 5-6 and implemented in Figu\", \"re 5-8 is a simple one (it's deploying to single Docker hosts and VMs, and there will be a single co\", \"ntainer or instance per image) and probably should be used only for development or test scenarios. I\", \"n most enterprise production scenarios, you would want to have High Availability (HA) and easy-to-ma\", \"nage scalability by load balancing across multiple nodes, servers, and VMs, plus \\\"intelligent failov\", \"ers\\\" so if a server or node fails, its services and containers will be moved to another host server \", \"or VM. In that case, you need more advanced technologies such as container clusters, orchestrators, \", \"and schedulers. Thus, the way to deploy to those clusters is by handling the advanced scenarios expl\", \"ained in the next section.\\n\\nGitHub Actions can be used in the same manner, including the use of envi\", \"ronments for approvals.\\n\\n## Deploying Docker applications to Docker clusters\\n\\nThe nature of distribu\", \"ted applications requires compute resources that are also distributed. To have production-scale capa\", \"bilities, you need to have clustering capabilities that provide high scalability and high availabili\", \"ty based on pooled resources.\\n\\nYou could deploy containers manually to those clusters from a CLI too\", \"l or a web UI, but you should reserve that kind of manual work to spot deployment testing or managem\", \"ent purposes like scalingout or monitoring.\\n\\nFrom a CD point of view, you can use Azure DevOps Servi\", \"ces or GitHub Actions to run specially made deployment tasks from your environments that will deploy\", \" your containerized applications to distributed clusters in Container Service, as illustrated in Fig\", \"ure 5-9.\\n\\nAdd | Manage O\\n\\nAzure\\n\\nContainer\\n\\nRegistry\\n\\nDocker\\n\\nRegistry\\n\\nCD, Deploy\\n\\nQA\\n\\nFigure 5 -9.\", \" Deploying distributed applications to Container Service\\n\\n<!-- image -->\\n\\nInitially, when deploying \", \"to certain clusters or orchestrators, you would traditionally use specific deployment scripts and me\", \"chanisms per each orchestrator (that is, Kubernetes and Service Fabric have different deployment mec\", \"hanisms) instead of the simpler and easy-to-use docker-compose tool based on the docker -compose.yml\", \" definition file. However, thanks to the Azure DevOps Services Docker Deploy task, shown in Figure 5\", \"-10, now you can also deploy to the supported orchestrators by just using your familiar docker-compo\", \"se.yml file because the tool performs that \\\"translation\\\" for you (from your docker-compose.yml file \", \"to the format needed by the orchestrator).\\n\\n5\\n\\nRun, Manage\\n\\nAll pipelines \\u203a \\\"* New release pipeline\\n\", \"\\nAll pipelines \\u00bb *** New release pipeline\\n\\nPipeline\\n\\nPipeline\\n\\nTasks v\\n\\nVariables\\n\\nTasks V\\n\\nVariable\", \"s\\n\\nStage 1\\n\\nStage 1\\n\\nDeployment process\\n\\nDeployment process\\n\\nAgent job\\n\\nAgent job\\n\\n= Run on agent\\n\\n#\", \" Run on agent kubectl\\n\\nFo Deploy to Kubernetes\\n\\nHistory\\n\\nHistory\\n\\n...\\n\\nDeploy to Kubernetes O\\n\\nAdd t\", \"asks\\n\\n\\u00a9 Refresh\\n\\n\\u2014 Release V ..\\u2022\\n\\n\\u2022 Save + Release v ...\\n\\n\\u2022 View YAML W Remove\\n\\nFigure 5 -10. Adding\", \" the Deploy to Kubernetes task to your Environment\\n\\n<!-- image -->\\n\\nOutput V\\n\\nFigure 5-11 demonstrat\", \"es how you can edit the Deploy to Kubernetes task with the sections available for configuration. Thi\", \"s is the task that will retrieve your ready-to-use custom Docker images to be deployed as containers\", \" in the cluster.\\n\\nFigure 5 -11. Docker Deploy task definition deploying to ACS DC/OS\\n\\n<!-- image -->\", \"\\n\\nO kuber\\n\\nRetention Options\\n\\nRetention Options\\n\\n# Save\\n\\nX\\n\\n| Tip                                   \", \"                                          |\\n|-------------------------------------------------------\", \"--------------------------|\\n| To read more about the CD pipeline with Azure DevOps Services and Dock\", \"er, visit |\\n| https://azure.microsoft.com/services/devops/pipelines                           |\\n\\n## \", \"Tip\\n\\nTo see GitHub Actions workflows for CI, visit https://github.com/dotnetarchitecture/eShopOnCont\", \"ainers/wiki/GitHub-Actions. For a walkthrough of GitHub Actions performing deployment to an Azure Ku\", \"bernetes environment, visit https://github.com/dotnetarchitecture/eShopOnContainers/wiki/Deployment-\", \"With-GitHub-Actions .\\n\\n## Step 5: Run and manage\\n\\nBecause running and managing applications at enter\", \"prise-production level is a major subject in and of itself, and due to the type of operations and pe\", \"ople working at that level (IT operations) as well as the large scope of this area, the entire next \", \"chapter is devoted to explaining it.\\n\\n## Step 6: Monitor and diagnose\\n\\nThis topic also is covered in\", \" the next chapter as part of the tasks that IT performs in production systems; however, is important\", \" to highlight that the insights obtained in this step must feed back to the development team so that\", \" the application is constantly improved. From that point of view, it's also part of DevOps, although\", \" the tasks and operations are commonly performed by IT.\\n\\nOnly when monitoring and diagnostics are 10\", \"0% within the realm of DevOps are the monitoring processes and analytics performed by the developmen\", \"t team against testing or beta environments. This is done either by performing load testing or by mo\", \"nitoring beta or QA environments, where beta testers are trying the new versions.\\n\\n## Create CI/CD p\", \"ipelines in Azure DevOps Services for a .NET application on Containers and deploying to a Kubernetes\", \" cluster\\n\\nIn Figure 5-12 you can see the end-to-end DevOps scenario covering the code management, co\", \"de compilation, Docker images build, Docker images push to a Docker registry and finally the deploym\", \"ent to a Kubernetes cluster in Azure.\\n\\nScenario: Deploy to Kubernetes through CI/CD pipelines\\n\\nAZur\\n\", \"\\nContainer Service -\\n\\nKubernetes\\n\\nCode.\\n\\nrun, debug\\n\\n2.\\n\\nApplication code repo\\n\\n(SCC)\\n\\n<!-- image --\", \">\\n\\nCode\\n\\nPush git push\\n\\nInner loop\\n\\n1.\\n\\nDev environment\\n\\nFigure 5 -12. CI/CD scenario creating Docke\", \"r images and deploying to a Kubernetes cluster in Azure\\n\\nIt is important to highlight that the two p\", \"ipelines, build/CI, and release/CD, are connected through the Docker Registry (such as Docker Hub or\", \" Azure Container Registry). The Docker registry is one of the main differences compared to a traditi\", \"onal CI/CD process without Docker.\\n\\nAs shown in Figure 5-13, the first phase is the build/CI pipelin\", \"e. In Azure DevOps Services you can create build/CI pipelines that will compile the code, create the\", \" Docker images, and push them to a Docker Registry like Docker Hub or Azure Container Registry.\\n\\n3.\\n\", \"\\n4.\\n\\n## Build, CI CD, deploy\\n\\n\\u2022 ShopModernizing v Dashboards Code Work Build and Release Test Wiki W\", \"iki @\\n\\n\\u2022 ShopModerizing v Dashboards Code Work Build and Release Test Wik* Wik | @\\n\\nBuilds Releases \", \"Library Task Groups Deployment Groups*\\n\\nBuilds Releases Library Task Groups Deployment Groups*\\n\\n* Al\", \"l definitions &gt; eShopModernizingMVC-Kubernetes-PROD-ENV\\n\\nis ... &gt; eShopModernizingMVC\\n\\nPipelin\", \"e Tasks ~ Variables Retention Options History\\n\\nTasks\\n\\nVariables Triggers Options\\n\\nRetention History\\n\", \"\\nPROD eShopModernizing Kubernetes\\n\\nProcess\\n\\nDeploymant process\\n\\nBuild process\\n\\nAgent phase\\n\\n== Get s\", \"ources\\n\\nIE Run on agent\\n\\n\\u2022 dotnet-architecture/eShopModernizing\\n\\n$ Deploy SQl containe\\n\\nDeploy to Ku\", \"bernati\\n\\nPhase 1\\n\\nEE Run on agent\\n\\n\\u0e3f Deploy MVC app containe\\n\\nDeploy to Kubernet\\n\\nNuGet\\n\\n\\\" Nucet res\", \"tore\\n\\nDeploy to Kubarnates\\n\\nBuild images\\n\\nDocker Compose\\n\\nPush services\\n\\nDocker Compose\\n\\n...\\n\\nVersio\", \"n 0.-\\n\\nFigure 5 -13. Build/CI pipeline in Azure DevOps building Docker images and pushing images to \", \"a Docker registry\\n\\n<!-- image -->\\n\\nThe second phase is to create a deployment/release pipeline. In A\", \"zure DevOps Services, you can easily create a deployment pipeline targeting a Kubernetes cluster by \", \"using the Kubernetes tasks for Azure DevOps Services, as shown in Figure 5-14.\\n\\nFigure 5 -14. Releas\", \"e/CD pipeline in Azure DevOps Services deploying to a Kubernetes cluster\\n\\n<!-- image -->\\n\\n[!Walkthro\", \"ugh] Deploying eShopModernized to Kubernetes:\\n\\nDeploy to Kubernetes O\\n\\nSearch code in this project \\\"\", \" \\\" R $ '''\\n\\n\\u2022 Queue\\n\\n\\u2022 Save &amp; queue V&gt; Discard I Summary\\n\\nX Remove\\n\\nFor a detailed walkthroug\", \"h of Azure DevOps CI/CD pipelines deploying to Kubernetes, see this post: https://github.com/dotnet-\", \"architecture/eShopModernizing/wiki/04.-How-to-deploy-your-WindowsContainers -based -apps -into -Kube\", \"rnetes -in -Azure -Container -Service -(Including-CI-CD)\\n\\n## Run, manage, and monitor Docker product\", \"ion environments\\n\\nVision: Enterprise applications need to run with high availability and high scalab\", \"ility; IT operations need to be able to manage and monitor the environments and the applications the\", \"mselves.\\n\\nThis last pillar in the containerized Docker applications life cycle is centered on how yo\", \"u can run, manage, and monitor your applications in scalable, high availability (HA) production envi\", \"ronments.\\n\\nThe way you run your containerized applications in production (infrastructure architectur\", \"e and platform technologies) is very much related and based on the chosen architecture and developme\", \"nt platforms discussed in Chapter 1 of this e-book.\\n\\nThis chapter examines specific products and tec\", \"hnologies from Microsoft and other vendors that you can use to effectively run scalable, HA distribu\", \"ted applications plus how you can manage and monitor them from the IT perspective.\\n\\n## Run composed \", \"and microservices -based applications in production environments\\n\\nApplications composed by multiple \", \"microservices do need to be deployed into orchestrator clusters in order to simplify the complexity \", \"of deployment and make it viable from an IT point of view. Without an orchestrator cluster, it would\", \" be difficult to deploy and scale out a complex microservices application.\\n\\n## Introduction to orche\", \"strators, schedulers, and container clusters\\n\\nEarlier in this e -book, clusters and schedulers were \", \"introduced as part of the discussion on software architecture and development. Kubernetes and Servic\", \"e Fabric are examples of Docker clusters. Both of these orchestrators can run as a part of the infra\", \"structure provided by Microsoft Azure Kubernetes Service.\\n\\nWhen applications are scaled-out across m\", \"ultiple host systems, the ability to manage each host system and abstract away the complexity of the\", \" underlying platform becomes attractive. That's precisely what orchestrators and schedulers provide.\", \" Let's take a brief look at them here:\\n\\n- Schedulers . \\\"Scheduling\\\" refers to the ability for an adm\", \"inistrator to load a service file onto a host system that establishes how to run a specific containe\", \"r. Launching containers in a Docker cluster tends to be known as scheduling. Although scheduling ref\", \"ers to the specific act of loading the service definition, in a more general sense, schedulers are r\", \"esponsible for hooking into a host's init system to manage services in whatever capacity needed.\\n\\nA \", \"cluster scheduler has multiple goals: using the cluster's resources efficiently, working with user-s\", \"upplied placement constraints, scheduling applications rapidly to not leave them in a pending state,\", \" having a degree of \\\"fairness,\\\" being robust to errors, and always be available.\\n\\n- Orchestrators . \", \"Platforms extend life -cycle management capabilities to complex, multicontainer workloads deployed o\", \"n a cluster of hosts. By abstracting the host infrastructure, orchestration tools give users a way t\", \"o treat the entire cluster as a single deployment target.\\n\\nThe process of orchestration involves too\", \"ling and a platform that can automate all aspects of application management from initial placement o\", \"r deployment per container; moving containers to different hosts depending on its host's health or p\", \"erformance; versioning and rolling updates and health monitoring functions that support scaling and \", \"failover; and many more.\\n\\nOrchestration is a broad term that refers to container scheduling, cluster\", \" management, and possibly the provisioning of additional hosts.\\n\\nThe capabilities provided by orches\", \"trators and schedulers are complex to develop and create from scratch, therefore you usually would w\", \"ant to use orchestration solutions offered by vendors.\\n\\n## Manage production Docker environments\\n\\nCl\", \"uster management and orchestration is the process of controlling a group of hosts. This can involve \", \"adding and removing hosts from a cluster, getting information about the current state of hosts and c\", \"ontainers, and starting and stopping processes. Cluster management and orchestration are closely tie\", \"d to scheduling because the scheduler must have access to each host in the cluster in order to sched\", \"ule services. For this reason, the same tool is often used for both purposes.\\n\\n## Container Service \", \"and management tools\\n\\nContainer Service provides rapid deployment of popular open-source container c\", \"lustering and orchestration solutions. It uses Docker images to ensure that your application contain\", \"ers are fully portable. By using Container Service, you can deploy DC/OS (powered by Mesosphere and \", \"Apache Mesos) and Docker Swarm clusters with Azure Resource Manager templates or the Azure portal to\", \" ensure that you can scale these applications to thousands\\u2014even tens of thousands\\u2014of containers.\\n\\nYo\", \"u deploy these clusters by using Azure Virtual Machine Scale Sets, and the clusters take advantage o\", \"f Azure networking and storage offerings. To access Container Service, you need an Azure\\n\\nsubscripti\", \"on. With Container Service, you can take advantage of the enterprise-grade features of Azure while s\", \"till maintaining application portability, including at the orchestration layers.\\n\\nTable 6 -1 lists c\", \"ommon management tools related to their orchestrators, schedulers, and clustering platform.\\n\\nTable 6\", \" -1. Docker management tools\\n\\n| Management tools                                              | Desc\", \"ription                                                                                             \", \"                          | Related orchestrators                                                   \", \"         |\\n|---------------------------------------------------------------|------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-------|----------------------------------------------------------------------------------|\\n| Azure \", \"Monitor for Containers                                  | Azure dedicated  Kubernetes  management to\", \"ol                                                                                      | Azure Kube\", \"rnetes Services (AKS)                                                  |\\n| Kubernetes Web UI  (dashb\", \"oard)                                | Kubernetes  management tool,  can monitor and  manage local  \", \"Kubernetes cluster                                                   | Azure Kubernetes Service (AKS\", \") Local Kubernetes                                  |\\n| Azure portal for Service Fabric Azure Servic\", \"e Fabric Explorer | Online and desktop  version for managing  Service Fabric  clusters, on Azure, on\", \"  premises, local  development, and  other clouds | Azure Service Fabric                            \", \"                                 |\\n| Container Monitoring (Azure  Monitor)                         |\", \" General container  management y  monitoring solution.  Can manage  Kubernetes clusters  through Azu\", \"re  Monitor for  Containers .  | Azure Service Fabric Azure Kubernetes Service (AKS) Mesosphere DC/O\", \"S and others. |\\n\\n## Azure Service Fabric\\n\\nAnother choice for cluster -deployment and management is A\", \"zure Service Fabric. Service Fabric is a Microsoft microservices platform that includes container or\", \"chestration as well as developer programming models to build highly scalable microservices applicati\", \"ons. Service Fabric supports Docker in Linux and Windows Containers and can run in Windows and Linux\", \" servers.\\n\\nThe following are Service Fabric management tools:\\n\\n- Azure portal for Service Fabric clu\", \"ster-related operations (create/update/delete) a cluster or configure its infrastructure (VMs, load \", \"balancer, networking, etc.)\\n- Azure Service Fabric Explorer is a specialized web UI and desktop mult\", \"i-platform tool that provides insights and certain operations on the Service Fabric cluster, from th\", \"e nodes/VMs point of view and from the application and services point of view.\\n\\n## Monitor container\", \"ized application services\\n\\nIt's critical for applications split into multiple containers and microse\", \"rvices to have a way to monitor and analyze the behavior of the whole application.\\n\\n## Azure Monitor\", \"\\n\\nAzure Monitor is an extensible analytics service that monitors your live application. It helps you\", \" to detect and diagnose performance issues and to understand what users actually do with your app. I\", \"t's designed for developers, with the intent of helping you to continuously improve the performance \", \"and usability of your services or applications. Azure Monitor works with both web/services and stand\", \"alone apps on a wide variety of platforms like .NET, Java, Node.js and many other platforms, hosted \", \"onpremises or in the cloud .\\n\\n## Additional resources\\n\\n- Overview of Azure Monitor https://learn.mic\", \"rosoft.com/azure/azure-monitor/overview\\n- What is Application Insights? https://learn.microsoft.com/\", \"azure/azure-monitor/app/app-insights-overview\\n- What is Azure Monitor Metrics? https://learn.microso\", \"ft.com/azure/azure-monitor/platform/data-platform-metrics\\n- Container Monitoring solution in Azure M\", \"onitor https://learn.microsoft.com/azure/azure-monitor/insights/containers\\n\\n## Security and backup s\", \"ervices\\n\\nThere are many support chores with lots of details that you have to handle to ensure your a\", \"pplications and infrastructure are in top notch condition to support business needs, and the situati\", \"on becomes more complicated in the microservices realm, so you need a way to have both high-level an\", \"d detailed views when you need to take action.\\n\\nAzure has the tools to manage and provide a unified \", \"view of four critical aspects of both your cloud and on -premises resources:\\n\\n- Security. With Azure\", \" Security Center .\\n- \\u2013 Get full visibility and control over the security of your virtual machines, a\", \"pps, and workloads.\\n- \\u2013 Centralize the management of your security policies and integrate existing p\", \"rocesses and tools.\\n- \\u2013 Detect real threats with advanced analytics.\\n- Backup. With Azure Backup .\\n-\", \" \\u2013 Avoid costly business disruptions, meet compliance goals, and protect your data against ransomwar\", \"e and human errors.\\n- \\u2013 Keep your backup data encrypted in transit and at rest.\\n\\n- \\u2013 Ensure access b\", \"ased on multifactor authentication to prevent unauthorized use.\\n- On -premises resources. With hybri\", \"d cloud solutions .\\n\\n## Containerized Docker Application Lifecycle key takeaways\\n\\n- Container -based\", \" solutions provide important cost-saving benefits because containers solve deployment problems cause\", \"d by dependency failures in production environments, thereby improving DevOps and production operati\", \"ons significantly.\\n- Docker has become the de facto standard in the container industry and is suppor\", \"ted by the most significant vendors in the Linux and Windows ecosystems, including Microsoft. In the\", \" future, Docker will be ubiquitous in any datacenter in the cloud or on-premises.\\n- A Docker contain\", \"er is becoming the standard unit of deployment for any server-based application or service.\\n- Docker\", \" orchestrators like the ones provided in Azure Kubernetes Service (AKS) and Azure Service Fabric are\", \" fundamental and indispensable for any microservices-based or multicontainer applications that have \", \"significant complexity and scalability needs.\\n- An end -to -end DevOps environment that supports Con\", \"tinuous Integration/Continuous Deployment (CI/CD) and connects to the production Docker environments\", \" can provide agility and ultimately improve the time to market of your applications.\\n- Azure DevOps \", \"Services greatly simplifies your DevOps environment by deploying to Docker environments from your CI\", \"/CD pipelines. This statement applies to simple Docker environments as well as to advanced microserv\", \"ice and container orchestrators based on Azure.\"]"