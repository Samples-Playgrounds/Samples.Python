"[\"**EDITION v7.0**\\n\\n\\n[Refer changelog](https://aka.ms/modernize-ebook-changelog) for the book updates \", \"and community contributions.\\n\\n\\nPUBLISHED BY Microsoft Press and Microsoft DevDiv Divisions of Micros\", \"oft Corporation One\\nMicrosoft Way Redmond, Washington 98052-6399\\n\\n\\nCopyright \\u00a9 2023 by Microsoft Cor\", \"poration\\n\\n\\nAll rights reserved. No part of the contents of this book may be reproduced in any form o\", \"r by any\\nmeans without the written permission of the publisher.\\n\\n\\nThis book is available for free in\", \" the form of an electronic book (e-book) available through multiple\\n[channels at Microsoft such as h\", \"ttps://dot.net/architecture.](https://dot.net/architecture)\\n\\n\\n[If you have questions related to this\", \" book, email at dotnet-architecture-ebooks-](mailto:dotnet-architecture-ebooks-feedback@service.micr\", \"osoft.com?subject=Feedback%20for%20.NET%20Container%20&%20Microservices%20Architecture%20book)\\n[feed\", \"back@service.microsoft.com.](mailto:dotnet-architecture-ebooks-feedback@service.microsoft.com?subjec\", \"t=Feedback%20for%20.NET%20Container%20&%20Microservices%20Architecture%20book)\\n\\n\\nThis book is provid\", \"ed \\u201cas-is\\u201d and expresses the author\\u2019s views and opinions. The views, opinions, and\\ninformation expre\", \"ssed in this book, including URL and other Internet website references, may change\\nwithout notice.\\n\\n\", \"\\nSome examples depicted herein are provided for illustration only and are fictitious. No real associ\", \"ation\\nor connection is intended or should be inferred.\\n\\n\\n[Microsoft and the trademarks listed at htt\", \"ps://www.microsoft.com](https://www.microsoft.com/) on the \\u201cTrademarks\\u201d webpage are\\ntrademarks of th\", \"e Microsoft group of companies. All other marks are property of their respective\\nowners.\\n\\n\\nAuthor: >\", \" **Cesar de la Torre**, Sr. PM, .NET Product Team, Microsoft Corp.\\n\\n\\nParticipants and reviewers: > *\", \"*Scott Hunter**, Partner Director PM, .NET team, Microsoft > **Paul**\\n**Yuknewicz**, Principal PM Ma\", \"nager, Visual Studio Tools team, Microsoft > **Lisa Guthrie**, Sr. PM, Visual\\nStudio Tools team, Mic\", \"rosoft > **Ankit Asthana**, Principal PM Manager, .NET team, Microsoft > **Unai**\\n**Zorrilla**, Deve\", \"loper Lead, Plain Concepts > **Javier Valero**, Chief Operating Officer at Grupo Solutio >\\n**Steve S\", \"mith**, Architect, NimblePros\\n### Introduction\\n\\n\\nWhen you decide to modernize your web applications \", \"or services and move them to the cloud, you\\ndon\\u2019t necessarily have to fully rearchitect your apps. R\", \"earchitecting an application by using an\\nadvanced approach like microservices isn\\u2019t always an option\", \" because of cost and time restraints.\\nDepending on the type of application, rearchitecting an app al\", \"so might not be necessary. To optimize\\nthe cost-effectiveness of your organization\\u2019s cloud migration\", \" strategy, it\\u2019s important to consider the\\nneeds of your business and the requirements of your apps. \", \"You\\u2019ll need to determine:\\n\\n\\n  - Which apps require a transformation or rearchitecting.\\n\\n\\n  - Which a\", \"pps need to be only partially modernized.\\n\\n\\n  - Which apps you can \\u201clift and shift\\u201d directly to the \", \"cloud.\\n\\n\\n### About this guide\\n\\nThis guide focuses primarily on the initial modernization of existing\", \" Microsoft .NET Framework web or\\nservice-oriented applications, meaning the action of moving a workl\", \"oad to a newer or more modern\\nenvironment without significantly altering the application\\u2019s code and \", \"basic architecture.\\n\\n\\nThis guide also highlights the benefits of moving your apps to the cloud and p\", \"artially modernizing\\napps by using a specific set of new technologies and approaches, like Windows C\", \"ontainers and\\nrelated compute-platforms in Azure supporting Windows Containers.\\n### Path to the clou\", \"d for existing .NET applications\\n\\n\\nOrganizations typically choose to move to the cloud for the agili\", \"ty and speed they can get for their\\napplications. You can set up thousands of servers (VMs) in the c\", \"loud in minutes, compared to the\\nweeks it typically takes to set up on-premises servers.\\n\\n\\nThere isn\", \"\\u2019t a single, one-size-fits-all strategy for migrating applications to the cloud. The right\\nmigration\", \" strategy for you will depend on your organization\\u2019s needs and priorities, and the kind of\\napplicati\", \"ons you are migrating. Not all applications warrant the investment of moving to a platform as\\n[a ser\", \"vice (PaaS) model or developing a cloud-native](https://azure.microsoft.com/overview/what-is-paas/) \", \"application model. In many cases, you can take a\\nphased or incremental approach to invest in moving \", \"your assets to the cloud, based on your business\\nneeds.\\n\\n\\nFor modern applications with the best long\", \"-term agility and value for the organization, you might\\nbenefit from investing in _cloud-native_ app\", \"lication architectures. However, for applications that are\\nexisting or legacy assets, the key is to \", \"spend minimal time and money (no rearchitecting or code\\nchanges) while moving them to the cloud, to \", \"realize significant benefits.\\n\\n\\nFigure 1-1 shows the possible paths you can take when you move exist\", \"ing .NET applications to the\\ncloud in incremental phases.\\n\\n\\n_Figure 1-1. Modernization paths for exi\", \"sting .NET applications and services_\\n\\n\\nEach migration approach has different benefits and reasons f\", \"or using it. You can choose a single\\napproach when you migrate apps to the cloud, or choose certain \", \"components from multiple\\napproaches. Individual applications aren\\u2019t limited to a single approach or \", \"maturity state. For instance,\\na common hybrid approach would have certain on-premises components plu\", \"s other components in\\nthe cloud.\\n\\n\\nThe definition and short explanation for each application maturit\", \"y level are the following:\\n\\n\\n**Level 1: Cloud Infrastructure-Ready** applications: In this migration\", \" approach, you just migrate or\\n[rehost your current on-premises applications to an infrastructure as\", \" a service (IaaS) platform. Your](https://azure.microsoft.com/overview/what-is-iaas/)\\napps have almo\", \"st the same composition as before, but now you deploy them to VMs in the cloud.\\nThis simple type of \", \"migration is typically known in the industry as \\u201cLift & Shift.\\u201d\\n\\n\\n**Level 2: Cloud Optimized** appli\", \"cations: At this level and still without rearchitecting or altering\\nsignificant code, you can gain a\", \"dditional benefits from running your app in the cloud with modern\\ntechnologies like containers and a\", \"dditional cloud-managed services. You improve the agility of your\\napplications to ship faster by ref\", \"ining your enterprise development operations (DevOps) processes.\\nYou achieve this functionality by u\", \"sing technologies like Windows Containers, which is based on\\nDocker Engine. Containers remove the fr\", \"iction that\\u2019s caused by application dependencies when you\\ndeploy in multiple stages. In this maturit\", \"y model, you can deploy containers on IaaS or PaaS while\\nusing additional cloud-managed services rel\", \"ated to databases, cache as a service, monitoring, and\\ncontinuous integration/continuous deployment \", \"(CI/CD) pipelines.\\n\\n\\nThe third level of maturity is the ultimate goal in the cloud, but it\\u2019s optiona\", \"l for many apps and not the\\nmain focus of this guide:\\n\\n\\n**Level 3: Cloud-Native** applications: This\", \" migration approach typically is driven by business need and\\ntargets modernizing your mission-critic\", \"al applications. At this level, you use PaaS services to move\\n[your apps to PaaS computing platforms\", \". You implement cloud-native](https://www.gartner.com/doc/3181919/architect-design-cloudnative-appli\", \"cations) applications and microservices\\narchitecture to evolve applications with long-term agility, \", \"and to scale to new limits. This type of\\nmodernization usually requires architecting specifically fo\", \"r the cloud. New code often must be written,\\nespecially when you move to cloud-native application an\", \"d microservice-based models. This approach\\ncan help you gain benefits that are difficult to achieve \", \"in your monolithic and on-premises application\\nenvironment.\\n\\n\\nTable 1-1 describes the main benefits \", \"of and reasons for choosing each migration or modernization\\napproach.\\n\\n\\n\\n\\n\\n\\n\\n\\n|Cloud Infrastructure-\", \"Ready<br>Lift and shift|Cloud-Optimized<br>Modernize|Cloud-Native<br>Modernize, rearchitect, and<br>\", \"rewrite|\\n|---|---|---|\\n|**Application\\u2019s compute target**|||\\n|Applications deployed to VMs<br>in Azur\", \"e|Monolithic or N-Tier apps<br>deployed to Azure App Service,<br>Azure Container Instance (ACI),<br>\", \"VMs with containers, or AKS<br>(Azure Kubernetes Service)|Containerized microservices on<br>Azure Ku\", \"bernetes Service (AKS)<br>and/or serverless microservices<br>based on Azure Functions.|\\n|**Data targ\", \"et**|||\\n|SQL or any relational database<br>on a VM|Azure SQL Database Managed<br>Instance or another\", \" managed<br>database in the cloud.|Fined-grain databases per<br>microservice, based on Azure<br>SQL \", \"Database, Azure Cosmos<br>DB, or another managed<br>database in the cloud|\\n|**Advantages**|||\\n||||\\n|\", \"**Challenges**|||\\n||||\\n\\n\\n\\n**Table 1-1.** Benefits and challenges of modernization paths for existing\", \" .NET applications and services\\n\\n#### **Key technologies and architectures by maturity level**\\n\\n\\n.NE\", \"T Framework applications initially started with .NET Framework version 1.0, which was released in\\nla\", \"te 2001. Then, companies moved towards newer versions (such as 2.0, 3.5 and .NET Framework 4.x).\\nMos\", \"t of those applications ran on Windows Server and Internet Information Server (IIS), and used a\\nrela\", \"tional database, like SQL Server, Oracle, MySQL, or any other RDBMS.\\n\\n\\nMost existing .NET applicatio\", \"ns might nowadays be based on .NET Framework 4.x, or even on .NET\\nFramework 3.5, and use web framewo\", \"rks like ASP.NET MVC, ASP.NET Web Forms, ASP.NET Web API,\\nWindows Communication Foundation (WCF), AS\", \"P.NET SignalR, and ASP.NET Web Pages. These\\nestablished .NET Framework technologies depend on Window\", \"s. That dependency is important to\\n\\n\\nconsider if you are simply migrating legacy apps and you want t\", \"o make minimal changes to your\\napplication infrastructure.\\n\\n\\nFigure 1-2 shows the primary technologi\", \"es and architecture styles used at each of the three cloud\\nmaturity levels:\\n\\n\\n_Figure 1-2. Primary t\", \"echnologies for each maturity level for modernizing existing .NET web applications_\\n\\n\\nFigure 1-2 hig\", \"hlights the most common scenarios, but many hybrid and mixed variations are possible\\nwhen it comes t\", \"o architecture. For example, the maturity models apply not only to monolithic\\narchitectures in exist\", \"ing web apps, but also to service orientation, N-Tier, and other architecture style\\nvariations. The \", \"higher focus or percentage on one or another architecture type and related\\ntechnologies determines t\", \"he overall maturity level of your applications.\\n\\n\\nEach maturity level in the modernization process i\", \"s associated with the following key technologies and\\napproaches:\\n\\n\\n  - **Cloud Infrastructure-Ready*\", \"* (rehost or basic lift & shift): As a first step, many organizations\\nwant only to quickly execute a\", \" cloud-migration strategy. In this case, applications are\\n[rehosted. Most rehosting can be automated\", \" by using Azure Migrate, a service that provides](https://aka.ms/azuremigrate)\\nthe guidance, insight\", \"s, and mechanisms needed to assist you in migrating to Azure based on\\n[cloud tools like Azure Site R\", \"ecovery and Azure Database Migration Service. You can also set](https://azure.microsoft.com/services\", \"/site-recovery/)\\nup rehosting manually, so that you can learn infrastructure details about your asse\", \"ts when\\nyou move legacy apps to the cloud. For example, you can move your applications to VMs in\\nAzu\", \"re with little modification-probably with only minor configuration changes. The\\nnetworking in this c\", \"ase is similar to an on-premises environment, especially if you create\\nvirtual networks in Azure.\\n\\n\\n\", \"  - **Cloud-Optimized** (Managed Services and Windows Containers): This model is about making\\na few \", \"important deployment optimizations to gain some significant benefits from the cloud,\\n\\n\\nwithout chang\", \"ing the core architecture of the application. The fundamental step here is to\\n[add Windows Container\", \"s support to your existing .NET Framework applications. This](https://docs.microsoft.com/virtualizat\", \"ion/windowscontainers/about/)\\nimportant step (containerization) doesn\\u2019t require touching the code, s\", \"o the overall lift and\\n[shift effort is light. You can use tools like Image2Docker](https://github.c\", \"om/docker/communitytools-image2docker-win) or Visual Studio, with its tools for\\n[Docker. Visual Stud\", \"io automatically chooses smart defaults for ASP.NET applications and](https://www.docker.com/)\\nWindo\", \"ws Containers images. These tools offer both a rapid inner loop, and a fast path to get\\nthe containe\", \"rs to Azure. Your agility is improved when you deploy to multiple environments.\\n[Then, moving to pro\", \"duction, you can deploy your Windows Containers to Azure Web App for](https://azure.microsoft.com/se\", \"rvices/app-service/containers/)\\n[Containers,](https://azure.microsoft.com/services/app-service/conta\", \"iners/) [Azure Container Instances (ACI), and Azure VMs with Windows Server 2016 and](https://azure.\", \"microsoft.com/services/container-instances/)\\ncontainers if you prefer an IaaS approach. For more com\", \"plex multi-container applications,\\n[consider using orchestrators like Azure Kubernetes Service (AKS/\", \"ACS).](https://azure.microsoft.com/services/container-service/)\\n\\n\\nDuring this initial modernization,\", \" you can also add assets from the cloud, such as monitoring with\\n[tools like Azure Application Insig\", \"hts; CI/CD pipelines for your app lifecycles with Azure DevOps](https://docs.microsoft.com/azure/app\", \"lication-insights/app-insights-overview)\\n[Services; and many more data resource services that are av\", \"ailable in Azure. For instance, you can](https://azure.microsoft.com/services/devops/)\\n[modify a mon\", \"olithic web app that was originally developed by using traditional ASP.NET Web Forms](https://www.as\", \"p.net/web-forms)\\n[or ASP.NET MVC, but now you deploy it by using Windows Containers. When you use Wi\", \"ndows](https://www.asp.net/mvc)\\n[Containers, you should also migrate your data to a database in Azur\", \"e SQL Database Managed](https://docs.microsoft.com/azure/sql-database/)\\n[Instance, all without chang\", \"ing the core architecture of your application.](https://docs.microsoft.com/azure/sql-database/)\\n\\n\\n  \", \"- **Cloud-Native** [: As introduced, you should think about architecting cloud-native applications](\", \"https://www.gartner.com/doc/3181919/architect-design-cloudnative-applications)\\nwhen you are targetin\", \"g large and complex applications with multiple independent\\ndevelopment teams working on different mi\", \"croservices that can be developed and deployed\\nautonomously. Also, due to granularized and independe\", \"nt scalability per microservice. These\\narchitectural approaches face very important challenges and c\", \"omplexities but can be greatly\\n[simplified by using cloud PaaS and orchestrators like Azure Kubernet\", \"es Service (AKS/ACS)](https://azure.microsoft.com/services/container-service/)\\n[(managed Kubernetes)\", \", and Azure Functions](https://azure.microsoft.com/services/functions/) for a serverless approach. A\", \"ll these approaches\\n(like microservices and Serverless) typically require you to architect for the c\", \"loud and write\\nnew code\\u2014code that is adapted to specific PaaS platforms, or code that aligns with sp\", \"ecific\\narchitectures, like microservices.\\n\\n\\nFigure 1-3 shows the internal technologies that you can \", \"use for each maturity level:\\n\\n\\n_Figure 1-3. Internal technologies for each modernization maturity le\", \"vel_\\n### Lift and shift scenario\\n\\n\\nFor lift and shift migrations, keep in mind that you can use many\", \" different variations of lift and shift in\\nyour application scenarios. If you only rehost your appli\", \"cation, you might have a scenario like the one\\nshown in Figure 1-4, where you use VMs in the cloud o\", \"nly for your application and for your database\\nserver.\\n\\n\\n_Figure 1-4. Example of a pure IaaS scenari\", \"o in the cloud_\\n### Modernization scenarios\\n\\n\\nFor modernization scenarios, you might have a pure Clo\", \"ud-Optimized application that uses elements\\nonly from that maturity level. Or, you might have an int\", \"ermediate-state application with some\\nelements from Cloud Infrastructure-Ready and other elements fr\", \"om Cloud-Optimized (a \\u201cpick and\\nchoose\\u201d or mixed model), like in Figure 1-5.\\n\\n\\n_Figure 1-5. Example \", \"\\u201cpick and choose\\u201d scenario, with database on IaaS, DevOps, and containerization assets_\\n\\n\\nNext, as t\", \"he ideal scenario for many existing .NET Framework applications to migrate, you could\\nmigrate to a C\", \"loud-Optimized application, to get significant benefits from little work. This approach\\nalso sets yo\", \"u up for Cloud-Native as a possible future evolution. Figure 1-6 shows an example.\\n\\n\\n_Figure 1-6. Ex\", \"ample Cloud-Optimized apps scenario, with Windows Containers and managed services_\\n\\n\\nGoing even furt\", \"her, you could extend your existing Cloud-Optimized application by adding a few\\nmicroservices for sp\", \"ecific scenarios. This approach would move you partially to the level of CloudNative model, which is\", \" not the main focus of the present guidance.\\n### What this guide does not cover\\n\\n\\nThis guide covers \", \"a specific subset of the example scenarios, as shown in Figure 1-7. This guide\\nfocuses only on the l\", \"ift and shift scenarios, and ultimately, on the Cloud-Optimized model. In the\\nCloud-Optimized model,\", \" a .NET Framework application is modernized by using Windows Containers,\\nplus additional components \", \"like monitoring and CI/CD pipelines. Each component is fundamental to\\ndeploying applications to the \", \"cloud, faster, and with agility.\\n\\n\\n_Figure 1-7. Cloud-Native is not covered in this guide_\\n\\n\\nThe foc\", \"us of this guide is specific. It shows you the path you can take to achieve a lift and shift of your\", \"\\nexisting .NET applications, without rearchitecting, and with no code changes. Ultimately, it shows \", \"you\\nhow to make your application Cloud-Optimized.\\n\\n\\nThis guide doesn\\u2019t show you how to create Cloud-\", \"Native applications, such as how to evolve to a\\nmicroservices architecture. To rearchitect your appl\", \"ications or to create brand-new applications that\\n[are based on microservices, see the e-book .NET M\", \"icroservices: Architecture for containerized .NET](https://aka.ms/microservicesebook)\\n[applications.\", \"](https://aka.ms/microservicesebook)\\n#### **Additional resources**\\n\\n\\n  - **Containerized Docker appl\", \"ication lifecycle with Microsoft platform and tools**\\n(downloadable e-book)\\n[https://aka.ms/dockerli\", \"fecycleebook](https://aka.ms/dockerlifecycleebook)\\n\\n\\n  - **.NET Microservices: Architecture for cont\", \"ainerized .NET applications** (downloadable ebook)\\n[https://aka.ms/microservicesebook](https://aka.m\", \"s/microservicesebook)\\n\\n\\n  - **Architecting modern web applications with ASP.NET Core and Azure** (do\", \"wnloadable ebook)\\n[https://aka.ms/webappebook](https://aka.ms/webappebook)\\n### Who should use this g\", \"uide\\n\\n\\nThis guide was written for developers and solution architects who want to modernize existing\\n\", \"ASP.NET web applications or WCF services that are based on .NET Framework, for improved agility in\\ns\", \"hipping and releasing applications.\\n\\n\\nYou also might find this guide useful if you are a technical d\", \"ecision maker, such as an enterprise\\narchitect or a development lead/director who just wants an over\", \"view of the benefits that you can get\\nby using Windows Containers, and by deploying to the cloud whe\", \"n using Microsoft Azure.\\n### How to use this guide\\n\\n\\nThis guide addresses the \\u201cwhy\\u201d-why you might wa\", \"nt to modernize your existing applications, and the\\nspecific benefits you get from using Windows Con\", \"tainers when you move your apps to the cloud. The\\ncontent in the first few chapters of the guide is \", \"designed for architects and technical decision makers\\nwho want an overview, but who don\\u2019t need to fo\", \"cus on implementation and technical, step-by-step\\ndetails.\\n\\n\\nThe last chapter of this guide introduc\", \"es multiple walkthroughs that focus on specific deployment\\nscenarios. This guide offers shorter vers\", \"ions of the walkthroughs, to summarize the scenarios and\\nhighlight their benefits. The full walkthro\", \"ughs drill down into setup and implementation details, and\\n[are published as a set of wiki posts](ht\", \"tps://github.com/dotnet-architecture/eShopModernizing/wiki) [in the same public GitHub repo where re\", \"lated sample apps reside](https://github.com/dotnet-architecture/eShopModernizing)\\n(discussed in the\", \" next section). The last chapter and the step-by-step wiki walkthroughs on GitHub will\\nbe of more in\", \"terest to developers and architects who want to focus on implementation details.\\n### Sample apps for\", \" modernizing legacy apps: eShopModernizing\\n\\n\\n[The eShopModernizing](https://github.com/dotnet-archit\", \"ecture/eShopModernizing) repo on GitHub offers two sample applications that simulate legacy\\nmonolith\", \"ic web applications. One web app is developed by using ASP.NET MVC; the second web app\\nis developed \", \"by using ASP.NET Web Forms and the third app is an N-Tier app with a WinForms client\\ndesktop app con\", \"suming a WCF service backend. All these apps are based on the traditional .NET\\nFramework. These samp\", \"le apps don\\u2019t use .NET Core/.NET 7 or ASP.NET Core as they are supposed to\\nbe existing/legacy .NET F\", \"ramework applications to be modernized.\\n\\n\\nThese sample apps have a second version, with modernized c\", \"ode, and which are fairly straightforward.\\nThe most important difference between the app versions is\", \" that the second versions use Windows\\nContainers as the deployment choice. There also are a few addi\", \"tions to the second versions, like Azure\\nStorage Blobs for managing images, Azure Active Directory f\", \"or managing security, and Azure\\nApplication Insights for monitoring and auditing the applications.\\n\\n\", \"\\n## Contents\\n\\n**Lift and shift existing .NET apps to Azure IaaS (Cloud Infrastructure-Ready) .......\", \".......... 1**\\n\\n\\nWhy migrate existing .NET web applications to Azure IaaS ..........................\", \"......................................................... 2\\n\\n\\nWhen to migrate to IaaS instead of to \", \"PaaS ...............................................................................................\", \".................. 2\\n\\n\\nUse Azure Migrate to analyze and migrate your existing applications to Azure \", \"........................................... 2\\n\\n\\nUse Azure Site Recovery to migrate your existing VMs\", \" to Azure VMs .............................................................. 3\\n\\n\\nAdditional resource\", \"s ..................................................................................................\", \"........................................................ 4\\n\\n\\n**Migrate your relational databases to \", \"Azure ......................................................................... 6**\\n\\n\\nWhen to migrat\", \"e to Azure SQL Database Managed Instance ...........................................................\", \".................... 7\\n\\n\\nWhen to migrate to Azure SQL Database .....................................\", \"................................................................................. 8\\n\\n\\nWhen to move y\", \"our original RDBMS to a VM (IaaS) ..................................................................\", \"............................... 8\\n\\n\\nWhen to migrate to SQL Server as a VM (IaaS) ...................\", \"........................................................................................ 9\\n\\n\\nUse Azu\", \"re Database Migration Service to migrate your relational databases to Azure ........................\", \"..... 9\\n\\n\\nAdditional resources .....................................................................\", \"....................................................................................... 10\\n\\n\\n**Moder\", \"nize existing .NET apps to Cloud-Optimized applications .................................... 11**\\n\\n\\n\", \"Reasons to modernize existing .NET apps to Cloud-Optimized applications ............................\", \".................. 12\\n\\n\\nCloud-Optimized application principles and tenets ..........................\", \"................................................................ 12\\n\\n\\nBenefits of a Cloud-Optimized \", \"application ........................................................................................\", \"................... 14\\n\\n\\nMicrosoft technologies in cloud-optimized applications ....................\", \"................................................................. 14\\n\\n\\nMonolithic applications _can_\", \" be Cloud-Optimized ................................................................................\", \".............. 15\\n\\n\\nWhat about Cloud-Native applications? ..........................................\", \"........................................................................... 16\\n\\n\\nCloud-native applic\", \"ations details .....................................................................................\", \"......................................... 17\\n\\n\\nWhat about microservices? ...........................\", \"....................................................................................................\", \"........... 18\\n\\n\\nDeploy existing .NET apps as Windows containers ...................................\", \".............................................................. 19\\n\\n\\nWhat are containers? (Linux or W\", \"indows).............................................................................................\", \"................. 19\\n\\n\\nBenefits of containers (Docker Engine on Linux or Windows) ..................\", \"..................................................... 19\\n\\n\\nWhat is Docker? .........................\", \"....................................................................................................\", \"................................... 20\\n\\n\\nBenefits of Windows Containers for your existing .NET appli\", \"cations ......................................................... 21\\n\\n\\nChoose an OS to target with .\", \"NET-based containers ...............................................................................\", \"......... 22\\n\\n\\ni Contents\\n\\n\\nWindows container types ................................................\", \"............................................................................................. 23\\n\\n\\nT\", \"he container ecosystem in Azure ....................................................................\", \"........................................................ 24\\n\\n\\nWhen not to deploy to Windows Containe\", \"rs .................................................................................................\", \"........... 26\\n\\n\\nWhen to deploy Windows Containers in your on-premises IaaS VM infrastructure ......\", \"........................... 26\\n\\n\\nWhen to deploy Windows Containers to Azure VMs (IaaS cloud) .......\", \"............................................................. 26\\n\\n\\nWhen to deploy Windows Containers\", \" to Azure Container Instances (ACI) ................................................... 27\\n\\n\\nWhen to\", \" deploy Windows Containers to Azure Kubernetes Service (AKS) .......................................\", \"............ 28\\n\\n\\nChoosing Azure compute platforms for container-based applications ................\", \".......................................... 28\\n\\n\\nBuild resilient services ready for the cloud: Embrac\", \"e transient failures in the cloud................................. 29\\n\\n\\nHandling partial failure ...\", \"....................................................................................................\", \"........................................... 29\\n\\n\\nModernize your apps with monitoring and telemetry .\", \".......................................................................................... 31\\n\\n\\nMoni\", \"tor your application with Application Insights .....................................................\", \"...................................... 31\\n\\n\\nMonitor your Docker infrastructure with Log Analytics an\", \"d its Container Monitoring solution...... 32\\n\\n\\nModernize your app\\u2019s lifecycle with CI/CD pipelines a\", \"nd DevOps tools in the cloud .............................. 34\\n\\n\\nMigrate to hybrid cloud scenarios .\", \"....................................................................................................\", \"............................ 35\\n\\n\\nAzure Stack ......................................................\", \"....................................................................................................\", \"............... 35\\n\\n\\n**Walkthroughs and technical get started overview .............................\", \"............................... 38**\\n\\n\\nTechnical walkthrough list ..................................\", \"....................................................................................................\", \"........... 38\\n\\n\\nWalkthrough 1: Tour of eShop legacy apps ..........................................\", \"..................................................................... 39\\n\\n\\nTechnical walkthrough ava\", \"ilability ..........................................................................................\", \".................................. 39\\n\\n\\nOverview ...................................................\", \"....................................................................................................\", \"....................... 39\\n\\n\\nGoals .................................................................\", \"....................................................................................................\", \"................. 39\\n\\n\\nScenario 1: ASP.NET Web apps ................................................\", \".................................................................................. 39\\n\\n\\nScenario 2: \", \"WCF service and WinForms client app (3-Tier app) ...................................................\", \"................. 40\\n\\n\\nBenefits ....................................................................\", \"....................................................................................................\", \"......... 41\\n\\n\\nNext steps ..........................................................................\", \"................................................................................................. 41\", \"\\n\\n\\nWalkthrough 2: Containerize your existing .NET applications with Windows Containers .............\", \".......... 41\\n\\n\\nOverview ...........................................................................\", \"................................................................................................... \", \"41\\n\\n\\nGoals .........................................................................................\", \"............................................................................................. 41\\n\\n\\nS\", \"cenario 1: Containerized ASP.NET web apps ..........................................................\", \"............................................ 42\\n\\n\\nScenario 2: Containerized WCF service ............\", \"....................................................................................................\", \"... 42\\n\\n\\nBenefits ..................................................................................\", \"............................................................................................... 43\\n\\n\", \"\\nii Contents\\n\\n\\nNext steps ..........................................................................\", \"................................................................................................. 43\", \"\\n\\n\\nWalkthrough 3: Deploy your Windows Containers-based app to Azure VMs ............................\", \"................. 44\\n\\n\\nTechnical walkthrough availability ..........................................\", \".................................................................................. 44\\n\\n\\nOverview ...\", \"....................................................................................................\", \"....................................................................... 44\\n\\n\\nGoals .................\", \"....................................................................................................\", \"................................................................. 44\\n\\n\\nScenarios....................\", \"....................................................................................................\", \"...................................................... 44\\n\\n\\nAzure VMs for Windows Containers .......\", \"....................................................................................................\", \".............. 46\\n\\n\\nBenefits .......................................................................\", \"....................................................................................................\", \"...... 46\\n\\n\\nNext steps .............................................................................\", \".............................................................................................. 46\\n\\n\\n\", \"Walkthrough 4: Deploy your Windows Containers-based apps to Azure Container Instances (ACI) . 47\\n\\n\\nT\", \"echnical walkthrough availability ..................................................................\", \".......................................................... 47\\n\\n\\nOverview ...........................\", \"....................................................................................................\", \"............................................... 47\\n\\n\\nGoals .........................................\", \"....................................................................................................\", \"......................................... 47\\n\\n\\nScenarios............................................\", \"....................................................................................................\", \".............................. 47\\n\\n\\nBenefits .......................................................\", \"....................................................................................................\", \"...................... 47\\n\\n\\nConsiderations..........................................................\", \"....................................................................................................\", \"..... 48\\n\\n\\nNext steps ..............................................................................\", \"............................................................................................. 48\\n\\n\\nW\", \"alkthrough 5: Deploy your Windows Containers-based apps to Kubernetes in Azure Container\\nService ...\", \"....................................................................................................\", \"................................................................................ 48\\n\\n\\nTechnical walk\", \"through availability ...............................................................................\", \"............................................. 48\\n\\n\\nOverview ........................................\", \"....................................................................................................\", \".................................. 48\\n\\n\\nGoals ......................................................\", \"....................................................................................................\", \"............................ 49\\n\\n\\nScenarios.........................................................\", \"....................................................................................................\", \"................. 49\\n\\n\\nBenefits ....................................................................\", \"....................................................................................................\", \"......... 50\\n\\n\\nNext steps ..........................................................................\", \"................................................................................................. 51\", \"\\n\\n\\nWalkthrough 6: Deploy your Windows Containers-based apps to Azure App Service for Containers\\n....\", \"....................................................................................................\", \".............................................................................................. 51\\n\\n\\n\", \"Technical walkthrough availability .................................................................\", \"........................................................... 51\\n\\n\\nOverview ..........................\", \"....................................................................................................\", \"................................................ 51\\n\\n\\nGoals ........................................\", \"....................................................................................................\", \".......................................... 51\\n\\n\\nScenario ...........................................\", \"....................................................................................................\", \"................................ 52\\n\\n\\nBenefits .....................................................\", \"....................................................................................................\", \"........................ 52\\n\\n\\niii Contents\\n\\n\\nNext steps ............................................\", \"....................................................................................................\", \"........................... 52\\n\\n\\n**Conclusions .....................................................\", \"....................................................................... 53**\\n\\n\\niv Contents\\n\\n\\n**CHAPT\", \"ER**\\n# 1\\n\\n## Lift and shift existing .NET apps to Azure IaaS (Cloud Infrastructure-Ready)\\n\\n\\nVision: \", \"As a first step, to reduce your on-premises investment and total cost of hardware and\\nnetworking mai\", \"ntenance, simply rehost your existing applications in the cloud.\\n\\n\\nBefore getting into _how_ to migr\", \"ate your existing applications to the Azure infrastructure as a service\\n(IaaS) platform, it\\u2019s import\", \"ant to analyze the reasons _why_ you\\u2019d want to migrate directly to IaaS in\\nAzure. The scenario at th\", \"is modernization maturity level essentially is to start using VMs in the cloud,\\ninstead of continuin\", \"g to use your current, on-premises infrastructure.\\n\\n\\nAnother point to analyze is _why_ you might wan\", \"t to migrate to pure IaaS cloud instead of just adding\\nmore advanced managed services in Azure. Dete\", \"rmine what cases might require IaaS in the first place.\\n\\n\\nFigure 2-1 positions Cloud Infrastructure-\", \"Ready applications in the modernization maturity levels:\\n\\n\\n_Figure 2-1. Positioning Cloud Infrastruc\", \"ture-Ready applications_\\n\\n\\n1 CHAPTER 1 | Lift and shift existing .NET apps to Azure IaaS (Cloud Infr\", \"astructure-Ready)\\n\\n\\n### Why migrate existing .NET web applications to Azure IaaS\\n\\nThe main reason to\", \" migrate to the cloud, even at an initial IaaS level, is to achieve cost reductions. By\\nusing more m\", \"anaged infrastructure services, your organization can lower its investment in hardware\\nmaintenance, \", \"server or VM provisioning and deployment, and infrastructure management.\\n\\n\\nAfter you make the decisi\", \"on to move your apps to the cloud, the main reason why you might choose\\nIaaS instead of more advance\", \"d options like PaaS is simply that the IaaS environment will be more\\nfamiliar. Moving to an environm\", \"ent that\\u2019s similar to your current, on-premises environment offers a\\nlower learning curve, which mak\", \"es it the quickest path to the cloud.\\n\\n\\nHowever, taking the quickest path to the cloud doesn\\u2019t mean \", \"that you will gain the most benefit from\\nhaving your applications running in the cloud. Any organiza\", \"tion will gain the most significant benefits\\nfrom a cloud migration at the already introduced Cloud-\", \"Optimized and Cloud-Native maturity levels.\\n\\n\\nIt also has become evident that applications are easie\", \"r to modernize and rearchitect in the future\\nwhen they are already running in the cloud, even on Iaa\", \"S. Application data migration has already been\\nachieved. Also, your organization will have gained th\", \"e skills required for working in the cloud and\\nmade the shift to operating in a \\u201ccloud culture.\\u201d\\n\\n##\", \"# When to migrate to IaaS instead of to PaaS\\n\\n\\nThe next sections discuss Cloud-Optimized application\", \"s that are mostly based on PaaS platforms and\\nservices. These apps give you the most benefits from m\", \"igrating to the cloud.\\n\\n\\nIf your goal is simply to move existing applications to the cloud, first, i\", \"dentify existing applications that\\nwould not require substantial modification to run in Azure App Se\", \"rvice. These apps should be the first\\ncandidates for Cloud-Optimized.\\n\\n\\nThen, for the apps that stil\", \"l cannot move to Windows Containers and PaaS such as App Service or\\norchestrators like Azure Kuberne\", \"tes Service, migrate those apps to simple plain VMs (IaaS).\\n\\n\\nBut, keep in mind that correctly confi\", \"guring, securing, and maintaining VMs requires much more time\\nand IT expertise compared to using Paa\", \"S services in Azure. If you are considering Azure Virtual\\nMachines, make sure that you take into acc\", \"ount the ongoing maintenance effort required to patch,\\nupdate, and manage your VM environment. Azure\", \" Virtual Machines is IaaS.\\n\\n### Use Azure Migrate to analyze and migrate your existing applications \", \"to Azure\\n\\n\\nMigrating to the cloud doesn\\u2019t have to be difficult. But many organizations struggle to g\", \"et started - to\\nget deep visibility into the environment and the tight interdependencies between app\", \"lications,\\nworkloads, and data. Without that visibility, it can be difficult to plan the path forwar\", \"d. Without\\ndetailed information on what\\u2019s required for a successful migration, you can\\u2019t have the ri\", \"ght\\n\\n\\n2 CHAPTER 1 | Lift and shift existing .NET apps to Azure IaaS (Cloud Infrastructure-Ready)\\n\\n\\nc\", \"onversations within your organization. You don\\u2019t know enough about the potential cost benefits, or\\nw\", \"hether workloads could just lift-and-shift or would require significant rework to migrate successful\", \"ly.\\nNo wonder many organizations hesitate.\\n\\n\\n[Azure Migrate](https://aka.ms/azuremigrate) is a new s\", \"ervice that provides the guidance, insights, and mechanisms needed to assist\\nyou in migrating to Azu\", \"re. Azure Migrate provides:\\n\\n\\n  - Discovery and assessment for on-premises virtual machines\\n\\n\\n  - In\", \"built dependency mapping for high-confidence discovery of multi-tier applications\\n\\n\\n  - Intelligent \", \"right sizing to Azure virtual machines\\n\\n\\n  - Compatibility reporting with guidelines for remediating\", \" potential issues\\n\\n\\n  - Integration with Azure Database Management Service for database discovery an\", \"d migration\\n\\n\\nAzure Migrate gives you confidence that your workloads can migrate with minimal impact\", \" to the\\nbusiness and run as expected in Azure. With the right tools and guidance, you can achieve ma\", \"ximum\\nreturn on investment while assuring that critical performance and reliability needs are met.\\n\\n\", \"\\nFigure 2-2 shows you the built-in dependency mapping for all server and application connections\\nper\", \"formed by Azure Migrate.\\n\\n\\n_Figure 2-2. Positioning Cloud Infrastructure-Ready applications_\\n\\n### Us\", \"e Azure Site Recovery to migrate your existing VMs to Azure VMs\\n\\n\\n[As part of the end-to-end Azure M\", \"igrate,](https://aka.ms/azuremigrate) [Azure Site Recovery](https://docs.microsoft.com/azure/site-re\", \"covery/site-recovery-overview) is a tool that you can use to easily\\nmigrate your web apps to VMs in \", \"Azure. You can use Site Recovery to replicate on-premises VMs and\\nphysical servers to Azure, or to r\", \"eplicate them to a secondary on-premises location. You can even\\nreplicate a workload that\\u2019s running \", \"on a supported Azure VM, on an on-premises _Hyper-V_ VM, on a\\n_VMware_ VM, or on a Windows or Linux \", \"physical server. Replication to Azure eliminates the cost and\\ncomplexity of maintaining a secondary \", \"datacenter.\\n\\n\\n3 CHAPTER 1 | Lift and shift existing .NET apps to Azure IaaS (Cloud Infrastructure-Re\", \"ady)\\n\\n\\nSite Recovery is also made specifically for hybrid environments that are partly on-premises a\", \"nd partly\\non Azure. Site Recovery helps ensure business continuity by keeping your apps that are run\", \"ning on\\nVMs and on-premises physical servers available if a site goes down. It replicates workloads \", \"that are\\nrunning on VMs and physical servers so that they remain available in a secondary location i\", \"f the\\nprimary site isn\\u2019t available. It recovers workloads to the primary site when it\\u2019s up and runni\", \"ng again.\\n\\n\\nFigure 2-3 shows the execution of multiple VM migrations by using Azure Site Recovery.\\n\\n\", \"\\n_Figure 2-3. Positioning Cloud Infrastructure-Ready applications_\\n\\n#### **Additional resources**\\n\\n\\n\", \"  - **Azure Migrate Datasheet**\\n\\n\\n[https://aka.ms/azuremigration\\\\_datasheet](https://aka.ms/azuremig\", \"ration/_datasheet)\\n\\n\\n  - **Azure Migrate**\\n\\n\\n[https://aka.ms/azuremigrate](https://aka.ms/azuremigra\", \"te)\\n\\n\\n  - **Azure migration and modernization center**\\n\\n\\n[https://azure.microsoft.com/migration/](ht\", \"tps://azure.microsoft.com/migration/)\\n\\n\\n  - **Migrate to Azure with Site Recovery**\\n\\n\\n[https://learn\", \".microsoft.com/azure/site-recovery/site-recovery-migrate-to-azure](https://docs.microsoft.com/azure/\", \"site-recovery/site-recovery-migrate-to-azure)\\n\\n\\n  - **Azure Site Recovery service overview**\\n\\n\\n4 CHA\", \"PTER 1 | Lift and shift existing .NET apps to Azure IaaS (Cloud Infrastructure-Ready)\\n\\n\\n[https://lea\", \"rn.microsoft.com/azure/site-recovery/site-recovery-overview](https://docs.microsoft.com/azure/site-r\", \"ecovery/site-recovery-overview)\\n\\n\\n  - **Migrating VMs in AWS to Azure VMs**\\n\\n\\n[https://learn.microso\", \"ft.com/azure/site-recovery/site-recovery-migrate-aws-to-azure](https://docs.microsoft.com/azure/site\", \"-recovery/site-recovery-migrate-aws-to-azure)\\n\\n\\n5 CHAPTER 1 | Lift and shift existing .NET apps to A\", \"zure IaaS (Cloud Infrastructure-Ready)\\n\\n\\n**CHAPTER**\\n# 2\\n\\n## Migrate your relational databases to Az\", \"ure\\n\\n\\nVision: Azure offers the most comprehensive database migration.\\n\\n\\nIn Azure, you can migrate yo\", \"ur database servers directly to IaaS VMs (pure lift and shift), or you can\\nmigrate to Azure SQL Data\", \"base, for additional benefits. Azure SQL Database offers the managed\\ninstance and full database-as-a\", \"-service (DBaaS) options. Figure 3-1 shows the multiple relational\\ndatabase migration paths availabl\", \"e in Azure.\\n\\n\\n_Figure 3-1. Database migration paths in Azure_\\n\\n\\n6 CHAPTER 2 | Migrate your relationa\", \"l databases to Azure\\n\\n\\n### When to migrate to Azure SQL Database Managed Instance\\n\\nIn most cases, Az\", \"ure SQL Database Managed Instance will be your best option to consider when you\\nmigrate your data to\", \" Azure. If you are migrating SQL Server databases and need nearly 100%\\nassurance that you won\\u2019t need\", \" to rearchitect your application or make changes to your data or data\\naccess code, choose the Manage\", \"d Instance feature of Azure SQL Database.\\n\\n\\nAzure SQL Database Managed Instance is the best option i\", \"f you have additional requirements for SQL\\nServer instance-level functionality, or isolation require\", \"ments beyond the features provided in a\\nstandard Azure SQL Database (single database model). This la\", \"st one is the most PaaS-oriented choice,\\nbut it doesn\\u2019t offer the same features as that of a traditi\", \"onal SQL server. Migration might surface\\nfrictions.\\n\\n\\nFor example, an organization that has made dee\", \"p investments in instance-level SQL Server capabilities\\nwould benefit from migrating to SQL Managed \", \"Instance. Examples of instance-level SQL Server\\ncapabilities include SQL common language runtime (CL\", \"R) integration, SQL Server Agent, and crossdatabase querying. Support for these features is not avai\", \"lable in standard Azure SQL Database (a\\nsingle-database model).\\n\\n\\nAn organization that operates in a\", \" highly regulated industry, and which needs to maintain isolation for\\nsecurity purposes, also might \", \"benefit from choosing the SQL Managed Instance model.\\n\\n\\nManaged Instance in Azure SQL Database has t\", \"he following characteristics:\\n\\n\\n  - Security isolation through Azure Virtual Network\\n\\n\\n  - Applicati\", \"on surface compatibility, with these features:\\n\\n\\n     - SQL Server Agent and SQL Server Profiler\\n\\n\\n \", \"    - Cross-database references and queries, SQL CLR, replication, change data capture\\n(CDC), and Se\", \"rvice Broker\\n\\n\\n  - Database sizes up to 35 TB\\n\\n\\n  - Minimum-downtime migration, with these features:\", \"\\n\\n\\n     - Azure Database Migration Service\\n\\n\\n     - Native backup and restore, and log shipping\\n\\n\\nWi\", \"th these capabilities, when you migrate existing application databases to Azure SQL Database, the\\nMa\", \"naged Instance model offers nearly 100% of the benefits of PaaS for SQL Server. Managed Instance\\nis \", \"a SQL Server environment where you continue using instance-level capabilities without changing\\nyour \", \"application design.\\n\\n\\nManaged Instance is probably the best fit for enterprises that currently are u\", \"sing SQL Server, and\\nwhich require flexibility in their network security in the cloud. It\\u2019s like hav\", \"ing a private virtual network\\nfor your SQL databases.\\n\\n\\n7 CHAPTER 2 | Migrate your relational databa\", \"ses to Azure\\n\\n\\n### When to migrate to Azure SQL Database\\n\\nAs mentioned, the standard Azure SQL Datab\", \"ase is a fully managed, relational DBaaS. SQL Database\\ncurrently manages millions of production data\", \"bases, across 38 datacenters, around the world. It\\nsupports a broad range of applications and worklo\", \"ads, from managing straightforward transactional\\ndata, to driving the most data-intensive, mission-c\", \"ritical applications that require advanced data\\nprocessing at a global scale.\\n\\n\\nBecause of its full \", \"PaaS features, better pricing-and ultimately lower cost-you should move to the\\nstandard Azure SQL Da\", \"tabase as your \\u201cby-default choice\\u201d if you have an application that uses basic,\\nstandard SQL database\", \"s, and no additional instance features. SQL Server features like SQL CLR\\nintegration, SQL Server Age\", \"nt, and cross-database querying are not supported in the standard Azure\\nSQL Database. Those features\", \" are available only in the Azure SQL Database Managed Instance model.\\n\\n\\nAzure SQL Database is the on\", \"ly intelligent cloud database service that\\u2019s built for app developers. It\\u2019s\\nalso the only cloud data\", \"base service that scales on-the-fly, without downtime, to help you efficiently\\ndeliver multitenant a\", \"pps. Ultimately, Azure SQL Database leaves you more time to innovate, and it\\naccelerates your time t\", \"o market. You can build secure apps and connect to your SQL database by\\nusing the languages and plat\", \"forms that you prefer.\\n\\n\\nAzure SQL Database offers the following benefits:\\n\\n\\n  - Built-in intelligen\", \"ce (machine learning) that learns and adapts to your app\\n\\n\\n  - On-demand database provisioning\\n\\n\\n  -\", \" A range of offers, for all workloads\\n\\n\\n  - 99.99% availability SLA, zero maintenance\\n\\n\\n  - Geo-repl\", \"ication and restore services for data protection\\n\\n\\n  - Azure SQL Database Point in Time Restore feat\", \"ure\\n\\n\\n  - Compatibility with SQL Server 2016, including hybrid and migration\\n\\n\\nThe standard Azure SQ\", \"L Database is closer to PaaS than Azure SQL Database Managed Instance.\\nPrefer the standard Azure SQL\", \" Database because you\\u2019ll get more benefits from a managed cloud.\\nHowever, Azure SQL Database has som\", \"e key differences from regular and on-premises SQL Server\\ninstances. Depending on your existing appl\", \"ication\\u2019s database requirements, and your enterprise\\nrequirements and policies, it might not be the \", \"best choice when you are planning your migration to\\nthe cloud.\\n\\n### When to move your original RDBMS\", \" to a VM (IaaS)\\n\\n\\nOne of your migration options is to move your original relational database managem\", \"ent system\\n(RDBMS), including Oracle, IBM DB2, MySQL, PostgreSQL, or SQL Server, to a similar server\", \" that\\u2019s\\nrunning on an Azure VM. If you have existing applications that require the fastest migration\", \" to the\\ncloud with minimal changes, or no changes at all, a direct migration to IaaS in the cloud mi\", \"ght be a\\n\\n\\n8 CHAPTER 2 | Migrate your relational databases to Azure\\n\\n\\nfair option. It might not be t\", \"he best way to take advantage of all the cloud\\u2019s benefits, but it\\u2019s probably\\nthe fastest initial pat\", \"h.\\n\\n\\n[Currently, Microsoft Azure supports up to 331 different database servers](https://azuremarketp\", \"lace.microsoft.com/marketplace/apps/category/databases?page=1&subcategories=databases-all) deployed \", \"as IaaS VMs. These\\ninclude popular RDBMS like SQL Server, Oracle, MySQL, PostgreSQL, and IBM DB2, an\", \"d many other\\nNoSQL databases like MongoDB, Cassandra, DataStax, MariaDB, and Cloudera.\\n\\n\\n\\n\\n### When \", \"to migrate to SQL Server as a VM (IaaS)\\n\\nThere might be a few cases where you still need to migrate \", \"to SQL Server as a regular VM. An\\nexample scenario is if you need to use SQL Server Reporting Servic\", \"es. In most cases, though, Azure\\nSQL Database Managed Instance can provide everything you need to mi\", \"grate from on-premises SQL\\nservers, so migration to a SQL Server VM should be your last resort to tr\", \"y.\\n\\n### Use Azure Database Migration Service to migrate your relational databases to Azure\\n\\n\\nYou can\", \" use Azure Database Migration Service to migrate relational databases like SQL Server, and\\nMySQL to \", \"Azure, whether your target database is Azure SQL Database, Azure SQL Database Managed\\nInstance, or S\", \"QL Server on an Azure VM.\\n\\n\\nThe automated workflow, with assessment reporting, guides you through th\", \"e changes you need to\\nmake before you migrate the database. When you are ready, the service migrates\", \" the source database\\nto Azure.\\n\\n\\nWhenever you change an original RDBMS, you might need to retest. Yo\", \"u also might need to change\\nthe SQL sentences or Object-Relational Mapping (ORM) code in your applic\", \"ation, depending on\\ntesting results.\\n\\n\\nIf you have any other database (for example, IBM DB2) and you\", \" opt for a lift and shift approach, you\\nmight want to continue using those databases as IaaS VMs in \", \"Azure, unless you are willing to perform\\na more complex data migration. A more complex data migratio\", \"n will require additional effort because\\nyou\\u2019d be migrating to a different database type with the ne\", \"w schema and different programming\\nlibraries.\\n\\n\\n9 CHAPTER 2 | Migrate your relational databases to A\", \"zure\\n\\n\\n### Additional resources\\n\\n\\n  - **Choose a cloud SQL Server option: Azure SQL Database (PaaS) \", \"or SQL Server on Azure**\\n**VM (IaaS)**\\n\\n\\n[https://learn.microsoft.com/azure/sql-database/sql-databas\", \"e-paas-vs-sql-server-iaas](https://docs.microsoft.com/azure/sql-database/sql-database-paas-vs-sql-se\", \"rver-iaas)\\n\\n\\n  - **SQL Server database migration to SQL Database in the cloud**\\n\\n\\n[https://learn.mic\", \"rosoft.com/azure/sql-database/sql-database-cloud-migrate](https://docs.microsoft.com/azure/sql-datab\", \"ase/sql-database-cloud-migrate)\\n\\n\\n  - **Azure SQL Database**\\n\\n\\n[https://azure.microsoft.com/services\", \"/sql-database/?v=16.50](https://azure.microsoft.com/services/sql-database/?v=16.50)\\n\\n\\n  - **SQL Serv\", \"er on virtual machines**\\n\\n\\n[https://azure.microsoft.com/services/virtual-machines/sql-server/](https\", \"://azure.microsoft.com/services/virtual-machines/sql-server/)\\n\\n\\n10 CHAPTER 2 | Migrate your relation\", \"al databases to Azure\\n\\n\\n**CHAPTER**\\n# 3\\n\\n## Modernize existing .NET apps to Cloud-Optimized applicat\", \"ions\\n\\n\\nVision: Modernize your existing .NET Framework applications to Cloud-Optimized applications t\", \"o\\ndrastically improve your deployment agility, so you can ship faster and lower application\\u2019s delive\", \"ry\\ncosts.\\n\\n\\nTo take advantage of the benefits of the cloud and new technologies like containers, you\", \" should at\\nleast partially modernize your existing .NET applications. Ultimately, modernizing your e\", \"nterprise\\napplications will lower your total cost of ownership.\\n\\n\\nPartially modernizing an app doesn\", \"\\u2019t necessarily mean a full migration and rearchitecture. You can\\ninitially modernize your existing a\", \"pplications with important but easy to do modernization. You can\\nmaintain your current code base, wr\", \"itten in existing .NET Framework versions, with any Windows and\\nIIS dependencies. Figure 4-1 highlig\", \"hts how Cloud-Optimized apps are positioned in Azure\\napplication modernization maturity models.\\n\\n\\n_F\", \"igure 4-1. Positioning Cloud-Optimized applications_\\n\\n\\n11 CHAPTER 3 | Modernize existing .NET apps t\", \"o Cloud-Optimized applications\\n\\n\\n### Reasons to modernize existing .NET apps to Cloud- Optimized app\", \"lications\\n\\nWith a Cloud-Optimized application, you can rapidly and repeatedly deliver reliable appli\", \"cations to\\nyour customers. You gain essential agility and reliability by deferring much of the opera\", \"tional\\ncomplexity of your app to the platform.\\n\\n\\nIf you can\\u2019t get your applications to market quickl\", \"y, by the time you ship your app, the market you\\nwere targeting will have evolved. You might be too \", \"late, no matter how well the application was\\narchitected or engineered. You might be failing or not \", \"reaching your full potential because you can\\u2019t\\nsync app delivery with the needs of the market.\\n\\n\\nThe\", \" need for continuous business innovation pushes development and operations teams to the limit.\\nThe o\", \"nly way to achieve the agility you need in continuous business innovation is by modernizing\\nyour app\", \"lications with technologies like containers and specific Cloud-Optimized application\\nprinciples.\\n\\n\\nT\", \"he bottom line is that when an organization builds and manages applications that are CloudOptimized,\", \" it can put solutions in the hands of customers sooner and bring new ideas to market when\\nthey are r\", \"elevant.\\n\\n#### **Cloud-Optimized application principles and tenets**\\n\\n\\nImprovements in the cloud are\", \" mostly focused on meeting two goals: Reduce costs and improve\\nbusiness growth by improving agility.\", \" These goals are achieved by simplifying processes and reducing\\nfriction when you release and ship a\", \"pplications.\\n\\n\\nYour application is Cloud-Optimized if you can-in an agile manner-develop your app au\", \"tonomously\\nfrom other on-premises apps, and then release, deploy, autoscale, monitor, and troublesho\", \"ot your\\napp in the cloud.\\n\\n\\nThe key is _agility_ . You can\\u2019t ship with agility unless you reduce to \", \"an absolute minimum any\\ndeployment-to-production issues and dev/test environment issues. Containers \", \"(specifically, Docker, as\\na de facto standard) and managed services were designed specifically for t\", \"his purpose.\\n\\n\\nTo achieve agility, you also need automated DevOps processes that are based on CI/CD \", \"pipelines that\\nrelease to scalable platforms in the cloud. CI/CD platforms (like Azure DevOps Servic\", \"es or Jenkins) that\\ndeploy to a scalable and resilient cloud platform (like Azure App Service or Azu\", \"re Kubernetes Service)\\nare key technologies for achieving agility in the cloud.\\n\\n\\nThe following list\", \" describes the main tenets or practices for Cloud-Optimized applications. Note that\\nyou can adopt al\", \"l or only some of these principles, in a progressive or incremental approach:\\n\\n\\n  - **Containers** .\", \" Containers give you the ability to include application dependencies with the\\napplication itself. Co\", \"ntainerization significantly reduces the number of issues you might\\nencounter when you deploy to pro\", \"duction environments or test in staging environments.\\nUltimately, containers improve the agility of \", \"application delivery.\\n\\n\\n12 CHAPTER 3 | Modernize existing .NET apps to Cloud-Optimized applications\\n\", \"\\n\\n  - **Resilient and scalable cloud** . The cloud provides a platform that is managed, elastic,\\nsca\", \"lable, and resilient. These characteristics are fundamental to gain cost improvements and\\nship highl\", \"y available and reliable applications in a continuous delivery. Managed services like\\nmanaged databa\", \"ses, managed cache as a service (CaaS), and managed storage are\\nfundamental pieces in alleviating th\", \"e maintenance costs of your application.\\n\\n\\n  - **Monitoring** . You can\\u2019t have a reliable applicatio\", \"n without having a good way to detect and\\ndiagnose exceptions and application performance issues. Yo\", \"u need to get actionable insights\\nthrough application performance management and instant analytics.\\n\", \"\\n\\n  - **DevOps culture and continuous delivery** . Adopting DevOps practices requires a cultural\\ncha\", \"nge in which teams no longer work in independent silos. CI/CD pipelines are possible only\\nwhen there\", \" is an increased collaboration between development and IT operations teams,\\nsupported by containers \", \"and CI/CD tools.\\n\\n\\nFigure 4-2 shows the main optional pillars of a Cloud-Optimized application. The \", \"more pillars you\\nimplement, the readier your application will be to succeed in meeting your customer\", \"s\\u2019 expectations.\\n\\n\\n_Figure 4-2. Main pillars of a Cloud-Optimized application_\\n\\n\\nTo summarize, a Clo\", \"ud-Optimized application is an approach to building and managing applications\\nthat takes advantage o\", \"f the cloud computing model, while using a combination of containers,\\nmanaged cloud infrastructure, \", \"resilient application techniques, monitoring, continuous delivery, and\\nDevOps, all without the need \", \"to rearchitect and recode your existing applications.\\n\\n\\nYour organization can adopt these technologi\", \"es and approaches gradually. You don\\u2019t have to\\nembrace all of them, all at once. You can adopt them \", \"incrementally, depending on enterprise priorities\\nand user needs.\\n\\n\\n13 CHAPTER 3 | Modernize existin\", \"g .NET apps to Cloud-Optimized applications\\n\\n\\n#### **Benefits of a Cloud-Optimized application**\\n\\nYo\", \"u can get the following benefits by converting an existing application to a Cloud-Optimized\\napplicat\", \"ion (without rearchitecting or coding):\\n\\n\\n  - **Lower costs, because the managed infrastructure is h\", \"andled by the cloud provider** .\\nCloud-Optimized applications get the benefits of the cloud by using\", \" the cloud\\u2019s out-of-thebox elasticity, autoscale, and high availability. Benefits are related not on\", \"ly to the compute\\nfeatures (VMs and containers), but also depend on the resources in the cloud, like\", \" DBaaS,\\nCaaS, and any infrastructure an application might needed.\\n\\n\\n  - **Resilient application and \", \"infrastructure** . When you migrate to the cloud, you need to\\nembrace transient failures; failures w\", \"ill occur in the cloud. Also, cloud infrastructure and\\nhardware are \\u201creplaceable,\\u201d which increases o\", \"pportunities for transient downtime. At the\\nsame time, inner cloud capabilities and certain applicat\", \"ion development techniques that\\nimplement resiliency and automate recovery make it much easier to re\", \"cover from unexpected\\nfailures in the cloud.\\n\\n\\n  - **Deeper insights into application performance** \", \". Cloud monitoring tools like Azure\\nApplication Insights provide visualization for health management\", \", logging, and notifications.\\nAudit logs make applications easy to debug and audit, fundamental for \", \"a reliable cloud\\napplication.\\n\\n\\n  - **Application portability, with agile deployments** . Containers\", \" (either Linux or Windows\\ncontainers based on Docker Engine) offer the best solution to avoiding a c\", \"loud-locked\\napplication. By using containers, Docker hosts, and multi-cloud orchestrators, you can e\", \"asily\\nmove from one environment or cloud to another. Containers eliminate the friction that\\ntypicall\", \"y occurs in deployments to any environment (stage/test/production).\\n\\n\\nAll of these benefits ultimate\", \"ly provide key cost reductions for your end-to-end application lifecycle.\\n\\n\\nIn the following section\", \"s, these benefits are explained in more detail, and are linked to specific\\ntechnologies.\\n\\n### Micros\", \"oft technologies in cloud-optimized applications\\n\\n\\nThe following list describes the tools, technolog\", \"ies, and solutions that are recognized as requirements\\nfor Cloud-Optimized apps. You can adopt Cloud\", \"-Optimized elements selectively or gradually,\\ndepending on your priorities.\\n\\n\\n  - **Cloud infrastruc\", \"ture** : The infrastructure that provides the compute platform, operating\\nsystem, network, and stora\", \"ge. Microsoft Azure is positioned at this level.\\n\\n\\n  - **Runtime** : This layer provides the environ\", \"ment for the application to run. If you are using\\n[containers, this layer usually is based on Docker\", \" Engine, running either on Linux hosts or on](https://docs.docker.com/engine/)\\n[Windows hosts. (Wind\", \"ows Containers](https://docs.microsoft.com/virtualization/windowscontainers/about/) are supported be\", \"ginning with Windows Server 2016.\\n\\n\\n14 CHAPTER 3 | Modernize existing .NET apps to Cloud-Optimized a\", \"pplications\\n\\n\\nWindows Containers is the best choice for existing .NET Framework applications that ru\", \"n on\\nWindows.)\\n\\n\\n  - **Managed cloud** : When you choose a managed cloud option, you can avoid the e\", \"xpense and\\ncomplexity of managing and supporting the underlying infrastructure, VMs, OS patches, and\", \"\\nnetworking configuration. If you choose to migrate by using IaaS, you are responsible for all\\nof th\", \"ese tasks, and for associated costs. In a managed cloud option, you manage only the\\napplications and\", \" services that you develop. The cloud service provider typically manages\\n[everything else. Examples \", \"of managed cloud services in Azure include Azure SQL Database,](https://azure.microsoft.com/services\", \"/sql-database)\\n[Azure Redis Cache, Azure Cosmos DB,](https://azure.microsoft.com/services/cache/) [A\", \"zure Storage,](https://azure.microsoft.com/services/storage/) [Azure Database for MySQL, Azure](http\", \"s://azure.microsoft.com/services/mysql/)\\n[Database for PostgreSQL, Azure Active Directory, and manag\", \"ed compute services like VM](https://azure.microsoft.com/services/postgresql/)\\n[scale sets,](https:/\", \"/azure.microsoft.com/services/virtual-machine-scale-sets/) [Azure App Service, and Azure Kubernetes \", \"Service.](https://azure.microsoft.com/services/app-service/)\\n\\n\\n  - **Application development** : You\", \" can choose from many languages when you build\\n[applications that run in containers. This guide focu\", \"ses on .NET, but, you can develop](https://dotnet.microsoft.com/)\\ncontainer-based apps by using othe\", \"r languages, like Node.js, Python, Spring/Java, or Go.\\n\\n\\n  - **Monitoring, telemetry, logging, and a\", \"uditing** : The ability to monitor and audit applications\\nand containers that are running in the clo\", \"ud is critical for any Cloud-Optimized application.\\n[Azure Application Insights and Microsoft Operat\", \"ions Management Suite](https://azure.microsoft.com/services/application-insights/) are the main\\nMicr\", \"osoft tools that provide monitoring and auditing for Cloud-Optimized apps.\\n\\n\\n  - **Provisioning** : \", \"Automation tools help you provision the infrastructure and deploy an\\napplication to multiple environ\", \"ments (production, testing, staging). You can use tools like\\nChef and Puppet to manage an applicatio\", \"n\\u2019s configuration and environment. This layer also\\ncan be implemented by using simpler and more dire\", \"ct approaches. For example, you can\\ndeploy directly by using Azure command-line interface (Azure CLI\", \") tooling, and then use the\\n[continuous deployment and release management pipelines in Azure DevOps \", \"Services.](https://azure.microsoft.com/services/devops/)\\n\\n\\n  - **Application lifecycle** : [Azure De\", \"vOps Services](https://azure.microsoft.com/services/devops/) and other tools, like Jenkins, are buil\", \"t\\nautomation servers that help you implement CI/CD pipelines, including release management.\\n\\n\\nThe ne\", \"xt sections of this chapter, and the related walkthroughs, focus specifically on details about the\\nr\", \"untime layer (Windows Containers). The guidance describes the ways you can deploy Windows\\nContainers\", \" on Windows Server 2016 (and later versions) VMs and Azure Container Instances. It also\\ncovers more \", \"advanced PaaS platforms like Azure App Service and orchestrator like Azure Kubernetes\\nService.\\n\\n####\", \" **Monolithic applications can be Cloud-Optimized**\\n\\n\\nIt\\u2019s important to highlight that monolithic ap\", \"plications (applications that are not based on\\nmicroservices) _can_ be Cloud-Optimized applications.\", \" You can build and operate monolithic\\napplications that take advantage of the cloud computing model \", \"by using a combination of containers,\\ncontinuous delivery, and DevOps. If an existing monolithic app\", \"lication is right for your business goals,\\nyou can modernize it and make it Cloud-Optimized.\\n\\n\\nSimil\", \"arly, if monolithic applications can be Cloud-Optimized applications, other, more complex\\narchitectu\", \"res like N-Tier applications can also be modernized as Cloud-Optimized applications.\\n\\n\\n15 CHAPTER 3 \", \"| Modernize existing .NET apps to Cloud-Optimized applications\\n\\n\\n### What about Cloud-Native applica\", \"tions?\\n\\n[Although Cloud-Native](https://azure.microsoft.com/overview/cloudnative/) applications are \", \"not the main focus of this guide, it\\u2019s helpful to have an\\nunderstanding of this modernization maturi\", \"ty level, and to distinguish it from Cloud-Optimized\\napplications.\\n\\n\\nFigure 4-3 positions Cloud-Nati\", \"ve apps in the application modernization maturity levels:\\n\\n\\n_Figure 4-3. Positioning Cloud-Native ap\", \"plications_\\n\\n\\nThe Cloud-Native modernization maturity level usually requires new development investm\", \"ents.\\nMoving to the Cloud-Native level typically is driven by business need to modernize application\", \"s as\\nmuch as possible to drastically improve scale in large applications by creating autonomous\\nsubs\", \"ystems (microservices) that can be deployed and scale independently from other areas of the\\napplicat\", \"ion while lowering costs in the long term and increase evolution agility of those autonomous\\napp\\u2019s p\", \"arts that provide significant compete advantages.\\n\\n\\nThe main pillars of Cloud-Native applications ar\", \"e based on microservices architecture approaches,\\nwhich can evolve with agility and scale to limits \", \"that would be difficult to achieve in a monolithic\\narchitecture, deployed to either on-premises or c\", \"loud environment.\\n\\n\\nFigure 4-4 shows the main characteristics of the Cloud-Native model.\\n\\n\\n16 CHAPTE\", \"R 3 | Modernize existing .NET apps to Cloud-Optimized applications\\n\\n\\n_Figure 4-4. Cloud-Native chara\", \"cteristics_\\n\\n\\nIn addition, you can extend basic modern web apps and cloud-native apps by adding othe\", \"r services,\\nlike artificial intelligence (AI), machine learning (ML), and IoT. You might use any of \", \"these services to\\nextend any of the possible Cloud-Optimized approaches.\\n\\n\\nThe fundamental differenc\", \"e in applications at the Cloud-Native level is in the application architecture.\\nCloud-native applica\", \"tions are, by definition, apps that are based on microservices. Cloud-native apps\\nrequire special ar\", \"chitectures, technologies, and platforms, compared to a monolithic web application\\nor traditional N-\", \"Tier application.\\n\\n#### **Cloud-native applications details**\\n\\n\\nCloud-Native is a more advanced or m\", \"ature state for large and mission-critical applications. CloudNative applications usually require ar\", \"chitecture and design that are created from scratch instead of by\\nmodernizing existing applications.\", \" The key difference between a Cloud-Native application and a\\nsimpler Cloud-Optimized web app is the \", \"recommendation to use microservices architectures in a\\ncloud-native approach. Cloud-Optimized apps c\", \"an also be monolithic web apps or N-Tier apps.\\n\\n\\n[The Twelve-Factor App](https://12factor.net/) (a c\", \"ollection of patterns that are closely related to microservices approaches)\\nis also considered a req\", \"uirement for cloud-native application architectures.\\n\\n\\n[The Cloud Native Computing Foundation (CNCF)\", \" is a primary promoter of cloud-native principles.](https://www.cncf.io/)\\n[Microsoft is a member of \", \"the CNCF.](https://azure.microsoft.com/blog/announcing-cncf/)\\n\\n\\nFor detailed guidance on how to desi\", \"gn and develop cloud-native applications, read the following\\nfree e-books:\\n\\n\\n17 CHAPTER 3 | Moderniz\", \"e existing .NET apps to Cloud-Optimized applications\\n\\n\\n  - [Architecting Cloud-Native .NET Applicati\", \"ons for Azure](https://docs.microsoft.com/en-us/dotnet/architecture/cloud-native/introduction)\\n\\n  - \", \"[.NET Microservices: Architecture for containerized .NET applications.](https://docs.microsoft.com/e\", \"n-us/dotnet/architecture/microservices/)\\n\\n\\nThe most important factor to consider if you migrate a fu\", \"ll application to the cloud-native model is\\nthat you must rearchitect to a microservices-based archi\", \"tecture. This approach clearly requires a\\nsignificant investment in development because of the large\", \" refactoring process involved. This option\\nusually is chosen for mission-critical applications that \", \"need new levels of scalability and long-term\\nagility. But, you could start moving toward cloud-nativ\", \"e by adding microservices for just a few new\\nscenarios, and eventually refactor the application full\", \"y as microservices. This step is an incremental\\napproach that is the best option for some scenarios.\", \"\\n\\n#### **What about microservices?**\\n\\n\\nUnderstanding microservices and how they work is important wh\", \"en you are considering cloud-native\\napplications for your organization.\\n\\n\\nThe microservices architec\", \"ture is an advanced approach that you can use for applications that are\\ncreated from scratch or when\", \" you evolve existing applications toward cloud-native applications. You\\ncan start by adding a few mi\", \"croservices to existing applications to learn about the new microservices\\nparadigms. But clearly, yo\", \"u need to architect and code, especially for this type of architectural\\napproach.\\n\\n\\nHowever, microse\", \"rvices are not mandatory for any new or modern application. Microservices are not a\\n\\u201cmagic bullet,\\u201d \", \"and they aren\\u2019t the single, best way to create every application. How and when you use\\nmicroservices\", \" depends on the type of application that you need to build.\\n\\n\\nThe microservices architecture is beco\", \"ming the preferred approach for distributed and large or\\ncomplex mission-critical applications that \", \"are based on multiple, independent subsystems in the form\\nof autonomous services. In a microservices\", \"-based architecture, an application is built as a collection of\\nservices that can be independently d\", \"eveloped, tested, versioned, deployed, and scaled. This approach\\ncan include any related, autonomous\", \" database per microservice.\\n\\n\\nFor a detailed look at a microservices architecture that you can imple\", \"ment by using .NET, see the\\n[downloadable PDF e-book .NET microservices: Architecture for containeri\", \"zed .NET applications. The](https://aka.ms/microservicesebook)\\n[guide also is available online.](htt\", \"ps://docs.microsoft.com/en-us/dotnet/architecture/microservices/)\\n\\n\\nBut even in scenarios in which m\", \"icroservices offer powerful capabilities-independent deployment,\\nstrong subsystem boundaries, and te\", \"chnology diversity-they also raise many new challenges. The\\nchallenges are related to distributed ap\", \"plication development, such as fragmented and independent\\ndata models; achieving resilient communica\", \"tion between microservices; the need for eventual\\nconsistency; and operational complexity. Microserv\", \"ices introduce a higher level of complexity\\ncompared to traditional monolithic applications.\\n\\n\\nBecau\", \"se of the complexity of a microservices architecture, only specific scenarios and certain\\napplicatio\", \"n types are suitable for microservice-based applications. These include large and complex\\napplicatio\", \"ns that have multiple, evolving subsystems. In these cases, it\\u2019s worth investing in a more\\ncomplex s\", \"oftware architecture, for increased long-term agility and more efficient application\\nmaintenance. Bu\", \"t for less complex scenarios, it might be better to continue with a monolithic\\napplication approach \", \"or simpler N-Tier approaches.\\n\\n\\n18 CHAPTER 3 | Modernize existing .NET apps to Cloud-Optimized appli\", \"cations\\n\\n\\nAs a final note, even at the risk of being repetitive about this concept, you shouldn\\u2019t lo\", \"ok at using\\nmicroservices in your applications as \\u201call-in or nothing at all.\\u201d You can extend and evo\", \"lve existing\\nmonolithic applications by adding new, small scenarios based on microservices. You don\\u2019\", \"t need to\\nstart from scratch to start working with a microservices architecture approach. In fact, w\", \"e recommend\\nthat you evolve from using an existing monolithic or N-Tier application by adding new sc\", \"enarios.\\nEventually, you can break down the application into autonomous components or microservices.\", \" You\\ncan start evolving your monolithic applications in a microservices direction, step by step.\\n\\n\\nI\", \"n any case, the rest of this present guidance focuses most of all on \\u201cno microservices-based apps\\u201d\\nb\", \"ecause this guidance is mainly targeting the modernization of existing apps that usually have\\nmonoli\", \"thic or N-Tier architectures.\\n\\n### Deploy existing .NET apps as Windows containers\\n\\n\\nDeployments tha\", \"t are based on Windows Containers are applicable to Cloud-Optimized applications\\nand Cloud-Native ap\", \"plications.\\n\\n\\nHowever, in this guide and especially in the following sections, it mostly focuses on \", \"using Windows\\nContainers for _Cloud-Optimized_ applications where you don\\u2019t need to rearchitect your\", \" application.\\n\\n#### **What are containers? (Linux or Windows)**\\n\\n\\nContainers are a way to wrap up an\", \" application into its own isolated package. In its container, the\\napplication is not affected by app\", \"lications or processes that exist outside of the container. Everything\\nthe application depends on to\", \" run successfully as a process is inside the container. Wherever the\\ncontainer might move, the requi\", \"rements of the application will always be met, in terms of direct\\ndependencies, because it is bundle\", \"d with everything that it needs to run (library dependencies,\\nruntimes, and so on).\\n\\n\\nThe main chara\", \"cteristic of a container is that it makes the environment the same across different\\ndeployments beca\", \"use the container itself comes with all the dependencies it needs. You can debug\\nthe application on \", \"your machine, and then deploy it to another machine, with the same environment\\nguaranteed.\\n\\n\\nA conta\", \"iner is an instance of a container image. A container image is a way to package an app or\\nservice (l\", \"ike a snapshot), and then deploy it in a reliable and reproducible way. You could say that\\nDocker is\", \" not only a technology-it\\u2019s also a philosophy and a process.\\n\\n\\nAs containers daily become more commo\", \"n, they are becoming an industry-wide \\u201cunit of deployment.\\u201d\\n\\n#### **Benefits of containers (Docker E\", \"ngine on Linux or Windows)**\\n\\n\\nBuilding applications by using containers-which also might be defined\", \" as lightweight building blocksoffers a significant increase in agility for building, shipping, and \", \"running any application, across any\\ninfrastructure.\\n\\n\\nWith containers, you can take any app from dev\", \"elopment to production with little or no code change,\\nthanks to Docker integration across Microsoft \", \"developer tools, operating systems, and the cloud.\\n\\n\\n19 CHAPTER 3 | Modernize existing .NET apps to \", \"Cloud-Optimized applications\\n\\n\\nWhen you deploy to plain VMs, you probably already have a method in p\", \"lace for deploying ASP.NET\\napps to your VMs. It\\u2019s likely, though, that your method involves multiple\", \" manual steps or complex\\nautomated processes by using a deployment tool like Puppet, or a similar to\", \"ol. You might need to\\nperform tasks like modifying configuration items, copying application content \", \"between servers, and\\nrunning interactive setup programs based on .msi setups, followed by testing. A\", \"ll those steps in the\\ndeployment add time and risk to deployments. You will get failures whenever a \", \"dependency is not\\npresent in the target environment.\\n\\n\\nIn Windows Containers, the process of packagi\", \"ng applications is fully automated. Windows Containers\\nis based on the Docker platform, which offers\", \" automatic updates and rollbacks for container\\ndeployments. The main improvement you get from using \", \"the Docker engine is that you create images,\\nwhich are like snapshots of your application, with all \", \"its dependencies. The images are Docker images\\n(a Windows container image, in this case). The images\", \" run ASP.NET apps in containers, without going\\nback to source code. The container snapshot becomes t\", \"he unit of deployment.\\n\\n\\nMany organizations are containerizing existing monolithic applications for \", \"the following reasons:\\n\\n\\n  - **Release agility through improved deployment** . Containers offer a co\", \"nsistent deployment\\ncontract between development and operations. When you use containers, you won\\u2019t \", \"hear\\ndevelopers say, \\u201cIt works on my machine, why not in production?\\u201d They can say, \\u201cIt runs as a\\nco\", \"ntainer, so it will run in production.\\u201d The packaged application, with all its dependencies,\\ncan be \", \"executed in any supported container-based environment. It will run the way it was\\nintended to run in\", \" all deployment targets (dev, QA, staging, production). Containers eliminate\\nmost frictions when the\", \"y move from one stage to the next, which greatly improves\\ndeployment, and you can ship faster.\\n\\n\\n  -\", \" **Cost reductions** . Containers lead to lower costs, either by the consolidation and removal of\\nex\", \"isting hardware, or from running applications at a higher density per unit of hardware.\\n\\n\\n  - **Port\", \"ability** . Containers are modular and portable. Docker containers are supported on any\\nserver opera\", \"ting system (Linux and Windows), in any major public cloud (Microsoft Azure,\\nAmazon AWS, Google, IBM\", \"), and in on-premises and private or hybrid cloud environments.\\n\\n\\n  - **Control** . Containers offer\", \" a flexible and secure environment that\\u2019s controlled at the container\\nlevel. A container can be secu\", \"red, isolated, and even limited by setting execution constraint\\npolicies on the container. As detail\", \"ed in the section about Windows Containers, Windows\\nServer 2016 and Hyper-V containers offer additio\", \"nal enterprise support options.\\n\\n\\nSignificant improvements in agility, portability, and control ulti\", \"mately lead to significant cost\\nreductions when you use containers to develop and maintain applicati\", \"ons.\\n\\n#### **What is Docker?**\\n\\n\\n[Docker](https://www.docker.com/) [is an open-source project that a\", \"utomates the deployment of applications as portable, self-](https://github.com/docker/docker)\\n[suffi\", \"cient containers that can run in the cloud or on-premises. Docker is also a company that](https://ww\", \"w.docker.com/)\\npromotes and evolves this technology. The company works in collaboration with cloud, \", \"Linux, and\\nWindows vendors, including Microsoft.\\n\\n\\n20 CHAPTER 3 | Modernize existing .NET apps to Cl\", \"oud-Optimized applications\\n\\n\\n_Figure 4-6. Docker deploys containers at all layers of the hybrid clou\", \"d_\\n\\n\\nTo someone familiar with virtual machines, containers might appear to be remarkably similar. A\\n\", \"container runs an operating system, has a file system, and can be accessed over a network, just like\", \" a\\nphysical or virtual computer system. However, the technology and concepts behind containers are\\nv\", \"astly different from virtual machines. From a developer point of view, a container must be treated\\nm\", \"ore like a single process. In fact, a container has a single entry point for one process.\\n\\n\\nDocker c\", \"ontainers (for simplicity, _containers_ ) can run natively on Linux and Windows. When running\\nregula\", \"r containers, Windows containers can run only on Windows hosts (a host server or a VM), and\\nLinux co\", \"ntainers can run only on Linux hosts. However, in recent versions of Windows Server and\\nHyper-V cont\", \"ainers, a Linux container can also run natively on Windows Server by using the Hyper-V\\nisolation tec\", \"hnology that currently is available only in Windows Server Containers.\\n\\n\\nIn the near future, mixed e\", \"nvironments that have both Linux and Windows containers will be possible\\nand even common.\\n\\n#### **Be\", \"nefits of Windows Containers for your existing .NET applications**\\n\\n\\nThe benefits of using Windows C\", \"ontainers are fundamentally the same benefits you get from\\ncontainers in general. Using Windows Cont\", \"ainers is about greatly improving agility, portability, and\\ncontrol.\\n\\n\\nExisting .NET applications re\", \"fer to those applications that were created using the .NET Framework. For\\nexample, they might be tra\", \"ditional ASP.NET web applications-they don\\u2019t use .NET Core or .NET 5+,\\nwhich is newer and runs cross\", \"-platform on Linux, Windows, and MacOS.\\n\\n\\nThe main dependency in the .NET Framework is Windows. It a\", \"lso has secondary dependencies, like IIS,\\nand System.Web in traditional ASP.NET.\\n\\n\\nA .NET Framework \", \"application must run on Windows, period. If you want to containerize existing .NET\\nFramework applica\", \"tions and you can\\u2019t or don\\u2019t want to invest in a migration to .NET Core or later(\\u201cIf it\\n\\n\\n21 CHAPTER\", \" 3 | Modernize existing .NET apps to Cloud-Optimized applications\\n\\n\\nworks properly, don\\u2019t migrate it\", \"\\u201d), the only choice you have for containers is to use Windows\\nContainers.\\n\\n\\nSo, one of the main bene\", \"fits of Windows Containers is that they offer you a way to modernize your\\nexisting .NET Framework ap\", \"plications that are running on Windows-through containerization.\\nUltimately, Windows Containers gets\", \" you the benefits that you are looking for by using containersagility, portability, and better contr\", \"ol.\\n\\n#### **Choose an OS to target with .NET-based containers**\\n\\n\\nGiven the diversity of operating s\", \"ystems that are supported by Docker, as well as the differences\\nbetween .NET Framework and .NET Core\", \", you should target a specific OS and specific versions based\\non the framework you are using.\\n\\n\\nFor \", \"Windows, you can use Windows Server Core or Windows Nano Server. These Windows versions\\nprovide diff\", \"erent characteristics (like IIS versus a self-hosted web server like Kestrel) that might be\\nneeded b\", \"y .NET Framework or .NET applications.\\n\\n\\nFor Linux, multiple distros are available and supported in \", \"official .NET Docker images (like Debian).\\n\\n\\nFigure 4-7 shows OS versions that you can target, depen\", \"ding on the app\\u2019s version of the .NET\\nFramework.\\n\\n\\n_Figure 4-7. Operating systems to target based on\", \" .NET Framework version_\\n\\n\\nIn migration scenarios for existing or legacy applications that are based\", \" on .NET Framework\\napplications, the main dependencies are on Windows and IIS. Your only option is t\", \"o use Docker\\nimages based on Windows Server Core and the .NET Framework.\\n\\n\\nWhen you add the image na\", \"me to your Dockerfile file, you can select the operating system and\\nversion by using a tag, as in th\", \"e following examples for .NET Framework-based Windows container\\nimages:\\n\\n\\n22 CHAPTER 3 | Modernize e\", \"xisting .NET apps to Cloud-Optimized applications\\n\\n\\n|Tag|System and version|\\n|---|---|\\n|**mcr.micros\", \"oft.com/dotnet/framework/runti**<br>**me:4.x-windowsservercore-20H2**|.NET Framework 4.x on Windows \", \"Server Core|\\n|**mcr.microsoft.com/dotnet/framework/aspne**<br>**t:4.x-windowsservercore-20H2**|.NET \", \"Framework 4.x with additional ASP.NET<br>customization, on Windows Server Core|\\n\\n\\n\\nFor .NET (cross-p\", \"latform for Linux and Windows), the tags would look like the following:\\n\\n\\n\\n|Tag|System and version|\\n\", \"|---|---|\\n|**mcr.microsoft.com/dotnet/runtime:7.0**|.NET runtime-only on Linux|\\n|**mcr.microsoft.com\", \"/dotnet/runtime:7.0-**<br>**nanoserver-ltsc2022**|.NET runtime-only on Windows Nano Server|\\n\\n\\n**Mult\", \"i-arch images**\\n\\n\\n\\n\\n\\n[Since 2017, Docker has had a feature called multi-arch](https://github.com/mob\", \"y/moby/issues/15866) images. .NET Docker images can use multi-arch\\ntags. Your Dockerfile files no lo\", \"nger need to define the operating system that you are targeting. The\\nmulti-arch feature allows a sin\", \"gle tag to be used across multiple machine configurations. For instance,\\nwith multi-arch, you can us\", \"e one common tag: **mcr.microsoft.com/dotnet/runtime:7.0** . If you pull\\nthat tag from a Linux conta\", \"iner environment, you get the Debian-based image. If you pull that tag\\nfrom a Windows container envi\", \"ronment, you get the Nano Server-based image.\\n\\n\\nFor .NET Framework images, because the traditional .\", \"NET Framework supports only Windows, you\\ncannot use the multi-arch feature.\\n\\n#### **Windows containe\", \"r types**\\n\\n\\nLike Linux containers, Windows Server containers are managed by using Docker Engine. Unl\", \"ike Linux\\ncontainers, Windows containers include two different container types, or run times-Windows\", \" Server\\ncontainers and Hyper-V isolation.\\n\\n\\n**Windows Server containers** : Provides application iso\", \"lation through process and namespace isolation\\ntechnology. A Windows Server container shares a kerne\", \"l with the container host and all containers\\nthat are running on the host. These containers do not p\", \"rovide a hostile security boundary and should\\nnot be used to isolate untrusted code. Because of the \", \"shared kernel space, these containers require\\nthe same kernel version and configuration.\\n\\n\\n**Hyper-V\", \" isolation** : Expands on the isolation provided by Windows Server Containers by running each\\ncontai\", \"ner on a highly optimized VM. In this configuration, the kernel of the container host is not\\nshared \", \"with other containers on the same host. These containers are designed for hostile multitenant\\nhostin\", \"g, with the same security assurances of a VM. Because these containers don\\u2019t share the kernel\\nwith t\", \"he host or other containers on the host, they can run kernels with different versions and\\nconfigurat\", \"ions (with supported versions). For example, all Windows containers on Windows 10 use\\nHyper-V isolat\", \"ion to utilize the Windows Server kernel version and configuration.\\n\\n\\n23 CHAPTER 3 | Modernize exist\", \"ing .NET apps to Cloud-Optimized applications\\n\\n\\nRunning a container on Windows with or without Hyper\", \"-V isolation is a run-time decision. You might\\nchoose to create the container with Hyper-V isolation\", \" initially, and at run time, choose to run it as a\\nWindows Server container instead.\\n\\n\\n**Additional \", \"resources**\\n\\n\\n  - **Windows Containers documentation**\\n\\n\\n[https://learn.microsoft.com/virtualization\", \"/windowscontainers/](https://docs.microsoft.com/virtualization/windowscontainers/)\\n\\n\\n  - **Windows C\", \"ontainers fundamentals**\\n\\n\\n[https://learn.microsoft.com/virtualization/windowscontainers/about/](htt\", \"ps://docs.microsoft.com/virtualization/windowscontainers/about/)\\n\\n\\n  - **Infographic: Microsoft and \", \"containers**\\n\\n\\n[https://info.microsoft.com/rs/157-GQE-382/images/Container%20infographic%201.4.17.pd\", \"f](https://info.microsoft.com/rs/157-GQE-382/images/Container%20infographic%201.4.17.pdf)\\n\\n#### **Th\", \"e container ecosystem in Azure**\\n\\n\\nIn previous sections, it\\u2019s been explained what the benefits of Do\", \"cker containers are as well as details\\non the specific container images for .NET applications. All t\", \"hat generic information is fundamental in\\norder to develop or containerize an application. However, \", \"when thinking about the production\\ndeployment environment or even QA and Dev/Test environments, Micr\", \"osoft Azure provides an open\\nand broad variety of choices, a full container ecosystem in the cloud (\", \"shown in the diagram below).\\nDepending on your specific application\\u2019s needs, you should choose one o\", \"r another Azure product.\\n\\n\\n24 CHAPTER 3 | Modernize existing .NET apps to Cloud-Optimized applicatio\", \"ns\\n\\n\\n_Figure 4-7.5. The container ecosystem in Azure_\\n\\n\\nFrom the container ecosystem in Azure, the f\", \"ollowing products supporting containers that are\\nconsidered infrastructure:\\n\\n\\n  - **Azure Container \", \"Instances (ACI)**\\n\\n  - **Azure Virtual Machines** (With container\\u2019s support)\\n\\n  - **Azure Virtual Ma\", \"chine Scale Sets** (With container\\u2019s support)\\n\\n\\nFrom those three, ACI provides a great benefit, whic\", \"h is the fact that you don\\u2019t need to maintain the\\nunderlying OS, no need for you to upgrade/patch, e\", \"tc. but ACI still is positioned in the infrastructure\\nlevel, as better explained in the upcoming sec\", \"tions of this book.\\n\\n\\nThe products in Azure supporting containers that are at the same time position\", \"ed more in the PaaS\\n(Platform as a Service) level are:\\n\\n\\n  - **Azure App Service**\\n\\n  - **Azure Kube\", \"rnetes Service (AKS and ACS)**\\n\\n  - **Azure Batch**\\n\\n\\nThen, Azure Container Registry is a high scala\", \"ble container registry hosted in Azure that you can use\\nfrom all the previous products when register\", \"ing and deploying your custom container images.\\n\\n\\nIn addition, from your containers, you can consume\", \" other managed services in Azure like Azure SQL\\nDatabase, Azure Redis cache, Azure Cosmos DB, etc. p\", \"lus there are third-party solutions/platforms\\n\\n\\n25 CHAPTER 3 | Modernize existing .NET apps to Cloud\", \"-Optimized applications\\n\\n\\navailable in Azure Marketplace like Cloud Foundry and OpenShift where you \", \"can also use containers\\nwithin Azure.\\n\\n\\nIn the next sections, you can explore Microsoft\\u2019s recommenda\", \"tions on when to use each of those\\nAzure products and solutions specifically when targeting Windows \", \"Containers.\\n\\n### When not to deploy to Windows Containers\\n\\n\\nSome Windows technologies are not suppor\", \"ted by Windows Containers. In those cases, you still need\\nto migrate to the standards VMs, usually w\", \"ith just Windows and IIS.\\n\\n\\n[For more information, see the list of Applications not supported by Win\", \"dows containers.](https://docs.microsoft.com/virtualization/windowscontainers/quick-start/lift-shift\", \"-to-containers#applications-not-supported-by-containers)\\n\\n\\n**Additional resources**\\n\\n\\n  - **Virtual \", \"machines and containers in Azure**\\n\\n\\n[https://azure.microsoft.com/overview/containers/](https://azur\", \"e.microsoft.com/overview/containers/)\\n\\n### When to deploy Windows Containers in your on- premises Ia\", \"aS VM infrastructure\\n\\n\\n  - Your organization might not be ready to move to the cloud, or it might no\", \"t be able to move\\nto the cloud for a business reason. But, you can still get the benefits of using W\", \"indows\\nContainers in your own datacenters.\\n\\n\\n  - You might have other artifacts that are being used \", \"on-premises, and which might slow you\\ndown when you try to move to the cloud. For example, security \", \"or authentication\\ndependencies with on-premises Windows Server Active Directory, or any other on-pre\", \"mises\\nasset.\\n\\n\\n  - If you start using Windows Containers today, you can make a phased migration to t\", \"he cloud\\ntomorrow from a much better position. Windows Containers is becoming a unit of\\ndeployment f\", \"or any cloud, with no lock-in.\\n\\n### When to deploy Windows Containers to Azure VMs (IaaS cloud)\\n\\n\\nIf\", \" your organization is using Azure VMs, even if you are also using Windows Containers, you are still\\n\", \"dealing with IaaS. That means that dealing with infrastructure operations, VM OS patches, and\\ninfras\", \"tructure complexity for highly scalable applications when you need to deploy to multiple VMs in\\na lo\", \"ad-balanced infrastructure. The main scenarios for using Windows Containers in an Azure VM are:\\n\\n\\n  \", \"- **Dev/test environment** : A VM in the cloud is perfect for development and testing in the\\ncloud. \", \"You can rapidly create or stop the environment depending on your needs.\\n\\n\\n26 CHAPTER 3 | Modernize e\", \"xisting .NET apps to Cloud-Optimized applications\\n\\n\\n  - **Small and medium scalability needs** : In \", \"scenarios where you might need just a couple of\\nVMs for your production environment, managing a few \", \"VMs might be affordable until you\\ncan move to more advanced PaaS environments, like orchestrators.\\n\\n\", \"\\n  - **Production environment with existing deployment tools** : You might be moving from an\\non-prem\", \"ises environment in which you have invested in tools to make complex deployments\\nto VMs or bare-meta\", \"l servers (like Puppet or similar tools). To move to the cloud with minimal\\nchanges to production en\", \"vironment deployment procedures, you might continue to use\\nthose tools to deploy to Azure VMs. Howev\", \"er, you\\u2019ll want to use Windows Containers as the\\nunit of deployment to improve the deployment experi\", \"ence.\\n\\n### When to deploy Windows Containers to Azure Container Instances (ACI)\\n\\n\\nThe main value pro\", \"position of Azure Container Instances is that you can right away deploy containers\\nto it and you don\", \"\\u2019t need to maintain that environment, you don\\u2019t need to upgrade/patch the\\nunderlying operating syste\", \"m or VMs, all that is transparent and you just deploy containers into a\\nready-to-use environment.\\n\\n\\n\", \"The reasons and scenarios when you would want to use ACI are similar to the main scenarios when\\nyou \", \"use Azure VMs with containers, so basically, the main scenarios for using Azure Container\\nInstances \", \"are:\\n\\n\\n  - **Dev/Test scenarios**\\n\\n  - **Task automation**\\n\\n  - **CI/CD agents**\\n\\n  - **Small/scale \", \"batch processing**\\n\\n  - **Simple web apps**\\n\\n\\nThe simple web apps scenario is a fair scenario for AC\", \"I but take into account that since in ACI you can\\nonly have a single container instance per containe\", \"r image, you won\\u2019t have high availability and only\\nhave limited scalability.\\n\\n\\nHowever, even when AC\", \"I is considered infrastructure because it just provides single container\\ninstances, there is a huge \", \"benefit compared to regular Azure VMs with Windows Server. With ACI, you\\njust deploy the containers \", \"into a self-maintained environment and you just pay for those containers.\\nYou don\\u2019t need to maintain\", \"/update/patch VMs, so it is a much better platform for most scenarios\\nwhere you might be using VMs w\", \"ith containers. Using ACI is straight forward, you just deploy a\\ncontainer, there\\u2019s no need to creat\", \"e a VM environment you just deploy containers.\\n\\n\\nThe main benefits of Azure Container Instances (ACI\", \") are:\\n\\n\\n  - Run containers without managing servers\\n\\n  - Increase agility with containers on demand\", \"\\n\\n  - Deploy containers to the cloud with unprecedented simplicity and speed\\u2014with a single\\ncommand.\\n\", \"\\n\\n27 CHAPTER 3 | Modernize existing .NET apps to Cloud-Optimized applications\\n\\n\\n  - Secure applicati\", \"ons with hypervisor isolation\\n\\n\\nIn short, with ACI you can develop apps fast without managing virtua\", \"l machines or having to learn\\nnew tools. It\\u2019s just your application, in a container, running in the \", \"cloud.\\n\\n### When to deploy Windows Containers to Azure Kubernetes Service (AKS)\\n\\n\\nAzure Kubernetes S\", \"ervice (AKS) simplifies deploying a managed Kubernetes cluster in Azure by\\noffloading the operationa\", \"l overhead to Azure. You get an open solution that offers portability both for\\nyour containers and f\", \"or your application configuration. You select the size, the number of hosts, and\\nthe orchestrator to\", \"ols. Azure Kubernetes Service handles the infrastructure for you. It also supports\\nWindows Server co\", \"ntainers alongside Linux containers. For more details on Windows OS support and\\n[the feature differe\", \"nces between Windows and Linux, read the FAQ.](https://docs.microsoft.com/azure/aks/windows-faq)\\n\\n\\nT\", \"he main benefits of Azure Kubernetes Service (AKS) are:\\n\\n\\n  - Identity and security management\\n\\n  - \", \"Integrated logging and monitoring\\n\\n  - Cluster node and pod scaling.\\n\\n  - Ingress with HTTP applicat\", \"ion routing\\n\\n  - AKS supports the Docker image format. For private storage of your Docker images, yo\", \"u can\\nintegrate AKS with Azure Container Registry (ACR).\\n\\nIf you are already working with open-sourc\", \"e orchestrators like Kubernetes, Docker Swarm, or DC/OS,\\nyou don\\u2019t need to change your existing mana\", \"gement practices to move container workloads to the\\ncloud. Use the application management tools that\", \" you\\u2019re already familiar with and connect via the\\nstandard API endpoints for the orchestrator of you\", \"r choice.\\n\\n### Choosing Azure compute platforms for container- based applications\\n\\n\\nAs you have noti\", \"ced after reading the previous sections, Azure is an open cloud that offers multiple\\nchoices. You ca\", \"n use the best fit for your needs, however, it also surfaces questions about what\\nproduct/technology\", \" you should use for your containerized applications.\\n\\n\\nAs a _by-default_ recommendation, the followi\", \"ng is the main criteria recommended in this guidance:\\n\\n\\n  - **Single monolithic app:** Choose Azure \", \"App Service\\n\\n  - **N-Tier app:** Choose orchestrators such as Azure Kubernetes Service (AKS) or App \", \"Service if\\nyou have a single or a few back-end services\\n\\n  - **Microservices:** Choose AKS or Azure \", \"Web Apps for Containers\\n\\n  - **Serverless functions & event handlers:** Choose Azure Functions\\n\\n  - \", \"**Large-scale Batch:** Choose Azure Batch\\n\\n\\n28 CHAPTER 3 | Modernize existing .NET apps to Cloud-Opt\", \"imized applications\\n\\n\\nHowever, this recommendation should be taken with a pinch of salt, as the prod\", \"uct\\u2019s selection will\\ndepend on your specific application\\u2019s needs and characteristics. Not all applic\", \"ations are the same even\\nwhen initially they might look similar types.\\n\\n\\nAfter a deeper analysis of \", \"the application\\u2019s needs, the product selected could be different. But, as a\\nstarting point, it is go\", \"od to have initial guidance from where you can start evaluating and testing\\nbased on certain priorit\", \"y.\\n\\n\\n**Additional resources**\\n\\n\\n  - **Choose an Azure compute service for your application**\\n\\n\\n[http\", \"s://learn.microsoft.com/azure/architecture/guide/technology-choices/compute-decision-](https://docs.\", \"microsoft.com/azure/architecture/guide/technology-choices/compute-decision-tree)\\ntree\\n\\n### Build res\", \"ilient services ready for the cloud: Embrace transient failures in the cloud\\n\\n\\nResiliency is the abi\", \"lity to recover from failures and continue to function. Resiliency is not about\\navoiding failures, b\", \"ut accepting the fact that failures will occur, and then responding to them in a way\\nthat avoids dow\", \"ntime or data loss. The goal of resiliency is to return the application to a fully\\nfunctioning state\", \" after a failure.\\n\\n\\nYour application is ready for the cloud when, at a minimum, it implements a soft\", \"ware-based model of\\nresiliency, rather than a hardware-based model. Your cloud application must embr\", \"ace the partial\\nfailures that will certainly occur. Design or partially refactor your application to\", \" achieve resiliency with\\nexpected partial failures. It should be designed to cope with partial failu\", \"res, like transient network\\noutages and nodes, or VMs crashing in the cloud. Even containers being m\", \"oved to a different node\\nwithin an orchestrator cluster can cause intermittent short failures within\", \" the application.\\n\\n#### **Handling partial failure**\\n\\n\\nIn a cloud-based application, there\\u2019s an ever\", \"-present risk of partial failure. For instance, a single\\nwebsite instance or a container might fail,\", \" or it might be unavailable or unresponsive for a short time.\\nOr, a single VM or server might crash.\", \"\\n\\n\\nBecause clients and services are separate processes, a service might not be able to respond in a \", \"timely\\nmanner to a client\\u2019s request. The service might be overloaded and respond slowly to requests,\", \" or it\\nmight not be accessible for a short time because of network issues.\\n\\n\\nFor example, consider a\", \" monolithic .NET application that accesses a database in Azure SQL Database.\\nIf the Azure SQL databa\", \"se or any other third-party service is unresponsive for a brief time (an Azure\\nSQL database might be\", \" moved to a different node or server, and be unresponsive for a few seconds),\\nwhen the user tries to\", \" do any action, the application might crash and show an exception at the same\\nmoment.\\n\\n\\n29 CHAPTER 3\", \" | Modernize existing .NET apps to Cloud-Optimized applications\\n\\n\\nA similar scenario might occur in \", \"an app that consumes HTTP services. The network or the service\\nitself might not be available in the \", \"cloud during a short, transient failure.\\n\\n\\nA resilient application like the one shown in Figure 4-9 \", \"should implement techniques like \\u201cretries with\\nexponential backoff\\u201d to give the application an oppor\", \"tunity to handle transient failures in resources.\\nYou also should use \\u201ccircuit breakers\\u201d in your app\", \"lications. A circuit breaker stops an application from\\ntrying to access a resource when it\\u2019s actuall\", \"y a long-term failure. By using a circuit breaker, the\\napplication avoids provoking a denial of serv\", \"ice to itself.\\n\\n\\n_Figure 4-9. Partial failures handled by retries with exponential backoff_\\n\\n\\nYou ca\", \"n use these techniques both in HTTP resources and in database resources. In Figure 4-9, the\\napplicat\", \"ion is based on a 3-tier architecture, so you need these techniques at the services level (HTTP)\\nand\", \" at the data tier level (TCP). In a monolithic application that uses only a single app tier in addit\", \"ion\\nto the database (no additional services or microservices), handling transient failures at the da\", \"tabase\\nconnection level might be enough. In that scenario, just a particular configuration of the da\", \"tabase\\nconnection is required.\\n\\n\\nWhen implementing resilient communications that access the database\", \", depending on the version of\\n[.NET you are using, it can be straightforward (for example, with Enti\", \"ty Framework 6 or later. It\\u2019s just a](https://docs.microsoft.com/ef/ef6/fundamentals/connection-resi\", \"liency/retry-logic)\\nmatter of configuring the database connection). Or, you might need to use additi\", \"onal libraries like the\\n[Transient Fault Handling Application Block (for earlier versions of .NET), \", \"or even implement your own](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50\", \"))\\nlibrary.\\n\\n\\nWhen implementing HTTP retries and circuit breakers, the recommendation for .NET is to\", \" use the\\n[Polly](https://github.com/App-vNext/Polly) library, which targets .NET Standard 1.1 (cover\", \"age: .NET Core 1.0, Mono, Xamarin, UWP, WP8.1+)\\nand .NET Standard 2.0+ (coverage: .NET Core 2.0+, .N\", \"ET Core 3.0 and later, Mono, Xamarin and UWP\\ntargets). The nuget package also includes direct target\", \"s for .NET Framework 4.6.1 and 4.7.2.\\n\\n\\nTo learn how to implement strategies for handling partial fa\", \"ilures in the cloud, see the following\\nreferences.\\n\\n\\n**Additional resources**\\n\\n\\n  - **Implementing r\", \"esilient communication to handle partial failure**\\n\\n\\n30 CHAPTER 3 | Modernize existing .NET apps to \", \"Cloud-Optimized applications\\n\\n\\n[https://learn.microsoft.com/dotnet/architecture/microservices/implem\", \"ent-resilient-](https://docs.microsoft.com/en-us/dotnet/architecture/microservices/implement-resilie\", \"nt-applications/partial-failure-strategies)\\n[applications/partial-failure-strategies](https://docs.m\", \"icrosoft.com/en-us/dotnet/architecture/microservices/implement-resilient-applications/partial-failur\", \"e-strategies)\\n\\n\\n  - **Entity Framework connection resiliency and retry logic (version 6 and later)**\", \"\\n\\n\\n[https://learn.microsoft.com/ef/ef6/fundamentals/connection-resiliency/retry-logic](https://docs.\", \"microsoft.com/ef/ef6/fundamentals/connection-resiliency/retry-logic)\\n\\n\\n  - **The Transient Fault Han\", \"dling Application Block**\\n\\n\\n  - [https://learn.microsoft.com/previous-versions/msp-n-p/hh680934(v=pa\", \"ndp.50)](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50))\\n\\n\\n  - **Polly li\", \"brary for resilient HTTP communication**\\n\\n\\n[https://github.com/App-vNext/Polly](https://github.com/A\", \"pp-vNext/Polly)\\n\\n### Modernize your apps with monitoring and telemetry\\n\\n\\nWhen you run an application\", \" in production, it\\u2019s critical that you have insights about how your\\napplication is performing. Is it\", \" performing at a high level? Are users getting errors, or is the application\\nstable and reliable? Yo\", \"u need rich performance monitoring, powerful alerting, and dashboards to help\\nensure that your appli\", \"cation is available and performing as expected. You also need to be able to see\\nquickly if there\\u2019s a\", \" problem, determine how many customers are affected, and perform a root-cause\\nanalysis to find and f\", \"ix the issue.\\n\\n#### **Monitor your application with Application Insights**\\n\\n\\nApplication Insights is\", \" an extensible Application Performance Management (APM) service for web\\ndevelopers who work on multi\", \"ple platforms. Use it to monitor your live web application. Application\\nInsights automatically detec\", \"ts performance anomalies. It includes powerful analytics tools to help you\\ndiagnose issues, and to h\", \"elp you understand what users actually do with your app. Application\\nInsights is designed to help yo\", \"u continuously improve performance and usability. It works for apps on\\na wide variety of platforms, \", \"including .NET, Node.js, and J2EE, whether hosted on-premises or in the\\ncloud. Application Insights \", \"integrates with your DevOps processes, and has connection points to\\nvarious development tools.\\n\\n\\nFig\", \"ure 4-10 shows an example of how Application Insights monitors your application and how it\\nsurfaces \", \"those insights to a dashboard.\\n\\n\\n31 CHAPTER 3 | Modernize existing .NET apps to Cloud-Optimized appl\", \"ications\\n\\n\\n_Figure 4-10. Application Insights monitoring dashboard_\\n\\n#### **Monitor your Docker infr\", \"astructure with Log Analytics and its** **Container Monitoring solution**\\n\\n\\n[Azure Log Analytics](ht\", \"tps://docs.microsoft.com/azure/log-analytics/log-analytics-overview) [is part of the Microsoft Azure\", \" overall monitoring solution. It\\u2019s also a service in](https://docs.microsoft.com/azure/monitoring-an\", \"d-diagnostics/monitoring-overview)\\n[Operations Management Suite (OMS). Log Analytics monitors cloud \", \"and on-premises environments](https://docs.microsoft.com/azure/operations-management-suite/operation\", \"s-management-suite-overview)\\n(OMS for on-premises) to help maintain availability and performance. It\", \" collects data generated by\\nresources in your cloud and on-premises environments and from other moni\", \"toring tools to provide\\nanalysis across multiple sources.\\n\\n\\nIn relation to Azure infrastructure logs\", \", Log Analytics, as an Azure service, ingests log and metric data\\n[from other Azure services (via Az\", \"ure Monitor), Azure VMs, Docker containers, and on-premises or](https://docs.microsoft.com/azure/mon\", \"itoring-and-diagnostics/monitoring-overview-azure-monitor)\\nother cloud infrastructures. Log Analytic\", \"s offers flexible log search and out-of-the box analytics on top\\nof this data. It provides rich tool\", \"s that you can use to analyze data across sources, it allows complex\\nqueries across all logs, and it\", \" can proactively alert based on specified conditions. You can even collect\\ncustom data in the centra\", \"l Log Analytics repository, where you can query and visualize it. You can also\\ntake advantage of the\", \" Log Analytics built-in solutions to immediately gain insights into the security\\nand functionality o\", \"f your infrastructure.\\n\\n\\nYou can access Log Analytics through the OMS portal or the Azure portal, wh\", \"ich run in any browser,\\nand provide you with access to configuration settings and multiple tools to \", \"analyze and act on\\ncollected data.\\n\\n\\n[The Container Monitoring solution in Log Analytics helps you v\", \"iew and manage your Docker and](https://docs.microsoft.com/azure/log-analytics/log-analytics-contain\", \"ers)\\nWindows Container hosts in a single location. The solution shows which containers are running, \", \"what\\n\\n\\n32 CHAPTER 3 | Modernize existing .NET apps to Cloud-Optimized applications\\n\\n\\ncontainer image\", \" they\\u2019re running, and where containers are running. You can view detailed audit\\ninformation, includi\", \"ng commands that are being used with containers. You can also troubleshoot\\ncontainers by viewing and\", \" searching centralized logs, without needing to remotely view Docker or\\nWindows hosts. You can find \", \"containers that might be noisy and consuming excess resources on a\\nhost. Additionally, you can view \", \"centralized CPU, memory, storage, and network usage, and\\nperformance information, for containers. On\", \" computers running Windows, you can centralize and\\ncompare logs from Windows Server, Hyper-V, and Do\", \"cker containers. The solution supports the\\nfollowing container orchestrators:\\n\\n\\n  - Docker Swarm\\n\\n\\n \", \" - DC/OS\\n\\n\\n  - Kubernetes\\n\\n\\n  - Red Hat OpenShift\\n\\n\\nFigure 4-11 shows the relationships between vari\", \"ous container hosts and agents and OMS.\\n\\n\\n_Figure 4-11. Log Analytics Container Monitoring solution_\", \"\\n\\n\\nYou can use the Log Analytics Container Monitoring solution to:\\n\\n\\n  - See information about all c\", \"ontainer hosts in a single location.\\n\\n\\n  - Know which containers are running, what image they\\u2019re run\", \"ning, and where they\\u2019re running.\\n\\n\\n  - See an audit trail for actions on containers.\\n\\n\\n  - Troublesh\", \"oot by viewing and searching centralized logs without remote login to the Docker\\nhosts.\\n\\n\\n  - Find c\", \"ontainers that might be \\u201cnoisy neighbors,\\u201d and be consuming excess resources on a\\nhost.\\n\\n\\n33 CHAPTER\", \" 3 | Modernize existing .NET apps to Cloud-Optimized applications\\n\\n\\n  - View centralized CPU, memory\", \", storage, and network usage, and performance information, for\\ncontainers.\\n\\n\\n**Additional resources*\", \"*\\n\\n\\n  - **Overview of monitoring in Microsoft Azure**\\n\\n\\n[https://learn.microsoft.com/azure/azure-mon\", \"itor/overview](https://docs.microsoft.com/azure/azure-monitor/overview)\\n\\n\\n  - **What is Application \", \"Insights?**\\n\\n\\n[https://learn.microsoft.com/azure/azure-monitor/app/app-insights-overview](https://do\", \"cs.microsoft.com/azure/azure-monitor/app/app-insights-overview)\\n\\n\\n  - **What is Log Analytics?**\\n\\n\\n[\", \"https://learn.microsoft.com/azure/log-analytics/log-analytics-overview](https://docs.microsoft.com/a\", \"zure/log-analytics/log-analytics-overview)\\n\\n\\n  - **Container Monitoring solution in Azure Monitor**\\n\", \"\\n[https://learn.microsoft.com/azure/azure-monitor/insights/containers](https://docs.microsoft.com/az\", \"ure/azure-monitor/insights/containers)\\n\\n\\n  - **Overview of Azure Monitor**\\n\\n\\n[https://learn.microsof\", \"t.com/azure/azure-monitor/overview](https://docs.microsoft.com/azure/azure-monitor/overview)\\n\\n\\n  - *\", \"*What is Operations Management Suite (OMS)?**\\n\\n\\n[https://learn.microsoft.com/azure/operations-manage\", \"ment-suite/operations-management-suite-](https://docs.microsoft.com/azure/operations-management-suit\", \"e/operations-management-suite-overview)\\n[overview](https://docs.microsoft.com/azure/operations-manag\", \"ement-suite/operations-management-suite-overview)\\n\\n### Modernize your app\\u2019s lifecycle with CI/CD pip\", \"elines and DevOps tools in the cloud\\n\\n\\nToday\\u2019s businesses need to innovate at a rapid pace to be com\", \"petitive in the marketplace. Delivering\\nhigh-quality, modern applications requires DevOps tools and \", \"processes that are critical to implement\\nthis constant cycle of innovation. With the right DevOps to\", \"ols, developers can streamline continuous\\ndeployment and get innovative applications into the hands \", \"of users more quickly.\\n\\n\\nAlthough continuous integration and deployment practices are well establish\", \"ed, the introduction of\\ncontainers introduces new considerations, particularly when you are working \", \"with multi-container\\napplications.\\n\\n\\nAzure DevOps Services supports continuous integration and deplo\", \"yment of multi-container\\napplications to various environments through the official Azure DevOps Serv\", \"ices deployment tasks:\\n\\n\\n  - [Deploy to an Azure Web App for Containers](https://docs.microsoft.com/\", \"azure/devops/pipelines/apps/cd/deploy-docker-webapp?tabs=dotnet-core)\\n\\n\\n  - [Deploy to Azure Kuberne\", \"tes Service](https://docs.microsoft.com/azure/devops/pipelines/apps/cd/deploy-aks?tabs=dotnet-core)\\n\", \"\\n\\n[But you can also deploy to Docker Swarm](https://blog.jcorioland.io/archives/2016/11/29/full-ci-c\", \"d-pipeline-to-deploy-multi-containers-application-on-azure-container-service-docker-swarm-using-visu\", \"al-studio-team-services.html) or DC/OS by using Azure DevOps Services script-based\\ntasks.\\n\\n\\n34 CHAPT\", \"ER 3 | Modernize existing .NET apps to Cloud-Optimized applications\\n\\n\\nTo continue facilitating deplo\", \"yment agility, these tools provide excellent dev-to-test-to-production\\ndeployment experiences for co\", \"ntainer workloads, with a choice of development and CI/CD solutions.\\n\\n\\nFigure 4-12 shows a continuou\", \"s deployment pipeline that deploys to a Kubernetes cluster in Azure\\nContainer Service.\\n\\n\\n_Figure 4-1\", \"2. Azure DevOps Services continuous deployment pipeline, deploying to a Kubernetes cluster_\\n\\n### Mig\", \"rate to hybrid cloud scenarios\\n\\n\\nSome organizations and enterprises can\\u2019t migrate some of their appl\", \"ications to public clouds like\\nMicrosoft Azure or any other public cloud due to regulations or their\", \" own policies. However, it\\u2019s likely\\nthat any organization might benefit from having some of their ap\", \"plications in the public cloud and\\nother applications on-premises. But a mixed environment can lead \", \"to excessive complexity in\\nenvironments due to different platforms and technologies used in public c\", \"louds versus on-premises\\nenvironments.\\n\\n\\nMicrosoft provides the best hybrid cloud solution, one in w\", \"hich you can optimize your existing assets\\non-premises and in the public cloud, while you ensure con\", \"sistency in an Azure hybrid cloud. You can\\nmaximize existing skills, and get a flexible, unified app\", \"roach to building apps that can run in the cloud\\nor on-premises, thanks to Azure Stack (on-premises)\", \" and Azure (public cloud).\\n\\n\\nWhen it comes to security, you can centralize management and security a\", \"cross your hybrid cloud. You\\ncan get control over all assets, from your datacenter to the cloud, by \", \"providing single sign-on to onpremises and cloud apps. You accomplish this functionality by extendin\", \"g Active Directory to a hybrid\\ncloud, and by using identity management.\\n\\n\\nFinally, you can distribut\", \"e and analyze data seamlessly, use the same query languages for cloud and\\non-premises assets, and ap\", \"ply analytics and deep learning in Azure to enrich your data, regardless of\\nits source.\\n\\n#### **Azur\", \"e Stack**\\n\\n\\nAzure Stack is a hybrid cloud platform that lets you deliver Azure services from your or\", \"ganization\\u2019s\\ndatacenter. Azure Stack is designed to support new options for your modern applications\", \" in key\\n\\n\\n35 CHAPTER 3 | Modernize existing .NET apps to Cloud-Optimized applications\\n\\n\\nscenarios, l\", \"ike edge and unconnected environments, or meeting specific security and compliance\\nrequirements.\\n\\n\\nF\", \"igure 4-13 shows an overview of the true hybrid cloud platform that Microsoft offers.\\n\\n\\n_Figure 4-13\", \". Microsoft hybrid cloud platform with Azure Stack and Azure_\\n\\n\\nAzure Stack is offered in two deploy\", \"ment options, to meet your needs:\\n\\n\\n  - Azure Stack integrated systems\\n\\n\\n  - Azure Stack Development\", \" Kit\\n\\n\\n**Azure Stack integrated systems**\\n\\n\\nAzure Stack integrated systems are offered through a par\", \"tnership of Microsoft and hardware partners.\\nThe partnership creates a solution that offers cloud-pa\", \"ced innovation that is balanced with simplicity\\nin management. Because Azure Stack is offered as an \", \"integrated system of hardware and software,\\nyou get the right amount of flexibility and control, whi\", \"le still adopting innovation from the cloud.\\nAzure Stack integrated systems range in size from 4 to \", \"12 nodes, and are jointly supported by the\\nhardware partner and Microsoft. Use Azure Stack integrate\", \"d systems to implement new scenarios for\\nyour production workloads.\\n\\n\\n**Azure Stack Development Kit*\", \"*\\n\\n\\nMicrosoft Azure Stack Development Kit is a single-node deployment of Azure Stack, which you can\\n\", \"use to evaluate and learn about Azure Stack. You can also use Azure Stack Development Kit as a\\n\\n\\n36 \", \"CHAPTER 3 | Modernize existing .NET apps to Cloud-Optimized applications\\n\\n\\ndeveloper environment, wh\", \"ere you can develop using APIs and tooling that are consistent with Azure.\\nAzure Stack Development K\", \"it is not intended to be used as a production environment.\\n\\n\\n**Additional resources**\\n\\n\\n  - **Azure \", \"hybrid cloud**\\n\\n\\n[https://azure.microsoft.com/overview/hybrid-cloud/](https://azure.microsoft.com/ov\", \"erview/hybrid-cloud/)\\n\\n\\n  - **Azure Stack**\\n\\n\\n[https://azure.microsoft.com/overview/azure-stack/](ht\", \"tps://azure.microsoft.com/overview/azure-stack/)\\n\\n\\n  - **Active Directory Service Accounts for Windo\", \"ws Containers**\\n\\n\\n[https://learn.microsoft.com/virtualization/windowscontainers/manage-containers/ma\", \"nage-](https://docs.microsoft.com/virtualization/windowscontainers/manage-containers/manage-servicea\", \"ccounts)\\n[serviceaccounts](https://docs.microsoft.com/virtualization/windowscontainers/manage-contai\", \"ners/manage-serviceaccounts)\\n\\n\\n  - **Create a container with Active Directory support**\\n\\n\\n[https://l\", \"earn.microsoft.com/archive/blogs/containerstuff/create-a-container-with-active-](https://docs.micros\", \"oft.com/archive/blogs/containerstuff/create-a-container-with-active-directory-support)\\n[directory-su\", \"pport](https://docs.microsoft.com/archive/blogs/containerstuff/create-a-container-with-active-direct\", \"ory-support)\\n\\n\\n  - **Azure Hybrid Benefit licensing**\\n\\n\\n[https://azure.microsoft.com/pricing/hybrid-\", \"benefit/](https://azure.microsoft.com/pricing/hybrid-benefit/)\\n\\n\\n37 CHAPTER 3 | Modernize existing .\", \"NET apps to Cloud-Optimized applications\\n\\n\\n**CHAPTER**\\n# 4\\n\\n## Walkthroughs and technical get starte\", \"d overview\\n\\n\\nTo limit the size of this e-book, additional technical documentation and the full walkt\", \"hroughs were\\nmade available in a GitHub repository. The online series of walkthroughs that is descri\", \"bed in this\\nchapter covers the step-by-step setup of the multiple environments that are based on Win\", \"dows\\nContainers, and deployment to Azure.\\n\\n\\nThe following sections explain what each walkthrough is \", \"about, its objectives and high-level vision,\\nand provides a diagram of the tasks that are involved. \", \"You can get the walkthroughs themselves in the\\n_eShopModernizing_ apps GitHub repo wiki at https://g\", \"ithub.com/dotnet[architecture/eShopModernizing/wiki.](https://github.com/dotnet-architecture/eShopMo\", \"dernizing/wiki)\\n\\n### Technical walkthrough list\\n\\n\\nThe following get-started walkthroughs provide con\", \"sistent and comprehensive technical guidance for\\nsample apps that you can lift and shift by using co\", \"ntainers, and then move by using multiple\\ndeployment choices in Azure.\\n\\n\\nEach of the following walkt\", \"hroughs uses the new sample eShopLegacy and eShopModernizing apps,\\n[which are available on GitHub at\", \" https://github.com/dotnet-architecture/eShopModernizing.](https://github.com/dotnet-architecture/eS\", \"hopModernizing)\\n\\n\\n  - **Tour of eShop legacy apps (baseline apps to modernize)**\\n\\n\\n  - **Containeriz\", \"e your existing ASP.NET web apps (WebForms & MVC) with Windows**\\n**Containers**\\n\\n\\n  - **Containerize\", \" your existing WCF services (N-Tier apps) with Windows Containers**\\n\\n\\n  - **Deploy your Windows Cont\", \"ainers-based app to Azure VMs**\\n\\n\\n  - **Deploy your Windows Containers-based apps to Kubernetes in A\", \"zure Container Service**\\n\\n\\n38 CHAPTER 4 | Walkthroughs and technical get started overview\\n\\n\\n### Walk\", \"through 1: Tour of eShop legacy apps\\n\\n#### **Technical walkthrough availability**\\n\\nThe full technica\", \"l walkthrough is available in the eShopModernizing GitHub repo wiki:\\n\\n\\n[eShopModernizing wiki walkth\", \"roughs](https://github.com/dotnet-architecture/eShopModernizing/wiki)\\n\\n#### **Overview**\\n\\n\\nIn this w\", \"alkthrough, you can explore the initial implementation of three sample legacy applications.\\nThe firs\", \"t two sample web apps have a monolithic architecture, and were created by using classic\\nASP.NET. One\", \" application is based on ASP.NET 4.x MVC; the second application is based on ASP.NET\\n4.x Web Forms. \", \"The third app is a 3-Tier app composed by a client WinForms app and a server-side\\n[Windows Communica\", \"tion Foundation (WCF) service.](https://docs.microsoft.com/en-us/dotnet/framework/wcf/whats-wcf)\\n\\n\\n[\", \"All these applications are available at the eShopModernizing GitHub repo.](https://github.com/dotnet\", \"-architecture/eShopModernizing)\\n\\n#### **Goals**\\n\\n\\nThe main goal of this walkthrough is simply to get\", \" familiar with these apps, and with their code and\\nconfiguration. You can configure the apps so that\", \" they generate and use mock data, without using the\\nSQL database, for testing purposes. This optiona\", \"l config is based on dependency injection, in a\\ndecoupled way.\\n\\n#### **Scenario 1: ASP.NET Web apps*\", \"*\\n\\n\\nThe figure below shows the simple scenario of the original legacy ASP.NET web applications.\\n\\n\\n39\", \" CHAPTER 4 | Walkthroughs and technical get started overview\\n\\n\\nFrom a business domain perspective, b\", \"oth apps offer the same catalog management features.\\nMembers of the eShop enterprise team would use \", \"the app to view and edit the product catalog.\\n\\n\\nThe next figure shows the initial app screenshots.\\n\\n\", \"\\nDependencies in ASP.NET 4.x or earlier versions (either for MVC or for Web Forms) means that these\\n\", \"applications won\\u2019t run on .NET Core unless the code is fully rewritten by using ASP.NET Core MVC.\\n\\n#\", \"### **Scenario 2: WCF service and WinForms client app (3-Tier app)**\\n\\n\\nThe figure below shows the si\", \"mple scenario of the original 3-Tier legacy application.\\n\\n\\n40 CHAPTER 4 | Walkthroughs and technical\", \" get started overview\\n\\n\\n#### **Benefits**\\n\\nThe benefits of this walkthrough are simple: Just get fam\", \"iliar with the code and initial apps.\\n\\n#### **Next steps**\\n\\n\\nExplore this content more in-depth on t\", \"he GitHub wiki:\\n\\n\\n  - [Tour on the baseline ASP.NET MVC and Web Forms \\u201clegacy\\u201d apps](https://github.\", \"com/dotnet-architecture/eShopModernizing/wiki/01.-Tour-on-the-ASP.NET-MVC-and-WebForms-apps-implemen\", \"tation-code)\\n\\n  - [Tour on the baseline WCF service and WinForms (3-Tier) \\u201clegacy\\u201d app](https://gith\", \"ub.com/dotnet-architecture/eShopModernizing/wiki/21.-Tour-on-the-WCF-service-and-WinForms-apps)\\n\\n###\", \" Walkthrough 2: Containerize your existing .NET applications with Windows Containers\\n\\n#### **Overvie\", \"w**\\n\\n\\nUse Windows Containers to improve deployment of existing .NET applications, like those based o\", \"n\\nMVC, Web Forms, or WCF, to production, development, and test environments.\\n\\n#### **Goals**\\n\\n\\nThe g\", \"oal of this walkthrough is to show you several options for containerizing an existing .NET\\nFramework\", \" application. You can:\\n\\n\\n  - [Containerize your application by using Visual Studio 2022 Tools for Do\", \"cker](https://docs.microsoft.com/aspnet/core/host-and-deploy/docker/visual-studio-tools-for-docker) \", \"(Visual Studio\\n2017 or later versions).\\n\\n\\n  - [Containerize your application by manually adding a Do\", \"ckerfile, and then using the Docker CLI.](https://docs.docker.com/engine/reference/builder/)\\n\\n\\n  - [\", \"Containerize your application by using the Img2Docker](https://github.com/docker/communitytools-imag\", \"e2docker-win) tool (an open-source tool from\\nDocker).\\n\\n\\n41 CHAPTER 4 | Walkthroughs and technical ge\", \"t started overview\\n\\n\\nThis walkthrough focuses on the Visual Studio 2022 Tools for Docker approach, b\", \"ut the other two\\napproaches are fairly similar in regard to using Dockerfiles.\\n\\n#### **Scenario 1: C\", \"ontainerized ASP.NET web apps**\\n\\n\\nFigure below shows the scenario for containerized eShop legacy web\", \" apps applications.\\n\\n#### **Scenario 2: Containerized WCF service**\\n\\n\\nFigure below shows the scenari\", \"o for a 3-Tier app with a containerized WCF service.\\n\\n\\n42 CHAPTER 4 | Walkthroughs and technical get\", \" started overview\\n\\n\\n#### **Benefits**\\n\\nThere are advantages to running your monolithic application i\", \"n a container. First, you create an image\\nfor the application. From that point on, every deployment \", \"runs in the same environment. Every\\ncontainer uses the same OS version, has the same version of depe\", \"ndencies installed, uses the same\\n.NET framework version, and is built by using the same process. Ba\", \"sically, you control the\\ndependencies of your application by using a Docker image. The dependencies \", \"travel with the\\napplication when you deploy the containers.\\n\\n\\nAn additional benefit is that develope\", \"rs can run the application in the consistent environment that\\u2019s\\nprovided by Windows Containers. Issu\", \"es that appear only with certain versions can be spotted\\nimmediately, instead of surfacing in a stag\", \"ing or production environment. Differences in development\\nenvironments used by members of the develo\", \"pment team matter less when applications run in\\ncontainers.\\n\\n\\nContainerized applications also have a\", \" flatter scale-out curve. Containerized apps enable you to have\\nmore application and service instanc\", \"es (based on containers) in a VM or physical machine compared\\nto regular application deployments per\", \" machine. This approach translates to higher density and fewer\\nrequired resources, especially when y\", \"ou use orchestrators like Kubernetes.\\n\\n\\nContainerization, in ideal situations, does not require maki\", \"ng any changes to the application code\\n(C#). In most scenarios, you just need the Docker deployment \", \"metadata files (Dockerfiles and Docker\\nCompose files).\\n\\n#### **Next steps**\\n\\n\\nExplore this content m\", \"ore in-depth on the GitHub wiki:\\n\\n\\n  - [How to containerize the .NET Framework web apps with Windows\", \" Containers and Docker](https://github.com/dotnet-architecture/eShopModernizing/wiki/02.-How-to-cont\", \"ainerize-the-.NET-Framework-web-apps-with-Windows-Containers-and-Docker)\\n\\n  - [Adding Docker Support\", \" to a WCF service](https://github.com/dotnet-architecture/eShopModernizing/wiki/22.-Adding-Docker-Su\", \"pport)\\n\\n\\n43 CHAPTER 4 | Walkthroughs and technical get started overview\\n\\n\\n### Walkthrough 3: Deploy \", \"your Windows Containers- based app to Azure VMs\\n\\n#### **Technical walkthrough availability**\\n\\nThe fu\", \"ll technical walkthrough is available in the eShopModernizing GitHub repo wiki:\\n[https://github.com/\", \"dotnet-architecture/eShopModernizing/wiki/06.-Deploying-your-Windows-](https://github.com/dotnet-arc\", \"hitecture/eShopModernizing/wiki/06.-Deploying-your-Windows-Containers-based-app-into-Azure-VMs-(Incl\", \"uding-CI-CD))\\n[Containers-based-app-into-Azure-VMs-(Including-CI-CD)](https://github.com/dotnet-arch\", \"itecture/eShopModernizing/wiki/06.-Deploying-your-Windows-Containers-based-app-into-Azure-VMs-(Inclu\", \"ding-CI-CD))\\n\\n#### **Overview**\\n\\n\\nDeploying to a Docker host on a Windows Server 2016 Virtual Machin\", \"e (VM) in Azure lets you quickly\\nset up development/test/staging environments. It also gives you a c\", \"ommon place for testers or\\nbusiness users to validate the app. VMs also can be valid Infrastructure \", \"as a Service (IaaS) production\\nenvironments.\\n\\n#### **Goals**\\n\\n\\nThe goal of this walkthrough is to sh\", \"ow you the multiple alternatives you have when you deploy\\nWindows Containers to Azure VMs that are b\", \"ased on Windows Server 2016 or later versions.\\n\\n#### **Scenarios**\\n\\n\\nSeveral scenarios are covered i\", \"n this walkthrough.\\n\\n\\n44 CHAPTER 4 | Walkthroughs and technical get started overview\\n\\n\\n**Scenario A:\", \" Deploy to an Azure VM from a dev PC through Docker Engine**\\n**connection**\\n\\n\\n_Figure 5-4. Deploy to\", \" an Azure VM from a dev PC through a Docker Engine connection_\\n\\n\\n**Scenario B: Deploy to an Azure VM\", \" through a Docker Registry**\\n\\n\\n_Figure 5-5. Deploy to an Azure VM through a Docker Registry_\\n\\n\\n45 CH\", \"APTER 4 | Walkthroughs and technical get started overview\\n\\n\\n**Scenario C: Deploy to an Azure VM from\", \" CI/CD pipelines in Azure DevOps Services**\\n\\n\\n_Figure 5-6. Deploy to an Azure VM from CI/CD pipeline\", \"s in Azure DevOps Services_\\n\\n#### **Azure VMs for Windows Containers**\\n\\n\\nAzure VMs for Windows Conta\", \"iners are VMs based on Windows Server 2016, Windows 10, or later\\nversions, both with Docker Engine s\", \"et up. In most cases, Windows Server 2016 is used in the Azure\\nVMs.\\n\\n\\nAzure currently provides a VM \", \"named **Windows Server 2016 with Containers** . You can use this VM\\nto try the new Windows Server Co\", \"ntainer feature, with either Windows Server Core or Windows Nano\\nServer. Container OS images are ins\", \"talled, and then the VM is ready to use with Docker.\\n\\n#### **Benefits**\\n\\n\\nAlthough Windows Container\", \"s can be deployed to on-premises Windows Server 2016 VMs, when you\\ndeploy to Azure, you get an easie\", \"r way to get started, with ready-to-use Windows Server Container\\nVMs. You also get a common online l\", \"ocation that\\u2019s accessible to testers, and automatic scalability\\nthrough Azure virtual machine scale \", \"sets.\\n\\n#### **Next steps**\\n\\n\\nExplore this content more in-depth on the GitHub wiki:\\n\\n\\n[https://githu\", \"b.com/dotnet-architecture/eShopModernizing/wiki/06.-Deploying-your-Windows-](https://github.com/dotn\", \"et-architecture/eShopModernizing/wiki/06.-Deploying-your-Windows-Containers-based-app-into-Azure-VMs\", \"-(Including-CI-CD))\\n[Containers-based-app-into-Azure-VMs-(Including-CI-CD)](https://github.com/dotne\", \"t-architecture/eShopModernizing/wiki/06.-Deploying-your-Windows-Containers-based-app-into-Azure-VMs-\", \"(Including-CI-CD))\\n\\n\\n46 CHAPTER 4 | Walkthroughs and technical get started overview\\n\\n\\n### Walkthroug\", \"h 4: Deploy your Windows Containers- based apps to Azure Container Instances (ACI)\\n\\n#### **Technical\", \" walkthrough availability**\\n\\nThe full technical walkthrough is available in the eShopModernizing Git\", \"Hub repo wiki:\\n\\n\\n[Deploying the Apps to ACI (Azure Container Instances)](https://github.com/dotnet-a\", \"rchitecture/eShopModernizing/wiki/05.-Deploying-the-Apps-to-ACI-(Azure-Container-Instances))\\n\\n#### *\", \"*Overview**\\n\\n\\n[Azure Container Instances (ACI) is the quickest way to have a Containers dev/test/sta\", \"ging](https://docs.microsoft.com/azure/container-instances/)\\nenvironment where you can deploy single\", \" instances of containers.\\n\\n#### **Goals**\\n\\n\\nThis walkthrough shows you the main scenarios when deplo\", \"ying Windows Containers to Azure\\nContainer Instances (ACI) and how you can deploy eShopModernizing A\", \"pps into ACI.\\n\\n#### **Scenarios**\\n\\n\\nThere can be variations about deploying the eShopModernizing app\", \"s into ACI such as deploying just\\none or all of the apps (MVC app, WebForms app or WCF service). In \", \"the following scenario shown\\nbelow, you can see the ASP.NET MVC app plus the SQL Server container bo\", \"th of them deployed as\\ncontainers into ACI (Azure Container Instances).\\n\\n#### **Benefits**\\n\\n\\nAzure C\", \"ontainer Instances makes it easy to create and manage Docker containers in Azure, without\\nhaving to \", \"provision virtual machines or adopt a higher-level service. With ACI, you can directly deploy\\na Wind\", \"ows container in Azure and expose it to the internet with a fully qualified domain name (FQDN)\\n\\n\\n47 \", \"CHAPTER 4 | Walkthroughs and technical get started overview\\n\\n\\nin a matter of seconds (Provided that \", \"you have the Windows Container image ready in a Docker\\nregistry like Docker Hub or Azure Container R\", \"egistry).\\n\\n#### **Considerations**\\n\\n\\nDeploying Windows Containers with either full .NET Framework / \", \"ASP.NET or SQL Server into Azure\\nContainer Instances (ACI) is not quite as fast as deploying to a re\", \"gular Docker Host (like a Windows\\nServer 2016 with Windows Containers) because the Docker image has \", \"to be downloaded (pulled from\\nthe Docker registry) every time and the sizes of the SQL container ima\", \"ge (15.1 GB) and the ASP.NET\\ncontainer image (13.9 GB) are significantly large, however it is much c\", \"heaper than maintaining your\\nown docker host (permanently on-line Windows Server 2016 with Windows C\", \"ontainers VM in Azure)\\nnot to mention a whole orchestrator like Kubernetes in Azure (AKS) which is, \", \"on the other hand, a\\ngreat choice for production deployments.\\n\\n\\nAs the main conclusion, using Azure \", \"Container Instances is a very compelling option for Dev/Test\\nscenarios and for CI/CD pipelines.\\n\\n###\", \"# **Next steps**\\n\\n\\nExplore this content more in-depth on the GitHub wiki:\\n\\n\\n[https://github.com/dotn\", \"et-architecture/eShopModernizing/wiki/05.-Deploying-the-Apps-to-ACI-](https://github.com/dotnet-arch\", \"itecture/eShopModernizing/wiki/05.-Deploying-the-Apps-to-ACI-(Azure-Container-Instances))\\n[(Azure-Co\", \"ntainer-Instances)](https://github.com/dotnet-architecture/eShopModernizing/wiki/05.-Deploying-the-A\", \"pps-to-ACI-(Azure-Container-Instances))\\n\\n### Walkthrough 5: Deploy your Windows Containers- based ap\", \"ps to Kubernetes in Azure Container Service\\n\\n#### **Technical walkthrough availability**\\n\\n\\nThe full \", \"technical walkthrough is available in the eShopModernizing GitHub repo wiki:\\n\\n\\n[https://github.com/d\", \"otnet-architecture/eShopModernizing/wiki/04.-How-to-deploy-your-Windows-](https://github.com/dotnet-\", \"architecture/eShopModernizing/wiki/04.-How-to-deploy-your-Windows-Containers-based-apps-into-Kuberne\", \"tes-in-Azure-Container-Service-(Including-CI-CD))\\n[Containers-based-apps-into-Kubernetes-in-Azure-Co\", \"ntainer-Service-(Including-CI-CD)](https://github.com/dotnet-architecture/eShopModernizing/wiki/04.-\", \"How-to-deploy-your-Windows-Containers-based-apps-into-Kubernetes-in-Azure-Container-Service-(Includi\", \"ng-CI-CD))\\n\\n#### **Overview**\\n\\n\\nAn application that\\u2019s based on Windows Containers will quickly need \", \"to use platforms, moving even\\nfurther away from IaaS VMs. This approach is needed to easily achieve \", \"high scalability and better\\nautomated scalability, and for a significant improvement in automated de\", \"ployments and versioning.\\n[You can achieve these goals by using the orchestrator Kubernetes, availab\", \"le in Azure Container](https://kubernetes.io/)\\n[Services.](https://azure.microsoft.com/services/cont\", \"ainer-service/)\\n\\n\\n48 CHAPTER 4 | Walkthroughs and technical get started overview\\n\\n\\n#### **Goals**\\n\\nT\", \"he goal of this walkthrough is to learn how to deploy a Windows Container\\u2013based application to\\nKuber\", \"netes (also called _K8s_ ) in Azure Container Service. Deploying to Kubernetes from scratch is a\\ntwo\", \"-step process:\\n\\n\\n1. Deploy a Kubernetes cluster to Azure Container Service.\\n\\n\\n2. Deploy the applicat\", \"ion and related resources to the Kubernetes cluster.\\n\\n#### **Scenarios**\\n\\n\\n**Scenario A: Deploy dire\", \"ctly to a Kubernetes cluster from a dev environment**\\n\\n\\n_Figure 5-7. Deploy directly to a Kubernetes\", \" cluster from a development environment_\\n\\n\\n49 CHAPTER 4 | Walkthroughs and technical get started ove\", \"rview\\n\\n\\n**Scenario B: Deploy to a Kubernetes cluster from CI/CD pipelines in Azure DevOps**\\n**Servic\", \"es**\\n\\n\\n_Figure 5-8. Deploy to a Kubernetes cluster from CI/CD pipelines in Azure DevOps Services_\\n\\n#\", \"### **Benefits**\\n\\n\\nThere are many benefits to deploying to a cluster in Kubernetes. The biggest bene\", \"fit is that you get a\\nproduction-ready environment in which you can scale out the application based \", \"on the number of\\ncontainer instances you want to use (inner-scalability in the existing nodes), and \", \"based on the number\\nof nodes or VMs in the cluster (global scalability of the cluster).\\n\\n\\nAzure Cont\", \"ainer Service optimizes popular open-source tools and technologies specifically for Azure.\\nYou get a\", \"n open solution that offers portability, both for your containers and for your application\\nconfigura\", \"tion. You select the size, the number of hosts, and the orchestrator tools-Container Service\\nhandles\", \" everything else.\\n\\n\\nWith Kubernetes, developers can progress from thinking about physical and virtua\", \"l machines, to\\nplanning a container-centric infrastructure that facilitates the following capabiliti\", \"es, among others:\\n\\n\\n  - Applications based on multiple containers\\n\\n\\n  - Replicating container instan\", \"ces and horizontal autoscaling\\n\\n\\n  - Naming and discovering (for example, internal DNS)\\n\\n\\n  - Balanc\", \"ing loads\\n\\n\\n50 CHAPTER 4 | Walkthroughs and technical get started overview\\n\\n\\n  - Rolling updates\\n\\n\\n \", \" - Distributing secrets\\n\\n\\n  - Application health checks\\n\\n#### **Next steps**\\n\\n\\n[Explore this content\", \" more in-depth on the GitHub wiki: https://github.com/dotnet-](https://github.com/dotnet-architectur\", \"e/eShopModernizing/wiki/04.-How-to-deploy-your-Windows-Containers-based-apps-into-Kubernetes-in-Azur\", \"e-Container-Service-(Including-CI-CD))\\n[architecture/eShopModernizing/wiki/04.-How-to-deploy-your-Wi\", \"ndows-Containers-based-apps-into-](https://github.com/dotnet-architecture/eShopModernizing/wiki/04.-\", \"How-to-deploy-your-Windows-Containers-based-apps-into-Kubernetes-in-Azure-Container-Service-(Includi\", \"ng-CI-CD))\\n[Kubernetes-in-Azure-Container-Service-(Including-CI-CD)](https://github.com/dotnet-archi\", \"tecture/eShopModernizing/wiki/04.-How-to-deploy-your-Windows-Containers-based-apps-into-Kubernetes-i\", \"n-Azure-Container-Service-(Including-CI-CD))\\n\\n### Walkthrough 6: Deploy your Windows Containers- bas\", \"ed apps to Azure App Service for Containers\\n\\n#### **Technical walkthrough availability**\\n\\n\\nThe full \", \"technical walkthrough is available in the eShopModernizing GitHub repo wiki:\\n\\n\\n[https://github.com/d\", \"otnet-architecture/eShopModernizing/wiki/Deploy-Windows-Container-to-](https://github.com/dotnet-arc\", \"hitecture/eShopModernizing/wiki/Deploy-Windows-Container-to-Azure-App-Service)\\n[Azure-App-Service](h\", \"ttps://github.com/dotnet-architecture/eShopModernizing/wiki/Deploy-Windows-Container-to-Azure-App-Se\", \"rvice)\\n\\n#### **Overview**\\n\\n\\nA simple containerized application using Windows Containers can easily b\", \"e deployed to Azure App\\nService for Containers. This approach is the recommended approach for most W\", \"indows Containerbased applications.\\n\\n#### **Goals**\\n\\n\\nThe goal of this walkthrough is to learn how t\", \"o deploy a Windows Container\\u2013based application to\\nAzure App Service for Containers from a registry (\", \"Docker Hub or Azure Container Registry).\\n\\n\\n51 CHAPTER 4 | Walkthroughs and technical get started ove\", \"rview\\n\\n\\n#### **Scenario** **Benefits**\\n\\nDeploying to Azure App Service for Containers offers the ben\", \"efits of containers paired with the PaaS\\nbenefits of Azure App Service. The app service can easily b\", \"e scaled both vertically and horizontally,\\nand can be configured to autoscale to meet changing deman\", \"ds. Updates can be performed with zero\\ndowntime and the configuration of continuous deployment from \", \"a registry is easily configured as well.\\n\\n#### **Next steps**\\n\\n\\n[Explore this content more in-depth \", \"on the GitHub wiki: https://github.com/dotnet-](https://github.com/dotnet-architecture/eShopModerniz\", \"ing/wiki/Deploy-Windows-Container-to-Azure-App-Service)\\n[architecture/eShopModernizing/wiki/Deploy-W\", \"indows-Container-to-Azure-App-Service](https://github.com/dotnet-architecture/eShopModernizing/wiki/\", \"Deploy-Windows-Container-to-Azure-App-Service)\\n\\n\\n52 CHAPTER 4 | Walkthroughs and technical get start\", \"ed overview\\n\\n\\n**CHAPTER**\\n# 5\\n\\n## Conclusions\\n\\n\\n  - Container-based solutions ultimately provide cos\", \"t savings benefits. Containers are a solution\\nto deployment problems because they remove the frictio\", \"n caused by an absence of\\ndependencies in production environments. By removing those issues, it impr\", \"oves Dev/Test,\\nDevOps, and production operations significantly.\\n\\n\\n  - A Docker container is becoming\", \" the standard unit of deployment for any server-based\\napplication or service.\\n\\n\\n  - For production e\", \"nvironments, you should use an orchestrator (like Kubernetes) to host\\nscalable containers\\u2013based appl\", \"ications.\\n\\n\\n  - Azure VMs hosting containers are a fast and simple way to create small Dev/Test\\nenvi\", \"ronments in the cloud.\\n\\n\\n  - Azure SQL Database Managed Instance is recommended by default when migr\", \"ating your\\nrelational databases from existing applications to Azure.\\n\\n\\n  - Visual Studio 2022 and Im\", \"age2Docker are basic tools for you to start modernizing your\\nexisting .NET applications with Windows\", \" Containers by accelerating the getting started\\nlearning curve.\\n\\n\\n  - When placing containerized app\", \"lications in production you will always create or adopt a\\nDevOps culture and DevOps tools for CI/CD \", \"pipelines, like Azure DevOps Services or Jenkins.\\n\\n\\n  - Microsoft Azure provides the most comprehens\", \"ive and complete environment to modernize\\nyour existing .NET Framework applications with Windows Con\", \"tainers, cloud infrastructure and\\nPaaS services.\\n\\n\\n53 CHAPTER 5 | Conclusions\\n\\n\\n\"]"