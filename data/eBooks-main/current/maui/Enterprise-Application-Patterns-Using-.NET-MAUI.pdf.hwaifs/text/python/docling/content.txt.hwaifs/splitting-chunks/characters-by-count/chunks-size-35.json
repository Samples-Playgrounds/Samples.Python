"[\"## Patterns using .NET MAUI\\n\\nMichael Stonis\\n\\nDOWNLOAD available at: https://aka.ms/maui-ebook\\n\\n## ED\", \"ITION v2.0\\n\\nPUBLISHED BY\\n\\nMicrosoft Developer Division, .NET, and Visual Studio product teams\\n\\nA div\", \"ision of Microsoft Corporation\\n\\nOne Microsoft Way\\n\\nRedmond, Washington 98052-6399\\n\\nCopyright \\u00a9 2022 \", \"by Microsoft Corporation\\n\\nAll rights reserved. No part of the contents of this book may be reproduce\", \"d or transmitted in any form or by any means without the written permission of the publisher.\\n\\nThis \", \"book is provided 'as -is' and expresses the author's views and opinions. The views, opinions, and in\", \"formation expressed in this book, including URL and other Internet website references, may change wi\", \"thout notice.\\n\\nSome examples depicted herein are provided for illustration only and are fictitious. \", \"No real association or connection is intended or should be inferred.\\n\\nMicrosoft and the trademarks l\", \"isted at https://www.microsoft.com on the 'Trademarks' webpage are trademarks of the Microsoft group\", \" of companies.\\n\\nMac and macOS are trademarks of Apple Inc.\\n\\nAll other marks and logos are property o\", \"f their respective owners.\\n\\nAuthors:\\n\\nMichael Stonis , Mobile Software Architect, Eight-Bot\\n\\nReviewe\", \"rs:\\n\\nJames Montemagno , Principal Lead Program Manager, Microsoft Corp.\\n\\nDavid Pine , Developer Rela\", \"tions, Microsoft Corp.\\n\\n## Acknowledgments\\n\\nThis book originated from the excellent Enterprise Appli\", \"cation Patterns using Xamarin.Forms eBook by David Britch and Javier Suarez Ruiz. Without their hard\", \" work, detailed information, and excellent examples, this book would not be possible.\\n\\n## Introducti\", \"on\\n\\nEnterprise applications face a number of difficult problems to solve including ever changing bus\", \"iness requirements, the need for quick turn around time, support for multiple platforms, and integra\", \"tion with multiple systems. Due to the varying nature of the se problems, it's important that our ap\", \"plication's architecture allows it to be modular, modifiable and extensible over time.\\n\\nThis book ta\", \"kes provides real world solutions for addressing these issues when building an enterprise applicatio\", \"n using .NET MAUI. This book uses a pre-built .NET MAUI application that serves as the front-end of \", \"an online eCommerce application as a reference and a guide for common enterprise design patterns. Th\", \"is book covers topics such as the MVVM pattern, dependency injection, navigation, configuration, the\", \" loose-coupling of components and additional enterprise concerns. The content of this book is helpfu\", \"l for anyone looking to build a new application for this business or looking to solve the problems o\", \"f applications that evolve over time.\\n\\n## Who should use the book\\n\\nThis book is for .NET MAUI develo\", \"pers that are already familiar with the framework, but that are looking for guidance on architecture\", \" and implementation when building enterprise applications. This book can help developers solve commo\", \"n problems using tried and true patterns.\\n\\n## How to use the book\\n\\nThis book focuses on building cro\", \"ss-platform enterprise apps using .NET MAUI. As such, it should be read in its entirety to provide a\", \" foundation of understanding such apps and their technical considerations. The book, along with its \", \"sample app, can also serve as a starting point or reference for creating a new enterprise app. Use t\", \"he associated sample app as a template for the new app, or to see how to organize an app's component\", \" parts. Then, refer back to this guide for architectural guidance. You can find the sample app on Gi\", \"tHub.\\n\\n## What this book doesn't cover\\n\\nThis book is aimed at readers who are already familiar with \", \".NET MAUI. It does cover some concepts of .NET MAUI to help better illustrate the topic, but it does\", \" not cover most controls and concepts in any detail. For general guidance on building a new .NET MAU\", \"I app, please refer to the Building your first app guide in the .NET MAUI documentation.\\n\\n## Additio\", \"nal resources\\n\\nFor official .NET MAUI content, see .NET MAUI docs. .NET MAUI is developed as an open\", \"-source project and is available on GitHub at dotnet/maui. For code samples developed with .NET MAUI\", \", see the dotnet/maui-samples repo.\\n\\n## Contents\\n\\n| Purpose.........................................\", \"............................................................................................        \", \"                                          | 1                                                       \", \"                                                       |\\n|------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-------------------------------------------------|--------------------------------------------------\", \"--------------------------------------------------------------|\\n| What's left out of this guide's sc\", \"ope ................................................................................................\", \"................................1                       |                                           \", \"                                                                     |\\n| Who should use this guide .\", \"....................................................................................................\", \".............................................1                 |                                    \", \"                                                                            |\\n| How to use this guid\", \"e...................................................................................................\", \".........................................................2            |                             \", \"                                                                                   |\\n| Introduction \", \"to .NET MAUI .......................................................................................\", \".............                                                                | 3                    \", \"                                                                                          |\\n| Sample\", \" application........................................................................................\", \"..........................................................................4         |               \", \"                                                                                                 |\\n|\", \" Sample application architecture ...................................................................\", \".....................................................................5                     |        \", \"                                                                                                    \", \"    |\\n| Multi-Platform app..........................................................................\", \"........................................................................................6         | \", \"                                                                                                    \", \"           |\\n| Multi-Platform app solution..........................................................\", \"......................................................................................7             \", \"     |                                                                                              \", \"                  |\\n| eShop project ................................................................\", \"....................................................................................................\", \"........7   |                                                                                       \", \"                         |\\n| Summary................................................................\", \"....................................................................................................\", \".................8 |                                                                                \", \"                                |\\n| Model-View-ViewModel (MVVM).....................................\", \"....................................................                                                \", \"                          | 9                                                                       \", \"                                       |\\n| The MVVM pattern.........................................\", \"....................................................................................................\", \".....................9           |                                                                  \", \"                                              |\\n| View..............................................\", \"....................................................................................................\", \".....................................10 |                                                           \", \"                                                     |\\n| ViewModel..................................\", \"....................................................................................................\", \"....................................11         |                                                    \", \"                                                            |\\n| Model...............................\", \"....................................................................................................\", \".................................................11   |                                             \", \"                                                                   |\\n| Connecting view models to vie\", \"ws..................................................................................................\", \"................................                             | 12                                   \", \"                                                                          |\\n| Creating a view model \", \"declaratively ......................................................................................\", \".......................................                             | 12                            \", \"                                                                                 |\\n| Creating a view\", \" model programmatically.............................................................................\", \"......................................                                     | 13                     \", \"                                                                                        |\\n| Updating\", \" views in response to changes in the underlying view model or model.................................\", \".....                                                                             | 13              \", \"                                                                                               |\\n| M\", \"VVM Frameworks......................................................................................\", \"........................................................................                 | 15       \", \"                                                                                                    \", \"  |\\n| UI interaction using commands and behaviors...................................................\", \".....................................................                                           | 15\", \"                                                                                                    \", \"         |\\n| Implementing commands..................................................................\", \"...............................................................................                     \", \"   | 16                                                                                             \", \"                |\\n| Invoking commands from a view ..................................................\", \".................................................................................                   \", \"          | 17                                                                                      \", \"                       |\\n| Implementing behaviors...................................................\", \".................................................................................................   \", \"                 | 17                                                                               \", \"                              |\\n| Invoking behaviors from a view....................................\", \"..................................................................................................  \", \"                        | 20                                                                        \", \"                                     |\\n| Summary....................................................\", \"....................................................................................................\", \"..........................     | 20                                                                 \", \"                                            |\\n| Dependency injection                                \", \"                                                                                                    \", \"                                      | ............................................................\", \"............................................... 21 |\\n\\n| Introduction to dependency injection........\", \"....................................................................................................\", \"..............                             | 21   |\\n|-----------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-----------------------------------------|------|\\n| Registration....................................\", \"....................................................................................................\", \".....................................  | 23   |\\n| Resolution........................................\", \"....................................................................................................\", \".................................... | 25   |\\n| Summary.............................................\", \"....................................................................................................\", \".................................  | 26   |\\n| Communicating between loosely coupled components......\", \".............................................                                                       \", \"                                 | 27   |\\n| Introduction to MVVM Toolkit Messenger..................\", \"...............................................................................................     \", \"                               | 27   |\\n| Defining a message........................................\", \"....................................................................................................\", \"..................           | 29   |\\n| Publishing a message........................................\", \"....................................................................................................\", \"..............             | 29   |\\n| Subscribing to a message......................................\", \"....................................................................................................\", \"........                 | 30   |\\n| Unsubscribing from a message....................................\", \"................................................................................................... \", \"                       | 30   |\\n| Summary...........................................................\", \"....................................................................................................\", \"...................  | 31   |\\n| Navigation..........................................................\", \"....................................................................                                \", \"                   | 32   |\\n| Navigating between pages..............................................\", \".................................................................................................   \", \"                 | 33   |\\n| Creating the MauiNavigationService instance ............................\", \"..............................................................................                      \", \"               | 34   |\\n| Handling navigation requests..............................................\", \"............................................................................................        \", \"             | 34   |\\n| Navigating when the app is launched.........................................\", \".................................................................................                   \", \"           | 36   |\\n| Passing parameters during navigation..........................................\", \"...............................................................................                     \", \"         | 36   |\\n| Invoking navigation using behaviors.............................................\", \"...............................................................................                     \", \"       | 37   |\\n| Confirming or cancelling navigation...............................................\", \"..............................................................................                      \", \"     | 38   |\\n| Summary.............................................................................\", \"....................................................................................................\", \".  | 38   |\\n| Validation............................................................................\", \"...................................................                                                 \", \" | 39   |\\n| Specifying validation rules ............................................................\", \"....................................................................................               |\", \" 40   |\\n| Adding validation rules to a property ....................................................\", \"......................................................................                           | 4\", \"2   |\\n| Triggering validation ......................................................................\", \".....................................................................................          | 42 \", \"  |\\n| Triggering validation manually................................................................\", \"...................................................................42                        |      \", \"|\\n| Triggering validation when properties change....................................................\", \"................................................43                                         |      |\\n\", \"| Displaying validation errors......................................................................\", \"........................................................................                 | 43   |\\n| \", \"Highlighting a control that contains invalid data...................................................\", \".............................................44                                        |      |\\n| Di\", \"splaying error messages ............................................................................\", \"...............................................................45                    |      |\\n| Summ\", \"ary.................................................................................................\", \".................................................................................  | 45   |\\n| Applic\", \"ation settings management ..........................................................................\", \"............                                                                     | 46   |\\n\\n| Creatin\", \"g a Settings Interface..............................................................................\", \"..............................................................                 | 46   |\\n|-----------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------|------|\\n| Adding Settin\", \"gs..................................................................................................\", \"...................................................................      | 47   |\\n| Data binding to \", \"user settings.......................................................................................\", \"....................................................                  | 48   |\\n| Summary............\", \"....................................................................................................\", \".................................................................. | 49   |\\n| Containerized microser\", \"vices ..............................................................................................\", \"..                                                              | 50   |\\n| Microservices............\", \"....................................................................................................\", \"..........................................................   | 51   |\\n| Containerization ...........\", \"....................................................................................................\", \".....................................................     | 53   |\\n| Communication between client an\", \"d microservices ....................................................................................\", \"............                                           | 56   |\\n| Communication between microservice\", \"s...................................................................................................\", \"...................                                 | 57   |\\n| Summary..............................\", \"....................................................................................................\", \"................................................ | 59   |\\n| Accessing remote data...................\", \".......................................................................................             \", \"                                              | 60   |\\n| Introduction to Representational State Tran\", \"sfer................................................................................................\", \"......                                     | 60   |\\n| Consuming RESTful APIs........................\", \"....................................................................................................\", \"........................                | 61   |\\n| Making web requests..............................\", \"....................................................................................................\", \"........................             | 61   |\\n| Making a GET request................................\", \"....................................................................................................\", \".....................             | 61   |\\n| Making a POST request..................................\", \"....................................................................................................\", \"................               | 64   |\\n| Making a DELETE request...................................\", \"....................................................................................................\", \"...........                 | 67   |\\n| Caching data.................................................\", \"....................................................................................................\", \"......................   | 68   |\\n| Managing data expiration........................................\", \"....................................................................................................\", \".....                 | 69   |\\n| Caching images ....................................................\", \"....................................................................................................\", \".............      | 69   |\\n| Increasing resilience.................................................\", \"....................................................................................................\", \"........        | 70   |\\n| Retry pattern............................................................\", \"....................................................................................................\", \"...........  | 70   |\\n| Circuit breaker pattern.....................................................\", \"................................................................................................... \", \"          | 71   |\\n| Summary........................................................................\", \"....................................................................................................\", \"...... | 72   |\\n| Authentication and authorization .................................................\", \"......................................                                                              \", \"    | 73   |\\n| Authentication.......................................................................\", \".................................................................................................   \", \" | 73   |\\n| Issuing bearer tokens using IdentityServer..............................................\", \"..............................................................74                                  | \", \"     |\\n| Adding IdentityServer to a web application.................................................\", \".........................................................75                                    |    \", \"  |\\n| Configuring IdentityServer ...................................................................\", \"........................................................................75                  |      |\", \"\\n| Configuring API resources........................................................................\", \"....................................................................76                   |      |\\n| \", \"Configuring identity resources .....................................................................\", \"..............................................................76                      |      |\\n\\n| Co\", \"nfiguring clients ..................................................................................\", \"........................................................................77          |    |\\n|--------\", \"----------------------------------------------------------------------------------------------------\", \"-------------------------------------------------------------------------------|----|\\n| Configuring \", \"the authentication flow ............................................................................\", \"............................................78                            |    |\\n| Performing authen\", \"tication ...........................................................................................\", \"................................................79                   |    |\\n| Signing-in............\", \"....................................................................................................\", \"............................................................80  |    |\\n| Signing-out................\", \"....................................................................................................\", \".....................................................83    |    |\\n| Authorization...................\", \"....................................................................................................\", \"...................................................   | 84 |\\n| Configuring IdentityServer to perform\", \" authorization .....................................................................................\", \".......                                          | 85 |\\n| Making access requests to APIs............\", \"....................................................................................................\", \"......................                      | 86 |\\n| Summary........................................\", \"....................................................................................................\", \"...................................... | 87 |\\n| MVVM Toolkit Features...............................\", \".........................................................................                           \", \"                                  | 88 |\\n| MVVM Toolkit ............................................\", \"....................................................................................................\", \"........................     | 88 |\\n| ObservableObject..............................................\", \"....................................................................................................\", \"...............         | 89 |\\n| RelayCommand and AsyncRelayCommand.................................\", \"..............................................................................                      \", \"                   | 90 |\\n| Source Generators.......................................................\", \"....................................................................................................\", \".....         | 91 |\\n| Summary......................................................................\", \"....................................................................................................\", \"........ | 93 |\\n| Unit testing .....................................................................\", \".......................................................                                             \", \"    | 94 |\\n| Dependency injection and unit testing..................................................\", \"......................................................................                             |\", \" 95 |\\n| Testing MVVM applications...................................................................\", \"...........................................................................                   | 95 |\", \"\\n| Testing asynchronous functionality...............................................................\", \"................................................................                         | 96 |\\n| Te\", \"sting INotifyPropertyChanged implementations .......................................................\", \".........................................                                           | 97 |\\n| Testing\", \" message-based communication........................................................................\", \".............................................                                  | 97 |\\n| Testing exce\", \"ption handling .....................................................................................\", \".........................................................                 | 98 |\\n| Testing validatio\", \"n...................................................................................................\", \"...............................................................      | 98 |\\n| Summary...............\", \"....................................................................................................\", \"............................................................... | 99 |\\n\\n## Purpose\\n\\nThis eBook provi\", \"des guidance on building cross-platform enterprise apps using .NET MAUI. .NET MAUI is a cross-platfo\", \"rm UI toolkit that allows developers to easily create native user interface layouts that can be shar\", \"ed across platforms, including iOS, macOS, Android, and Windows. It provides a comprehensive solutio\", \"n for Business to Employee (B2E), Business to Business (B2B), and Business to Consumer (B2C) apps, p\", \"roviding the ability to share code across all target platforms and helping to lower the total cost o\", \"f ownership (TCO).\\n\\nThe guide provides architectural guidance for developing adaptable, maintainable\", \", and testable .NET MAUI enterprise apps. Guidance is provided on how to implement MVVM, dependency \", \"injection, navigation, validation, and configuration management, while maintaining loose coupling. I\", \"n addition, there's also guidance on performing authentication and authorization with IdentityServer\", \", accessing data from containerized microservices, and unit testing.\\n\\nThe guide comes with source co\", \"de for the eShop multi-platform app, and source code for the eShop reference app. The eShop multi-pl\", \"atform app is a cross-platform enterprise app developed using .NET MAUI, which connects to a series \", \"of containerized microservices known as the eShop reference app. However, the eShop multi-platform a\", \"pp can be configured to consume data from mock services for those who wish to avoid deploying the co\", \"ntainerized microservices.\\n\\n## What's left out of this guide's scope\\n\\nThis guide is aimed at readers\", \" who are already familiar with .NET MAUI. For a detailed introduction to .NET MAUI, see the .NET MAU\", \"I documentation.\\n\\n## Who should use this guide\\n\\nThe audience for this guide is mainly developers and\", \" architects who would like to learn how to architect and implement cross-platform enterprise apps us\", \"ing .NET MAUI.\\n\\nA secondary audience is technical decision-makers who would like to receive an archi\", \"tectural and technology overview before deciding on what approach to select for cross-platform enter\", \"prise app development using .NET MAUI.\\n\\n## How to use this guide\\n\\nThis guide focuses on building cro\", \"ss-platform enterprise apps using .NET MAUI. As such, it should be read in its entirety to provide a\", \" foundation of understanding such apps and their technical considerations. The guide and its sample \", \"app can also serve as a starting point or reference for creating a new enterprise app. Use the assoc\", \"iated sample app as a template for the new app or see how to organize an app's component parts. Then\", \", refer back to this guide for architectural guidance.\\n\\nFeel free to forward this guide to team memb\", \"ers to help ensure a common understanding of crossplatform enterprise app development using .NET MAU\", \"I. Having everybody working from a common set of terminologies and underlying principles will help e\", \"nsure a consistent application of architectural patterns and practices.\\n\\n## Introduction to .NET MAU\", \"I\\n\\nRegardless of platform, developers of enterprise apps face several challenges:\\n\\n- App requirement\", \"s that can change over time.\\n- New business opportunities and challenges.\\n- Ongoing feedback during \", \"development that can significantly affect the scope and requirements of the app.\\n\\nWith these in mind\", \", it's important to build apps that can be easily modified or extended over time. Designing for such\", \" adaptability can be difficult as it requires an architecture that allows individual parts of the ap\", \"p to be independently developed and tested in isolation without affecting the rest of the app.\\n\\nMany\", \" enterprise apps are sufficiently complex to require more than one developer. It can be a significan\", \"t challenge to decide how to design an app so that multiple developers can work effectively on diffe\", \"rent pieces of the app independently, while ensuring that the pieces come together seamlessly when i\", \"ntegrated into the app.\\n\\nThe traditional approach to designing and building an app results in what i\", \"s referred to as a monolithic app, where components are tightly coupled with no clear separation bet\", \"ween them. Typically, this monolithic approach leads to apps that are difficult and inefficient to m\", \"aintain, because it can be difficult to resolve bugs without breaking other components in the app, a\", \"nd it can be difficult to add new features or to replace existing features.\\n\\nAn effective remedy for\", \" these challenges is to partition an app into discrete, loosely coupled components that can be easil\", \"y integrated together into an app. Such an approach offers several benefits:\\n\\n- It allows individual\", \" functionality to be developed, tested, extended, and maintained by different individuals or teams.\\n\", \"- It promotes reuse and a clean separation of concerns between the app's horizontal capabilities, su\", \"ch as authentication and data access, and the vertical capabilities, such as app specific business f\", \"unctionality. This allows the dependencies and interactions between app components to be more easily\", \" managed.\\n- It helps maintain a separation of roles by allowing different individuals, or teams, to \", \"focus on a specific task or piece of functionality according to their expertise. In particular, it p\", \"rovides a cleaner separation between the user interface and the app' s business logic.\\n\\nHowever, the\", \"re are many issues that must be resolved when partitioning an app into discrete, loosely coupled com\", \"ponents. These include:\\n\\n- Deciding how to provide a clean separation of concerns between the user i\", \"nterface controls and their logic. One of the most important decisions when creating a .NET MAUI ent\", \"erprise app is whether to place business logic in code-behind files, or whether to create a clean se\", \"paration of concerns between the user interface controls and their logic, in order to make the app m\", \"ore maintainable and testable. For more information, see Model-View-ViewModel.\\n- Determining whether\", \" to use a dependency injection container. Dependency injection containers reduce the dependency coup\", \"ling between objects by providing a facility to construct instances of classes with their dependenci\", \"es injected, and manage their lifetime based on the configuration of the container. For more informa\", \"tion, see Dependency injection.\\n- Choosing between platform provided eventing and loosely coupled me\", \"ssage-based communication between components that are inconvenient to link by object and type refere\", \"nces. For more information, see Introduction to Communicating between loosely coupled components.\\n- \", \"Deciding how to navigate between pages, including how to invoke navigation, and where navigation log\", \"ic should reside. For more information, see Navigation.\\n- Determining how to validate user input for\", \" correctness. The decision must include how to validate user input, and how to notify the user about\", \" validation errors. For more information, see Validation.\\n- Deciding how to perform authentication, \", \"and how to protect resources with authorization. For more information, see Authentication and author\", \"ization.\\n- Determining how to access remote data from web services, including how to reliably retrie\", \"ve data, and how to cache data. For more information, see Accessing remote data.\\n- Deciding how to t\", \"est the app. For more information, see Unit testing.\\n\\nThis guide provides guidance on these issues, \", \"and focuses on the core patterns and architecture for building a cross-platform enterprise app using\", \" .NET MAUI. The guidance aims to help to produce adaptable, maintainable, and testable code, by addr\", \"essing common .NET MAUI enterprise app development scenarios, and by separating the concerns of pres\", \"entation, presentation logic, and entities through support for the Model-View-ViewModel (MVVM) patte\", \"rn.\\n\\n## Sample application\\n\\nThis guide includes a sample application, eShop, that's an online store \", \"that includes the following functionality:\\n\\n- Authenticating and authorizing against a backend servi\", \"ce.\\n- Browsing a catalog of items.\\n- Filtering the catalog.\\n- Ordering items from the catalog.\\n- Vie\", \"wing the user's order history.\\n- Configuration of settings.\\n\\nClient Apps\\n\\nMobile App\\n\\nBrowser\\n\\nAspir\", \"e Orchestration\\n\\nMobile BFF\\n\\nCloud Services\\n\\nIdentity Service\\n\\nIdentity AP!\\n\\nPostgreSQL\\n\\n## Sample a\", \"pplication architecture\\n\\nBelow is a high-level overview of the architecture of the sample applicatio\", \"n.\\n\\nWeb App\\n\\nOrdering API\\n\\nPostgreSQL\\n\\nThe sample application ships with:\\n\\n- .NET Aspire App Hosting\", \" &amp; Orchestration\\n- An Blazor web application developed with ASP.NET Core.\\n- A multi-platform app\", \" developed with .NET MAUI, which supports iOS, Android, macOS via Mac Catalyst, and Windows.\\n\\nThe sa\", \"mple application includes the following backend services:\\n\\n- An identity microservice, which uses AS\", \"P.NET Core Identity and IdentityServer.\\n- A catalog microservice, which is a data-driven create, rea\", \"d, update, delete (CRUD) service that consumes an SQL Server database using EntityFramework Core.\\n- \", \"An ordering microservice, which is a domain-driven service that uses domain-driven design patterns.\\n\", \"- A basket microservice, which is a data-driven CRUD service that uses Redis Cache.\\n\\nThese backend s\", \"ervices are implemented as microservices using ASP.NET Core, and are deployed as unique containers w\", \"ith .NET Aspire. Collectively, these backend services are referred to as the eShop reference applica\", \"tion. Client apps communicate with the backend services through a Representational State Transfer (R\", \"EST) web interface. For more information about microservices and conainers, see Containerized micros\", \"ervices.\\n\\nOpenAl\\n\\n15:00\\n\\n15:15\\n\\nCATALOG\\n\\nLogin\\n\\nCART\\n\\nAEROLITE CYCLING HELMET\\n\\n$129.99\\n\\nALPINE PEAK \", \"DOWN JACKET\\n\\n$249.99\\n\\nYour Shopping bag\\n\\nCheck out\\n\\n15:14\\n\\n15:30\\n\\nAdventure\\n\\nWorks\\\"\\n\\n## Multi-Platfo\", \"rm app\\n\\n15:15\\n\\nFilters\\n\\nBrands\\n\\nAirStrider\\n\\nGravitator\\n\\nGroiltex\\n\\nAdventure\\n\\nWorks\\\"\\n\\nB&amp;R\\n\\nDaybir\", \"d\\n\\nGreen Equipment\\n\\nLegend\\n\\nQuester\\n\\nThis guide focuses on building cross-platform enterprise apps u\", \"sing .NET MAUI, and uses the eShop multi-platform app as an example. The image below shows the pages\", \" from the eShop multi-platform app that provide the functionality outlined earlier. Types Bags Climb\", \"ing Cycling\\n\\nADVENTURER $199.99\\n\\nAEROLITE\\n\\nCYCLING\\n\\n$129.99\\n\\nThe multi-platform app consumes the bac\", \"kend services provided by the eShop reference application. However, it can be configured to consume \", \"data from mock services for those who wish to avoid deploying the backend services.\\n\\nThe eShop multi\", \"-platform app exercises the following .NET MAUI functionality:\\n\\nAdventure\\n\\n.=-\\n\\n- XAML\\n- Controls\\n- \", \"Bindings\\n- Converters\\n- Styles\\n- Animations\\n- Commands\\n- Behaviors\\n- Triggers\\n- Effects\\n- Custom Con\", \"trols\\n\\nFor more information about this functionality, see the .NET MAUI documentation.\\n\\nIn addition,\", \" unit tests are provided for some of the classes in the eShop multi-platform app.\\n\\n## Multi-Platform\", \" app solution\\n\\nThe eShop multi-platform app solution organizes the source code and other resources i\", \"nto a multiple projects. All of the core mobile components are contained in a singular project named\", \" eShopContainers. This is a feature introduced with .NET 6 that allows a project to target multiple \", \"outputs which helps eliminate the need for multiple platform projects that we would have used in Xam\", \"arin.Forms and earlier .NET versions. An additional project is included for unit testing.\\n\\nWhile thi\", \"s project has all of its components stored in a singular project, it is worth considering separating\", \" it into multiple projects based on your needs. For example, if you have multiple implementations of\", \" service providers based off of a service with their own dependencies, it may make sense to break th\", \"ose service provider implementations out into their own separate project. Good candidates for projec\", \"t separation include shared models, service implementations, api client components, database or cach\", \"ing layers. Any place where you feel that the business could re-use a component in another project i\", \"s a potential candidate for separation. These projects can then be packaged via NuGet for easy distr\", \"ibution and versioning.\\n\\nAll of the projects use folders to organize the source code and other resou\", \"rces into categories. The classes from the eShop multi-platform app can be re-used in any .NET MAUI \", \"app with little or no modification.\\n\\n## eShop project\\n\\nThe eShop project contains the following fold\", \"ers:\\n\\n| Folder     | Description                                                     |\\n|------------\", \"|-----------------------------------------------------------------|\\n| Animations | Contains classes \", \"that enable animations to be consumed in XAML. |\\n| Behaviors  | Contains behaviors that are exposed \", \"to view classes.            |\\n\\n| Folder      | Description                                          \", \"                                 |\\n|-------------|--------------------------------------------------\", \"-------------------------------------|\\n| Controls    | Contains custom controls used by the app.    \", \"                                         |\\n| Converters  | Contains value converters that apply cust\", \"om logic to a binding.                       |\\n| Exceptions  | Contains the custom ServiceAuthentica\", \"tionException.                                   |\\n| Extensions  | Contains extension methods for th\", \"e VisualElement and IEnumerable<T> classes.          |\\n| Helpers     | Contains helper classes for t\", \"he app.                                                  |\\n| Models      | Contains the model classe\", \"s for the app.                                               |\\n| Properties  | Contains AssemblyInfo\", \".cs, a .NET assembly metadata file.                              |\\n| Services    | Contains interfac\", \"es and classes that implement services that are provided to the app. |\\n| Triggers    | Contains the \", \"BeginAnimation trigger, which is used to invoke an animation in XAML.    |\\n| Validations | Contains \", \"classes involved in validating data input.                                   |\\n| ViewModels  | Conta\", \"ins the application logic that's exposed to pages.                               |\\n| Views       | C\", \"ontains the pages for the app.                                                       |\\n\\n## Summary\\n\\n\", \"Microsoft's cross -platform multi-platform app development tools and platforms provide a comprehensi\", \"ve solution for B2E, B2B, and B2C mobile client apps, providing the ability to share code across all\", \" target platforms (iOS, macOS, Android, and Windows) and helping to lower the total cost of ownershi\", \"p. Apps can share their user interface and app logic code, while retaining the native platform look \", \"and feel.\\n\\nDevelopers of enterprise apps face several challenges that can alter the architecture of \", \"the app during development. Therefore, it's important to build an app so that it can be modified or \", \"extended over time. Designing for such adaptability can be difficult, but typically involves partiti\", \"oning an app into discrete, loosely coupled components that can be easily integrated together into a\", \"n app.\\n\\nView\\n\\nData Binding and Commands\\n\\nSend notifications\\n\\nViewModel updates the model\\n\\nSend notif\", \"ications\\n\\n## Model-View-ViewModel (MVVM)\\n\\nThe .NET MAUI developer experience typically involves crea\", \"ting a user interface in XAML, and then adding code-behind that operates on the user interface. Comp\", \"lex maintenance issues can arise as apps are modified and grow in size and scope. These issues inclu\", \"de the tight coupling between the UI controls and the business logic, which increases the cost of ma\", \"king UI modifications, and the difficulty of unit testing such code.\\n\\nThe MVVM pattern helps cleanly\", \" separate an application's business and presentation logic from its user interface (UI). Maintaining\", \" a clean separation between application logic and the UI helps address numerous development issues a\", \"nd makes an application easier to test, maintain, and evolve. It can also significantly improve code\", \" re-use opportunities and allows developers and UI designers to collaborate more easily when develop\", \"ing their respective parts of an app.\\n\\n## The MVVM pattern\\n\\nThere are three core components in the M\", \"VVM pattern: the model, the view, and the view model. Each serves a distinct purpose. The diagram be\", \"low shows the relationships between the three components.\\n\\nIn addition to understanding the responsi\", \"bilities of each component, it's also important to understand how they interact. At a high level, th\", \"e view 'knows about' the view model, and the view model 'knows about' the model, but the model is un\", \"aware of the vi ew model, and the view model is unaware of the view. Therefore, the view model isola\", \"tes the view from the model, and allows the model to evolve independently of the view.\\n\\nThe benefits\", \" of using the MVVM pattern are as follows:\\n\\nView Model\\n\\n4\\n\\nModel\\n\\n- If an existing model implementat\", \"ion encapsulates existing business logic, it can be difficult or risky to change it. In this scenari\", \"o, the view model acts as an adapter for the model classes and prevents you from making major change\", \"s to the model code.\\n- Developers can create unit tests for the view model and the model, without us\", \"ing the view. The unit tests for the view model can exercise exactly the same functionality as used \", \"by the view.\\n- The app UI can be redesigned without touching the view model and model code, provided\", \" that the view is implemented entirely in XAML or C#. Therefore, a new version of the view should wo\", \"rk with the existing view model.\\n- Designers and developers can work independently and concurrently \", \"on their components during development. Designers can focus on the view, while developers can work o\", \"n the view model and model components.\\n\\nThe key to using MVVM effectively lies in understanding how \", \"to factor app code into the correct classes and how the classes interact. The following sections dis\", \"cuss the responsibilities of each of the classes in the MVVM pattern.\\n\\n## View\\n\\nThe view is responsi\", \"ble for defining the structure, layout, and appearance of what the user sees on screen. Ideally, eac\", \"h view is defined in XAML, with a limited code-behind that does not contain business logic. However,\", \" in some cases, the code-behind might contain UI logic that implements visual behavior that is diffi\", \"cult to express in XAML, such as animations.\\n\\nIn a .NET MAUI application, a view is typically a Cont\", \"entPage-derived or ContentView-derived class. However, views can also be represented by a data templ\", \"ate, which specifies the UI elements to be used to visually represent an object when it's displayed.\", \" A data template as a view does not have any code-behind, and is designed to bind to a specific view\", \" model type.\\n\\n| Tip                                                          |\\n|--------------------\", \"------------------------------------------|\\n| Avoid enabling and disabling UI elements in the code-b\", \"ehind. |\\n\\nEnsure that the view models are responsible for defining logical state changes that affect\", \" some aspects of the view's display, such as whether a command is available, or an indication that a\", \"n operation is pending. Therefore, enable and disable UI elements by binding to view model propertie\", \"s, rather than enabling and disabling them in code-behind.\\n\\nThere are several options for executing \", \"code on the view model in response to interactions on the view, such as a button click or item selec\", \"tion. If a control supports commands, the control's Command property can be data-bound to an IComman\", \"d property on th e view model. When the control's command is invoked, the code in the view model wil\", \"l be executed. In addition to commands, behaviors can be attached to an object in the view and can l\", \"isten for either a command to be invoked or the event to be raised. In response, the behavior can th\", \"en invoke an ICommand on the view model or a method on the view model.\\n\\n## ViewModel\\n\\nThe view model\", \" implements properties and commands to which the view can data bind to, and notifies the view of any\", \" state changes through change notification events. The properties and commands that the view model p\", \"rovides define the functionality to be offered by the UI, but the view determines how that functiona\", \"lity is to be displayed.\\n\\n| Tip                                                  |\\n|----------------\", \"--------------------------------------|\\n| Keep the UI responsive with asynchronous operations. |\\n\\nMu\", \"ltiplatform apps should keep the UI thread unblocked to improve the user's perception of performance\", \". Therefore, in the view model, use asynchronous methods for I/O operations and raise events to asyn\", \"chronously notify views of property changes.\\n\\nThe view model is also responsible for coordinating th\", \"e view's interactions with any model classes that are required. There's typically a one -to-many rel\", \"ationship between the view model and the model classes. The view model might choose to expose model \", \"classes directly to the view so that controls in the view can data bind directly to them. In this ca\", \"se, the model classes will need to be designed to support data binding and change notification event\", \"s.\\n\\nEach view model provides data from a model in a form that the view can easily consume. To accomp\", \"lish this, the view model sometimes performs data conversion. Placing this data conversion in the vi\", \"ew model is a good idea because it provides properties that the view can bind to. For example, the v\", \"iew model might combine the values of two properties to make it easier to display by the view.\\n\\n## T\", \"ip\\n\\nCentralize data conversions in a conversion layer.\\n\\nIt's also possible to use converters as a se\", \"parate data conversion layer that sits between the view model and the view. This can be necessary, f\", \"or example, when data requires special formatting that the view model doesn't provide.\\n\\nIn order for\", \" the view model to participate in two-way data binding with the view, its properties must raise the \", \"PropertyChanged event. View models satisfy this requirement by implementing the INotifyPropertyChang\", \"ed interface, and raising the PropertyChanged event when a property is changed.\\n\\nFor collections, th\", \"e view-friendly ObservableCollection&lt;T&gt; is provided. This collection implements collection cha\", \"nged notification, relieving the developer from having to implement the INotifyCollectionChanged int\", \"erface on collections.\\n\\n## Model\\n\\nModel classes are nonvisual classes that encapsulate the app's dat\", \"a. Therefore, the model can be thought of as representing the app's domain model, which usually incl\", \"udes a data model along with business and validation logic. Examples of model objects include data t\", \"ransfer objects (DTOs), Plain Old CLR Objects (POCOs), and generated entity and proxy objects.\\n\\nMode\", \"l classes are typically used in conjunction with services or repositories that encapsulate data acce\", \"ss and caching.\\n\\n## Connecting view models to views\\n\\nView models can be connected to views by using \", \"the data-binding capabilities of .NET MAUI. There are many approaches that can be used to construct \", \"views and view models and associate them at runtime. These approaches fall into two categories, know\", \"n as view first composition, and view model first composition. Choosing between view first compositi\", \"on and view model first composition is an issue of preference and complexity. However, all approache\", \"s share the same aim, which is for the view to have a view model assigned to its BindingContext prop\", \"erty.\\n\\nWith view first composition the app is conceptually composed of views that connect to the vie\", \"w models they depend on. The primary benefit of this approach is that it makes it easy to construct \", \"loosely coupled, unit testable apps because the view models have no dependence on the views themselv\", \"es. It's also easy to understand the structure of the app by following its visual structure, rather \", \"than having to track code execution to understand how classes are created and associated. In additio\", \"n, view first const ruction aligns with the Microsoft Maui's navigation system that's responsible fo\", \"r constructing pages when navigation occurs, which makes a view model first composition complex and \", \"misaligned with the platform.\\n\\nWith view model first composition, the app is conceptually composed o\", \"f view models, with a service responsible for locating the view for a view model. View model first c\", \"omposition feels more natural to some developers, since the view creation can be abstracted away, al\", \"lowing them to focus on the logical non-UI structure of the app. In addition, it allows view models \", \"to be created by other view models. However, this approach is often complex, and it can become diffi\", \"cult to understand how the various parts of the app are created and associated.\\n\\n## Tip Keep view mo\", \"dels and views independent.\\n\\nThe binding of views to a property in a data source should be the view'\", \"s principal dependency on its corresponding view model. Specifically, don't reference view types, su\", \"ch as Button and ListView, from view models. By following the principles outlined here, view models \", \"can be tested in isolation, therefore reducing the likelihood of software defects by limiting scope.\", \"\\n\\nThe following sections discuss the main approaches to connecting view models to views.\\n\\n## Creatin\", \"g a view model declaratively\\n\\nThe simplest approach is for the view to declaratively instantiate its\", \" corresponding view model in XAML. When the view is constructed, the corresponding view model object\", \" will also be constructed. This approach is demonstrated in the following code example:\\n\\n&lt;Content\", \"Page xmlns:local=\\\"clr-namespace:eShop\\\"&gt; &lt;ContentPage.BindingContext&gt;\\n\\n```\\n<local:LoginViewM\", \"odel /> </ContentPage.BindingContext> <!-- Omitted for brevity... --> </ContentPage>\\n```\\n\\nWhen the C\", \"ontentPage is created, an instance of the LoginViewModel is automatically constructed and set as the\", \" view's BindingContext.\\n\\nThis declarative construction and assignment of the view model by the view \", \"has the advantage that it's simple, but has the disadvantage that it requires a default (parameter -\", \"less) constructor in the view model.\\n\\n## Creating a view model programmatically\\n\\nA view can have cod\", \"e in the code-behind file, resulting in the view-model being assigned to its BindingContext property\", \". This is often accomplished in the view's constructor, as shown in the following code example:\\n\\n```\", \"\\npublic LoginView() { InitializeComponent(); BindingContext = new LoginViewModel(navigationService);\", \" }\\n```\\n\\nThe programmatic construction and assignment of the view model within the view's code -behin\", \"d has the advantage that it's simple. However, the main disadvantage of this approach is that the vi\", \"ew needs to provide the view model with any required dependencies. Using a dependency injection cont\", \"ainer can help to maintain loose coupling between the view and view model. For more information, see\", \" Dependency injection.\\n\\n## Updating views in response to changes in the underlying view model or mod\", \"el\\n\\nAll view model and model classes that are accessible to a view should implement the [INotifyProp\", \"ertyChanged interface. Implementing this interface in a view model or model class allows the class t\", \"o provide change notifications to any data-bound controls in the view when the underlying property v\", \"alue changes.\\n\\nApp's should be architected for the correct use of property change notification, by m\", \"eeting the following requirements:\\n\\n- Always raising a PropertyChanged event if a public property's \", \"value changes. Do not assume that raising the PropertyChanged event can be ignored because of knowle\", \"dge of how XAML binding occurs.\\n- Always raising a PropertyChanged event for any calculated properti\", \"es whose values are used by other properties in the view model or model.\\n- Always raising the Proper\", \"tyChanged event at the end of the method that makes a property change, or when the object is known t\", \"o be in a safe state. Raising the event interrupts the\\n\\noperation by invoking the event's handlers s\", \"ynchronously. If this happens in the middle of an operation, it might expose the object to callback \", \"functions when it is in an unsafe, partially updated state. In addition, it's possible for cascading\", \" changes to be triggered by PropertyChanged events. Cascading changes generally require updates to b\", \"e complete before the cascading change is safe to execute.\\n\\n- Never raising a PropertyChanged event \", \"if the property does not change. This means that you must compare the old and new values before rais\", \"ing the PropertyChanged event.\\n- Never raising the PropertyChanged event during a view model's const\", \"ructor if you are initializing a property. Data-bound controls in the view will not have subscribed \", \"to receive change notifications at this point.\\n- Never raising more than one PropertyChanged event w\", \"ith the same property name argument within a single synchronous invocation of a public method of a c\", \"lass. For example, given a NumberOfItems property whose backing store is the _numberOfItems field, i\", \"f a method increments _numberOfItems fifty times during the execution of a loop, it should only rais\", \"e property change notification on the NumberOfItems property once, after all the work is complete. F\", \"or asynchronous methods, raise the PropertyChanged event for a given property name in each synchrono\", \"us segment of an asynchronous continuation chain.\\n\\nA simple way to provide this functionality would \", \"be to create an extension of the BindableObject class. In this example, the ExtendedBindableObject c\", \"lass provides change notifications, which is shown in the following code example:\\n\\n```\\npublic abstra\", \"ct class ExtendedBindableObject : BindableObject { public void RaisePropertyChanged<T>(Expression<Fu\", \"nc<T>> property) { var name = GetMemberInfo(property).Name; OnPropertyChanged(name); } private Membe\", \"rInfo GetMemberInfo(Expression expression) { // Omitted for brevity ... } }\\n```\\n\\n.NET MAUI's Bindabl\", \"eObject class implements the INotifyPropertyChanged interface, and provides an OnPropertyChanged met\", \"hod. The ExtendedBindableObject class provides the RaisePropertyChanged method to invoke property ch\", \"ange notification, and in doing so uses the functionality provided by the BindableObject class.\\n\\nVie\", \"w model classes can then derive from the ExtendedBindableObject class. Therefore, each view model cl\", \"ass uses the RaisePropertyChanged method in the ExtendedBindableObject class to provide property cha\", \"nge notification. The following code example shows how the eShop multi-platform app invokes property\", \" change notification by using a lambda expression:\\n\\n```\\npublic bool IsLogin { get => _isLogin; set {\", \" _isLogin = value; RaisePropertyChanged(() => IsLogin);\\n```\\n\\n}\\n\\n}\\n\\nUsing a lambda expression in this\", \" way involves a small performance cost because the lambda expression has to be evaluated for each ca\", \"ll. Although the performance cost is small and would not typically impact an app, the costs can accr\", \"ue when there are many change notifications. However, the benefit of this approach is that it provid\", \"es compile-time type safety and refactoring support when renaming properties.\\n\\n## MVVM Frameworks\\n\\nT\", \"he MVVM pattern is well established in .NET, and the community has created many frameworks which hel\", \"p ease this development. Each framework provides a different set of features, but it is standard for\", \" them to provide a common view model with an implementation of the INotifyPropertyChanged interface.\", \" Additional features of MVVM frameworks include custom commands, navigation helpers, dependency inje\", \"ction/service locator components, and UI platform integration. While it is not necessary to use thes\", \"e frameworks, they can speed up and standardize your development. The eShop multi-platform app uses \", \"the .NET Community MVVM Toolkit. When choosing a framework, you should consider your application's n\", \"eeds and your team's strengths. The list below includes some of the more common MVVM frameworks for \", \".NET MAUI.\\n\\n- .NET Community MVVM Toolkit\\n- ReactiveUI\\n- Prism Library\\n\\n## UI interaction using comm\", \"ands and behaviors\\n\\nIn multi-platform apps, actions are typically invoked in response to a user acti\", \"on, such as a button click, that can be implemented by creating an event handler in the code-behind \", \"file. However, in the MVVM pattern, the responsibility for implementing the action lies with the vie\", \"w model, and placing code in the code-behind should be avoided.\\n\\nCommands provide a convenient way t\", \"o represent actions that can be bound to controls in the UI. They encapsulate the code that implemen\", \"ts the action and help to keep it decoupled from its visual representation in the view. This way, yo\", \"ur view models become more portable to new platforms, as they do not have a direct dependency on eve\", \"nts provided by the platform's UI framework. .NET MAUI includes controls that can be declaratively c\", \"onnected to a command, and these controls will invoke the command when the user interacts with the c\", \"ontrol.\\n\\nBehaviors also allow controls to be declaratively connected to a command. However, behavior\", \"s can be used to invoke an action that's associated with a range of events raised by a control. Ther\", \"efore, behaviors address many of the same scenarios as command-enabled controls, while providing a g\", \"reater degree of flexibility and control. In addition, behaviors can also be used to associate comma\", \"nd objects or methods with controls that were not specifically designed to interact with commands.\\n\\n\", \"## Implementing commands\\n\\nView models typically expose public properties, for binding from the view,\", \" which implement the ICommand interface. Many .NET MAUI controls and gestures provide a Command prop\", \"erty, which can be data bound to an ICommand object provided by the view model. The button control i\", \"s one of the most commonly used controls, providing a command property that executes when the button\", \" is clicked.\\n\\n## Note\\n\\nWhile it's possible to expose the actual implementation of the ICommand inter\", \"face that your view model uses (for example, Command&lt;T&gt; or RelayCommand), it is recommended to\", \" expose your commands publicly as ICommand. This way, if you ever need to change the implementation \", \"at a later date, it can easily be swapped out.\\n\\nThe ICommand interface defines an Execute method, wh\", \"ich encapsulates the operation itself, a CanExecute method, which indicates whether the command can \", \"be invoked, and a CanExecuteChanged event that occurs when changes occur that affect whether the com\", \"mand should execute. In most cases, we will only supply the Execute method for our commands. For a m\", \"ore detailed overview of ICommand, refer to the Commanding documentation for .NET MAUI.\\n\\nProvided wi\", \"th .NET MAUI are the Command and Command&lt;T&gt; classes that implement the ICommand interface, whe\", \"re T is the type of the arguments to Execute and CanExecute. Command and Command&lt;T&gt; are basic \", \"implementations that provide the minimal set of functionality needed for the ICommand interface.\\n\\n##\", \" Note\\n\\nMany MVVM frameworks offer more feature rich implementations of the ICommand interface.\\n\\nThe \", \"Command or Command&lt;T&gt; constructor requires an Action callback object that's called when the IC\", \"ommand.Execute method is invoked. The CanExecute method is an optional constructor parameter, and is\", \" a Func that returns a bool.\\n\\nThe eShop multi-platform app uses the RelayCommand and AsyncRelayComma\", \"nd. The primary benefit for modern applications is that the AsyncRelayCommand provides better functi\", \"onality for asynchronous operations.\\n\\nThe following code shows how a Command instance, which represe\", \"nts a register command, is constructed by specifying a delegate to the Register view model method:\\n\\n\", \"public ICommand RegisterCommand { get ; }\\n\\nThe command is exposed to the view through a property tha\", \"t returns a reference to an ICommand. When the Execute method is called on the Command object, it si\", \"mply forwards the call to the method in the view model via the delegate that was specified in the Co\", \"mmand constructor. An asynchronous method can be invoked by a command by using the async and await k\", \"eywords when specifying the command's Execute delegate. This indicates that the callback is a Task a\", \"nd should be awaited. For\\n\\nexample, the following code shows how an ICommand instance, which represe\", \"nts a sign-in command, is constructed by specifying a delegate to the SignInAsync view model method:\", \"\\n\\n```\\npublic ICommand SignInCommand { get ; } ... SignInCommand = new AsyncRelayCommand(async () => \", \"await SignInAsync());\\n```\\n\\nParameters can be passed to the Execute and CanExecute actions by using t\", \"he AsyncRelayCommand&lt;T&gt; class to instantiate the command. For example, the following code show\", \"s how an AsyncRelayCommand&lt;T&gt; instance is used to indicate that the NavigateAsync method will \", \"require an argument of type string:\\n\\n```\\npublic ICommand NavigateCommand { get ; } ... NavigateComma\", \"nd = new AsyncRelayCommand<string>(NavigateAsync);\\n```\\n\\nIn both the RelayCommand and RelayCommand&lt\", \";T&gt; classes, the delegate to the CanExecute method in each constructor is optional. If a delegate\", \" isn't specified, the Command will return true for CanExecute. However, the view model can indicate \", \"a change in the co mmand's CanExecute status by calling the ChangeCanExecute method on the Command o\", \"bject. This causes the CanExecuteChanged event to be raised. Any UI controls bound to the command wi\", \"ll then update their enabled status to reflect the availability of the data-bound command.\\n\\n## Invok\", \"ing commands from a view\\n\\nThe following code example shows how a Grid in the LoginView binds to the \", \"RegisterCommand in the LoginViewModel class by using a TapGestureRecognizer instance:\\n\\n```\\n< Grid Gr\", \"id.Column=\\\"1\\\" HorizontalOptions=\\\"Center\\\"> < Label Text=\\\"REGISTER\\\" TextColor=\\\"Gray\\\"/> < Grid.GestureR\", \"ecognizers > < TapGestureRecognizer Command=\\\"{Binding RegisterCommand}\\\" NumberOfTapsRequired=\\\"1\\\" /> \", \"</ Grid.GestureRecognizers > </ Grid >\\n```\\n\\nA command parameter can also be optionally defined using\", \" the CommandParameter property. The type of the expected argument is specified in the Execute and Ca\", \"nExecute target methods. The TapGestureRecognizer will automatically invoke the target command when \", \"the user interacts with the attached control. The CommandParameter, if provided, will be passed as t\", \"he argument to the command's Execute delegate.\\n\\n## Implementing behaviors\\n\\nBehaviors allow functiona\", \"lity to be added to UI controls without having to subclass them. Instead, the functionality is imple\", \"mented in a behavior class and attached to the control as if it was part of the control itself. Beha\", \"viors enable you to implement code that you would typically have to write as codebehind, because it \", \"directly interacts with the API of the control, in such a way that it can be concisely\\n\\nattached to \", \"the control, and packaged for reuse across more than one view or app. In the context of MVVM, behavi\", \"ors are a useful approach for connecting controls to commands.\\n\\nA behavior that's attached to a cont\", \"rol through attached properties is known as an attached behavior . The behavior can then use the exp\", \"osed API of the element to which it is attached to add functionality to that control, or other contr\", \"ols, in the visual tree of the view.\\n\\nA .NET MAUI behavior is a class that derives from the Behavior\", \" or Behavior&lt;T&gt; class, where T is the type of the control to which the behavior should apply. \", \"These classes provide OnAttachedTo and OnDetachingFrom methods, which should be overridden to provid\", \"e logic that will be executed when the behavior is attached to and detached from controls.\\n\\nIn the e\", \"Shop multi-platform app, the BindableBehavior&lt;T&gt; class derives from the Behavior&lt;T&gt; clas\", \"s. The purpose of the BindableBehavior&lt;T&gt; class is to provide a base class for .NET MAUI behav\", \"iors that require the BindingContext of the behavior to be set to the attached control.\\n\\nThe Bindabl\", \"eBehavior&lt;T&gt; class provides an overridable OnAttachedTo method that sets the BindingContext of\", \" the behavior, and an overridable OnDetachingFrom method that cleans up the BindingContext.\\n\\nThe eSh\", \"op multi-platform app includes an EventToCommandBehavior class which is provided by the MAUI Communi\", \"ty toolkit. EventToCommandBehavior executes a command in response to an event occurring. This class \", \"derives from the BaseBehavior&lt;View&gt; class so that the behavior can bind to and execute an ICom\", \"mand specified by a Command property when the behavior is consumed. The following code example shows\", \" the EventToCommandBehavior class:\\n\\n```\\n/// <summary> /// The <see cref=\\\"EventToCommandBehavior\\\" /> \", \"is a behavior that allows the user to invoke a <see cref=\\\"ICommand\\\" /> through an event. It is desig\", \"ned to associate Commands to events exposed by controls that were not designed to support Commands. \", \"It allows you to map any arbitrary event on a control to a Command. /// </summary> public class Even\", \"tToCommandBehavior : BaseBehavior<VisualElement> { // Omitted for brevity... /// <inheritdoc/> prote\", \"cted override void OnAttachedTo(VisualElement bindable) { base .OnAttachedTo(bindable); RegisterEven\", \"t(); } /// <inheritdoc/> protected override void OnDetachingFrom(VisualElement bindable) { Unregiste\", \"rEvent(); base .OnDetachingFrom(bindable); } static void OnEventNamePropertyChanged(BindableObject b\", \"indable, object oldValue, object newValue) => ((EventToCommandBehavior)bindable).RegisterEvent(); vo\", \"id RegisterEvent() {\\n```\\n\\n```\\nUnregisterEvent(); var eventName = EventName; if (View is null || stri\", \"ng.IsNullOrWhiteSpace(eventName)) { return ; } eventInfo = View.GetType()?.GetRuntimeEvent(eventName\", \") ?? throw new ArgumentException($\\\"{nameof(EventToCommandBehavior)}: Couldn't resolve the event.\\\", n\", \"ameof(EventName)); ArgumentNullException.ThrowIfNull(eventInfo.EventHandlerType); ArgumentNullExcept\", \"ion.ThrowIfNull(eventHandlerMethodInfo); eventHandler = eventHandlerMethodInfo.CreateDelegate(eventI\", \"nfo.EventHandlerType, this ) ?? throw new ArgumentException($\\\"{nameof(EventToCommandBehavior)}: Coul\", \"dn't create event handler.\\\", nameof(EventName)); eventInfo.AddEventHandler(View, eventHandler); } vo\", \"id UnregisterEvent() { if (eventInfo is not null && eventHandler is not null ) { eventInfo.RemoveEve\", \"ntHandler(View, eventHandler); } eventInfo = null ; eventHandler = null ; } /// <summary> /// Virtua\", \"l method that executes when a Command is invoked /// </summary> /// <param name=\\\"sender\\\" ></param> /\", \"// <param name=\\\"eventArgs\\\" ></param> [Microsoft.Maui.Controls.Internals.Preserve(Conditional = true \", \")] protected virtual void OnTriggerHandled(object? sender = null , object? eventArgs = null ) { var \", \"parameter = CommandParameter ?? EventArgsConverter?.Convert(eventArgs, typeof (object), null , null \", \"); var command = Command; if (command?.CanExecute(parameter) ?? false ) { command.Execute(parameter)\", \"; } } }\\n```\\n\\nThe OnAttachedTo and OnDetachingFrom methods are used to register and deregister an eve\", \"nt handler for the event defined in the EventName property. Then, when the event fires, the OnTrigge\", \"rHandled method is invoked, which executes the command.\\n\\nThe advantage of using the EventToCommandBe\", \"havior to execute a command when an event fires, is that commands can be associated with controls th\", \"at weren't designed to interact with commands. In addition, this moves event-handling code to view m\", \"odels, where it can be unit tested.\\n\\n## Invoking behaviors from a view\\n\\nThe EventToCommandBehavior i\", \"s particularly useful for attaching a command to a control that doesn't support commands. For exampl\", \"e, the LoginView uses the EventToCommandBehavior to execute the ValidateCommand when the user change\", \"s the value of their password, as shown in the following code:\\n\\n```\\n<Entry IsPassword=\\\"True\\\" Text=\\\"{\", \"Binding Password.Value, Mode=TwoWay}\\\"> <!-- Omitted for brevity... --> <Entry.Behaviors> <mct:EventT\", \"oCommandBehavior EventName=\\\"TextChanged\\\" Command=\\\"{Binding ValidateCommand}\\\" /> </Entry.Behaviors> <\", \"!-- Omitted for brevity... --> </Entry>\\n```\\n\\nAt runtime, the EventToCommandBehavior will respond to \", \"interaction with the Entry. When a user types into the Entry field, the TextChanged event will fire,\", \" which will execute the ValidateCommand in the LoginViewModel. By default, the event arguments for t\", \"he event are passed to the command. If needed, the EventArgsConverter property can be used to conver\", \"t the EventArgs provided by the event into a value that the command expects as input.\\n\\nFor more info\", \"rmation about behaviors, see Behaviors on the .NET MAUI Developer Center.\\n\\n## Summary\\n\\nThe Model-Vie\", \"wViewModel (MVVM) pattern helps cleanly separate an application's business and presentation logic fr\", \"om its user interface (UI). Maintaining a clean separation between application logic and the UI help\", \"s address numerous development issues and makes an application easier to test, maintain, and evolve.\", \" It can also significantly improve code re-use opportunities and allows developers and UI designers \", \"to collaborate more easily when developing their respective parts of an app.\\n\\nUsing the MVVM pattern\", \", the UI of the app and the underlying presentation and business logic are separated into three sepa\", \"rate classes: the view, which encapsulates the UI and UI logic; the view model, which encapsulates p\", \"resentation logic and state; and t he model, which encapsulates the app's business logic and data.\\n\\n\", \"## Dependency injection\\n\\nTypically, a class constructor is invoked when instantiating an object, and\", \" any values that the object needs are passed as arguments to the constructor. This is an example of \", \"dependency injection known as constructor injection . The dependencies the object needs are injected\", \" into the constructor.\\n\\nBy specifying dependencies as interface types, dependency injection enables \", \"decoupling the concrete types from the code that depends on these types. It generally uses a contain\", \"er that holds a list of registrations and mappings between interfaces and abstract types, and the co\", \"ncrete types that implement or extend these types.\\n\\nThere are also other types of dependency injecti\", \"on, such as property setter injection and method call injection , but they are less commonly seen. T\", \"herefore, this chapter will focus solely on performing constructor injection with a dependency injec\", \"tion container.\\n\\n## Introduction to dependency injection\\n\\nDependency injection is a specialized vers\", \"ion of the Inversion of Control (IoC) pattern, where the concern being inverted is the process of ob\", \"taining the required dependency. With dependency injection, another class is responsible for injecti\", \"ng dependencies into an object at runtime. The following code example shows how the ProfileViewModel\", \" class is structured when using dependency injection:\\n\\n```\\nprivate readonly ISettingsService _settin\", \"gsService; private readonly IAppEnvironmentService _appEnvironmentService; public ProfileViewModel( \", \"IAppEnvironmentService appEnvironmentService, IDialogService dialogService, INavigationService navig\", \"ationService, ISettingsService settingsService) : base (dialogService, navigationService, settingsSe\", \"rvice) { _appEnvironmentService = appEnvironmentService; _settingsService = settingsService; // Omit\", \"ted for brevity }\\n```\\n\\nThe ProfileViewModel constructor receives multiple interface object instances\", \" as arguments injected by another class. The only dependency in the ProfileViewModel class is on the\", \" interface types. Therefore, the ProfileViewModel class doesn't have any knowledge of the class that\", \"'s responsible for instantiating the interface objects. The class that's responsible for instantiati\", \"ng the interface objects, and inserting it into the ProfileViewModel class, is known as the dependen\", \"cy injection container .\\n\\nDependency injection containers reduce the coupling between objects by pro\", \"viding a facility to instantiate class instances and manage their lifetime based on the configuratio\", \"n of the container. During object creation, the container injects any dependencies that the object r\", \"equires into it. If those dependencies have not yet been created, the container creates and resolves\", \" their dependencies first.\\n\\nThere are several advantages to using a dependency injection container:\\n\", \"\\n- A container removes the need for a class to locate its dependencies and manage its lifetimes.\\n- A\", \" container allows the mapping of implemented dependencies without affecting the class.\\n- A container\", \" facilitates testability by allowing dependencies to be mocked.\\n- A container increases maintainabil\", \"ity by allowing new classes to be easily added to the app.\\n\\nIn the context of a .NET MAUI app that u\", \"ses MVVM, a dependency injection container will typically be used for registering and resolving view\", \"s, registering and resolving view models, and for registering services and injecting them into view \", \"models.\\n\\nThere are many dependency injection containers available in .NET; the eShop multi-platform \", \"app uses Microsoft.Extensions.DependencyInjection to manage the instantiation of views, view models,\", \" and service classes in the app. Microsoft.Extensions.DependencyInjection facilitates building loose\", \"ly coupled apps, and provides all of the features commonly found in dependency injection containers,\", \" including methods to register type mappings and object instances, resolve objects, manage object li\", \"fetimes, and inject dependent objects into constructors of objects that it resolves. For more inform\", \"ation about Microsoft.Extensions.DependencyInjection, see Dependency injection in .NET.\\n\\nIn .NET MAU\", \"I, the MauiProgram class will call into the CreateMauiApp method to create a MauiAppBuilder object. \", \"The MauiAppBuilder object has a Services property of type IServiceCollection, which provides a place\", \" to register our components, such as views, view models, and services for dependency injection. Any \", \"components registered with the Services property will be provided to the dependency injection contai\", \"ner when the MauiAppBuilder.Build method is called.\\n\\nAt runtime, the container must know which imple\", \"mentation of the services are being requested in order to instantiate them for the requested objects\", \". In the eShop multi-platform app, the IAppEnvironmentService, IDialogService , INavigationService, \", \"and ISettingsService interfaces need to be resolved before it can instantiate a ProfileViewModel obj\", \"ect. This involves the container performing the following actions:\\n\\n- Deciding how to instantiate an\", \" object that implements the interface. This is known as registration .\\n- Instantiating the object th\", \"at implements the required interface and the ProfileViewModel object. This is known as resolution .\\n\", \"\\nEventually, the app will finish using the ProfileViewModel object, and it will become available for\", \" garbage collection. At this point, the garbage collector should dispose of any short-lived interfac\", \"e implementations if other classes do not share the same instance.\\n\\n## Registration\\n\\nBefore dependen\", \"cies can be injected into an object, the types of the dependencies must first be registered with the\", \" container. Registering a type involves passing the container an interface and a concrete type that \", \"implements the interface.\\n\\nThere are two ways of registering types and objects in the container thro\", \"ugh code:\\n\\n- Register a type or mapping with the container. This is known as transient registration.\", \" When required, the container will build an instance of the specified type.\\n- Register an existing o\", \"bject in the container as a singleton. When required, the container will return a reference to the e\", \"xisting object.\\n\\n## Note\\n\\nDependency injection containers are not always suitable. Dependency inject\", \"ion introduces additional complexity and requirements that might not be appropriate or useful to sma\", \"ll apps. If a class does not have any dependencies, or is not a dependency for other types, it might\", \" not make sense to put it in the container. In addition, if a class has a single set of dependencies\", \" that are integral to the type and will never change, it might not make sense to put it in the conta\", \"iner.\\n\\nThe registration of types requiring dependency injection should be performed in a single meth\", \"od in an app. This method should be invoked early in the app's lifecycle to ensure it is aware of th\", \"e dependencies between its classes. The eShop multi-platform app performs this the MauiProgram.Creat\", \"eMauiApp method. The following code example shows how the eShop multiplatform app declares the Creat\", \"eMauiApp in the MauiProgram class:\\n\\n```\\npublic static class MauiProgram { public static MauiApp Crea\", \"teMauiApp() => MauiApp.CreateBuilder() .UseMauiApp<App>() // Omitted for brevity .RegisterAppService\", \"s() .RegisterViewModels() .RegisterViews() .Build(); }\\n```\\n\\nThe MauiApp.CreateBuilder method creates\", \" a MauiAppBuilder object that we can use to register our dependencies. Many dependencies in the eSho\", \"p multi-platform app need to be registered, so the extension methods RegisterAppServices, RegisterVi\", \"ewModels, and RegisterViews were created to help provide an organized and maintainable registration \", \"workflow. The following code shows the RegisterViewModels method:\\n\\n```\\npublic static MauiAppBuilder \", \"RegisterViewModels( this MauiAppBuilder mauiAppBuilder) { mauiAppBuilder.Services.AddSingleton<ViewM\", \"odels.MainViewModel>(); mauiAppBuilder.Services.AddSingleton<ViewModels.LoginViewModel>(); mauiAppBu\", \"ilder.Services.AddSingleton<ViewModels.BasketViewModel>(); mauiAppBuilder.Services.AddSingleton<View\", \"Models.CatalogViewModel>(); mauiAppBuilder.Services.AddSingleton<ViewModels.ProfileViewModel>();\\n```\", \"\\n\\n```\\nmauiAppBuilder.Services.AddTransient<ViewModels.CheckoutViewModel>(); mauiAppBuilder.Services.\", \"AddTransient<ViewModels.OrderDetailViewModel>(); mauiAppBuilder.Services.AddTransient<ViewModels.Set\", \"tingsViewModel>(); mauiAppBuilder.Services.AddTransient<ViewModels.CampaignViewModel>(); mauiAppBuil\", \"der.Services.AddTransient<ViewModels.CampaignDetailsViewModel>(); return mauiAppBuilder; }\\n```\\n\\nThis\", \" method receives an instance of MauiAppBuilder, and we can use the Services property to register our\", \" view models. Depending on the needs of your application, you may need to add services with differen\", \"t lifetimes. The following table provides information on when you may want to choose these different\", \" registration lifetimes:\\n\\n| Method          | Description                                           \", \"                                                                                                    \", \"                             |\\n|-----------------|--------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------|\\n| AddSingleton<T> | Will create a single instance of the object \", \"which will be remain for the lifetime of the application.                                           \", \"                                       |\\n| AddTransient<T> | Will create a new instance of the objec\", \"t when requested during resolution. Transient objects do not have a pre-defined lifetime, but will t\", \"ypically follow the lifetime of their host. |\\n\\n## Note\\n\\nThe view models do not inherit from an inter\", \"face, so they only need their concrete type provided to the AddSingleton&lt;T&gt; and AddTransient&l\", \"t;T&gt; methods.\\n\\nThe CatalogViewModel is used near the application's root and should always be avai\", \"lable, so registering it with AddSingleton&lt;T&gt; is beneficial. Other view models, such as Checko\", \"utViewModel and OrderDetailViewModel are situationally navigated to or are used later in the applica\", \"tion. Suppose you know that you have a component that may not always be used. In that case, if it is\", \" memory or computationally intensive or requires just-in-time data, it may be a better candidate for\", \" AddTransient&lt;T&gt; registration.\\n\\nAnother common way to add services is using the AddSingleton&l\", \"t;TService, TImplementation&gt; and AddTransient&lt;TService, TImplementation&gt; methods. These met\", \"hods take two input types: the interface definition and the concrete implementation. This type of re\", \"gistration is best for cases where you are implementing services based on interfaces. In the code ex\", \"ample below, we register our ISettingsService interface using the SettingsService implementation:\\n\\n`\", \"``\\npublic static MauiAppBuilder RegisterAppServices( this MauiAppBuilder mauiAppBuilder) { mauiAppBu\", \"ilder.Services.AddSingleton<ISettingsService, SettingsService>(); // Omitted for brevity... }\\n```\\n\\nO\", \"nce all services have been registered, the MauiAppBuilder.Build method should be called to create ou\", \"r MauiApp and populate our dependency injection container with all the registered services.\\n\\n## Impo\", \"rtant\\n\\nOnce the Build method has been called, the dependency injection container is immutable and ca\", \"n no longer be updated or modified. Ensure that all services that you need within your application h\", \"ave been registered before you call Build.\\n\\n## Resolution\\n\\nAfter a type is registered, it can be res\", \"olved or injected as a dependency. When a type is being resolved, and the container needs to create \", \"a new instance, it injects any dependencies into the instance.\\n\\nGenerally, when a type is resolved, \", \"one of three things happens:\\n\\n1. If the type hasn't been registered, the container throws an excepti\", \"on.\\n2. If the type has been registered as a singleton, the container returns the singleton instance.\", \" If this is the first time the type is called for, the container creates it if required and maintain\", \"s a reference to it.\\n3. If the type has been registered as transient, the container returns a new in\", \"stance and doesn't maintain a reference to it.\\n\\n.NET MAUI offers a number of ways to resolve registe\", \"red components based on your needs. The most direct way to gain access to the dependency injection c\", \"ontainer is from an Element using the Handler.MauiContext.Services. An example of this is shown belo\", \"w:\\n\\n```\\nvar settingsService = this .Handler.MauiContext.Services.GetServices<ISettingsService>();\\n``\", \"`\\n\\nThis can be helpful if you need to resolve a service from within an Element or from outside of th\", \"e constructor of your Element.\\n\\n## Caution\\n\\nThere is a possibility that the Handler property of your\", \" Element may be null, so be aware that you may need to handle those situations. For more information\", \", please refer to Handler lifecycle on the Microsoft Documentation Center.\\n\\nIf using the Shell contr\", \"ol for .NET MAUI, it will implicitly call into the dependency injection container to create our obje\", \"cts during navigation. When setting up our Shell control, the Routing.RegisterRoute method will tie \", \"a route path to a View as shown in the example below:\\n\\n```\\nRouting.RegisterRoute(\\\"Filter\\\", typeof\\n``\", \"`\\n\\n```\\n(FiltersView));\\n```\\n\\nDuring Shell navigation, it will look for registrations of the FiltersVi\", \"ew, and if any are found, it will create that view and inject any dependencies into the constructor.\", \" As shown in the code example below, the CatalogViewModel will be injected into the FiltersView:\\n\\n``\", \"`\\nnamespace eShop.Views; public partial class FiltersView : ContentPage {\\n```\\n\\n```\\npublic FiltersVie\", \"w(CatalogViewModel viewModel) { BindingContext = viewModel; InitializeComponent(); } }\\n```\\n\\n## Tip\\n\\n\", \"The dependency injection container is great for creating view model instances. If a view model has d\", \"ependencies, it will handle the creation and injection of any required services. Just make sure that\", \" you register your view models and any dependencies that they may have with the CreateMauiApp method\", \" in the MauiProgram class.\\n\\n## Summary\\n\\nDependency injection enables the decoupling of concrete type\", \"s from the code that depends on these types. It typically uses a container that holds a list of regi\", \"strations and mappings between interfaces and abstract types, and the concrete types that implement \", \"or extend these types.\\n\\nMicrosoft.Extensions.DependencyInjection facilitates building loosely couple\", \"d apps and provides all of the features commonly found in dependency injection containers, including\", \" methods to register type mappings and object instances, resolve objects, manage object lifetimes, a\", \"nd inject dependent objects into constructors of objects it resolves.\\n\\n## Communicating between loos\", \"ely coupled components\\n\\nThe publish-subscribe pattern is a messaging pattern in which publishers sen\", \"d messages without knowing any receivers, known as subscribers. Similarly, subscribers listen for sp\", \"ecific messages, without knowing any publishers.\\n\\nEvents in .NET implement the publish-subscribe pat\", \"tern and are the most simple approach for a communication layer between components if loose coupling\", \" is not required, such as a control and the page that contains it. However, the publisher and subscr\", \"iber lifetimes are coupled by object references to each other, and the subscriber type must have a r\", \"eference to the publisher type. This can create memory management issues, especially when there are \", \"short-lived objects that subscribe to an event of a static or longlived object. If the event handler\", \" isn't removed, the subscriber will be kept alive by the reference to it in the publisher, and this \", \"will prevent or delay the garbage collection of the subscriber.\\n\\n## Introduction to MVVM Toolkit Mes\", \"senger\\n\\nThe MVVM Toolkit IMessenger interface describes the publish-subscribe pattern, allowing mess\", \"agebased communication between components that are inconvenient to link by object and type reference\", \"s. This mechanism allows publishers and subscribers to communicate without having a direct reference\", \" to each other, helping to reduce dependencies between components, while also allowing components to\", \" be independently developed and tested.\\n\\n## Note\\n\\nThe MVVM Toolkit Messenger is part of the Communit\", \"yToolkit.Mvvm package. For information on how to add the package to your project, see Introduction t\", \"o the MVVM Toolkit on the Microsoft Developer Center.\\n\\nPublisher\\n\\nPublisher\\n\\nPublisher\\n\\n## Warning\\n\\n\", \"Subscriber\\n\\nSubscriber\\n\\n.NET MAUI contains a builtin MessagingCenter class that's no longer recommen\", \"ded for use. Use the MVVM Toolkit Messenger instead.\\n\\nSubscriber\\n\\nThe IMessenger interface allows fo\", \"r multicast publish-subscribe functionality. This means that there can be multiple publishers that p\", \"ublish a single message, and there can be multiple subscribers listening to the same message. The im\", \"age below illustrates this relationship:\\n\\nThere are two implementations of the IMessenger interface \", \"that come with the\\n\\nCommunityToolkit.Mvvm package. The WeakReferenceMessenger uses weak references w\", \"hich can result in easier cleanup for message subscribers. This is a good option if your subscribers\", \" do not have a clearly defined lifecycle. The StrongReferenceMessenger uses strong references which \", \"can result in better performance and a more clearly controlled lifetime of the subscription. If you \", \"have a workflow with a very controlled lifetime (for ex ample, a subscription that is bound to a pag\", \"e's OnAppearing and OnDisappearing methods), the StrongReferenceManager may be a better option, if p\", \"erformance is a concern. Both of these implementations are available with default implementations re\", \"ady to use by referencing either WeakReferenceMessenger.Default or StrongReferenceMessenger.Default.\", \"\\n\\n## Note\\n\\nWhile the IMessenger interface permits communication between loosely-coupled classes, it \", \"does not offer the only architectural solution to this issue. For example, communication between a v\", \"iew model and a view can also be achieved by the binding engine and through property change notifica\", \"tions. In addition, communication between two view models can also be achieved by passing data durin\", \"g navigation.\\n\\nThe eShop multi-platform app uses the WeakReferenceMessenger class to communicate bet\", \"ween loosely coupled components. The app defines a single message named AddProductMessage. The AddPr\", \"oductMessage is published by the CatalogViewModel class when an item is added to the shopping basket\", \". In return, the CatalogView class subscribes to the message and uses this to highlight the product \", \"adds with animation in response.\\n\\nIn the eShop multi-platform app, WeakReferenceMessenger is used to\", \" update the UI in response to an action occurring in another class. Therefore, messages are publishe\", \"d from the thread that the class is executing on, with subscribers receiving the message on the same\", \" thread.\\n\\nMessage\\n\\n## Tip\\n\\nMarshal to the UI or main thread when performing UI updates. If updates t\", \"o user interfaces are not made on this thread, it can cause the application to crash or become unsta\", \"ble.\\n\\nIf a message that's sent from a background thread is required to update the UI, process the me\", \"ssage on the UI thread in the subscriber by invoking the MainThread.BeginInvokeOnMainThread method.\\n\", \"\\nFor more information about Messenger, see Messenger on the Microsoft Developer Center.\\n\\n## Defining\", \" a message\\n\\nIMessenger messages are custom objects that provide custom payloads. The following code \", \"example shows the AddProductMessage message defined within the eShop multi-platform app:\\n\\n```\\npublic\", \" class AddProductMessage : ValueChangedMessage<int> { public AddProductMessage(int count) : base (co\", \"unt) { } }\\n```\\n\\nThe base class is defined using ValueChangedMessage&lt;T&gt; where T can be of any t\", \"ype needed to pass data. Both message publishers and subscribers can expect messages of a specific t\", \"ype (for example, AddProductMessage). This can help ensure that both parties have agreed to a messag\", \"ing contract and that the data provided with that contract will be consistent. Additionally, this ap\", \"proach provides compile-time type safety and refactoring support.\\n\\n## Publishing a message\\n\\nTo publi\", \"sh a message, we will need to use the IMessenger.Send method. This can be accessed most commonly thr\", \"ough WeakReferenceMessenger.Default.Send or\\n\\nStrongReferenceMessenger.Default.Send. The message sent\", \" can be of any object type. The following code example demonstrates publishing the AddProduct messag\", \"e:\\n\\n```\\nWeakReferenceMessenger.Default.Send( new Messages.AddProductMessage(BadgeCount));\\n```\\n\\nIn th\", \"is example, the Send method specifies provides a new instance of the AddProductMessage object for do\", \"wnstream subscribers to receive. An additional second token parameter can be added to use when multi\", \"ple different subscribers need to receive messages of the same type without receiving the wrong mess\", \"age.\\n\\nThe Send method will publish the message, and its payload data, using a fire-and-forget approa\", \"ch. Therefore, the message is sent even if there are no subscribers registered to receive the messag\", \"e. In this situation, the sent message is ignored.\\n\\n## Subscribing to a message\\n\\nSubscribers can reg\", \"ister to receive a message using one of the IMessenger.Register&lt;T&gt; overloads. The following co\", \"de example demonstrates how the eShop multi-platform app subscribes to, and processes, the AddProduc\", \"tMessage message:\\n\\n```\\nWeakReferenceMessenger.Default .Register<CatalogView, Messages.AddProductMess\", \"age>( this , async (recipient, message) => { await recipient.Dispatcher.DispatchAsync( async () => {\", \" await recipient.badge.ScaleTo(1.2); await recipient.badge.ScaleTo(1.0); }); });\\n```\\n\\nIn the precedi\", \"ng example, the Register method subscribes to the AddProductMessage message and executes a callback \", \"delegate in response to receiving the message. This callback delegate, specified as a lambda express\", \"ion, executes code that updates the UI.\\n\\n## Note\\n\\nAvoid the use of this within your callback delegat\", \"e to avoid capturing that object within the delegate. This can help improve performance. Instead, us\", \"e the recipient parameter.\\n\\nIf payload data is supplied, don't attempt to modify the payload data fr\", \"om within a callback delegate because several threads could be accessing the received data simultane\", \"ously. In this scenario, the payload data should be immutable to avoid concurrency errors.\\n\\n## Unsub\", \"scribing from a message\\n\\nSubscribers can unsubscribe from messages they no longer want to receive. T\", \"his is achieved with one of the IMessenger.Unregister overloads, as demonstrated in the following co\", \"de example:\\n\\nWeakReferenceMessenger.Default.Unregister&lt;Messages.AddProductMessage&gt;( this );\\n\\n#\", \"# Note\\n\\nIn this example, it isn't fully necessary to call Unregister as the WeakReferenceMessenger w\", \"ill allow unused objects to be garbage collected. If the StrongReferenceMessenger were used, it woul\", \"d be advised to call Unregister for any subscriptions that are no longer in use.\\n\\nIn this example, t\", \"he Unsubscribe method syntax specifies the type argument of the message and the recipient object tha\", \"t is listening for messages.\\n\\n## Summary\\n\\nThe MVVM Toolkit IMessenger interface describes the publis\", \"h-subscribe pattern, allowing messagebased communication between components that are inconvenient to\", \" link by object and type references. This mechanism allows publishers and subscribers to communicate\", \" without having a reference to each other, helping to reduce dependencies between components, while \", \"also allowing components to be independently developed and tested.\\n\\n## Navigation\\n\\n.NET MAUI include\", \"s support for page navigation, which typically results from the user's interaction with the UI or fr\", \"om the app itself as a result of internal logic-driven state changes. However, navigation can be com\", \"plex to implement in apps that use the Model-View-ViewModel (MVVM) pattern, as the following challen\", \"ges must be met:\\n\\n- Identifying the view to be navigated to using an approach that does not introduc\", \"e tight coupling and dependencies between views.\\n- Coordinating the process by which the view to be \", \"navigated to is instantiated and initialized. When using MVVM, the view and view-model need to be in\", \"stantiated and associated with each other via the view's binding context. When an app is using a dep\", \"endency injection container, the instantiation of views and view-models might require a specific con\", \"struction mechanism.\\n- Whether to perform view-first navigation, or view-model-first navigation. Wit\", \"h view-first navigation, the page to navigate to refers to the name of the view type. During navigat\", \"ion, the specified view is instantiated, along with its corresponding view-model and other dependent\", \" services. An alternative approach is to use view-model-first navigation, where the page to navigate\", \" to refers to the name of the view-model type.\\n- Determining how to cleanly separate the navigationa\", \"l behavior of the app across the views and viewmodels. The MVVM pattern separates the app's UI and i\", \"ts presentation and business logic, but it doesn't provide a direct mechanism for tying them togethe\", \"r. H owever, the navigation behavior of an app will often span the UI and presentation parts of the \", \"app. The user will often initiate navigation from a view, and the view will be replaced as a result \", \"of the navigation. However, navigation might often also need to be initiated or coordinated from wit\", \"hin the view-model.\\n- Determining how to pass parameters during navigation for initialization purpos\", \"es. For example, if the user navigates to a view to update order details, the order data will have t\", \"o be passed to the view so that it can display the correct data.\\n- Coordinating navigation to ensure\", \" that specific business rules are obeyed. For example, users might be prompted before navigating awa\", \"y from a view so that they can correct any invalid data or be prompted to submit or discard any data\", \" changes that were made within the view.\\n\\nThis chapter addresses these challenges by presenting a na\", \"vigation service class named MauiNavigationService that's used to perform view -model-first page nav\", \"igation.\\n\\n## Note\\n\\nThe MauiNavigationService used by the app is simplistic and does not cover all po\", \"ssible navigation types. The types of navigation needed by your application may require additional f\", \"unctionality.\\n\\n## Navigating between pages\\n\\nNavigation logic can reside in a view's code -behind or \", \"a data-bound view-model. While placing navigation logic in a view might be the most straightforward \", \"approach, it is not easily testable through unit tests. Putting navigation logic in view-model class\", \"es means that the logic can be verified through unit tests. In addition, the view-model can then imp\", \"lement logic to control navigation to ensure that certain business rules are enforced. For example, \", \"an app might not allow the user to navigate away from a page without first ensuring that the entered\", \" data is valid.\\n\\nA navigation service is typically invoked from view-models, in order to promote tes\", \"tability. However, navigating to views from view-models would require the view-models to reference v\", \"iews, and particularly views that the active viewmodel isn't associated with, which is not recommend\", \"ed. Therefore, the MauiNavigationService presented here specifies the view-model type as the target \", \"to navigate to.\\n\\nThe eShop multi-platform app uses the MauiNavigationService class to provide view-m\", \"odel-first navigation. This class implements the INavigationService interface, which is shown in the\", \" following code example:\\n\\n```\\npublic interface INavigationService { Task InitializeAsync(); Task Nav\", \"igateToAsync(string route, IDictionary<string, object> routeParameters = null ); Task PopAsync(); }\\n\", \"```\\n\\nThis interface specifies that an implementing class must provide the following methods:\\n\\n| Meth\", \"od                                                                            | Purpose             \", \"                                                                                                    \", \"                                                           |\\n|--------------------------------------\", \"---------------------------------------------|------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"--------------------------|\\n| InitializeAsync                                                       \", \"            | Performs navigation to one of two pages when the app is launched.                     \", \"                                                                                             |\\n| Nav\", \"igateToAsync(string route, IDictionary<string, object> routeParameters = null) | Performs hierarchic\", \"al navigation to a specified page using a registered navigation route. Can optionally pass named rou\", \"te parameters to use for processing on the destination page |\\n| PopAsync                            \", \"                                              | Removes the current page from the navigation stack. \", \"                                                                                                    \", \"                           |\\n\\n## Note\\n\\nAn INavigationService interface would usually also specify a \", \"GoBackAsync method, which is used to programmatically return to the previous page in the navigation \", \"stack. However, this method is missing from the eShop multiplatform app because it's not required.\\n\\n\", \"## Creating the MauiNavigationService instance\\n\\nThe MauiNavigationService class, which implements th\", \"e INavigationService interface, is registered as a singleton with the dependency injection container\", \" in the MauiProgram.CreateMauiApp() method, as demonstrated in the following code example:\\n\\n```\\nmaui\", \"AppBuilder.Services.AddSingleton<INavigationService, MauiNavigationService>();;\\n```\\n\\nThe INavigation\", \"Service interface can then be resolved by adding it to the constructor of our views and view-models,\", \" as demonstrated in the following code example:\\n\\n```\\npublic AppShell(INavigationService navigationSe\", \"rvice)\\n```\\n\\nThis returns a reference to the MauiNavigationService object that's stored in the depend\", \"ency injection container.\\n\\nThe ViewModelBase class stores the MauiNavigationService instance in a Na\", \"vigationService property, of type INavigationService. Therefore, all view-model classes, which deriv\", \"e from the ViewModelBase class, can use the NavigationService property to access the methods specifi\", \"ed by the INavigationService interface.\\n\\n## Handling navigation requests\\n\\n.NET MAUI provides multipl\", \"e ways to navigate within an application. The traditional way to navigate is with the NavigationPage\", \" class, which implements a hierarchical navigation experience in which the user can navigate through\", \" pages, forward and backward, as desired. The eShop app uses the Shell component as the root contain\", \"er for the application and as a navigation host. For more information about Shell navigation, see Sh\", \"ell Navigation on the Microsoft Developer Center.\\n\\nNavigation is performed inside view-model classes\", \" by invoking one of the NavigateToAsync methods, specifying the route path for the page being naviga\", \"ted to, as demonstrated in the following code example:\\n\\n```\\nawait NavigationService.NavigateToAsync(\", \"\\\"//Main\\\");\\n```\\n\\nThe following code example shows the NavigateToAsync method provided by the MauiNavi\", \"gationService class:\\n\\n```\\npublic Task NavigateToAsync(string route, IDictionary<string, object> rout\", \"eParameters = null ) { return routeParameters != null ? Shell.Current.GoToAsync(route, routeParamete\", \"rs) : Shell.Current.GoToAsync(route); }\\n```\\n\\nThe .NET MAUI Shell control is already familiar with ro\", \"ute-based navigation, so the NavigateToAsync method works to mask this functionality. The NavigateTo\", \"Async method allows navigation data to be\\n\\nspecified as an argument that's passed to the view -model\", \" being navigated to, where it's typically used to perform initialization. For more information, see \", \"Passing parameters during navigation.\\n\\n## Important\\n\\nThere are multiple ways to perform navigation i\", \"n .NET MAUI. The MauiNavigationService is specifically build to work with Shell. If you are using a \", \"NavigationPage or TabbedPage or a different navigation mechanism, this routing service would have to\", \" be updated to work using those components.\\n\\nIn order to register routes for the MauiNavigationServi\", \"ce we need to supply route information from XAML or in the code-behind. The following example shows \", \"registration of routes via XAML.\\n\\n```\\n<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?> <Shell xmlns=\\\"http://s\", \"chemas.microsoft.com/dotnet/2021/maui\\\" xmlns:x=\\\"http://schemas.microsoft.com/winfx/2009/xaml\\\" xmlns:\", \"views=\\\"clr-namespace:eShop.Views\\\" x:Class=\\\"eShop.AppShell\\\"> <!-- Omitted for brevity --> <FlyoutItem\", \" > <ShellContent x:Name=\\\"login\\\" ContentTemplate=\\\"{DataTemplate views:LoginView}\\\" Route=\\\"Login\\\" /> </\", \"FlyoutItem> <TabBar x:Name=\\\"main\\\" Route=\\\"Main\\\"> <ShellContent Title=\\\"CATALOG\\\" Route=\\\"Catalog\\\" Icon=\\\"\", \"{StaticResource CatalogIconImageSource}\\\" ContentTemplate=\\\"{DataTemplate views:CatalogView}\\\" /> <Shel\", \"lContent Title=\\\"PROFILE\\\" Route=\\\"Profile\\\" Icon=\\\"{StaticResource ProfileIconImageSource}\\\" ContentTempl\", \"ate=\\\"{DataTemplate views:ProfileView}\\\" /> </TabBar> </Shell>\\n```\\n\\nIn this example, the ShellContent \", \"and TabBar user interface objects are setting their Route property. This is the preferred method of \", \"registering routes for user interface objects that are controlled by a Shell.\\n\\nIf we have objects th\", \"at will be added to the navigation stack at a later time, then we will need to add those via code-be\", \"hind. The following example show registration of routes in code-behind.\\n\\n```\\nRouting.RegisterRoute(\\\"\", \"Filter\\\", typeof Routing.RegisterRoute(\\\"Basket\\\", typeof\\n```\\n\\n```\\n(FiltersView)); (BasketView));\\n```\\n\\n\", \"In code-behind, we will call the Routing.RegisterRoute method which takes a route name as the first \", \"parameter and a view type as the second parameter. When a view-model uses the NavigationService prop\", \"erty to navigate, the application's Shell object will look for registered routes and push them onto \", \"the navigation stack.\\n\\nAfter the view is created and navigated to, the ApplyQueryAttributes and Init\", \"ializeAsync methods of the view's associated view -model are executed. For more information, see Pas\", \"sing parameters during navigation.\\n\\n## Navigating when the app is launched\\n\\nWhen the app is launched\", \", a Shell object is set as the root view of the application. Once set, the Shell will be used to con\", \"trol route registration and will be present at the root of our application going forward. Once the S\", \"hell has been created, we can wait for it to be attached to the application using the OnParentSet me\", \"thod to initialize our navigation route. The following code example shows this method:\\n\\n```\\nprotecte\", \"d override async void OnParentSet() { base .OnParentSet(); if (Parent is not null ) { await _navigat\", \"ionService.InitializeAsync(); } }\\n```\\n\\nThe method uses an instance of INavigationService which is pr\", \"ovided the constructor from dependency injection and invokes its InitializeAsync method.\\n\\nThe follow\", \"ing code example shows the implementation of the MauiNavigationService.InitializeAsync method:\\n\\n```\\n\", \"public Task InitializeAsync() { return NavigateToAsync(string.IsNullOrEmpty(_settingsService.AuthAcc\", \"essToken) ? \\\"//Login\\\" : \\\"//Main/Catalog\\\"); }\\n```\\n\\nThe //Main/Catalog route is navigated to if the ap\", \"p has a cached access token, which is used for authentication. Otherwise, the //Login route is navig\", \"ated to.\\n\\n## Passing parameters during navigation\\n\\nThe NavigateToAsync method, specified by the INav\", \"igationService interface, enables navigation data to be specified as an IDictionary&lt;string, objec\", \"t&gt; of data that's passed to the view -model being navigated to, where it's typically used to perf\", \"orm initializa tion.\\n\\nFor example, the ProfileViewModel class contains an OrderDetailCommand that's \", \"executed when the user selects an order on the ProfileView page. In turn, this executes the OrderDet\", \"ailAsync method, which is shown in the following code example:\\n\\n```\\nprivate async Task OrderDetailAs\", \"ync(Order order) { if (order is null ) { return ; } await NavigationService.NavigateToAsync( \\\"OrderD\", \"etail\\\",\\n```\\n\\n```\\nnew Dictionary<string, object>{ { \\\"OrderNumber\\\", order.OrderNumber } }); }\\n```\\n\\nThi\", \"s method invokes navigation to the OrderDetail route, passing order number information the order tha\", \"t the user selected. When the dependency injection framework creates the OrderDetailView for the Ord\", \"erDetail route along with the OrderDetailViewModel class which is assigned to the view's BindingCont\", \"ext. The OrderDetailViewModel has an attribute added to it that allows it to receive data from the n\", \"avigation service as shown in the code example below.\\n\\n```\\n[QueryProperty(nameof(OrderNumber), \\\"Orde\", \"rNumber\\\")] public class OrderDetailViewModel : ViewModelBase { public int OrderNumber { get ; set ; \", \"} }\\n```\\n\\nThe QueryProperty attribute allows us to provide a parameter for a property to map values t\", \"o and a key to find values from the query parameters dictionary. In this example, the key 'OrderNumb\", \"er' and order number value were provided during the NavigateToAsync call. The view-model found the '\", \"OrderNumber' key and mapped the value to the OrderNumber property. The OrderNumber property can then\", \" be used at a later time to retrieve the full order details from the OrderService instance.\\n\\n## Invo\", \"king navigation using behaviors\\n\\nNavigation is usually triggered from a view by a user interaction. \", \"For example, the LoginView performs navigation following successful authentication. The following co\", \"de example shows how the navigation is invoked by a behavior:\\n\\n```\\n< WebView > < WebView.Behaviors >\", \" < behaviors:EventToCommandBehavior EventName=\\\"Navigating\\\" EventArgsConverter=\\\"{StaticResource WebNa\", \"vigatingEventArgsConverter}\\\" Command=\\\"{Binding NavigateCommand}\\\" /> </ WebView.Behaviors > </ WebVie\", \"w >\\n```\\n\\nAt runtime, the EventToCommandBehavior will respond to interaction with the WebView. When t\", \"he WebView navigates to a web page, the Navigating event will fire, which will execute the NavigateC\", \"ommand in the LoginViewModel. By default, the event arguments for the event are passed to the comman\", \"d. This data is converted as it's passed between source and target by the converter specified in the\", \" EventArgsConverter property, which returns the Url from the WebNavigatingEventArgs. Therefore, when\", \" the NavigationCommand is executed, the Url of the web page is passed as a parameter to the register\", \"ed Action.\\n\\nIn turn, the NavigationCommand executes the NavigateAsync method, which is shown in the \", \"following code example:\\n\\n```\\nprivate async Task NavigateAsync(string url) { // Omitted for brevity. \", \"if (!string.IsNullOrWhiteSpace(accessToken)) {\\n```\\n\\n```\\n_settingsService.AuthAccessToken = accessTok\", \"en; _settingsService.AuthIdToken = authResponse.IdentityToken; await NavigationService.NavigateToAsy\", \"nc(\\\"//Main/Catalog\\\"); } }\\n```\\n\\nThis method invokes NavigationService route the application to the //\", \"Main/Catalog route.\\n\\n## Confirming or cancelling navigation\\n\\nAn app might need to interact with the \", \"user during a navigation operation, so that the user can confirm or cancel navigation. This might be\", \" necessary, for example, when the user attempts to navigate before having fully completed a data ent\", \"ry page. In this situation, an app should provide a notification that allows the user to navigate aw\", \"ay from the page, or to cancel the navigation operation before it occurs. This can be achieved in a \", \"view-model class by using the response from a notification to control whether or not navigation is i\", \"nvoked.\\n\\n## Summary\\n\\n.NET MAUI includes support for page navigation, which typically results from th\", \"e user's interaction with the UI, or from the app itself, as a result of internal logic-driven state\", \" changes. However, navigation can be complex to implement in apps that use the MVVM pattern.\\n\\nThis c\", \"hapter presented a NavigationService class, which is used to perform view-model-first navigation fro\", \"m view-models. Placing navigation logic in view-model classes means that the logic can be exercised \", \"through automated tests. In addition, the view-model can then implement logic to control navigation \", \"to ensure that certain business rules are enforced.\\n\\nEntry gets errors to display\\n\\nsets properties\\n\\n\", \"IValidity\\n\\n## Validation\\n\\ncreates and uses\\n\\n\\u2022\\n\\nderives from\\n\\nINotifyPropertyChanged\\n\\nExtendedBindabl\", \"e\\n\\nObject\\n\\nAny app that accepts input from users should ensure that the input is valid. An app could\", \", for example, check for input that contains only characters in a particular range, is of a certain \", \"length, or matches a particular format. Without validation, a user can supply data that causes the a\", \"pp to fail. Proper validation enforces business rules and could help to prevent an attacker from inj\", \"ecting malicious data.\\n\\nIn the context of the Model-View-ViewModel (MVVM) pattern, a view model or m\", \"odel will often be required to perform data validation and signal any validation errors to the view \", \"so that the user can correct them. The eShop multi-platform app performs synchronous client-side val\", \"idation of view model properties and notifies the user of any validation errors by highlighting the \", \"control that contains the invalid data, and by displaying error messages that inform the user of why\", \" the data is invalid. The image below shows the classes involved in performing validation in the eSh\", \"op multiplatform app.\\n\\nView model properties that require validation are of type ValidatableObject&l\", \"t;T&gt;, and each ValidatableObject&lt;T&gt; instance has validation rules added to its Validations \", \"property. Validation is\\n\\ninvoked from the view model by calling the Validate method of the Validatab\", \"leObject&lt;T&gt; instance, which retrieves the validation rules and executes them against the Valid\", \"atableObject&lt;T&gt;.Value property. Any validation errors are placed into the Errors property of t\", \"he ValidatableObject&lt;T&gt; instance, and the IsValid property of the ValidatableObject&lt;T&gt; i\", \"nstance is updated to indicate whether the validation succeeded or failed. The following code shows \", \"the implementation of the ValidatableObject&lt;T&gt;:\\n\\n```\\nusing CommunityToolkit.Mvvm.ComponentMode\", \"l; namespace eShop.Validations; public class ValidatableObject<T> : ObservableObject, IValidity { pr\", \"ivate IEnumerable<string> _errors; private bool _isValid; private T _value; public List<IValidationR\", \"ule<T>> Validations { get ; } = new (); public IEnumerable<string> Errors { get => _errors; private \", \"set => SetProperty( ref _errors, value); } public bool IsValid { get => _isValid; private set => Set\", \"Property( ref _isValid, value); } public T Value { get => _value; set => SetProperty( ref _value, va\", \"lue); } public ValidatableObject() { _isValid = true ; _errors = Enumerable.Empty<string>(); } publi\", \"c bool Validate() { Errors = Validations ?.Where(v => !v.Check(Value)) ?.Select(v => v.ValidationMes\", \"sage) ?.ToArray() ?? Enumerable.Empty<string>(); IsValid = !Errors.Any(); return IsValid; } }\\n```\\n\\nP\", \"roperty change notification is provided by the ObservableObject class, and so an Entry control can b\", \"ind to the IsValid property of ValidatableObject&lt;T&gt; instance in the view model class to be not\", \"ified of whether or not the entered data is valid.\\n\\n## Specifying validation rules\\n\\nValidation rules\", \" are specified by creating a class that derives from the IValidationRule&lt;T&gt; interface, which i\", \"s shown in the following code example:\\n\\n```\\npublic interface IValidationRule<T> { string ValidationM\", \"essage { get ; set ; } bool Check(T value); }\\n```\\n\\nThis interface specifies that a validation rule c\", \"lass must provide a boolean Check method that is used to perform the required validation, and a Vali\", \"dationMessage property whose value is the validation error message that will be displayed if validat\", \"ion fails.\\n\\nThe following code example shows the IsNotNullOrEmptyRule&lt;T&gt; validation rule, whic\", \"h is used to perform validation of the username and password entered by the user on the LoginView wh\", \"en using mock services in the eShop multi-platform app:\\n\\n```\\npublic class IsNotNullOrEmptyRule<T> : \", \"IValidationRule<T> { public string ValidationMessage { get ; set ; } public bool Check(T value) => v\", \"alue is string str && !string.IsNullOrWhiteSpace(str); }\\n```\\n\\nThe Check method returns a boolean ind\", \"icating whether the value argument is null, empty, or consists only of whitespace characters.\\n\\nAltho\", \"ugh not used by the eShop multi-platform app, the following code example shows a validation rule for\", \" validating email addresses:\\n\\n```\\npublic class EmailRule<T> : IValidationRule<T> { private readonly \", \"Regex _regex = new (@\\\"^([w.-]+)@([w-]+)((.(w){2,3})+)$\\\"); public string ValidationMessage { get ; se\", \"t ; } public bool Check(T value) => value is string str && _regex.IsMatch(str); }\\n```\\n\\nThe Check met\", \"hod returns a boolean indicating whether or not the value argument is a valid email address. This is\", \" achieved by searching the value argument for the first occurrence of the regular expression pattern\", \" specified in the Regex constructor. Whether the regular expression pattern has been found in the in\", \"put string can be determined by checking the value against Regex.IsMatch.\\n\\n## Note\\n\\nProperty validat\", \"ion can sometimes involve dependent properties. An example of dependent properties is when the set o\", \"f valid values for property A depends on the particular value that has been set in property B. To ch\", \"eck that the value of property A is one of the allowed values would involve retrieving the value of \", \"property B. In addition, when the value of property B changes, property A would need to be revalidat\", \"ed.\\n\\n## Adding validation rules to a property\\n\\nIn the eShop multi-platform app, view model propertie\", \"s that require validation are declared to be of type ValidatableObject&lt;T&gt;, where T is the type\", \" of the data to be validated. The following code example shows an example of two such properties:\\n\\n`\", \"``\\npublic ValidatableObject<string> UserName { get ; private set ; } public ValidatableObject<string\", \"> Password { get ; private set ; } For validation to occur, validation rules must be added to the Va\", \"lidations collection of each ValidatableObject<T> instance, as demonstrated in the following code ex\", \"ample: private void AddValidations() { UserName.Validations.Add(new IsNotNullOrEmptyRule<string> { V\", \"alidationMessage = \\\"A username is required.\\\" }); Password.Validations.Add(new IsNotNullOrEmptyRule<s\", \"tring> { ValidationMessage = \\\"A password is required.\\\" }); }\\n```\\n\\nThis method adds the IsNotNullOrEm\", \"ptyRule&lt;T&gt; validation rule to the Validations collection of each ValidatableObject&lt;T&gt; in\", \"stance, specifying values for the validation rule's ValidationMessage property, which specifies the \", \"validation error message that will be displayed if validation fails.\\n\\n## Triggering validation\\n\\nThe \", \"validation approach used in the eShop multi-platform app can manually trigger validation of a proper\", \"ty, and automatically trigger validation when a property changes.\\n\\n## Triggering validation manually\", \"\\n\\nValidation can be triggered manually for a view model property. For example, this occurs in the eS\", \"hop multi-platform app when the user taps the Login button on the LoginView, when using mock service\", \"s. The command delegate calls the MockSignInAsync method in the LoginViewModel, which invokes valida\", \"tion by executing the Validate method, which is shown in the following code example:\\n\\n```\\nprivate bo\", \"ol Validate() { bool isValidUser = ValidateUserName(); bool isValidPassword = ValidatePassword(); re\", \"turn isValidUser && isValidPassword; } private bool ValidateUserName() { return _userName.Validate()\", \"; } private bool ValidatePassword() {\\n```\\n\\n```\\nreturn _password.Validate(); }\\n```\\n\\nThe Validate meth\", \"od performs validation of the username and password entered by the user on the LoginView, by invokin\", \"g the Validate method on each ValidatableObject&lt;T&gt; instance. The following code example shows \", \"the Validate method from the ValidatableObject&lt;T&gt; class:\\n\\n```\\npublic bool Validate() { Errors \", \"= _validations ?.Where(v => !v.Check(Value)) ?.Select(v => v.ValidationMessage) ?.ToArray() ?? Enume\", \"rable.Empty<string>(); IsValid = !Errors.Any(); return IsValid; }\\n```\\n\\nThis method retrieves any val\", \"idation rules that were added to the object's Validations collection. The Check method for each retr\", \"ieved validation rule is executed, and the ValidationMessage property value for any validation rule \", \"that fails to validate the data is added to the Errors collection of the ValidatableObject&lt;T&gt; \", \"instance. Finally, the IsValid property is set, and its value is returned to the calling method, ind\", \"icating whether validation succeeded or failed.\\n\\n## Triggering validation when properties change\\n\\nVa\", \"lidation is also automatically triggered whenever a bound property changes. For example, when a two-\", \"way binding in the LoginView sets the UserName or Password property, validation is triggered. The fo\", \"llowing code example demonstrates how this occurs:\\n\\n```\\n< Entry Text=\\\"{Binding UserName.Value, Mode=\", \"TwoWay}\\\"> < Entry.Behaviors > < behaviors:EventToCommandBehavior EventName=\\\"TextChanged\\\" Command=\\\"{B\", \"inding ValidateUserNameCommand}\\\" /> </ Entry.Behaviors > </ Entry >\\n```\\n\\nThe Entry control binds to \", \"the UserName.Value property of the ValidatableObject&lt;T&gt; instance, and the control's Behaviors \", \"collection has an EventToCommandBehavior instance added to it. This behavior executes the ValidateUs\", \"erNameCommand in response to the TextChanged event firing on the Entry, which is raised when the tex\", \"t in the Entry changes. In turn, the ValidateUserNameCommand delegate executes the ValidateUserName \", \"method, which executes the Validate method on the ValidatableObject&lt;T&gt; instance. Therefore, ev\", \"ery time the user enters a character in the Entry control for the username, validation of the entere\", \"d data is performed.\\n\\n## Displaying validation errors\\n\\nThe eShop multi-platform app notifies the use\", \"r of any validation errors by highlighting the control that contains the invalid data with a red bac\", \"kground, and by displaying an error message that informs\\n\\nUser name or email the user why the data i\", \"s invalid below the control containing the invalid data. When the invalid data is corrected, the bac\", \"kground changes back to the default state and the error message is removed. The image below shows th\", \"e LoginView in the eShop multi-platform app when validation errors are present.\\n\\n## A password is re\", \"quired.\\n\\n## Highlighting a control that contains invalid data\\n\\n.NET MAUI offers a number of ways to \", \"present validation information to end-users, but one of the most straight-forward ways is through th\", \"e use of Triggers. Triggers provide us a way to change the state of our controls, typically for appe\", \"arance, based on an event or data change that occurs for a control. For validation, we will be using\", \" a DataTrigger which will listen to changes raised from a bound property and respond to the changes.\", \" The Entry controls on the LoginView are setup using the following code:\\n\\n```\\n< Entry Text=\\\"{Binding\", \" UserName.Value, Mode=TwoWay}\\\"> < Entry.Style > < OnPlatform x:TypeArguments=\\\"Style\\\"> < On Platform=\", \"\\\"iOS, Android\\\" Value=\\\"{StaticResource EntryStyle}\\\" /> < On Platform=\\\"WinUI\\\" Value=\\\"{StaticResource W\", \"inUIEntryStyle}\\\" /> </ OnPlatform > </ Entry.Style > < Entry.Behaviors > < mct:EventToCommandBehavio\", \"r EventName=\\\"TextChanged\\\" Command=\\\"{Binding ValidateCommand}\\\" /> </ Entry.Behaviors > < Entry.Trigge\", \"rs > < DataTrigger TargetType=\\\"Entry\\\" Binding=\\\"{Binding UserName.IsValid}\\\" Value=\\\"False\\\"> < Setter P\", \"roperty=\\\"BackgroundColor\\\" Value=\\\"{StaticResource ErrorColor}\\\" /> </ DataTrigger > </ Entry.Triggers \", \"> </ Entry >\\n```\\n\\nThe DataTrigger specifies the following properties:\\n\\n| Property   | Description   \", \"                                                                                       |\\n|----------\", \"--|-------------------------------------------------------------------------------------------------\", \"-----|\\n| TargetType | The control type that the trigger belongs to.                                 \", \"                       |\\n| Binding    | The data Binding markup which will provide change notificati\", \"ons and value for the trigger condition. |\\n| Value      | The data value to specify when the trigger\", \"'s condition has been met.                                 |\\n\\nFor this Entry, we will be listening f\", \"or changes to the LoginViewModel.UserName.IsValid property. Each time this property raises a change,\", \" the value will be compared against the Value property set in the DataTrigger. If the values are equ\", \"al, then the trigger condition will be met and any Setter objects provided to the DataTrigger will b\", \"e executed. This control has a single Setter object that updates the BackgroundColor property to a c\", \"ustom color defined using the StaticResource markup. When a Trigger condition is no longer met, the \", \"control will revert the properties set by the Setter object to their previous state. For more inform\", \"ation about Triggers, see .NET MAUI Docs: Triggers.\\n\\n## Displaying error messages\\n\\nThe UI displays v\", \"alidation error messages in Label controls below each control whose data failed validation. The foll\", \"owing code example shows the Label that displays a validation error message, if the user has not ent\", \"ered a valid username:\\n\\n## &lt; Label\\n\\nText=\\\"{Binding UserName.Errors, Converter={StaticResource Fir\", \"stValidationErrorConverter}\\\" Style=\\\"{StaticResource ValidationErrorLabelStyle}\\\" /&gt;\\n\\nEach Label bi\", \"nds to the Errors property of the view model object that's being validated. The Errors property is p\", \"rovided by the ValidatableObject&lt;T&gt; class, and is of type IEnumerable&lt;string&gt;. Because t\", \"he Errors property can contain multiple validation errors, the FirstValidationErrorConverter instanc\", \"e is used to retrieve the first error from the collection for display.\\n\\n## Summary\\n\\nThe eShop multi-\", \"platform app performs synchronous client-side validation of view model properties and notifies the u\", \"ser of any validation errors by highlighting the control that contains the invalid data, and by disp\", \"laying error messages that inform the user why the data is invalid.\\n\\nView model properties that requ\", \"ire validation are of type ValidatableObject&lt;T&gt;, and each ValidatableObject&lt;T&gt; instance \", \"has validation rules added to its Validations property. Validation is invoked from the view model by\", \" calling the Validate method of the ValidatableObject&lt;T&gt; instance, which retrieves the validat\", \"ion rules and executes them against the ValidatableObject&lt;T&gt; Value property. Any validation er\", \"rors are placed into the Errors property of the ValidatableObject&lt;T&gt; instance, and the IsValid\", \" property of the ValidatableObject&lt;T&gt; instance is updated to indicate whether validation succe\", \"eded or failed.\\n\\n## Application settings management\\n\\nSettings allow the separation of data that conf\", \"igures the behavior of an app from the code, allowing the behavior to be changed without rebuilding \", \"the app. There are two types of settings: app settings and user settings.\\n\\nApp settings are data tha\", \"t an app creates and manages. It can include data such as fixed web service endpoints, API keys, and\", \" runtime state. App settings are tied to core functionality and are only meaningful to that app.\\n\\nUs\", \"er settings are the customizable settings of an app that affect the app's behavior and don't require\", \" frequent re-adjustment. For example, an app might let the user specify where to retrieve data and h\", \"ow to display it on the screen.\\n\\n## Creating a Settings Interface\\n\\nWhile the preferences manager can\", \" be used directly in your application, it does come with the drawback of making your application tig\", \"htly coupled to the preferences manager implementation. This coupling means that creating unit tests\", \" or extending the functionality of preferences management will be limited since your application wil\", \"l not have a direct way to intercept the behavior. To address this concern, an interface can be crea\", \"ted to work as a proxy for preferences management. The interface will allow us to supply an implemen\", \"tation that fits our needs. For example, when writing a unit test, we may want to set specific setti\", \"ngs, and the interface will give us an easy way to consistently set this data for the test. The foll\", \"owing code example shows the ISettingsService interface in the eShop multi-platform app:\\n\\n```\\nnamesp\", \"ace eShop.Services.Settings; public interface ISettingsService { string AuthAccessToken { get ; set \", \"; } string AuthIdToken { get ; set ; } bool UseMocks { get ; set ; } string IdentityEndpointBase { g\", \"et ; set ; } string GatewayShoppingEndpointBase { get ; set ; } string GatewayMarketingEndpointBase \", \"{ get ; set ; } bool UseFakeLocation { get ; set ; } string Latitude { get ; set ; } string Longitud\", \"e { get ; set ; }\\n```\\n\\n```\\nbool AllowGpsLocation { get ; set ; }\\n```\\n\\n}\\n\\n## Adding Settings\\n\\n.NET MA\", \"UI includes a preferences manager that provides a way to store runtime settings for a user. This fea\", \"ture can be accessed from anywhere within your application using the Microsoft.Maui.Storage.Preferen\", \"ces class. The preferences manager provides a consistent, type-safe, cross-platform approach for per\", \"sisting and retrieving app and user settings, while using the native settings management provided by\", \" each platform. In addition, it's straightforward to use data binding to access settings data expose\", \"d by the library. For more information, see the Preferences on the Microsoft Developer Center.\\n\\n## T\", \"ip\\n\\nPreferences is meant for storing relatively small data. If you need to store larger or more comp\", \"lex data, consider using a local database or filesystem to store the data.\\n\\nOur application will use\", \" the Preferences class need to implement the ISettingsService interface. The code below shows how th\", \"e eShop multiplatform app's SettingsService implements the AuthTokenAccess and UseMocks properties:\\n\", \"\\n```\\npublic sealed class SettingsService : ISettingsService { private const string AccessToken = \\\"ac\", \"cess_token\\\"; private const string AccessTokenDefault = string.Empty; private const string IdUseMocks\", \" = \\\"use_mocks\\\"; private const bool UseMocksDefault = true ; public string AuthAccessToken { get => P\", \"references.Get(AccessToken, AccessTokenDefault); set => Preferences.Set(AccessToken, value); } publi\", \"c bool UseMocks { get => Preferences.Get(IdUseMocks, UseMocksDefault); set => Preferences.Set(IdUseM\", \"ocks, value); } }\\n```\\n\\nEach setting consists of a private key, a private default value, and a public\", \" property. The key is always a const string that defines a unique name, with the default value for t\", \"he setting being a static readonly or constant value of the required type. Providing a default value\", \" ensures that a valid value is available if an unset setting is retrieved. This service implementati\", \"on can be provided via dependency injection to our application for use in view-models or other servi\", \"ces throughout the application.\\n\\nUse Microservices/Containers from eShopOnContainers\\n\\n## Data bindin\", \"g to user settings\\n\\nIn the eShop multi-platform app, the SettingsView exposes multiple settings the \", \"user can configure at runtime. These settings include allowing configuration of whether the app shou\", \"ld retrieve data from microservices deployed as Docker containers or whether the app should retrieve\", \" data from mock services that don't require an internet connection. When retrieving data from contai\", \"nerized microservices, a base endpoint URL for the microservices must be specified. The image below \", \"shows the SettingsView when the user has chosen to retrieve data from containerized microservices.\\n\\n\", \"Data binding can be used to retrieve and set settings exposed by the ISettingService interface. This\", \" is achieved by controls on the view binding to view model properties that in turn access properties\", \" in the ISettingService interface and raising a property changed notification if the value has chang\", \"ed.\\n\\nThe following code example shows the Entry control from the SettingsView that allows the user t\", \"o enter a base identity endpoint URL for the containerized microservices:\\n\\n```\\n< Entry Text=\\\"{Bindin\", \"g IdentityEndpoint, Mode=TwoWay}\\\" />\\n```\\n\\nThis Entry control binds to the IdentityEndpoint property \", \"of the SettingsViewModel class, using a twoway binding. The following code example shows the Identit\", \"yEndpoint property:\\n\\n```\\nprivate readonly ISettingsService _settingsService; private string _identit\", \"yEndpoint; public SettingsViewModel( ILocationService locationService, IAppEnvironmentService appEnv\", \"ironmentService, IDialogService dialogService, INavigationService navigationService, ISettingsServic\", \"e settingsService) : base (dialogService, navigationService, settingsService) { _settingsService = s\", \"ettingsService; _identityEndpoint = _settingsService.IdentityEndpointBase; } public string IdentityE\", \"ndpoint\\n```\\n\\nnetwork.\\n\\nEndpoint\\n\\n```\\n{ get => _identityEndpoint; set { SetProperty( ref _identityEnd\", \"point, value); if (!string.IsNullOrWhiteSpace(value)) { UpdateIdentityEndpoint(); } } }\\n```\\n\\nWhen th\", \"e IdentityEndpoint property is set, the UpdateIdentityEndpoint method is called, provided that the s\", \"upplied value is valid. The following code example shows the UpdateIdentityEndpoint method:\\n\\n```\\npri\", \"vate void UpdateIdentityEndpoint() { _settingsService.IdentityEndpointBase = _identityEndpoint; }\\n``\", \"`\\n\\nThis method updates the IdentityEndpointBase property in the ISettingService interface implementa\", \"tion with the base endpoint URL value entered by the user. If the SettingsService class is provided \", \"as the implementation for _settingsService, the value will persist to platform-specific storage.\\n\\n##\", \" Summary\\n\\nSettings allow the separation of data that configures the behavior of an app from the code\", \", allowing the behavior to be changed without rebuilding the app. App settings are data that an app \", \"creates and manages, and user settings are the customizable settin gs of an app that affect the app'\", \"s behavior and don't require frequent re -adjustment.\\n\\nThe Microsoft.Maui.Storage.Preferences class \", \"provides a consistent, type-safe, cross-platform approach for persisting and retrieving app and user\", \" settings.\\n\\n## Containerized microservices\\n\\nDeveloping client-server applications has resulted in a \", \"focus on building tiered applications that use specific technologies in each tier. Such applications\", \" are often referred to as monolithic and are packaged onto hardware pre-scaled for peak loads. The m\", \"ain drawbacks of this development approach are the tight coupling between components within each tie\", \"r, that individual components can't be easily scaled, and the cost of testing. A simple upda te can \", \"have unforeseen effects on the rest of the tier, so a change to an application component requires it\", \"s entire tier to be retested and redeployed.\\n\\nParticularly concerning, in the age of the cloud, is t\", \"hat individual components can't be easily scaled. A monolithic application contains domain-specific \", \"functionality and is typically divided by functional layers such as front-end, business logic, and d\", \"ata storage. The image below illustrates that a monolithic application is scaled by cloning the enti\", \"re application onto multiple machines.\\n\\nApp\\n\\n## Microservices\\n\\nMicroservices offer a different appro\", \"ach to application development and deployment, an approach that's suited to the agility, scale, and \", \"reliability requirements of modern cloud applications. A microservices application is split into ind\", \"ependent components that work together to deliver the application's overall functionality. The term \", \"microservice emphasizes that applications should be composed of services small enough to reflect par\", \"ticular concerns, so each microservice implements a single function. In addition, each microservice \", \"has well-defined contracts with which other microservices communicate and share data. Typical exampl\", \"es of microservices include shopping carts, inventory processing, purchase subsystems, and payment p\", \"rocessing.\\n\\nMicroservices can scale independently compared to giant monolithic applications that sca\", \"le together. This means that a specific functional area that requires more processing power or netwo\", \"rk bandwidth to support demand can be scaled rather than unnecessarily scaling out other application\", \" areas. The image below illustrates this approach, where microservices are deployed and scaled indep\", \"endently, creating instances of services across machines.\\n\\nApp 1\\n\\nApp 2\\n\\nMicroservice scale-out can \", \"be nearly instantaneous, allowing an application to adapt to changing loads. For example, a single m\", \"icroservice in the web-facing functionality of an application might be the only microservice that ne\", \"eds to scale out to handle additional incoming traffic.\\n\\nThe classic model for application scalabili\", \"ty is to have a load-balanced, stateless tier with a shared external datastore to store persistent d\", \"ata. Stateful microservices manage their own persistent data, usually storing it locally on the serv\", \"ers on which they are placed, to avoid the overhead of network access and complexity of cross-servic\", \"e operations. This enables the fastest possible processing of data and can eliminate the need for ca\", \"ching systems. In addition, scalable stateful microservices usually partition data among their insta\", \"nces, in order to manage data size and transfer throughput beyond which a single server can support.\", \"\\n\\nMicroservices also support independent updates. This loose coupling between microservices provides\", \" a rapid and reliable application evolution. Their independent, distributed nature helps rolling upd\", \"ates, where only a subset of instances of a single microservice will update at any given time. There\", \"fore, if a problem is detected, a buggy update can be rolled back, before all instances update with \", \"the faulty code or configuration. Similarly, microservices typically use schema versioning, so that \", \"clients see a consistent version when updates are being applied, regardless of which microservice in\", \"stance is being communicated with.\\n\\nTherefore, microservice applications have many benefits over mon\", \"olithic applications:\\n\\n- Each microservice is relatively small, easy to manage and evolve.\\n- Each mi\", \"croservice can be developed and deployed independently of other services.\\n- Each microservice can be\", \" scaled-out independently. For example, a catalog service or shopping basket service might need to b\", \"e scaled-out more than an ordering service.\\n\\nTherefore, the resulting infrastructure will more effic\", \"iently consume resources when scaling out.\\n\\n- Each microservice isolates any issues. For example, if\", \" there is an issue in a service it only impacts that service. The other services can continue to han\", \"dle requests.\\n- Each microservice can use the latest technologies. Because microservices are autonom\", \"ous and run side-by-side, the latest technologies and frameworks can be used, rather than being forc\", \"ed to use an older framework that might be used by a monolithic application.\\n\\nHowever, a microservic\", \"e-based solution also has potential drawbacks:\\n\\n- Choosing how to partition an application into micr\", \"oservices can be challenging, as each microservice has to be completely autonomous, end-to-end, incl\", \"uding responsibility for its data sources.\\n- Developers must implement inter-service communication, \", \"which adds complexity and latency to the application.\\n- Atomic transactions between multiple microse\", \"rvices usually aren't possible. Therefore, business requirements must embrace eventual consistency b\", \"etween microservices.\\n- In production, there is an operational complexity in deploying and managing \", \"a system compromised of many independent services.\\n- Direct client-to-microservice communication can\", \" make it difficult to refactor the contracts of microservices. For example, over time how the system\", \" is partitioned into services might need to change. A single service might split into two or more se\", \"rvices, and two services might merge. When clients communicate directly with microservices, this ref\", \"actoring work can break compatibility with client apps.\\n\\n## Containerization\\n\\nContainerization is an\", \" approach to software development in which an application and its versioned set of dependencies, plu\", \"s its environment configuration abstracted as deployment manifest files, are packaged together as a \", \"container image, tested as a unit, and deployed to a host operating system.\\n\\nA container is an isola\", \"ted, resource controlled, and portable operating environment, where an application can run without t\", \"ouching the resources of other containers, or the host. Therefore, a container looks and acts like a\", \" newly installed physical computer or a virtual machine.\\n\\nThere are many similarities between contai\", \"ners and virtual machines, as illustrated below.\\n\\nVirtual Machines\\n\\nApp 1\\n\\nApp 2\\n\\nBins/Libs\\n\\nGuest O\", \"S\\n\\nHost Operating System\\n\\nApp 1\\n\\nBins/Libs\\n\\nContainers\\n\\nApp 2\\n\\nBins/Libs\\n\\nApp 3\\n\\n## Bins/Libs\\n\\nA con\", \"tainer runs an operating system, has a file system, and can be accessed over a network as if it were\", \" a physical or virtual machine. However, the technology and concepts used by containers are very dif\", \"ferent from virtual machines. Virtual machines include the applications, the required dependencies, \", \"and a full guest operating system. Containers include the application and its dependencies, but shar\", \"e the operating system with other containers, running as isolated processes on the host operating sy\", \"stem (aside from Hyper-V containers which run inside of a special virtual machine per container). Th\", \"erefore, containers share resources and typically require fewer resources than virtual machines.\\n\\nTh\", \"e advantage of a container-oriented development and deployment approach is that it eliminates most o\", \"f the issues that arise from inconsistent environment setups and the problems that come with them. I\", \"n addition, containers permit fast application scale-up functionality by instancing new containers a\", \"s required.\\n\\nThe key concepts when creating and working with containers are:\\n\\n| Concept         | De\", \"scription                                                                                           \", \"                                                                                                    \", \"       |\\n|-----------------|------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"--------------------------------------|\\n| Container Host  | The physical or virtual machine configur\", \"ed to host containers. The container host will run one or more containers.                          \", \"                                                                     |\\n| Container Image | An image \", \"consists of a union of layered filesystems stacked on top of each other, and is the basis of a conta\", \"iner. An image does not have state and it never changes as it's deployed to different environments. \", \"|\\n| Container       | A container is a runtime instance of an image.                                \", \"                                                                                                    \", \"                               |\\n\\nBins/Libs\\n\\nApp 3\\n\\nBins/Libs\\n\\n| Concept              | Description \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                    \", \"      |\\n|----------------------|--------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"---------------------------------------------------|\\n| Container OS Image   | Containers are deploye\", \"d from images. The container operating system image is the first layer in potentially many image lay\", \"ers that make up a container. A container operating system is immutable, and can't be modified.     \", \"                                                                                                |\\n| \", \"Container Repository | Each time a container image is created, the image and its dependencies are st\", \"ored in a local repository. These images can be reused many times on the container host. The contain\", \"er images can also be stored in a public or private registry, such as Docker Hub, so that they can b\", \"e used across different container hosts. |\\n\\nEnterprises are increasingly adopting containers when im\", \"plementing microservice-based applications, and Docker has become the standard container implementat\", \"ion that has been adopted by most software platforms and cloud vendors.\\n\\nThe eShop reference applica\", \"tion uses Docker to host four containerized back-end microservices, as illustrated in the diagram be\", \"low.\\n\\nDocker Host\\n\\nIdentity Microservice (STS+Users)\\n\\nWeb API\\n\\nSQL Server\\n\\nThe architecture of the b\", \"ack-end services in the reference application is decomposed into multiple autonomous sub-systems in \", \"the form of collaborating microservices and containers. Each microservice provides a single area of \", \"functionality: an identity service, a catalog service, an ordering service, and a basket service.\\n\\nE\", \"ach microservice has its own database, allowing it to be fully decoupled from the other microservice\", \"s. Where necessary, consistency between databases from different microservices is achieved using app\", \"lication-level events. For more information, see Communication between microservices.\\n\\n## Communicat\", \"ion between client and microservices\\n\\nThe eShop multi-platform app communicates with the containeriz\", \"ed back-end microservices using direct client-to-microservice communication, as shown below.\\n\\n1\\n\\nMob\", \"ile App\\n\\nBackend Microservices\\n\\nMicroservice 1\\n\\nWeb API\\n\\nContainer\\n\\nWith direct client-to-microservi\", \"ce communication, the multi-platform app makes requests to each microservice directly through its pu\", \"blic endpoint, with a different TCP port per microservice. In production, the endpoint would typical\", \"ly map to the microservice's load balancer, which distributes requests across the available instance\", \"s.\\n\\n## Tip\\n\\n## Consider using API gateway communication.\\n\\nDirect client-to-microservice communicatio\", \"n can have drawbacks when building a large and complex microservicebased application, but it's more \", \"than adequate for a small application. Consider using API gateway communication when designing a lar\", \"ge microservice-based application with tens of microservices.\\n\\n## Communication between microservice\", \"s\\n\\nA microservices-based application is a distributed system, potentially running on multiple machin\", \"es. Each service instance is typically a process. Therefore, services must interact using an inter-p\", \"rocess communication protocol, such as HTTP, TCP, Advanced Message Queuing Protocol (AMQP), or binar\", \"y protocols, depending on the nature of each service.\\n\\nThe two common approaches for microservice-to\", \"-microservice communication are HTTP-based REST communication when querying for data, and lightweigh\", \"t asynchronous messaging when communicating updates across multiple microservices.\\n\\nAsynchronous mes\", \"saging-based event-driven communication is critical when propagating changes across multiple microse\", \"rvices. With this approach, a microservice publishes an event when something notable happens, for ex\", \"ample, when it updates a business entity. Other microservices subscribe to these events. Then, when \", \"a microservice receives an event, it updates its own business entities, which might, in turn, lead t\", \"o more events being published. This publish-subscribe functionality is usually achieved with an even\", \"t bus.\\n\\nMicroservice A\\n\\nMobile App\\n\\n-\\n\\nDocker Host\\n\\nIdentity Microservice (STS+Users)\\n\\nWeb API\\n\\nSQL \", \"Server\\n\\nContainer database\\n\\nAn event bus allows publish-subscribe communication between microservice\", \"s without requiring the components to be explicitly aware of each other, as shown below.\\n\\n1\\n\\nFrom an\", \" application perspective, the event bus is simply a publish-subscribe channel exposed via an interfa\", \"ce. However, the way the event bus is implemented can vary. For example, an event bus implementation\", \" could use RabbitMQ, Azure Service Bus, or other service buses such as NServiceBus and MassTransit. \", \"The diagram below shows how an event bus is used in the eShop reference application.\\n\\nThe eShop even\", \"t bus, implemented using RabbitMQ, provides one-to-many asynchronous publishsubscribe functionality.\", \" This means that after publishing an event, there can be multiple subscribers listening for the same\", \" event. The diagram below illustrates this relationship.\\n\\nMicroservice B\\n\\nUser-Profile Microservice\\n\", \"\\nWeb API Service\\n\\n3\\n\\nDatabase as\\n\\nService\\n\\nCache\\n\\nUserUpdated event \\u2192 Buyer info\\n\\nThis one-to-many c\", \"ommunication approach uses events to implement business transactions that span multiple services, en\", \"suring eventual consistency between the services. An eventual-consistent transaction consists of a s\", \"eries of distributed steps. Therefore, when the user-profile microservice receives the UpdateUser co\", \"mmand, it updates the user's details in its database and publishes the UserUpdated event to the even\", \"t bus. Both the basket microservice and the ordering microservice have subscribed to receive this ev\", \"ent, and in response, update their buyer information in their respective databases.\\n\\n## Summary\\n\\nMic\", \"roservices offer an approach to application development and deployment that's suited to the agility,\", \" scale, and reliability requirements of modern cloud applications. One of the main advantages of mic\", \"roservices is that they can be scaled-out independently, which means that a specific functional area\", \" can be scaled that requires more processing power or network bandwidth to support demand without un\", \"necessarily scaling areas of the application that are not experiencing increased demand.\\n\\nA containe\", \"r is an isolated, resource-controlled, and portable operating environment where an application can r\", \"un without touching the resources of other containers or the host. Enterprises are increasingly adop\", \"ting containers when implementing microservice-based applications, and Docker has become the standar\", \"d container implementation that most software platforms and cloud vendors have adopted.\\n\\nUpdateUser \", \"command\\n\\n\\u2022\\n\\nDatabase\\n\\nBasket Microservice\\n\\n## Accessing remote data\\n\\nMany modern web-based solutions\", \" make use of web services, hosted by web servers, to provide functionality for remote client applica\", \"tions. The operations that a web service exposes constitute a web API.\\n\\nClient apps should be able t\", \"o utilize the web API without knowing how the data or operations that the API exposes are implemente\", \"d. This requires that the API abides by common standards that enable a client app and web service to\", \" agree on which data formats to use, and the structure of the data that is exchanged between client \", \"apps and the web service.\\n\\n## Introduction to Representational State Transfer\\n\\nRepresentational Stat\", \"e Transfer (REST) is an architectural style for building distributed systems based on hypermedia. A \", \"primary advantage of the REST model is that it's based on open standards and doesn't bind the implem\", \"entation of the model or the client apps that access it to any specific implementation. Therefore, a\", \" REST web service could be implemented using Microsoft ASP.NET Core, and client apps could be develo\", \"ping using any language and toolset that can generate HTTP requests and parse HTTP responses.\\n\\nThe R\", \"EST model uses a navigational scheme to represent objects and services over a network, referred to a\", \"s resources. Systems that implement REST typically use the HTTP protocol to transmit requests to acc\", \"ess these resources. In such systems, a client app submits a request in the form of a URI that ident\", \"ifies a resource, and an HTTP method (such as GET, POST, PUT, or DELETE) that indicates the operatio\", \"n to be performed on that resource. The body of the HTTP request contains any data required to perfo\", \"rm the operation.\\n\\n## Note\\n\\nREST defines a stateless request model. Therefore, HTTP requests must be\", \" independent and might occur in any order.\\n\\nThe response from a REST request makes use of standard H\", \"TTP status codes. For example, a request that returns valid data should include the HTTP response co\", \"de 200 (OK), while a request that fails to find or delete a specified resource should return a respo\", \"nse that includes the HTTP status code 404 (Not Found).\\n\\nA RESTful web API exposes a set of connecte\", \"d resources, and provides the core operations that enable an app to manipulate those resources and e\", \"asily navigate between them. For this reason, the URIs that constitute a typical RESTful web API are\", \" oriented towards the data that it exposes, and use the facilities provided by HTTP to operate on th\", \"is data.\\n\\nThe data included by a client app in an HTTP request, and the corresponding response messa\", \"ges from the web server, could be presented in a variety of formats, known as media types. When a cl\", \"ient app sends a request that returns data in the body of a message, it can specify the media types \", \"it can handle in the Accept header of the request. If the web server supports this media type, it ca\", \"n reply with a response that includes the Content-Type header that specifies the format of the data \", \"in the body of the mes sage. It's then the responsibility of the client app to parse the response me\", \"ssage and interpret the results in the message body appropriately.\\n\\nFor more information about REST,\", \" see API design and API implementation on Microsoft Docs.\\n\\n## Consuming RESTful APIs\\n\\nThe eShop mult\", \"i-platform app uses the Model-View-ViewModel (MVVM) pattern, and the model elements of the pattern r\", \"epresent the domain entities used in the app. The controller and repository classes in the eShop ref\", \"erence application accept and return many of these model objects. Therefore, they are used as data t\", \"ransfer objects (DTOs) that hold all the data that is passed between the app and the containerized m\", \"icroservices. The main benefit of using DTOs to pass data to and receive data from a web service is \", \"that by transmitting more data in a single remote call, the app can reduce the number of remote call\", \"s that need to be made.\\n\\n## Making web requests\\n\\nThe eShop multi-platform app uses the HttpClient cl\", \"ass to make requests over HTTP, with JSON being used as the media type. This class provides function\", \"ality for asynchronously sending HTTP requests and receiving HTTP responses from a URI identified re\", \"source. The HttpResponseMessage class represents an HTTP response message received from a REST API a\", \"fter an HTTP request has been made. It contains information about the response, including the status\", \" code, headers, and any body. The HttpContent class represents the HTTP body and content headers, su\", \"ch as Content-Type and Content-Encoding. The content can be read using any of the ReadAs methods, su\", \"ch as ReadAsStringAsync and ReadAsByteArrayAsync, depending on the format of the data.\\n\\n## Making a \", \"GET request\\n\\nThe CatalogService class is used to manage the data retrieval process from the catalog \", \"microservice. In the RegisterViewModels method in the MauiProgram class, the CatalogService class is\", \" registered as a type mapping against the ICatalogService type with the dependency injection contain\", \"er. Then, when an instance of the CatalogViewModel class is created, its constructor accepts an ICat\", \"alogService type, which the dependency injection container resolves, returning an instance of the Ca\", \"talogService class. For more information about dependency injection, see Dependency Injection.\\n\\nThe \", \"image below shows the interaction of classes that read catalog data from the catalog microservice fo\", \"r displaying by the CatalogView.\\n\\nCatalogViewModel\\n\\nGetCatalogAsync\\n\\nClientApp\\n\\nRequestProvider\\n\\nCat\", \"alog.API\\n\\nCatalogController\\n\\nWhen the CatalogView is navigated to, the OnInitialize method in the Ca\", \"talogViewModel class is called. This method retrieves catalog data from the catalog microservice, as\", \" demonstrated in the following code example:\\n\\n```\\npublic override async Task InitializeAsync() { Pro\", \"ducts = await _productsService.GetCatalogAsync(); }\\n```\\n\\nThis method calls the GetCatalogAsync metho\", \"d of the CatalogService instance that was injected into the CatalogViewModel by the dependency injec\", \"tion container. The following code example shows the GetCatalogAsync method:\\n\\n```\\npublic async Task<\", \"ObservableCollection<CatalogItem>> GetCatalogAsync() { UriBuilder builder = new UriBuilder(GlobalSet\", \"ting.Instance.CatalogEndpoint); builder.Path = \\\"api/v1/catalog/items\\\"; string uri = builder.ToString\", \"(); CatalogRoot? catalog = await _requestProvider.GetAsync<CatalogRoot>(uri); return catalog?.Data; \", \"}\\n```\\n\\nThis method builds the URI that identifies the resource the request will be sent to, and uses\", \" the RequestProvider class to invoke the GET HTTP method on the resource, before returning the resul\", \"ts to the CatalogViewModel. The RequestProvider class contains functionality that submits a request \", \"in the form of a URI that identifies a resource, an HTTP method that indicates the operation to be p\", \"erformed on that resource, and a body that contains any data required to perform the operation. For \", \"information about how the RequestProvider class is injected into the CatalogService class, see Depen\", \"dency Injection.\\n\\nThe following code example shows the GetAsync method in the RequestProvider class:\", \"\\n\\n```\\npublic async Task<TResult> GetAsync<TResult>(string uri, string token = \\\"\\\") { HttpClient httpC\", \"lient = GetOrCreateHttpClient(token); HttpResponseMessage response = await httpClient.GetAsync(uri);\", \" await HandleResponse(response); TResult result = await response.Content.ReadFromJsonAsync<TResult>(\", \"); return result; }\\n```\\n\\nThis method calls the GetOrCreateHttpClient method, which returns an instan\", \"ce of the HttpClient class with the appropriate headers set. It then submits an asynchronous GET req\", \"uest to the resource identified by the URI, with the response being stored in the HttpResponseMessag\", \"e instance. The HandleResponse method is then invoked, which throws an exception if the response doe\", \"sn't include a success HTTP status code. Then the response is read as a string, converted from JSON \", \"to a CatalogRoot object, and returned to the CatalogService.\\n\\nThe GetOrCreateHttpClient method is sh\", \"own in the following code example:\\n\\n```\\nprivate readonly Lazy<HttpClient> _httpClient = new Lazy<Htt\", \"pClient>( () => { var httpClient = new HttpClient(); httpClient.DefaultRequestHeaders.Accept.Add( ne\", \"w MediaTypeWithQualityHeaderValue(\\\"application/json\\\")); return httpClient; }, LazyThreadSafetyMode.E\", \"xecutionAndPublication); private HttpClient GetOrCreateHttpClient(string token = \\\"\\\") { var httpClien\", \"t = _httpClient.Value; if (!string.IsNullOrEmpty(token)) { httpClient.DefaultRequestHeaders.Authoriz\", \"ation = new AuthenticationHeaderValue(\\\"Bearer\\\", token); } else { httpClient.DefaultRequestHeaders.Au\", \"thorization = null ; }\\n```\\n\\n```\\nreturn httpClient; }\\n```\\n\\nThis method uses creates a new instance or\", \" retrieves a cached instance of the HttpClient class, and sets the Accept header of any requests mad\", \"e by the HttpClient instance to application/json, which indicates that it expects the content of any\", \" response to be formatted using JSON. Then, if an access token was passed as an argument to the GetO\", \"rCreateHttpClient method, it's added to the Authorization header of any requests made by the HttpCli\", \"ent instance, prefixed with the string Bearer. For more information about authorization, see Authori\", \"zation.\\n\\n## Tip\\n\\nIt is highly recommended to cache and reuse instances of the HttpClient for better \", \"application performance. Creating a new HttpClient for each operation can lead to issue with socket \", \"exhaustion. For more information, see HttpClient Instancing on the Microsoft Developer Center.\\n\\nWhen\", \" the GetAsync method in the RequestProvider class calls HttpClient.GetAsync, the Items method in the\", \" CatalogController class in the Catalog.API project is invoked, which is shown in the following code\", \" example:\\n\\n```\\n[HttpGet] [Route(\\\"[action]\\\")] public async Task<IActionResult> Items( [FromQuery]int \", \"pageSize = 10, [FromQuery]int pageIndex = 0) { var totalItems = await _catalogContext.CatalogItems .\", \"LongCountAsync(); var itemsOnPage = await _catalogContext.CatalogItems .OrderBy(c => c.Name) .Skip(p\", \"ageSize * pageIndex) .Take(pageSize) .ToListAsync(); itemsOnPage = ComposePicUri(itemsOnPage); var m\", \"odel = new PaginatedItemsViewModel<CatalogItem>( pageIndex, pageSize, totalItems, itemsOnPage); retu\", \"rn Ok(model); }\\n```\\n\\nThis method retrieves the catalog data from the SQL database using EntityFramew\", \"ork, and returns it as a response message that includes a success HTTP status code, and a collection\", \" of JSON formatted CatalogItem instances.\\n\\n## Making a POST request\\n\\nThe BasketService class is used\", \" to manage the data retrieval and update process with the basket microservice. In the RegisterAppSer\", \"vices method in the MauiProgram class, the BasketService class is registered as a type mapping again\", \"st the IBasketService type with the dependency injection container. Then, when an instance of the Ba\", \"sketViewModel class is created, its constructor accepts an\\n\\nBasketViewModel\\n\\nClientApp\\n\\nRequestProvi\", \"der\\n\\nBasket.API\\n\\nBasketController\\n\\nIBasketService type, which the dependency injection container res\", \"olves, returning an instance of the BasketService class. For more information about dependency injec\", \"tion, see Dependency Injection.\\n\\nThe image below shows the interaction of classes that send the bask\", \"et data displayed by the BasketView, to the basket microservice.\\n\\nUpdateBasketAsync\\n\\nWhen an item is\", \" added to the shopping basket, the ReCalculateTotalAsync method in the BasketViewModel class is call\", \"ed. This method updates the total value of items in the basket, and sends the basket data to the bas\", \"ket microservice, as demonstrated in the following code example:\\n\\n```\\nprivate async Task ReCalculate\", \"TotalAsync() { // Omitted for brevity... await _basketService.UpdateBasketAsync( new CustomerBasket \", \"{ BuyerId = userInfo.UserId, Items = BasketItems.ToList() }, authToken); }\\n```\\n\\nThis method calls th\", \"e UpdateBasketAsync method of the BasketService instance that was injected into the BasketViewModel \", \"by the dependency injection container. The following method shows the UpdateBasketAsync method:\\n\\n```\", \"\\npublic async Task<CustomerBasket> UpdateBasketAsync( CustomerBasket customerBasket, string token) {\", \" UriBuilder builder = new UriBuilder(GlobalSetting.Instance.BasketEndpoint); string uri = builder.To\", \"String(); var result = await _requestProvider.PostAsync(uri, customerBasket, token); return result; \", \"}\\n```\\n\\nThis method builds the URI that identifies the resource the request will be sent to, and uses\", \" the RequestProvider class to invoke the POST HTTP method on the resource, before returning the resu\", \"lts to the BasketViewModel. Note that an access token, obtained from IdentityServer during the authe\", \"ntication process, is required to authorize requests to the basket microservice. For more informatio\", \"n about authorization, see Authorization.\\n\\nThe following code example shows one of the PostAsync met\", \"hods in the RequestProvider class:\\n\\n```\\npublic async Task<TResult> PostAsync<TResult>( string uri, T\", \"Result data, string token = \\\"\\\", string header = \\\"\\\") { HttpClient httpClient = GetOrCreateHttpClient(\", \"token); var content = new StringContent(JsonSerializer.Serialize(data)); content.Headers.ContentType\", \" = new MediaTypeHeaderValue(\\\"application/json\\\"); HttpResponseMessage response = await httpClient.Pos\", \"tAsync(uri, content); await HandleResponse(response); TResult result = await response.Content.ReadFr\", \"omJsonAsync<TResult>(); return result; }\\n```\\n\\nThis method calls the GetOrCreateHttpClient method, wh\", \"ich returns an instance of the HttpClient class with the appropriate headers set. It then submits an\", \" asynchronous POST request to the resource identified by the URI, with the serialized basket data be\", \"ing sent in JSON format, and the response being stored in the HttpResponseMessage instance. The Hand\", \"leResponse method is then invoked, which throws an exception if the response doesn't include a succe\", \"ss HTTP status code. Then, the response is read as a string, converted from JSON to a CustomerBasket\", \" object, and returned to the BasketService. For more information about the GetOrCreateHttpClient met\", \"hod, see Making a GET request.\\n\\nWhen the PostAsync method in the RequestProvider class calls HttpCli\", \"ent.PostAsync, the Post method in the BasketController class in the Basket.API project is invoked, w\", \"hich is shown in the following code example:\\n\\n```\\n[HttpPost] public async Task<IActionResult> Post([\", \"FromBody] CustomerBasket value) { var basket = await _repository.UpdateBasketAsync(value); return Ok\", \"(basket); }\\n```\\n\\nCheckoutViewModel\\n\\nClientApp\\n\\nRequestProvider\\n\\nBasket.API\\n\\nBasketController\\n\\nThis m\", \"ethod uses an instance of the RedisBasketRepository class to persist the basket data to the Redis ca\", \"che, and returns it as a response message that includes a success HTTP status code, and a JSON forma\", \"tted CustomerBasket instance.\\n\\n## Making a DELETE request\\n\\nThe image below shows the interactions of\", \" classes that delete basket data from the basket microservice, for the CheckoutView.\\n\\nWhen the check\", \"out process is invoked, the CheckoutAsync method in the CheckoutViewModel class is called. This meth\", \"od creates a new order, before clearing the shopping basket, as demonstrated in the following code e\", \"xample:\\n\\n```\\nprivate async Task CheckoutAsync() { // Omitted for brevity... await _basketService.Cle\", \"arBasketAsync( _shippingAddress.Id.ToString(), authToken); }\\n```\\n\\nThis method calls the ClearBasketA\", \"sync method of the BasketService instance that was injected into the CheckoutViewModel by the depend\", \"ency injection container. The following method shows the ClearBasketAsync method:\\n\\n```\\npublic async \", \"Task ClearBasketAsync(string guidUser, string token) { UriBuilder builder = new (GlobalSetting.Insta\", \"nce.BasketEndpoint); builder.Path = guidUser; string uri = builder.ToString(); await _requestProvide\", \"r.DeleteAsync(uri, token); }\\n```\\n\\nThis method builds the URI that identifies the resource that the r\", \"equest will be sent to, and uses the RequestProvider class to invoke the DELETE HTTP method on the r\", \"esource. Note that an access token, obtained from IdentityServer during the authentication process, \", \"is required to authorize requests to the basket microservice. For more information about authorizati\", \"on, see Authorization.\\n\\nThe following code example shows the DeleteAsync method in the RequestProvid\", \"er class:\\n\\n```\\npublic async Task DeleteAsync(string uri, string token = \\\"\\\") { HttpClient httpClient \", \"= GetOrCreateHttpClient(token); await httpClient.DeleteAsync(uri); }\\n```\\n\\nThis method calls the GetO\", \"rCreateHttpClient method, which returns an instance of the HttpClient class with the appropriate hea\", \"ders set. It then submits an asynchronous DELETE request to the resource identified by the URI. For \", \"more information about the GetOrCreateHttpClient method, see Making a GET request.\\n\\nWhen the DeleteA\", \"sync method in the RequestProvider class calls HttpClient.DeleteAsync, the Delete method in the Bask\", \"etController class in the Basket.API project is invoked, which is shown in the following code exampl\", \"e:\\n\\n```\\n[HttpDelete(\\\"{id}\\\")] public void Delete(string id) => _repository.DeleteBasketAsync(id);\\n```\", \"\\n\\nThis method uses an instance of the RedisBasketRepository class to delete the basket data from the\", \" Redis cache.\\n\\n## Caching data\\n\\nThe performance of an app can be improved by caching frequently acce\", \"ssed data to fast storage that's located close to the app. If the fast storage is located closer to \", \"the app than the original source, then caching can significantly improve response times when retriev\", \"ing data.\\n\\nThe most common form of caching is read-through caching, where an app retrieves data by r\", \"eferencing the cache. If the data isn't in the cache, it's retrieved from the data store and added t\", \"o the cache. Apps can implement read-through caching with the cache-aside pattern. This pattern dete\", \"rmines whether the item is currently in the cache. If the item isn't in the cache, it's read from th\", \"e data store and added to the cache. For more information, see the Cache-Aside pattern on Microsoft \", \"Docs.\\n\\n## Tip\\n\\nCache data that's read frequently and changes infrequently.\\n\\nThis data can be added t\", \"o the cache on demand the first time it is retrieved by an app. This means that the app needs to fet\", \"ch the data only once from the data store, and that subsequent access can be satisfied by using the \", \"cache.\\n\\nDistributed applications, such as the eShop reference application, should provide either or \", \"both of the following caches:\\n\\n- A shared cache, which can be accessed by multiple processes or mach\", \"ines.\\n- A private cache, where data is held locally on the device running the app.\\n\\nThe eShop multip\", \"latform app uses a private cache, where data is held locally on the device that's running an instanc\", \"e of the app.\\n\\n| Tip                                                                            |\\n|-\", \"-------------------------------------------------------------------------------|\\n| Think of the cach\", \"e as a transient data store that could disappear at any time. |\\n\\nEnsure that data is maintained in t\", \"he original data store as well as the cache. The chances of losing data are then minimized if the ca\", \"che becomes unavailable.\\n\\n## Managing data expiration\\n\\nIt's impractical to expect that cached data w\", \"ill always be consistent with the original data. Data in the original data store might change after \", \"it's been cached, causing the cached data to become stale. Therefore, apps should implement a strate\", \"gy that helps to ensure that the data in the cache is as upto-date as possible, but can also detect \", \"and handle situations that arise when the data in the cache has become stale. Most caching mechanism\", \"s enable the cache to be configured to expire data, and hence reduce the period for which data might\", \" be out of date.\\n\\n| Tip                                                     |\\n|---------------------\", \"------------------------------------|\\n| Set a default expiration time when configuring a cache. |\\n\\nM\", \"any caches implement expiration, which invalidates data and removes it from the cache if it's not ac\", \"cessed for a specified period. However, care must be taken when choosing the expiration period. If i\", \"t's made too short, data will expire too quickly and the benefits of caching will be reduced. If it'\", \"s made too long, the data risks becoming stale. Therefore, the expiration time should match the patt\", \"ern of access for apps that use the data.\\n\\nWhen cached data expires, it should be removed from the c\", \"ache, and the app must retrieve the data from the original data store and place it back into the cac\", \"he.\\n\\nIt's also possible that a cache might fill up if data is allowed to remain for too long a perio\", \"d. Therefore, requests to add new items to the cache might be required to remove some items in a pro\", \"cess known as eviction . Caching services typically evict data on a least-recently-used basis. Howev\", \"er, there are other eviction policies, including most-recently-used, and first-in-first-out. For mor\", \"e information, see Caching Guidance on Microsoft Docs.\\n\\n## Caching images\\n\\nThe eShop multi-platform \", \"app consumes remote product images that benefit from being cached. These images are displayed by the\", \" Image control. The .NET MAUI Image control supports caching of\\n\\ndownloaded images which has caching\", \" enabled by default, and will store the image locally for 24 hours. In addition, the expiration time\", \" can be configured with the CacheValidity property. For more information, see Downloaded Image Cachi\", \"ng on the Microsoft Developer Center.\\n\\n## Increasing resilience\\n\\nAll apps that communicate with remo\", \"te services and resources must be sensitive to transient faults. Transient faults include the moment\", \"ary loss of network connectivity to services, the temporary unavailability of a service, or timeouts\", \" that arise when a service is busy. These faults are often selfcorrecting, and if the action is repe\", \"ated after a suitable delay it's likely to succeed.\\n\\nTransient faults can have a huge impact on the \", \"perceived quality of an app, even if it has been thoroughly tested under all foreseeable circumstanc\", \"es. To ensure that an app that communicates with remote services operates reliably, it must be able \", \"to do all of the following:\\n\\n- Detect faults when they occur, and determine if the faults are likely\", \" to be transient.\\n- Retry the operation if it determines that the fault is likely to be transient an\", \"d keep track of the number of times the operation was retried.\\n- Use an appropriate retry strategy, \", \"which specifies the number of retries, the delay between each attempt, and the actions to take after\", \" a failed attempt.\\n\\nThis transient fault handling can be achieved by wrapping all attempts to access\", \" a remote service in code that implements the retry pattern.\\n\\n## Retry pattern\\n\\nIf an app detects a \", \"failure when it tries to send a request to a remote service, it can handle the failure in any of the\", \" following ways:\\n\\n- Retrying the operation. The app could retry the failing request immediately.\\n- R\", \"etrying the operation after a delay. The app should wait for a suitable amount of time before retryi\", \"ng the request.\\n- Cancelling the operation. The application should cancel the operation and report a\", \"n exception.\\n\\nThe retry strategy should be tuned to match the business requirements of the app. For \", \"example, it's important to optimize the retry count and retry interval to the operation being attemp\", \"ted. If the operation is part of a user interaction, the retry interval should be short and only a f\", \"ew retries attempted to avoid making users wait for a response. If the operation is part of a long r\", \"unning workflow, where cancelling or restarting the workflow is expensive or timeconsuming, it's app\", \"ropriate to wait longer between attempts and to retry more times.\\n\\n## Note\\n\\nAn aggressive retry stra\", \"tegy with minimal delay between attempts, and a large number of retries, could degrade a remote serv\", \"ice that's running close to or at capacity. In addition, such a retry strategy could also affect the\", \" responsiveness of the app if it 's continually trying to perform a failing operation.\\n\\nIf a request\", \" still fails after a number of retries, it's better for the app to prevent further requests going to\", \" the same resource and to report a failure. Then, after a set period, the app can make one or more r\", \"equests to the resource to see if they're su ccessful. For more information, see Circuit breaker pat\", \"tern.\\n\\n## Tip\\n\\nNever implement an endless retry mechanism. Instead, prefer an exponential backoff.\\n\\n\", \"Use a finite number of retries, or implement the Circuit Breaker pattern to allow a service to recov\", \"er.\\n\\nThe eShop reference application does implement the retry pattern.\\n\\nFor more information about t\", \"he retry pattern, see the Retry pattern on Microsoft Docs.\\n\\n## Circuit breaker pattern\\n\\nIn some situ\", \"ations, faults can occur due to anticipated events that take longer to fix. These faults can range f\", \"rom a partial loss of connectivity to the complete failure of a service. In these situations, it's p\", \"ointless for an app to retry an operation th at's unlikely to succeed, and instead should accept tha\", \"t the operation has failed and handle this failure accordingly.\\n\\nThe circuit breaker pattern can pre\", \"vent an app from repeatedly trying to execute an operation that's likely to fail, while also enablin\", \"g the app to detect whether the fault has been resolved.\\n\\n## Note\\n\\nThe purpose of the circuit breake\", \"r pattern is different from the retry pattern. The retry pattern enables an app to retry an operatio\", \"n in the expectation that it'll succeed. The circuit breaker pattern prevents an app from performing\", \" an operation that's li kely to fail.\\n\\nA circuit breaker acts as a proxy for operations that might f\", \"ail. The proxy should monitor the number of recent failures that have occurred, and use this informa\", \"tion to decide whether to allow the operation to proceed, or to return an exception immediately.\\n\\nTh\", \"e eShop multi-platform app does not currently implement the circuit breaker pattern. However, the eS\", \"hop does.\\n\\n## Tip Combine the retry and circuit breaker patterns.\\n\\nAn app can combine the retry and \", \"circuit breaker patterns by using the retry pattern to invoke an operation through a circuit breaker\", \". However, the retry logic should be sensitive to any exceptions returned by the circuit breaker and\", \" abandon retry attempts if the circuit breaker indicates that a fault is not transient.\\n\\nFor more in\", \"formation about the circuit breaker pattern, see the Circuit Breaker pattern on Microsoft Docs.\\n\\n## \", \"Summary\\n\\nMany modern web-based solutions make use of web services, hosted by web servers, to provide\", \" functionality for remote client applications. The operations that a web service exposes constitute \", \"a web API, and client apps should be able to utilize the web API without knowing how the data or ope\", \"rations that the API exposes are implemented.\\n\\nThe performance of an app can be improved by caching \", \"frequently accessed data to fast storage that's located close to the app. Apps can implement read -t\", \"hrough caching with the cache-aside pattern. This pattern determines whether the item is currently i\", \"n th e cache. If the item isn't in the cache, it's read from the data store and added to the cache.\\n\", \"\\nWhen communicating with web APIs, apps must be sensitive to transient faults. Transient faults incl\", \"ude the momentary loss of network connectivity to services, the temporary unavailability of a servic\", \"e, or timeouts that arise when a service is busy. These faults are often self-correcting, and if the\", \" action is repeated after a suitable delay, then it's likely to succeed. Therefore, apps should wrap\", \" all attempts to access a web API in code that implements a transient fault handling mechanism.\\n\\n## \", \"Authentication and authorization\\n\\nAuthentication is the process of obtaining identification credenti\", \"als such as name and password from a user and validating those credentials against an authority. The\", \" entity that submitted the credentials is considered an authenticated identity if the credentials ar\", \"e valid. Once an identity has been established, an authorization process determines whether that ide\", \"ntity has access to a given resource.\\n\\nThere are many approaches to integrating authentication and a\", \"uthorization into a .NET MAUI app that communicates with an ASP.NET web application, including using\", \" ASP.NET Core Identity, external authentication providers such as Microsoft, Google, Facebook, or Tw\", \"itter, and authentication middleware. The eShop multi-platform app performs authentication and autho\", \"rization with a containerized identity microservice that uses IdentityServer. The app requests secur\", \"ity tokens from IdentityServer to authenticate a user or access a resource. For IdentityServer to is\", \"sue tokens on behalf of a user, the user must sign in to IdentityServer. However, IdentityServer doe\", \"sn't provide a user interface or database for authentication. Therefore, in the eShop reference appl\", \"ication, ASP.NET Core Identity is used for this purpose.\\n\\n## Authentication\\n\\nAuthentication is requi\", \"red when an application needs to know the current user's identity. ASP.NET Core's primary mechanism \", \"for identifying users is the ASP.NET Core Identity membership system, which stores user information \", \"in a data store configured by the developer. Typically, this data store will be an EntityFramework s\", \"tore, though custom stores or third-party packages can be used to store identity information in Azur\", \"e storage, DocumentDB, or other locations.\\n\\nFor authentication scenarios that use a local user datas\", \"tore and persist identity information between requests via cookies (as is typical in ASP.NET web app\", \"lications), ASP.NET Core Identity is a suitable solution. However, cookies are not always a natural \", \"means of persisting and transmitting data. For example, an ASP.NET Core web application that exposes\", \" RESTful endpoints that are accessed from an app will typically need to use bearer token authenticat\", \"ion since cookies can't be used in this scenario. However, bearer tokens can easily be retrieved and\", \" included in the authorization header of web requests made from the app.\\n\\n11\\n\\nMobile App\\n\\nSign-in\\n\\nS\", \"ecurity token\\n\\nIdentity Microservice (STS+Users)\\n\\nWeb API\\n\\nContainer\\n\\n## Issuing bearer tokens using\", \" IdentityServer\\n\\nIdentityServer is an open-source OpenID Connect and OAuth 2.0 framework for ASP.NET\", \" Core, which can be used for many authentication and authorization scenarios, including issuing secu\", \"rity tokens for local ASP.NET Core Identity users.\\n\\n## Note\\n\\nOpenID Connect and OAuth 2.0 are very s\", \"imilar, while having different responsibilities.\\n\\nOpenID Connect is an authentication layer on top o\", \"f the OAuth 2.0 protocol. OAuth 2 is a protocol that allows applications to request access tokens fr\", \"om a security token service and use them to communicate with APIs. This delegation reduces complexit\", \"y in both client applications and APIs since authentication and authorization can be centralized.\\n\\nO\", \"penID Connect and OAuth 2.0 combine the two fundamental security concerns of authentication and API \", \"access, and IdentityServer is an implementation of these protocols.\\n\\nIn applications that use direct\", \" client-to-microservice communication, such as the eShop reference application, a dedicated authenti\", \"cation microservice acting as a Security Token Service (STS) can be used to authenticate users, as s\", \"hown in the following diagram. For more information about direct client-to-microservice communicatio\", \"n, see Microservices.\\n\\nThe eShop multi-platform app communicates with the identity microservice, whi\", \"ch uses IdentityServer to perform authentication, and access control for APIs. Therefore, the multi-\", \"platform app requests tokens from IdentityServer, either for authenticating a user or for accessing \", \"a resource:\\n\\n- Authenticating users with IdentityServer is achieved by the multi-platform app reques\", \"ting an identity token, representing an authentication process's outcome. At a minimum, it contains \", \"an identifier for the user and information about how and when the user is authenticated. It can also\", \" include additional identity data.\\n- Accessing a resource with IdentityServer is achieved by the mul\", \"ti-platform app requesting an access token, which allows access to an API resource. Clients request \", \"access tokens and forward them to the API. Access tokens contain information about the client and th\", \"e user, if present. APIs then use that information to authorize access to their data.\\n\\n## Note\\n\\nA cl\", \"ient must be registered with IdentityServer before it can successfully request tokens. For more info\", \"rmation on adding clients, see Defining Clients.\\n\\nSQL Server database\\n\\nDocker Host\\n\\n## Adding Identi\", \"tyServer to a web application\\n\\nIn order for an ASP.NET Core web application to use IdentityServer, i\", \"t must be added to the web application's Visual Studio solution. For more information, see Setup and\", \" Overview in the IdentityServer documentation. Once IdentityServer is included in the web applicatio\", \"n's Visual Studio solution, it must be added to its HTTP request processing pipeline to serve reques\", \"ts to OpenID Connect and OAuth 2.0 endpoints. This is configured in the Identity.API project's Progr\", \"am.cs, as demonstrated in the following code example:\\n\\n```\\n... app.UseIdentityServer();\\n```\\n\\nOrder m\", \"atters in the web application's HTTP request processing pipeline. Therefore, IdentityServer must be \", \"added to the pipeline before the UI framework that implements the login screen.\\n\\n## Configuring Iden\", \"tityServer\\n\\nIdentityServer should be configured in the ConfigureServices method in the web applicati\", \"on's Startup class by calling the services.AddIdentityServer method, as demonstrated in the followin\", \"g code example from the eShop reference application:\\n\\n```\\npublic void ConfigureServices(IServiceColl\", \"ection services) { services .AddIdentityServer(x => x.IssuerUri = \\\"null\\\") .AddSigningCredential(Cert\", \"ificate.Get()) .AddAspNetIdentity<ApplicationUser>() .AddConfigurationStore(builder => builder.UseSq\", \"lServer(connectionString, options => options.MigrationsAssembly(migrationsAssembly))) .AddOperationa\", \"lStore(builder => builder.UseSqlServer(connectionString, options => options.MigrationsAssembly(migra\", \"tionsAssembly))) .Services.AddTransient<IProfileService, ProfileService>(); }\\n```\\n\\nAfter calling the\", \" services.AddIdentityServer method, additional fluent APIs are called to configure the following:\\n\\n-\", \" Credentials used for signing.\\n- API and identity resources that users might request access to.\\n- Cl\", \"ients that will be connecting to request tokens.\\n- ASP.NET Core Identity.\\n\\n## Tip\\n\\nDynamically load \", \"the IdentityServer configuration. IdentityServer's APIs allow for configuring IdentityServer from an\", \" in-memory list of configuration objects. In the eShop reference application, these in-memory collec\", \"tions are hard-coded into the application. However, in production scenarios they can be loaded dynam\", \"ically from a configuration file or from a database.\\n\\nFor information about configuring IdentityServ\", \"er to use ASP.NET Core Identity, see Using ASP.NET Core Identity in the IdentityServer documentation\", \".\\n\\n## Configuring API resources\\n\\nWhen configuring API resources, the AddInMemoryApiResources method \", \"expects an IEnumerable&lt;ApiResource&gt; collection. The following code example shows the GetApis m\", \"ethod that provides this collection in the eShop reference application:\\n\\n```\\npublic static IEnumerab\", \"le<ApiResource> GetApis() { return new List<ApiResource> { new ApiScope(\\\"orders\\\", \\\"Orders Service\\\"),\", \" new ApiScope(\\\"basket\\\", \\\"Basket Service\\\"), new ApiScope(\\\"webhooks\\\", \\\"Webhooks registration Service\\\")\", \", }; }\\n```\\n\\nThis method specifies that IdentityServer should protect the orders and basket APIs. The\", \"refore, IdentityServer-managed access tokens will be required when making calls to these APIs. For m\", \"ore information about the ApiResource type, see API Resource in the IdentityServer documentation.\\n\\n#\", \"# Configuring identity resources\\n\\nWhen configuring identity resources, the AddInMemoryIdentityResour\", \"ces method expects an IEnumerable&lt;IdentityResource&gt; collection. Identity resources are data su\", \"ch as user ID, name, or email address. Each identity resource has a unique name, and arbitrary claim\", \" types can be assigned to it, which will be included in the identity token for the user. The followi\", \"ng code example shows the GetResources method that provides this collection in the eShop reference a\", \"pplication:\\n\\n```\\npublic static IEnumerable<IdentityResource> GetResources() { return new List<Identi\", \"tyResource> { new IdentityResources.OpenId(), new IdentityResources.Profile() }; }\\n```\\n\\nThe OpenID C\", \"onnect specification specifies some standard identity resources. The minimum requirement is that sup\", \"port is provided for emitting a unique ID for users. This is achieved by exposing the IdentityResour\", \"ces.OpenId identity resource.\\n\\n## Note\\n\\nThe IdentityResources class supports all of the scopes defin\", \"ed in the OpenID Connect specification (openid, email, profile, telephone, and address).\\n\\nIdentitySe\", \"rver also supports defining custom identity resources. For more information, see Defining custom ide\", \"ntity resources in the IdentityServer documentation. For more information about the IdentityResource\", \" type, see Identity Resource in the IdentityServer documentation.\\n\\n## Configuring clients\\n\\nClients a\", \"re applications that can request tokens from IdentityServer. Typically, the following settings must \", \"be defined for each client as a minimum:\\n\\n- A unique client ID.\\n- The allowed interactions with the \", \"token service (known as the grant type).\\n- The location where identity and access tokens are sent to\", \" (known as a redirect URI).\\n- A list of resources that the client is allowed access to (known as sco\", \"pes).\\n\\nWhen configuring clients, the AddInMemoryClients method expects an IEnumerable&lt;Client&gt; \", \"collection. The following code example shows the configuration for the eShop multi-platform app in t\", \"he GetClients method that provides this collection in the eShop reference application:\\n\\n```\\npublic s\", \"tatic IEnumerable<Client> GetClients(Dictionary<string,string> clientsUrl) { return new List<Client>\", \" { // Omitted for brevity new Client { ClientId = \\\"maui\\\", ClientName = \\\"eShop .NET MAUI OpenId Clien\", \"t\\\", AllowedGrantTypes = GrantTypes.Hybrid, ClientSecrets = { new Secret(\\\"secret\\\".Sha256()) }, Redire\", \"ctUris = { clientsUrl[\\\"maui\\\"] }, RequireConsent = false, RequirePkce = true, PostLogoutRedirectUris \", \"= { $\\\"{clientsUrl[\\\"maui\\\"]}/Account/Redirecting\\\" }, AllowedCorsOrigins = { \\\"http://eshopmaui\\\" }, Allo\", \"wedScopes = new List<string> { IdentityServerConstants.StandardScopes.OpenId, IdentityServerConstant\", \"s.StandardScopes.Profile, IdentityServerConstants.StandardScopes.OfflineAccess, \\\"orders\\\", \\\"basket\\\" }\", \", AllowOfflineAccess = true, AllowAccessTokensViaBrowser = true, AccessTokenLifetime = 60 * 60 * 2, \", \"// 2 hours IdentityTokenLifetime = 60 * 60 * 2 // 2 hours } }; }\\n```\\n\\nThis configuration specifies d\", \"ata for the following properties:\\n\\n| Property   | Description                                       \", \"                         |\\n|------------|-----------------------------------------------------------\", \"-----------------|\\n| ClientId   | A unique ID for the client.                                       \", \"         |\\n| ClientName | The client display name, which is used for logging and the consent screen.\", \" |\\n\\n| Property                         | Description                                                \", \"                                                                                    |\\n|-------------\", \"---------------------|------------------------------------------------------------------------------\", \"------------------------------------------------------------------|\\n| AllowedGrantTypes             \", \"   | Specifies how a client wants to interact with IdentityServer. For more information see Configur\", \"ing the authentication flow.                    |\\n| ClientSecrets                    | Specifies the\", \" client secret credentials that are used when requesting tokens from the token endpoint.            \", \"                              |\\n| RedirectUris                     | Specifies the allowed URIs to w\", \"hich to return tokens or authorization codes.                                                       \", \"            |\\n| RequireConsent                   | Specifies whether a consent screen is required.  \", \"                                                                                              |\\n| Re\", \"quirePkce                      | Specifies whether clients using an authorization code must send a p\", \"roof key.                                                                   |\\n| PostLogoutRedirectUr\", \"is           | Specifies the allowed URIs to redirect to after logout.                              \", \"                                                          |\\n| AllowedCorsOrigins               | Spe\", \"cifies the origin of the client so that IdentityServer can allow cross-origin calls from the origin.\", \"                                        |\\n| AllowedScopes                    | Specifies the resourc\", \"es the client has access to. By default, a client has no access to any resources.                   \", \"                      |\\n| AllowOfflineAccess               | Specifies whether the client can reques\", \"t refresh tokens.                                                                                   \", \"    |\\n| AllowAccessTokensViaBrowser      | Specifies whether the client can receive access tokens fr\", \"om a browser window.                                                                  |\\n| AlwaysIncl\", \"udeUserClaimsInIdToken | Specifies that the user claims will always be added to the id token. By def\", \"ault, these would have to be retrieved using the userinfo endpoint. |\\n| AccessTokenLifetime         \", \"     | Specifies the lifetime of the access token in seconds.                                       \", \"                                                  |\\n| IdentityTokenLifetime            | Specifies t\", \"he lifetime of the identity token in seconds.                                                       \", \"                                |\\n\\n## Configuring the authentication flow\\n\\nThe authentication flow b\", \"etween a client and IdentityServer can be configured by specifying the grant types in the Client.All\", \"owedGrantTypes property. The OpenID Connect and OAuth 2.0 specifications define several authenticati\", \"on flows, including:\\n\\n| Authentication Flow   | Description                                         \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                 |\\n|\", \"-----------------------|----------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"--------------------------------------------------------------------------|\\n| Implicit              \", \"| This flow is optimized for browser-based applications and should be used either for user authentic\", \"ation-only, or authentication and access token requests. All tokens are transmitted via the browser,\", \" and therefore advanced features like refresh tokens are not permitted.                             \", \"                                                   |\\n| Authorization code    | This flow provides th\", \"e ability to retrieve tokens on a back channel, as opposed to the browser front channel, while also \", \"supporting client authentication.                                                                   \", \"                                                                                                    \", \"                            |\\n| Hybrid                | This flow is a combination of the implicit a\", \"nd authorization code grant types. The identity token is transmitted via the browser channel and con\", \"tains the signed protocol response and other artifacts such as the authorization code. After success\", \"fully validating the response, the back channel should be used to retrieve the access and refresh to\", \"ken. |\\n\\n## Tip\\n\\nConsider using the hybrid authentication flow. The hybrid authentication flow mitiga\", \"tes a number of attacks that apply to the browser channel, and is the recommended flow for native ap\", \"plications that want to retrieve access tokens (and possibly refresh tokens).\\n\\nFor more information \", \"about authentication flows, see Grant Types in the IdentityServer documentation.\\n\\n## Performing auth\", \"entication\\n\\nFor IdentityServer to issue tokens on behalf of a user, the user must sign in to Identit\", \"yServer. However, IdentityServer doesn't provide a user interface or database for authentication. Th\", \"erefore, in the eShop reference application, ASP.NET Core Identity is used for this purpose.\\n\\nThe eS\", \"hop multi-platform app authenticates with IdentityServer with the hybrid authentication flow, which \", \"is illustrated in the diagram below.\\n\\nhttp://&lt;baseendpoint&gt;:5105/connect/authorize http://sbas\", \"eendpoint:5105/connect/endsession endpoint:5105/connect/endsession w Identity Microservice (STs-User\", \"s)\\n\\nauthentication response\\n\\n(authorization code and identity token)\\n\\npost logout redirect URI\\n\\nhttp\", \"://&lt;baseendpoint&gt;:5105/connect/token\\n\\n- - --\\n\\nSQL Server\\n\\nWeb API\\n\\nIdentity Microservice (STS+\", \"Users)\\n\\nWeb API\\n\\n\\u2022\\n\\nSQL Server database\\n\\ndatabase\\n\\nContainer\\n\\nA sign in request is made to &lt;base \", \"endpoint&gt;:5105/connect/authorize. Following successful authentication, IdentityServer returns an \", \"authentication response containing an authorization code and an identity token. The authorization co\", \"de is sent to &lt;base endpoint&gt;:5105/connect/token, which responds with access, identity, and re\", \"fresh tokens.\\n\\nThe eShop multi-platform app signs out of IdentityServer by sending a request to &lt;\", \"base endpoint&gt;:5105/connect/endsession with additional parameters. After sign-out, IdentityServer\", \" responds by sending a post-logout redirecting URI back to the multi-platform app. The diagram below\", \" illustrates this process.\\n\\nIn the eShop multi-platform app, communication with IdentityServer is pe\", \"rformed by the IdentityService class, which implements the IIdentityService interface. This interfac\", \"e specifies that the implementing class must provide SignInAsync, SignOutAsync, GetUserInfoAsync and\", \" GetAuthTokenAsync methods.\\n\\n## Signing-in\\n\\nWhen the user taps the LOGIN button on the LoginView, th\", \"e SignInCommand in the LoginViewModel class is executed, which in turn executes the SignInAsync meth\", \"od. The following code example shows this method:\\n\\n```\\n[RelayCommand] private async Task SignInAsync\", \"() { await IsBusyFor( async () => { var loginSuccess = await _appEnvironmentService.IdentityService.\", \"SignInAsync(); if (loginSuccess) { await NavigationService.NavigateToAsync(\\\"//Main/Catalog\\\"); }\\n```\\n\", \"\\nMobile App\\n\\nMobile App\\n\\nDocker Host 1\\n\\n-\\n\\n-\\n\\n-\\n\\nDocker Host 1\\n\\n```\\n}); }\\n```\\n\\nThis method invokes t\", \"he SignInAsync method in the IdentityService class, as shown in the following code example:\\n\\n```\\npub\", \"lic async Task<bool> SignInAsync() { var response = await GetClient().LoginAsync( new LoginRequest()\", \").ConfigureAwait( false ); if (response.IsError) { return false ; } await _settingsService .SetUserT\", \"okenAsync( new UserToken { AccessToken = response.AccessToken, IdToken = response.IdentityToken, Ref\", \"reshToken = response.RefreshToken, ExpiresAt = response.AccessTokenExpiration }) .ConfigureAwait( fa\", \"lse ); return !response.IsError; }\\n```\\n\\nThe IdentityService makes use of the OidcClient provided wit\", \"h the IdentityModel.OidcClient NuGet package. This client displays the authentication web view to th\", \"e user in the application and captures the authentication result. The client connects to the URI for\", \" IdentityServer's authorization endpoint with the required parameters. The authorization endpoint is\", \" at /connect/authorize on port 5105 of the base endpoint exposed as a user setting. For more informa\", \"tion about user settings, see Configuration Management.\\n\\n## Note\\n\\nThe attack surface of the eShop mu\", \"lti-platform app is reduced by implementing the Proof Key for Code Exchange (PKCE) extension to OAut\", \"h. PKCE protects the authorization code from being used if it's intercepted. This is achieved by the\", \" client generating a s ecret verifier, a hash of which is passed in the authorization request, and w\", \"hich is presented unhashed when redeeming the authorization code. For more information about PKCE, s\", \"ee Proof Key for Code Exchange by OAuth Public Clients on the Internet Engineering Task Force web si\", \"te.\\n\\nLogin\\n\\nUsername\\n\\nUsername\\n\\nPassword\\n\\nPassword\\n\\nRemember me\\n\\n- [ ] The default users are alice/b\", \"ob, password:\\n\\nPass123$\\n\\nLogin\\n\\nIf the token endpoint receives valid authentication information, aut\", \"horization code, and PKCE secret verifier, it responds with an access token, identity token, and ref\", \"resh token. The access token (which allows access to API resources) and identity token are stored as\", \" application settings, and page navigation is performed. Therefore, the overall effect in the eShop \", \"multi-platform app is this: provided that users are able to successfully authenticate with IdentityS\", \"erver, they are navigated to the //Main/Catalog route, which is a TabbedPage that displays the Catal\", \"ogView as its selected tab.\\n\\nFor information about page navigation, see Navigation. For information \", \"about how WebView navigation causes a view model method to be executed, see Invoking navigation usin\", \"g behaviors. For information about application settings, see Configuration management.\\n\\n## Note\\n\\nThe\", \" eShop also allows a mock sign in when the app is configured to use mock services in the SettingsVie\", \"w. In this mode, the app doesn't communicate with IdentityServer, instead allowing the user to sign \", \"in using any credentials.\\n\\n## Signing-out\\n\\nWhen the user taps the LOG OUT button in the ProfileView,\", \" the LogoutCommand in the ProfileViewModel class is executed, which executes the LogoutAsync method.\", \" This method performs page navigation to the LoginView page, passing a Logout query parameter set to\", \" true.\\n\\nThat parameter is evaluated in the ApplyQueryAttributes method. If the Logout parameter is p\", \"resent with a true value, the PerformLogoutAsync method of the LoginViewModel class is executed, whi\", \"ch is shown in the following code example:\\n\\n```\\nprivate async Task PerformLogoutAsync() { await _app\", \"EnvironmentService.IdentityService.SignOutAsync(); _settingsService.UseFakeLocation = false ; UserNa\", \"me.Value = string.Empty; Password.Value = string.Empty; }\\n```\\n\\nThis method invokes the SignOutAsync \", \"method in the IdentityService class, which invokes the OidcClient to end the user's session and clea\", \"rs any saved user tokens. For more information about application settings, see Configuration managem\", \"ent. The following code example shows the SignOutAsync method:\\n\\n```\\npublic async Task<bool> SignOutA\", \"sync() { var response = await GetClient().LogoutAsync( new LogoutRequest()).ConfigureAwait( false );\", \" if (response.IsError) { return false ; } await _settingsService.SetUserTokenAsync( default ); retur\", \"n !response.IsError; }\\n```\\n\\nThis method uses the OidcClient to call the URI to IdentityServer's end \", \"session endpoint with the required parameters. The end session endpoint is at /connect/endsession on\", \" port 5105 of the base endpoint exposed as a user setting. Once the user has successfully signed out\", \", LoginView is presented to the user, and any saved user information will be cleared.\\n\\nFor informati\", \"on about page navigation, see Navigation. For information about how WebView navigation causes a view\", \" model method to be executed, see Invoking navigation using behaviors. For information about applica\", \"tion settings, see Configuration management.\\n\\n## Note\\n\\nThe eShop also allows a mock sign-out when th\", \"e app is configured to use mock services in the SettingsView. In this mode, the app doesn't communic\", \"ate with IdentityServer, and instead clears any stored tokens from application settings.\\n\\n## Authori\", \"zation\\n\\nAfter authentication, ASP.NET Core web APIs often need to authorize access, which allows a s\", \"ervice to make APIs available to some authenticated users but not to all.\\n\\nRestricting access to an \", \"ASP.NET Core route can be achieved by applying an Authorize attribute to a controller or action, whi\", \"ch limits access to the controller or action to authenticated users, as shown in the following code \", \"example:\\n\\n```\\n[Authorize] public sealed class BasketController : Controller { // Omitted for brevity\", \" }\\n```\\n\\nIf an unauthorized user attempts to access a controller or action marked with the Authorize \", \"attribute, the API framework returns a 401 (unauthorized) HTTP status code.\\n\\n## Note\\n\\nParameters can\", \" be specified on the Authorize attribute to restrict an API to specific users. For more information,\", \" see ASP.NET Core Docs: Authorization.\\n\\nIdentityServer can be integrated into the authorization work\", \"flow so that the access tokens provide control authorization. This approach is shown in the diagram \", \"below.\\n\\n4\\n\\nMobile App\\n\\n-\\n\\n-\\n\\nIdentity Microservice (STS+Users)\\n\\nWeb API\\n\\nContainer\\n\\nSQL Server datab\", \"ase\\n\\nThe eShop multi-platform app communicates with the identity microservice and requests an access\", \" token as part of the authentication process. The access token is then forwarded to the APIs exposed\", \" by the ordering and basket microservices as part of the access requests. Access tokens contain info\", \"rmation about the client and the user. APIs then use that information to authorize access to their d\", \"ata. For information about how to configure IdentityServer to protect APIs, see Configuring API reso\", \"urces.\\n\\n## Configuring IdentityServer to perform authorization\\n\\nTo perform authorization with Identi\", \"tyServer, its authorization middleware must be added to the web application's HTTP request pipeline.\", \" The middleware is added in the AddDefaultAuthentication extension method, which is invoked from the\", \" AddApplicationServices method in the Program class and is demonstrated in the following code exampl\", \"e from the eShop reference application:\\n\\n```\\npublic static IServiceCollection AddDefaultAuthenticati\", \"on( this IHostApplicationBuilder builder) { var services = builder.Services; var configuration = bui\", \"lder.Configuration; var identitySection = configuration.GetSection(\\\"Identity\\\"); if (!identitySection\", \".Exists()) { // No identity section, so no authentication return services; } // prevent from mapping\", \" \\\"sub\\\" claim to nameidentifier. JsonWebTokenHandler.DefaultInboundClaimTypeMap.Remove(\\\"sub\\\"); servic\", \"es.AddAuthentication().AddJwtBearer(options => {\\n```\\n\\n-\\n\\nSign-in\\n\\nSecurity token\\n\\n-\\n\\nDocker Host\\n\\n``\", \"`\\nvar identityUrl = identitySection.GetRequiredValue(\\\"Url\\\"); var audience = identitySection.GetRequi\", \"redValue(\\\"Audience\\\"); options.Authority = identityUrl; options.RequireHttpsMetadata = false ; option\", \"s.Audience = audience; options.TokenValidationParameters.ValidIssuers = [identityUrl]; options.Token\", \"ValidationParameters.ValidateAudience = false ; }); services.AddAuthorization(); return services; }\\n\", \"```\\n\\nThis method ensures that the API can only be accessed with a valid access token. The middleware\", \" validates the incoming token to ensure that it's sent from a trusted issuer and validates that the \", \"token is valid to be used with the API that receives it. Therefore, browsing to the ordering or bask\", \"et controller will return a 401 (unauthorized) HTTP status code, indicating that an access token is \", \"required.\\n\\n## Making access requests to APIs\\n\\nWhen making requests to the ordering and basket micros\", \"ervices, the access token obtained from IdentityServer during the authentication process must be inc\", \"luded in the request, as shown in the following code example:\\n\\n```\\npublic async Task CreateOrderAsyn\", \"c(Models.Orders.Order newOrder) { var authToken = await _identityService.GetAuthTokenAsync().Configu\", \"reAwait( false ); if (string.IsNullOrEmpty(authToken)) { return ; } var uri = $\\\"{UriHelper.CombineUr\", \"i(_settingsService.GatewayOrdersEndpointBase, ApiUrlBase)}?api-version=1.0\\\"; var success = await _re\", \"questProvider.PostAsync(uri, newOrder, authToken, \\\"xrequestid\\\").ConfigureAwait( false ); }\\n```\\n\\nThe \", \"access token is stored with the IIdentityService implementation and can be retrieved using the GetAu\", \"thTokenAsync method.\\n\\nSimilarly, the access token must be included when sending data to an IdentityS\", \"erver protected API, as shown in the following code example:\\n\\n```\\npublic async Task ClearBasketAsync\", \"() { var authToken = await _identityService.GetAuthTokenAsync().ConfigureAwait( false ); if (string.\", \"IsNullOrEmpty(authToken)) { return ;\\n```\\n\\n```\\n} await GetBasketClient().DeleteBasketAsync( new Delet\", \"eBasketRequest(), CreateAuthenticationHeaders(authToken)) .ConfigureAwait( false ); }\\n```\\n\\nThe acces\", \"s token is retrieved from the IIdentityService and included in the call to the ClearBasketAsync meth\", \"od in the BasketService class.\\n\\nThe RequestProvider class in the eShop multi-platform app uses the H\", \"ttpClient class to make requests to the RESTful APIs exposed by the eShop reference application. Whe\", \"n making requests to the ordering and basket APIs, which require authorization, a valid access token\", \" must be included with the request. This is achieved by adding the access token to the headers of th\", \"e HttpClient instance, as demonstrated in the following code example:\\n\\n```\\nhttpClient.DefaultRequest\", \"Headers.Authorization = new AuthenticationHeaderValue(\\\"Bearer\\\", to ken);\\n```\\n\\nThe DefaultRequestHead\", \"ers property of the HttpClient class exposes the headers that are sent with each request, and the ac\", \"cess token is added to the Authorization header prefixed with the string Bearer. When the request is\", \" sent to a RESTful API, the value of the Authorization header is extracted and validated to ensure t\", \"hat it's sent from a trusted issuer and used to determine whether the user has permission to invoke \", \"the API that receives it.\\n\\nFor more information about how the eShop multi-platform app makes web req\", \"uests, see Accessing remote data.\\n\\n## Summary\\n\\nThere are many approaches to integrating authenticati\", \"on and authorization into a .NET MAUI app that communicates with an ASP.NET web application. The eSh\", \"op multi-platform app performs authentication and authorization with a containerized identity micros\", \"ervice that uses IdentityServer. IdentityServer is an open-source OpenID Connect and OAuth 2.0 frame\", \"work for ASP.NET Core that integrates with ASP.NET Core Identity to perform bearer token authenticat\", \"ion.\\n\\nThe multi-platform app requests security tokens from IdentityServer to authenticate a user or \", \"access a resource. When accessing a resource, an access token must be included in the request to API\", \"s that require authorization. IdentityServer's middleware vali dates incoming access tokens to ensur\", \"e that they are sent from a trusted issuer and that they are valid to be used with the API that rece\", \"ives them.\\n\\n## MVVM Toolkit Features\\n\\n## MVVM Toolkit\\n\\nThe Model-View-ViewModel (MVVM) pattern is a \", \"great structural basis for creating our applications. In this pattern, the ViewModel becomes the bac\", \"kbone of our application as it provides communication to our front-end user interface and backing co\", \"mponents. To provide integration with the user interface, we will rely on the ViewModel's properties\", \" and commands. As detailed in Updating views in response to changes in the underlying view model or \", \"model, the INotifyPropertyChanged interface on our ViewModel to allows changes to our properties to \", \"notify when the value is changed. Implementing all of these features means that our ViewModel can en\", \"d up becoming very verbose. For example, the following code shows a simple ViewModel with properties\", \" that raise changes:\\n\\n```\\npublic class SampleViewModel : INotifyPropertyChanged { private string _na\", \"me; private int _value; public event PropertyChangedEventHandler PropertyChanged; public string Name\", \" { get => _name; set => SetPropertyValue( ref _name, value); } public int Value { get => _value; set\", \" => SetPropertyValue( ref _value, value); } protected void SetPropertyValue<T>( ref T storageField, \", \"T newValue, [CallerMemberName] string propertyName = \\\"\\\") { if (Equals(storageField, newValue)) retur\", \"n ; storageField = newValue; RaisePropertyChanged(propertyName); } protected virtual void RaisePrope\", \"rtyChanged([CallerMemberName] string propertyName = \\\"\\\") { PropertyChanged?.Invoke( this , new Proper\", \"tyChangedEventArgs(propertyName)); } }\\n```\\n\\nWhile some optimizations could be made over time, we wil\", \"l still end up with a fairly verbose set of code for defining our ViewModel. This code can be diffic\", \"ult to maintain and becomes error-prone.\\n\\nThe CommunityToolkit.Mvvm NuGet Package (aka MVVM Toolkit)\", \" can be used to help address and simplify these common MVVM patterns. The MVVM Toolkit, along with n\", \"ewer features to the .NET language, allows for simplified logic, easy adoption into a project, and r\", \"untime independence. The example below shows the same ViewModel using components that come with the \", \"MVVM Toolkit:\\n\\n```\\npublic partial class SampleViewModel : ObservableObject { [ObservableProperty] pr\", \"ivate string _name; [ObservableProperty] private int _value; }\\n```\\n\\n## Note\\n\\nThe MVVM Toolkit is pro\", \"vided with the CommunityToolkit.Mvvm package. For information on how to add the package to your proj\", \"ect, see Introduction to the MVVM Toolkit on the Microsoft Developer Center.\\n\\nIn comparison to the o\", \"riginal example, we were able to drastically reduce the overall complexity and simplify the maintain\", \"ability of our ViewModel. The MVVM Toolkit comes with many pre-built common components and features,\", \" such as the ObservableObject shown above, that simplifies and standardizes the code that we have th\", \"roughout the application.\\n\\n## ObservableObject\\n\\nThe MVVM Toolkit provides ObservableObject which is \", \"intended for use as the base of our ViewModel objects or any object that needs to raise change notif\", \"ications. It implements INotifyPropertyChanged and INotifyPropertyChanging along with helper methods\", \" for setting properties and raising changes. Below is an example of a standard ViewModel using Obser\", \"vableObject:\\n\\n```\\npublic class SampleViewModel : ObservableObject { private string _name; private in\", \"t _value; public string Name { get => _name; set => SetProperty( ref _name, value); } public int Val\", \"ue { get => _value; set => SetProperty( ref _value, value);\\n```\\n\\n}\\n\\n}\\n\\nObservableObject handles all \", \"of the logic needed for raising change notifications by using the SetProperty method in your propert\", \"y setter. If you have a property that returns a Task&lt;T&gt;, the SetPropertyAndNotifyOnCompletion \", \"method can be used to delay publishing a property change until the task has been completed. The meth\", \"ods OnPropertyChanged and OnPropertyChanging that can also be used for raising property changes wher\", \"e needed in your object.\\n\\nFor more detailed information on ObservableObject, see ObservableObject in\", \" the MVVM Toolkit Developer Center.\\n\\n## RelayCommand and AsyncRelayCommand\\n\\nInteraction between .NET\", \" MAUI controls (for example, tapping a button or selecting an item from a collection) and the ViewMo\", \"del is done with the ICommand interface. .NET MAUI comes with a default implementation of ICommand w\", \"ith the Command object. .NET MAU I's Command is fairly basic and lacks support for more advanced fea\", \"tures, such as supporting asynchronous work and command execution status.\\n\\nThe MVVM Toolkit comes wi\", \"th two commands, RelayCommand and AsyncRelayCommand. RelayCommand is intended for situations where y\", \"ou have synchronous code to execute and has a fairly similar implementation to the .NET MAUI Command\", \" object.\\n\\n## Note\\n\\nEven though the .NET MAUI Command and RelayCommand are similar, using RelayComman\", \"d allows for decoupling your ViewModel from any direct .NET MAUI references. This means that your Vi\", \"ewModel is more portable, leading to easier reuse across projects.\\n\\nAsyncRelayCommand provides many \", \"additional features when working with asynchronous workflows. This is quite common in our ViewModel \", \"as we are typically communicating with repositories, APIs, databases, and other systems that utilize\", \" async/await. The AsyncRelayCommand constructor takes in an execution task defined as a Func&lt;Task\", \"&gt; or a delegate returning Task as part of the constructor. While the execution task is running, A\", \"syncRelayCommand will monitor the state of the task and provides updates using the IsRunning propert\", \"y. The IsRunning property can be bound to the UI which helps manage control states such as showing l\", \"oading with an ActivityIndicator or disabling/enabling a control. While the execution task is being \", \"executed, the Cancel method can be called to attempt cancellation of the execution task, if supporte\", \"d.\\n\\nBy default, AsyncRelayCommand doesn't allow concurrent execution. This is very helpful in situat\", \"ions where a user could unintentionally tap a control multiple times to execute a long-running or co\", \"stly operation. During task execution, AsyncRelayCommand will automatically call the CanExecuteChang\", \"ed event. In .NET MAUI, controls that support the Command and CommandParameter properties, such as B\", \"utton, will listen to this event and automatically enable or disable it during execution. This funct\", \"ionality can be overridden by using a custom canExecute parameter or setting the AsyncRelayCommandOp\", \"tions.AllowConcurrentExecutions flag in the constructor.\\n\\nFor more detailed information on implement\", \"ing commands, see the section Implementing commands in the MVVM chapter. Detailed information for th\", \"e RelayCommand and AsyncRelayCommand is available in the Commanding of the MVVM Toolkit Developer Ce\", \"nter.\\n\\n## Source Generators\\n\\nUsing the MVVM Toolkit components out-of-the-box allows you to greatly \", \"simplify our ViewModel. The MVVM Toolkit allows you to simplify common code use cases even further b\", \"y using Source Generators. The MVVM Toolkit source generators look for specific attributes in our co\", \"de and can generate wrappers for properties and commands.\\n\\n## Important\\n\\nThe MVVM Toolkit Source Gen\", \"erators generate code that is additive to our existing objects. Because of this, any object that is \", \"leveraging a source generator will need to be marked as partial.\\n\\nThe MVVM Toolkit ObservablePropert\", \"y attribute can be applied to fields in objects that inherit from ObservableObject and will wrap a p\", \"rivate field with a property that generates changes. The following code shows an example of using th\", \"e ObservableObject attribute on the _name field:\\n\\n```\\npublic partial class SampleViewModel : Observa\", \"bleObject { [ObservableProperty] private string _name; }\\n```\\n\\nWith the ObservableProperty attribute \", \"applied to the _name field, the source generator will run and generate another partial class with th\", \"e following code:\\n\\n```\\npartial class SampleViewModel { public string Name { get => _name; set { if (\", \"!EqualityComparer<string>.Default.Equals(_name, value)) { OnNameChanging(value); OnPropertyChanging(\", \"\\\"Name\\\"); _name = value; OnNameChanged(value); OnPropertyChanged(\\\"Name\\\"); } } } }\\n```\\n\\nThe generated \", \"SampleViewModel has used the private _name field and generated a new Name property that implements a\", \"ll of the logic needed for raising change notifications.\\n\\nThe MVVM Toolkit RelayCommand attribute ca\", \"n be applied to methods within an ObservableObject and will create a corresponding RelayCommand or A\", \"syncRelayCommand. The following code shows examples of using the RelayCommand attribute:\\n\\n```\\npublic\", \" partial class SampleViewModel : ObservableObject { public INavigationService NavigationService { ge\", \"t ; set ; } [ObservableProperty] private string _name; [ObservableProperty] bool _isValid; [RelayCom\", \"mand] private Task SettingsAsync() { return NavigationService.NavigateToAsync(\\\"Settings\\\"); } [RelayC\", \"ommand] private void Validate() { IsValid = !string.IsNullOrEmpty(Name); } }\\n```\\n\\nThe RelayCommand a\", \"pplied to the Validate method will generate a RelayCommand validate ValidateCommand because it has a\", \" void return and the SettingsAsync method will generate an AsyncRelayCommand named SettingsCommand. \", \"The source generator will generate the following code in other partial classes:\\n\\n```\\npartial class S\", \"ampleViewModel { private AsyncRelayCommand? settingsCommand; SettingsCommand => settingsCommand ??= \", \"new AsyncRelayCommand(SettingsAsync); } partial class SampleViewModel { private RelayCommand? valida\", \"teCommand; public IRelayCommand ValidateCommand => validateCommand ??= new RelayCommand(Validate); }\", \"\\n```\\n\\nAll of the complexity of wrapping our ViewModel's methods with an ICommand implementation has \", \"been handled by the source generator.\\n\\nFor more detailed information on MVVM Toolkit Source Generato\", \"rs, see MVVM source generators in the MVVM Toolkit Developer Center.\\n\\n## Summary\\n\\nThe MVVM Toolkit i\", \"s a great way to standardize and simplify our ViewModel code. The MVVM toolkit offers great implemen\", \"tations of standard MVVM components such as ObservableObject and Async/RelayCommand. The source gene\", \"rators help simplify our ViewModel properties and commands by generating all of the boilerplate code\", \" needed for user interface interactions. The MVVM Toolkit offers even more features outside of what \", \"has been shown in this chapter. For more information on the MVVM Toolkit, see Introduction to the MV\", \"VM Toolkit in the MVVM Toolkit Developer Center.\\n\\n## Unit testing\\n\\nmulti-platform apps experience pr\", \"oblems similar to both desktop and web-based applications. Mobile users will differ by their devices\", \", network connectivity, availability of services, and various other factors. Therefore, multi-platfo\", \"rm apps should be tested as they would be used in the real world to improve their quality, reliabili\", \"ty, and performance. Many types of testing should be performed on an app, including unit testing, in\", \"tegration testing, and user interface testing. Unit testing is the most common form and essential to\", \" building high-quality applications.\\n\\nA unit test takes a small unit of the app, typically a method,\", \" isolates it from the remainder of the code, and verifies that it behaves as expected. Its goal is t\", \"o check that each unit of functionality performs as expected, so errors don't propagate throug hout \", \"the app. Detecting a bug where it occurs is more efficient that observing the effect of a bug indire\", \"ctly at a secondary point of failure.\\n\\nUnit testing has the most significant effect on code quality \", \"when it's an integral part of the software development workflow. Unit tests can act as design docume\", \"ntation and functional specifications for an application. As soon as a method has been written, unit\", \" tests should be written that verify the method's behavior in response to standard, boundary, and in\", \"correct input data cases and check any explicit or implicit assumptions made by the code. Alternativ\", \"ely, with test-driven development, unit tests are written before the code. For more information on t\", \"est-driven development and how to implement it, see Walkthrough: Test-driven development using Test \", \"Explorer.\\n\\n## Note\\n\\nUnit tests are very effective against regression. That is, functionality that us\", \"ed to work, but has been disturbed by a faulty update.\\n\\nUnit tests typically use the arrange-act-ass\", \"ert pattern:\\n\\n| Step    | Description                                                               \", \"                  |\\n|---------|---------------------------------------------------------------------\", \"------------------------|\\n| Arrange | Initializes objects and sets the value of the data that is pas\", \"sed to the method under test. |\\n| Act     | Invokes the method under test with the required argument\", \"s.                                  |\\n| Assert  | Verifies that the action of the method under test \", \"behaves as expected.                      |\\n\\nThis pattern ensures that unit tests are readable, self\", \"-describing, and consistent.\\n\\n## Dependency injection and unit testing\\n\\nOne of the motivations for a\", \"dopting a loosely-coupled architecture is that it facilitates unit testing. One of the types registe\", \"red with the dependency injection service is the IAppEnvironmentService interface. The following cod\", \"e example shows an outline of this class:\\n\\n```\\npublic class OrderDetailViewModel : ViewModelBase { p\", \"rivate IAppEnvironmentService _appEnvironmentService; public OrderDetailViewModel( IAppEnvironmentSe\", \"rvice appEnvironmentService, IDialogService dialogService, INavigationService navigationService, ISe\", \"ttingsService settingsService) : base (dialogService, navigationService, settingsService) { _appEnvi\", \"ronmentService = appEnvironmentService; } }\\n```\\n\\nThe OrderDetailViewModel class has a dependency on \", \"the IAppEnvironmentService type, which the dependency injection container resolves when it instantia\", \"tes an OrderDetailViewModel object. However, rather than create an IAppEnvironmentService object whi\", \"ch utilizes real servers, devices and configurations to unit test the OrderDetailViewModel class, in\", \"stead, replace the IAppEnvironmentService object with a mock object for the purpose of the tests. A \", \"mock object is one that has the same signature of an object or an interface, but is created in a spe\", \"cific manner to help with unit testing. It is often used with dependency injection to provide specif\", \"ic implementations of interfaces for testing different data and workflow scenarios.\\n\\nThis approach a\", \"llows the IAppEnvironmentService object to be passed into the OrderDetailViewModel class at runtime,\", \" and in the interests of testability, it allows a mock class to be passed into the OrderDetailViewMo\", \"del class at test time. The main advantage of this approach is that it enables unit tests to be exec\", \"uted without requiring unwieldy resources such as runtime platform features, web services, or databa\", \"ses.\\n\\n## Testing MVVM applications\\n\\nTesting models and view models from MVVM applications is identic\", \"al to testing any other class, and uses the same tools and techniques; this includes features such a\", \"s unit testing and mocking. However, some patterns that are typical to model and view model classes \", \"can benefit from specific unit testing techniques.\\n\\n## Tip\\n\\nTest one thing with each unit test. As t\", \"he complexity of a test expands, it makes verification of that test more difficult. By limiting a un\", \"it test to a single concern, we can ensure that our tests are more repeatable, isolated, and have a \", \"smaller execution time. See\\n\\nUnit testing best practices with .NET for more best practices.\\n\\nDon't b\", \"e tempted to make a unit test exercise more than one aspect of the unit's behavior. Doing so leads t\", \"o tests that are difficult to read and update. It can also lead to confusion when interpreting a fai\", \"lure.\\n\\nThe eShop multi-platform app uses MSTest to perform unit testing, which supports two differen\", \"t types of unit tests:\\n\\n| Testing Type   | Attribute   | Description                                \", \"            |\\n|----------------|-------------|------------------------------------------------------\", \"--|\\n| TestMethod     | TestMethod  | Defines the actual test method to run..                |\\n| Data\", \"Source     | DataSource  | Tests that are only true for a particular set of data. |\\n\\nThe unit tests \", \"included with the eShop multi-platform app are TestMethod, so each unit test method is decorated wit\", \"h the TestMethod attribute. In addition to MSTest there are several other testing frameworks availab\", \"le including NUnit and xUnit.\\n\\n## Testing asynchronous functionality\\n\\nWhen implementing the MVVM pat\", \"tern, view models usually invoke operations on services, often asynchronously. Tests for code that i\", \"nvokes these operations typically use mocks as replacements for the actual services. The following c\", \"ode example demonstrates testing asynchronous functionality by passing a mock service into a view mo\", \"del:\\n\\n```\\n[TestMethod] public async Task OrderPropertyIsNotNullAfterViewModelInitializationTest() { \", \"// Arrange var orderService = new OrderMockService(); var orderViewModel = new OrderDetailViewModel(\", \"orderService); // Act var order = await orderService.GetOrderAsync(1, GlobalSetting.Instance.AuthTok\", \"en); await orderViewModel.InitializeAsync(order); // Assert Assert.IsNotNull(orderViewModel.Order); \", \"}\\n```\\n\\nThis unit test checks that the Order property of the OrderDetailViewModel instance will have \", \"a value after the InitializeAsync method has been invoked. The InitializeAsync method is invoked whe\", \"n the view model's corresponding view is navigated to. For more information about navigation, see Na\", \"vigation.\\n\\nWhen the OrderDetailViewModel instance is created, it expects an IOrderService instance t\", \"o be specified as an argument. However, the OrderService retrieves data from a web service. Therefor\", \"e, an OrderMockService instance, a mock version of the OrderService class, is specified as the argum\", \"ent to the OrderDetailViewModel constructor. Then, mock data is retrieved rather than communicating \", \"with a web service when the view model's InitializeAsync method is invoked, which uses IOrderService\", \" operations.\\n\\n## Testing INotifyPropertyChanged implementations\\n\\nImplementing the INotifyPropertyCha\", \"nged interface allows views to react to changes that originate from view models and models. These ch\", \"anges are not limited to data shown in controls -they are also used to control the view, such as vie\", \"w model states that cause animations to be started or controls to be disabled.\\n\\nProperties that can \", \"be updated directly by the unit test can be tested by attaching an event handler to the PropertyChan\", \"ged event and checking whether the event is raised after setting a new value for the property. The f\", \"ollowing code example shows such a test:\\n\\n```\\n[TestMethod] public async Task SettingOrderPropertySho\", \"uldRaisePropertyChanged() { var invoked = false; var orderService = new OrderMockService(); var orde\", \"rViewModel = new OrderDetailViewModel(orderService); orderViewModel.PropertyChanged += (sender, e) =\", \"> { if (e.PropertyName.Equals(\\\"Order\\\")) invoked = true; }; var order = await orderService.GetOrderAs\", \"ync(1, GlobalSetting.Instance.AuthToken); await orderViewModel.InitializeAsync(order); Assert.IsTrue\", \"(invoked); }\\n```\\n\\nThis unit test invokes the InitializeAsync method of the OrderViewModel class, whi\", \"ch causes its Order property to be updated. The unit test will pass, provided that the PropertyChang\", \"ed event is raised for the Order property.\\n\\n## Testing message-based communication\\n\\nView models that\", \" use the MessagingCenter class to communicate between loosely coupled classes can be unit tested by \", \"subscribing to the message being sent by the code under test, as demonstrated in the following code \", \"example:\\n\\n```\\n[TestMethod] public void AddCatalogItemCommandSendsAddProductMessageTest() { var messa\", \"geReceived = false; var catalogService = new CatalogMockService(); var catalogViewModel = new Catalo\", \"gViewModel(catalogService); MessagingCenter.Subscribe<CatalogViewModel, CatalogItem>( this, MessageK\", \"eys.AddProduct, (sender, arg) => { messageReceived = true; }); catalogViewModel.AddCatalogItemComman\", \"d.Execute( null );\\n```\\n\\n```\\nAssert.IsTrue(messageReceived); }\\n```\\n\\nThis unit test checks that the Ca\", \"talogViewModel publishes the AddProduct message in response to its AddCatalogItemCommand being execu\", \"ted. Because the MessagingCenter class supports multicast message subscriptions, the unit test can s\", \"ubscribe to the AddProduct message and execute a callback delegate in response to receiving it. This\", \" callback delegate, specified as a lambda expression, sets a boolean field that's used by the Assert\", \" statement to verify the behavior of the test.\\n\\n## Testing exception handling\\n\\nUnit tests can also b\", \"e written that check that specific exceptions are thrown for invalid actions or inputs, as demonstra\", \"ted in the following code example:\\n\\n```\\n[TestMethod] public void InvalidEventNameShouldThrowArgument\", \"ExceptionText() { var behavior = new MockEventToCommandBehavior { EventName = \\\"OnItemTapped\\\" }; var \", \"listView = new ListView(); Assert.Throws<ArgumentException>(() => listView.Behaviors.Add(behavior));\", \" }\\n```\\n\\nThis unit test will throw an exception because the ListView control does not have an event n\", \"amed OnItemTapped. The Assert.Throws&lt;T&gt; method is a generic method where T is the type of the \", \"expected exception. The argument passed to the Assert.Throws&lt;T&gt; method is a lambda expression \", \"that will throw the exception. Therefore, the unit test will pass provided that the lambda expressio\", \"n throws an ArgumentException.\\n\\n## Tip\\n\\nAvoid writing unit tests that examine exception message stri\", \"ngs. Exception message strings might change over time, and so unit tests that rely on their presence\", \" are regarded as brittle.\\n\\n## Testing validation\\n\\nThere are two aspects to testing the validation im\", \"plementation: testing that any validation rules are correctly implemented and testing that the Valid\", \"atableObject&lt;T&gt; class performs as expected.\\n\\nValidation logic is usually simple to test, becau\", \"se it is typically a self-contained process where the output depends on the input. There should be t\", \"ests on the results of invoking the Validate method on each property that has at least one associate\", \"d validation rule, as demonstrated in the following code example:\\n\\n```\\n[TestMethod] public void Chec\", \"kValidationPassesWhenBothPropertiesHaveDataTest() {\\n```\\n\\n```\\nvar mockViewModel = new MockViewModel()\", \"; mockViewModel.Forename.Value = \\\"John\\\"; mockViewModel.Surname.Value = \\\"Smith\\\"; var isValid = mockVi\", \"ewModel.Validate(); Assert.IsTrue(isValid); }\\n```\\n\\nThis unit test checks that validation succeeds wh\", \"en the two ValidatableObject&lt;T&gt; properties in the MockViewModel instance both have data.\\n\\nAs w\", \"ell as checking that validation succeeds, validation unit tests should also check the values of the \", \"Value, IsValid, and Errors property of each ValidatableObject&lt;T&gt; instance, to verify that the \", \"class performs as expected. The following code example demonstrates a unit test that does this:\\n\\n```\", \"\\n[TestMethod] public void CheckValidationFailsWhenOnlyForenameHasDataTest() { var mockViewModel = ne\", \"w MockViewModel(); mockViewModel.Forename.Value = \\\"John\\\"; bool isValid = mockViewModel.Validate(); A\", \"ssert.IsFalse(isValid); Assert.IsNotNull(mockViewModel.Forename.Value); Assert.IsNull(mockViewModel.\", \"Surname.Value); Assert.IsTrue(mockViewModel.Forename.IsValid); Assert.IsFalse(mockViewModel.Surname.\", \"IsValid); Assert.AreEqual(mockViewModel.Forename.Errors.Count(), 0); Assert.AreNotEqual(mockViewMode\", \"l.Surname.Errors.Count(), 0); }\\n```\\n\\nThis unit test checks that validation fails when the Surname pr\", \"operty of the MockViewModel doesn't have any data, and the Value, IsValid, and Errors property of ea\", \"ch ValidatableObject&lt;T&gt; instance are correctly set.\\n\\n## Summary\\n\\nA unit test takes a small uni\", \"t of the app, typically a method, isolates it from the remainder of the code, and verifies that it b\", \"ehaves as expected. Its goal is to check that each unit of functionality performs as expected, so er\", \"rors don't propagate throughout the app.\\n\\nThe behavior of an object under test can be isolated by re\", \"placing dependent objects with mock objects that simulate the behavior of the dependent objects. Thi\", \"s enables unit tests to be executed without requiring unwieldy resources such as runtime platform fe\", \"atures, web services, or databases\\n\\nTesting models and view models from MVVM applications is identic\", \"al to testing any other classes, and the same tools and techniques can be used.\"]"