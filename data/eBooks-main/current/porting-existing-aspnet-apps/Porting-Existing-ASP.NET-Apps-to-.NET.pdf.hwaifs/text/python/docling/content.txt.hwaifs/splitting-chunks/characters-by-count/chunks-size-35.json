"[\"Steve \\\"ardalis\\\" Smith\\n\\nPUBLISHED BY\\n\\nMicrosoft Developer Division, .NET, and Visual Studio product t\", \"eams\\n\\nA division of Microsoft Corporation\\n\\nOne Microsoft Way\\n\\nRedmond, Washington 98052-6399\\n\\nCopyri\", \"ght \\u00a9 2023 by Microsoft Corporation\\n\\nAll rights reserved. No part of this book's contents may be rep\", \"roduced or transmitted in any form or by any means without the written permission of the publisher.\\n\", \"\\nThis book is provided 'as -is' and expresses the author's views and opinions. The views, opinions, \", \"and information expressed in this book, including URL and other Internet website references, may cha\", \"nge without notice.\\n\\nSome examples depicted herein are provided for illustration only and are fictit\", \"ious. No real association or connection is intended or should be inferred.\\n\\nMicrosoft and the tradem\", \"arks listed at https://www.microsoft.com on the 'Trademarks' webpage are trademarks of the Microsoft\", \" group of companies.\\n\\nMac and macOS are trademarks of Apple Inc.\\n\\nThe Docker whale logo is a registe\", \"red trademark of Docker, Inc. Used by permission.\\n\\nAll other marks and logos are property of their r\", \"espective owners.\\n\\nAuthors:\\n\\nSteve 'ardalis' Smith , Software Architect and Trainer - Ardalis.com\\n\\nP\", \"articipants and Reviewers:\\n\\nNish Anil , Senior Program Manager, .NET team, Microsoft\\n\\nMike Rousos , \", \"Principal Software Engineer, .NET team, Microsoft\\n\\nScott Addie , Senior Content Developer, .NET team\", \", Microsoft\\n\\nDavid Pine , Senior Content Developer, .NET team, Microsoft\\n\\n## Version\\n\\nThis guide cov\", \"ers .NET 7 and updates related to the same technology 'wave' (that is, Azure and other third-party t\", \"echnologies) coinciding in time with the .NET 7 release. This book covers migration of apps that are\", \" currently running on .NET Framework 4.x.\\n\\n## Who should use this guide\\n\\nThis guide's audience is de\", \"velopers, development leads, and architects who are interested in migrating their existing apps writ\", \"ten for ASP.NET MVC and Web API (.NET Framework 4.x) to the latest\\n\\n.NET version. ASP.NET Web Forms \", \"developers will benefit from this guide but should also read the Blazor for ASP.NET Web Forms Develo\", \"pers e-book.\\n\\nA secondary audience is technical decision-makers planning when to move their apps to \", \".NET 7.\\n\\nThe target audience for this book is .NET developers with large, existing apps that run on \", \"ASP.NET MVC and Web API. Apps built on ASP.NET Web Forms are outside of the focus of this book, thou\", \"gh much of the information comparing .NET Framework and .NET Core/latest may still be relevant.\\n\\n## \", \"How you can use this guide\\n\\nYou can read this book straight through, as we expect many readers to do\", \". This book will provide you first with considerations for whether you should port your app at all. \", \"That content is followed by architectural differences between .NET Framework and .NE T Core. From th\", \"ere, you'll learn strategies for migrating a large solution over time and how to port a real app. Ne\", \"xt, the book includes deployment scenarios that address the need to run different apps while appeari\", \"ng as a single app to users. The book concludes with two case studies describing real apps that have\", \" migrated from ASP.NET MVC to ASP.NET Core.\\n\\nWhether or not you choose to start from the first chapt\", \"er, you can reference any of these chapters to learn about specific concepts:\\n\\n- Architectural diffe\", \"rences\\n- Migrate large solutions\\n- Sample migration\\n- Deployment scenarios\\n\\nThis guide is available \", \"both in PDF form and online. Feel free to forward this document or links to its online version to yo\", \"ur team to ensure a common understanding of these concepts.\\n\\n## Contents\\n\\n| Introduction to porting \", \"apps to .NET 7 ................................................................................ 1   \", \"                                                                   |\\n|------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"--------------------------------------------------------------|\\n| References .......................\", \"....................................................................................................\", \".......................................................2 |\\n| Migration considerations...............\", \"....................................................................................................\", \"...................................2                |\\n| Is migration to .NET Core appropriate? .....\", \"....................................................................................................\", \"............2                                  |\\n| When is .NET Framework appropriate?..............\", \"....................................................................................................\", \"....3                                     |\\n| References............................................\", \"....................................................................................................\", \"..............................4      |\\n| Migrate to ASP.NET Core 2.1 ...............................\", \"....................................................................................................\", \"...........4                    |\\n| Should apps run on .NET Framework with ASP.NET Core 2.1.........\", \"..................................................................4                                 \", \"                           |\\n| References...........................................................\", \"....................................................................................................\", \"...............5      |\\n| Choose the right .NET Core version .......................................\", \"..........................................................................................5         \", \"                 |\\n| References.....................................................................\", \"....................................................................................................\", \".....5      |\\n| Strategies for migrating incrementally..............................................\", \"..............................................................................6                     \", \"       |\\n| Migrating slice by slice.................................................................\", \".....................................................................................6              \", \"  |\\n| Migrating layer by layer......................................................................\", \"..............................................................................6                  |\\n|\", \" References.........................................................................................\", \".....................................................................................7      |\\n| Stra\", \"tegies for migrating ASP.NET Web Forms apps.........................................................\", \".........................................7                                             |\\n| Separate \", \"business logic and other concerns...................................................................\", \".........................................7                                        |\\n| Implement clie\", \"nt behavior and web APIs............................................................................\", \"......................................8                                      |\\n| Consider Blazor....\", \"....................................................................................................\", \"............................................................8           |\\n| Summary.................\", \"....................................................................................................\", \"............................................................8      |\\n| References...................\", \"....................................................................................................\", \".......................................................8      |\\n| Cloud native development..........\", \"....................................................................................................\", \"................................9                        |\\n| Leverage containers....................\", \"....................................................................................................\", \"...................................9                |\\n| Side-by-side deployment options.............\", \"....................................................................................................\", \"...............9                               |\\n| Other options on Windows.........................\", \"....................................................................................................\", \"................9                         |\\n\\n| References...........................................\", \"....................................................................................................\", \"...............................9   |\\n|--------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"---------------------------|\\n| Additional migration resources.......................................\", \"................................................................................................ 10 \", \"                   |\\n| Official documentation ......................................................\", \"............................................................................................10      \", \"           |\\n| GitHub ..............................................................................\", \"....................................................................................................\", \"10 |\\n| Stack Overflow ..............................................................................\", \"....................................................................................11         |\\n| Y\", \"ouTube channels.....................................................................................\", \".......................................................................11              |\\n| Twitter, \", \"Gitter, Slack, and other community channels.........................................................\", \"..............................11                                               |\\n| References.......\", \"....................................................................................................\", \"................................................................11     |\\n| Architectural differences\", \" between ASP.NET MVC and ASP.NET Core...............................................12              \", \"                                                               |\\n| Breaking changes.................\", \"....................................................................................................\", \"............................................. 12       |\\n| App startup differences between ASP.NET M\", \"VC and ASP.NET Core............................................................... 12               \", \"                                               |\\n| ASP.NET MVC Startup .............................\", \"....................................................................................................\", \"...................13                  |\\n| ASP.NET Core Startup.....................................\", \"....................................................................................................\", \"............13                 |\\n| Porting considerations...........................................\", \"....................................................................................................\", \"....14                 |\\n| References...............................................................\", \"....................................................................................................\", \"........14     |\\n| Hosting differences between ASP.NET MVC and ASP.NET Core.........................\", \".............................................. 14                                                   \", \"       |\\n| References...............................................................................\", \"............................................................................................15     |\", \"\\n| Serve static files in ASP.NET MVC and ASP.NET Core...............................................\", \"............................................. 15                                           |\\n| Host \", \"static files in ASP.NET MVC.........................................................................\", \"......................................................15                           |\\n| Host static f\", \"iles in ASP.NET Core................................................................................\", \"................................................15                         |\\n| References...........\", \"....................................................................................................\", \"............................................................16     |\\n| Dependency injection differen\", \"ces between ASP.NET MVC and ASP.NET Core........................................... 16              \", \"                                                           |\\n| Dependency injection in ASP.NET Core.\", \"....................................................................................................\", \".............16                                    |\\n| References...................................\", \"....................................................................................................\", \"....................................17     |\\n| ASP.NET modules and handlers.........................\", \"....................................................................................................\", \"....17                             |\\n| ASP.NET Core middleware......................................\", \"....................................................................................................\", \"..17                       |\\n| References...........................................................\", \"....................................................................................................\", \"............18     |\\n| Accessing HttpContext........................................................\", \"...........................................................................................17       \", \"           |\\n| Configuration differences between ASP.NET MVC and ASP.NET Core.......................\", \".................................... 18                                                             \", \"   |\\n| ASP.NET Core configuration ..................................................................\", \"......................................................................19                       |\\n\\n| \", \"Migrate configuration ..............................................................................\", \"......................................................................20            |    |\\n|--------\", \"----------------------------------------------------------------------------------------------------\", \"-----------------------------------------------------------------------------|----|\\n| References....\", \"....................................................................................................\", \"...................................................................21 |    |\\n| Routing differences b\", \"etween ASP.NET MVC and ASP.NET Core.................................................................\", \"......                                                         | 21 |\\n| Routing in ASP.NET MVC and W\", \"eb API .............................................................................................\", \".....................21                                 |    |\\n| Route table .......................\", \"....................................................................................................\", \"..............................................21 |    |\\n| Routing in .NET 7 ........................\", \"....................................................................................................\", \".................................23       |    |\\n| References.......................................\", \"....................................................................................................\", \"................................24 |    |\\n| Logging differences between ASP.NET MVC and ASP.NET Core\", \" ......................................................................                             \", \"                            | 25 |\\n| ASP.NET MVC logging ...........................................\", \"....................................................................................................\", \"....25               |    |\\n| ASP.NET Core logging..................................................\", \"..................................................................................................25\", \"              |    |\\n| Migrate logging..............................................................\", \"..................................................................................................26\", \"       |    |\\n| References..........................................................................\", \".................................................................................................26 \", \"|    |\\n| Compare Razor Pages to ASP.NET MVC.........................................................\", \".............................................................                                | 26 |\\n\", \"| References........................................................................................\", \"...................................................................................27 |    |\\n| Compa\", \"re ASP.NET Web API 2 and ASP.NET Core ..............................................................\", \".....................................                                          | 27 |\\n| References..\", \"....................................................................................................\", \".....................................................................27 |    |\\n| Compare authenticat\", \"ion and authorization between ASP.NET MVC and ASP.NET Core........................                  \", \"                                                                 | 27 |\\n| Authorization ............\", \"....................................................................................................\", \".....................................................28   |    |\\n| References.......................\", \"....................................................................................................\", \"................................................28 |    |\\n| Compare ASP.NET Identity and ASP.NET Cor\", \"e Identity ........................................................................................ \", \"                                            | 28 |\\n| Migrate from OWIN / Katana.....................\", \"....................................................................................................\", \".............29                      |    |\\n| References............................................\", \"....................................................................................................\", \"...........................29 |    |\\n| Compare controllers in ASP.NET MVC and Web API with controlle\", \"rs in ASP.NET Core ..........................                                                       \", \"                       | 29 |\\n| References..........................................................\", \"....................................................................................................\", \".............30 |    |\\n| Compare Razor usage in ASP.NET MVC and ASP.NET Core........................\", \"........................................................                                            \", \"         | 30 |\\n| Tag Helpers.......................................................................\", \"..................................................................................................30\", \"  |    |\\n| Razor Pages..............................................................................\", \"..........................................................................................30   |    \", \"|\\n| References......................................................................................\", \".....................................................................................31 |    |\\n| Com\", \"pare ASP.NET SignalR and ASP.NET Core SignalR ......................................................\", \"...................................                                              | 31 |\\n| Feature di\", \"fferences...........................................................................................\", \"...............................................................31         |    |\\n| References.......\", \"....................................................................................................\", \"................................................................31 |    |\\n| Compare testing options \", \"between ASP.NET MVC and ASP.NET Core ............................................................   \", \"                                                            | 32 |\\n\\n| References....................\", \"....................................................................................................\", \"...................................................32    |    |\\n|-----------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-----------------------------------------------------|----|\\n| Migrate large solutions to ASP.NET Cor\", \"e...................................................................................................\", \"..33                                             |    |\\n| References ...............................\", \"....................................................................................................\", \"............................................ | 33 |\\n| Identify sequence of projects to migrate......\", \"....................................................................................................\", \"..........                               | 33 |\\n| Unit tests........................................\", \"....................................................................................................\", \"..................................37 |    |\\n| Considerations for migrating many apps................\", \"...............................................................................................37   \", \"                                 |    |\\n| Summary...................................................\", \"....................................................................................................\", \".......................38    |    |\\n| References....................................................\", \"....................................................................................................\", \"...................38    |    |\\n| Understand and update dependencies................................\", \"........................................................................................            \", \"                     | 38 |\\n| Update class library dependencies.....................................\", \".......................................................................................38           \", \"                 |    |\\n| Update NuGet package dependencies.........................................\", \"...........................................................................39                       \", \"             |    |\\n| Migrate ASP.NET MVC projects..................................................\", \"................................................................................40                  \", \"         |    |\\n| References........................................................................\", \"...................................................................................................4\", \"0    |    |\\n| Strategies for migrating while running in production .................................\", \"..........................................................                                          \", \" | 40 |\\n| Refactor the .NET Framework solution......................................................\", \"..............................................................40                                 |  \", \"  |\\n| Extract front-end assets to a CDN.............................................................\", \"................................................................41                           |    |\\n\", \"| Extract and migrate individual microservices .....................................................\", \"..................................................41                                     |    |\\n| De\", \"ploy multiple versions of the app side-by-side in IIS...............................................\", \"....................................41                                               |    |\\n| Apply \", \"the Strangler pattern ..............................................................................\", \"...........................................................41                    |    |\\n| Multi-targ\", \"eting approaches....................................................................................\", \".....................................................42                      |    |\\n| Summary.......\", \"....................................................................................................\", \"...................................................................42    |    |\\n| References........\", \"....................................................................................................\", \"...............................................................42    |    |\\n| Example migration of e\", \"Shop to ASP.NET Core................................................................................\", \"..........43                                                     |    |\\n| Run ApiPort to identify pr\", \"oblematic APIs......................................................................................\", \"..............................                               | 44 |\\n| Update project files and NuGet\", \" reference syntax...................................................................................\", \".................                                        | 47 |\\n| Create new ASP.NET Core project...\", \"....................................................................................................\", \"...........................                          | 49 |\\n| Migrating NuGet Packages .............\", \"....................................................................................................\", \".........................51                      |    |\\n| Migrate static files......................\", \"....................................................................................................\", \"..................................53         |    |\\n| Migrate C# files..............................\", \"....................................................................................................\", \"...............................54        |    |\\n| Migrate views ....................................\", \"....................................................................................................\", \".................................    | 56 |\\n| Migrate app startup components........................\", \"....................................................................................................\", \"......                           | 58 |\\n| Configure MVC.............................................\", \"....................................................................................................\", \".................58          |    |\\n\\n| Data access considerations...................................\", \"....................................................................................................\", \"........                  | 63   |\\n|----------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"------------------------|------|\\n| Migrate to Entity Framework Core.................................\", \"...........................................................................................64       \", \"                      |      |\\n| Fix all TODO tasks.................................................\", \"....................................................................................................\", \"............        | 67   |\\n| Additional MVC customizations........................................\", \"..............................................................................................      \", \"                  | 68   |\\n| Other dependencies ....................................................\", \"....................................................................................................\", \"....            | 69   |\\n| References ..............................................................\", \"....................................................................................................\", \"............. | 69   |\\n| More migration scenarios ..................................................\", \"...............................................................................................     \", \"            | 69   |\\n| Migrate ASP.NET MVC 5 and WebApi 2 to ASP.NET Core MVC.......................\", \"............................................69                                                      \", \"          |      |\\n| Migrate HttpResponseMessage to ASP.NET Core....................................\", \"..........................................................70                                        \", \"        |      |\\n| Migrate content negotiation from ASP.NET Web API to ASP.NET Core.................\", \"...................................71                                                               \", \"      |      |\\n| Custom model binding...............................................................\", \"...................................................................................71               \", \"    |      |\\n| Media formatters.....................................................................\", \".........................................................................................73         \", \"  |      |\\n| Custom filters.........................................................................\", \"............................................................................................73      \", \"|      |\\n| Route constraints .......................................................................\", \"......................................................................................74          | \", \"     |\\n| Custom route handlers .....................................................................\", \".............................................................................75                 |   \", \"   |\\n| CORS support.................................................................................\", \"...................................................................................76         |     \", \" |\\n| Custom areas ..................................................................................\", \"...................................................................................77       |      |\", \"\\n| Integration tests for ASP.NET MVC and ASP.NET Web API............................................\", \".................................78                                                       |      |\\n|\", \" WCF client configuration...........................................................................\", \"....................................................................80                  |      |\\n| R\", \"eferences...........................................................................................\", \"................................................................................80    |      |\\n| Dep\", \"loyment scenarios when migrating to ASP.NET Core ...................................................\", \"..................81                                                                |      |\\n| Split\", \" a large web app....................................................................................\", \".......................................................................           | 81   |\\n| Summary\", \"....................................................................................................\", \"..............................................................................  | 84   |\\n| Reference\", \"s ..................................................................................................\", \"............................................................................. | 85   |\\n| Summary: Po\", \"rt existing ASP.NET Apps to .NET 7..................................................................\", \"....................86                                                      |      |\\n\\n## Introductio\", \"n to porting apps to .NET 7\\n\\n.NET Core and its latest version, .NET 7, represent a revolutionary ste\", \"p forward from .NET Framework. It offers a host of advantages over .NET Framework across the board f\", \"rom productivity to performance, from cross-platform support to developer satisfaction. ASP.NET Core\", \" was even voted the most-loved web framework (tied with Svelte) in the 2021 Stack Overflow developer\", \" survey. Clearly there are strong reasons to consider migrating.\\n\\nEven before .NET 7 shipped, Micros\", \"oft was clear: .NET Core is the Future of .NET. To quote this article:\\n\\nNew apps should be built on \", \".NET Core. .NET Core is where future investments in .NET will happen. Existing apps are safe to rema\", \"in on .NET Framework which will be supported. Existing apps that want to take advantage of the new f\", \"eatures in .NET should consider moving to .NET Core. As we plan into the future, we will be bringing\", \" in even more capabilities to the platform.\\n\\nToday, .NET 7 is what new apps should target, and if yo\", \"u're migrating an existing app from .NET Framework, .NET 7 is your ideal target framework.\\n\\nHowever,\", \" upgrading your app to ASP.NET Core will require some effort. That effort should be balanced against\", \" business value and goals. .NET Framework apps have a long life ahead of them, with support built in\", \"to Windows for the foreseeable future. What are some of the questions you should consider before dec\", \"iding migration to .NET 7 is appropriate? What are the expected advantages? What are the tradeoffs? \", \"How much effort is involved? These obvious questions are just the beginning, but make for a great st\", \"arti ng point as teams consider how to support their customers' needs with apps today and tomorrow.\\n\", \"\\n- Is migration to .NET 7 appropriate?\\n- When does it make sense to remain on .NET Framework?\\n- Shou\", \"ld apps target ASP.NET Core 2.1 as a stepping stone?\\n- How should teams choose the right .NET versio\", \"n to target?\\n- What strategies are recommended for incremental migration of large apps?\\n- What deplo\", \"yment strategies should be considered when porting to .NET 7?\\n- Where can we find additional resourc\", \"es?\\n\\nThis introductory chapter addresses all of these questions and more before moving on to more sp\", \"ecific and technical considerations in future chapters.\\n\\n## References\\n\\n- 2021 Stack Overflow develo\", \"per survey most loved web frameworks\\n- .NET Core is the Future of .NET\\n\\n## Migration considerations\\n\", \"\\nThe most fundamental question teams must answer when it comes to porting their apps to .NET Core is\", \", should they port at all? In some cases, the best path forward is to remain on .NET Framework using\", \" ASP.NET MVC and/or Web API. This chapter considers reasons why moving to .NET Core makes sense. The\", \" chapter also considers scenarios and counterpoints for staying on .NET Framework.\\n\\n## Is migration \", \"to .NET Core appropriate?\\n\\nLet's start with some of the reasons why you might want to move to .NET C\", \"ore/.NET 7. There are quite a few, so don't consider this list exhaustive.\\n\\n## Cross-platform suppor\", \"t\\n\\nApps built on .NET Core are truly cross-platform and can run on Windows, Linux, and macOS. Not on\", \"ly can your developers use whatever hardware they want, but you can also host your app anywhere. Exa\", \"mples range from local IIS to Azure in the cloud or from Linux Docker containers to IoT devices.\\n\\n##\", \" Performance and scalability\\n\\nApps built with .NET Core are running on one of the fastest tech stack\", \"s available anywhere. ASP.NET MVC apps often see performance improvements on ASP.NET Core, especiall\", \"y if they're updated to take advantage of some new features available in .NET Core.\\n\\n## Cloud-native\", \"\\n\\nFor the above reasons and others, .NET Core apps are well-suited to running in cloud hosting envir\", \"onments. Lightweight and fast, .NET Core apps can be deployed to Azure App Services or containers an\", \"d scaled horizontally as needed to meet immediate system demand.\\n\\n## Maintainable\\n\\nFor many apps, wh\", \"ile they've continued to meet customer and business needs, technical debt has accumulated and mainta\", \"ining the app has grown expensive. ASP.NET Core apps are more easily tested than ASP.NET MVC apps, m\", \"aking them easier to refactor and extend with confidence.\\n\\n## Modular\\n\\nASP.NET Core is modular, usin\", \"g NuGet packages as a first-class part of the framework. Apps built for .NET Core all support depend\", \"ency injection, making it easy to compose solutions from whatever implementations are needed for a g\", \"iven environment. Building microservices with .NET Core is easier\\n\\nthan with ASP.NET MVC with its de\", \"pendency on IIS, which opens up additional options to break up large apps into smaller modules.\\n\\n## \", \"Modern\\n\\nStaying on a modern, actively developed technology stack has a host of advantages. New featu\", \"res and C# language features will only be added to .NET Core. The .NET Framework has had its last re\", \"lease with version 4.8, and versions of C# beyond 8 won't target .NET Framework. While ASP.NET MVC w\", \"ill remain supported by Microsoft for many years, the best and brightest .NET software developers ar\", \"e likely looking to use the more modern .NET Core framework, with all of the advantages it offers (o\", \"nly some of which are summarized above). Finding developers with the skills to maintain an ASP.NET M\", \"VC app will start to become a challenge at some point, as will finding online training and troublesh\", \"ooting assistance. There probably aren't that many new blog posts being writ ten about ASP.NET MVC 5\", \", while there are plenty being written for .NET 7, for example.\\n\\nThere are many compelling reasons t\", \"o consider migrating to .NET Core, which presumably is why you're reading this book! But let's consi\", \"der some disadvantages and reasons why it may make more sense to remain on the .NET Framework.\\n\\n## W\", \"hen is .NET Framework appropriate?\\n\\nThe biggest reason to stay on .NET Framework is when an app isn'\", \"t under active development and wouldn't benefit substantially from the advantages listed above. In t\", \"hat case, there probably isn't a good business case to incur the cost of porting the app. If your ap\", \"p might benefit from the advantages .NET Core offers, you may still need to stay on .NET Framework i\", \"f you need certain technologies that are unavailable on .NET Core. There are some .NET technologies \", \"that are unavailable on .NET Core, including AppDomains, Remoting, Code Access Security (CAS), Secur\", \"ity Transparency, and System.EnterpriseServices. A brief summary of these technologies and their alt\", \"ernatives is included here. For more detailed guidance, see the documentation.\\n\\n## Application domai\", \"ns\\n\\nApplication domains (AppDomains) isolate apps from one another. AppDomains require runtime suppo\", \"rt and can be expensive. Creating additional app domains isn't supported, and there are no plans to \", \"add this capability to .NET Core in the future. For code isolation, use separate processes or contai\", \"ners as an alternative. Some customers use AppDomains as a way of unloading assemblies. In .NET Core\", \" AssemblyLoadContext provides an alternative way to unload assemblies.\\n\\n## WCF\\n\\n.NET Core and .NET 5\", \"+ support WCF clients. Server-side WCF is possible through CoreWCF, which is officially supported by\", \" Microsoft as of April 2022. Apps that require server-side WCF functionality can also consider a dif\", \"ferent communication technology (such as gRPC or REST) as part of a migration.\\n\\nThere is a WCF clien\", \"t port available from the .NET Foundation . It's entirely open source, cross platform, and supported\", \" by Microsoft.\\n\\nTo learn more about migrating from WCF to gRPC, consult the gRPC for WCF Developers \", \"ebook.\\n\\n## Remoting\\n\\n.NET Remoting was identified as a problematic architecture. It's used for cross\", \" -AppDomain communication, which is no longer supported. Also, Remoting requires runtime support, wh\", \"ich is expensive to maintain. For these reasons, .NET Remoting isn't supported on .NET Core, and the\", \" product team doesn't plan on adding support for it in the future. There are several alternative mes\", \"saging strategies and implementations you can use to replace remoting in your .NET Core apps.\\n\\n## Co\", \"de Access Security (CAS) and Security Transparency\\n\\nNeither of these technologies are supported by .\", \"NET Core. Instead, the recommendation is to use security boundaries provided by the operating system\", \". For example, virtualization, containers, or user accounts. Run processes with the minimal set of p\", \"rivileges necessary.\\n\\n## References\\n\\n.NET Framework Technologies Unavailable on .NET Core\\n\\n## Migrat\", \"e to ASP.NET Core 2.1\\n\\nASP.NET Core 2.1 is an interesting release because it's the most recently sup\", \"ported ASP.NET Core release that supported both .NET Core and .NET Framework runtimes. As such, it m\", \"ay offer an easier upgrade path for some apps when compared to upgrading all parts of the app to .NE\", \"T Core/.NET 7 at once. Although support for .NET Core 2.1 ended in August 2021, it may make sense as\", \" an interim step for some apps. Also, support for ASP.NET Core 2.1 running on .NET Framework will co\", \"ntinue for as long as its underlying .NET Framework is supported. A complete list of currently suppo\", \"rted ASP.NET Core 2.1 packages is available for reference.\\n\\n## Should apps run on .NET Framework wit\", \"h ASP.NET Core 2.1\\n\\nASP.NET Core 2.2 and earlier supported both .NET Core and .NET Framework runtime\", \"s. Does it make sense to migrate some or all of an app to ASP.NET Core 2.1 as a stepping stone, befo\", \"re porting over completely to .NET Core? Apps, or subsets of apps, could see their front-end ASP.NET\", \" logic ported to use ASP.NET Core, while still consuming .NET Framework libraries for business logic\", \" and infrastructure consumption. This approach may make sense when there 's a relatively thin UI lay\", \"er without much business logic, and a much larger set of functionality in class libraries.\\n\\nThe main\", \" benefit of porting just the front-end web layer to ASP.NET Core 2.1 is that the existing .NET class\", \" libraries can remain as is during the initial migration. They may be in continued use by other .NET\", \" apps or simply don't need to be in scope for th e first iteration of a planned full migration to .N\", \"ET Core. Reducing the scope of the initial migration for large apps helps provide incremental goals \", \"that act as stepping stones toward the desired end state, which is often a complete port to .NET Cor\", \"e.\\n\\nIf you have an existing app that may use this strategy, some things you can do today to help pre\", \"pare for the process are to move as much business logic, data access, and other non-UI logic out of \", \"the ASP.NET projects and into separate class libraries as possible. It will also help if you have au\", \"tomated\\n\\ntest coverage of your system, so that you can verify behavior remains consistent before and\", \" after the migration.\\n\\nIf your app is so large that you can't migrate the entire web app at once, an\", \"d you need to be able to deploy the new ASP.NET Core app side-by-side with the existing ASP.NET app,\", \" there are deployment strategies that can be used to achieve this. These are covered in Chapter 5: D\", \"eployment Scenarios.\\n\\nKeep in mind that ASP.NET Core 2.1 was the last LTS release of .NET Core that \", \"supported running on .NET Framework and consuming .NET Framework libraries. Although the release is \", \"now unsupported on .NET Core, it continues to be supported for use with .NET Framework. It will rema\", \"in supported for as long as the specific .NET Framework version is supported. For more information, \", \"see ASP.NET Core 2.1 on .NET Framework.\\n\\n## References\\n\\nMigrating from ASP.NET to ASP.NET Core 2.1 A\", \"SP.NET Core 2.1 on .NET Framework ASP.NET Core 2.1 Supported Packages\\n\\n## Choose the right .NET Core\", \" version\\n\\nThe largest consideration for most organizations when choosing which version of .NET to ta\", \"rget is the support lifecycle. Long Term Support (LTS) releases ship less frequently but have a long\", \"er support window than Standard Term Support (STS) releases. Currently, LTS releases are scheduled t\", \"o ship every other year. Customers can choose which releases to target, and can install different re\", \"leases of .NET side by side on the same machine. LTS releases will receive only critical and compati\", \"ble fixes throughout their lifecycle. STS releases will receive these same fixes and will also be up\", \"dated with compatible innovations and features. LTS releases are supported for three years after the\", \"ir initial release. STS releases are supported for six months after a subsequent STS or LTS release.\", \"\\n\\n.NET 7 is the latest STS release; .NET 6 is the latest LTS release.\\n\\nCustomers looking to migrate \", \"a large .NET Framework app to .NET today may be looking for a stable destination, given that they ha\", \"ven't already made the move to an earlier version of .NET Core. In this case, the best .NET version \", \"to target for the migration is .NET 6, which is the most recent LTS version. While support for .NET \", \"Core 3.1 ended in December 2022, support for .NET 6 will continue until November 2024.\\n\\nOther custom\", \"ers may want to ensure they're upgrading to the latest supported version, so that post -migration th\", \"ey're not already behind a version. These customers will want to target .NET 7 for the migration.\\n\\nI\", \"n either case, there is very little difference in the migration process. This book assumes .NET Fram\", \"ework apps will be upgraded to .NET 7.\\n\\n## References\\n\\n.NET and .NET Core Support Policy\\n\\n## Strateg\", \"ies for migrating incrementally\\n\\nThe biggest challenge with migrating any large app is determining h\", \"ow to break the process into smaller tasks. There are several strategies that can be applied for thi\", \"s purpose, including breaking the app into horizontal layers such as UI, data access, business logic\", \", or breaking up the app into separate, smaller apps. Another strategy is to upgrade some or all of \", \"the app to different framework versions on the way to a recent .NET Core release. One approach you c\", \"ould use is to migrate vertical slices of the app, rather than attempting to migrate one horizontal \", \"layer at a time. Let's consider each of these different approaches.\\n\\n## Migrating slice by slice\\n\\nOn\", \"e successful approach to migrating is to identify vertical slices of functionality and migrate them \", \"to the target platform one by one. The first step is to create a new ASP.NET Core 7 app. Next, ident\", \"ify the individual page or API endpoint that will be migrated first. Build out just the necessary fu\", \"nctionality to support this one route in the new ASP.NET Core app. Then use HTTP rewriting and/or a \", \"reverse proxy to start sending requests for these pages or endpoints to the new app rather than the \", \"ASP.NET app. This approach is well-suited to API projects, but can also work for many MVC apps.\\n\\nWhe\", \"n migrating slice by slice, the entire stack of the individual API endpoint or requested route is re\", \"created in the new project or solution. The very first such slice typically requires the most effort\", \", since it will typically need several projects to be created and decisions to be made about data ac\", \"cess and solution organization. Once the first slice's functionality mirrors the existing app's, it \", \"can be deployed and the existing app can redirect to it or simply be removed. This approach is then \", \"repeated until the entire app has been ported to the new structure.\\n\\nSome specific guidance on how t\", \"o follow this strategy using IIS is covered in Chapter 5, Deployment Scenarios.\\n\\n## Migrating layer \", \"by layer\\n\\nConsider the challenge of migrating a large ASP.NET 4.5 app. One approach is to migrate th\", \"e entire app directly from .NET Framework 4.5 to .NET 7. However, this approach needs to account for\", \" every breaking change between the two frameworks and versions, which are substantial. Performing th\", \"is work on one project at a time provides a set of stepping stones so that the entire solution doesn\", \"'t need to be moved at once.\\n\\nOne piece of the .NET ecosystem that helps with interoperability betwe\", \"en different .NET frameworks is .NET Standard. .NET Standard allows libraries to build against an ag\", \"reed upon set of common APIs, ensuring they can be used in any .NET app. .NET Standard 2.0 is notabl\", \"e because it covers most base class library functionality used by most .NET Framework and .NET Core \", \"apps. Unfortunately, the earliest version of .NET with support for .NET Standard 2.0 is .NET Framewo\", \"rk 4.6.1, and there are a number of updates in .NET Framework 4.8 that make it a compelling choice f\", \"or initial upgrades.\\n\\nOne approach to incrementally upgrade a .NET Framework 4.5 system layer-by-lay\", \"er is to first update its class library dependencies to .NET Framework 4.8. Then, modify these libra\", \"ries to be .NET Standard class libraries. Use multi-targeting and conditional compilation, if necess\", \"ary. This step can be helpful\\n\\nin scenarios where app dependencies require .NET Framework and cannot\", \" easily be ported directly to use .NET Standard and .NET Core. Since .NET Framework libraries can be\", \" consumed by ASP.NET Core 2.1 apps, the next step is to migrate some or all of the web functionality\", \" of the app to ASP.NET Core 2.1 (as described in the previous chapter ). This is a 'bottom up' appro\", \"ach, starting with low level class library dependencies and working up to the web app entry point.\\n\\n\", \"Once the app is running on ASP.NET Core 2.1, migrating it to .NET 7 in isolation is relatively strai\", \"ghtforward. The most likely challenge during this step is updating incompatible dependencies to supp\", \"ort .NET Core and possibly higher versions of .NET Stand ard. For apps that don't have problematic d\", \"ependencies on .NET Frameworkonly libraries, there's little reason to upgrade to ASP.NET Core 2.1. P\", \"orting directly to ASP.NET Core 7 makes more sense and requires less effort.\\n\\n.NET 7 is the latest v\", \"ersion of .NET and will be supported until six months after the next STS or LTS release (scheduled f\", \"or November 2023) - so most likely support will last at least until May 2024. Many teams looking to \", \"migrate today will choose to upgrade to .NET 7.\\n\\nInstead of a 'bottom up' approach, another alternat\", \"ive is to start with the web app (or even the entire solution) and use an automated tool to assist w\", \"ith the upgrade. The .NET Upgrade Assistant tool can be used to help upgrade .NET Framework apps to \", \".NET Core / .NET 7. It automates many of the common tasks related to upgrading apps, such as modifyi\", \"ng project file format, setting appropriate target frameworks, updating NuGet dependencies, and more\", \".\\n\\n## References\\n\\n- What is .NET Standard?\\n- Migrate from ASP.NET Core 6.0 to 7.0\\n- Announcing .NET \", \"6 - The Fastest .NET Yet\\n- Introducing .NET 5\\n- Migrate from ASP.NET Core 3.1 to 6.0 LTS\\n- .NET Upgr\", \"ade Assistant tool\\n\\n## Strategies for migrating ASP.NET Web Forms apps\\n\\nThis book offers guidance fo\", \"r migrating large ASP.NET MVC and Web API apps to .NET Core. Some of these ASP.NET apps may also inc\", \"lude Web Forms ( .aspx ) pages that must be addressed. ASP.NET Web Forms isn't supported in ASP.NET \", \"Core (nor are ASP.NET Web Pages). Typically, the functionality of these pages must be rewritten when\", \" porting to ASP.NET Core. There are, however, some strategies you can apply before or during such mi\", \"gration to help reduce the overall effort required.\\n\\nWeb Forms will continue to be supported for qui\", \"te some time. One option may be to keep this functionality in an ASP.NET 4.x app.\\n\\n## Separate busin\", \"ess logic and other concerns\\n\\nThe less code in your ASP.NET Web Forms pages, the better. When possib\", \"le, keep business logic and other concerns like data access in separate classes, ideally in separate\", \" class libraries. These class libraries can be ported to .NET Standard and consumed by any ASP.NET C\", \"ore app.\\n\\n## Implement client behavior and web APIs\\n\\nConsider the choice between implementing logic \", \"in Web Forms or in the browser with the help of API calls. Favor the latter. Migrating APIs to ASP.N\", \"ET Core is supported. Client-side behavior should be independent of the server-side stack your app i\", \"s using. Using this approach has the added benefit of providing a more responsive user experience.\\n\\n\", \"## Consider Blazor\\n\\nBlazor lets you build interactive web UIs with C# instead of JavaScript. It can \", \"run on the server or in the browser using WebAssembly. ASP.NET Web Forms apps may be ported page-by-\", \"page to Blazor apps. For more information on porting Web Forms apps to Blazor, see Blazor for ASP.NE\", \"T Web Forms Developers. In addition, many Web Forms controls have been ported to Blazor as part of a\", \"n opensource community project, Blazor Web Forms Components. With these components, you can more eas\", \"ily port Web Forms pages to Blazor even if they use the built-in Web Forms controls.\\n\\n## Summary\\n\\nMi\", \"grating directly from ASP.NET Web Forms to ASP.NET Core isn't supported. However, there are strategi\", \"es to make moving to ASP.NET Core easier. You can migrate your Web Forms functionality to ASP.NET Co\", \"re successfully by:\\n\\n- Keeping non-web functionality out of your projects.\\n- Using web APIs wherever\", \" possible.\\n- Considering Blazor as an option for a more modern UI.\\n\\n## References\\n\\n- Free e-book: Bl\", \"azor for ASP.NET Web Forms Developers\\n- Blazor Web Forms Components (Community Project)\\n\\n## Deployme\", \"nt strategies\\n\\nOne consideration as you plan the migration of your large ASP.NET app to ASP.NET Core\", \" is how you'll deploy the new app. With ASP.NET, deployment options were limited to IIS on Windows. \", \"With ASP.NET Core, a much wider array of deployment options is available.\\n\\n## Cross-platform options\", \"\\n\\nBecause .NET Core runs on Linux, you'll find some hosting options available that weren't a conside\", \"ration previously. Linux-based hosting may be preferable for the following reasons:\\n\\n- Your organiza\", \"tion has infrastructure or expertise.\\n- Hosting providers offer attractive features or pricing for L\", \"inux-based hosting.\\n\\n.NET Core opens the door to these options.\\n\\n## Cloud native development\\n\\nMost o\", \"rganizations today are using cloud platforms for at least some of their software capabilities. With \", \"an app migration to .NET Core, it's a good time to consider whether the app should be purposefully w\", \"ritten with cloud hosting in mind. Such cloud native apps are better able to apply cloud capabilitie\", \"s like serverless, microservices, and can be less concerned with the low-level details of how and wh\", \"ere they may be deployed.\\n\\nLearn more about cloud native app development in this free e-book, Archit\", \"ecting Cloud Native .NET Applications for Azure.\\n\\n## Leverage containers\\n\\nModern apps often leverage\", \" containers as a means of reducing variation between hosting environments. By deploying an app to a \", \"particular container, the container-hosted app will run the same whether it's running on a developer\", \"'s laptop or in production. As part of a migration to .NET Core, it may make sense to consider wheth\", \"er the app would benefit from deployment via container, either as a full monolith or broken up into \", \"multiple smaller containerized apps.\\n\\n## Side-by-side deployment options\\n\\nMigrating large .NET Frame\", \"work apps to .NET Core often requires a substantial effort. Most organizations will want to be able \", \"to break this effort up in some fashion, so that pieces of the app can be migrated and deployed in p\", \"roduction before the entire migration is complete. Running both the original ASP.NET app and its new\", \"ly-migrated ASP.NET Core sub-app(s) side by side is a frequently cited goal. This can be achieved th\", \"rough a number of mechanisms including leveraging IIS routing, which is covered in chapter 5. Other \", \"options include leveraging app gateways or cloud design patterns like backends for frontends to mana\", \"ge sets of ASP.NET Web APIs and ASP.NET Core API endpoints.\\n\\n## IIS on Windows\\n\\nYou can continue hos\", \"ting your apps on IIS running on Windows. This is a fine option for customers who want to take advan\", \"tage of ASP.NET Core features without changing their current deployment model. While moving to ASP.N\", \"ET Core provides more options in terms of how and where to deploy your apps, it doesn't require that\", \" you change from the status quo of using the proven combination of IIS on Windows.\\n\\n## Other options\", \" on Windows\\n\\nYou can host apps side-by-side apps on Windows using any combination of Kestrel, HTTP.s\", \"ys, and IIS hosts, in addition to Docker containers, if needed. If your app requires a combination o\", \"f Windows and Linux services, hosting on a Windows server with WSL and/or Linux Docker containers pr\", \"ovides a single server solution to hosting all parts of the app.\\n\\n## References\\n\\n- Host and deploy A\", \"SP.NET Core\\n\\n- Host ASP.NET Core on Windows with IIS\\n- Troubleshooting ASP.NET Core on Azure App Ser\", \"vice and IIS\\n\\n## Additional migration resources\\n\\nAs you're planning and executing your migration fro\", \"m ASP.NET MVC and/or Web API to ASP.NET Core, there are a number of resources available to help beyo\", \"nd this book. Make a note of these and leverage them where appropriate to help you overcome obstacle\", \"s you encounter on your migration journey.\\n\\n## Official documentation\\n\\nThe official documentation we\", \"bsite, learn.microsoft.com, has the most up-to-date information available about versions, frameworks\", \", breaking changes, and support options. You'll find many links in this book to docs articles, but f\", \"or any problem you're facing it's often worth at least doing a quick search of the docs to see if th\", \"ere is already information covering the issue and offering a solution or workaround.\\n\\n## GitHub\\n\\nBec\", \"ause .NET Core is an open-source project, many issues are discovered, reported, discussed, and fixed\", \" on GitHub. Microsoft has several GitHub organizations in which you'll find repositories that may be\", \" helpful. A partial list of these organizations and some of their public repositories are listed bel\", \"ow:\\n\\n- Microsoft\\n- -ASP.NET API Versioning\\n- dotnet\\n- -ASP.NET Core\\n- -.NET Runtime\\n- -Entity Framew\", \"ork Core\\n- -C# Language\\n- -Docs\\n- -Docs Samples\\n- -Try Convert\\n- -.NET Upgrade Assistant tool\\n- .NET\", \" Architecture Reference Apps\\n- -eShopModernizing\\n- -eShopOnWeb\\n- -eShopOnContainers\\n\\nIf you run into\", \" problems with your migration, these GitHub repositories are a good place to report them. The produc\", \"t teams watch the issues and typically respond quickly to bug reports (though 'how to' questions may\", \" be more appropriately directed to Stack Overflow).\\n\\n## Stack Overflow\\n\\nStack Overflow has a wealth \", \"of information in the form of previous questions asked and answers given, with the most helpful answ\", \"ers listed first and marked if they solved the problem. In addition to searching for an existing sol\", \"ution to a problem you may encounter, you can of course also ask a question yourself and hope for so\", \"me response from the .NET community. Don't forget you can narrow down a search by using tags, and re\", \"member to use appropriate tags when you ask questions to maximize the chances of someone with the ex\", \"perience needed noticing your question.\\n\\n## YouTube channels\\n\\nYouTube has a huge amount of .NET and \", \".NET Core video content, which may include useful tutorials or walkthroughs covering any scenario yo\", \"u may encounter. Consider searching it separately if your other efforts to find help online come up \", \"short. Here are a few good places to get started:\\n\\n- dotnet\\n- Visual Studio\\n\\n## Twitter, Gitter, Sla\", \"ck, and other community channels\\n\\nYou'll find many other ways to connect with .NET developers on the\", \" .NET Community page. You can also join the DotNetEvolution Discord server. Additionally, many produ\", \"ct teams and team members are on Twitter as well as in various other communities. You can follow and\", \" communicate with the author of this book on Twitter as well.\\n\\n## References\\n\\n- Overview of porting \", \"from .NET Framework to .NET Core\\n- .NET Upgrade Assistant tool\\n- Migrate from ASP.NET to ASP.NET Cor\", \"e\\n- .NET Community Resources\\n\\n## Architectural differences between ASP.NET MVC and ASP.NET Core\\n\\nThe\", \"re are many architectural differences between ASP.NET MVC on .NET Framework and ASP.NET Core. It's i\", \"mportant to have a broad understanding of these differences as teams evaluate the work involved in p\", \"orting their ASP.NET MVC apps to ASP.NET Core. This chapter looks at each of the ways in which ASP.N\", \"ET Core differs substantially from ASP.NET MVC.\\n\\n## Breaking changes\\n\\n.NET Core is a cross-platform \", \"rewrite of .NET Framework. There are many breaking changes between the two frameworks. The following\", \" sections identify specific differences between how ASP.NET MVC and ASP.NET Core apps are designed a\", \"nd developed. Take care to also examine the documentation to determine which framework libraries you\", \"'re using that may need to change. In man y cases, a replacement NuGet package exists to fill in any\", \" gaps left between .NET Framework and .NET Core. In rare cases, you may need to find a third-party s\", \"olution or implement new custom code to address incompatibilities.\\n\\n## App startup differences betwe\", \"en ASP.NET MVC and ASP.NET Core\\n\\nASP.NET MVC apps lived entirely within Internet Information Server \", \"(IIS), the primary web server available on Windows operating systems. Unlike ASP.NET MVC, ASP.NET Co\", \"re apps are executable apps. You can run them from the command line, using dotnet run. They have an \", \"entry point method like all C# programs, typically public static void Main() or a similar variation \", \"(perhaps with arguments or async support). This is perhaps the biggest architectural difference betw\", \"een ASP.NET Core and ASP.NET MVC, and is one of several differences that allows ASP.NET Core to run \", \"on non-Windows systems.\\n\\n## ASP.NET MVC Startup\\n\\nHosted within IIS, ASP.NET apps rely on IIS to inst\", \"antiate certain objects and call certain methods when a request arrives. ASP.NET creates an instance\", \" of the Global.asax file's class, which derives from HttpApplication. When the first request is rece\", \"ived, before handling the request itself, ASP.NET calls the Application_Start method in the Global.a\", \"sax file's class. Any logic that needs to run when the ASP.NET MVC app begins can be added to this m\", \"ethod.\\n\\nMany NuGet packages for ASP.NET MVC and Web API use the WebActivator package to let them run\", \" some code during app startup. By convention, this code would typically be added to an App_Start fol\", \"der and would be configured via attribute to run either immediately before or just after Application\", \"_Start.\\n\\nIt's also possible to use the Open Web Interface for .NET (OWIN) and Project Katana with AS\", \"P.NET MVC. When doing so, the app will include a Startup.cs file that is responsible for setting up \", \"request middleware in a way that's very similar to how ASP.NET Core behaves.\\n\\nIf you need to run cod\", \"e when your ASP.NET MVC app starts up, it will typically use one of these approaches.\\n\\n## ASP.NET Co\", \"re Startup\\n\\nAs noted previously, ASP.NET Core apps are standalone programs. As such, they typically \", \"include a Program.cs file containing the entry point for the app. A typical example of this file is \", \"shown in Figure 2-1. Notice that in .NET 7, this file is streamlined by the use of implicit using st\", \"atements and top-level statements, eliminating the need for a lot of 'boiler plate' code.\\n\\n```\\nvar b\", \"uilder = WebApplication.CreateBuilder(args); // Add services to the container. builder.Services.AddR\", \"azorPages(); var app = builder.Build(); // Configure the HTTP request pipeline. if (!app.Environment\", \".IsDevelopment()) { app.UseExceptionHandler(\\\"/Error\\\"); // The default HSTS value is 30 days. You may\", \" want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts. app.UseHsts(); } \", \"app.UseHttpsRedirection(); app.UseStaticFiles(); app.UseRouting(); app.UseAuthorization(); app.MapRa\", \"zorPages(); app.Run();\\n```\\n\\nFigure 2-1. A typical ASP.NET Core Program.cs file.\\n\\nThe code shown in F\", \"igure 2-1 uses a builder to configure the host and its services. Then, it creates the request pipeli\", \"ne for the app, which controls how every request to the app is handled.\\n\\nPrevious versions of .NET w\", \"ould use a separate Startup.cs file, referenced by Program.cs . This approach is still supported in \", \".NET 7, but is no longer the default approach.\\n\\nIn addition to code related to configuring the app's\", \" services and request pipeline, apps may have other code that must run when the app begins. Such cod\", \"e is typically placed in Program.cs or registered as an IHostedService, which will be started by the\", \" generic host when the app starts.\\n\\nThe IHostedService interface just exposes two methods, StartAsyn\", \"c and StopAsync. You register the interface when configuring the app's services and the host does th\", \"e rest, calling the StartAsync method before the app starts up.\\n\\n## Porting considerations\\n\\nTeams lo\", \"oking to migrate their apps from ASP.NET MVC to ASP.NET Core need to identify what code is being run\", \" when their app starts up and determine the appropriate location for such code in their ASP.NET Core\", \" app. For custom code needed to run when the app starts up, especially async code, the recommended a\", \"pproach is typically to put such code into IHostedService implementations.\\n\\n## References\\n\\n- ASP.NET\", \" Application Life Cycle Overview for IIS 7\\n- ASP.NET Application Life Cycle Overview for IIS 5 and 6\", \"\\n- Getting Started with OWIN and Katana\\n- WebActivator\\n- App Startup in ASP.NET Core\\n- .NET Generic \", \"Host in ASP.NET Core\\n- IHostedService\\n\\n## Hosting differences between ASP.NET MVC and ASP.NET Core\\n\\n\", \"ASP.NET MVC apps are hosted in IIS, and may rely on IIS configuration for their behavior. This often\", \" includes IIS modules. As part of reviewing an app to prepare to port it from ASP.NET MVC to ASP.NET\", \" Core, teams should identify which modules, if any, they're using from the list of IIS Modules insta\", \"lled on their server.\\n\\nASP.NET Core apps can run on a number of different servers. The default cross\", \" platform server, Kestrel, is a good default choice. Apps running in Kestrel can be hosted by IIS, r\", \"unning in a separate process. On Windows, apps can also run in process on IIS or using HTTP.sys. Kes\", \"trel is generally recommended for best performance. HTTP.sys can be used in scenarios where the app \", \"is exposed to the Internet and required capabilities are supported by HTTP.sys but not Kestrel.\\n\\nKes\", \"trel does not have an equivalent to IIS modules (though apps hosted in IIS can still take advantage \", \"of IIS modules). To achieve equivalent behavior, middleware configured in the ASP.NET Core app itsel\", \"f is typically used.\\n\\n## References\\n\\n- IIS Modules\\n- ASP.NET Core Middleware\\n- ASP.NET Core Servers\\n\", \"\\n## Serve static files in ASP.NET MVC and ASP.NET Core\\n\\nMost web apps involve a combination of serve\", \"r-side logic and static files that must be sent to the client as-is. How should your migration from \", \"ASP.NET MVC to ASP.NET Core handle serving static files?\\n\\n## Host static files in ASP.NET MVC\\n\\nASP.N\", \"ET MVC apps, hosted by IIS, typically host static files directly from the app. ASP.NET MVC supports \", \"placing static files side by side with files that should be kept private on the server. IIS and ASP.\", \"NET require explicitly restricting certain files or file extensions from being served from the folde\", \"r in which an ASP.NET app is hosted.\\n\\nFor many static files, using a content delivery network (CDN) \", \"is a good practice. Static content hosting allows better performance while reducing load and bandwid\", \"th from app servers.\\n\\n## Host static files in ASP.NET Core\\n\\nIt may be surprising, but ASP.NET Core d\", \"oesn't have built -in support for static files. This feature that has always existed as just a part \", \"of ASP.NET, enabled by IIS, isn't intrinsic to ASP.NET Core or its Kestrel web server. To serve stat\", \"ic files from an ASP.NET Core app, you must configure static files middleware.\\n\\nWith static files mi\", \"ddleware configured, an ASP.NET Core app will serve all files located in a certain folder (typically\", \" /wwwroot ). No other files in the app or project folder are at risk of being accidentally exposed b\", \"y the server. No special restrictions based on file names or extensions need to be configured, as is\", \" the case with IIS. Instead, developers explicitly choose to expose files publicly when they place t\", \"hem in the wwwroot folder. By default, files outside of this folder aren't shared.\\n\\nBecause support \", \"for static files uses middleware, any other middleware can be applied as part of the same request pi\", \"peline. Examples of middleware include authentication, caching, and compression.\\n\\nOf course, CDNs re\", \"main a good choice for ASP.NET Core apps for all the same reasons they're used in ASP.NET MVC apps. \", \"As part of preparing to migrate to .NET Core, if there are benefits your app could realize from usin\", \"g a CDN, it would be good to move static files to a CDN before migrating to .NET Core. Doing so redu\", \"ces the migration effort's overall scope for static assets.\\n\\n## References\\n\\n- Static content hosting\", \"\\n- Static files in ASP.NET Core\\n\\n## Dependency injection differences between ASP.NET MVC and ASP.NET\", \" Core\\n\\nAlthough dependency injection (DI) isn't built into ASP.NET MVC or Web API, many apps enable \", \"it by adding a NuGet package with an inversion of control (IOC) container. These are sometimes refer\", \"red to as DI containers, for dependency injection (or inversion). Some of the most popular container\", \"s used in ASP.NET MVC apps include:\\n\\n- Autofac\\n- Unity\\n- Ninject\\n- StructureMap (deprecated)\\n- Castl\", \"e Windsor\\n\\nIf your ASP.NET MVC app isn't using DI, you will probably want to investigate the built -\", \"in support for DI in ASP.NET Core. DI promotes loose coupling of modules in your app and enables bet\", \"ter testability and adherence to principles like SOLID.\\n\\nIf your app does use DI, then probably your\", \" best course of action is to see if the container you're using supports ASP.NET Core. If so, you may\", \" be able to continue using it and your custom configuration rules describing your type mappings and \", \"lifetimes.\\n\\nEither way, you should consider using the built-in support for DI that ships with ASP.NE\", \"T Core, as it may meet your app's needs.\\n\\n## Dependency injection in ASP.NET Core\\n\\nASP.NET Core assu\", \"mes apps will use DI. It's not just built into the framework, but is required in order to bring supp\", \"ort for framework features into your ASP.NET Core apps. In app startup, calls are made to configure \", \"services using the builder.Services property of the web host builder. This property works with the a\", \"pplication's DI container (service collection/service provider) and is used to create and inject ser\", \"vice dependencies within the app. Built-in ASP.NET Core features like Entity Framework Core, Identit\", \"y, and even MVC are brought into the app by configuring them as services during application startup.\", \"\\n\\nIn addition to using the default implementation, apps can still use custom containers. The documen\", \"tation covers how to replace the default service container.\\n\\nDI is fundamental to ASP.NET Core. If y\", \"our team isn't already wellversed in this practice, you'll want to understand it before porting your\", \" app.\\n\\n## References\\n\\n- Dependency Injection in .NET\\n- Dependency Injection in ASP.NET Core\\n\\n## Comp\", \"are middleware to modules and handlers\\n\\nIf your existing ASP.NET MVC or Web API app uses OWIN/Katana\", \", you're most likely already familiar with the concept of middleware and porting it to ASP.NET Core \", \"should be fairly straightforward. However, most ASP.NET apps rely on HTTP modules and HTTP handlers \", \"instead of middleware. Migrating these to ASP.NET Core requires extra effort.\\n\\n## ASP.NET modules an\", \"d handlers\\n\\nHTTP modules and HTTP handlers are an integral part of the ASP.NET architecture. While a\", \" request is being processed, each request is processed by multiple HTTP modules (for example, the au\", \"thentication module and the session module) and is then processed by a single HTTP handler. After th\", \"e handler has processed the request, the request flows back through the HTTP modules.\\n\\nIf your app i\", \"s using custom HTTP modules or HTTP handlers, you'll need a plan to migrate them to ASP.NET Core. Th\", \"e most likely replacement in ASP.NET Core is middleware.\\n\\n## ASP.NET Core middleware\\n\\nASP.NET Core d\", \"efines a request pipeline in each app's Configure method. This request pipeline defines how an incom\", \"ing request is handled by the app, with each method in the pipeline calling the next method until ev\", \"entually a method terminates, and the chain of middleware terminates and returns back up the stack. \", \"Middleware can target all requests, or can be configured to only map to certain requests based on th\", \"e requested path or other factors. It can be configured wholly in the Configure method of an app, or\", \" implemented in a separate class.\\n\\nBehavior in an ASP.NET MVC app that uses HTTP modules is probably\", \" best suited to custom middleware. Custom HTTP handlers can be replaced with custom routes or endpoi\", \"nts that respond to the same path.\\n\\n## Accessing HttpContext\\n\\nMany .NET apps reference the current r\", \"equest's context through HttpContext.Current. This static access can be a common source of problems \", \"with testing and other code usage outside of individual requests. When building ASP.NET Core apps, a\", \"ccess to the current HttpContext should be provided as a method parameter on middleware, as this sam\", \"ple demonstrates:\\n\\n```\\npublic class Middleware { private readonly RequestDelegate _next; public Midd\", \"leware(RequestDelegate next) { _next = next;\\n```\\n\\n```\\n} public Task Invoke(HttpContext httpContext) \", \"{ return _next(httpContext); } }\\n```\\n\\nSimilarly, ASP.NET Core filters pass a context argument to the\", \"ir methods, from which the current HttpContext can be accessed:\\n\\n```\\npublic class MyActionFilterAttr\", \"ibute : ActionFilterAttribute { public override void OnResultExecuting(ResultExecutingContext contex\", \"t) { var headers = context.HttpContext.Request.Headers; // do something based on a header base .OnRe\", \"sultExecuting(context); } }\\n```\\n\\nIf you have components or services that require access to HttpConte\", \"xt, rather than using a static call like HttpContext.Current you should instead use constructor depe\", \"ndency injection and the IHttpContextAccessor interface:\\n\\n```\\npublic class MyService { private reado\", \"nly IHttpContextAccessor _httpContextAccessor; public MyService(IHttpContextAccessor httpContextAcce\", \"ssor) { _httpContextAccessor = httpContextAccessor; } public void DoSomething() { var currentContext\", \" = _httpContextAccessor.HttpContext; } }\\n```\\n\\nThis approach eliminates the static coupling of the me\", \"thod to the current context while providing access in a testable fashion.\\n\\n## References\\n\\n- ASP.NET \", \"HTTP modules and HTTP handlers\\n- ASP.NET Core middleware\\n\\n## Configuration differences between ASP.N\", \"ET MVC and ASP.NET Core\\n\\nHow configuration values are stored and read changed dramatically between A\", \"SP.NET and ASP.NET Core.\\n\\n## ASP.NET MVC configuration\\n\\nIn ASP.NET apps, configuration uses the buil\", \"t-in .NET configuration files, web.config in the app folder and machine.config on the server. Most A\", \"SP.NET MVC and Web API apps store their settings in the configuration file's appSettings or connecti\", \"onStrings elements. Some also use custom configuration sections that can be mapped to a settings cla\", \"ss.\\n\\nConfiguration in a .NET Framework app is accessed using the\\n\\nSystem.Configuration.Configuration\", \"Manager class. Unfortunately, this class provides static access to the configuration elements. As a \", \"result, very few ASP.NET MVC apps tend to abstract access to their configuration settings or inject \", \"them where needed. Instead, most .NET Framework apps tend to directly access the configuration syste\", \"m anywhere the app needs to use a setting.\\n\\nTypical ASP.NET MVC configuration access:\\n\\n```\\nstring co\", \"nnectionString = ConfigurationManager.ConnectionStrings[\\\"DefaultConnection\\\"] .ConnectionString;\\n```\\n\", \"\\n## ASP.NET Core configuration\\n\\nIn ASP.NET Core apps, configuration is, itself, configurable. Howeve\", \"r, most apps use a set of defaults provided as part of the standard project templates and the Config\", \"ureWebHostDefaults method used in them. The default settings use JSON formatted files, with the abil\", \"ity to override settings in the base appsettings.json file with environment-specific files like apps\", \"ettings.Development.json . Additionally, the default configuration system further overrides all file\", \"-based settings with any environment variable that exists for the same named setting. This is useful\", \" in many scenarios and is especially useful when deploying to a hosting environment, since it elimin\", \"ates the need to worry about whether deploying configuration files will accidentally overwrite impor\", \"tant production configuration settings. Configuration values can also be provided as command line ar\", \"guments.\\n\\nAccessing configuration values can be done in many ways in .NET Core. Because dependency i\", \"njection is built into .NET Core, configuration values are generally accessed through an interface t\", \"hat is injected into classes that need them. This can involve passing a interface like IConfiguratio\", \"n, but usually it's better to pass just the settings required by the class using the options pattern\", \".\\n\\nFigure 2-2 shows how to pass IConfiguration into a Razor Page and access configuration settings f\", \"rom it:\\n\\n```\\nusing Microsoft.Extensions.Configuration; public class TestModel : PageModel { private \", \"readonly IConfiguration _configuration; public TestModel(IConfiguration configuration) { _configurat\", \"ion= configuration; } public ContentResult OnGet() {\\n```\\n\\n```\\nvar myKeyValue = _configuration[\\\"MyKey\", \"\\\"]; // ... } }\\n```\\n\\nFigure 2-2. Accessing configuration values with IConfiguration.\\n\\nUsing the optio\", \"ns pattern, settings access is similar but is strongly typed and more specific to the setting(s) nee\", \"ded by the consuming class, as Figure 2-3 demonstrates.\\n\\n```\\npublic class PositionOptions { public c\", \"onst string Position = nameof(Position); public string Title { get ; set ; } public string Name { ge\", \"t ; set ; } } public class Test2Model : PageModel { private readonly PositionOptions _options; publi\", \"c Test2Model(IOptions<PositionOptions> options) { _options = options.Value; } public ContentResult O\", \"nGet() { return Content($\\\"Title: {_options.Title}\\\\nName: {_options.Name}\\\"); } }\\n```\\n\\nFigure 2-3. Usi\", \"ng the options pattern in ASP.NET Core.\\n\\nFor the options pattern to work, the options type must be c\", \"onfigured in ConfigureServices when the app starts up:\\n\\n```\\n// required in ConfigureServices service\", \"s.Configure<PositionOptions>(Configuration.GetSection(PositionOptions.Position));\\n```\\n\\n## Migrate co\", \"nfiguration\\n\\nWhen considering how to port an app's configuration settings from .NET Framework to .NE\", \"T Core, the first step is to identify all of the configuration settings that are being used. Most of\", \" these will be in the web.config file in the app's root folder, but some apps expect settings to be \", \"found in the shared machine.config file as well. These settings will include elements of the appSett\", \"ings element, the connectionStrings element, and any custom configuration elements as well. In .NET \", \"Core, all of these settings are typically stored in the appsettings.json file.\\n\\nOnce all settings in\", \" the config files have been cataloged, the next step should be to identify where and how the setting\", \"s are used in the app itself. If some settings aren't being used, these can probably be omitted from\", \" the migration. For each setting, no te all of the places it's being used so you can be sure you don\", \"'t miss any when you migrate the code.\\n\\nIf you're still maintaining the ASP.NET app, it may be helpf\", \"ul to avoid static references to ConfigurationManager and replace them with access through interface\", \"s. This will ease the transition to ASP.NET Core's configuration system. In general, static acce ss \", \"to external resources makes code harder to test and maintain, so be on the lookout for anywhere else\", \" the app may be following this pattern.\\n\\n## References\\n\\n- Configuration in ASP.NET Core\\n- Options pa\", \"ttern in ASP.NET Core\\n- Migrate configuration to ASP.NET Core\\n- Refactoring Static Config Access\\n\\n##\", \" Routing differences between ASP.NET MVC and ASP.NET Core\\n\\nRouting is responsible for mapping incomi\", \"ng browser requests to particular controller actions (or Razor Pages handlers). This section covers \", \"how routing differs between ASP.NET MVC (and Web API) and ASP.NET Core (MVC, Razor Pages, and otherw\", \"ise).\\n\\n## Routing in ASP.NET MVC and Web API\\n\\nASP.NET MVC offers two approaches to routing:\\n\\n1. The \", \"route table, which is a collection of routes that can be used to match incoming requests to controll\", \"er actions.\\n2. Attribute routing, which performs the same function but is achieved by decorating the\", \" actions themselves, rather than editing a global route table.\\n\\n## Route table\\n\\nThe route table is c\", \"onfigured when the app starts up. Typically, a static method call is used to configure the global ro\", \"ute collection, like so:\\n\\n```\\npublic class MvcApplication : System.Web.HttpApplication { public stat\", \"ic void RegisterRoutes(RouteCollection routes) { routes.IgnoreRoute(\\\"{resource}.axd/{*pathInfo}\\\"); r\", \"outes.MapRoute( name: \\\"Default\\\", url: \\\"{controller}/{action}/{id}\\\", defaults: new { controller = \\\"Ho\", \"me\\\", action = \\\"Index\\\", id = \\\"\\\" }, constraints: new { id = \\\"\\\\\\\\d+\\\" } ); } protected void Application_S\", \"tart() {\\n```\\n\\n```\\nRegisterRoutes(RouteTable.Routes); } }\\n```\\n\\nIn the preceding code, the route table\", \" is managed by the RouteCollection type, which is used to add new routes with MapRoute. Routes are n\", \"amed and include a route string, which can include parameters for controllers, actions, areas, and o\", \"ther placeholders. If an app follows a standard convention, most of its actions can be handled by th\", \"is single default route, with any exceptions to this convention configured using additional routes.\\n\", \"\\n## Attribute routing in ASP.NET MVC\\n\\nRoutes that are defined with their actions may be easier to di\", \"scover and reason about than routes defined in an external location. Using attribute routing, an ind\", \"ividual action method can have its route defined with a [Route] attribute:\\n\\n```\\npublic class Product\", \"sController { [Route(\\\"products\\\")] public ActionResult Index() { return View(); } [Route(\\\"products/{i\", \"d}\\\")] public ActionResult Details(int id) { return View(); } }\\n```\\n\\nAttribute routing in ASP.NET MVC\", \" 5 also supports defaults and prefixes, which can be added at the controller level (and which are ap\", \"plied to all actions within that controller). Refer to the documentation for details.\\n\\nSetting up at\", \"tribute routing requires adding one line to the default route table configuration:\\n\\n```\\nroutes.MapMv\", \"cAttributeRoutes();\\n```\\n\\nAttribute routing can take advantage of route constraints, both built-in an\", \"d custom, and supports named routes and areas using the [RouteArea] attribute. If your app uses area\", \"s, you'll need to configure support for them in your route registration code by adding one more line\", \":\\n\\n```\\nroutes.MapMvcAttributeRoutes(); AreaRegistration.RegisterAllAreas();\\n```\\n\\n## Attribute routin\", \"g in ASP.NET Web API 2\\n\\nAttribute routing in ASP.NET Web API 2 is similar to routing in ASP.NET MVC \", \"5, with minor differences. Configuring Web API 2 is typically done in its own class, which is called\", \" during app startup. Attribute routing configuration is handled in this class:\\n\\n```\\npublic static cl\", \"ass WebApiConfig {\\n```\\n\\n```\\npublic static void Register(HttpConfiguration config) { // Attribute rou\", \"ting. config.MapHttpAttributeRoutes(); // Convention-based routing. config.Routes.MapHttpRoute( name\", \": \\\"DefaultApi\\\", routeTemplate: \\\"api/{controller}/{id}\\\", defaults: new { id = RouteParameter.Optional\", \" } ); } }\\n```\\n\\nAs shown in the preceding code, attribute routing may be combined with convention-bas\", \"ed routing in Web API apps.\\n\\nIn addition to attribute routing, ASP.NET Web API chooses which action \", \"to call based on the HTTP method (for example, GET or POST), the {action} placeholder in a route (if\", \" any), and parameters of the action. In many cases, the name of the action will help determine wheth\", \"er it's matched, since prefixing the action name with 'Get' or 'Post' is used to match the appropria\", \"te HTTP method to it. Alternatively, actions can be decorated with an appropriate HTTP method attrib\", \"ute, like [HttpGet], allowing the use of action names that aren't prefixed with an HTTP method.\\n\\n```\", \"\\npublic class ProductsController : ApiController { // matched by name and (lack of) parameters publi\", \"c IEnumerable<Product> GetAll() { } // matched by GET and string parameter [HttpGet] public IEnumera\", \"ble<Product> FindProductsByName(string name) { } }\\n```\\n\\nGiven the above controller, an HTTP GET requ\", \"est to localhost:123/products/ matches the GetAll action. An HTTP GET request to localhost:123/produ\", \"cts?name=ardalis matches the FindProductsByName action.\\n\\n## Routing in .NET 7\\n\\nIn ASP.NET Core, rout\", \"ing is handled by routing middleware, which matches the URLs of incoming requests to actions or othe\", \"r endpoints. Controller actions are either conventionally routed or attribute-routed. Conventional r\", \"outing is similar to the route table approach used in ASP.NET MVC and Web API. Whether you're using \", \"conventional, attribute, or both, you need to configure your app to use the routing middleware. To u\", \"se the middleware, add the following code to your Program.cs file:\\n\\napp.UseRouting();\\n\\n## Convention\", \"al routing\\n\\nWith conventional routing, you set up one or more conventions that will be used to match\", \" incoming URLs to endpoints in the app. In ASP.NET Core, these endpoints may be controller actions, \", \"like in ASP.NET MVC or Web API. The endpoints could also be Razor Pages, Health Checks, or SignalR h\", \"ubs. All of these routable features are configured in a similar fashion using endpoints:\\n\\n```\\napp.Us\", \"eEndpoints(endpoints => { endpoints.MapHealthChecks(\\\"/healthz\\\").RequireAuthorization(); endpoints.Ma\", \"pControllerRoute( name: \\\"default\\\", pattern: \\\"{controller=Home}/{action=Index}/{id?}\\\"); endpoints.Map\", \"RazorPages(); });\\n```\\n\\nThe preceding code is used (in addition to UseRouting) to configure various e\", \"ndpoints, including Health Checks, controllers, and Razor Pages. For controllers, the above configur\", \"ation specifies a default routing convention, which is the fairly standard {control ler}/{action}/{i\", \"d?} pattern that's been recommended since the first versions of ASP.NET MVC.\\n\\n## Attribute routing\\n\\n\", \"Attribute routing in ASP.NET Core is the preferred approach for configuring routing in controllers. \", \"If you're building APIs, the [ApiController] attribute should be applied to your controllers. Among \", \"other things, this attribute requires the use of attribute routing for actions in such controller cl\", \"asses.\\n\\nAttribute routing in ASP.NET Core behaves similarly in ASP.NET MVC and Web API. In addition \", \"to supporting the [Route] attribute, however, route information can also be specified as part of the\", \" HTTP method attribute:\\n\\n```\\n[HttpGet(\\\"api/products/{id}\\\")] public async ActionResult<Product> Detai\", \"ls(int id) { // ... }\\n```\\n\\nAs with previous versions, you can specify a default route with placehold\", \"ers, and add this at the controller class level or even on a base class. You use the same [Route] at\", \"tribute for all of these cases. For example, a base API controller class might look like this:\\n\\n```\\n\", \"[Route(\\\"api/{controller}/{action}/{id?:int}\\\")] public abstract class BaseApiController : ControllerB\", \"ase, IApiController { // ... }\\n```\\n\\nUsing this attribute, classes inheriting from this type would ro\", \"ute URLs to actions based on the controller name, action name, and an optional integer id parameter.\", \"\\n\\n## References\\n\\n- ASP.NET MVC Routing Overview\\n- Attribute Routing in ASP.NET MVC 5\\n- Attribute rou\", \"ting in ASP.NET Web API 2\\n- Routing and Action Selection in ASP.NET Web API\\n- Routing in ASP.NET Cor\", \"e\\n- Routing to controller actions in ASP.NET Core MVC\\n\\n## Logging differences between ASP.NET MVC an\", \"d ASP.NET Core\\n\\nApplication logging provides important diagnostic information, especially for apps r\", \"unning in production. ASP.NET Core introduces a new system for adding standardized logging to any ap\", \"p. Existing ASP.NET MVC and Web API apps most likely use third-party logging solutions, which likely\", \" continue to be supported on ASP.NET Core.\\n\\n## ASP.NET MVC logging\\n\\nThere's no built -in logging sol\", \"ution in ASP.NET MVC and Web API apps. Instead, most apps use thirdparty logging solutions like log4\", \"net, NLog, or Serilog. Many teams also choose to roll their own logging solution. Logging frameworks\", \" typically support multiple 'sinks' (or targets or appenders) for log output, such as text files, da\", \"tabases, or even emails. They use configuration to determine which levels of log messages from which\", \" parts of the system are routed to different sinks. When considering how to migrate an app's logging\", \" to .NET Core, review how logging is performed and configured in the app.\\n\\n## ASP.NET Core logging\\n\\n\", \"In ASP.NET Core, logging is a built-in feature that can be configured and extended when the app star\", \"ts up. Third-party loggers, including those mentioned above, can be integrated with ASP.NET Core to \", \"enhance its functionality.\\n\\nASP.NET Core logging uses categories and levels to control what is logge\", \"d and how. Classes typically use instances of the ILogger&lt;T&gt; interface, with the class's type \", \"used as the generic T type. In this scenario, the class's fully qualified name is used as the catego\", \"ry. Loggers can also be created with a custom category using an ILoggerFactory. Log levels range fro\", \"m the most detailed, Trace, to the most important, Critical. Using configuration, apps can specify w\", \"hat minimum level of logging should be included on a per-category (with wildcards) basis.\\n\\nA typical\", \" logging configuration could log Information and above information by default, but only Warning or a\", \"bove from Microsoft-prefixed categories:\\n\\n```\\n{ \\\"Logging\\\": { \\\"LogLevel\\\": { \\\"Default\\\": \\\"Information\\\",\", \" \\\"Microsoft\\\": \\\"Warning\\\" } } }\\n```\\n\\nSupport for logging in ASP.NET Core is extensive and flexible. Fo\", \"r more detailed information, refer to the docs.\\n\\n## Migrate logging\\n\\nHow you migrate your .NET Frame\", \"work app's logging to .NET Core depends on how the app is logging now. If it's using a third -party \", \"NuGet package, refer to the upgrade documentation for that package. Most likely the upgrade path wil\", \"l be fairly straightforwar d. If you're using your own logging solution, take one of the following a\", \"ctions:\\n\\n1. Migrate the logging solution yourself\\n2. Migrate to a third-party logging solution\\n3. Us\", \"e the built-in logging support in ASP.NET Core\\n\\nYou can reference the Microsoft.Extensions.Logging p\", \"ackage from .NET Framework apps as long as they're using NuGet 4.3 or later and are on .NET Framewor\", \"k 4.6.1 or later. Once your app has referenced this package, you can convert your logging statements\", \" to use the new extensions before migrating the app to .NET Core. This can provide a stepping stone \", \"toward full migration, since the app can continue running on .NET Framework while logging using the \", \"newer extensions package.\\n\\n## References\\n\\n- Logging in .NET Core and ASP.NET Core\\n- Microsoft.Extens\", \"ions.Logging NuGet Package\\n\\n## Compare Razor Pages to ASP.NET MVC\\n\\nRazor Pages is the preferred way \", \"to create page- or form-based apps in ASP.NET Core. From the docs, 'Razor Pages can make coding page\", \" -focused scenarios easier and more productive than using controllers and views.' If your ASP.NET MV\", \"C app makes heavy use of views, you may want to consider migrating from actions and views to Razor P\", \"ages.\\n\\nA typical strongly typed view-based MVC app will use a controller to contain one or more acti\", \"ons. The controller will interact with the domain or data model, and create an instance of a viewmod\", \"el class. Then this viewmodel class is passed to the view associated with that action. Using this ap\", \"proach, coupled with the default folder structure of MVC apps, to add a new page to an app requires \", \"modifying a controller in one folder, a view in a nested subfolder in another folder, and a viewmode\", \"l in yet another folder.\\n\\nRazor Pages group together the action (now a handler ) and the viewmodel (\", \"called a PageModel ) in one class, and link this class to the view (called a Razor Page). All Razor \", \"Pages go into a Pages folder in the root of the ASP.NET Core project. Razor Pages use a routing conv\", \"ention based on their name and location within this folder. Handlers behave exactly like action meth\", \"ods but have the HTTP verb they handle in their name (for example, OnGet). Th ey also don't necessar\", \"ily need to return, since by default they 're assumed to return the page they're associated with. Th\", \"is tends to keep Razor Pages and their handlers smaller and more focused while at the same time maki\", \"ng it easier to find and work with all of the files needed to add or modify a particular part of an \", \"app.\\n\\nAs part of a move from ASP.NET MVC to ASP.NET Core, teams should consider whether they want to\", \" migrate controllers and views to ASP.NET Core controllers and views, or to Razor Pages. The former\\n\", \"\\nwill most likely require slightly less overall effort, but won't allow the team to take advantage o\", \"f the benefits of Razor Pages over traditional view-based file organization.\\n\\n## References\\n\\n- Intro\", \"duction to Razor Pages in ASP.NET Core\\n- Simpler ASP.NET Core Apps with Razor Pages\\n\\n## Compare ASP.\", \"NET Web API 2 and ASP.NET Core\\n\\nASP.NET Core offers iterative improvements to ASP.NET Web API 2, but\", \" should feel familiar to developers who have used Web API 2. ASP.NET Web API 2 was developed and shi\", \"pped alongside ASP.NET MVC. This meant the two approaches had similar-but-different approaches to th\", \"ings like attribute routing and dependency injection. In ASP.NET Core, there's no longer any distinc\", \"tion between MVC and Web APIs. There's only ASP.NET Core, which includes support for view-based scen\", \"arios, API endpoints, Razor Pages, health checks, SignalR, and more.\\n\\nIn addition to being consisten\", \"t and unified within ASP.NET Core, APIs built in .NET Core are much easier to test than those built \", \"on ASP.NET Web API 2. We'll cover testing differences in more detail in a moment. The built-in suppo\", \"rt for hosting ASP.NET Core apps, in a test host that can create an HttpClient that makes in-memory \", \"requests to the app, is a huge benefit when it comes to automated testing.\\n\\nSee Incremental ASP.NET \", \"to ASP.NET Core migration for an incremental approach to migrating to ASP.NET Core.\\n\\n## References\\n\\n\", \"- Migrate from ASP.NET Web API to ASP.NET Core\\n- Ardalis.ApiEndpoints NuGet package\\n\\n## Compare auth\", \"entication and authorization between ASP.NET MVC and ASP.NET Core\\n\\nIn ASP.NET MVC 5, authentication \", \"is configured in Startup.Auth.cs in the App_Start folder. In ASP.NET Core MVC, this configuration oc\", \"curs in Startup.cs or Program.cs , as part of configuring the app's services and middleware.\\n\\nAuthen\", \"tication and authorization are performed using middleware added to the request pipeline:\\n\\n```\\napp.Us\", \"eRouting(); app.UseAuthentication(); app.UseAuthorization(); app.UseEndpoints(endpoints => {\\n```\\n\\n``\", \"`\\nendpoints.MapControllerRoute( name: \\\"default\\\", pattern: \\\"{controller=Home}/{action=Index}/{id?}\\\");\", \" endpoints.MapRazorPages(); });\\n```\\n\\nIt's important to add the auth middleware in the appropriate or\", \"der in the middleware pipeline. Only requests that make it to the middleware will be impacted by it.\", \" For instance, if a call to UseStaticFiles() were placed above the code shown here, it wouldn't be p\", \"rotected by authentication and authorization.\\n\\nIn ASP.NET MVC and Web API, apps often refer to the c\", \"urrent user using the ClaimsPrincipal.Current property. This property isn't set in ASP.NET Core, and\", \" any behavior in your app that depends on it will need to migrate from ClaimsPrincipal.Current by us\", \"ing the User property on ControllerBase or getting access to the current HttpContext and referencing\", \" its User property. If neither of these solutions is an option, services can request the User as an \", \"argument, in which case it must be supplied from elsewhere in the app, or the IHttpContextAccessor c\", \"an be requested and used to get the HttpContext.\\n\\n## Authorization\\n\\nAuthorization defines what a giv\", \"en user can do within the app. It's separate from authentication, which is concerned merely with ide\", \"ntifying who the user is. ASP.NET Core provides a simple, declarative role and a rich, policy-based \", \"model for authorization. Specifying that a resource requires authorization is often as simple as add\", \"ing the [Authorize] attribute to the action or controller. If you're migrating to Razor Pages from M\", \"VC views, you should specify conventions for authorization when you configure Razor Pages.\\n\\nAuthoriz\", \"ation in ASP.NET Core may be as simple as prohibiting anonymous users while allowing authenticated u\", \"sers. Or it can scale up to support role-based, claims-based, or policy-based authorization approach\", \"es. For more information on these approaches, see the documentation on authorization in ASP.NET Core\", \" . You'll likely find that one of them is closely aligned with your current authorization approach.\\n\", \"\\n## References\\n\\n- Security, Authentication, and Authorization with ASP.NET MVC\\n- Migrate Authenticat\", \"ion and Identity to ASP.NET Core\\n- Migrate from ClaimsPrincipal.Current\\n- Introduction to Authorizat\", \"ion in ASP.NET Core\\n\\n## Compare ASP.NET Identity and ASP.NET Core Identity\\n\\nIn ASP.NET MVC, identity\", \" features are typically configured in IdentityConfig.cs in the App_Start folder. Review how this is \", \"configured in the existing app, and compare it to the configuration required for ASP.NET Core Identi\", \"ty in Program.cs .\\n\\nASP.NET Identity is an API that supports user interface login functionality and \", \"manages users, passwords, profile data, roles, claims, tokens, email confirmations, and more. It sup\", \"ports external login providers like Facebook, Google, Microsoft, and Twitter.\\n\\nIf your ASP.NET MVC a\", \"pp is using ASP.NET Membership, you'll find a guide to migrate from ASP.NET Membership authenticatio\", \"n to ASP.NET Core 2.0 Identity. This is mainly a data migration exercise, at the completion of which\", \" you should be able to use ASP.NET Core Identity with your migrated user records.\\n\\nIf you migrate yo\", \"ur ASP.NET Identity users to ASP.NET Core Identity, you may need to update their password hashes, or\", \" track which passwords are hashed with the new ASP.NET Core Identity approach or the older ASP.NET I\", \"dentity approach. This approach described on Stack Overflow provides some options for migrating user\", \" password hashes over time, rather than all at once.\\n\\nOne of the biggest differences when it comes t\", \"o ASP.NET Core Identity compared to ASP.NET Identity is how little code you need to include in your \", \"project. ASP.NET Core Identity now ships as a Razor Class Library, meaning its UI and logic are all \", \"available from a NuGet package. You can override the existing UI and logic by scaffolding the ASP.NE\", \"T Core Identity files but even in this case you need only scaffold the pages you want to modify, not\", \" every one that exists.\\n\\n## Migrate from OWIN / Katana\\n\\nThe following resources offer some guidance \", \"for migrating from OWIN / Katana:\\n\\n- Migration\\n- Katana to ASPNET 5\\n\\n## References\\n\\n- Migrate Authen\", \"tication and Identity to ASP.NET Core\\n- Introduction to Identity on ASP.NET Core\\n- Configure ASP.NET\", \" Core Identity\\n- Scaffold Identity in ASP.NET Core projects\\n\\n## Compare controllers in ASP.NET MVC a\", \"nd Web API with controllers in ASP.NET Core\\n\\nIn ASP.NET MVC 5 and Web API 2, there were two differen\", \"t Controller base types. MVC controllers inherited from Controller; Web API controllers inherited fr\", \"om ApiController. In ASP.NET Core, this object hierarchy has been merged. It's recommended that API \", \"c ontrollers in ASP.NET Core inherit from ControllerBase and add the [ApiController] attribute. Stan\", \"dard view-based MVC controllers should inherit from Controller.\\n\\nIn both frameworks, controllers are\", \" used to organize sets of action methods. Filters and routes can be applied on a controller level in\", \" addition to at the action level. These conventions can be extended further by using custom base Con\", \"troller types with default behavior and attributes applied to them.\\n\\nIn ASP.NET MVC, content negotia\", \"tion isn't supported. ASP.NET Web API 2 does support content negotiation, as does ASP.NET Core. Usin\", \"g content negotiation, the format of the content returned to a request can be determined by headers \", \"the client provides indicating its preferred manner of receiving the content.\\n\\nWhen migrating ASP.NE\", \"T Web API controllers to ASP.NET Core, a few components need to be changed if they exist. These incl\", \"ude references to the ApiController base class, the System.Web.Http namespace, and the IHttpActionRe\", \"sult interface. Refer to the documentation for recommendations on how to migrate these specific diff\", \"erences. Note that the preferred return type for API actions in ASP.NET Core is ActionResult&lt;T&gt\", \";.\\n\\nIn addition, the [ChildActionOnly] attribute isn't supported in ASP.NET Core. In ASP.NET Core, s\", \"imilar functionality is achieved using View Components.\\n\\nASP.NET Core includes two new attributes: C\", \"onsumesAttribute and ProducesAttribute. These are used to specify the type an action consumes or pro\", \"duces, which can be helpful for routing and documenting the API using tools like Swagger/OpenAPI.\\n\\n#\", \"# References\\n\\n- Format response data in ASP.NET Core Web API\\n- Migrate from ASP.NET Web API to ASP.N\", \"ET Core\\n\\n## Compare Razor usage in ASP.NET MVC and ASP.NET Core\\n\\nThe basic syntax of Razor hasn't ch\", \"anged substantially between ASP.NET MVC and ASP.NET Core. However, there are certain differences, su\", \"ch as the introduction of Tag Helpers and Razor Pages, that should be considered when migrating. If \", \"your app makes heavy use of custom Razor functionality, refer to the Razor syntax reference for ASP.\", \"NET Core to see what changes may be required when you migrate to ASP.NET Core.\\n\\n## Tag Helpers\\n\\nTag \", \"Helpers enable server-side code to participate in creating and rendering HTML elements in Razor file\", \"s. They offer many advantages over HTML Helpers and should be used in place of HTML Helpers wherever\", \" possible. They provide an HTML-friendly development experience, since they look like standard HTML \", \"and are ignored by most tooling designed to edit HTML. Within Visual Studio , there's rich IntelliSe\", \"nse support for creating HTML and Razor markup with Tag Helpers. Tag Helpers can provide simple or c\", \"omplex behavior from declarative markup in Razor files.\\n\\n## Razor Pages\\n\\nRazor Pages offer an altern\", \"ative to controllers, actions, and views for page- and form-based apps. Razor Pages were compared to\", \" ASP.NET MVC earlier in this chapter.\\n\\n## References\\n\\n- Migrate from ASP.NET MVC to ASP.NET Core MVC\", \": Controllers and Views\\n- Tag Helpers in ASP.NET Core\\n- Introduction to Razor Pages in ASP.NET Core\\n\", \"- Razor syntax reference for ASP.NET Core\\n\\n## Compare ASP.NET SignalR and ASP.NET Core SignalR\\n\\nASP.\", \"NET Core SignalR is incompatible with clients or servers using ASP.NET SignalR. You'll need to updat\", \"e both clients and server to use ASP.NET Core SignalR. Some differences are described in this sectio\", \"n, while the full list is available in the docs. ASP.NET Core SignalR requires .NET Core 2.1 or grea\", \"ter.\\n\\n## Feature differences\\n\\n- ASP.NET SignalR automatically attempts to reconnect dropped connecti\", \"ons; this behavior is opt-in for ASP.NET Core SignalR clients.\\n- Both frameworks support JSON; ASP.N\", \"ET Core SignalR also supports a binary protocol based on MessagePack, and custom protocols can be cr\", \"eated.\\n- The Forever Frame transport, supported by ASP.NET SignalR, isn't supported in ASP.NET Core \", \"SignalR.\\n- ASP.NET Core SignalR must be configured by adding services.AddSignalR() and app.UseEndpoi\", \"nts in Program.cs .\\n- ASP.NET Core SignalR requires sticky sessions; ASP.NET SignalR doesn't.\\n- ASP.\", \"NET Core simplifies the connection model; connections are only made to a single hub.\\n- ASP.NET Core \", \"SignalR supports streaming data from the hub to the client.\\n- ASP.NET Core SignalR doesn't support p\", \"assing state between clients and the hub (but method calls still allow passing information between h\", \"ubs and clients).\\n- The PersistentConnection class doesn't exist in ASP.NET Core SignalR.\\n- ASP.NET \", \"SignalR supports SQL Server and Redis. ASP.NET Core SignalR supports Azure SignalR and Redis.\\n\\n## Re\", \"ferences\\n\\n- Differences between ASP.NET SignalR and ASP.NET Core SignalR\\n- Azure SignalR Service\\n\\n##\", \" Compare testing options between ASP.NET MVC and ASP.NET Core\\n\\nASP.NET MVC apps support unit testing\", \" of controllers, but this approach often omits many MVC features like routing, authorization, model \", \"binding, model validation, filters, and more. To test these MVC features in addition to the logic wi\", \"thin the controller action itself, frequently the app would need to be deployed and then tested with\", \" a tool like Selenium. These tests are substantially more expensive, more brittle, and slower than t\", \"ypical unit tests that can be run without the need for hosting and running the entire app.\\n\\nASP.NET \", \"Core controllers can be unit tested just like ASP.NET MVC controllers, but with the same limitations\", \". However, ASP.NET Core supports fast, easy-to-author integration tests as well. Integration tests a\", \"re hosted by a TestHost class and are typically configured in a custom WebApplicationFactory that ca\", \"n override or replace app dependencies. For instance, frequently during integration tests the app wi\", \"ll target a different data source and may replace services that send emails with fake or mock implem\", \"entations.\\n\\nASP.NET MVC and Web API did not support anything like the integration testing scenarios \", \"available in ASP.NET Core. In any migration effort, you should allocate time to write some integrati\", \"on tests for your newly migrated system to ensure it's working as ex pected and continues to do so. \", \"Even if you weren't writing tests of your web app logic before the migration, you should strongly co\", \"nsider doing so as you move to ASP.NET Core.\\n\\n## References\\n\\n- Creating Unit Tests for ASP.NET MVC A\", \"pplications\\n- Unit test controller logic in ASP.NET Core\\n- Integration tests in ASP.NET Core\\n\\n## Mig\", \"rate large solutions to ASP.NET Core\\n\\nMigrating large solutions from .NET Framework to .NET Core req\", \"uires some planning. Dependencies must be migrated or updated before the projects that depend on the\", \"m. There are tools that can identify dependencies and offer help with migrating to .NET Core. Depend\", \"ing on the app, its scope, and current usage patterns, different strategies may be employed when mig\", \"rating. Do you migrate it all at once, or over time, side-by-side with the current system? Do you wr\", \"ap the current system in the new one, and incrementally replace its functionality?\\n\\nIn this chapter,\", \" you'll learn how create a migration plan for a large solution, how to use tools to help with the mi\", \"gration, and some strategies to consider for the migration itself.\\n\\n## References\\n\\n- What topics are\", \" important to migrating large MVC and Web API apps to .NET Core?\\n- Porting from .NET Framework to .N\", \"ET Core\\n\\n## Identify sequence of projects to migrate\\n\\nFor solutions that involve multiple frontend a\", \"pps, it's best to migrate the apps one by one. For example, create a solution that only includes one\", \" front-end app and its dependencies so you can easily identify the scope of work involved. Solutions\", \" are lightweight, and you can include projects in multiple solutions if needed. Take advantage of so\", \"lutions as an organizational tool when migrating.\\n\\nOnce you've identified the ASP.NET app to migrate\", \" and have its dependent projects located with it (ideally in a solution), the next step is to identi\", \"fy framework and NuGet dependencies. Having identified all dependencies, the simplest migration appr\", \"oach is a 'bottom up' approach. With this approach, the lowest level of dependencies is migrated fir\", \"st. Then the next level of dependencies is migrated, until eventually the only thing left is the fro\", \"nt-end app. Figure 3-1 shows an example set of projects composing an app. The low-level class librar\", \"ies are at the bottom, and the ASP.NET MVC project is at the top.\\n\\nContoso.Utils\\n\\n\\u2022 NET 4.5 Class Li\", \"brary\\n\\nContoso.Web\\n\\nASP. NET MVC 5\\n\\nFigure 3-1. Project dependencies graph.\\n\\nChoose a particular fro\", \"nt-end app, an ASP.NET MVC 5 / Web API 2 project. Identify its dependencies in the solution, and map\", \" out their dependencies until you have a complete list. A diagram like the one shown in Figure 3-1 m\", \"ay be useful when mapping out project dependencies. Visual Studio can produce a dependency diagram f\", \"or your solution , depending on which edition you're using. The .NET Portability Analyzer can also p\", \"roduce dependency diagrams.\\n\\nFigure 3-2 shows the installer for the .NET Portability Analyzer Visual\", \" Studio extension:\\n\\n\\u2022 VSIX Installer\\n\\nInstall\\n\\n.NET Portability Analyzer\\n\\nV Visual Studio Enterprise\", \" 2019\\n\\n/ Visual Studio Enterprise 2019 Preview\\n\\nBy clicking \\\"Install\\\", you agree with the above lice\", \"nse terms (if any) and the\\n\\ninstallation of any prerequisites.\\n\\nFigure 3-2. .NET Portability Analyze\", \"r installer.\\n\\nThe extension currently supports Visual Studio 2017 and 2019. Visual Studio 2022 suppo\", \"rt is planned. Once installed, you configure it from the Analyze &gt; Portability Analyzer Settings \", \"menu, as shown in Figure 3-3.\\n\\nX\\n\\nOptions\\n\\nSearch Options (CtrI+E)\\n\\n\\u2022 Environment\\n\\n\\u2022 Projects and So\", \"lutions\\n\\n\\u2022 Source Control\\n\\n\\u2022 Work Items\\n\\n\\u2022 Text Editor\\n\\n\\u2022 Debugging\\n\\n\\u2022 IntelliTrace\\n\\n\\u2022 Performance T\", \"ools\\n\\n\\u2022 .NET Portability Analyzer\\n\\nGeneral\\n\\n\\u2022 Azure Service Authentication\\n\\n\\u2022 Container Tools\\n\\n\\u2022 Cro\", \"ss Platform\\n\\n\\u2022 Database Tools\\n\\n\\u2022 F# Tools\\n\\n\\u2022 Live Share\\n\\n\\u2022 Live Unit Testing\\n\\n\\u2022 NuGet Package Manage\", \"r\\n\\n\\u2022 Snapshot Debugger\\n\\n\\u2022 SQL Server Tools\\n\\n\\u2022 Test\\n\\n\\u2022 Text Templating\\n\\n\\u2022 Web Forms Designer\\n\\n\\u2022 Web P\", \"erformance Test Tools\\n\\n\\u2022 Windows Forms Designer\\n\\n\\u2022 XAML Designer\\n\\nP\\n\\nGeneral settings\\n\\nDefault outpu\", \"t directory C:\\\\Portability Analysis\\n\\nDefault output name\\n\\nApiPortAnalysis\\n\\nOutput formats\\n\\n~ Excel V\", \" HTML\\n\\n\\u2022Ison\\n\\nFigure 3-3. Configure the .NET Portability Analyzer.\\n\\nThe analyzer produces a detailed\", \" report for each assembly. The report:\\n\\n- Describes how compatible each project is with a given targ\", \"et framework, such as .NET 7 or .NET Standard 2.0.\\n- Helps teams assess the effort required to port \", \"a particular project to a particular target framework.\\n\\nThe details of this analysis are covered in \", \"the next section.\\n\\nOnce you've mapped out the projects and their relationships with one another, you\", \"'re ready to determine the order in which you'll migrate the projects. Begin with projects that have\", \" no dependencies. Then, work your way up the tree to the projects that depend on these projects.\\n\\nIn\", \" the example shown in Figure 3-1, you would start with the Contoso.Utils project, since it doesn't d\", \"epend on any other projects. Next, Contoso.Data since it only depends on 'Utils'. Then migrate the '\", \"BusinessLogic' library, and finally the front -end ASP.NET 'Web' project. Following this 'bottom up'\", \" approach works well for relatively small and well-factored apps that can be migrated as a unit once\", \" all of their projects have migrated. Larger apps with more complexity, or more code that will take \", \"longer to migrate, may need to consider more incremental strategies.\\n\\n?\\n\\n## Unit tests\\n\\nMissing from\", \" the previous diagrams are unit test projects. Hopefully there are tests covering at least some of t\", \"he existing behavior of the libraries being ported.\\n\\nIf you have unit tests, it's best to convert th\", \"ose projects first. You'll want to continue testing changes in the project you're working on. Rememb\", \"er that porting to .NET Core is a significant change to your codebase.\\n\\nMSTest, xUnit, and NUnit all\", \" work on .NET Core. If you don't currently have tests for your app, consider building some character\", \"ization tests that verify the system's current behavior. The benefit is that once the migration is c\", \"omplete, you can confirm the app's behavior remains unchanged.\\n\\n## Considerations for migrating many\", \" apps\\n\\nSome organizations will have many different apps to migrate, and migrating each one by hand m\", \"ay require too many resources to be tenable. In these situations, some degree of automation is recom\", \"mended. The steps followed in this chapter can be automated. Structural changes, like project file d\", \"ifferences and updates to common packages, can be applied by scripts. These scripts can be refined a\", \"s they're run iteratively on more projects. On each run, examine whatever manual steps are required \", \"for each project. Automate those manual steps, if possible. Using this approach, the organization sh\", \"ould grow faster and better at porting their apps over time, with improved automation support each s\", \"tep of the way.\\n\\nWatch an overview of how to employ this approach in this dotNetConf presentation by\", \" Lizzy Gallagher of Mastercard. The five phases employed in this presentation included:\\n\\n- Migrate t\", \"hird-party NuGet dependencies\\n- Migrate apps to use new .csproj file format\\n- Update internal NuGet \", \"dependencies to .NET Standard\\n- Migrate apps to ASP.NET Core (targeting .NET Framework)\\n- Update all\", \" apps to target .NET 7\\n\\nWhen automating a large suite of apps, it helps significantly if they follow\", \" consistent coding guidelines and project organization. Automation efforts rely on this consistency \", \"to be effective. In addition to parsing and migrating project files, common code patterns can be mig\", \"rated automatically. Some code pattern examples include differences in how controller actions are de\", \"clared or how they return results.\\n\\nFor example, a migration script could search files matching Cont\", \"roller.cs for lines of code matching one of these patterns:\\n\\nreturn new\\n\\n```\\nHttpStatusCodeResult(20\", \"0);\\n```\\n\\n```\\n// or return new HttpStatusCodeResult(HttpStatusCode.OK);\\n```\\n\\nIn ASP.NET Core, either \", \"of the preceding lines of code can be replaced with:\\n\\nreturn\\n\\nOk();\\n\\n86\\n\\n125\\n\\n363\\n\\n369\\n\\n405\\n\\n410\\n\\n56\", \"7\\n\\n616\\n\\n624\\n\\n629\\n\\n672\\n\\n775\\n\\n783\\n\\n802\\n\\nTarget type\\n\\nT:System.Web.HttpRequestBase\\n\\nT:System.Web.HttpRe\", \"questBase\\n\\nT:System.Web.SessionState.HttpSessionState\\n\\nT:System.Web.SessionState.HttpSessionState\\n\\nT\", \":System.Web.HttpApplication\\n\\nT:System.Web.HttpApplication\\n\\nT:System.Web.Routing.RouteCollection\\n\\nT:S\", \"ystem.Web.HttpRequest\\n\\nT:System.Web.HttpRequest\\n\\nT:System.Web.HttpRequest\\n\\nT:System.Web.Routing.Rout\", \"e\\n\\nT:System.Web.HttpContext\\n\\nT:System.Web.HttpContext\\n\\nT:System.Web.HttpContext\\n\\n815\\n\\nT:System.Web.H\", \"ttpContext\\n\\nAssembly Name eShopLegacyMVC\\n\\neShopLegacyMVC\\n\\nB\\n\\nTarget member\\n\\nT:System.Web.HttpRequest\", \"Base\\n\\nM:System.Web.HttpRequestBase.get_Url\\n\\nT:System.Web.SessionState.HttpSessionState eShopLegacyMV\", \"C\\n\\nM:System.Web.SessionState.HttpSessionState.set_eShopLegacyMVC\\n\\nT:System.Web.HttpApplication\\n\\nM:Sy\", \"stem.Web.HttpApplication.#ctor\\n\\nT:System.Web.Routing.RouteCollection\\n\\nT:System. Web.HttpRequest\\n\\nM:S\", \"ystem.Web.HttpRequest.get_RawUrl\\n\\n## Summary\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopL\", \"egacyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\n.NET Core + Platform Exten\", \"sions, Version=\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supp\", \"orted\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\n.NE\", \"T Core, Version=v3.1\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot\", \" supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\", \"\\n\\nNot supported\\n\\n.NET Standard + Platform Exte\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot sup\", \"ported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNo\", \"t supported\\n\\nNot supported\\n\\nNot supported\\n\\nThe best approach to porting a large .NET Framework app t\", \"o .NET Core is to: M:System.Web.HttpContext.get_Current eShopLegacyMVC Not supported\\n\\n1124 T:System.\", \"Web.HttpServerUtilityBase\\n\\n1128 T:System.Web.HttpServerUtilityBase\\n\\n1322 T:System.Web.Routing.RouteT\", \"able\\n\\n1324 T:System.Web.Routing.RouteTable\\n\\n1365\\n\\n1366\\n\\n1367\\n\\nR6R\\n\\nT:System.Web.HttpServerUtilityBas\", \"e eShopLegacyMVC\\n\\nNot supported\\n\\n1. Identify project dependencies.\\n2. Analyze what's required to por\", \"t each project.\\n3. Start from the bottom up.\\n\\nMissina assemblies\\n\\nDetails |\\n\\nYou can use the .NET Po\", \"rtability Analyzer to determine how compatible existing libraries may be with target platforms. Auto\", \"mated tests will help ensure no breaking changes are introduced as the app is ported. These test pro\", \"jects should be among the first projects ported.\\n\\n## References\\n\\n- Porting from .NET Framework to .N\", \"ET Core\\n- The .NET Portability Analyzer\\n- 2 Years, 200 Apps: A .NET Core Migration at Scale (Video)\\n\", \"\\n## Understand and update dependencies\\n\\nAfter identifying the sequence in which the app's individual\", \" projects must be migrated, the next step is to understand each project's dependencies and update th\", \"em if necessary. For platform dependencies, the best way to start is to run the .NET Portability Ana\", \"lyzer on the assembly in question, and then look at the detailed results that are generated. You con\", \"figure the tool to specify one or more target platforms, such as .NET 7 or .NET Standard 2.0. Result\", \"s are provided with details for each platform targeted. Figure 34 shows an example of the tool's out\", \"put.\\n\\nFigure 3-4. .NET Portability Analyzer report details.\\n\\n## Update class library dependencies\\n\\nL\", \"arge apps typically involve multiple projects, and most projects other than the ASP.NET MVC web proj\", \"ect are likely to be class libraries. Class libraries tend to be the easiest to port between .NET\\n\\nN\", \"ot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot support\", \"ed\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nPortability Summary\\n\\n\", \"platforms, especially compared to ASP.NET projects, which are among the most difficult (and typicall\", \"y need to be re-created).\\n\\nTeams can consider the try-convert tool or the .NET Upgrade Assistant too\", \"l for migrating class libraries to .NET Core. These tools analyze a .NET Framework project file and \", \"attempt to migrate it to the .NET Core project file format, making any modifications it can safely p\", \"erform in the process. The tools may require some manual assistance to work with ASP.NET projects, b\", \"ut can usually help speed up the process of migrating class libraries.\\n\\nThe try-convert and Upgrade \", \"Assistant tools are deployed as .NET Core command line tools. They only run on Windows, since they'r\", \"e designed to work with .NET Framework apps. You can install try -convert by running the following c\", \"ommand from a command prompt:\\n\\ndotnet tool install -g try-convert\\n\\nOnce you've successfully installe\", \"d the tool, you can run try -convert in the folder where the class library's project file is located\", \".\\n\\nInstall the .NET Upgrade Assistant with the following command (after installing try-convert):\\n\\ndo\", \"tnet tool install -g upgrade-assistant\\n\\nRun the tool with the command upgrade-assistant upgrade &lt;\", \"project&gt; in the folder where the project file is located.\\n\\n## Update NuGet package dependencies\\n\\n\", \"Analyze your use of thirdparty NuGet packages and determine if any of them don't yet support .NET St\", \"andard (or do support it but only with a new version). It can be helpful to update NuGet packages to\", \" use &lt;PackageReference&gt; syntax using Visual Studio's converter tool , so that top-level depend\", \"encies are visible. Next, check whether the current or later versions of these packages support .NET\", \" Core or .NET Standard. This information can be found on [nuget.org] or within Visual Studio for eac\", \"h package.\\n\\nIf support exists using the version of the package the app currently uses, great! If not\", \", see if a more recent version of the package has the support and research what would be involved in\", \" upgrading. There may be breaking changes in the package, especially if the major version of the pac\", \"kage changes between your currently used version and the one to which you're upgrading.\\n\\nIn some cas\", \"es, no version of a given package works with .NET Core. In that case, teams have a couple options. T\", \"hey can continue depending on the .NET Framework version, but this has limitations. The app may only\", \" run on Windows, and the team may want to run Portability Analyzer on the package's binaries to see \", \"if there are any issues likely to be encountered. Certainly the team will want to test thoroughly, s\", \"ince if .NET Framework packages are used that reference APIs not available in .NET Core, a runtime e\", \"xception will occur. The other option is to find a different package or, if the required package is \", \"open source, upgrade it to .NET Standard or .NET Core themselves.\\n\\n## Migrate ASP.NET MVC projects\\n\\n\", \"The System.Web namespace and types don't exist in .NET Core. When you're analyzing dependencies and \", \"using tools like tryconvert, you'll find they don't offer many suggestions for automatic migration o\", \"f ASP.NET MVC projects and any code in them that references System.Web. For these projects, you'll n\", \"eed to start with a new ASP.NET Core web project and manually migrate files to this project.\\n\\nIn gen\", \"eral, it's a good practice to minimize how much of an app's business logic lives in its user interfa\", \"ce layer. It's also best to keep controllers and views small. Apps that have followed this guidance \", \"will be easier to port than those that have a significant amount of their logic in the ASP.NET web p\", \"roject. If you have an app you're considering porting, but haven't begun the process yet, keep this \", \"in mind as you maintain it. Any effort you put toward minimizing how much code is in the ASP.NET MVC\", \" or Web API project will likely result in less work when the time comes to port the app.\\n\\nThe next c\", \"hapter digs into details of how to migrate from ASP.NET MVC and Web API projects to ASP.NET Core pro\", \"jects. The previous chapter called out the biggest differences between the apps. Once the basic proj\", \"ect structure is in place, migrating individual controllers and views is usually straightforward, es\", \"pecially if they're mainly focused on web responsibilities.\\n\\n## References\\n\\n- .NET Upgrade Assistant\", \" tool\\n- try-convert tool\\n- apiport tool\\n\\n## Strategies for migrating while running in production\\n\\nMa\", \"ny teams have .NET Framework apps they plan to migrate to .NET Core/.NET 7, but the app is so large \", \"that the migration requires a significant amount of time to complete. The original app needs to live\", \" on while the migration is done piece by piece. There needs to be a way for the old and new versions\", \" of the app to work together side-by-side, or for the old version to be migrated in-place, at least \", \"some of the way, without breaking it. Teams can employ many different strategies to support these go\", \"als.\\n\\n## Refactor the .NET Framework solution\\n\\nA good place to start if you plan to port a .NET Fram\", \"ework app to .NET Core is to refactor it to work better with .NET Core. This means updating individu\", \"al class libraries to target .NET Standard and moving as much logic out of your ASP.NET MVC projects\", \" and into these class libraries. Any code you have in .NET Standard libraries is immediately usable \", \"from both .NET Framework to .NET Core apps, which is why this step is so valuable as part of a migra\", \"tion.\\n\\nWhen refactoring, make sure you're following good refactoring fundamentals. For example, crea\", \"te tests that verify what the system does before you start refactoring. Run these tests when you're \", \"done to confirm you didn't change the system's behavior. You ma y need to add characterization tests\", \" to the system if you don't already have a good suite of automated tests you can rely on.\\n\\n## Extrac\", \"t front-end assets to a CDN\\n\\nIf your .NET Framework apps include a lot of static assets, like script\", \"s, CSS files, or images, you may be able to migrate these to a separate CDN. Then, update the existi\", \"ng app to reference the CDN links for these assets. When you port the app to .NET Cor e, these stati\", \"c files won't be part of the migration, and you'll just continue referencing them from the CDN in th\", \"e ASP.NET Core app.\\n\\n## Extract and migrate individual microservices\\n\\nLarge .NET Framework apps may \", \"already be comprised of separate front-end systems that can be migrated individually. Or they may be\", \" candidates for migration to a microservices architecture, with some pieces of existing ASP.NET MVC \", \"apps being pulled out into new ASP.NET Core microservice implementations. You can learn more about m\", \"icroservices in the associated ebook, .NET Microservices: Architecture for Containerized .NET Applic\", \"ations.\\n\\nFor example, the existing app might have a set of features it uses related to user sign-in \", \"and registration. These could be migrated to a separate microservice, which could be built and deplo\", \"yed using ASP.NET Core and then integrated into the legacy .NET Framework app. Next, the app might h\", \"ave a few pages dedicated to tracking the individual user's shopping cart. These pages could also be\", \" pulled out into their own separate microservice and again integrated into the existing app. In this\", \" way, the original .NET Framework app continues running in production, but with more and more of its\", \" features coming from modernized .NET Core microservices.\\n\\n## Deploy multiple versions of the app si\", \"de-by-side in IIS\\n\\nUsing a combination of host headers and redirects, an existing ASP.NET MVC app ca\", \"n be configured to run side by side with an ASP.NET Core app on the same IIS server. As pieces of fu\", \"nctionality, such as individual controllers, are ported to ASP.NET Core, their routes and URLs are m\", \"apped within IIS to target the ASP.NET Core web site or subapplication (IIS virtual directories aren\", \"'t supported with ASP.NET Core apps). An ASP.NET Core app can be hosted as an IIS sub-application (s\", \"ub-app). The subapp's path becomes part of the root app's URL.\\n\\n## Apply the Strangler pattern\\n\\nLarg\", \"e ASP.NET MVC apps can be gradually replaced with a new ASP.NET Core app by incrementally migrating \", \"pieces of functionality. One approach to this is called the strangler pattern, named for strangler v\", \"ines that strangle and eventually tear down trees. This approach relies on first implementing a faca\", \"de layer over top of the existing solution. This facade should be built using the new approach to th\", \"e problem, or an off-the-shelf solution such as an API gateway.\\n\\nOnce the facade is in place, you ca\", \"n route part of it to a new ASP.NET Core app. As you port more of the original .NET Framework app to\", \" .NET Core, you continue to update the facade layer accordingly, sending more of the facade's total \", \"functionality to the new system. Figure 3 -5 shows the strangler pattern progression over time.\\n\\nEar\", \"ly migration\\n\\nStrangler Fa\\u00e7ade\\n\\nLegacy\\n\\nLater migration\\n\\nStrangler Fa\\u00e7ade\\n\\nFigure 3-5. The Strangler\", \" pattern over time.\\n\\nEventually, the entire facade layer corresponds to the new, modern implementati\", \"on. At this point, both the legacy system and the face layer can be retired. Microsoft has guidance \", \"on how to achieve incremental ASP.NET to ASP.NET Core migration using the YARP reverse proxy.\\n\\n## Mu\", \"lti-targeting approaches\\n\\nMulti-targeting is recommended for large apps that will be migrated over t\", \"ime and for teams applying the Strangler pattern approach. This approach can address BindingRedirect\", \" and package restoration challenges that surface from mixing PackageReference and packages.config re\", \"store styles. There are two options available for code that must run in both .NET Framework and .NET\", \" Core environments.\\n\\n- Preprocessor directives (#if in C# or #If in Visual Basic) allow you to imple\", \"ment different functionality or use different dependencies when run in .NET Framework versus .NET Co\", \"re.\\n- Project files can use conditional globbing patterns, such as *.core.cs, to include different s\", \"ets of files based on which framework is being targeted.\\n\\nTypically you only follow these recommenda\", \"tions for class libraries. These techniques allow a single common codebase to be maintained while ne\", \"w functionality is added and features of the app are incrementally ported to use .NET Core.\\n\\n## Summ\", \"ary\\n\\nFrequently, large ASP.NET MVC and Web API apps won't be ported to ASP.NET Core all at once, but\", \" will migrate incrementally over time. This section offers several strategies for performing this in\", \"cremental migration. Choose the one(s) that will work best for your organization and app.\\n\\n## Refere\", \"nces\\n\\n- .NET Microservices: Architecture for Containerized .NET Applications\\n- eShopOnContainers Ref\", \"erence Microservices Application\\n- Host ASP.NET Core on Windows with IIS\\n- Strangler pattern\\n- Incre\", \"mental ASP.NET to ASP.NET Core Migration\\n\\nMigration complete\\n\\nP\\n\\n\\u2022 8\\n\\n\\u2022 8\\n\\n\\u2022 8\\n\\no Connected Services\", \"\\n\\nProperties\\n\\nReferences\\n\\nApp_Data\\n\\nApp_Start\\n\\nContent\\n\\n## Example migration of eShop to ASP.NET Cor\", \"e Models Pics\\n\\nServices\\n\\nSetup\\n\\nIn this chapter, you'll see how to migrate a .NET Framework app to .\", \"NET Core. The chapter examines a sample online store app written for ASP.NET MVC 5. The app will use\", \" many of the concepts and tools described earlier in this book. You'll find the starting point app i\", \"n the eShopModernizing GitHub repository. There are several different starting point apps. This chap\", \"ter focuses on the eShopLegacyMVCSolution .\\n\\nex log4Net.xml\\n\\nThe initial version of the project is s\", \"hown in Figure 41. It's a fairly standard ASP.NET MVC 5 app.\\n\\nFigure 4-1. The eShopModernizing MVC s\", \"ample project structure.\\n\\nThis chapter demonstrates how to perform many of the upgrade steps by hand\", \". Alternatively, you can use the .NET Upgrade Assistant tool to perform many of the initial steps, l\", \"ike converting the project file, changing the target framework, and updating NuGet packages.\\n\\n## Run\", \" ApiPort to identify problematic APIs\\n\\nThe first step in preparing to migrate is to run the ApiPort \", \"tool. The tool identifies how many .NET Framework APIs the app calls and how many of these have .NET\", \" Standard or .NET Core equivalents. Focus primarily on your own app's logic, not third -party depend\", \"encies, and pay attention to System.Web dependencies that will need to be ported. The ApiPort tool w\", \"as introduced in the last chapter on understanding and updating dependencies. Note that currently it\", \" requires Visual Studio 2019; Visual Studio 2022 support is planned.\\n\\nAfter installing and configuri\", \"ng the ApiPort tool, run the analysis from within Visual Studio, as shown in Figure 4-2.\\n\\nAnalyze\\n\\nT\", \"ools\\n\\nCode Cleanup\\n\\nExtensions\\n\\nWindow\\n\\nHe\\n\\n\\u2022\\n\\nFigure 4-2. Analyze assembly portability in Visual St\", \"udio.\\n\\nChoose the web project's assembly from the project's bin folder, as shown in Figure 4-3.\\n\\n5 -\", \" =\\n\\nX Select Assembly Files\\n\\nFile\\n\\nHome\\n\\nInsert\\n\\nApiPortAnalysis.xlsx - Excel\\n\\nPage Layout\\n\\nT\\n\\nX\\n\\nE6\", \"\\n\\nFormulas\\n\\nReview\\n\\nView\\n\\n\\\"src &gt; eShopLegacyMVC &gt; bin &gt;\\n\\n80.59\\n\\nfx\\n\\nOrganize \\u2022\\n\\nNew folder\\n\", \"\\n7d9637ec-b1a8-4808-8e19-59fdc4ecb3ea\\n\\n** Dropbox\\n\\nTarget Framework\\n\\n&amp;OneDrive\\n\\n.NETFramework,Ve\", \"rsion=v4.7.2\\n\\n\\u2022 This PC\\n\\ny 3D Objects\\n\\n\\u2022 Desktop\\n\\nDocuments\\n\\n+ Downloads\\n\\nMusic\\n\\nPictures\\n\\n# Videos\\n\", \"\\nE&gt; OS (C:)\\n\\nFigure 4-3. Choose the project's web assembly.\\n\\nIf your solution includes several pr\", \"ojects, you can choose all of them. The eShop sample includes just a single MVC project.\\n\\nOnce the r\", \"eport is generated, open the file and review the results. The summary provides a high-level view of \", \"what percentage of .NET Framework calls your app is making have compatible versions. Figure 4-4 show\", \"s the summary for the eShop MVC project.\\n\\nFigure 4-4. ApiPort summary.\\n\\nFor this app, about 80 perce\", \"nt of the .NET Framework calls are compatible. 20 percent of the calls need to be addressed during t\", \"he porting process. Viewing the details reveals that all of the incompatible calls are part of Syste\", \"m.Web, which is an expected incompatibility. The dependencies on System.Web calls will be addressed \", \"when the app's controllers and related classes are migrated in a later step. Figure 4-5 lists some o\", \"f the specific types found by the tool:\\n\\n1\\n\\n2\\n\\n3\\n\\n4\\n\\n5\\n\\nLoad Test\\n\\nTable Tools\\n\\nDesign\\n\\nTell me what\", \" you want to do\\n\\nY U\\n\\nSearch bin\\n\\nE\\n\\nLEE\\n\\nP\\n\\nTarget type\\n\\nT:System.Web.Mvc.UrlParameter\\n\\nT:System.We\", \"b.Mvc.UrlParameter\\n\\nT:System.Web.HttpApplication\\n\\nT:System.Web.HttpApplication\\n\\nT:System.Web.Mvc.Htt\", \"pNotFoundResult\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Controll\", \"er\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System. Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System\", \".Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Cont\", \"roller\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System.Web.Mvc.ActionNameAttribute\\n\\nT:System.Web.Mvc.ActionNa\", \"meAttribute\\n\\nT:System. Web.HttpContext\\n\\nT:System.Web.HttpContext\\n\\nT:System. Web.HttpContext\\n\\nT:Syste\", \"m. Web.HttpContext\\n\\nT:System.Web.Mvc.HandleErrorAttribute\\n\\nT:System.Web.Mvc.HandleErrorAttribute\\n\\nT:\", \"System.Web.Mvc.HttpGetAttribute\\n\\nT:System.Web.Mvc.HttpGetAttribute\\n\\n\\u2022 Target member\\n\\nT:System.Web.Mv\", \"c.Ur|Parameter\\n\\nF:System.Web.Mvc.UrlParameter.Optional\\n\\nT:System.Web.HttpApplication\\n\\nM:System.Web.H\", \"ttpApplication.#ctor\\n\\nT:System.Web.Mvc.HttpNotFoundResult\\n\\nAssembly Name eShopLegacyMVC\\n\\neShopLegacy\", \"MVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\nFigure 4-5. ApiPort incompatible type details.\\n\", \"\\nMost of the incompatible types refer to Controller and various related attributes that have equival\", \"ents in ASP.NET Core.\\n\\n## Update project files and NuGet reference syntax\\n\\nNext, migrate from the ol\", \"der .csproj file structure to the newer, simpler structure introduced with .NET Core. In doing so, y\", \"ou'll also migrate from using a packages.config file for NuGet references to using &lt;PackageRefere\", \"nce&gt; elements in the project file. Old-style project files may also use &lt;PackageReference&gt; \", \"elements, so it usually makes sense to migrate all NuGet package references to this format first, be\", \"fore upgrading to the new project file format.\\n\\nThe original project's eShopLegacyMVC.csproj file is\", \" 418 lines long. A sample of the project file is shown in Figure 4-6. To offer a sense of its overal\", \"l size and complexity, the right side of the image contains a miniature view of the entire file.\\n\\n\\u2022 \", \"eShopLegacyMVC.csproj X\\n\\nsrc &gt; eShopLegacyMVC &gt; i eShopLegacyMVC.csproj k/?xm] version=\\\"1.0\\\" e\", \"ncoding=\\\"utf-8\\\"?l)\\n\\n\\u2039Project ToolsVersion=\\\"15.0\\\" DefaultTargets=\\\"Build\\\" xmIns=\\\"http://schemas.micros\", \"oft.com/developer/msbuild/200=\\n\\n\\u2039Import Project=\\\"..\\\\.. \\\\packages\\\\Microsoft.CodeDom.Providers.DotNetC\", \"ompilerPlatform.2.0.1\\\\build\\\\net46\\\\Microsc\\n\\n\\u2039Import Project=\\\"\\n\\n..\\\\..\\\\packages\\\\Microsoft.Net.Compilers\", \".2.10.0\\\\build\\\\Microsoft.Net.Compilers.props\\\" Conditic\\n\\n\\u2039Import Project=\\\"$(MSBuildExtensionsPath32) \\\\\", \"Microsoft\\\\VisualStudio\\\\v$(VisualStudioVersion)\\\\TypeScript\\\\Micros\\n\\n&lt;PropertyGroup&gt;...\\n\\n&lt;/Pro\", \"pertyGroup&gt;\\n\\n&lt;/PropertyGroup&gt;\\n\\n&lt;/PropertyGroup&gt;\\n\\n&lt;ItemGroup&gt;...\\n\\n&lt;/ ItemGrou\", \"p&gt;\\n\\n&lt; ItemGroup&gt;\\n\\n\\u2039Compile Include=\\\"Global.asax.cs\\\"\\u203a\\n\\n&lt;/Compile&gt;\\n\\nFigure 4-6. The eSh\", \"opLegacyMVC.csproj file structure.\\n\\nA common way to create a new project file for an existing ASP.NE\", \"T project is to create a new ASP.NET Core app using dotnet new or File &gt; New &gt; Project in Visu\", \"al Studio. Then files can be copied from the old project to the new one to complete the migration.\\n\\n\", \"In addition to the C# project file, NuGet dependencies are stored in a separate 45-line packages.con\", \"fig file, as shown in Figure 4-7.\\n\\n2\\n\\n5\\n\\n6\\n\\n7\\n\\n32\\n\\n33\\n\\n42\\n\\n43\\n\\n51\\n\\n52\\n\\n197\\n\\n198\\n\\n199\\n\\n200\\n\\n201\\n\\n202\\n\", \"\\n203\\n\\n204\\n\\n205\\n\\n206\\n\\n207\\n\\n208\\n\\n209\\n\\n210\\n\\n211\\n\\n212\\n\\n213\\n\\n&gt;\\n\\n&gt;\\n\\n\\u2022 packages.config X\\n\\nsrc &gt; eS\", \"hopLegacyMVC &gt; \\u2022 packages.config\\n\\n1\\n\\n#?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?[\\n\\n\\u2039packages&gt;\\n\\n&lt; \", \"package\\n\\n&lt; package\\n\\n\\u2039package\\n\\n&lt; package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039 package\\n\\n\\u2039package\\n\\n&lt; package\", \"\\n\\n&lt; package\\n\\n&lt; package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n&lt; package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039packa\", \"ge\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n&lt; package\\n\\n&lt; package\", \"\\n\\n&lt; package\\n\\n\\u2039 package\\n\\n\\u2039package\\n\\n&lt; package\\n\\n\\u2039package\\n\\n\\u2039 package\\n\\n\\u2039package\\n\\n\\u2039 package id=\\\"Ant]\", \"r\\\" version=\\\"3.5.0.2\\\" targetFramework=\\\"net472\\\" /&gt;\\n\\nid=\\\"Autofac\\\" version=\\\"4.9.1\\\" targetFramework=\\\"n\", \"et472\\\" / &gt;\\n\\nid= \\\"Autofac. Mvc5\\\" version=\\\"4.0.2\\\" targetFramework=\\\"net472\\\" /&gt;\\n\\nid= \\\"bootstrap\\\" v\", \"ersion=\\\"4.3.1\\\" targetFramework=\\\"net472\\\" /&gt;\\n\\nFigure 4-7. The packages.config file.\\n\\nYou can migrat\", \"e packages.config in class library projects using Visual Studio. This functionality doesn't work wit\", \"h ASP.NET projects, however. Learn more about migrating packages.config to &lt;PackageReference&gt; \", \"in Visual Studio. If you have a large number of projects to migrate, this community tool may help . \", \"If you're using a tool to migrate the project file to the new format, you should do that after you'v\", \"e finished migrating all NuGet references to use &lt;PackageReference&gt;.\\n\\n## Create new ASP.NET Co\", \"re project\\n\\nAdd a new ASP.NET Core project to the existing app's solution to make moving files easie\", \"r, as most of the work can be done from within Visual Studio's Solution Explorer . In Visual Studio,\", \" right-click on your app's solution and choose Add New Project . Choose ASP.NET Core web application\", \" , and give the new project a name as shown in Figure 4-8.\\n\\n8\\n\\n10\\n\\n11\\n\\n12\\n\\n13\\n\\n14\\n\\n15\\n\\n16\\n\\n17\\n\\n18\\n\\n1\", \"9\\n\\n20\\n\\n21\\n\\n22\\n\\n23\\n\\n24\\n\\n25\\n\\n26\\n\\n27\\n\\n28\\n\\n29\\n\\n30\\n\\n31\\n\\n32\\n\\n33\\n\\n34\\n\\n35\\n\\n36\\n\\n37\\n\\nConfigure your new projec\", \"t\\n\\nASP.NET Core Web Applicationc*\\n\\nProject name eShopPorted\\n\\nLocation\\n\\nC:\\\\dev\\\\GitHub\\\\eShopModernizin\", \"g\\\\eShopLegacyMVCSolution\\n\\nLinux macos\\n\\nWindows\\n\\nCloud\\n\\nService\\n\\nWeb\\n\\nFigure 4-8. Add new ASP.NET Cor\", \"e web application.\\n\\nThe next dialog will ask you to choose which template to use. Select the Empty t\", \"emplate. Be sure to also change the dropdown from .NET Core to .NET Framework . Select ASP.NET Core \", \"2.2 , as shown in Figure 4-9.\\n\\nX\\n\\nCreate a new ASPINET Core web application\\n\\nNET Framework\\n\\nEmpty it\", \".\\n\\nAPI\\n\\nWeb Application\\n\\nWeb Application (Model-View-Controller)\\n\\nAngular\\n\\nA\\n\\nReact js\\n\\nGet addition\", \"al project templates\\n\\nFigure 4-9. Choose an Empty project template targeting .NET Framework with ASP\", \".NET Core 2.2.\\n\\n## Migrating NuGet Packages\\n\\nSince the built-in migration tool for migrating package\", \"s.config to &lt;PackageReference&gt; doesn't work on ASP.NET projects, you can use a community tool \", \"instead, or migrate by hand. A community tool I've used uses an XSL file to transform from one forma\", \"t to the other. To use it, first copy the packages.config file to the newly created ASP.NET Core pro\", \"ject folder. Make a backup of your files, as this script removes the packages.config file from all f\", \"olders under where you run the script. Then run these commands from the project folder (or for the e\", \"ntire solution if you prefer):\\n\\n## iwr\\n\\nhttps://gist.githubusercontent.com/aienabled/0bce5e4b1711812\", \"2f2772e7c9218bf9c/raw/7789 53f89882877a7124894b47dccfb1ba3e80a0/Convert-ToPackageReference.ps1 -OutF\", \"ile ConvertToPackageReference.ps1\\n\\n## iwr\\n\\nhttps://gist.githubusercontent.com/aienabled/0bce5e4b1711\", \"8122f2772e7c9218bf9c/raw/7789 53f89882877a7124894b47dccfb1ba3e80a0/Convert-ToPackageReference.xsl -O\", \"utFile  ConvertToPackageReference.xsl\\n\\n./Convert-ToPackageReference.ps1 | Out-Null\\n\\nThe first two co\", \"mmands download files so that they exist locally. The last line runs the script. After running it, t\", \"ry to build the new project. You'll most likely get some errors. To resolve them, you'll want to eli\", \"minate some references (like most of the Microsoft.AspNet and System packages), and you may need to \", \"remove some xmlns attributes.\\n\\nX\\n\\neShopPorted &gt; \\u2022 eShopPorted.csproj\\n\\n1\\n\\n\\u2039Project Sdk=\\\"Microsoft.\", \"NET.Sdk. Web\\\"&gt;\\n\\n2\\n\\n3\\n\\n8\\n\\n9\\n\\n10\\n\\n11\\n\\n12\\n\\n13\\n\\n14\\n\\n15\\n\\n16\\n\\n17\\n\\n18\\n\\n19\\n\\n20\\n\\n21\\n\\n22\\n\\n23\\n\\n24\\n\\n25\\n\\n26\\n\\n2\", \"7\\n\\n28\\n\\n29\\n\\n&lt;PropertyGroup&gt;\\n\\n\\u2039TargetFramework\\u203anet461&lt;/TargetFramework\\u203a\\n\\n&lt;/PropertyGroup&g\", \"t;\\n\\n&lt; ItemGroup \\u203a\\n\\nIn most ASP.NET MVC apps, many client-side dependencies like Bootstrap and jQu\", \"ery were deployed using NuGet packages. In ASP.NET Core, NuGet packages are only used for server-sid\", \"e functionality. Client files should be managed through other means. Review the list of &lt;PackageR\", \"eference&gt; elements added and remove and make note of any that are for client libraries, including\", \":\\n\\n&lt;/PackageReference&gt;\\n\\n- Bootstrap\\n- jQuery\\n- jQuery.Validation\\n- Modernizr\\n- popper.js\\n- Res\", \"pond\\n\\nThe static client files installed by NuGet for these packages will be copied over to the new p\", \"roject's wwwroot folder and hosted from there. It's worth considering whether these files are still \", \"needed by the app, and whether it makes sense to continue hosting them or to use a content delivery \", \"network (CDN) instead. These library versions can be managed at build time using tools like LibMan o\", \"r npm. Figure 4-10 shows the full eShopPorted.csproj file after migrating package references using t\", \"he conversion tool shown and removing unnecessary packages.\\n\\nFigure 4-10. Package references in the \", \"eShopPorted.csproj file.\\n\\nThe package references can be further compacted by making the &lt;Version&\", \"gt;1.0.0.0&lt;/Version&gt; element a Version=1.0.0.0 attribute on &lt;PackageReference&gt;.\\n\\n## Migr\", \"ate static files\\n\\nAny static files the app uses, including third-party scripts and frameworks but al\", \"so custom images and stylesheets, must be copied from the old project to the new one. In ASP.NET MVC\", \" apps, files were typically accessed based on their location within the project folder. In ASP.NET C\", \"ore apps, these static files will be accessed based on their location within the wwwroot folder. For\", \" the eShop project, there are static files in the following folders:\\n\\n- Content\\n- fonts\\n- Images\\n- P\", \"ics\\n- Scripts\\n\\nThe Empty project template used in the previous step doesn't include this folder by d\", \"efault, or the middleware needed for it to work. You'll need to add them.\\n\\nAdd a wwwroot folder to t\", \"he root of the project.\\n\\nAdd version 2.2.0 of the Microsoft.AspNetCore.StaticFiles NuGet package.\\n\\nI\", \"n Startup.cs , add a call to app.UseStaticFiles() in the Configure method:\\n\\n```\\npublic void Configur\", \"e(IApplicationBuilder app, IHostingEnvironment env) { if (env.IsDevelopment()) { app.UseDeveloperExc\", \"eptionPage(); } app.UseStaticFiles(); // ... }\\n```\\n\\nCopy the Content folder from the ASP.NET MVC app\", \" to the new project's wwwroot folder.\\n\\nRun the app and navigate to its /Content/base.css folder to v\", \"erify that the static file is served correctly from its expected path. Continue copying the rest of \", \"the folders containing static files to the new project. You'll also want to copy the favicon.ico fil\", \"e from the project's root to the wwwroot folder. Figure 4-11 shows the results after these files and\", \" their folders have all been copied.\\n\\n\\u2022 B\\n\\neShopPorted\\n\\n&gt; Connected Services\\n\\nDependencies\\n\\n\\u2022 8.\\n\", \"\\n1 8t\\n\\nProperties www.root\\n\\n8\\n\\n8\\n\\n\\u2022 8\\u041f\\n\\nControllers\\n\\n\\u2022 82] Migrations\\n\\n\\u2022 &amp;\\n\\nModels\\n\\n8 Modules\\n\\n8\", \"C Services\\n\\n\\u2022 8\\n\\nViewModel\\n\\n\\u2022 8C\\n\\nViews\\n\\n82] app.config\\n\\n\\u2022 B\\n\\nappsettings json\\n\\n\\u2022 8C# Program.cs\\n\\nD \", \"BC# Startup.cs\\n\\nFigure 4-11. Static folders copied over to wwwroot folder.\\n\\n## Migrate C# files\\n\\nNex\", \"t, copy over the C# files used by the app, including standard MVC folders and their contents like Co\", \"ntrollers , Models , ViewModel , and Services . There will most likely be some changes needed in the\", \"se files. It's best to copy one folder (or subfolder) at a time and compile to see what errors need \", \"to be addressed as you go.\\n\\nFor the eShop sample, the first folder I choose to migrate is the Models\", \" folder, which includes C# entities and Entity Framework classes. This folder's classes are used by \", \"most of the others, so they won't work until these classes have been copied. After copying the folde\", \"r and building, the compiler revealed errors related to missing namespace System.Web.Hosting, relate\", \"d access to HostingEnvironment, and a reference to ConfigurationManager.AppSettings. The solution to\", \" these issues will be to pass in the necessary path data; for now the breaking lines are commented o\", \"ut and a TODO: comment is added to each one to track it. After changing five lines, the Task List sh\", \"ows five items and the project builds.\\n\\nNext, the ViewModel folder, with its one class, is copied ov\", \"er. It's an easy one, and builds immediately.\\n\\nThe Services folder is copied over. This folder's cla\", \"sses depend on Entity Framework classes from the Models folder, which is why it needed to be copied \", \"after that folder. Fortunately, it too builds without errors.\\n\\nfonts\\n\\nPics\\n\\nThat leaves the Controll\", \"ers folder and its two Controller classes. After copying the folder to the new project and building,\", \" there are seven build errors. Four of them are related to ViewBag access and report an error of:\\n\\nM\", \"issing compiler required member 'Microsoft.CSharp.RuntimeBinder.CSharpArgumentInfo.Create'\\n\\nTo resol\", \"ve this error, add a NuGet package reference to C#:\\n\\n```\\n< PackageReference Include=\\\"Microsoft.CShar\", \"p\\\" Version=\\\"4.7.0\\\" />\\n```\\n\\nThe remaining three errors specify types that are defined in an assembly \", \"that isn't referenced. Specifically these types:\\n\\n- HttpServerUtilityBase\\n- RouteValueDictionary\\n- H\", \"ttpRequestBase\\n\\nLet's look at each error one by one. The first error occurs while trying to referenc\", \"e the Server property of Controller, which no longer exists. The goal of the operation is to get the\", \" path to an image file in the app:\\n\\n```\\nif (item != null ) { var webRoot = Server.MapPath(\\\"~/Pics\\\");\", \" // compiler error on this line var path = Path.Combine(webRoot, item.PictureFileName); string image\", \"FileExtension = Path.GetExtension(item.PictureFileName); string mimetype = GetImageMimeTypeFromImage\", \"FileExtension(imageFileExtension); var buffer = System.IO.File.ReadAllBytes(path); return File(buffe\", \"r, mimetype); }\\n```\\n\\nThere are two possible solutions to this problem. The first is to keep the func\", \"tionality as it is. In this case, rather than using Server.MapPath, a fixed path referencing the ima\", \"ge files' location in wwwroot should be used. Alternately, since the only purpose of this action met\", \"hod is to return a static image file, the references to this action in view files can be updated to \", \"reference the static files directly, which improves runtime performance. Since no processing is bein\", \"g done as part of this action, th ere's no reason not to just serve the files directly. If it's not \", \"tenable to update all references to this action, the action could be rewritten to produce a redirect\", \" to the static file's location.\\n\\nThe next two errors both occur in the same private method in the sa\", \"me line of code:\\n\\n```\\nprivate void AddUriPlaceHolder(CatalogItem item) { item.PictureUri = this .Url\", \".RouteUrl(PicController.GetPicRouteName, new { catalogItemId = item.Id }, this .Request.Url.Scheme);\", \" }\\n```\\n\\nBoth this.Url and this.Request cause compiler errors. Looking at how this code is used, its \", \"purpose is to build a link to the PicController action that renders image files. The same one we jus\", \"t discovered could probably be replaced with direct links to the static files located in wwwroot . F\", \"or now, it's worth commenting out this code and adding a TODO: comment to reference the pics another\", \" way.\\n\\nIt's worth noting that the base Controller class, used by the CatalogController class in whic\", \"h this code appears, is still referring to System.Web.Mvc.Controller. There will undoubtedly be more\", \" errors to fix once we update this to use ASP.NET Core. First, remove the using System.Web.Mvc; line\", \" from the list of using statements in CatalogController. Next, add the NuGet package Microsoft.AspNe\", \"tCore.Mvc. Finally, add a using Microsoft.AspNetCore.Mvc; statement, and build the app again.\\n\\nThis \", \"time, there are 16 errors:\\n\\n- Include is not a valid named attribute argument (2)\\n- HttpStatusCodeRe\", \"sult not found (3)\\n- HttpNotFound does not exist (3)\\n- SelectList not found (8)\\n\\nOnce more, let's re\", \"view these errors one by one. First, SelectList can be fixed by adding using Microsoft.AspNetCore.Mv\", \"c.Rendering;, which eliminates half of the errors.\\n\\nAll references to return HttpNotFound(); should \", \"be replaced with return NotFound();.\\n\\nAll references to return new HttpStatusCodeResult(HttpStatusCo\", \"de.BadRequest); should be replaced with return BadRequest();.\\n\\nThat just leaves the use of Include w\", \"ith a [Bind] attribute on a couple of action methods that look like this:\\n\\n```\\n[HttpPost] [ValidateA\", \"ntiForgeryToken] public ActionResult Create([Bind(Include = \\\"Id,Name,Description,Price,PictureFileNa\", \"me,CatalogTypeId,CatalogBrandId,AvailableStock,Rest ockThreshold,MaxStockThreshold,OnReorder\\\")] Cata\", \"logItem catalogItem) {\\n```\\n\\nThe preceding code restricts model binding to the properties listed in t\", \"he Include string. In ASP.NET Core MVC, the [Bind] attribute still exists, but no longer needs the I\", \"nclude = argument. Pass the list of properties directly to the [Bind] attribute:\\n\\n```\\n[HttpPost] [Va\", \"lidateAntiForgeryToken] public ActionResult Create([Bind(\\\"Id,Name,Description,Price,PictureFileName,\", \"CatalogTypeId,CatalogBrandId,Availa bleStock,RestockThreshold,MaxStockThreshold,OnReorder\\\")] Catalog\", \"Item catalogItem) {\\n```\\n\\nWith these changes, the project compiles once more. It's generally a better\", \" practice to use separate model types for controller inputs, rather than using model binding directl\", \"y to your domain model or data model types.\\n\\n## Migrate views\\n\\nThe two biggest ASP.NET Core MVC feat\", \"ures related to views are Razor Pages and Tag Helpers. For the initial migration, we won't use eithe\", \"r feature. You should, however, keep the features in mind if you continue supporting the app once it\", \"'s been migrated. The next step is to copy the Views folder from the original project into the new o\", \"ne. After building, there are nine errors:\\n\\n- HttpContext does not exist (2)\\n- Scripts does not exis\", \"t (5)\\n- Styles does not exist (1)\\n- HtmlString could not be found(1)\\n\\nInvestigating these errors fin\", \"ds that most of them are in the main *_Layout.cshtml , with several related to rendering script and \", \"style tags, or displaying when the server hosting the app was last restarted. The following code lis\", \"ting shows problem areas in the _Layout.cshtml* file:\\n\\n```\\n// other lines omitted; only errors shown\", \" @Styles.Render(\\\"~/Content/css\\\") @Scripts.Render(\\\"~/bundles/modernizr\\\") @{ var sessionInfo = new Htm\", \"lString($\\\"{HttpContext.Current.Session[\\\"MachineName\\\"]}, {HttpContext.Current.Session[\\\"SessionStartTi\", \"me\\\"]}\\\");} @Scripts.Render(\\\"~/bundles/jquery\\\") @Scripts.Render(\\\"~/bundles/bootstrap\\\")\\n```\\n\\nThe refere\", \"nce to Modernizr can be removed. The references to Bootstrap and jQuery can be replaced with CDN lin\", \"ks to the appropriate version.\\n\\nReplace @Styles.Render line with:\\n\\n```\\n< link rel =\\\"stylesheet\\\" href\", \" =\\\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\\\" integrity =\\\"sha384-ggOy\", \"R0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\\\" crossorigin =\\\"anonymous\\\">\\n```\\n\\nReplace\", \" the last two Scripts.Render lines with:\\n\\n```\\n< script src =\\\"https://code.jquery.com/jquery-3.3.1.sl\", \"im.min.js\\\" integrity =\\\"sha384q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\\\" cross\", \"origin =\\\"anonymous\\\"></ script > < script src =\\\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14\", \".7/umd/popper.min.js\\\" integrity =\\\"sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHN\", \"Dz0W1\\\" crossorigin =\\\"anonymous\\\"></ script > < script src =\\\"https://stackpath.bootstrapcdn.com/bootst\", \"rap/4.3.1/js/bootstrap.min.js\\\" integrity =\\\"sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDs\", \"f4x0xIM+B07jRM\\\" crossorigin =\\\"anonymous\\\"></ script >\\n```\\n\\nFinally, after the Bootstrap &lt;link&gt;,\", \" add additional &lt;link&gt; elements for local styles your app uses. For eShop , the result is show\", \"n here:\\n\\n```\\n< link rel =\\\"stylesheet\\\" href =\\\"~/Content/custom.css\\\" /> < link rel =\\\"stylesheet\\\" href \", \"=\\\"~/Content/base.css\\\" /> < link rel =\\\"stylesheet\\\" href =\\\"~/Content/Site.css\\\" />\\n```\\n\\nTo determine th\", \"e order in which the &lt;link&gt; elements should appear, look at your original app's rendered HTML.\", \" Alternatively, review BundleConfig.cs , which for the eShop sample includes this code indicating th\", \"e appropriate sequence:\\n\\n```\\nbundles.Add( new StyleBundle(\\\"~/Content/css\\\").Include( \\\"~/Content/boots\", \"trap.css\\\", \\\"~/Content/custom.css\\\",\\n```\\n\\n```\\n\\\"~/Content/base.css\\\", \\\"~/Content/site.css\\\"));\\n```\\n\\nBuild\", \"ing again reveals one more error loading jQuery Validation on the Create and Edit views. Replace it \", \"with this script:\\n\\n```\\n< script src =\\\"https://cdnjs.cloudflare.com/ajax/libs/jqueryvalidate/1.17.0/j\", \"query.validate.min.js\\\" integrity =\\\"sha512O/nUTF5mdFkhEoQHFn9N5wmgYyW323JO6v8kr6ltSRKriZyTr/8417taVWe\", \"abVS4iONGk2V444QD0P2cwhuTkg==\\\" crossorigin =\\\"anonymous\\\"></ script >\\n```\\n\\nThe last thing to fix in th\", \"e views is the reference to Session to display how long the app has been running, and on which machi\", \"ne. We can display this data directly in the site's *_Layout.cshtml* by using System.Environment.Mac\", \"hineName and System.Diagnostics.Process.GetCurrentProcess().StartTime:\\n\\n```\\n<section class=\\\"col-sm-6\", \"\\\"> <img class=\\\"esh-app-footer-text hidden-xs\\\" src=\\\"~/images/main_footer_text.png\\\" width=\\\"335\\\" height\", \"=\\\"26\\\" alt=\\\"footer text image\\\" /> <br /> <small>@Environment.MachineName @System.Diagnostics.Process.\", \"GetCurrentProcess().StartTime.ToString() UTC</small> </section>\\n```\\n\\nAt this point, the app once mor\", \"e builds successfully. However, trying to run it just yields Hello World! because the Empty ASP.NET \", \"Core template is only configured to display that in response to any request. In the next section, I \", \"complete the migration by configuring the app to use ASP.NET Core MVC, including dependency injectio\", \"n and configuration. Once that's in place, the app should run. Then it will be time to fix the TODO:\", \" tasks that were created earlier.\\n\\n## Migrate app startup components\\n\\nThe last migration step is to \", \"take the app startup tasks from Global.asax , and the classes it calls, and migrate these to their A\", \"SP.NET Core equivalents. These tasks include configuration of MVC itself, setting up dependency inje\", \"ction, and working with the new configuration system. In ASP.NET Core, these tasks are handled in th\", \"e Startup.cs file.\\n\\n## Configure MVC\\n\\nThe original ASP.NET MVC app has the following code in its App\", \"lication_Start in Global.asax , which runs when the app starts up:\\n\\n```\\nprotected void Application_S\", \"tart() { container = RegisterContainer(); AreaRegistration.RegisterAllAreas(); FilterConfig.Register\", \"GlobalFilters(GlobalFilters.Filters); RouteConfig.RegisterRoutes(RouteTable.Routes); BundleConfig.Re\", \"gisterBundles(BundleTable.Bundles); ConfigDataBase(); }\\n```\\n\\nLooking at these lines one by one, the \", \"RegisterContainer method sets up dependency injection, which will be ported below. The next three li\", \"nes configure different parts of MVC: areas, filters, and routes. Bundles are replaced by static fil\", \"es in the ported app. The last line sets up data access for the app, which will be shown in a later \", \"section.\\n\\nSince this app isn't actually using areas, there's nothing that needs to be done to migrat\", \"e the area registration call. If your app does need to migrate areas, the docs specify how to config\", \"ure areas in ASP.NET Core.\\n\\nThe call to register global filters invokes a helper on the FilterConfig\", \" class in the app's App_Start folder:\\n\\n```\\npublic static void RegisterGlobalFilters(GlobalFilterColl\", \"ection filters) { filters.Add( new HandleErrorAttribute()); }\\n```\\n\\nThe only attribute added to the a\", \"pp is the ASP.NET MVC filter, HandleErrorAttribute. This filter ensures that when an exception occur\", \"s as part of a request, a default action and view are displayed, rather than the exception details. \", \"In ASP.NET Core, this same functionality is performed by the UseExceptionHandler middleware. The det\", \"ailed error messages aren't enabled by default. They must be configured using the UseDeveloperExcept\", \"ionPage middleware. To configure this behavior to match the original app, the following code must be\", \" added to the start of the Configure method in Startup.cs :\\n\\n```\\npublic void Configure(IApplicationB\", \"uilder app, IWebHostEnvironment env) { if (env.IsDevelopment()) { app.UseDeveloperExceptionPage(); }\", \" else { app.UseExceptionHandler(\\\"/Error\\\"); } // ... }\\n```\\n\\nThis takes care of the only filter used b\", \"y the eShop app, and in this case it was done by using built-in middleware. If you have global filte\", \"rs that must be configured in your app, this is done when MVC is added in Program.cs when you config\", \"ure services, which is shown later in this chapter.\\n\\nThe last piece of MVCrelated logic that needs t\", \"o be migrated are the app's default routes. The call to RouteConfig.RegisterRoutes(RouteTable.Routes\", \") passes the MVC route table to the RegisterRoutes helper method, where the following code is execut\", \"ed when the app starts up:\\n\\n```\\npublic static void RegisterRoutes(RouteCollection routes) { routes.M\", \"apMvcAttributeRoutes(); routes.IgnoreRoute(\\\"{resource}.axd/{*pathInfo}\\\"); routes.MapRoute( name: \\\"De\", \"fault\\\", url: \\\"{controller}/{action}/{id}\\\", defaults: new { controller = \\\"Catalog\\\", action = \\\"Index\\\",\", \" id = UrlParameter.Optional }\\n```\\n\\n```\\n); }\\n```\\n\\nTaking this code line-by-line, the first line sets \", \"up support for attribute routes. This is built into ASP.NET Core, so it's unnecessary to configure i\", \"t separately. Likewise, {resource}.axd files aren't used with ASP.NET Core, so there's no need to ig\", \"nore such routes. The MapRoute method configures the default for MVC, which uses the typical {contro\", \"ller}/{action}/{id} route template. It also specifies the defaults for this template, such that the \", \"CatalogController is the default controller used and the Index method is the default action. Larger \", \"apps will frequently include more calls to MapRoute to set up additional routes.\\n\\nASP.NET Core MVC s\", \"upports conventional routing and attribute routing. Conventional routing is analogous to how the rou\", \"te table is configured in the RegisterRoutes method listed previously. To set up conventional routin\", \"g with a default route like the one used in the eShop app, add the following code to the bottom of t\", \"he Configure method in Startup.cs :\\n\\n```\\napp.UseMvc(routes => { routes.MapRoute(\\\"default\\\", \\\"{control\", \"ler=Catalog}/{action=Index}/{id?}\\\"); });\\n```\\n\\n## Note\\n\\nWith ASP.NET Core 3.0 and later, this is chan\", \"ged to use endpoints. For the initial port to ASP.NET Core 2.2, this is the proper syntax for mappin\", \"g conventional routes.\\n\\nWith these changes in place, the Configure method is almost done. The origin\", \"al template's app.Run method that prints Hello World! should be deleted. At this point, the method i\", \"s as shown here:\\n\\n```\\npublic void Configure(IApplicationBuilder app, IHostingEnvironment env) { if (\", \"env.IsDevelopment()) { app.UseDeveloperExceptionPage(); } else { app.UseExceptionHandler(\\\"/Home/Erro\", \"r\\\"); } app.UseStaticFiles(); app.UseMvc(routes => { routes.MapRoute(\\\"default\\\", \\\"{controller=Catalog}\", \"/{action=Index}/{id?}\\\"); }); }\\n```\\n\\nNow it's time to configure MVC services, followed by the rest of\", \" the app's support for dependency injection (DI). So far, the eShopPorted project's Program.cs file \", \"hasn't added any service configuration. Now it's time to start adding necessary services.\\n\\nFirst, to\", \" get ASP.NET Core MVC to work properly, it needs to be added:\\n\\n```\\nbuilder.Services.AddMvc();\\n```\\n\\nT\", \"he preceding code is the minimal configuration required to get MVC features working. There are many \", \"additional features that can be configured from this call (some of which are detailed later in this \", \"chapter), but for now this will suffice to build the app. Running it now routes the default request \", \"properly, but since we've not yet configured DI, an error occurs while activating CatalogController,\", \" because no implementation of type ICatalogService has been provided yet. We'll return to configure \", \"MVC further in a moment. For now, let's migrate the app's dependency injection.\\n\\n## Migrate dependen\", \"cy injection configuration\\n\\nThe original app's Global.asax file defines the following method, called\", \" when the app starts up:\\n\\n```\\nprotected IContainer RegisterContainer() { var builder = new Container\", \"Builder(); builder.RegisterControllers( typeof (MvcApplication).Assembly); var mockData = bool.Parse\", \"(ConfigurationManager.AppSettings[\\\"UseMockData\\\"]); builder.RegisterModule( new ApplicationModule(moc\", \"kData)); var container = builder.Build(); DependencyResolver.SetResolver( new AutofacDependencyResol\", \"ver(container)); return container; }\\n```\\n\\nThis code configures an Autofac container, reads a config \", \"setting to determine whether real or mock data should be used, and passes this setting into an Autof\", \"ac module (found in the app's /Modules directory). Fortunately, Autofac supports .NET Core, so the m\", \"odule can be migrated directly. Copy the folder into the new project and updates the class's namespa\", \"ce and it should compile.\\n\\nASP.NET Core has built-in support for dependency injection, but you can w\", \"ire up a third-party container such as Autofac easily if necessary. In this case, since the app is a\", \"lready configured to use Autofac, the simplest solution is to maintain its usage. In Program.cs , si\", \"mply configure the builder to use the AutofacServiceProviderFactory as shown:\\n\\n```\\n// using Autofac.\", \"Extensions.DependencyInjection builder.Host.UseServiceProviderFactory( new AutofacServiceProviderFac\", \"tory()); // note: the factory calls builder.Populate so we don't need to here bool useMockData = tru\", \"e ; // TODO : read from config builder.Host.ConfigureContainer<ContainerBuilder>(builder => builder.\", \"RegisterModule( new ApplicationModule(useMockData)));\\n```\\n\\nFor now, the setting for useMockData is s\", \"et to true. This setting will be read from configuration in a moment. At this point, the app compile\", \"s and should load successfully when run, as shown in Figure 412.\\n\\nIF Index - Catalog manager (MVC) \\u00d7\", \"\\n\\n+ &gt; C\\u2022 localhost:44337\\n\\nCreate New\\n\\nNAME\\n\\n.NET Bot Black Hoodie\\n\\n.NET Black &amp; White Mug\\n\\nPr\", \"ism White T-Shirt\\n\\n.NET Foundation T-shirt\\n\\nRoslyn Red Sheet\\n\\nNET Blue Hoodie\\n\\nRoslyn Red T-Shirt\\n\\nK\", \"udu Purple Hoodie\\n\\nCupsT&gt; White Mug\\n\\n.NET Foundation Sheet\\n\\ne\\n\\neSHOP\\n\\nonCONTAINERS\\n\\nCatalog manag\", \"e* (MVC)\\n\\nFigure 4-12. Ported eShop app running locally with mock data.\\n\\n## Migrate app settings\\n\\nAS\", \"P.NET Core uses a new configuration system, which by default uses an appsettings.json file. By using\", \" CreateDefaultBuilder in Program.cs , the default configuration is already set up in the app. To acc\", \"ess configuration, classes just need to request it in their constructor. In Program.cs , configurati\", \"on is accessible from builder.Configuration.\\n\\nThe original app referenced its settings using Configu\", \"rationManager.AppSettings. A quick search for all references of this term yields the set of settings\", \" the new app needs. There are only two:\\n\\n- UseMockData\\n- UseCustomizationData\\n\\nIf your app has more \", \"complex configuration, especially if it's using custom configuration sections, you'll probably want \", \"to create and bind objects to different parts of your app's configuration. These types can then be a\", \"ccessed using the options pattern. However, as noted in the referenced doc, this pattern shouldn't b\", \"e used in Program.cs (or Startup.ConfigureServices). Instead the ported app will reference the UseMo\", \"ckData configuration value directly.\\n\\nFirst, modify the ported app's appsettings.json file and add t\", \"he two settings in the root:\\n\\n+\\n\\n-\\n\\n| Guest\\n\\n```\\n\\\"LogLevel\\\": { \\\"Default\\\": \\\"Warning\\\" } }, \\\"AllowedHos\", \"ts\\\": \\\"*\\\", \\\"UseMockData\\\": \\\"true\\\", \\\"UseCustomizationData\\\" :  \\\"true\\\" }\\n```\\n\\nNow, modify Program.cs to a\", \"ccess the UseMockData setting from the builder.Configuration property (where previously we set the v\", \"alue to true):\\n\\n```\\nbool useMockData = builder.Configuration.GetValue<bool>(\\\"UseMockData\\\");\\n```\\n\\nAt \", \"this point, the setting is pulled from configuration. The other setting, UseCustomizationData, is us\", \"ed by the CatalogDBInitializer class. When you first ported this class, you commented out the access\", \" to ConfigurationManager.AppSettings[\\\"UseCustomizationData\\\"]. Now it's time to modify it to use ASP.\", \"NET Core configuration. Modify the constructor of CatalogDBInitializer as follows:\\n\\n```\\n// add using\", \" Microsoft.Extensions.Configuration public CatalogDBInitializer(CatalogItemHiLoGenerator indexGenera\", \"tor, IConfiguration configuration) { this .indexGenerator = indexGenerator; useCustomizationData = c\", \"onfiguration.GetValue<bool>(\\\"UseCustomizationData\\\"); }\\n```\\n\\nAll access to configuration within the w\", \"eb app should be modified in this manner to use the new IConfiguration type. Dependencies that requi\", \"re access to .NET Framework configuration can include such settings in an app.config file added to t\", \"he web project. The dependent projects can work with ConfigurationManager to access settings, and sh\", \"ouldn't require any changes if they already use this approach. However, since ASP.NET Core apps run \", \"as their own executable, they don't refe rence web.config but rather app.config . By migrating setti\", \"ngs from the legacy app's web.config file to a new app.config file in the ASP.NET Core app, componen\", \"ts that use ConfigurationManager to access their settings will continue to function properly.\\n\\nThe a\", \"pp's migration is nearly complete. The only remaining task is data access configuration.\\n\\n## Data ac\", \"cess considerations\\n\\nASP.NET Core apps running on .NET Framework can continue to use Entity Framewor\", \"k (EF). If performing an incremental migration, getting the app working with EF 6 before trying to p\", \"ort its data access to use EF Core may be worthwhile. In this way, any proble ms with the app's migr\", \"ation can be identified and addressed before another block of migration effort is begun.\\n\\nAs it happ\", \"ens, configuring EF 6 in the eShop sample migration doesn't require any special work, since this wor\", \"k was performed in the Autofac ApplicationModule. The only problem is that currently the CatalogDBCo\", \"ntext class tries to read its connection string from web.config . To address this, the connection de\", \"tails need to be added to appsettings.json . Then the connection string must be passed into CatalogD\", \"BContext when it's created.\\n\\nUpdate the appsettings.json to include the connection string. The full \", \"file is listed here:\\n\\n```\\n{ \\\"ConnectionStrings\\\": { \\\"DefaultConnection\\\": \\\"Server=(localdb)\\\\\\\\mssqlloca\", \"ldb;Database=eShopPorted;Trusted_Connection=True;MultipleActive ResultSets=true\\\" }, \\\"Logging\\\": { \\\"Lo\", \"gLevel\\\": { \\\"Default\\\": \\\"Warning\\\" } }, \\\"AllowedHosts\\\": \\\"*\\\", \\\"UseMockData\\\": \\\"false\\\", \\\"UseCustomizationD\", \"ata\\\": \\\"true\\\" }\\n```\\n\\nThe connection string must be passed into the constructor when the DbContext is \", \"created. Since the instances are created by Autofac, the change needs to be made in ApplicationModul\", \"e. Modify the module to take in a connectionString in its constructor and assign it to a field. Then\", \" modify the registration for CatalogDBContext to add connection string as a parameter:\\n\\n```\\nbuilder.\", \"RegisterType<CatalogDBContext>() .WithParameter(\\\"connectionString\\\", _connectionString) .InstancePerL\", \"ifetimeScope();\\n```\\n\\nThe parameter must also be added to a new constructor overload in CatalogDBCont\", \"ext itself:\\n\\n```\\npublic CatalogDBContext(string connectionString) : base (connectionString) { }\\n```\\n\", \"\\nFinally, Program.cs must read the connection string from Configuration and pass it into the Applica\", \"tionModule when it instantiates it:\\n\\n```\\nbool useMockData = Configuration.GetValue<bool>(\\\"UseMockDat\", \"a\\\"); string connectionString = Configuration.GetConnectionString(\\\"DefaultConnection\\\"); builder.Regis\", \"terModule( new ApplicationModule(useMockData, connectionString));\\n```\\n\\nWith this code in place, the \", \"app runs as it did before, connecting to a SQL Server database when UseMockData is false.\\n\\nThe app c\", \"an be deployed and run in production at this point, converted to ASP.NET Core but still running on .\", \"NET Framework and EF 6. If desired, the app can be migrated to run on .NET Core and Entity Framework\", \" Core, which will bring additional advantages described in earlier chapters. Specific to Entity Fram\", \"ework, this documentation compares EF Core and EF 6 and includes a grid showing which library suppor\", \"ts each of dozens of individual features.\\n\\n## Migrate to Entity Framework Core\\n\\nAssuming a decision \", \"is made to migrate to EF Core, the steps can be fairly straightforward, especially if the original a\", \"pp used a code-based model approach. When preparing to port from EF 6 to EF Core, review the availab\", \"ility of features in the destination version of EF Core you'll be using. Review the documentation on\", \" porting from and EDMX-based model versus porting from a code-based model.\\n\\nTo upgrade to EF Core 2.\", \"2, the basic steps involved are to add the appropriate NuGet package(s) and update namespaces. Then \", \"adjust how the connection string is passed to the DbContext type and how they're wired up for depend\", \"ency injection.\\n\\nEF Core is added as a package reference to the project:\\n\\n```\\n< PackageReference Inc\", \"lude=\\\"Microsoft.EntityFrameworkCore\\\" Version=\\\"2.2.6\\\" />\\n```\\n\\nThe reference to EF 6 is removed:\\n\\n```\\n\", \"< PackageReference Include=\\\"EntityFramework\\\" Version=\\\"6.2.0\\\" />\\n```\\n\\nThe compiler will report errors\", \" in CatalogDBContext and CatalogDBInitializer. CatalogDbContext needs to have the old namespaces rem\", \"oved and replaced with Microsoft.EntityFrameworkCore. Its constructors can be removed. DbModelBuilde\", \"r should be replaced with ModelBuilder. The helper methods for configuring types are moved to separa\", \"te classes implementing\\n\\nIEntityTypeConfiguration&lt;T&gt;. Then the CatalogDBContext class's OnMode\", \"lCreating method simply becomes:\\n\\n```\\nprotected override void OnModelCreating(ModelBuilder builder) \", \"{ builder.ApplyConfigurationsFromAssembly(Assembly.GetExecutingAssembly()); base .OnModelCreating(bu\", \"ilder); }\\n```\\n\\nOther changes involved include:\\n\\n- HasDatabaseGeneratedOption(DatabaseGeneratedOption\", \".None) replaced with ValueGeneratedNever()\\n- HasRequired&lt;T&gt; replaced with HasOne&lt;T&gt;\\n- In\", \"stalled Microsoft.EntityFrameworkCore.Relational package\\n- Add a constructor to CatalogDBContext tak\", \"ing DbContextOptions and passing it to the base constructor\\n\\nAn example configuration class for Cata\", \"logType is shown here:\\n\\n```\\nusing Microsoft.EntityFrameworkCore; using Microsoft.EntityFrameworkCore\", \".Metadata.Builders; namespace eShopPorted.Models.Config { public class CatalogTypeConfig : IEntityTy\", \"peConfiguration<CatalogType> { public void Configure(EntityTypeBuilder<CatalogType> builder) { build\", \"er.ToTable(nameof(CatalogType)); builder.HasKey(ci => ci.Id); builder.Property(ci => ci.Id) .IsRequi\", \"red(); builder.Property(cb => cb.Type) .IsRequired() .HasMaxLength(100);\\n```\\n\\n```\\n} } }\\n```\\n\\nThe Cat\", \"alogDBInitializer and its base class, CreateDatabaseIfNotExists&lt;T&gt;, are incompatible with EF C\", \"ore. The purpose of this class is to create and seed the database. Using EF Core will create and dro\", \"p the associated database for a DbContext using these methods:\\n\\n```\\ndbContext.Database.EnsureDeleted\", \"(); dbContext.Database.EnsureCreated();\\n```\\n\\nSeeding data in EF Core can be done with manual scripts\", \", or as part of the type configuration. Along with other entity properties, seed data can be configu\", \"red in IEntityTypeConfiguration classes by using builder.HasData(). The original app loaded seed dat\", \"a from CSV files in the Setup directory. Given that there are only a handful of items, these data re\", \"cords can instead be added as part of the entity configuration. This approach works well for lookup \", \"data in tables that change infrequently. Adding the following to CatalogTypeConfig's Configure metho\", \"d ensures the associated rows are present when the database is created:\\n\\n```\\nbuilder.HasData( new Ca\", \"talogType { Id = 1, Type = \\\"Mug\\\" }, new CatalogType { Id = 2, Type = \\\"T-Shirt\\\" }, new CatalogType { \", \"Id = 3, Type = \\\"Sheet\\\" }, new CatalogType { Id = 4, Type = \\\"USB Memory Stick\\\" } );\\n```\\n\\nThe initial \", \"app includes a PreconfiguredData class, which includes data for CatalogBrand and CatalogType, so usi\", \"ng this method the HasData call reduces to:\\n\\n```\\nbuilder.HasData( PreconfiguredData.GetPreconfigured\", \"CatalogBrands() );\\n```\\n\\nThe CatalogItem data can also be pulled from PreconfiguredData, and assuming\", \" the associated images are kept in source control, that is the last table needed for the app to func\", \"tion. The CatalogDBInitializer class can be removed, along with any references to it. The CatalogIte\", \"mHiLoGenerator class and the SQL files in the Infrastructure directory are also removed, along with \", \"any references to them (in CatalogService, ApplicationModule).\\n\\nWith the elimination of the special \", \"key generator classes for CatalogItem, this code now is removed from CatalogItemConfig:\\n\\n```\\nbuilder\", \".Property(ci => ci.Id) .ValueGeneratedNever() .IsRequired();\\n```\\n\\nWith these modifications, the ASP.\", \"NET Core app builds, but it doesn't yet work with EF Core, which must still be configured for depend\", \"ency injection. With EF Core, the simplest way to configure it is in Program.cs :\\n\\n```\\nbuilder.Servi\", \"ces.AddMvc(); bool useMockData = builder.Configuration.GetValue<bool>(\\\"UseMockData\\\"); if (!useMockDa\", \"ta) {\\n```\\n\\n```\\nstring connectionString = builder.Configuration.GetConnectionString(\\\"DefaultConnectio\", \"n\\\"); builder.Services.AddDbContext<CatalogDBContext>(options => options.UseSqlServer(connectionStrin\", \"g) ); }\\n```\\n\\nThe final version of Autofac's ApplicationModule only configures one type, depending on\", \" whether the app is configured to use mock data:\\n\\n```\\npublic class ApplicationModule : Module { priv\", \"ate bool _useMockData; public ApplicationModule(bool useMockData) { _useMockData = useMockData; } pr\", \"otected override void Load(ContainerBuilder builder) { if (_useMockData) { builder.RegisterType<Cata\", \"logServiceMock>() .As<ICatalogService>() .SingleInstance(); } else { builder.RegisterType<CatalogSer\", \"vice>() .As<ICatalogService>() .InstancePerLifetimeScope(); } } }\\n```\\n\\nThe ported app runs, but does\", \"n't display any data if configured to use non-mock data. The seed data added through HasData is only\", \" inserted when migrations are applied. The source app didn't use migrations, and if it had, they wou\", \"ldn't migrate as -is. The best approach is to start with a new migration script. To do this, add a p\", \"ackage reference for Microsoft.EntityFrameworkCore.Design and open a terminal window in the project \", \"root. Then run:\\n\\ndotnet ef migrations add Initial\\n\\nDrop the existing eShopPorted database if it exis\", \"ts, then run:\\n\\ndotnet ef database update\\n\\nThis creates and seeds the database. It's now ready to run\", \", with a few small updates left to address.\\n\\n## Fix all TODO tasks\\n\\nRunning the ported app at this p\", \"oint reveals that no pictures are shown on the page. This is because the PictureUri property of Cata\", \"logItem is never set. Looking at the list of TODO items we created\\n\\nusing Visual Studio's Task List \", \", the only one that remains is in CatalogController, with a note to 'Reference pic from wwwroot.' Th\", \"e code in question is:\\n\\n```\\nprivate void AddUriPlaceHolder(CatalogItem item) { // TODO : Reference p\", \"ic from wwwroot //item.PictureUri = this.Url.RouteUrl(PicController.GetPicRouteName, new { catalogIt\", \"emId = item.Id }, this.Request.Url.Scheme); }\\n```\\n\\nThe simplest fix is to reference the public image\", \" files in the site's public wwwroot/Pics directory. This task can be accomplished by replacing the m\", \"ethod with the following code:\\n\\n```\\nprivate void AddUriPlaceHolder(CatalogItem item) { item.PictureU\", \"ri = $\\\"/Pics/{item.Id}.png\\\"; }\\n```\\n\\nWith this change, running the app reveals the images work as bef\", \"ore.\\n\\n## Additional MVC customizations\\n\\nThe eShopLegacyMVC app is fairly simple, so there isn't much\", \" to configure in terms of default MVC behavior. However, if you do need to configure additional MVC \", \"components, such as CORS, filters, and route constraints, you generally provide this information in \", \"Program.cs , where UseMvc is called. For example, the following code listing configures CORS and set\", \"s up a global action filter:\\n\\n```\\nbuilder.Services.AddCors(options => { options.AddPolicy(MyAllowSpe\", \"cificOrigins, builder => builder.WithOrigins(\\\"http://example.com\\\", \\\"http://www.contoso.com\\\") .AllowA\", \"nyHeader() .AllowAnyMethod()); }); builder.Services.AddMvc(options => { options.Filters.Add( new Sam\", \"pleGlobalActionFilter()); }).SetCompatibilityVersion(CompatibilityVersion.Version_2_2);\\n```\\n\\n## Note\", \"\\n\\nTo finish configuring CORS, you must also call app.UseCors() after building the application.\\n\\nOthe\", \"r advanced scenarios, like adding custom model binders, formatters, and more are covered in the deta\", \"iled ASP.NET Core docs. Generally these can be applied on an individual controller or action basis, \", \"or globally using the same options approach shown in the previous code listing.\\n\\n## Other dependenci\", \"es\\n\\nDependencies that use .NET Framework features that had a dependency on the legacy configuration \", \"model, such as the WCF client type and tracing code, must be modified when ported. Rather than havin\", \"g these types pull in their configuration information directly, they should be configured in code. F\", \"or example, a connection to a WCF service that was configured in an ASP.NET app's web.config to use \", \"basicHttpBinding could instead be configured programmatically with the following code:\\n\\n```\\nvar bind\", \"ing = new BasicHttpBinding(); binding.MaxReceivedMessageSize = 2_000_000; var endpointAddress = new \", \"EndpointAddress(\\\"http://localhost:9200/ExampleService\\\"); var myClient = new MyServiceClient(binding,\", \" endpointAddress);\\n```\\n\\nRather than relying on config files for its settings, WCF clients and other \", \".NET Framework types should have their settings specified in code. Configured in this manner, these \", \"types can continue to work in ASP.NET Core 2.2 apps.\\n\\n## References\\n\\n- eShopModernizing GitHub repos\", \"itory\\n- .NET Upgrade Assistant tool\\n- Your API and ViewModels Should Not Reference Domain Models\\n- D\", \"eveloper Exception Page Middleware\\n- Deep Dive into EF Core HasData\\n\\n## More migration scenarios\\n\\nTh\", \"is section describes several different ASP.NET app scenarios, and offers specific techniques for sol\", \"ving each of them. You can use this section to identify scenarios applicable to your app, and evalua\", \"te which techniques will work for your app and its hosting environment.\\n\\n## Migrate ASP.NET MVC 5 an\", \"d WebApi 2 to ASP.NET Core MVC\\n\\nA common scenario in ASP.NET MVC 5 and Web API 2 apps was for both p\", \"roducts to be installed in the same application. This is a supported and relatively common approach \", \"used by many teams, but because the two products use different abstractions, there is some redundant\", \" effort needed. For example, setting up routes for ASP.NET MVC is done using methods on RouteCollect\", \"ion, such as MapMvcAttributeRoutes() and MapRoute(). But ASP.NET Web API 2 routing is managed with H\", \"ttpConfiguration and methods like MapHttpAttributeRoutes() and MapHttpRoute().\\n\\nThe eShopLegacyMVC a\", \"pp includes both ASP.NET MVC and Web API, and includes methods in its App_Start folder for setting u\", \"p routes for both. It also supports dependency injection using Autofac, which also requires two sets\", \" of similar work to configure:\\n\\n```\\nprotected IContainer RegisterContainer() { var builder = new Con\", \"tainerBuilder(); var thisAssembly = Assembly.GetExecutingAssembly(); builder.RegisterControllers(thi\", \"sAssembly);      // MVC controllers builder.RegisterApiControllers(thisAssembly);   // Web API contr\", \"ollers var mockData = bool.Parse(ConfigurationManager.AppSettings[\\\"UseMockData\\\"]); builder.RegisterM\", \"odule( new ApplicationModule(mockData)); var container = builder.Build(); // set mvc resolver Depend\", \"encyResolver.SetResolver( new AutofacDependencyResolver(container)); // set webapi resolver var reso\", \"lver = new AutofacWebApiDependencyResolver(container); GlobalConfiguration.Configuration.DependencyR\", \"esolver = resolver; return container; }\\n```\\n\\nWhen upgrading these apps to use ASP.NET Core, this dup\", \"licate effort and the confusion that sometimes accompanies it is eliminated. ASP.NET Core MVC is a u\", \"nified framework with one set of rules for routing, filters, and more. Dependency injection is built\", \" into .NET Core itself. All of this can be configured in Program.cs , as is shown in the eShopPorted\", \" app in the sample.\\n\\n## Migrate HttpResponseMessage to ASP.NET Core\\n\\nSome ASP.NET Web API apps may h\", \"ave action methods that return HttpResponseMessage. This type does not exist in ASP.NET Core. Below \", \"is an example of its usage in a Delete action method, using the ResponseMessage helper method on the\", \" base ApiController:\\n\\n```\\n// DELETE api/<controller>/5 [HttpDelete] public IHttpActionResult Delete(\", \"int id) { var brandToDelete = _service.GetCatalogBrands().FirstOrDefault(x => x.Id == id); if (brand\", \"ToDelete == null ) { return ResponseMessage( new HttpResponseMessage(HttpStatusCode.NotFound)); } //\", \" demo only - don't actually delete return ResponseMessage( new HttpResponseMessage(HttpStatusCode.OK\", \")); }\\n```\\n\\nIn ASP.NET Core MVC, there are helper methods available for all of the common HTTP respon\", \"se status codes, so the above method would be ported to the following code:\\n\\n```\\n[HttpDelete(\\\"{id}\\\")\", \"] public IActionResult Delete(int id) { var brandToDelete = _service.GetCatalogBrands().FirstOrDefau\", \"lt(x => x.Id == id); if (brandToDelete == null ) {\\n```\\n\\n```\\nreturn NotFound(); } // demo only - don'\", \"t actually delete return Ok(); }\\n```\\n\\nIf you do find that you need to return a custom status code fo\", \"r which no helper exists, you can always use return StatusCode(int statusCode) to return any numeric\", \" code you like.\\n\\n## Migrate content negotiation from ASP.NET Web API to ASP.NET Core\\n\\nASP.NET Web AP\", \"I 2 supports content negotiation natively. The sample app includes a BrandsController that demonstra\", \"tes this support by listing its results in either XML or JSON. This is based on the request's Accept\", \" header, and changes when it includes application/xml or application/json.\\n\\nASP.NET MVC 5 apps do no\", \"t have content negotiation support built in.\\n\\nContent negotiation is preferable to returning a speci\", \"fic encoding type, as it is more flexible and makes the API available to a larger number of clients.\", \" If you currently have action methods that return a specific format, you should consider modifying t\", \"hem to return a result type that supports content negotiation when you port the code to ASP.NET Core\", \".\\n\\nThe following code returns data in JSON format regardless of client Accept header content:\\n\\n```\\n[\", \"HttpGet] public ActionResult Index() { return Json( new { Message = \\\"Hello World!\\\" }); }\\n```\\n\\nASP.NE\", \"T Core MVC supports content negotiation natively, provided an appropriate return type is used. Conte\", \"nt negotiation is implemented by [ObjectResult] which is returned by the status codespecific action \", \"results returned by the controller helper methods. The previous action method, implemented in ASP.NE\", \"T Core MVC and using content negotiation, would be:\\n\\n```\\npublic IActionResult Index() { return Ok( n\", \"ew { Message = \\\"Hello World!\\\"} ); }\\n```\\n\\nThis will default to returning the data in JSON format. XML\", \" and other formats will be used if the app has been configured with the appropriate formatter.\\n\\n## C\", \"ustom model binding\\n\\nMost ASP.NET MVC and Web API apps make use of model binding. The default model \", \"binding syntax migrates fairly seamlessly between these apps and ASP.NET Core MVC. However, in some \", \"cases customers have written custom model binders to support specific model types or usage scenarios\", \". Custom model binders in ASP.NET MVC and Web API projects use separate IModelBinder interfaces defi\", \"ned in System.Web.Mvc and System.Web.Http namespaces, respectively. In both cases, the custom\\n\\nbinde\", \"r exposes a Bind method that accepts a controller or action context and a model binding context as a\", \"rguments.\\n\\nOnce the custom binder is created, it must be registered with the app. This step requires\", \" creating another type, a ModelBinderProvider, which acts as a factory and creates the model binder \", \"during a request. Binders can be added during ApplicationStart in MVC apps as shown:\\n\\n```\\nModelBinde\", \"rProviders.BinderProviders.Insert(0, new MyCustomBinderProvider()); // MVC\\n```\\n\\nIn Web API apps, cus\", \"tom binders can be referenced using attributes. The ModelBinder attribute can be added to action met\", \"hod parameters or to the parameter's type definition, as shown:\\n\\n```\\n// attribute on action method p\", \"arameter public HttpResponseMessage([ModelBinder( typeof (MyCustomBinder))] CustomDTO custom) { } //\", \" attribute on type [ModelBinder( typeof (MyCustomBinder))] public class CustomDTO { }\\n```\\n\\nTo regist\", \"er a model binder globally in ASP.NET Web API, its provider must be added during app startup:\\n\\n```\\np\", \"ublic static class WebApiConfig { public static void Register(HttpConfiguration config) { var provid\", \"er = new CustomModelBinderProvider( typeof (CustomDTO), new CustomModelBinder()); config.Services.In\", \"sert( typeof (ModelBinderProvider), 0, provider); // ... } }\\n```\\n\\nWhen migrating custom model provid\", \"ers to ASP.NET Core, the Web API pattern is closer to the ASP.NET Core approach than the ASP.NET MVC\", \" 5. The main differences between ASP.NET Core's IModelBinder interface and Web API's is that the ASP\", \".NET Core method is async (BindModelAsync) and it only requires a single BindingModelContext paramet\", \"er instead of two parameters like Web API's version required. In ASP.NET Core, you can use a [ModelB\", \"inder] attribute on individual action method parameters or their associated types. You can also crea\", \"te a ModelBinderProvider that will be used globally within the app where appropriate. To configure s\", \"uch a provider, you would add code to Program.cs :\\n\\n```\\nbuilder.Services.AddControllers(options => {\", \" options.ModelBinderProviders.Insert(0, new CustomModelBinderProvider()); });\\n```\\n\\n## Media formatte\", \"rs\\n\\nASP.NET Web API supports multiple media formats and can be extended by using custom media format\", \"ters. The docs describe an example CSV Media Formatter that can be used to send data in a commasepar\", \"ated value format. If your Web API app uses custom media formatters, you'll need to convert them to \", \"ASP.NET Core custom formatters.\\n\\nTo create a custom formatter in Web API 2, you inherited from an ap\", \"propriate base class and then added the formatter to the Web API pipeline using the HttpConfiguratio\", \"n object:\\n\\n```\\npublic static void ConfigureApis(HttpConfiguration config) { config.Formatters.Add( n\", \"ew ProductCsvFormatter()); }\\n```\\n\\nIn ASP.NET Core, the process is similar. ASP.NET Core supports bot\", \"h input formatters (used by model binding) and output formatters (used to format responses). Adding \", \"a custom formatter to output responses in a specific way involves inheriting from an appropriate bas\", \"e class and adding the formatter to MVC in Program.cs :\\n\\n```\\nbuilder.Services.AddControllers(options\", \" => { options.InputFormatters.Insert(0, new CustomInputFormatter()); options.OutputFormatters.Insert\", \"(0, new CustomOutputFormatter()); });\\n```\\n\\nYou'll find a complete list of base classes in the Micros\", \"oft.AspNetCore.Mvc.Formatters namespace.\\n\\nThe steps to migrate from a Web API formatter to an ASP.NE\", \"T Core MVC formatter are:\\n\\n1. Identify an appropriate base class for the new formatter.\\n2. Create a \", \"new instance of the base class and implement its required methods.\\n3. Copy over the functionality fr\", \"om the Web API formatter to the new implementation.\\n4. Configure MVC in the ASP.NET Core App's Confi\", \"gureServices method to use the new formatter.\\n\\n## Custom filters\\n\\nFilters are used in ASP.NET Core a\", \"pps to execute code before and/or after certain stages in the request processing pipeline. ASP.NET M\", \"VC and Web API also use filters in much the same way, but the details vary. For instance, ASP.NET MV\", \"C supports four kinds of filters. ASP.NET Web API 2 supports similar filters, and both MVC and Web A\", \"PI included attributes to override filters.\\n\\nThe most common filter used in ASP.NET MVC and Web API \", \"apps is the action filter, which is defined by an IActionFilter interface. This interface provides m\", \"ethods for before (OnActionExecuting) and after (OnActionExecuted) which can be used to execute code\", \" before and/or after an action executes, as noted for each method.\\n\\nASP.NET Core continues to suppor\", \"t filters, and its unification of MVC and Web API means there is only one approach to their implemen\", \"tation. The docs include detailed coverage of the five (5) kinds of filters built into ASP.NET Core \", \"MVC. All of the filter variants supported in ASP.NET MVC and ASP.NET\\n\\nWeb API have associated versio\", \"ns in ASP.NET Core, so migration is generally just a matter of identifying the appropriate interface\", \" and/or base class and migrating the code over.\\n\\nIn addition to the synchronous interfaces, ASP.NET \", \"Core also provides async interfaces like IAsyncActionFilter which provide a single async method that\", \" can be used to incorporate code to run both before and after the action, as shown:\\n\\n```\\npublic clas\", \"s SampleAsyncActionFilter : IAsyncActionFilter { public async Task OnActionExecutionAsync( ActionExe\", \"cutingContext context, ActionExecutionDelegate next) { // Do something before the action executes. /\", \"/ next() calls the action method. var resultContext = await next(); // resultContext.Result is set. \", \"// Do something after the action executes. } }\\n```\\n\\nWhen migrating async code (or code that should b\", \"e async), teams should consider leveraging the built in async types that are provided for this purpo\", \"se.\\n\\nMost ASP.NET MVC and Web API apps do not use a large number of custom filters. Since the approa\", \"ch to filters in ASP.NET Core MVC is closely aligned with filters in ASP.NET MVC and Web API, the mi\", \"gration of custom filters is generally fairly straightforward. Be sure to read the detailed document\", \"ation on filters in ASP.NET Core's docs, and once you're sure you have a good understanding of them,\", \" port the logic from the old system to the new system's filters.\\n\\n## Route constraints\\n\\nASP.NET Core\", \" uses route constraints to help ensure requests are routed properly to route a request. ASP.NET Core\", \" supports a large number of different route constraints for this purpose. Route constraints can be a\", \"pplied in the route table, but most apps built with ASP.NET MVC 5 and/or ASP.NET Web API 2 use inlin\", \"e route constraints applied to attribute routes. Inline route constraints use a format like this one\", \":\\n\\n```\\n[Route(\\\"/customer/{id:int}\\\")]\\n```\\n\\nThe :int after the id route parameter constrains the value\", \" to match the int type. One benefit of using route constraints is that they allow for two otherwise-\", \"identical routes to exist where the parameters differ only by their type. This allows for the equiva\", \"lent of method overloading of routes based solely on parameter type.\\n\\nThe set of route constraints, \", \"their syntax, and usage is very similar between all three approaches. Custom route constraints are f\", \"airly rare in customer applications. If your app uses a custom route constraint and needs to port to\", \" ASP.NET Core, the docs include examples showing how to create custom route constraints in ASP.NET C\", \"ore . Essentially all that's required is to implement IRouteConstraint and its Match method, and the\", \"n add the custom constraint when configuring routing for the app:\\n\\n```\\nbuilder.Services.AddControlle\", \"rs(); builder.Services.AddRouting(options => { options.ConstraintMap.Add(\\\"customName\\\", typeof (MyCus\", \"tomConstraint)); });\\n```\\n\\nThis is very similar to how custom constraints are used in ASP.NET Web API\", \", which uses IHttpRouteConstraint and configures it using a resolver and a call to HttpConfiguration\", \".MapHttpAttributeRoutes:\\n\\n```\\npublic static class WebApiConfig { public static void Register(HttpCon\", \"figuration config) { var constraintResolver = new DefaultInlineConstraintResolver(); constraintResol\", \"ver.ConstraintMap.Add(\\\"nonzero\\\", typeof (CustomConstraint)); config.MapHttpAttributeRoutes(constrain\", \"tResolver); } }\\n```\\n\\nASP.NET MVC 5 follows a very similar approach, using IRouteConstraint for its i\", \"nterface name and configuring the constraint as part of route configuration:\\n\\n```\\npublic class Route\", \"Config { public static void RegisterRoutes(RouteCollection routes) { routes.IgnoreRoute(\\\"{resource}.\", \"axd/{*pathInfo}\\\"); var constraintsResolver = new DefaultInlineConstraintResolver(); constraintsResol\", \"ver.ConstraintMap.Add(\\\"values\\\", typeof (ValuesConstraint)); routes.MapMvcAttributeRoutes(constraints\", \"Resolver); } }\\n```\\n\\nMigrating route constraint usage as well as custom route constraints to ASP.NET \", \"Core is typically very straightforward.\\n\\n## Custom route handlers\\n\\nAnother fairly advanced feature o\", \"f ASP.NET MVC 5 is route handlers. Custom route handlers implement IRouteHandler, which includes a s\", \"ingle method that returns an IHttpHandler for a give request. The IHttpHandler, in turn, exposes an \", \"IsReusable property and a single ProcessRequest method. In ASP.NET MVC 5, you can configure a partic\", \"ular route in the route table to use your custom handler:\\n\\n```\\npublic static void RegisterRoutes(Rou\", \"teCollection routes) { routes.IgnoreRoute(\\\"{resource}.axd/{*pathInfo}\\\"); routes.Add( new Route(\\\"cust\", \"om\\\", new CustomRouteHandler())); }\\n```\\n\\nTo migrate custom route handlers from ASP.NET MVC 5 to ASP.N\", \"ET Core, you can either use a filter (such as an action filter) or a custom IRouter. The filter appr\", \"oach is relatively straightforward, and can be added as a global filter when MVC is added to the app\", \"'s services during startup:\\n\\n```\\nbuilder.Services.AddMvc(options => { options.Filters.Add( typeof (C\", \"ustomActionFilter)); });\\n```\\n\\nThe IRouter option requires implementing the interface's RouteAsync an\", \"d GetVirtualPath methods. The custom router is added to the request pipeline during app startup.\\n\\n``\", \"`\\n// ... app.UseMvc(routes => { routes.Routes.Add( new CustomRouter(routes.DefaultHandler)); });\\n```\", \"\\n\\nIn ASP.NET Web API, these handlers are referred to as custom message handlers, rather than route h\", \"andlers . Message handlers must derive from DelegatingHandler and override its SendAsync method. Mes\", \"sage handlers can be chained together to form a pipeline in a fashion that is very similar to ASP.NE\", \"T Core middleware and its request pipeline.\\n\\nASP.NET Core has no DelegatingHandler type or separate \", \"message handler pipeline. Instead, such handlers should be migrated using global filters, custom IRo\", \"uter instances (see above), or custom middleware. ASP.NET Core MVC filters and IRouter types have th\", \"e advantage of having built-in access to MVC constructs like controllers and actions, while middlewa\", \"re is a lower level approach that has no ties to MVC. This makes it more flexible but also requires \", \"more effort if you need to access MVC components.\\n\\n## CORS support\\n\\nCORS, or Cross-Origin Resource S\", \"haring, is a W3C standard that allows servers to accept requests that don't originate from responses\", \" they've served. ASP.NET MVC 5 and ASP.NET Web API 2 support CORS in different ways. The simplest wa\", \"y to enable CORS support in ASP.NET MVC 5 is with an action filter like this one:\\n\\n```\\npublic class \", \"AllowCrossSiteAttribute : ActionFilterAttribute { public override void OnActionExecuting(ActionExecu\", \"tingContext filterContext) { filterContext.RequestContext.HttpContext.Response.AddHeader( \\\"Access-Co\", \"ntrol-Allow-Origin\\\", \\\"example.com\\\"); base .OnActionExecuting(filterContext); } }\\n```\\n\\nASP.NET Web AP\", \"I can also use such a filter, but it has built-in support for enabling CORS as well:\\n\\n```\\npublic sta\", \"tic class WebApiConfig { public static void Register(HttpConfiguration config) { config.EnableCors()\", \";\\n```\\n\\n```\\n// ... } }\\n```\\n\\nOnce this is added, you can configure allowed origins, headers, and metho\", \"ds using the EnableCors attribute, like so:\\n\\n```\\n[EnableCors(origins: \\\"https://dot.net\\\", headers: \\\"*\", \"\\\", methods: \\\"*\\\")] public class TestController : ApiController { // Controller methods not shown... }\", \"\\n```\\n\\nBefore migrating your CORS implementation from ASP.NET MVC 5 or ASP.NET Web API 2, be sure to \", \"review how CORS works and create some automated tests that demonstrate CORS is working as expected i\", \"n your current system.\\n\\nIn ASP.NET Core, there are three built-in ways to enable CORS:\\n\\n- Configured\", \" via policy in ConfigureServices\\n- Enabled with endpoint routing\\n- Enabled with the EnableCors attri\", \"bute\\n\\nEach of these approaches is covered in detail in the docs, which are linked from the above opt\", \"ions. Which one you choose will largely depend on how your existing app supports CORS. If the app us\", \"es attributes, you can probably migrate to use the EnableCors attribute most easily. If your app use\", \"s filters, you could continue using that approach (though it's not the typical approach used in ASP.\", \"NET Core), or migrate to use attributes or policies. Endpoint routing is a relatively new feature in\", \"troduced with ASP. NET Core 3 and as such it doesn't have a close analog in ASP.NET MVC 5 or ASP.NET\", \" Web API 2 apps.\\n\\n## Custom areas\\n\\nMany ASP.NET MVC apps use Areas to organize the project. Areas ty\", \"pically reside in the root of the project in an Areas folder, and must be registered when the applic\", \"ation starts, typically in Application_Start():\\n\\n```\\nAreaRegistration.RegisterAllAreas();\\n```\\n\\nAn al\", \"ternative to registering all areas in startup is to use the RouteArea attribute on individual contro\", \"llers:\\n\\n```\\n[RouteArea(\\\"Admin\\\")] public class SomeController : Controller When using Areas, addition\", \"al arguments are passed into HTML helper methods to generate links to actions in different areas: @H\", \"tml.ActionLink(\\\"News\\\", \\\"Index\\\", \\\"News\\\", new { area = \\\"News\\\" }, null)\\n```\\n\\nASP.NET Web API apps don't\", \" typically use areas explicitly, since their controllers can be placed in any folder in the project.\", \" Teams can use any folder structure they like to organize their API controllers.\\n\\nAreas are supporte\", \"d in ASP.NET Core MVC. The approach used is nearly identical to the use of areas in ASP.NET MVC 5. D\", \"evelopers migrating code using areas should keep in mind the following differences:\\n\\n- AreaRegistrat\", \"ion.RegisterAllAreas is not used in ASP.NET Core MVC\\n- Areas are applied using the [Area(\\\"name\\\")] at\", \"tribute (not RouteArea as in ASP.NET MVC 5)\\n- Areas can be added to the route table templates, if de\", \"sired (or they can use attribute routing)\\n\\nTo add area support to the route table in ASP.NET Core MV\", \"C, you would add the following during app startup:\\n\\n```\\napp.UseEndpoints(endpoints => { endpoints.Ma\", \"pControllerRoute( name: \\\"MyArea\\\", pattern: \\\"{area:exists}/{controller=Home}/{action=Index}/{id?}\\\"); \", \"endpoints.MapControllerRoute( name: \\\"default\\\", pattern: \\\"{controller=Home}/{action=Index}/{id?}\\\"); }\", \");\\n```\\n\\nAreas can also be used with attribute routing, using the {area} keyword in the route definit\", \"ion (it's one of several reserved routing names that can be used with route templates).\\n\\nTag helpers\", \" support areas with the asp-area attribute, which can be used to generate links in Razor views and p\", \"ages:\\n\\n```\\n<ul> <li> <a asp-area=\\\"Products\\\" asp-controller=\\\"Home\\\" asp-action=\\\"About\\\"> Products/Home/\", \"About </a> </li> <li> <a asp-area=\\\"Services\\\" asp-controller=\\\"Home\\\" asp-action=\\\"About\\\"> Services Abou\", \"t </a> </li> <li> <a asp-area=\\\"\\\" asp-controller=\\\"Home\\\" asp-action=\\\"About\\\"> /Home/About </a> </li> </\", \"ul>\\n```\\n\\nIf you're migrating to Razor Pages you will need to use an Areas folder in your Pages folde\", \"r. For more information, see Areas with Razor Pages.\\n\\nIn addition to the above guidance, teams shoul\", \"d review how routing in ASP.NET Core works with areas as part of their migration planning process.\\n\\n\", \"## Integration tests for ASP.NET MVC and ASP.NET Web API\\n\\nIntegration tests are automated tests that\", \" verify several different parts of an app work together correctly. Writing integration tests for ASP\", \".NET MVC and ASP.NET Web API usually involved deploying\\n\\nthe app to a real web server, such as a loc\", \"al instance of IIS or IIS Express, and then making requests to this hosted application using an HTTP\", \" client. Some of these tests may interact with the client-side user interface using browser automati\", \"on tools like Selenium, though often these are referred to as UI tests rather than integration tests\", \".\\n\\nIf your migrated app shares the same behavior as its original version, whatever existing technolo\", \"gy the team is using to perform integration tests (and UI tests) should continue to work just as it \", \"did before. These tests are usually indifferent to the unde rlying technology used to host the app t\", \"hey're testing, and interact with it only through HTTP requests. Where things may get more challengi\", \"ng is with how the tests interact with the app to get it into a known good state prior to each test.\", \" This may require some migration effort, since configuration and startup are significantly different\", \" in ASP.NET Core compared to ASP.NET MVC or ASP.NET Web API.\\n\\nTeams should strongly consider migrati\", \"ng their integration tests to use ASP.NET Core's built -in integration testing support. In ASP.NET C\", \"ore, apps can be tested by deploying them to a TestHost, which is configured using a WebApplicationF\", \"actory. There's a little bit of setup required to host the app for testing, but once this is in plac\", \"e, creating individual integration tests is very straightforward.\\n\\nOne of the best features of ASP.N\", \"ET Core's integration testing support is that the app is hosted in memory. There's no need to config\", \"ure a real webserver to host the app. There's no need to use a browser automation tool (if you're on\", \"ly testing ASP.NET Core and not client-side behavior). Many of the problems that can be encountered \", \"when trying to use a real web server for automated integration tests, such as firewall issues or pro\", \"cess start/stop issues, are eliminated with this approach. Since the requests are all made in memory\", \" with no network requirement, the tests also tend to run much faster than tests that must set up a s\", \"eparate webserver and communicate with it over the network (even if it's running on the same machine\", \").\\n\\nBelow you can see an example ASP.NET Core integration test (sometimes referred to as functional \", \"tests to distinguish them from lower-level integration tests) from the eShopOnWeb reference applicat\", \"ion:\\n\\n```\\npublic class GetByIdEndpoint : IClassFixture<ApiTestFixture> { JsonSerializerOptions _json\", \"Options = new JsonSerializerOptions { PropertyNameCaseInsensitive = true }; public GetByIdEndpoint(A\", \"piTestFixture factory) { Client = factory.CreateClient(); } public HttpClient Client { get ; } [Fact\", \"] public async Task ReturnsItemGivenValidId() { var response = await Client.GetAsync(\\\"api/catalog-it\", \"ems/5\\\"); response.EnsureSuccessStatusCode(); var stringResponse = await response.Content.ReadAsStrin\", \"gAsync(); var model = stringResponse.FromJson<GetByIdCatalogItemResponse>(); Assert.Equal(5, model.C\", \"atalogItem.Id); Assert.Equal(\\\"Roslyn Red Sheet\\\", model.CatalogItem.Name);\\n```\\n\\nIf the app being migr\", \"ated has no integration tests, the migration process can be a great opportunity to add some. These t\", \"ests can verify that the migrated app behaves as the team expects. When such tests are in place earl\", \"y in a migration, they can ensure that later migration efforts do not break previously migrated port\", \"ions of the app. Given how easy it is to set up and run integration tests in ASP.NET Core, the retur\", \"n on the investment spent setting up such tests is usually pretty high.\\n\\n## WCF client configuration\", \"\\n\\nIf your app currently relies on WCF services as a client, this scenario is supported. However, you\", \" will need to migrate your configuration from web.config to use the new appsettings.json file. Anoth\", \"er option is to add any necessary configuration to your clients programmatically when you create the\", \"m. For example:\\n\\nIf your organization has extensive services built using WCF that your app relies on\", \", consider migrating them to use gRPC instead. For more details on gRPC, why you may wish to migrate\", \", and a detailed migration guide, consult the gRPC for WCF Developers eBook.\\n\\n## References\\n\\n- ASP.N\", \"ET Web API Content Negotiation\\n- Format response data in ASP.NET Core Web API\\n- Custom Model Binders\", \" in ASP.NET Web API\\n- Custom Model Binders in ASP.NET Core\\n- Media Formatters in ASP.NET Web API 2\\n-\", \" Custom formatters in ASP.NET Core Web API\\n- Filters in ASP.NET Core\\n- Route constraints in ASP.NET \", \"Web API 2\\n- Route constraints in ASP.NET MVC 5\\n- ASP.NET Core Route Constraint Reference\\n- Custom me\", \"ssage handlers in ASP.NET Web API 2\\n- Simple CORS control in MVC 5 and Web API 2\\n- Enabling Cross-Or\", \"igin Requests in Web API\\n- Enable Cross-Origin Requests (CORS) in ASP.NET Core\\n- Areas in ASP.NET Co\", \"re\\n- Integration tests in ASP.NET Core\\n\\n## Deployment scenarios when migrating to ASP.NET Core\\n\\nExis\", \"ting ASP.NET MVC and Web API apps run on IIS and Windows. Large apps may require a phased or side-by\", \"-side approach when porting to ASP.NET Core. In previous chapters, you learned a number of strategie\", \"s for migrating large .NET Framework apps to ASP.NET Core in phases. In this chapter, you will see h\", \"ow different deployment scenarios can be achieved when there is a need to maintain the original app \", \"in production while migrating portions of it.\\n\\n## Split a large web app\\n\\nConsider the common scenari\", \"o of a large web app that currently is hosted on IIS in a single web site. Within the large app, fun\", \"ctionality is segmented into different routes and/or directories. The app is a mix of MVC views and \", \"API endpoints. The MVC routes include many different paths based on functionality and all start from\", \" the root of the app using the standard /{controller}/{action}/{id?} route template. The API endpoin\", \"ts follow a similar pattern, but are all under an /api root.\\n\\nAssuming the task of porting the app i\", \"s split such that either the MVC functionality or the API functionality is migrated to ASP.NET Core \", \"first, how would the original site continue to function seamlessly with the new ASP.NET Core app run\", \"ning somewhere else? Users of the system should continue to see the same URLs they did prior to the \", \"migration, unless it's absolutely necessary to change them.\\n\\nFortunately, IIS is a feature-rich web \", \"server, and two features it has are URL Rewrite module and Application Request Routing. Using these \", \"features, IIS can act as a reverse proxy, routing client requests to the appropriate back-end web ap\", \"p. To configure IIS as a reverse proxy, check the Enable proxy checkbox in the Application Request R\", \"outing feature, then add a URL Rewrite rule like this one:\\n\\n```\\n< rule name=\\\"NetCoreProxy\\\"> < match \", \"url=\\\"(.*)>\\\" /> < action type=\\\"Rewrite\\\" url=\\\"http://servername/{R:1}\\\" /> </ rule >\\n```\\n\\nAs a reverse \", \"proxy, IIS can route traffic matching certain patterns to entirely separate apps, potentially on dif\", \"ferent servers.\\n\\nUsing just the URL Rewrite module (perhaps combined with host headers), IIS can eas\", \"ily support multiple web sites, each potentially running different versions of .NET. A large web app\", \" might be deployed as a collection of individual sites, each responding to different IP addresses an\", \"d/or host headers, or as a single web site with one or more sub-applications in it responding to cer\", \"tain URL paths (which doesn't even require URL Rewrite).\\n\\n| Important                               \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                |\\n|---------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"------------------------------------------------------------------------|\\n| Subdomains typically ref\", \"er to the portion of a domain preceding the top two levels. For example, in the domain api.contoso.c\", \"om, api is a subdomain of the contoso.com domain (which itself is composed of the contoso domain nam\", \"e and the .com top-level domain or TLD). URL paths refer to portion of the URL that follows the doma\", \"in name, starting with a /. The URL https://contoso.com/api has a path of /api. |\\n\\nThere are pros an\", \"d cons to using the same or different subdomains (and domains) to host a single app. Features like c\", \"ookies and intra-app communication using mechanisms like CORS may require more configuration to work\", \" properly in distributed apps. However, apps that use different subdomains can more easily use DNS t\", \"o route requests to entirely different network destinations, and so can more easily be deployed to m\", \"any different servers (virtual or otherwise) without the need for IIS to act as a reverse proxy.\\n\\nIn\", \" the example described above, assume the API endpoints are designated as the first part of the app t\", \"o be ported to ASP.NET Core. In this case, a new ASP.NET Core app is created and hosted in IIS as a \", \"separate web application within the existing ASP.NET MVC web site . Since it will be added as a chil\", \"d of the original web site and will be named api , its default route should no longer begin with api\", \"/. Keeping this would result in it matching URLs of the form /api/api/endpoint.\\n\\nFigure 5-1 shows ho\", \"w the ASP.NET Core 2.1 api app appears in IIS Manager as a part of the existing DotNetMvcApp site.\\n\\n\", \"Internet Information Services (IIS) Manager\\n\\n\\u2022 NIGHTKING \\u2022 Sites \\u2022 DotNetMvcApp \\u2022\\n\\nFile View Help\\n\\nC\", \"onnections v .6g NIGHTKING (NIGHTKING\\\\stev\\n\\n..a Application Pools\\n\\nSites\\n\\nDotNetMvcApp aspnet_client\", \"\\n\\nbin\\n\\nContent fonts\\n\\nScripts\\n\\nViews api\\n\\nActions\\n\\nFigure 5-1. .NET Framework Site with .NET Core ap\", \"p in IIS.\\n\\nThe DotNetMvcApp site is hosted as an MVC 5 app running on .NET Framework 4.7.2. It has i\", \"ts own IIS app pool configured in integrated mode and running .NET CLR version 4.0.30319. The api ap\", \"p is an ASP.NET Core app running on .NET Framework 4.6.1 (net461). It was added to the DotNetMvcApp \", \"as a new IIS app and configured to use its own Application Pool. Its Application Pool is also runnin\", \"g in integrated mode but is configured with a .NET CLR version of No Managed Code since it will be e\", \"xecuted using the ASP.NET Core Module. The version of the ASP.NET Core app is just an example. It co\", \"uld also be configured to run on NET 5+. Though at that point, it would no longer be able to target \", \".NET Framework libraries (see Choose the Right .NET Core Version)\\n\\nConfigured in this manner, the on\", \"ly change that must be made in order for the ASP.NET Core app's APIs to be routed properly is to cha\", \"nge its default route template from [Route(\\\"[api/controller]\\\")] to [Route(\\\"[controller]\\\")].\\n\\nAlterna\", \"tely the ASP.NET Core app can be another top-level web site in IIS. In this case, you can configure \", \"the original site to use a rewrite rule (with URL Rewrite) that will redirect to the other app if th\", \"e path starts with /api. The ASP.NET Core app can use a different host header for its route so that \", \"it doesn't conflict with the main app but can still respond to requests using root -based routes.\\n\\nA\", \"s an example, the same ASP.NET Core app used in Figure 5-1 can be deployed to another folder configu\", \"red as an IIS web site. The site should use an app pool configured just as before, with No\\n\\nReady\\n\\nD\", \"otNetMvcApp Home\\n\\nX\\n\\n-\\n\\n* Internet Information Services (IIS) Manager\\n\\n&lt; \\u2192\\n\\n6] \\u2022 NIGHTKING \\u00bb\\n\\nFil\", \"e View\\n\\nHelp\\n\\nConnections la Application Pools\\n\\nV\\n\\nEdit Inbound Rule\\n\\nActions\\n\\nEy Apply\\n\\nManaged Cod\", \"e . Configure its bindings to respond to a unique host name on the server, such as api.contoso.com. \", \"To configure URL Rewrite to rewrite requests matching /api just add a new inbound rule at the IIS se\", \"rver (or individual site) level. Match the pattern ^/api(.*) and specify an Action type of Rewrite a\", \"nd a Rewrite URL of api.contoso.com/{R:1}. The combination of using (.*) in the matching pattern and\", \" {R:1} in the rewrite URL will ensure the rest of the path gets used with the new URL. With this in \", \"place, separate sites on the same IIS server can coexist running separate versions of .NET, but they\", \" can be made to appear to the Internet as one web app. Figure 5-2 shows the rewrite rule as configur\", \"ed in IIS with the separate web site.\\n\\nSites\\n\\nConfiguration: 'localhost' applicationHost.config\\n\\nFig\", \"ure 5-2. Rewrite rule to rewrite subfolder requests to another web site.\\n\\nIf your app requires singl\", \"e sign-on between different sites or apps within IIS, refer to the documentation on how to share aut\", \"hentication cookies among ASP.NET apps for detailed instructions on supporting this scenario.\\n\\nAnoth\", \"er alternative to IIS Rewrite rules is the use of a reverse proxy like YARP, which can facilitate in\", \"cremental ASP.NET to ASP.NET Core Migration.\\n\\n## Summary\\n\\nA common approach to porting large apps fr\", \"om .NET Framework to ASP.NET Core is to choose individual portions of the app to migrate one by one.\", \" As each piece of the app is ported, the entire app remains running and usable, with some parts of i\", \"t running in its original configuration and other parts running on some version of .NET Core. By fol\", \"lowing this approach, a large app migration can be performed incrementally. This approach results in\", \" limiting risk by providing more rapid feedback and\\n\\n\\u2022 0-\\n\\nreducing total surface area involved in t\", \"esting. It also allows for more rapid realization of benefits of .NET Core, such as performance incr\", \"eases. Although ASP.NET Core apps are no longer required to be hosted on IIS, IIS remains a very fle\", \"xible and powerful web server that can be configured to support a variety of hosting scenarios invol\", \"ving both .NET Framework and ASP.NET Core apps on the same IIS instance or even hosted on different \", \"servers.\\n\\n## References\\n\\n- Host ASP.NET Core on Windows with IIS\\n- URL Rewrite module and Applicatio\", \"n Request Routing\\n- URL Rewrite\\n- ASP.NET Core Module\\n- Share authentication cookies among ASP.NET a\", \"pps\\n- Samples used in this section\\n- Incremental ASP.NET to ASP.NET Core Migration\\n\\nCHAPTER\\n\\n## Summ\", \"ary: Port existing ASP.NET Apps to .NET 7\\n\\nIn this book, you've been given the resources needed to d\", \"ecide whether it makes sense to port your organization's existing ASP.NET apps running on .NET Frame\", \"work to ASP.NET Core. You've learned about important considerations for choosing when it makes sense\", \" to migrate to .NET Core, and when it may be appropriate to keep (parts of) your app on .NET Framewo\", \"rk. There are differences between .NET Core versions and their capabilities and compatibilities with\", \" .NET Framework, and you learned how to choose the right version of .NET Core for your app.\\n\\nPorting\", \" a large app often entails a fair amount of risk and effort. You learned how to mitigate this risk b\", \"y employing one or more incremental migration strategies along with several deployment strategies fo\", \"r keeping partially migrated apps running in production.\\n\\nThere are many architectural differences b\", \"etween ASP.NET and ASP.NET Core. In chapter 2, you learned about many of these differences and how t\", \"hey relate to your app's migration. This chapter covered everything from app startup and low-level m\", \"iddleware to high-level controller and Web API differences and new features enabling much better tes\", \"ting scenarios.\\n\\nLarge apps are often comprised of many projects and packages, and dependencies can \", \"play a major role in determining how easy or difficult migration may be. Chapter 3 helped you identi\", \"fy the sequence in which to migrate projects and how to understand and update your app's dependencie\", \"s . It also detailed additional strategies for migrating apps while keeping them running in producti\", \"on.\\n\\nIn chapter 4, you saw how a real ASP.NET MVC reference app was migrated to ASP.NET Core. This c\", \"hapter included a detailed breakdown of all the changes that were needed to take the existing app an\", \"d port it over to run on ASP.NET Core. Refer back to it if you have specific questions about the por\", \"ting process and some of its more specific details.\\n\\nFinally, chapter 5 detailed specific deployment\", \" scenarios focused on IIS. You saw how you can use your existing IIS web server to host parts of you\", \"r app that have been ported to ASP.NET Core while keeping the app's public URLs consistent. IIS incl\", \"udes great support for URL rewriting and request routing that enables it to host multiple versions o\", \"f your site side by side or even on different servers, with no change to the public-facing URLs the \", \"app exposes.\"]"