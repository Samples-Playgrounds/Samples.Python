"[\"## Porting existing ASP.NET apps to .NET 7\\n\\n<!-- image -->\\n\\nSteve \\\"ardalis\\\" Smith\\n\\n<!-- image -->\\n\\nP\", \"UBLISHED BY\\n\\nMicrosoft Developer Division, .NET, and Visual Studio product teams\\n\\nA division of Micr\", \"osoft Corporation\\n\\nOne Microsoft Way\\n\\nRedmond, Washington 98052-6399\\n\\nCopyright \\u00a9 2023 by Microsoft \", \"Corporation\\n\\nAll rights reserved. No part of this book's contents may be reproduced or transmitted i\", \"n any form or by any means without the written permission of the publisher.\\n\\nThis book is provided \\\"\", \"as-is\\\" and expresses the author's views and opinions. The views, opinions, and information expressed\", \" in this book, including URL and other Internet website references, may change without notice.\\n\\nSome\", \" examples depicted herein are provided for illustration only and are fictitious. No real association\", \" or connection is intended or should be inferred.\\n\\nMicrosoft and the trademarks listed at https://ww\", \"w.microsoft.com on the \\\"Trademarks\\\" webpage are trademarks of the Microsoft group of companies.\\n\\nMac\", \" and macOS are trademarks of Apple Inc.\\n\\nThe Docker whale logo is a registered trademark of Docker, \", \"Inc. Used by permission.\\n\\nAll other marks and logos are property of their respective owners.\\n\\nAuthor\", \"s:\\n\\nSteve \\\"ardalis\\\" Smith, Software Architect and Trainer -Ardalis.com\\n\\nParticipants and Reviewers:\\n\", \"\\nNish Anil, Senior Program Manager, .NET team, Microsoft\\n\\nMike Rousos, Principal Software Engineer, \", \".NET team, Microsoft\\n\\nScott Addie, Senior Content Developer, .NET team, Microsoft\\n\\nDavid Pine, Senio\", \"r Content Developer, .NET team, Microsoft\\n\\n## Version\\n\\nThis guide covers .NET 7 and updates related \", \"to the same technology \\\"wave\\\" (that is, Azure and other third -party technologies) coinciding in tim\", \"e with the .NET 7 release. This book covers migration of apps that are currently running on .NET Fra\", \"mework 4.x.\\n\\n## Who should use this guide\\n\\nThis guide's audience is developers, development leads, a\", \"nd architects who are interested in migrating their existing apps written for ASP.NET MVC and Web AP\", \"I (.NET Framework 4.x) to the latest\\n\\n<!-- image -->\\n\\n<!-- image -->\\n\\n.NET version. ASP.NET Web Form\", \"s developers will benefit from this guide but should also read the Blazor for ASP.NET Web Forms Deve\", \"lopers e-book.\\n\\nA secondary audience is technical decision-makers planning when to move their apps t\", \"o .NET 7.\\n\\nThe target audience for this book is .NET developers with large, existing apps that run o\", \"n ASP.NET MVC and Web API. Apps built on ASP.NET Web Forms are outside of the focus of this book, th\", \"ough much of the information comparing .NET Framework and .NET Core/latest may still be relevant.\\n\\n#\", \"# How you can use this guide\\n\\nYou can read this book straight through, as we expect many readers to \", \"do. This book will provide you first with considerations for whether you should port your app at all\", \". That content is followed by architectural differences between .NET Framework and .NET Core. From t\", \"here, you'll learn strategies for migrating a large solution over time and how to port a real app. N\", \"ext, the book includes deployment scenarios that address the need to run different apps while appear\", \"ing as a single app to users. The book concludes with two case studies describing real apps that hav\", \"e migrated from ASP.NET MVC to ASP.NET Core.\\n\\nWhether or not you choose to start from the first chap\", \"ter, you can reference any of these chapters to learn about specific concepts:\\n\\n- Architectural diff\", \"erences\\n- Migrate large solutions\\n- Sample migration\\n- Deployment scenarios\\n\\nThis guide is available\", \" both in PDF form and online. Feel free to forward this document or links to its online version to y\", \"our team to ensure a common understanding of these concepts.\\n\\n## Contents\\n\\n| Introduction to porting\", \" apps to .NET 7  ................................................................................  1\", \"                                                                         |\\n|------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-------------------------------------------------------------------------|\\n| References  ...........\", \"..................... ................................................................ .............\", \"................................................... .................. 2 |\\n| Migration consideration\", \"s ................................................................ .................................\", \"............................... ...................... 2                 |\\n| Is migration to .NET Co\", \"re appropriate?  ................................ ..................................................\", \".............. ..................... 2                                   |\\n| When is .NET Framework \", \"appropriate? ................................ ......................................................\", \".......... ...................... 3                                      |\\n| References ............\", \".................... ................................................................ ..............\", \".................................................. .............. 4      |\\n| Migrate to ASP.NET Core\", \" 2.1  ................................................................ .............................\", \"................................... .............. 4                     |\\n| Should apps run on .NET\", \" Framework with ASP.NET Core 2.1 ................................................................ ..\", \"......... 4                                                              |\\n| References ............\", \".................... ................................................................ ..............\", \".................................................. .............. 5      |\\n| Choose the right .NET C\", \"ore version  ................................................................ ......................\", \".......... ................................. 5                           |\\n| References ............\", \".................... ................................................................ ..............\", \".................................................. .............. 5      |\\n| Strategies for migratin\", \"g incrementally ................................ ...................................................\", \"............. ............................ 6                             |\\n| Migrating slice by slic\", \"e ................................................................ .................................\", \"............................... ...................... 6                 |\\n| Migrating layer by laye\", \"r ................................................................ .................................\", \"............................... .................... 6                   |\\n| References ............\", \".................... ................................................................ ..............\", \".................................................. .............. 7      |\\n| Strategies for migratin\", \"g ASP.NET Web Forms apps  ................................ ................................ ........\", \".......................... 7                                             |\\n| Separate business logic\", \" and other concerns ................................ ...............................................\", \"................. ............ 7                                         |\\n| Implement client behavi\", \"or and web APIs ................................ ...................................................\", \"............. .................. 8                                       |\\n| Consider Blazor .......\", \"......................... ................................................................ .........\", \"....................................................... .... 8           |\\n| Summary ...............\", \"................. ................................................................ .................\", \"............................................... ................. 8      |\\n| References ............\", \".................... ................................................................ ..............\", \".................................................. .............. 8      |\\n| Cloud native developmen\", \"t ................................................................ .................................\", \"............................... ..............                           |\\n| Leverage containers  ..\", \".............................. ................................ ....................................\", \"............................ ........................... 9               |\\n| 9                      \", \"                                                                                                    \", \"                                                                         |\\n| 9                      \", \"                                                                                                    \", \"                                                                         |\\n| Side - by-side deployme\", \"nt options ................................................................ ........................\", \"........ ................................                                |\\n| Other options on Window\", \"s ................................................................ .................................\", \"............................... ............. 9                          |\\n\\n| References ...........\", \"..................... ................................................................ .............\", \"................................................... .............. 9                                \", \"                                                                                                    \", \"                      |\\n|---------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------|\\n| Additional migration resou\", \"rces ................................................................ ..............................\", \".................................. .......  10                                                      \", \"                                                                                                    \", \"                  |\\n| Official documentation  ......................................................\", \".......... ................................................................ ..................  10  \", \"                                                                                                    \", \"                                                                  |\\n| GitHub  ......................\", \".......... ................................................................ ........................\", \"........................................ ..................  10                                     \", \"                                                                                                    \", \"              |\\n| Stack Overflow  ................................ .................................\", \"............................... ................................................................ .. \", \" 11                                                                                                 \", \"                                                              |\\n| YouTube channels .................\", \"............... ................................................................ ...................\", \"............. ............................  11                                                      \", \"                                                                                                    \", \"          |\\n| Twitter, Gitter, Slack, and other community channels .................................\", \"............................... .......................  11                                         \", \"                                                                                                    \", \"                                                          |\\n| References ...........................\", \"..... ................................................................ .............................\", \"................................... ...........  11                                                 \", \"                                                                                                    \", \"      |\\n| Architectural differences between ASP.NET MVC and ASP.NET Core ...........................\", \"..... ............... 12                                                                            \", \"                                                                                                    \", \"                                                      |\\n| Breaking changes .........................\", \"....... ................................................................ ...........................\", \"..................................... ..  12                                                        \", \"                                                                                                    \", \"  |\\n| App startup differences between ASP.NET MVC and ASP.NET Core  ................................\", \" ...............................  12                                                                \", \"                                                                                                    \", \"                                                  |\\n| ASP.NET MVC Startup  .........................\", \"....................................... ............................................................\", \".... ....................  13                                                                       \", \"                                                                                                  |\\n\", \"| ASP.NET Core Startup ................................................................ ............\", \".................................................... .....................  13                      \", \"                                                                                                    \", \"                                              |\\n| Porting considerations  ..........................\", \"...................................... .............................................................\", \"... ...................  14                                                                         \", \"                                                                                              |\\n| Re\", \"ferences ................................ ..........................................................\", \"...... ................................................................ ...........  14             \", \"                                                                                                    \", \"                                          |\\n| Hosting differences between ASP.NET MVC and ASP.NET Co\", \"re  ................................................................ .......  14                    \", \"                                                                                                    \", \"                                                                                          |\\n| Refere\", \"nces ................................ ..............................................................\", \".. ................................................................ ...........  15                 \", \"                                                                                                    \", \"                                      |\\n| Serve static files in ASP.NET MVC and ASP.NET Core  ......\", \".......................... ................................ ............................  15        \", \"                                                                                                    \", \"                                                                                      |\\n| Host stati\", \"c files in ASP.NET MVC  ................................................................ ...........\", \"..................... ...............................  15                                           \", \"                                                                                                    \", \"                                  |\\n| Host static files in ASP.NET Core ............................\", \".................................... ................................ ..............................\", \"..  15                                                                                              \", \"                                                                                  |\\n| References ...\", \"............................. ................................................................ .....\", \"........................................................... ...........  16                         \", \"                                                                                                    \", \"                              |\\n| Dependency injection differences between ASP.NET MVC and ASP.NET C\", \"ore ................................ ...........  16                                                \", \"                                                                                                    \", \"                                                                              |\\n| Dependency injecti\", \"on in ASP.NET Core  ................................ ...............................................\", \"................. ..................  16                                                            \", \"                                                                                                    \", \"                          |\\n| References ................................ ..........................\", \"...................................... .............................................................\", \"... ...........  17                                                                                 \", \"                                                                          |\\n| ASP.NET modules and ha\", \"ndlers  ................................................................ ...........................\", \"..................................... .  17                                                         \", \"                                                                                                    \", \"                      |\\n| ASP.NET Core middleware ..................................................\", \".............. ................................................................ ............  17    \", \"                                                                                                    \", \"                                                                      |\\n| ..........................\", \"...................................... .............................................................\", \"... ...................  17 References ................................ ............................\", \".................................... ...............................................................\", \". ...........  18 |\\n| Accessing HttpContext                                                         \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                  |\\n| Configuration differences betw\", \"een ASP.NET MVC and ASP.NET Core ................................ ...........................  18   \", \"                                                                                                    \", \"                                                                                                    \", \"              |\\n| ASP.NET Core configuration  ......................................................\", \".......... ................................................................ ........  19            \", \"                                                                                                    \", \"                                                              |\\n\\n| Migrate configuration  ..........\", \"...................................................... .............................................\", \"................... ....................             | 20                               |\\n|---------\", \"----------------------------------------------------------------------------------------------------\", \"------------------------------------------------------------------------------|---------------------\", \"-------------|\\n| References ................................ .......................................\", \"......................... ................................................................ .........\", \".. | 21                               |\\n| Routing differences between ASP.NET MVC and ASP.NET Core  \", \"................................................................                                    \", \"                            | .......  21                      |\\n| Routing in ASP.NET MVC and Web AP\", \"I  ................................ ................................................................\", \" ..................                                  | 21                               |\\n| Route ta\", \"ble  ................................ ..............................................................\", \".. ................................................................           | .........  21       \", \"             |\\n| Routing in .NET 7  ................................ ...............................\", \"................................. ................................ .............................    \", \"   | 23                               |\\n| References ................................ ..............\", \".................................................. .................................................\", \"............... ........... | 24                               |\\n| Logging differences between ASP.N\", \"ET MVC and ASP.NET Core  ................................................................           \", \"                                                     | ......  25                       |\\n| ASP.NET \", \"MVC logging  ................................................................ ......................\", \".......................................... ...................                | 25                  \", \"             |\\n| ASP.NET Core logging ..............................................................\", \".. ................................................................ ....................            \", \"   | 25                               |\\n| Migrate logging ................................ .........\", \"....................................................... ................................ ...........\", \".....................       | 26                               |\\n| References ......................\", \".......... ................................................................ ........................\", \"........................................             | ...........  26                  |\\n| Compare \", \"Razor Pages to ASP.NET MVC ................................ ........................................\", \"........................ ......................                               | 26                  \", \"             |\\n| References ................................ .......................................\", \"......................... ................................................................          \", \"   | ...........  27                  |\\n| Compare ASP.NET Web API 2 and ASP.NET Core  ..............\", \".................. ................................................................                 \", \"                            | ...  27                          |\\n| References ......................\", \".......... ................................................................ ........................\", \"........................................             | ...........  27                  |\\n| Compare \", \"authentication and authorization between ASP.NET MVC and ASP.NET Core  ........................     \", \"                                                                              | 27                  \", \"             |\\n| Authorization  ................................ ...................................\", \"............................. ................................................................      \", \"   | .....  28                        |\\n| References ................................ ..............\", \".................................................. .................................................\", \"...............             | ...........  28                  |\\n| Compare ASP.NET Identity and ASP.\", \"NET Core Identity  ................................................................ ................\", \"........                                             | 28                               |\\n| Migrate \", \"from OWIN / Katana ................................................................ ................\", \"................................................                              | ......  29          \", \"             |\\n| References ................................ .......................................\", \"......................... ................................................................          \", \"   | ...........  29                  |\\n| Compare controllers in ASP.NET MVC and Web API with contro\", \"llers in ASP.NET Core  ..........................                                                   \", \"                            | 29                               |\\n| References ......................\", \".......... ................................................................ ........................\", \"........................................             | ...........  30                  |\\n| Compare \", \"Razor usage in ASP.NET MVC and ASP.NET Core ........................................................\", \"........ ................                                                     | 30                  \", \"             |\\n| Tag Helpers ................................ ......................................\", \".......................... ................................................................         \", \"   | .........  30                    |\\n| Razor Pages  ................................ ............\", \".................................................... ...............................................\", \".................           | ........  30                     |\\n| References ......................\", \".......... ................................................................ ........................\", \"........................................             | ...........  31                  |\\n| Compare \", \"ASP.NET SignalR and ASP.NET Core SignalR  ..........................................................\", \"...... .........................                                              | 31                  \", \"             |\\n| Feature differences  ................................ .............................\", \"... ................................................................ ..........................     \", \"   | 31                               |\\n| References ................................ ..............\", \".................................................. .................................................\", \"...............             | ...........  31                  |\\n| Compare testing options between A\", \"SP.NET MVC and ASP.NET Core  ................................                                       \", \"                                                     | ............................  32 |\\n\\n| Referen\", \"ces ................................ ...............................................................\", \". ................................................................ ...........      | 32            \", \"                                                          |\\n|---------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"-----------------------------------------------------|----------------------------------------------\", \"---------------------------|\\n| Migrate large solutions to ASP.NET Core .............................\", \"... ................................................................                                \", \"                      | ..... 33                                                                |\\n| \", \"References  ................................ .......................................................\", \"......... ................................................................ ............... | 33     \", \"                                                                 |\\n| Identify sequence of projects t\", \"o migrate  ................................ ........................................................\", \"........ ....................                               | 33                                    \", \"                                  |\\n| Unit tests ................................ ..................\", \".............................................. .....................................................\", \"........... ..............   | 37                                                                   \", \"   |\\n| Considerations for migrating many apps ................................ .....................\", \"........................................... ...............                                       | \", \"37                                                                      |\\n| Summary ................\", \"................ ................................................................ ..................\", \".............................................. ..............      | 38                             \", \"                                         |\\n| References ................................ ...........\", \"..................................................... ..............................................\", \".................. ...........      | 38                                                            \", \"          |\\n| Understand and update dependencies ................................ ..................\", \".............................................. ........................                             \", \"     | 38                                                                      |\\n| Update class libr\", \"ary dependencies ................................................................ ..................\", \".............. ............................                               | 38                      \", \"                                                |\\n| Update NuGet package dependencies ..............\", \".................. ................................................................ ................\", \"....                                       | 39                                                     \", \"                 |\\n| Migrate ASP.NET MVC projects ..................................................\", \".............. ................................................................                     \", \"            | ..  40                                                                  |\\n| References\", \" ................................ ................................................................ .\", \"............................................................... ...........      | 40               \", \"                                                       |\\n| Strategies for migrating while running in\", \" production  ................................................................ ......................\", \".....                                             | 40                                              \", \"                        |\\n| Refactor the .NET Framework solution ................................ ..\", \".............................................................. ....................                 \", \"                   | 40                                                                      |\\n| Ext\", \"ract front - end assets to a CDN ................................................................ ..\", \".............................. .............................                            | 41        \", \"                                                              |\\n| Extract and migrate individual mic\", \"roservices  ................................ .......................................................\", \".........                                                | .......  41                              \", \"                               |\\n| Deploy multiple versions of the app side-by-side in IIS .........\", \"....................................................... ...................                         \", \"                          | 41                                                                      \", \"|\\n| Apply the Strangler pattern  ................................................................ ..\", \"..............................................................                                 | ...\", \"......  41                                                           |\\n| Multi - targeting approache\", \"s ................................................................ .................................\", \"...............................                                 | .........  42                     \", \"                                      |\\n| Summary ................................ .................\", \"............................................... ....................................................\", \"............ ..............      | 42                                                               \", \"       |\\n| References ................................ .............................................\", \"................... ................................................................                \", \"  | ...........  42                                                         |\\n| Example migration of\", \" eShop to ASP.NET Core ................................ ................................ ...........\", \"...............                                                        | 43                         \", \"                                             |\\n| Run ApiPort to identify problematic APIs ..........\", \"...................... ................................................................ ............\", \"........                                | 44                                                        \", \"              |\\n| Update project files and NuGet reference syntax ................................ .\", \"...............................................................                                     \", \"         | ....  47                                                                |\\n| Create new AS\", \"P.NET Core project ................................................................ ................\", \"................................................                              | ..  49              \", \"                                                    |\\n| Migrating NuGet Packages  ..................\", \".............................................. .....................................................\", \"...........                                    | ..........  51                                     \", \"                     |\\n| Migrate static files ................................ .....................\", \"........................................... ................................ .......................\", \".....           | 53                                                                      |\\n| Migrat\", \"e C# files ................................ ........................................................\", \"........ ................................................................            | .  54        \", \"                                                           |\\n| Migrate views  ......................\", \".......... ................................................................ ........................\", \"........................................              | .........  56                               \", \"                            |\\n| Migrate app startup components  ....................................\", \"............................ ................................................................       \", \"                       | ..  58                                                                  |\\n|\", \" Configure MVC ................................ ....................................................\", \"............                                                                                | ......\", \".......................................................... ..  58 |\\n\\n| Data access considerations  .\", \"............................................................... ....................................\", \"............................                                  | ...............  63   |\\n|-----------\", \"----------------------------------------------------------------------------------------------------\", \"---------------------------------------------------------------------------------|------------------\", \"-----|\\n| Migrate to Entity Framework Core ..........................................................\", \"...... ................................ ............................                                \", \"| 64                    |\\n| Fix all TODO tasks ................................ ....................\", \"............................................ .......................................................\", \".........          | .  67                 |\\n| Additional MVC customizations .......................\", \"......................................... ..........................................................\", \"......                                | ......  68            |\\n| Other dependencies  ..............\", \".................. ................................................................ ................\", \"................ ............................            | 69                    |\\n| References  ...\", \"............................. ................................................................ .....\", \"........................................................... ............... | 69                    \", \"|\\n| More migration scenarios  ................................................................ .....\", \"........................................................... .................                  | 69 \", \"                   |\\n| Migrate ASP.NET MVC 5 and WebApi 2 to ASP.NET Core MVC ......................\", \"..........................................                                                          \", \"              | ...  69               |\\n| Migrate HttpResponseMessage to ASP.NET Core ..............\", \".................. ................................ ..............................                  \", \"                                 | 70                    |\\n| Migrate content negotiation from ASP.NE\", \"T Web API to ASP.NET Core ................................ ....................                     \", \"                                                    | 71                    |\\n| Custom model binding\", \" ................................................................ ..................................\", \".............................. ..................                      | 71                    |\\n| M\", \"edia formatters ................................ ...................................................\", \"............. ................................ ..............................             | 73      \", \"              |\\n| Custom filters ................................ ..................................\", \".............................. ................................................................     \", \"         | .....  73             |\\n| Route constraints  ................................ ...........\", \"..................................................... ................................ .............\", \"................            | 74                    |\\n| Custom route handlers  .....................\", \"........................................... ........................................................\", \"........ ..................                    | 75                    |\\n| CORS support ............\", \".................... ................................................................ ..............\", \"..................................................                | ....  76              |\\n| Custom\", \" areas  ................................ ...........................................................\", \"..... ................................................................               | .....  77    \", \"         |\\n| Integration tests for ASP.NET MVC and ASP.NET Web API .................................\", \"............................... .............                                                       \", \"    | 78                    |\\n| WCF client configuration ...........................................\", \"..................... ................................................................ .............\", \"..                     | 80                    |\\n| References ................................ .....\", \"........................................................... ........................................\", \"........................                  | ...........  80       |\\n| Deployment scenarios when migr\", \"ating to ASP.NET Core  ................................................................             \", \"                                                             | ..... 81              |\\n| Split a lar\", \"ge web app ................................ ................................ .......................\", \"......................................... ...........................           | 81                \", \"    |\\n| Summary  ................................ ..................................................\", \".............. ................................................................ .................. |\", \" 84                    |\\n| References  ................................ ............................\", \".................................... ...............................................................\", \".                 | ...............  85   |\\n| Summary: Port existing ASP.NET Apps to .NET 7 ........\", \"........................ ................................ ......................                    \", \"                                     | 86                    |\\n\\n## Introduction to porting apps to .\", \"NET 7\\n\\n.NET Core and its latest version, .NET 7, represent a revolutionary step forward from .NET Fr\", \"amework. It offers a host of advantages over .NET Framework across the board from productivity to pe\", \"rformance, from cross-platform support to developer satisfaction. ASP.NET Core was even voted the mo\", \"st -loved web framework (tied with Svelte) in the 2021 Stack Overflow developer survey. Clearly ther\", \"e are strong reasons to consider migrating.\\n\\nEven before .NET 7 shipped, Microsoft was clear: .NET C\", \"ore is the Future of .NET. To quote this article:\\n\\nNew apps should be built on .NET Core. .NET Core \", \"is where future investments in .NET will happen. Existing apps are safe to remain on .NET Framework \", \"which will be supported. Existing apps that want to take advantage of the new features in .NET shoul\", \"d consider moving to .NET Core. As we plan into the future, we will be bringing in even more capabil\", \"ities to the platform.\\n\\nToday, .NET 7 is what new apps should target, and if you're migrating an exi\", \"sting app from .NET Framework, .NET 7 is your ideal target framework.\\n\\nHowever, upgrading your app t\", \"o ASP.NET Core will require some effort. That effort should be balanced against business value and g\", \"oals. .NET Framework apps have a long life ahead of them, with support built into Windows for the fo\", \"reseeable future. What are some of the questions you should consider before deciding migration to .N\", \"ET 7 is appropriate? What are the expected advantages? What are the tradeoffs? How much effort is in\", \"volved? These obvious questions are just the beginning, but make for a great starting point as teams\", \" consider how to support their customers' needs with apps today and tomorrow.\\n\\n- Is migration to .NE\", \"T 7 appropriate?\\n- When does it make sense to remain on .NET Framework?\\n- Should apps target ASP.NET\", \" Core 2.1 as a stepping stone?\\n- How should teams choose the right .NET version to target?\\n- What st\", \"rategies are recommended for incremental migration of large apps?\\n- What deployment strategies shoul\", \"d be considered when porting to .NET 7?\\n- Where can we find additional resources?\\n\\nThis introductory\", \" chapter addresses all of these questions and more before moving on to more specific and technical c\", \"onsiderations in future chapters.\\n\\n## References\\n\\n- 2021 Stack Overflow developer survey most loved \", \"web frameworks\\n- .NET Core is the Future of .NET\\n\\n## Migration considerations\\n\\nThe most fundamental \", \"question teams must answer when it comes to porting their apps to .NET Core is, should they port at \", \"all? In some cases, the best path forward is to remain on .NET Framework using ASP.NET MVC and/or We\", \"b API. This chapter considers reasons why moving to .NET Core makes sense. The chapter also consider\", \"s scenarios and counterpoints for staying on .NET Framework.\\n\\n## Is migration to .NET Core appropria\", \"te?\\n\\nLet's start with some of the reasons why you might want to move to .NET Core/.NET 7. There are \", \"quite a few, so don't consider this list exhaustive.\\n\\n## Cross -platform support\\n\\nApps built on .NET\", \" Core are truly cross-platform and can run on Windows, Linux, and macOS. Not only can your developer\", \"s use whatever hardware they want, but you can also host your app anywhere. Examples range from loca\", \"l IIS to Azure in the cloud or from Linux Docker containers to IoT devices.\\n\\n## Performance and scal\", \"ability\\n\\nApps built with .NET Core are running on one of the fastest tech stacks available anywhere.\", \" ASP.NET MVC apps often see performance improvements on ASP.NET Core, especially if they're updated \", \"to take advantage of some new features available in .NET Core.\\n\\n## Cloud -native\\n\\nFor the above reas\", \"ons and others, .NET Core apps are well-suited to running in cloud hosting environments. Lightweight\", \" and fast, .NET Core apps can be deployed to Azure App Services or containers and scaled horizontall\", \"y as needed to meet immediate system demand.\\n\\n## Maintainable\\n\\nFor many apps, while they've continue\", \"d to meet customer and business needs, technical debt has accumulated and maintaining the app has gr\", \"own expensive. ASP.NET Core apps are more easily tested than ASP.NET MVC apps, making them easier to\", \" refactor and extend with confidence.\\n\\n## Modular\\n\\nASP.NET Core is modular, using NuGet packages as \", \"a first-class part of the framework. Apps built for .NET Core all support dependency injection, maki\", \"ng it easy to compose solutions from whatever implementations are needed for a given environment. Bu\", \"ilding microservices with .NET Core is easier\\n\\nthan with ASP.NET MVC with its dependency on IIS, whi\", \"ch opens up additional options to break up large apps into smaller modules.\\n\\n## Modern\\n\\nStaying on a\", \" modern, actively developed technology stack has a host of advantages. New features and C# language \", \"features will only be added to .NET Core. The .NET Framework has had its last release with version 4\", \".8, and versions of C# beyond 8 won't target .NET Framework. While ASP.NET MVC will remain supported\", \" by Microsoft for many years, the best and brightest .NET software developers are likely looking to \", \"use the more modern .NET Core framework, with all of the advantages it offers (only some of which ar\", \"e summarized above). Finding developers with the skills to maintain an ASP.NET MVC app will start to\", \" become a challenge at some point, as will finding online training and troubleshooting assistance. T\", \"here probably aren't that many new blog posts being written about ASP.NET MVC 5, while there are ple\", \"nty being written for .NET 7, for example.\\n\\nThere are many compelling reasons to consider migrating \", \"to .NET Core, which presumably is why you're reading this book! But let's consider some disadvantage\", \"s and reasons why it may make more sense to remain on the .NET Framework.\\n\\n## When is .NET Framework\", \" appropriate?\\n\\nThe biggest reason to stay on .NET Framework is when an app isn't under active develo\", \"pment and wouldn't benefit substantially from the advantages listed above. In that case, there proba\", \"bly isn't a good business case to incur the cost of porting the app. If your app might benefit from \", \"the advantages .NET Core offers, you may still need to stay on .NET Framework if you need certain te\", \"chnologies that are unavailable on .NET Core. There are some .NET technologies that are unavailable \", \"on .NET Core, including AppDomains, Remoting, Code Access Security (CAS), Security Transparency, and\", \" System.EnterpriseServices. A brief summary of these technologies and their alternatives is included\", \" here. For more detailed guidance, see the documentation.\\n\\n## Application domains\\n\\nApplication domai\", \"ns (AppDomains) isolate apps from one another. AppDomains require runtime support and can be expensi\", \"ve. Creating additional app domains isn't supported, and there are no plans to add this capability t\", \"o .NET Core in the future. For code isolation, use separate processes or containers as an alternativ\", \"e. Some customers use AppDomains as a way of unloading assemblies. In .NET Core AssemblyLoadContext \", \"provides an alternative way to unload assemblies.\\n\\n## WCF\\n\\n.NET Core and .NET 5+ support WCF clients\", \". Server-side WCF is possible through CoreWCF, which is officially supported by Microsoft as of Apri\", \"l 2022. Apps that require server-side WCF functionality can also consider a different communication \", \"technology (such as gRPC or REST) as part of a migration.\\n\\nThere is a WCF client port available from\", \" the .NET Foundation. It's entirely open source, cross platform, and supported by Microsoft.\\n\\nTo lea\", \"rn more about migrating from WCF to gRPC, consult the gRPC for WCF Developers ebook.\\n\\n## Remoting\\n\\n.\", \"NET Remoting was identified as a problematic architecture. It's used for cross-AppDomain communicati\", \"on, which is no longer supported. Also, Remoting requires runtime support, which is expensive to mai\", \"ntain. For these reasons, .NET Remoting isn't supported on .NET Core, and the product team doesn't p\", \"lan on adding support for it in the future. There are several alternative messaging strategies and i\", \"mplementations you can use to replace remoting in your .NET Core apps.\\n\\n## Code Access Security (CAS\", \") and Security Transparency\\n\\nNeither of these technologies are supported by .NET Core. Instead, the \", \"recommendation is to use security boundaries provided by the operating system. For example, virtuali\", \"zation, containers, or user accounts. Run processes with the minimal set of privileges necessary.\\n\\n#\", \"# References\\n\\n.NET Framework Technologies Unavailable on .NET Core\\n\\n## Migrate to ASP.NET Core 2.1\\n\\n\", \"ASP.NET Core 2.1 is an interesting release because it's the most recently supported ASP.NET Core rel\", \"ease that supported both .NET Core and .NET Framework runtimes. As such, it may offer an easier upgr\", \"ade path for some apps when compared to upgrading all parts of the app to .NET Core/.NET 7 at once. \", \"Although support for .NET Core 2.1 ended in August 2021, it may make sense as an interim step for so\", \"me apps. Also, support for ASP.NET Core 2.1 running on .NET Framework will continue for as long as i\", \"ts underlying .NET Framework is supported. A complete list of currently supported ASP.NET Core 2.1 p\", \"ackages is available for reference.\\n\\n## Should apps run on .NET Framework with ASP.NET Core 2.1\\n\\nASP\", \".NET Core 2.2 and earlier supported both .NET Core and .NET Framework runtimes. Does it make sense t\", \"o migrate some or all of an app to ASP.NET Core 2.1 as a stepping stone, before porting over complet\", \"ely to .NET Core? Apps, or subsets of apps, could see their front-end ASP.NET logic ported to use AS\", \"P.NET Core, while still consuming .NET Framework libraries for business logic and infrastructure con\", \"sumption. This approach may make sense when there's a relatively thin UI layer without much business\", \" logic, and a much larger set of functionality in class libraries.\\n\\nThe main benefit of porting just\", \" the front-end web layer to ASP.NET Core 2.1 is that the existing .NET class libraries can remain as\", \" is during the initial migration. They may be in continued use by other .NET apps or simply don't ne\", \"ed to be in scope for the first iteration of a planned full migration to .NET Core. Reducing the sco\", \"pe of the initial migration for large apps helps provide incremental goals that act as stepping ston\", \"es toward the desired end state, which is often a complete port to .NET Core.\\n\\nIf you have an existi\", \"ng app that may use this strategy, some things you can do today to help prepare for the process are \", \"to move as much business logic, data access, and other non-UI logic out of the ASP.NET projects and \", \"into separate class libraries as possible. It will also help if you have automated\\n\\ntest coverage of\", \" your system, so that you can verify behavior remains consistent before and after the migration.\\n\\nIf\", \" your app is so large that you can't migrate the entire web app at once, and you need to be able to \", \"deploy the new ASP.NET Core app side-by-side with the existing ASP.NET app, there are deployment str\", \"ategies that can be used to achieve this. These are covered in Chapter 5: Deployment Scenarios .\\n\\nKe\", \"ep in mind that ASP.NET Core 2.1 was the last LTS release of .NET Core that supported running on .NE\", \"T Framework and consuming .NET Framework libraries. Although the release is now unsupported on .NET \", \"Core, it continues to be supported for use with .NET Framework. It will remain supported for as long\", \" as the specific .NET Framework version is supported. For more information, see ASP.NET Core 2.1 on \", \".NET Framework .\\n\\n## References\\n\\nMigrating from ASP.NET to ASP.NET Core 2.1 ASP.NET Core 2.1 on .NET\", \" Framework ASP.NET Core 2.1 Supported Packages\\n\\n## Choose the right .NET Core version\\n\\nThe largest c\", \"onsideration for most organizations when choosing which version of .NET to target is the support lif\", \"ecycle. Long Term Support (LTS) releases ship less frequently but have a longer support window than \", \"Standard Term Support (STS) releases. Currently, LTS releases are scheduled to ship every other year\", \". Customers can choose which releases to target, and can install different releases of .NET side by \", \"side on the same machine. LTS releases will receive only critical and compatible fixes throughout th\", \"eir lifecycle. STS releases will receive these same fixes and will also be updated with compatible i\", \"nnovations and features. LTS releases are supported for three years after their initial release. STS\", \" releases are supported for six months after a subsequent STS or LTS release.\\n\\n.NET 7 is the latest \", \"STS release; .NET 6 is the latest LTS release.\\n\\nCustomers looking to migrate a large .NET Framework \", \"app to .NET today may be looking for a stable destination, given that they haven't already made the \", \"move to an earlier version of .NET Core. In this case, the best .NET version to target for the migra\", \"tion is .NET 6, which is the most recent LTS version. While support for .NET Core 3.1 ended in Decem\", \"ber 2022, support for .NET 6 will continue until November 2024.\\n\\nOther customers may want to ensure \", \"they're upgrading to the latest supported version, so that postmigration they're not already behind \", \"a version. These customers will want to target .NET 7 for the migration.\\n\\nIn either case, there is v\", \"ery little difference in the migration process. This book assumes .NET Framework apps will be upgrad\", \"ed to .NET 7.\\n\\n## References\\n\\n.NET and .NET Core Support Policy\\n\\n## Strategies for migrating increme\", \"ntally\\n\\nThe biggest challenge with migrating any large app is determining how to break the process i\", \"nto smaller tasks. There are several strategies that can be applied for this purpose, including brea\", \"king the app into horizontal layers such as UI, data access, business logic, or breaking up the app \", \"into separate, smaller apps. Another strategy is to upgrade some or all of the app to different fram\", \"ework versions on the way to a recent .NET Core release. One approach you could use is to migrate ve\", \"rtical slices of the app, rather than attempting to migrate one horizontal layer at a time. Let's co\", \"nsider each of these different approaches.\\n\\n## Migrating slice by slice\\n\\nOne successful approach to \", \"migrating is to identify vertical slices of functionality and migrate them to the target platform on\", \"e by one. The first step is to create a new ASP.NET Core 7 app. Next, identify the individual page o\", \"r API endpoint that will be migrated first. Build out just the necessary functionality to support th\", \"is one route in the new ASP.NET Core app. Then use HTTP rewriting and/or a reverse proxy to start se\", \"nding requests for these pages or endpoints to the new app rather than the ASP.NET app. This approac\", \"h is well-suited to API projects, but can also work for many MVC apps.\\n\\nWhen migrating slice by slic\", \"e, the entire stack of the individual API endpoint or requested route is recreated in the new projec\", \"t or solution. The very first such slice typically requires the most effort, since it will typically\", \" need several projects to be created and decisions to be made about data access and solution organiz\", \"ation. Once the first slice's functionality mirrors the existing app's, it can be deployed and the e\", \"xisting app can redirect to it or simply be removed. This approach is then repeated until the entire\", \" app has been ported to the new structure.\\n\\nSome specific guidance on how to follow this strategy us\", \"ing IIS is covered in Chapter 5, Deployment Scenarios .\\n\\n## Migrating layer by layer\\n\\nConsider the c\", \"hallenge of migrating a large ASP.NET 4.5 app. One approach is to migrate the entire app directly fr\", \"om .NET Framework 4.5 to .NET 7. However, this approach needs to account for every breaking change b\", \"etween the two frameworks and versions, which are substantial. Performing this work on one project a\", \"t a time provides a set of stepping stones so that the entire solution doesn't need to be moved at o\", \"nce.\\n\\nOne piece of the .NET ecosystem that helps with interoperability between different .NET framew\", \"orks is .NET Standard. .NET Standard allows libraries to build against an agreed upon set of common \", \"APIs, ensuring they can be used in any .NET app. .NET Standard 2.0 is notable because it covers most\", \" base class library functionality used by most .NET Framework and .NET Core apps. Unfortunately, the\", \" earliest version of .NET with support for .NET Standard 2.0 is .NET Framework 4.6.1, and there are \", \"a number of updates in .NET Framework 4.8 that make it a compelling choice for initial upgrades.\\n\\nOn\", \"e approach to incrementally upgrade a .NET Framework 4.5 system layer-by-layer is to first update it\", \"s class library dependencies to .NET Framework 4.8. Then, modify these libraries to be .NET Standard\", \" class libraries. Use multi -targeting and conditional compilation, if necessary. This step can be h\", \"elpful\\n\\nin scenarios where app dependencies require .NET Framework and cannot easily be ported direc\", \"tly to use .NET Standard and .NET Core. Since .NET Framework libraries can be consumed by ASP.NET Co\", \"re 2.1 apps, the next step is to migrate some or all of the web functionality of the app to ASP.NET \", \"Core 2.1 (as described in the previous chapter). This is a \\\"bottom up\\\" approach, starting with low l\", \"evel class library dependencies and working up to the web app entry point.\\n\\nOnce the app is running \", \"on ASP.NET Core 2.1, migrating it to .NET 7 in isolation is relatively straightforward. The most lik\", \"ely challenge during this step is updating incompatible dependencies to support .NET Core and possib\", \"ly higher versions of .NET Standard. For apps that don't have problematic dependencies on .NET Frame\", \"work-only libraries, there's little reason to upgrade to ASP.NET Core 2.1. Porting directly to ASP.N\", \"ET Core 7 makes more sense and requires less effort.\\n\\n.NET 7 is the latest version of .NET and will \", \"be supported until six months after the next STS or LTS release (scheduled for November 2023) - so m\", \"ost likely support will last at least until May 2024. Many teams looking to migrate today will choos\", \"e to upgrade to .NET 7.\\n\\nInstead of a \\\"bottom up\\\" approach, another alternative is to start with the\", \" web app (or even the entire solution) and use an automated tool to assist with the upgrade. The .NE\", \"T Upgrade Assistant tool can be used to help upgrade .NET Framework apps to .NET Core / .NET 7. It a\", \"utomates many of the common tasks related to upgrading apps, such as modifying project file format, \", \"setting appropriate target frameworks, updating NuGet dependencies, and more.\\n\\n## References\\n\\n- What\", \" is .NET Standard?\\n- Migrate from ASP.NET Core 6.0 to 7.0\\n- Announcing .NET 6 - The Fastest .NET Yet\", \"\\n- Introducing .NET 5\\n- Migrate from ASP.NET Core 3.1 to 6.0 LTS\\n- .NET Upgrade Assistant tool\\n\\n## S\", \"trategies for migrating ASP.NET Web Forms apps\\n\\nThis book offers guidance for migrating large ASP.NE\", \"T MVC and Web API apps to .NET Core. Some of these ASP.NET apps may also include Web Forms (.aspx) p\", \"ages that must be addressed. ASP.NET Web Forms isn't supported in ASP.NET Core (nor are ASP.NET Web \", \"Pages). Typically, the functionality of these pages must be rewritten when porting to ASP.NET Core. \", \"There are, however, some strategies you can apply before or during such migration to help reduce the\", \" overall effort required.\\n\\nWeb Forms will continue to be supported for quite some time. One option m\", \"ay be to keep this functionality in an ASP.NET 4.x app.\\n\\n## Separate business logic and other concer\", \"ns\\n\\nThe less code in your ASP.NET Web Forms pages, the better. When possible, keep business logic an\", \"d other concerns like data access in separate classes, ideally in separate class libraries. These cl\", \"ass libraries can be ported to .NET Standard and consumed by any ASP.NET Core app.\\n\\n## Implement cli\", \"ent behavior and web APIs\\n\\nConsider the choice between implementing logic in Web Forms or in the bro\", \"wser with the help of API calls. Favor the latter. Migrating APIs to ASP.NET Core is supported. Clie\", \"nt-side behavior should be independent of the server-side stack your app is using. Using this approa\", \"ch has the added benefit of providing a more responsive user experience.\\n\\n## Consider Blazor\\n\\nBlazor\", \" lets you build interactive web UIs with C# instead of JavaScript. It can run on the server or in th\", \"e browser using WebAssembly. ASP.NET Web Forms apps may be ported page-by-page to Blazor apps. For m\", \"ore information on porting Web Forms apps to Blazor, see Blazor for ASP.NET Web Forms Developers. In\", \" addition, many Web Forms controls have been ported to Blazor as part of an opensource community pro\", \"ject, Blazor Web Forms Components. With these components, you can more easily port Web Forms pages t\", \"o Blazor even if they use the built-in Web Forms controls.\\n\\n## Summary\\n\\nMigrating directly from ASP.\", \"NET Web Forms to ASP.NET Core isn't supported. However, there are strategies to make moving to ASP.N\", \"ET Core easier. You can migrate your Web Forms functionality to ASP.NET Core successfully by:\\n\\n- Kee\", \"ping non-web functionality out of your projects.\\n- Using web APIs wherever possible.\\n- Considering B\", \"lazor as an option for a more modern UI.\\n\\n## References\\n\\n- Free e -book: Blazor for ASP.NET Web Form\", \"s Developers\\n- Blazor Web Forms Components (Community Project)\\n\\n## Deployment strategies\\n\\nOne consid\", \"eration as you plan the migration of your large ASP.NET app to ASP.NET Core is how you'll deploy the\", \" new app. With ASP.NET, deployment options were limited to IIS on Windows. With ASP.NET Core, a much\", \" wider array of deployment options is available.\\n\\n## Cross -platform options\\n\\nBecause .NET Core runs\", \" on Linux, you'll find some hosting options available that weren't a consideration previously. Linux\", \"-based hosting may be preferable for the following reasons:\\n\\n- Your organization has infrastructure \", \"or expertise.\\n- Hosting providers offer attractive features or pricing for Linux-based hosting.\\n\\n.NE\", \"T Core opens the door to these options.\\n\\n## Cloud native development\\n\\nMost organizations today are u\", \"sing cloud platforms for at least some of their software capabilities. With an app migration to .NET\", \" Core, it's a good time to consider whether the app should be purposefully written with cloud hostin\", \"g in mind. Such cloud native apps are better able to apply cloud capabilities like serverless, micro\", \"services, and can be less concerned with the low-level details of how and where they may be deployed\", \".\\n\\nLearn more about cloud native app development in this free e-book, Architecting Cloud Native .NET\", \" Applications for Azure .\\n\\n## Leverage containers\\n\\nModern apps often leverage containers as a means \", \"of reducing variation between hosting environments. By deploying an app to a particular container, t\", \"he container-hosted app will run the same whether it's running on a developer's laptop or in product\", \"ion. As part of a migration to .NET Core, it may make sense to consider whether the app would benefi\", \"t from deployment via container, either as a full monolith or broken up into multiple smaller contai\", \"nerized apps.\\n\\n## Side -by-side deployment options\\n\\nMigrating large .NET Framework apps to .NET Core\", \" often requires a substantial effort. Most organizations will want to be able to break this effort u\", \"p in some fashion, so that pieces of the app can be migrated and deployed in production before the e\", \"ntire migration is complete. Running both the original ASP.NET app and its newly-migrated ASP.NET Co\", \"re sub-app(s) side by side is a frequently cited goal. This can be achieved through a number of mech\", \"anisms including leveraging IIS routing, which is covered in chapter 5. Other options include levera\", \"ging app gateways or cloud design patterns like backends for frontends to manage sets of ASP.NET Web\", \" APIs and ASP.NET Core API endpoints.\\n\\n## IIS on Windows\\n\\nYou can continue hosting your apps on IIS \", \"running on Windows. This is a fine option for customers who want to take advantage of ASP.NET Core f\", \"eatures without changing their current deployment model. While moving to ASP.NET Core provides more \", \"options in terms of how and where to deploy your apps, it doesn't require that you change from the s\", \"tatus quo of using the proven combination of IIS on Windows.\\n\\n## Other options on Windows\\n\\nYou can h\", \"ost apps side-by-side apps on Windows using any combination of Kestrel, HTTP.sys, and IIS hosts, in \", \"addition to Docker containers, if needed. If your app requires a combination of Windows and Linux se\", \"rvices, hosting on a Windows server with WSL and/or Linux Docker containers provides a single server\", \" solution to hosting all parts of the app.\\n\\n## References\\n\\n- Host and deploy ASP.NET Core\\n\\n- Host AS\", \"P.NET Core on Windows with IIS\\n- Troubleshooting ASP.NET Core on Azure App Service and IIS\\n\\n## Addit\", \"ional migration resources\\n\\nAs you're planning and executing your migration from ASP.NET MVC and/or W\", \"eb API to ASP.NET Core, there are a number of resources available to help beyond this book. Make a n\", \"ote of these and leverage them where appropriate to help you overcome obstacles you encounter on you\", \"r migration journey.\\n\\n## Official documentation\\n\\nThe official documentation website, learn.microsoft\", \".com, has the most up-to-date information available about versions, frameworks, breaking changes, an\", \"d support options. You'll find many links in this book to docs articles, but for any problem you're \", \"facing it's often worth at least doing a quick search of the docs to see if there is already informa\", \"tion covering the issue and offering a solution or workaround.\\n\\n## GitHub\\n\\nBecause .NET Core is an o\", \"pen-source project, many issues are discovered, reported, discussed, and fixed on GitHub. Microsoft \", \"has several GitHub organizations in which you'll find repositories that may be helpful. A partial li\", \"st of these organizations and some of their public repositories are listed below:\\n\\n- Microsoft\\n- \\u2013 A\", \"SP.NET API Versioning\\n- dotnet\\n- \\u2013 ASP.NET Core\\n- \\u2013 .NET Runtime\\n- \\u2013 Entity Framework Core\\n- \\u2013 C# La\", \"nguage\\n- \\u2013 Docs\\n- \\u2013 Docs Samples\\n- \\u2013 Try Convert\\n- \\u2013 .NET Upgrade Assistant tool\\n- .NET Architecture\", \" Reference Apps\\n- \\u2013 eShopModernizing\\n- \\u2013 eShopOnWeb\\n- \\u2013 eShopOnContainers\\n\\nIf you run into problems \", \"with your migration, these GitHub repositories are a good place to report them. The product teams wa\", \"tch the issues and typically respond quickly to bug reports (though \\\"how to\\\" questions may be more a\", \"ppropriately directed to Stack Overflow).\\n\\n## Stack Overflow\\n\\nStack Overflow has a wealth of informa\", \"tion in the form of previous questions asked and answers given, with the most helpful answers listed\", \" first and marked if they solved the problem. In addition to searching for an existing solution to a\", \" problem you may encounter, you can of course also ask a question yourself and hope for some respons\", \"e from the .NET community. Don't forget you can narrow down a search by using tags, and remember to \", \"use appropriate tags when you ask questions to maximize the chances of someone with the experience n\", \"eeded noticing your question.\\n\\n## YouTube channels\\n\\nYouTube has a huge amount of .NET and .NET Core \", \"video content, which may include useful tutorials or walkthroughs covering any scenario you may enco\", \"unter. Consider searching it separately if your other efforts to find help online come up short. Her\", \"e are a few good places to get started:\\n\\n- dotnet\\n- Visual Studio\\n\\n## Twitter, Gitter, Slack, and ot\", \"her community channels\\n\\nYou'll find many other ways to connect with .NET developers on the .NET Comm\", \"unity page. You can also join the DotNetEvolution Discord server. Additionally, many product teams a\", \"nd team members are on Twitter as well as in various other communities. You can follow and communica\", \"te with the author of this book on Twitter as well.\\n\\n## References\\n\\n- Overview of porting from .NET \", \"Framework to .NET Core\\n- .NET Upgrade Assistant tool\\n- Migrate from ASP.NET to ASP.NET Core\\n- .NET C\", \"ommunity Resources\\n\\n## Architectural differences between ASP.NET MVC and ASP.NET Core\\n\\nThere are man\", \"y architectural differences between ASP.NET MVC on .NET Framework and ASP.NET Core. It's important t\", \"o have a broad understanding of these differences as teams evaluate the work involved in porting the\", \"ir ASP.NET MVC apps to ASP.NET Core. This chapter looks at each of the ways in which ASP.NET Core di\", \"ffers substantially from ASP.NET MVC.\\n\\n## Breaking changes\\n\\n.NET Core is a cross -platform rewrite o\", \"f .NET Framework. There are many breaking changes between the two frameworks. The following sections\", \" identify specific differences between how ASP.NET MVC and ASP.NET Core apps are designed and develo\", \"ped. Take care to also examine the documentation to determine which framework libraries you're using\", \" that may need to change. In many cases, a replacement NuGet package exists to fill in any gaps left\", \" between .NET Framework and .NET Core. In rare cases, you may need to find a third-party solution or\", \" implement new custom code to address incompatibilities.\\n\\n## App startup differences between ASP.NET\", \" MVC and ASP.NET Core\\n\\nASP.NET MVC apps lived entirely within Internet Information Server (IIS), the\", \" primary web server available on Windows operating systems. Unlike ASP.NET MVC, ASP.NET Core apps ar\", \"e executable apps. You can run them from the command line, using dotnet run. They have an entry poin\", \"t method like all C# programs, typically public static void Main() or a similar variation (perhaps w\", \"ith arguments or async support). This is perhaps the biggest architectural difference between ASP.NE\", \"T Core and ASP.NET MVC, and is one of several differences that allows ASP.NET Core to run on non -Wi\", \"ndows systems.\\n\\n## ASP.NET MVC Startup\\n\\nHosted within IIS, ASP.NET apps rely on IIS to instantiate c\", \"ertain objects and call certain methods when a request arrives. ASP.NET creates an instance of the G\", \"lobal.asax file's class, which derives from HttpApplication. When the first request is received, bef\", \"ore handling the request itself, ASP.NET calls the Application\\\\_Start method in the Global.asax file\", \"'s class. Any logic that needs to run when the ASP.NET MVC app begins can be added to this method.\\n\\n\", \"Many NuGet packages for ASP.NET MVC and Web API use the WebActivator package to let them run some co\", \"de during app startup. By convention, this code would typically be added to an App\\\\_Start folder and\", \" would be configured via attribute to run either immediately before or just after Application\\\\_Start\", \".\\n\\nIt's also possible to use the Open Web Interface for .NET (OWIN) and Project Katana with ASP.NET \", \"MVC. When doing so, the app will include a Startup.cs file that is responsible for setting up reques\", \"t middleware in a way that's very similar to how ASP.NET Core behaves.\\n\\nIf you need to run code when\", \" your ASP.NET MVC app starts up, it will typically use one of these approaches.\\n\\n## ASP.NET Core Sta\", \"rtup\\n\\nAs noted previously, ASP.NET Core apps are standalone programs. As such, they typically includ\", \"e a Program.cs file containing the entry point for the app. A typical example of this file is shown \", \"in Figure 2 -1. Notice that in .NET 7, this file is streamlined by the use of implicit using stateme\", \"nts and top-level statements, eliminating the need for a lot of \\\"boiler plate\\\" code.\\n\\n```\\nvar builde\", \"r = WebApplication . CreateBuilder(args); // Add services to the container. builder . Services . Add\", \"RazorPages(); var app = builder . Build(); // Configure the HTTP request pipeline. if (!app . Enviro\", \"nment . IsDevelopment()) { app.UseExceptionHandler(\\\"/Error\\\"); // The default HSTS value is 30 days. \", \"You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts. app.UseHst\", \"s(); } app.UseHttpsRedirection(); app.UseStaticFiles(); app.UseRouting(); app.UseAuthorization(); ap\", \"p.MapRazorPages(); app.Run();\\n```\\n\\nFigure 2 -1. A typical ASP.NET Core Program.cs file.\\n\\nThe code sh\", \"own in Figure 2-1 uses a builder to configure the host and its services. Then, it creates the reques\", \"t pipeline for the app, which controls how every request to the app is handled.\\n\\nPrevious versions o\", \"f .NET would use a separate Startup.cs file, referenced by Program.cs. This approach is still suppor\", \"ted in .NET 7, but is no longer the default approach.\\n\\nIn addition to code related to configuring th\", \"e app's services and request pipeline, apps may have other code that must run when the app begins. S\", \"uch code is typically placed in Program.cs or registered as an IHostedService, which will be started\", \" by the generic host when the app starts.\\n\\nThe IHostedService interface just exposes two methods, St\", \"artAsync and StopAsync. You register the interface when configuring the app's services and the host \", \"does the rest, calling the StartAsync method before the app starts up.\\n\\n## Porting considerations\\n\\nT\", \"eams looking to migrate their apps from ASP.NET MVC to ASP.NET Core need to identify what code is be\", \"ing run when their app starts up and determine the appropriate location for such code in their ASP.N\", \"ET Core app. For custom code needed to run when the app starts up, especially async code, the recomm\", \"ended approach is typically to put such code into IHostedService implementations.\\n\\n## References\\n\\n- \", \"ASP.NET Application Life Cycle Overview for IIS 7\\n- ASP.NET Application Life Cycle Overview for IIS \", \"5 and 6\\n- Getting Started with OWIN and Katana\\n- WebActivator\\n- App Startup in ASP.NET Core\\n- .NET G\", \"eneric Host in ASP.NET Core\\n- IHostedService\\n\\n## Hosting differences between ASP.NET MVC and ASP.NET\", \" Core\\n\\nASP.NET MVC apps are hosted in IIS, and may rely on IIS configuration for their behavior. Thi\", \"s often includes IIS modules. As part of reviewing an app to prepare to port it from ASP.NET MVC to \", \"ASP.NET Core, teams should identify which modules, if any, they're using from the list of IIS Module\", \"s installed on their server.\\n\\nASP.NET Core apps can run on a number of different servers. The defaul\", \"t cross platform server, Kestrel, is a good default choice. Apps running in Kestrel can be hosted by\", \" IIS, running in a separate process. On Windows, apps can also run in process on IIS or using HTTP.s\", \"ys. Kestrel is generally recommended for best performance. HTTP.sys can be used in scenarios where t\", \"he app is exposed to the Internet and required capabilities are supported by HTTP.sys but not Kestre\", \"l.\\n\\nKestrel does not have an equivalent to IIS modules (though apps hosted in IIS can still take adv\", \"antage of IIS modules). To achieve equivalent behavior, middleware configured in the ASP.NET Core ap\", \"p itself is typically used.\\n\\n## References\\n\\n- IIS Modules\\n- ASP.NET Core Middleware\\n- ASP.NET Core S\", \"ervers\\n\\n## Serve static files in ASP.NET MVC and ASP.NET Core\\n\\nMost web apps involve a combination o\", \"f server-side logic and static files that must be sent to the client as -is. How should your migrati\", \"on from ASP.NET MVC to ASP.NET Core handle serving static files?\\n\\n## Host static files in ASP.NET MV\", \"C\\n\\nASP.NET MVC apps, hosted by IIS, typically host static files directly from the app. ASP.NET MVC s\", \"upports placing static files side by side with files that should be kept private on the server. IIS \", \"and ASP.NET require explicitly restricting certain files or file extensions from being served from t\", \"he folder in which an ASP.NET app is hosted.\\n\\nFor many static files, using a content delivery networ\", \"k (CDN) is a good practice. Static content hosting allows better performance while reducing load and\", \" bandwidth from app servers.\\n\\n## Host static files in ASP.NET Core\\n\\nIt may be surprising, but ASP.NE\", \"T Core doesn't have built-in support for static files. This feature that has always existed as just \", \"a part of ASP.NET, enabled by IIS, isn't intrinsic to ASP.NET Core or its Kestrel web server. To ser\", \"ve static files from an ASP.NET Core app, you must configure static files middleware .\\n\\nWith static \", \"files middleware configured, an ASP.NET Core app will serve all files located in a certain folder (t\", \"ypically /wwwroot). No other files in the app or project folder are at risk of being accidentally ex\", \"posed by the server. No special restrictions based on file names or extensions need to be configured\", \", as is the case with IIS. Instead, developers explicitly choose to expose files publicly when they \", \"place them in the wwwroot folder. By default, files outside of this folder aren't shared.\\n\\nBecause s\", \"upport for static files uses middleware, any other middleware can be applied as part of the same req\", \"uest pipeline. Examples of middleware include authentication, caching, and compression.\\n\\nOf course, \", \"CDNs remain a good choice for ASP.NET Core apps for all the same reasons they're used in ASP.NET MVC\", \" apps. As part of preparing to migrate to .NET Core, if there are benefits your app could realize fr\", \"om using a CDN, it would be good to move static files to a CDN before migrating to .NET Core. Doing \", \"so reduces the migration effort's overall scope for static assets.\\n\\n## References\\n\\n- Static content \", \"hosting\\n- Static files in ASP.NET Core\\n\\n## Dependency injection differences between ASP.NET MVC and \", \"ASP.NET Core\\n\\nAlthough dependency injection (DI) isn't built into ASP.NET MVC or Web API, many apps \", \"enable it by adding a NuGet package with an inversion of control (IOC) container. These are sometime\", \"s referred to as DI containers, for dependency injection (or inversion). Some of the most popular co\", \"ntainers used in ASP.NET MVC apps include:\\n\\n- Autofac\\n- Unity\\n- Ninject\\n- StructureMap (deprecated)\\n\", \"- Castle Windsor\\n\\nIf your ASP.NET MVC app isn't using DI, you will probably want to investigate the \", \"built-in support for DI in ASP.NET Core. DI promotes loose coupling of modules in your app and enabl\", \"es better testability and adherence to principles like SOLID .\\n\\nIf your app does use DI, then probab\", \"ly your best course of action is to see if the container you're using supports ASP.NET Core. If so, \", \"you may be able to continue using it and your custom configuration rules describing your type mappin\", \"gs and lifetimes.\\n\\nEither way, you should consider using the built-in support for DI that ships with\", \" ASP.NET Core, as it may meet your app's needs.\\n\\n## Dependency injection in ASP.NET Core\\n\\nASP.NET Co\", \"re assumes apps will use DI. It's not just built into the framework, but is required in order to bri\", \"ng support for framework features into your ASP.NET Core apps. In app startup, calls are made to con\", \"figure services using the builder.Services property of the web host builder. This property works wit\", \"h the application's DI container (service collection/service provider) and is used to create and inj\", \"ect service dependencies within the app. Built-in ASP.NET Core features like Entity Framework Core, \", \"Identity, and even MVC are brought into the app by configuring them as services during application s\", \"tartup.\\n\\nIn addition to using the default implementation, apps can still use custom containers. The \", \"documentation covers how to replace the default service container .\\n\\nDI is fundamental to ASP.NET Co\", \"re. If your team isn't already well-versed in this practice, you'll want to understand it before por\", \"ting your app.\\n\\n## References\\n\\n- Dependency Injection in .NET\\n- Dependency Injection in ASP.NET Core\", \"\\n\\n## Compare middleware to modules and handlers\\n\\nIf your existing ASP.NET MVC or Web API app uses OW\", \"IN/Katana, you're most likely already familiar with the concept of middleware and porting it to ASP.\", \"NET Core should be fairly straightforward. However, most ASP.NET apps rely on HTTP modules and HTTP \", \"handlers instead of middleware. Migrating these to ASP.NET Core requires extra effort.\\n\\n## ASP.NET m\", \"odules and handlers\\n\\nHTTP modules and HTTP handlers are an integral part of the ASP.NET architecture\", \". While a request is being processed, each request is processed by multiple HTTP modules (for exampl\", \"e, the authentication module and the session module) and is then processed by a single HTTP handler.\", \" After the handler has processed the request, the request flows back through the HTTP modules.\\n\\nIf y\", \"our app is using custom HTTP modules or HTTP handlers, you'll need a plan to migrate them to ASP.NET\", \" Core. The most likely replacement in ASP.NET Core is middleware.\\n\\n## ASP.NET Core middleware\\n\\nASP.N\", \"ET Core defines a request pipeline in each app's Configure method. This request pipeline defines how\", \" an incoming request is handled by the app, with each method in the pipeline calling the next method\", \" until eventually a method terminates, and the chain of middleware terminates and returns back up th\", \"e stack. Middleware can target all requests, or can be configured to only map to certain requests ba\", \"sed on the requested path or other factors. It can be configured wholly in the Configure method of a\", \"n app, or implemented in a separate class.\\n\\nBehavior in an ASP.NET MVC app that uses HTTP modules is\", \" probably best suited to custom middleware. Custom HTTP handlers can be replaced with custom routes \", \"or endpoints that respond to the same path.\\n\\n## Accessing HttpContext\\n\\nMany .NET apps reference the \", \"current request's context through HttpContext.Current. This static access can be a common source of \", \"problems with testing and other code usage outside of individual requests. When building ASP.NET Cor\", \"e apps, access to the current HttpContext should be provided as a method parameter on middleware, as\", \" this sample demonstrates:\\n\\n```\\npublic class Middleware { private readonly RequestDelegate _next; pu\", \"blic Middleware(RequestDelegate next) { _next = next;\\n```\\n\\n```\\n} public Task Invoke(HttpContext http\", \"Context) { return _next(httpContext); } }\\n```\\n\\nSimilarly, ASP.NET Core filters pass a context argume\", \"nt to their methods, from which the current HttpContext can be accessed:\\n\\n```\\npublic class MyActionF\", \"ilterAttribute : ActionFilterAttribute { public override void OnResultExecuting(ResultExecutingConte\", \"xt context) { var headers = context . HttpContext . Request . Headers; // do something based on a he\", \"ader base . OnResultExecuting(context); } }\\n```\\n\\nIf you have components or services that require acc\", \"ess to HttpContext, rather than using a static call like HttpContext.Current you should instead use \", \"constructor dependency injection and the IHttpContextAccessor interface:\\n\\n```\\npublic class MyService\", \" { private readonly IHttpContextAccessor _httpContextAccessor; public MyService(IHttpContextAccessor\", \" httpContextAccessor) { _httpContextAccessor = httpContextAccessor; } public void DoSomething() { va\", \"r currentContext = _httpContextAccessor . HttpContext; } }\\n```\\n\\nThis approach eliminates the static \", \"coupling of the method to the current context while providing access in a testable fashion.\\n\\n## Refe\", \"rences\\n\\n- ASP.NET HTTP modules and HTTP handlers\\n- ASP.NET Core middleware\\n\\n## Configuration differe\", \"nces between ASP.NET MVC and ASP.NET Core\\n\\nHow configuration values are stored and read changed dram\", \"atically between ASP.NET and ASP.NET Core.\\n\\n## ASP.NET MVC configuration\\n\\nIn ASP.NET apps, configura\", \"tion uses the built-in .NET configuration files, web.config in the app folder and machine.config on \", \"the server. Most ASP.NET MVC and Web API apps store their settings in the configuration file's appSe\", \"ttings or connectionStrings elements. Some also use custom configuration sections that can be mapped\", \" to a settings class.\\n\\nConfiguration in a .NET Framework app is accessed using the\\n\\nSystem.Configura\", \"tion.ConfigurationManager class. Unfortunately, this class provides static access to the configurati\", \"on elements. As a result, very few ASP.NET MVC apps tend to abstract access to their configuration s\", \"ettings or inject them where needed. Instead, most .NET Framework apps tend to directly access the c\", \"onfiguration system anywhere the app needs to use a setting.\\n\\nTypical ASP.NET MVC configuration acce\", \"ss:\\n\\n```\\nstring connectionString = ConfigurationManager . ConnectionStrings[\\\"DefaultConnection\\\"] . C\", \"onnectionString;\\n```\\n\\n## ASP.NET Core configuration\\n\\nIn ASP.NET Core apps, configuration is, itself,\", \" configurable. However, most apps use a set of defaults provided as part of the standard project tem\", \"plates and the ConfigureWebHostDefaults method used in them. The default settings use JSON formatted\", \" files, with the ability to override settings in the base appsettings.json file with environment-spe\", \"cific files like appsettings.Development.json. Additionally, the default configuration system furthe\", \"r overrides all file-based settings with any environment variable that exists for the same named set\", \"ting. This is useful in many scenarios and is especially useful when deploying to a hosting environm\", \"ent, since it eliminates the need to worry about whether deploying configuration files will accident\", \"ally overwrite important production configuration settings. Configuration values can also be provide\", \"d as command line arguments.\\n\\nAccessing configuration values can be done in many ways in .NET Core. \", \"Because dependency injection is built into .NET Core, configuration values are generally accessed th\", \"rough an interface that is injected into classes that need them. This can involve passing a interfac\", \"e like IConfiguration, but usually it's better to pass just the settings required by the class using\", \" the options pattern .\\n\\nFigure 2-2 shows how to pass IConfiguration into a Razor Page and access con\", \"figuration settings from it:\\n\\n```\\nusing Microsoft . Extensions . Configuration; public class TestMod\", \"el : PageModel { private readonly IConfiguration _configuration; public TestModel(IConfiguration con\", \"figuration) { _configuration= configuration; } public ContentResult OnGet() {\\n```\\n\\n```\\nvar myKeyValu\", \"e = _configuration[\\\"MyKey\\\"]; // ... } }\\n```\\n\\nFigure 2 -2. Accessing configuration values with IConfi\", \"guration.\\n\\nUsing the options pattern, settings access is similar but is strongly typed and more spec\", \"ific to the setting(s) needed by the consuming class, as Figure 2-3 demonstrates.\\n\\n```\\npublic class \", \"PositionOptions { public const string Position = nameof(Position); public string Title { get; set; }\", \" public string Name { get; set; } } public class Test2Model : PageModel { private readonly PositionO\", \"ptions _options; public Test2Model(IOptions<PositionOptions> options) { _options = options . Value; \", \"} public ContentResult OnGet() { return Content($\\\"Title: {_options.Title}\\\\nName: {_options.Name}\\\"); \", \"} }\\n```\\n\\nFigure 2 -3. Using the options pattern in ASP.NET Core.\\n\\nFor the options pattern to work, t\", \"he options type must be configured in ConfigureServices when the app starts up:\\n\\n```\\n// required in \", \"ConfigureServices services . Configure<PositionOptions>(Configuration . GetSection(PositionOptions .\", \" Position));\\n```\\n\\n## Migrate configuration\\n\\nWhen considering how to port an app's configuration sett\", \"ings from .NET Framework to .NET Core, the first step is to identify all of the configuration settin\", \"gs that are being used. Most of these will be in the web.config file in the app's root folder, but s\", \"ome apps expect settings to be found in the shared machine.config file as well. These settings will \", \"include elements of the appSettings element, the connectionStrings element, and any custom configura\", \"tion elements as well. In .NET Core, all of these settings are typically stored in the appsettings.j\", \"son file.\\n\\nOnce all settings in the config files have been cataloged, the next step should be to ide\", \"ntify where and how the settings are used in the app itself. If some settings aren't being used, the\", \"se can probably be omitted from the migration. For each setting, note all of the places it's being u\", \"sed so you can be sure you don't miss any when you migrate the code.\\n\\nIf you're still maintaining th\", \"e ASP.NET app, it may be helpful to avoid static references to ConfigurationManager and replace them\", \" with access through interfaces. This will ease the transition to ASP.NET Core's configuration syste\", \"m. In general, static access to external resources makes code harder to test and maintain, so be on \", \"the lookout for anywhere else the app may be following this pattern.\\n\\n## References\\n\\n- Configuration\", \" in ASP.NET Core\\n- Options pattern in ASP.NET Core\\n- Migrate configuration to ASP.NET Core\\n- Refacto\", \"ring Static Config Access\\n\\n## Routing differences between ASP.NET MVC and ASP.NET Core\\n\\nRouting is r\", \"esponsible for mapping incoming browser requests to particular controller actions (or Razor Pages ha\", \"ndlers). This section covers how routing differs between ASP.NET MVC (and Web API) and ASP.NET Core \", \"(MVC, Razor Pages, and otherwise).\\n\\n## Routing in ASP.NET MVC and Web API\\n\\nASP.NET MVC offers two ap\", \"proaches to routing:\\n\\n1. The route table, which is a collection of routes that can be used to match \", \"incoming requests to controller actions.\\n2. Attribute routing, which performs the same function but \", \"is achieved by decorating the actions themselves, rather than editing a global route table.\\n\\n## Rout\", \"e table\\n\\nThe route table is configured when the app starts up. Typically, a static method call is us\", \"ed to configure the global route collection, like so:\\n\\n```\\npublic class MvcApplication : System . We\", \"b . HttpApplication { public static void RegisterRoutes(RouteCollection routes) { routes . IgnoreRou\", \"te(\\\"{resource}.axd/{*pathInfo}\\\"); routes . MapRoute( name: \\\"Default\\\" , url: \\\"{controller}/{action}/{\", \"id}\\\" , defaults: new { controller = \\\"Home\\\" , action = \\\"Index\\\" , id = \\\"\\\" }, constraints: new { id = \\\"\", \" \\\\\\\\d+\\\" } ); } protected void Application_Start() {\\n```\\n\\n```\\nRegisterRoutes(RouteTable . Routes); } }\", \"\\n```\\n\\nIn the preceding code, the route table is managed by the RouteCollection type, which is used t\", \"o add new routes with MapRoute. Routes are named and include a route string, which can include param\", \"eters for controllers, actions, areas, and other placeholders. If an app follows a standard conventi\", \"on, most of its actions can be handled by this single default route, with any exceptions to this con\", \"vention configured using additional routes.\\n\\n## Attribute routing in ASP.NET MVC\\n\\nRoutes that are de\", \"fined with their actions may be easier to discover and reason about than routes defined in an extern\", \"al location. Using attribute routing, an individual action method can have its route defined with a \", \"[Route] attribute:\\n\\n```\\npublic class ProductsController { [Route(\\\"products\\\")] public ActionResult In\", \"dex() { return View(); } [Route(\\\"products/{id}\\\")] public ActionResult Details(int id) { return View(\", \"); } }\\n```\\n\\nAttribute routing in ASP.NET MVC 5 also supports defaults and prefixes, which can be add\", \"ed at the controller level (and which are applied to all actions within that controller). Refer to t\", \"he documentation for details.\\n\\nSetting up attribute routing requires adding one line to the default \", \"route table configuration:\\n\\n```\\nroutes . MapMvcAttributeRoutes();\\n```\\n\\nAttribute routing can take ad\", \"vantage of route constraints, both built-in and custom, and supports named routes and areas using th\", \"e [RouteArea] attribute. If your app uses areas, you'll need to configure support for them in your r\", \"oute registration code by adding one more line:\\n\\nroutes . MapMvcAttributeRoutes();\\n\\nAreaRegistration\", \" . RegisterAllAreas();\\n\\n## Attribute routing in ASP.NET Web API 2\\n\\nAttribute routing in ASP.NET Web \", \"API 2 is similar to routing in ASP.NET MVC 5, with minor differences. Configuring Web API 2 is typic\", \"ally done in its own class, which is called during app startup. Attribute routing configuration is h\", \"andled in this class:\\n\\n```\\npublic static class WebApiConfig {\\n```\\n\\n```\\npublic static void Register(H\", \"ttpConfiguration config) { // Attribute routing. config . MapHttpAttributeRoutes(); // Convention-ba\", \"sed routing. config . Routes . MapHttpRoute( name: \\\"DefaultApi\\\" , routeTemplate: \\\"api/{controller}/{\", \"id}\\\" , defaults: new { id = RouteParameter . Optional } ); } }\\n```\\n\\nAs shown in the preceding code, \", \"attribute routing may be combined with convention-based routing in Web API apps.\\n\\nIn addition to att\", \"ribute routing, ASP.NET Web API chooses which action to call based on the HTTP method (for example, \", \"GET or POST), the {action} placeholder in a route (if any), and parameters of the action. In many ca\", \"ses, the name of the action will help determine whether it's matched, since prefixing the action nam\", \"e with \\\"Get\\\" or \\\"Post\\\" is used to match the appropriate HTTP method to it. Alternatively, actions ca\", \"n be decorated with an appropriate HTTP method attribute, like [HttpGet], allowing the use of action\", \" names that aren't prefixed with an HTTP method.\\n\\n```\\npublic class ProductsController : ApiControlle\", \"r { // matched by name and (lack of) parameters public IEnumerable<Product> GetAll() { } // matched \", \"by GET and string parameter [HttpGet] public IEnumerable<Product> FindProductsByName(string name) { \", \"} }\\n```\\n\\nGiven the above controller, an HTTP GET request to localhost:123/products/ matches the GetA\", \"ll action. An HTTP GET request to localhost:123/products?name=ardalis matches the FindProductsByName\", \" action.\\n\\n## Routing in .NET 7\\n\\nIn ASP.NET Core, routing is handled by routing middleware, which mat\", \"ches the URLs of incoming requests to actions or other endpoints. Controller actions are either conv\", \"entionally routed or attribute -routed. Conventional routing is similar to the route table approach \", \"used in ASP.NET MVC and Web API. Whether you're using conventional, attribute, or both, you need to \", \"configure your app to use the routing middleware. To use the middleware, add the following code to y\", \"our Program.cs file:\\n\\napp.UseRouting();\\n\\n## Conventional routing\\n\\nWith conventional routing, you set\", \" up one or more conventions that will be used to match incoming URLs to endpoints in the app. In ASP\", \".NET Core, these endpoints may be controller actions, like in ASP.NET MVC or Web API. The endpoints \", \"could also be Razor Pages, Health Checks, or SignalR hubs. All of these routable features are config\", \"ured in a similar fashion using endpoints:\\n\\n```\\napp.UseEndpoints(endpoints => { endpoints . MapHealt\", \"hChecks(\\\"/healthz\\\").RequireAuthorization(); endpoints . MapControllerRoute( name: \\\"default\\\" , patter\", \"n: \\\"{controller=Home}/{action=Index}/{id?}\\\"); endpoints . MapRazorPages(); });\\n```\\n\\nThe preceding co\", \"de is used (in addition to UseRouting) to configure various endpoints, including Health Checks, cont\", \"rollers, and Razor Pages. For controllers, the above configuration specifies a default routing conve\", \"ntion, which is the fairly standard {controller}/{action}/{id?} pattern that's been recommended sinc\", \"e the first versions of ASP.NET MVC.\\n\\n## Attribute routing\\n\\nAttribute routing in ASP.NET Core is the\", \" preferred approach for configuring routing in controllers. If you're building APIs, the [ApiControl\", \"ler] attribute should be applied to your controllers. Among other things, this attribute requires th\", \"e use of attribute routing for actions in such controller classes.\\n\\nAttribute routing in ASP.NET Cor\", \"e behaves similarly in ASP.NET MVC and Web API. In addition to supporting the [Route] attribute, how\", \"ever, route information can also be specified as part of the HTTP method attribute:\\n\\n```\\n[HttpGet(\\\"a\", \"pi/products/{id}\\\")] public async ActionResult<Product> Details(int id) { // ... }\\n```\\n\\nAs with previ\", \"ous versions, you can specify a default route with placeholders, and add this at the controller clas\", \"s level or even on a base class. You use the same [Route] attribute for all of these cases. For exam\", \"ple, a base API controller class might look like this:\\n\\n```\\n[Route(\\\"api/{controller}/{action}/{id?:i\", \"nt}\\\")] public abstract class BaseApiController : ControllerBase , IApiController { // ... }\\n```\\n\\nUsi\", \"ng this attribute, classes inheriting from this type would route URLs to actions based on the contro\", \"ller name, action name, and an optional integer id parameter.\\n\\n## References\\n\\n- ASP.NET MVC Routing \", \"Overview\\n- Attribute Routing in ASP.NET MVC 5\\n- Attribute routing in ASP.NET Web API 2\\n- Routing and\", \" Action Selection in ASP.NET Web API\\n- Routing in ASP.NET Core\\n- Routing to controller actions in AS\", \"P.NET Core MVC\\n\\n## Logging differences between ASP.NET MVC and ASP.NET Core\\n\\nApplication logging pro\", \"vides important diagnostic information, especially for apps running in production. ASP.NET Core intr\", \"oduces a new system for adding standardized logging to any app. Existing ASP.NET MVC and Web API app\", \"s most likely use third-party logging solutions, which likely continue to be supported on ASP.NET Co\", \"re.\\n\\n## ASP.NET MVC logging\\n\\nThere's no built -in logging solution in ASP.NET MVC and Web API apps. \", \"Instead, most apps use thirdparty logging solutions like log4net , NLog, or Serilog. Many teams also\", \" choose to roll their own logging solution. Logging frameworks typically support multiple \\\"sinks\\\" (o\", \"r targets or appenders) for log output, such as text files, databases, or even emails. They use conf\", \"iguration to determine which levels of log messages from which parts of the system are routed to dif\", \"ferent sinks. When considering how to migrate an app's logging to .NET Core, review how logging is p\", \"erformed and configured in the app.\\n\\n## ASP.NET Core logging\\n\\nIn ASP.NET Core, logging is a built-in\", \" feature that can be configured and extended when the app starts up. Third-party loggers, including \", \"those mentioned above, can be integrated with ASP.NET Core to enhance its functionality.\\n\\nASP.NET Co\", \"re logging uses categories and levels to control what is logged and how. Classes typically use insta\", \"nces of the ILogger&lt;T&gt; interface, with the class's type used as the generic T type. In this sc\", \"enario, the class's fully qualified name is used as the category. Loggers can also be created with a\", \" custom category using an ILoggerFactory. Log levels range from the most detailed, Trace, to the mos\", \"t important, Critical. Using configuration, apps can specify what minimum level of logging should be\", \" included on a per-category (with wildcards) basis.\\n\\nA typical logging configuration could log Infor\", \"mation and above information by default, but only Warning or above from Microsoft-prefixed categorie\", \"s:\\n\\n```\\n{ \\\"Logging\\\": { \\\"LogLevel\\\": { \\\"Default\\\": \\\"Information\\\" , \\\"Microsoft\\\": \\\"Warning\\\" } } }\\n```\\n\\nSu\", \"pport for logging in ASP.NET Core is extensive and flexible. For more detailed information, refer to\", \" the docs .\\n\\n## Migrate logging\\n\\nHow you migrate your .NET Framework app's logging to .NET Core depe\", \"nds on how the app is logging now. If it's using a third-party NuGet package, refer to the upgrade d\", \"ocumentation for that package. Most likely the upgrade path will be fairly straightforward. If you'r\", \"e using your own logging solution, take one of the following actions:\\n\\n1. Migrate the logging soluti\", \"on yourself\\n2. Migrate to a third-party logging solution\\n3. Use the built -in logging support in ASP\", \".NET Core\\n\\nYou can reference the Microsoft.Extensions.Logging package from .NET Framework apps as lo\", \"ng as they're using NuGet 4.3 or later and are on .NET Framework 4.6.1 or later. Once your app has r\", \"eferenced this package, you can convert your logging statements to use the new extensions before mig\", \"rating the app to .NET Core. This can provide a stepping stone toward full migration, since the app \", \"can continue running on .NET Framework while logging using the newer extensions package.\\n\\n## Referen\", \"ces\\n\\n- Logging in .NET Core and ASP.NET Core\\n- Microsoft.Extensions.Logging NuGet Package\\n\\n## Compar\", \"e Razor Pages to ASP.NET MVC\\n\\nRazor Pages is the preferred way to create page- or form-based apps in\", \" ASP.NET Core. From the docs , \\\"Razor Pages can make coding page-focused scenarios easier and more p\", \"roductive than using controllers and views.\\\" If your ASP.NET MVC app makes heavy use of views, you m\", \"ay want to consider migrating from actions and views to Razor Pages.\\n\\nA typical strongly typed view-\", \"based MVC app will use a controller to contain one or more actions. The controller will interact wit\", \"h the domain or data model, and create an instance of a viewmodel class. Then this viewmodel class i\", \"s passed to the view associated with that action. Using this approach, coupled with the default fold\", \"er structure of MVC apps, to add a new page to an app requires modifying a controller in one folder,\", \" a view in a nested subfolder in another folder, and a viewmodel in yet another folder.\\n\\nRazor Pages\", \" group together the action (now a handler) and the viewmodel (called a PageModel) in one class, and \", \"link this class to the view (called a Razor Page). All Razor Pages go into a Pages folder in the roo\", \"t of the ASP.NET Core project. Razor Pages use a routing convention based on their name and location\", \" within this folder. Handlers behave exactly like action methods but have the HTTP verb they handle \", \"in their name (for example, OnGet). They also don't necessarily need to return, since by default the\", \"y're assumed to return the page they're associated with. This tends to keep Razor Pages and their ha\", \"ndlers smaller and more focused while at the same time making it easier to find and work with all of\", \" the files needed to add or modify a particular part of an app.\\n\\nAs part of a move from ASP.NET MVC \", \"to ASP.NET Core, teams should consider whether they want to migrate controllers and views to ASP.NET\", \" Core controllers and views, or to Razor Pages. The former\\n\\nwill most likely require slightly less o\", \"verall effort, but won't allow the team to take advantage of the benefits of Razor Pages over tradit\", \"ional view-based file organization.\\n\\n## References\\n\\n- Introduction to Razor Pages in ASP.NET Core\\n- \", \"Simpler ASP.NET Core Apps with Razor Pages\\n\\n## Compare ASP.NET Web API 2 and ASP.NET Core\\n\\nASP.NET C\", \"ore offers iterative improvements to ASP.NET Web API 2, but should feel familiar to developers who h\", \"ave used Web API 2. ASP.NET Web API 2 was developed and shipped alongside ASP.NET MVC. This meant th\", \"e two approaches had similar-but-different approaches to things like attribute routing and dependenc\", \"y injection. In ASP.NET Core, there's no longer any distinction between MVC and Web APIs. There's on\", \"ly ASP.NET Core, which includes support for view-based scenarios, API endpoints, Razor Pages, health\", \" checks, SignalR, and more.\\n\\nIn addition to being consistent and unified within ASP.NET Core, APIs b\", \"uilt in .NET Core are much easier to test than those built on ASP.NET Web API 2. We'll cover testing\", \" differences in more detail in a moment. The built -in support for hosting ASP.NET Core apps, in a t\", \"est host that can create an HttpClient that makes in-memory requests to the app, is a huge benefit w\", \"hen it comes to automated testing.\\n\\nSee Incremental ASP.NET to ASP.NET Core migration for an increme\", \"ntal approach to migrating to ASP.NET Core.\\n\\n## References\\n\\n- Migrate from ASP.NET Web API to ASP.NE\", \"T Core\\n- Ardalis.ApiEndpoints NuGet package\\n\\n## Compare authentication and authorization between ASP\", \".NET MVC and ASP.NET Core\\n\\nIn ASP.NET MVC 5, authentication is configured in Startup.Auth.cs in the \", \"App\\\\_Start folder. In ASP.NET Core MVC, this configuration occurs in Startup.cs or Program.cs, as pa\", \"rt of configuring the app's services and middleware.\\n\\nAuthentication and authorization are performed\", \" using middleware added to the request pipeline:\\n\\n```\\napp.UseRouting(); app.UseAuthentication(); app\", \".UseAuthorization(); app.UseEndpoints(endpoints => {\\n```\\n\\n```\\nendpoints . MapControllerRoute( name: \", \"\\\"default\\\" , pattern: \\\"{controller=Home}/{action=Index}/{id?}\\\"); endpoints . MapRazorPages(); });\\n```\", \"\\n\\nIt's important to add the auth middleware in the appropriate order in the middleware pipeline. Onl\", \"y requests that make it to the middleware will be impacted by it. For instance, if a call to UseStat\", \"icFiles() were placed above the code shown here, it wouldn't be protected by authentication and auth\", \"orization.\\n\\nIn ASP.NET MVC and Web API, apps often refer to the current user using the ClaimsPrincip\", \"al.Current property. This property isn't set in ASP.NET Core, and any behavior in your app that depe\", \"nds on it will need to migrate from ClaimsPrincipal.Current by using the User property on Controller\", \"Base or getting access to the current HttpContext and referencing its User property. If neither of t\", \"hese solutions is an option, services can request the User as an argument, in which case it must be \", \"supplied from elsewhere in the app, or the IHttpContextAccessor can be requested and used to get the\", \" HttpContext.\\n\\n## Authorization\\n\\nAuthorization defines what a given user can do within the app. It's\", \" separate from authentication, which is concerned merely with identifying who the user is. ASP.NET C\", \"ore provides a simple, declarative role and a rich, policy-based model for authorization. Specifying\", \" that a resource requires authorization is often as simple as adding the [Authorize] attribute to th\", \"e action or controller. If you're migrating to Razor Pages from MVC views, you should specify conven\", \"tions for authorization when you configure Razor Pages .\\n\\nAuthorization in ASP.NET Core may be as si\", \"mple as prohibiting anonymous users while allowing authenticated users. Or it can scale up to suppor\", \"t role-based, claims-based, or policy-based authorization approaches. For more information on these \", \"approaches, see the documentation on authorization in ASP.NET Core. You'll likely find that one of t\", \"hem is closely aligned with your current authorization approach.\\n\\n## References\\n\\n- Security, Authent\", \"ication, and Authorization with ASP.NET MVC\\n- Migrate Authentication and Identity to ASP.NET Core\\n- \", \"Migrate from ClaimsPrincipal.Current\\n- Introduction to Authorization in ASP.NET Core\\n\\n## Compare ASP\", \".NET Identity and ASP.NET Core Identity\\n\\nIn ASP.NET MVC, identity features are typically configured \", \"in IdentityConfig.cs in the App\\\\_Start folder. Review how this is configured in the existing app, an\", \"d compare it to the configuration required for ASP.NET Core Identity in Program.cs .\\n\\nASP.NET Identi\", \"ty is an API that supports user interface login functionality and manages users, passwords, profile \", \"data, roles, claims, tokens, email confirmations, and more. It supports external login providers lik\", \"e Facebook, Google, Microsoft, and Twitter .\\n\\nIf your ASP.NET MVC app is using ASP.NET Membership, y\", \"ou'll find a guide to migrate from ASP.NET Membership authentication to ASP.NET Core 2.0 Identity. T\", \"his is mainly a data migration exercise, at the completion of which you should be able to use ASP.NE\", \"T Core Identity with your migrated user records.\\n\\nIf you migrate your ASP.NET Identity users to ASP.\", \"NET Core Identity, you may need to update their password hashes, or track which passwords are hashed\", \" with the new ASP.NET Core Identity approach or the older ASP.NET Identity approach. This approach d\", \"escribed on Stack Overflow provides some options for migrating user password hashes over time, rathe\", \"r than all at once.\\n\\nOne of the biggest differences when it comes to ASP.NET Core Identity compared \", \"to ASP.NET Identity is how little code you need to include in your project. ASP.NET Core Identity no\", \"w ships as a Razor Class Library, meaning its UI and logic are all available from a NuGet package. Y\", \"ou can override the existing UI and logic by scaffolding the ASP.NET Core Identity files but even in\", \" this case you need only scaffold the pages you want to modify, not every one that exists.\\n\\n## Migra\", \"te from OWIN / Katana\\n\\nThe following resources offer some guidance for migrating from OWIN / Katana:\", \"\\n\\n- Migration\\n- Katana to ASPNET 5\\n\\n## References\\n\\n- Migrate Authentication and Identity to ASP.NET \", \"Core\\n- Introduction to Identity on ASP.NET Core\\n- Configure ASP.NET Core Identity\\n- Scaffold Identit\", \"y in ASP.NET Core projects\\n\\n## Compare controllers in ASP.NET MVC and Web API with controllers in AS\", \"P.NET Core\\n\\nIn ASP.NET MVC 5 and Web API 2, there were two different Controller base types. MVC cont\", \"rollers inherited from Controller; Web API controllers inherited from ApiController. In ASP.NET Core\", \", this object hierarchy has been merged. It's recommended that API controllers in ASP.NET Core inher\", \"it from ControllerBase and add the [ApiController] attribute. Standard view-based MVC controllers sh\", \"ould inherit from Controller.\\n\\nIn both frameworks, controllers are used to organize sets of action m\", \"ethods. Filters and routes can be applied on a controller level in addition to at the action level. \", \"These conventions can be extended further by using custom base Controller types with default behavio\", \"r and attributes applied to them.\\n\\nIn ASP.NET MVC, content negotiation isn't supported. ASP.NET Web \", \"API 2 does support content negotiation, as does ASP.NET Core. Using content negotiation, the format \", \"of the content returned to a request can be determined by headers the client provides indicating its\", \" preferred manner of receiving the content.\\n\\nWhen migrating ASP.NET Web API controllers to ASP.NET C\", \"ore, a few components need to be changed if they exist. These include references to the ApiControlle\", \"r base class, the System.Web.Http namespace, and the IHttpActionResult interface. Refer to the docum\", \"entation for recommendations on how to migrate these specific differences. Note that the preferred r\", \"eturn type for API actions in ASP.NET Core is ActionResult&lt;T&gt;.\\n\\nIn addition, the [ChildActionO\", \"nly] attribute isn't supported in ASP.NET Core. In ASP.NET Core, similar functionality is achieved u\", \"sing View Components .\\n\\nASP.NET Core includes two new attributes: ConsumesAttribute and ProducesAttr\", \"ibute. These are used to specify the type an action consumes or produces, which can be helpful for r\", \"outing and documenting the API using tools like Swagger/OpenAPI .\\n\\n## References\\n\\n- Format response \", \"data in ASP.NET Core Web API\\n- Migrate from ASP.NET Web API to ASP.NET Core\\n\\n## Compare Razor usage \", \"in ASP.NET MVC and ASP.NET Core\\n\\nThe basic syntax of Razor hasn't changed substantially between ASP.\", \"NET MVC and ASP.NET Core. However, there are certain differences, such as the introduction of Tag He\", \"lpers and Razor Pages, that should be considered when migrating. If your app makes heavy use of cust\", \"om Razor functionality, refer to the Razor syntax reference for ASP.NET Core to see what changes may\", \" be required when you migrate to ASP.NET Core.\\n\\n## Tag Helpers\\n\\nTag Helpers enable server-side code \", \"to participate in creating and rendering HTML elements in Razor files. They offer many advantages ov\", \"er HTML Helpers and should be used in place of HTML Helpers wherever possible. They provide an HTML-\", \"friendly development experience, since they look like standard HTML and are ignored by most tooling \", \"designed to edit HTML. Within Visual Studio, there's rich IntelliSense support for creating HTML and\", \" Razor markup with Tag Helpers. Tag Helpers can provide simple or complex behavior from declarative \", \"markup in Razor files.\\n\\n## Razor Pages\\n\\nRazor Pages offer an alternative to controllers, actions, an\", \"d views for page- and form-based apps. Razor Pages were compared to ASP.NET MVC earlier in this chap\", \"ter .\\n\\n## References\\n\\n- Migrate from ASP.NET MVC to ASP.NET Core MVC: Controllers and Views\\n- Tag He\", \"lpers in ASP.NET Core\\n- Introduction to Razor Pages in ASP.NET Core\\n- Razor syntax reference for ASP\", \".NET Core\\n\\n## Compare ASP.NET SignalR and ASP.NET Core SignalR\\n\\nASP.NET Core SignalR is incompatible\", \" with clients or servers using ASP.NET SignalR. You'll need to update both clients and server to use\", \" ASP.NET Core SignalR. Some differences are described in this section, while the full list is availa\", \"ble in the docs. ASP.NET Core SignalR requires .NET Core 2.1 or greater.\\n\\n## Feature differences\\n\\n- \", \"ASP.NET SignalR automatically attempts to reconnect dropped connections; this behavior is opt -in fo\", \"r ASP.NET Core SignalR clients.\\n- Both frameworks support JSON; ASP.NET Core SignalR also supports a\", \" binary protocol based on MessagePack, and custom protocols can be created.\\n- The Forever Frame tran\", \"sport, supported by ASP.NET SignalR, isn't supported in ASP.NET Core SignalR.\\n- ASP.NET Core SignalR\", \" must be configured by adding services.AddSignalR() and app.UseEndpoints in Program.cs .\\n- ASP.NET C\", \"ore SignalR requires sticky sessions; ASP.NET SignalR doesn't.\\n- ASP.NET Core simplifies the connect\", \"ion model; connections are only made to a single hub.\\n- ASP.NET Core SignalR supports streaming data\", \" from the hub to the client.\\n- ASP.NET Core SignalR doesn't support passing state between clients an\", \"d the hub (but method calls still allow passing information between hubs and clients).\\n- The Persist\", \"entConnection class doesn't exist in ASP.NET Core SignalR.\\n- ASP.NET SignalR supports SQL Server and\", \" Redis. ASP.NET Core SignalR supports Azure SignalR and Redis.\\n\\n## References\\n\\n- Differences between\", \" ASP.NET SignalR and ASP.NET Core SignalR\\n- Azure SignalR Service\\n\\n## Compare testing options betwee\", \"n ASP.NET MVC and ASP.NET Core\\n\\nASP.NET MVC apps support unit testing of controllers, but this appro\", \"ach often omits many MVC features like routing, authorization, model binding, model validation, filt\", \"ers, and more. To test these MVC features in addition to the logic within the controller action itse\", \"lf, frequently the app would need to be deployed and then tested with a tool like Selenium. These te\", \"sts are substantially more expensive, more brittle, and slower than typical unit tests that can be r\", \"un without the need for hosting and running the entire app.\\n\\nASP.NET Core controllers can be unit te\", \"sted just like ASP.NET MVC controllers, but with the same limitations. However, ASP.NET Core support\", \"s fast, easy-to-author integration tests as well. Integration tests are hosted by a TestHost class a\", \"nd are typically configured in a custom WebApplicationFactory that can override or replace app depen\", \"dencies. For instance, frequently during integration tests the app will target a different data sour\", \"ce and may replace services that send emails with fake or mock implementations.\\n\\nASP.NET MVC and Web\", \" API did not support anything like the integration testing scenarios available in ASP.NET Core. In a\", \"ny migration effort, you should allocate time to write some integration tests for your newly migrate\", \"d system to ensure it's working as expected and continues to do so. Even if you weren't writing test\", \"s of your web app logic before the migration, you should strongly consider doing so as you move to A\", \"SP.NET Core.\\n\\n## References\\n\\n- Creating Unit Tests for ASP.NET MVC Applications\\n- Unit test controll\", \"er logic in ASP.NET Core\\n- Integration tests in ASP.NET Core\\n\\n## Migrate large solutions to ASP.NET \", \"Core\\n\\nMigrating large solutions from .NET Framework to .NET Core requires some planning. Dependencie\", \"s must be migrated or updated before the projects that depend on them. There are tools that can iden\", \"tify dependencies and offer help with migrating to .NET Core. Depending on the app, its scope, and c\", \"urrent usage patterns, different strategies may be employed when migrating. Do you migrate it all at\", \" once, or over time, side-by-side with the current system? Do you wrap the current system in the new\", \" one, and incrementally replace its functionality?\\n\\nIn this chapter, you'll learn how create a migra\", \"tion plan for a large solution, how to use tools to help with the migration, and some strategies to \", \"consider for the migration itself.\\n\\n## References\\n\\n- What topics are important to migrating large MV\", \"C and Web API apps to .NET Core?\\n- Porting from .NET Framework to .NET Core\\n\\n## Identify sequence of\", \" projects to migrate\\n\\nFor solutions that involve multiple front-end apps, it's best to migrate the a\", \"pps one by one. For example, create a solution that only includes one front-end app and its dependen\", \"cies so you can easily identify the scope of work involved. Solutions are lightweight, and you can i\", \"nclude projects in multiple solutions if needed. Take advantage of solutions as an organizational to\", \"ol when migrating.\\n\\nOnce you've identified the ASP.NET app to migrate and have its dependent project\", \"s located with it (ideally in a solution), the next step is to identify framework and NuGet dependen\", \"cies. Having identified all dependencies, the simplest migration approach is a \\\"bottom up\\\" approach.\", \" With this approach, the lowest level of dependencies is migrated first. Then the next level of depe\", \"ndencies is migrated, until eventually the only thing left is the front-end app. Figure 3-1 shows an\", \" example set of projects composing an app. The low-level class libraries are at the bottom, and the \", \"ASP.NET MVC project is at the top.\\n\\nContoso.Utils\\n\\n\\u2022 NET 4.5 Class Library\\n\\nContoso.Web\\n\\nASP. NET MV\", \"C 5\\n\\nFigure 3 -1. Project dependencies graph.\\n\\n<!-- image -->\\n\\nChoose a particular front-end app, an\", \" ASP.NET MVC 5 / Web API 2 project. Identify its dependencies in the solution, and map out their dep\", \"endencies until you have a complete list. A diagram like the one shown in Figure 3-1 may be useful w\", \"hen mapping out project dependencies. Visual Studio can produce a dependency diagram for your soluti\", \"on, depending on which edition you're using. The .NET Portability Analyzer can also produce dependen\", \"cy diagrams.\\n\\nFigure 3-2 shows the installer for the .NET Portability Analyzer Visual Studio extensi\", \"on:\\n\\n\\u2022 VSIX Installer\\n\\nInstall\\n\\n.NET Portability Analyzer\\n\\nV Visual Studio Enterprise 2019\\n\\n/ Visual\", \" Studio Enterprise 2019 Preview\\n\\nBy clicking \\\"Install\\\", you agree with the above license terms (if a\", \"ny) and the\\n\\n<!-- image -->\\n\\ninstallation of any prerequisites.\\n\\nFigure 3 -2. .NET Portability Analy\", \"zer installer.\\n\\nThe extension currently supports Visual Studio 2017 and 2019. Visual Studio 2022 sup\", \"port is planned. Once installed, you configure it from the Analyze &gt; Portability Analyzer Setting\", \"s menu, as shown in Figure 3-3.\\n\\nX\\n\\nOptions\\n\\nSearch Options (CtrI+E)\\n\\n\\u2022 Environment\\n\\n\\u2022 Projects and \", \"Solutions\\n\\n\\u2022 Source Control\\n\\n\\u2022 Work Items\\n\\n\\u2022 Text Editor\\n\\n\\u2022 Debugging\\n\\n\\u2022 IntelliTrace\\n\\n\\u2022 Performance\", \" Tools\\n\\n\\u2022 .NET Portability Analyzer\\n\\nGeneral\\n\\n\\u2022 Azure Service Authentication\\n\\n\\u2022 Container Tools\\n\\n\\u2022 C\", \"ross Platform\\n\\n\\u2022 Database Tools\\n\\n\\u2022 F# Tools\\n\\n\\u2022 Live Share\\n\\n\\u2022 Live Unit Testing\\n\\n\\u2022 NuGet Package Mana\", \"ger\\n\\n\\u2022 Snapshot Debugger\\n\\n\\u2022 SQL Server Tools\\n\\n\\u2022 Test\\n\\n\\u2022 Text Templating\\n\\n\\u2022 Web Forms Designer\\n\\n\\u2022 Web\", \" Performance Test Tools\\n\\n\\u2022 Windows Forms Designer\\n\\n\\u2022 XAML Designer\\n\\nP\\n\\nGeneral settings\\n\\nDefault out\", \"put directory C:\\\\Portability Analysis\\n\\nDefault output name\\n\\nApiPortAnalysis\\n\\nOutput formats\\n\\n~ Excel\", \" V HTML\\n\\n\\u2022Ison\\n\\nFigure 3 -3. Configure the .NET Portability Analyzer.\\n\\n<!-- image -->\\n\\nThe analyzer \", \"produces a detailed report for each assembly. The report:\\n\\n- Describes how compatible each project i\", \"s with a given target framework, such as .NET 7 or .NET Standard 2.0.\\n- Helps teams assess the effor\", \"t required to port a particular project to a particular target framework.\\n\\nThe details of this analy\", \"sis are covered in the next section.\\n\\nOnce you've mapped out the projects and their relationships wi\", \"th one another, you're ready to determine the order in which you'll migrate the projects. Begin with\", \" projects that have no dependencies. Then, work your way up the tree to the projects that depend on \", \"these projects.\\n\\nIn the example shown in Figure 3-1, you would start with the Contoso.Utils project,\", \" since it doesn't depend on any other projects. Next, Contoso.Data since it only depends on \\\"Utils\\\".\", \" Then migrate the \\\"BusinessLogic\\\" library, and finally the front-end ASP.NET \\\"Web\\\" project. Followin\", \"g this \\\"bottom up\\\" approach works well for relatively small and well-factored apps that can be migra\", \"ted as a unit once all of their projects have migrated. Larger apps with more complexity, or more co\", \"de that will take longer to migrate, may need to consider more incremental strategies.\\n\\n?\\n\\n## Unit t\", \"ests\\n\\nMissing from the previous diagrams are unit test projects. Hopefully there are tests covering \", \"at least some of the existing behavior of the libraries being ported.\\n\\nIf you have unit tests, it's \", \"best to convert those projects first. You'll want to continue testing changes in the project you're \", \"working on. Remember that porting to .NET Core is a significant change to your codebase.\\n\\nMSTest, xU\", \"nit, and NUnit all work on .NET Core. If you don't currently have tests for your app, consider build\", \"ing some characterization tests that verify the system's current behavior. The benefit is that once \", \"the migration is complete, you can confirm the app's behavior remains unchanged.\\n\\n## Considerations \", \"for migrating many apps\\n\\nSome organizations will have many different apps to migrate, and migrating \", \"each one by hand may require too many resources to be tenable. In these situations, some degree of a\", \"utomation is recommended. The steps followed in this chapter can be automated. Structural changes, l\", \"ike project file differences and updates to common packages, can be applied by scripts. These script\", \"s can be refined as they're run iteratively on more projects. On each run, examine whatever manual s\", \"teps are required for each project. Automate those manual steps, if possible. Using this approach, t\", \"he organization should grow faster and better at porting their apps over time, with improved automat\", \"ion support each step of the way.\\n\\nWatch an overview of how to employ this approach in this dotNetCo\", \"nf presentation by Lizzy Gallagher of Mastercard. The five phases employed in this presentation incl\", \"uded:\\n\\n- Migrate third-party NuGet dependencies\\n- Migrate apps to use new .csproj file format\\n- Upda\", \"te internal NuGet dependencies to .NET Standard\\n- Migrate apps to ASP.NET Core (targeting .NET Frame\", \"work)\\n- Update all apps to target .NET 7\\n\\nWhen automating a large suite of apps, it helps significan\", \"tly if they follow consistent coding guidelines and project organization. Automation efforts rely on\", \" this consistency to be effective. In addition to parsing and migrating project files, common code p\", \"atterns can be migrated automatically. Some code pattern examples include differences in how control\", \"ler actions are declared or how they return results.\\n\\nFor example, a migration script could search f\", \"iles matching Controller.cs for lines of code matching one of these patterns:\\n\\nreturn new HttpStatus\", \"CodeResult(200);\\n\\n```\\n// or\\n```\\n\\nreturn new HttpStatusCodeResult(HttpStatusCode . OK);\\n\\nIn ASP.NET C\", \"ore, either of the preceding lines of code can be replaced with:\\n\\nreturn Ok();\\n\\n86\\n\\n125\\n\\n363\\n\\n369\\n\\n4\", \"05\\n\\n410\\n\\n567\\n\\n616\\n\\n624\\n\\n629\\n\\n672\\n\\n775\\n\\n783\\n\\n802\\n\\nTarget type\\n\\nT:System.Web.HttpRequestBase\\n\\nT:System\", \".Web.HttpRequestBase\\n\\nT:System.Web.SessionState.HttpSessionState\\n\\nT:System.Web.SessionState.HttpSess\", \"ionState\\n\\nT:System.Web.HttpApplication\\n\\nT:System.Web.HttpApplication\\n\\nT:System.Web.Routing.RouteColl\", \"ection\\n\\nT:System.Web.HttpRequest\\n\\nT:System.Web.HttpRequest\\n\\nT:System.Web.HttpRequest\\n\\nT:System.Web.R\", \"outing.Route\\n\\nT:System.Web.HttpContext\\n\\nT:System.Web.HttpContext\\n\\nT:System.Web.HttpContext\\n\\n815\\n\\nT:S\", \"ystem.Web.HttpContext\\n\\nAssembly Name eShopLegacyMVC\\n\\neShopLegacyMVC\\n\\nB\\n\\nTarget member\\n\\nT:System.Web.\", \"HttpRequestBase\\n\\nM:System.Web.HttpRequestBase.get\\\\_Url\\n\\nT:System.Web.SessionState.HttpSessionState e\", \"ShopLegacyMVC\\n\\nM:System.Web.SessionState.HttpSessionState.set\\\\_eShopLegacyMVC\\n\\nT:System.Web.HttpAppl\", \"ication\\n\\nM:System.Web.HttpApplication.#ctor\\n\\nT:System.Web.Routing.RouteCollection\\n\\nT:System. Web.Htt\", \"pRequest\\n\\nM:System.Web.HttpRequest.get\\\\_RawUrl\\n\\n## Summary\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopLeg\", \"acyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\n.NET Core + \", \"Platform Extensions, Version=\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot suppo\", \"rted\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot \", \"supported\\n\\n.NET Core, Version=v3.1\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot \", \"supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\", \"\\nNot supported\\n\\nNot supported\\n\\n.NET Standard + Platform Exte\\n\\nNot supported\\n\\nNot supported\\n\\nNot supp\", \"orted\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot\", \" supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nThe best approach to porting a large .NET F\", \"ramework app to .NET Core is to: M:System.Web.HttpContext.get\\\\_Current eShopLegacyMVC Not supported\\n\", \"\\n1124 T:System.Web.HttpServerUtilityBase\\n\\n1128 T:System.Web.HttpServerUtilityBase\\n\\n1169 T:System.Web\", \".Hosting.HostingEnvironment\\n\\nT:System.Web.HttpServerUtilityBase eShopLegacyMVC\\n\\nNot supported\\n\\n1. Id\", \"entify project dependencies.\\n\\n1322 T:System.Web.Routing.RouteTable\\n\\n1324 T:System.Web.Routing.RouteT\", \"able\\n\\n1365\\n\\n1366\\n\\n1367\\n\\nR6R\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\n2. Analyze what's required\", \" to port each project.\\n3. Start from the bottom up.\\n\\nMissina assemblies\\n\\nDetails |\\n\\nYou can use the \", \".NET Portability Analyzer to determine how compatible existing libraries may be with target platform\", \"s. Automated tests will help ensure no breaking changes are introduced as the app is ported. These t\", \"est projects should be among the first projects ported.\\n\\n## References\\n\\n- Porting from .NET Framewor\", \"k to .NET Core\\n- The .NET Portability Analyzer\\n- 2 Years, 200 Apps: A .NET Core Migration at Scale (\", \"Video)\\n\\n## Understand and update dependencies\\n\\nAfter identifying the sequence in which the app's ind\", \"ividual projects must be migrated, the next step is to understand each project's dependencies and up\", \"date them if necessary. For platform dependencies, the best way to start is to run the .NET Portabil\", \"ity Analyzer on the assembly in question, and then look at the detailed results that are generated. \", \"You configure the tool to specify one or more target platforms, such as .NET 7 or .NET Standard 2.0.\", \" Results are provided with details for each platform targeted. Figure 3-4 shows an example of the to\", \"ol's output.\\n\\nFigure 3 -4. .NET Portability Analyzer report details.\\n\\n<!-- image -->\\n\\n## Update clas\", \"s library dependencies\\n\\nLarge apps typically involve multiple projects, and most projects other than\", \" the ASP.NET MVC web project are likely to be class libraries. Class libraries tend to be the easies\", \"t to port between .NET\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nN\", \"ot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot supported\\n\\nNot support\", \"ed\\n\\nPortability Summary\\n\\nplatforms, especially compared to ASP.NET projects, which are among the mos\", \"t difficult (and typically need to be re -created).\\n\\nTeams can consider the try-convert tool or the \", \".NET Upgrade Assistant tool for migrating class libraries to .NET Core. These tools analyze a .NET F\", \"ramework project file and attempt to migrate it to the .NET Core project file format, making any mod\", \"ifications it can safely perform in the process. The tools may require some manual assistance to wor\", \"k with ASP.NET projects, but can usually help speed up the process of migrating class libraries.\\n\\nTh\", \"e try-convert and Upgrade Assistant tools are deployed as .NET Core command line tools. They only ru\", \"n on Windows, since they're designed to work with .NET Framework apps. You can install tryconvert by\", \" running the following command from a command prompt:\\n\\ndotnet tool install -g try -convert\\n\\nOnce you\", \"'ve successfully installed the tool, you can run try-convert in the folder where the class library's\", \" project file is located.\\n\\nInstall the .NET Upgrade Assistant with the following command (after inst\", \"alling try-convert):\\n\\ndotnet tool install -g upgrade-assistant\\n\\nRun the tool with the command upgrad\", \"e-assistant upgrade &lt;project&gt; in the folder where the project file is located.\\n\\n## Update NuGe\", \"t package dependencies\\n\\nAnalyze your use of third-party NuGet packages and determine if any of them \", \"don't yet support .NET Standard (or do support it but only with a new version). It can be helpful to\", \" update NuGet packages to use &lt;PackageReference&gt; syntax using Visual Studio's converter tool, \", \"so that top-level dependencies are visible. Next, check whether the current or later versions of the\", \"se packages support .NET Core or .NET Standard. This information can be found on [nuget.org] or with\", \"in Visual Studio for each package.\\n\\nIf support exists using the version of the package the app curre\", \"ntly uses, great! If not, see if a more recent version of the package has the support and research w\", \"hat would be involved in upgrading. There may be breaking changes in the package, especially if the \", \"major version of the package changes between your currently used version and the one to which you're\", \" upgrading.\\n\\nIn some cases, no version of a given package works with .NET Core. In that case, teams \", \"have a couple options. They can continue depending on the .NET Framework version, but this has limit\", \"ations. The app may only run on Windows, and the team may want to run Portability Analyzer on the pa\", \"ckage's binaries to see if there are any issues likely to be encountered. Certainly the team will wa\", \"nt to test thoroughly, since if .NET Framework packages are used that reference APIs not available i\", \"n .NET Core, a runtime exception will occur. The other option is to find a different package or, if \", \"the required package is open source, upgrade it to .NET Standard or .NET Core themselves.\\n\\n## Migrat\", \"e ASP.NET MVC projects\\n\\nThe System.Web namespace and types don't exist in .NET Core. When you're ana\", \"lyzing dependencies and using tools like try-convert, you'll find they don't offer many suggestions \", \"for automatic migration of ASP.NET MVC projects and any code in them that references System.Web. For\", \" these projects, you'll need to start with a new ASP.NET Core web project and manually migrate files\", \" to this project.\\n\\nIn general, it's a good practice to minimize how much of an app's business logic \", \"lives in its user interface layer. It's also best to keep controllers and views small. Apps that hav\", \"e followed this guidance will be easier to port than those that have a significant amount of their l\", \"ogic in the ASP.NET web project. If you have an app you're considering porting, but haven't begun th\", \"e process yet, keep this in mind as you maintain it. Any effort you put toward minimizing how much c\", \"ode is in the ASP.NET MVC or Web API project will likely result in less work when the time comes to \", \"port the app.\\n\\nThe next chapter digs into details of how to migrate from ASP.NET MVC and Web API pro\", \"jects to ASP.NET Core projects. The previous chapter called out the biggest differences between the \", \"apps. Once the basic project structure is in place, migrating individual controllers and views is us\", \"ually straightforward, especially if they're mainly focused on web responsibilities.\\n\\n## References\\n\", \"\\n- .NET Upgrade Assistant tool\\n- try -convert tool\\n- apiport tool\\n\\n## Strategies for migrating while\", \" running in production\\n\\nMany teams have .NET Framework apps they plan to migrate to .NET Core/.NET 7\", \", but the app is so large that the migration requires a significant amount of time to complete. The \", \"original app needs to live on while the migration is done piece by piece. There needs to be a way fo\", \"r the old and new versions of the app to work together side-by-side, or for the old version to be mi\", \"grated in-place, at least some of the way, without breaking it. Teams can employ many different stra\", \"tegies to support these goals.\\n\\n## Refactor the .NET Framework solution\\n\\nA good place to start if yo\", \"u plan to port a .NET Framework app to .NET Core is to refactor it to work better with .NET Core. Th\", \"is means updating individual class libraries to target .NET Standard and moving as much logic out of\", \" your ASP.NET MVC projects and into these class libraries. Any code you have in .NET Standard librar\", \"ies is immediately usable from both .NET Framework to .NET Core apps, which is why this step is so v\", \"aluable as part of a migration.\\n\\nWhen refactoring, make sure you're following good refactoring funda\", \"mentals. For example, create tests that verify what the system does before you start refactoring. Ru\", \"n these tests when you're done to confirm you didn't change the system's behavior. You may need to a\", \"dd characterization tests to the system if you don't already have a good suite of automated tests yo\", \"u can rely on.\\n\\n## Extract front -end assets to a CDN\\n\\nIf your .NET Framework apps include a lot of \", \"static assets, like scripts, CSS files, or images, you may be able to migrate these to a separate CD\", \"N. Then, update the existing app to reference the CDN links for these assets. When you port the app \", \"to .NET Core, these static files won't be part of the migration, and you'll just continue referencin\", \"g them from the CDN in the ASP.NET Core app.\\n\\n## Extract and migrate individual microservices\\n\\nLarge\", \" .NET Framework apps may already be comprised of separate front-end systems that can be migrated ind\", \"ividually. Or they may be candidates for migration to a microservices architecture, with some pieces\", \" of existing ASP.NET MVC apps being pulled out into new ASP.NET Core microservice implementations. Y\", \"ou can learn more about microservices in the associated ebook, .NET Microservices: Architecture for \", \"Containerized .NET Applications .\\n\\nFor example, the existing app might have a set of features it use\", \"s related to user sign-in and registration. These could be migrated to a separate microservice, whic\", \"h could be built and deployed using ASP.NET Core and then integrated into the legacy .NET Framework \", \"app. Next, the app might have a few pages dedicated to tracking the individual user's shopping cart.\", \" These pages could also be pulled out into their own separate microservice and again integrated into\", \" the existing app. In this way, the original .NET Framework app continues running in production, but\", \" with more and more of its features coming from modernized .NET Core microservices.\\n\\n## Deploy multi\", \"ple versions of the app side-by-side in IIS\\n\\nUsing a combination of host headers and redirects, an e\", \"xisting ASP.NET MVC app can be configured to run side by side with an ASP.NET Core app on the same I\", \"IS server. As pieces of functionality, such as individual controllers, are ported to ASP.NET Core, t\", \"heir routes and URLs are mapped within IIS to target the ASP.NET Core web site or sub-application (I\", \"IS virtual directories aren't supported with ASP.NET Core apps). An ASP.NET Core app can be hosted a\", \"s an IIS sub-application (sub-app). The sub -app's path becomes part of the root app's URL.\\n\\n## Appl\", \"y the Strangler pattern\\n\\nLarge ASP.NET MVC apps can be gradually replaced with a new ASP.NET Core ap\", \"p by incrementally migrating pieces of functionality. One approach to this is called the strangler p\", \"attern, named for strangler vines that strangle and eventually tear down trees. This approach relies\", \" on first implementing a facade layer over top of the existing solution. This facade should be built\", \" using the new approach to the problem, or an off-the-shelf solution such as an API gateway.\\n\\nOnce t\", \"he facade is in place, you can route part of it to a new ASP.NET Core app. As you port more of the o\", \"riginal .NET Framework app to .NET Core, you continue to update the facade layer accordingly, sendin\", \"g more of the facade's total functionality to the new system. Figure 3-5 shows the strangler pattern\", \" progression over time.\\n\\nEarly migration\\n\\nStrangler Fa\\u00e7ade\\n\\nLegacy\\n\\nLater migration\\n\\nStrangler Fa\\u00e7ad\", \"e\\n\\nFigure 3 -5. The Strangler pattern over time.\\n\\n<!-- image -->\\n\\nEventually, the entire facade laye\", \"r corresponds to the new, modern implementation. At this point, both the legacy system and the face \", \"layer can be retired. Microsoft has guidance on how to achieve incremental ASP.NET to ASP.NET Core m\", \"igration using the YARP reverse proxy .\\n\\n## Multi -targeting approaches\\n\\nMulti -targeting is recomme\", \"nded for large apps that will be migrated over time and for teams applying the Strangler pattern app\", \"roach. This approach can address BindingRedirect and package restoration challenges that surface fro\", \"m mixing PackageReference and packages.config restore styles. There are two options available for co\", \"de that must run in both .NET Framework and .NET Core environments.\\n\\n- Preprocessor directives (#if \", \"in C# or #If in Visual Basic) allow you to implement different functionality or use different depend\", \"encies when run in .NET Framework versus .NET Core.\\n- Project files can use conditional globbing pat\", \"terns, such as *.core.cs, to include different sets of files based on which framework is being targe\", \"ted.\\n\\nTypically you only follow these recommendations for class libraries. These techniques allow a \", \"single common codebase to be maintained while new functionality is added and features of the app are\", \" incrementally ported to use .NET Core.\\n\\n## Summary\\n\\nFrequently, large ASP.NET MVC and Web API apps \", \"won't be ported to ASP.NET Core all at once, but will migrate incrementally over time. This section \", \"offers several strategies for performing this incremental migration. Choose the one(s) that will wor\", \"k best for your organization and app.\\n\\n## References\\n\\n- .NET Microservices: Architecture for Contain\", \"erized .NET Applications\\n- eShopOnContainers Reference Microservices Application\\n- Host ASP.NET Core\", \" on Windows with IIS\\n- Strangler pattern\\n- Incremental ASP.NET to ASP.NET Core Migration\\n\\nMigration \", \"complete\\n\\nP\\n\\n\\u2022 8\\n\\n\\u2022 8\\n\\n\\u2022 8\\n\\neShopLegacyMVC\\n\\no Connected Services\\n\\nProperties\\n\\nReferences\\n\\nApp\\\\_Data\\n\", \"\\nApp\\\\_Start\\n\\nContent fonts\\n\\nPics\\n\\n## Example migration of eShop to ASP.NET Core\\n\\nServices\\n\\nSetup\\n\\nIn\", \" this chapter, you'll see how to migrate a .NET Framework app to .NET Core. The chapter examines a s\", \"ample online store app written for ASP.NET MVC 5. The app will use many of the concepts and tools de\", \"scribed earlier in this book. You'll find the starting point app in the eShopModernizing GitHub repo\", \"sitory. There are several different starting point apps. This chapter focuses on the eShopLegacyMVCS\", \"olution .\\n\\nex log4Net.xml\\n\\nThe initial version of the project is shown in Figure 4-1. It\\u2019s a fairly \", \"standard ASP.NET MVC 5 app.\\n\\n<!-- image -->\\n\\nFigure 4 -1. The eShopModernizing MVC sample project st\", \"ructure.\\n\\n<!-- image -->\\n\\nThis chapter demonstrates how to perform many of the upgrade steps by hand\", \". Alternatively, you can use the .NET Upgrade Assistant tool to perform many of the initial steps, l\", \"ike converting the project file, changing the target framework, and updating NuGet packages.\\n\\n## Run\", \" ApiPort to identify problematic APIs\\n\\nThe first step in preparing to migrate is to run the ApiPort \", \"tool. The tool identifies how many .NET Framework APIs the app calls and how many of these have .NET\", \" Standard or .NET Core equivalents. Focus primarily on your own app's logic, not third-party depende\", \"ncies, and pay attention to System.Web dependencies that will need to be ported. The ApiPort tool wa\", \"s introduced in the last chapter on understanding and updating dependencies. Note that currently it \", \"requires Visual Studio 2019; Visual Studio 2022 support is planned.\\n\\nAfter installing and configurin\", \"g the ApiPort tool, run the analysis from within Visual Studio, as shown in Figure 4-2.\\n\\nAnalyze\\n\\nTo\", \"ols\\n\\nCode Cleanup\\n\\nExtensions\\n\\nWindow\\n\\nHe\\n\\n\\u2022\\n\\nFigure 4 -2. Analyze assembly portability in Visual St\", \"udio.\\n\\n<!-- image -->\\n\\nChoose the web project\\u2019s assembly from the project\\u2019s bin folder, as shown in \", \"Figure 4-3.\\n\\n5 - =\\n\\nX Select Assembly Files\\n\\nFile\\n\\nHome\\n\\nInsert\\n\\nApiPortAnalysis.xlsx - Excel\\n\\nPage \", \"Layout\\n\\nT\\n\\nX\\n\\nE6\\n\\nFormulas\\n\\nReview\\n\\nView\\n\\n\\\"src &gt; eShopLegacyMVC &gt; bin &gt;\\n\\n80.59\\n\\nfx\\n\\nOrganiz\", \"e \\u2022\\n\\nNew folder\\n\\n7d9637ec-b1a8-4808-8e19-59fdc4ecb3ea\\n\\n** Dropbox\\n\\nTarget Framework\\n\\n&amp;OneDrive\\n\\n\", \".NETFramework,Version=v4.7.2\\n\\n\\u2022 This PC\\n\\ny 3D Objects\\n\\n\\u2022 Desktop\\n\\nDocuments\\n\\n+ Downloads\\n\\nMusic\\n\\nPic\", \"tures\\n\\n# Videos\\n\\nE&gt; OS (C:)\\n\\nFigure 4 -3. Choose the project's web assembly.\\n\\n<!-- image -->\\n\\nIf \", \"your solution includes several projects, you can choose all of them. The eShop sample includes just \", \"a single MVC project.\\n\\nOnce the report is generated, open the file and review the results. The summa\", \"ry provides a high-level view of what percentage of .NET Framework calls your app is making have com\", \"patible versions. Figure 4 -4 shows the summary for the eShop MVC project.\\n\\nFigure 4 -4. ApiPort sum\", \"mary.\\n\\n<!-- image -->\\n\\nFor this app, about 80 percent of the .NET Framework calls are compatible. 20\", \" percent of the calls need to be addressed during the porting process. Viewing the details reveals t\", \"hat all of the incompatible calls are part of System.Web, which is an expected incompatibility. The \", \"dependencies on System.Web calls will be addressed when the app's controllers and related classes ar\", \"e migrated in a later step. Figure 4-5 lists some of the specific types found by the tool:\\n\\n1\\n\\n2\\n\\n3\\n\", \"\\n4\\n\\n5\\n\\nLoad Test\\n\\nTable Tools\\n\\nDesign\\n\\nTell me what you want to do\\n\\nY U\\n\\nSearch bin\\n\\nE\\n\\nLEE\\n\\nP\\n\\nTarg\", \"et type\\n\\nT:System.Web.Mvc.UrlParameter\\n\\nT:System.Web.Mvc.UrlParameter\\n\\nT:System.Web.HttpApplication\\n\", \"\\nT:System.Web.HttpApplication\\n\\nT:System.Web.Mvc.HttpNotFoundResult\\n\\nT:System.Web.Mvc.Controller\\n\\nT:S\", \"ystem.Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System. Web.Mv\", \"c.Controller\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Controller\\n\", \"\\nT:System.Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System.Web.Mvc.Controller\\n\\nT:System.Web\", \".Mvc.ActionNameAttribute\\n\\nT:System.Web.Mvc.ActionNameAttribute\\n\\nT:System. Web.HttpContext\\n\\nT:System.\", \"Web.HttpContext\\n\\nT:System. Web.HttpContext\\n\\nT:System. Web.HttpContext\\n\\nT:System.Web.Mvc.HandleErrorA\", \"ttribute\\n\\nT:System.Web.Mvc.HandleErrorAttribute\\n\\nT:System.Web.Mvc.HttpGetAttribute\\n\\nT:System.Web.Mvc\", \".HttpGetAttribute\\n\\n\\u2022 Target member\\n\\nT:System.Web.Mvc.Ur|Parameter\\n\\nF:System.Web.Mvc.UrlParameter.Opt\", \"ional\\n\\nT:System.Web.HttpApplication\\n\\nM:System.Web.HttpApplication.#ctor\\n\\nT:System.Web.Mvc.HttpNotFou\", \"ndResult\\n\\nAssembly Name eShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyMVC\\n\\neShopLegacyM\", \"VC\\n\\nFigure 4 -5. ApiPort incompatible type details.\\n\\n<!-- image -->\\n\\nMost of the incompatible types \", \"refer to Controller and various related attributes that have equivalents in ASP.NET Core.\\n\\n## Update\", \" project files and NuGet reference syntax\\n\\nNext, migrate from the older .csproj file structure to th\", \"e newer, simpler structure introduced with .NET Core. In doing so, you'll also migrate from using a \", \"packages.config file for NuGet references to using &lt;PackageReference&gt; elements in the project \", \"file. Old-style project files may also use &lt;PackageReference&gt; elements, so it usually makes se\", \"nse to migrate all NuGet package references to this format first, before upgrading to the new projec\", \"t file format.\\n\\nThe original project's eShopLegacyMVC.csproj file is 418 lines long. A sample of the\", \" project file is shown in Figure 4-6. To offer a sense of its overall size and complexity, the right\", \" side of the image contains a miniature view of the entire file.\\n\\n\\u2022 eShopLegacyMVC.csproj X\\n\\nsrc &gt\", \"; eShopLegacyMVC &gt; i eShopLegacyMVC.csproj k/?xm] version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?l)\\n\\n\\u2039Project Too\", \"lsVersion=\\\"15.0\\\" DefaultTargets=\\\"Build\\\" xmIns=\\\"http://schemas.microsoft.com/developer/msbuild/200=\\n\\n\", \"\\u2039Import Project=\\\"..\\\\.. \\\\packages\\\\Microsoft.CodeDom.Providers.DotNetCompilerPlatform.2.0.1\\\\build\\\\net4\", \"6\\\\Microsc\\n\\n\\u2039Import Project=\\\"\\n\\n..\\\\..\\\\packages\\\\Microsoft.Net.Compilers.2.10.0\\\\build\\\\Microsoft.Net.Comp\", \"ilers.props\\\" Conditic\\n\\n\\u2039Import Project=\\\"$(MSBuildExtensionsPath32) \\\\Microsoft\\\\VisualStudio\\\\v$(Visual\", \"StudioVersion)\\\\TypeScript\\\\Micros\\n\\n&lt;PropertyGroup&gt;...\\n\\n&lt;/PropertyGroup&gt;\\n\\n&lt;/PropertyGro\", \"up&gt;\\n\\n&lt;/PropertyGroup&gt;\\n\\n&lt;ItemGroup&gt;...\\n\\n&lt;/ ItemGroup&gt;\\n\\n&lt; ItemGroup&gt;\\n\\n\\u2039Comp\", \"ile Include=\\\"Global.asax.cs\\\"\\u203a\\n\\n&lt;/Compile&gt;\\n\\nFigure 4 -6. The eShopLegacyMVC.csproj file structu\", \"re.\\n\\n<!-- image -->\\n\\nA common way to create a new project file for an existing ASP.NET project is to\", \" create a new ASP.NET Core app using dotnet new or File &gt; New &gt; Project in Visual Studio. Then\", \" files can be copied from the old project to the new one to complete the migration.\\n\\nIn addition to \", \"the C# project file, NuGet dependencies are stored in a separate 45-line packages.config file, as sh\", \"own in Figure 4-7.\\n\\n2\\n\\n5\\n\\n6\\n\\n7\\n\\n32\\n\\n33\\n\\n42\\n\\n43\\n\\n51\\n\\n52\\n\\n197\\n\\n198\\n\\n199\\n\\n200\\n\\n201\\n\\n202\\n\\n203\\n\\n204\\n\\n205\\n\", \"\\n206\\n\\n207\\n\\n208\\n\\n209\\n\\n210\\n\\n211\\n\\n212\\n\\n213\\n\\n&gt;\\n\\n&gt;\\n\\n\\u2022 packages.config X\\n\\nsrc &gt; eShopLegacyMVC &g\", \"t; \\u2022 packages.config\\n\\n1\\n\\n#?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?[\\n\\n\\u2039packages&gt;\\n\\n&lt; package\\n\\n&lt; p\", \"ackage\\n\\n\\u2039package\\n\\n&lt; package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039 package\\n\\n\\u2039package\\n\\n&lt; package\\n\\n&lt; package\\n\", \"\\n&lt; package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n&lt; package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039\", \"package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n\\u2039package\\n\\n&lt; package\\n\\n&lt; package\\n\\n&lt; package\\n\", \"\\n\\u2039 package\\n\\n\\u2039package\\n\\n&lt; package\\n\\n\\u2039package\\n\\n\\u2039 package\\n\\n\\u2039package\\n\\n\\u2039 package id=\\\"Ant]r\\\" version=\\\"3.5\", \".0.2\\\" targetFramework=\\\"net472\\\" /&gt;\\n\\nid=\\\"Autofac\\\" version=\\\"4.9.1\\\" targetFramework=\\\"net472\\\" / &gt;\\n\\n\", \"id= \\\"Autofac. Mvc5\\\" version=\\\"4.0.2\\\" targetFramework=\\\"net472\\\" /&gt;\\n\\nid= \\\"bootstrap\\\" version=\\\"4.3.1\\\" \", \"targetFramework=\\\"net472\\\" /&gt;\\n\\nFigure 4 -7. The packages.config file.\\n\\n<!-- image -->\\n\\nYou can migr\", \"ate packages.config in class library projects using Visual Studio. This functionality doesn't work w\", \"ith ASP.NET projects, however. Learn more about migrating packages.config to &lt;PackageReference&gt\", \"; in Visual Studio. If you have a large number of projects to migrate, this community tool may help.\", \" If you're using a tool to migrate the project file to the new format, you should do that after you'\", \"ve finished migrating all NuGet references to use &lt;PackageReference&gt;.\\n\\n## Create new ASP.NET C\", \"ore project\\n\\nAdd a new ASP.NET Core project to the existing app's solution to make moving files easi\", \"er, as most of the work can be done from within Visual Studio's Solution Explorer. In Visual Studio,\", \" right-click on your app's solution and choose Add New Project. Choose ASP.NET Core web application,\", \" and give the new project a name as shown in Figure 4-8.\\n\\n8\\n\\n10\\n\\n11\\n\\n12\\n\\n13\\n\\n14\\n\\n15\\n\\n16\\n\\n17\\n\\n18\\n\\n19\\n\", \"\\n20\\n\\n21\\n\\n22\\n\\n23\\n\\n24\\n\\n25\\n\\n26\\n\\n27\\n\\n28\\n\\n29\\n\\n30\\n\\n31\\n\\n32\\n\\n33\\n\\n34\\n\\n35\\n\\n36\\n\\n37\\n\\nConfigure your new project\\n\", \"\\nASP.NET Core Web Applicationc*\\n\\nProject name eShopPorted\\n\\nLocation\\n\\nC:\\\\dev\\\\GitHub\\\\eShopModernizing\\\\\", \"eShopLegacyMVCSolution\\n\\nLinux macos\\n\\nWindows\\n\\nCloud\\n\\nService\\n\\nWeb\\n\\nFigure 4 -8. Add new ASP.NET Core\", \" web application.\\n\\n<!-- image -->\\n\\nThe next dialog will ask you to choose which template to use. Sel\", \"ect the Empty template. Be sure to also change the dropdown from .NET Core to .NET Framework. Select\", \" ASP.NET Core 2.2, as shown in Figure 4-9.\\n\\nX\\n\\nCreate a new ASPINET Core web application\\n\\nNET Framew\", \"ork\\n\\nEmpty it.\\n\\nAPI\\n\\nWeb Application\\n\\nWeb Application (Model-View-Controller)\\n\\nAngular\\n\\nA\\n\\nReact js\\n\", \"\\nGet additional project templates\\n\\nFigure 4 -9. Choose an Empty project template targeting .NET Fram\", \"ework with ASP.NET Core 2.2.\\n\\n<!-- image -->\\n\\n## Migrating NuGet Packages\\n\\nSince the built -in migra\", \"tion tool for migrating packages.config to &lt;PackageReference&gt; doesn't work on ASP.NET projects\", \", you can use a community tool instead, or migrate by hand. A community tool I've used uses an XSL f\", \"ile to transform from one format to the other. To use it, first copy the packages.config file to the\", \" newly created ASP.NET Core project folder. Make a backup of your files, as this script removes the \", \"packages.config file from all folders under where you run the script. Then run these commands from t\", \"he project folder (or for the entire solution if you prefer):\\n\\n## iwr\\n\\nhttps://gist . githubusercont\", \"ent . com/aienabled/0bce5e4b17118122f2772e7c9218bf9c/raw/7789 53f89882877a7124894b47dccfb1ba3e80a0/C\", \"onvert-ToPackageReference . ps1 -OutFile Convert -ToPackageReference . ps1\\n\\n## iwr\\n\\nhttps://gist . g\", \"ithubusercontent . com/aienabled/0bce5e4b17118122f2772e7c9218bf9c/raw/7789 53f89882877a7124894b47dcc\", \"fb1ba3e80a0/Convert-ToPackageReference . xsl -OutFile Convert -ToPackageReference . xsl\\n\\n./Convert-T\", \"oPackageReference . ps1 | Out-Null\\n\\nThe first two commands download files so that they exist locally\", \". The last line runs the script. After running it, try to build the new project. You'll most likely \", \"get some errors. To resolve them, you'll want to eliminate some references (like most of the Microso\", \"ft.AspNet and System packages), and you may need to remove some xmlns attributes.\\n\\nX\\n\\neShopPorted &g\", \"t; \\u2022 eShopPorted.csproj\\n\\n1\\n\\n\\u2039Project Sdk=\\\"Microsoft.NET.Sdk. Web\\\"&gt;\\n\\n2\\n\\n3\\n\\n8\\n\\n9\\n\\n10\\n\\n11\\n\\n12\\n\\n13\\n\\n1\", \"4\\n\\n15\\n\\n16\\n\\n17\\n\\n18\\n\\n19\\n\\n20\\n\\n21\\n\\n22\\n\\n23\\n\\n24\\n\\n25\\n\\n26\\n\\n27\\n\\n28\\n\\n29\\n\\n&lt;PropertyGroup&gt;\\n\\n\\u2039TargetFramewo\", \"rk\\u203anet461&lt;/TargetFramework\\u203a\\n\\n&lt;/PropertyGroup&gt;\\n\\n&lt; ItemGroup \\u203a\\n\\nIn most ASP.NET MVC apps, \", \"many client-side dependencies like Bootstrap and jQuery were deployed using NuGet packages. In ASP.N\", \"ET Core, NuGet packages are only used for server-side functionality. Client files should be managed \", \"through other means. Review the list of &lt;PackageReference&gt; elements added and remove and make \", \"note of any that are for client libraries, including:\\n\\n&lt;/PackageReference&gt;\\n\\n- Bootstrap\\n- jQue\", \"ry\\n- jQuery.Validation\\n- Modernizr\\n- popper.js\\n- Respond\\n\\nThe static client files installed by NuGet\", \" for these packages will be copied over to the new project's wwwroot folder and hosted from there. I\", \"t's worth considering whether these files are still needed by the app, and whether it makes sense to\", \" continue hosting them or to use a content delivery network (CDN) instead. These library versions ca\", \"n be managed at build time using tools like LibMan or npm . Figure 4-10 shows the full eShopPorted.c\", \"sproj file after migrating package references using the conversion tool shown and removing unnecessa\", \"ry packages.\\n\\nFigure 4 -10. Package references in the eShopPorted.csproj file.\\n\\n<!-- image -->\\n\\nThe \", \"package references can be further compacted by making the &lt;Version&gt;1.0.0.0&lt;/Version&gt; ele\", \"ment a Version=1.0.0.0 attribute on &lt;PackageReference&gt;.\\n\\n## Migrate static files\\n\\nAny static f\", \"iles the app uses, including third-party scripts and frameworks but also custom images and styleshee\", \"ts, must be copied from the old project to the new one. In ASP.NET MVC apps, files were typically ac\", \"cessed based on their location within the project folder. In ASP.NET Core apps, these static files w\", \"ill be accessed based on their location within the wwwroot folder. For the eShop project, there are \", \"static files in the following folders:\\n\\n- Content\\n- fonts\\n- Images\\n- Pics\\n- Scripts\\n\\nThe Empty proje\", \"ct template used in the previous step doesn't include this folder by default, or the middleware need\", \"ed for it to work. You'll need to add them.\\n\\nAdd a wwwroot folder to the root of the project.\\n\\nAdd v\", \"ersion 2.2.0 of the Microsoft.AspNetCore.StaticFiles NuGet package.\\n\\nIn Startup.cs, add a call to ap\", \"p.UseStaticFiles() in the Configure method:\\n\\n```\\npublic void Configure(IApplicationBuilder app , IHo\", \"stingEnvironment env) { if (env . IsDevelopment()) { app.UseDeveloperExceptionPage(); } app.UseStati\", \"cFiles(); // ... }\\n```\\n\\nCopy the Content folder from the ASP.NET MVC app to the new project\\u2019s wwwroo\", \"t folder.\\n\\nRun the app and navigate to its /Content/base.css folder to verify that the static file i\", \"s served correctly from its expected path. Continue copying the rest of the folders containing stati\", \"c files to the new project. You'll also want to copy the favicon.ico file from the project's root to\", \" the wwwroot folder. Figure 4-11 shows the results after these files and their folders have all been\", \" copied.\\n\\n\\u2022 B\\n\\neShopPorted\\n\\n&gt; Connected Services\\n\\nDependencies\\n\\n\\u2022 8.\\n\\n1 8t\\n\\nProperties www.root\\n\\n\", \"8\\n\\n8\\n\\n\\u2022 8\\u041f\\n\\nControllers\\n\\n\\u2022 82] Migrations\\n\\n\\u2022 &amp;\\n\\nModels\\n\\n8 Modules\\n\\n8C Services\\n\\n\\u2022 8\\n\\nViewModel\\n\\n\", \"\\u2022 8C\\n\\nViews\\n\\n82] app.config\\n\\n\\u2022 B\\n\\nappsettings json\\n\\n\\u2022 8C# Program.cs\\n\\nD BC# Startup.cs\\n\\nFigure 4 -11\", \". Static folders copied over to wwwroot folder.\\n\\n<!-- image -->\\n\\n## Migrate C# files\\n\\nNext, copy ove\", \"r the C# files used by the app, including standard MVC folders and their contents like Controllers ,\", \" Models , ViewModel, and Services. There will most likely be some changes needed in these files. It'\", \"s best to copy one folder (or subfolder) at a time and compile to see what errors need to be address\", \"ed as you go.\\n\\nFor the eShop sample, the first folder I choose to migrate is the Models folder, whic\", \"h includes C# entities and Entity Framework classes. This folder's classes are used by most of the o\", \"thers, so they won't work until these classes have been copied. After copying the folder and buildin\", \"g, the compiler revealed errors related to missing namespace System.Web.Hosting, related access to H\", \"ostingEnvironment, and a reference to ConfigurationManager.AppSettings. The solution to these issues\", \" will be to pass in the necessary path data; for now the breaking lines are commented out and a TODO\", \": comment is added to each one to track it. After changing five lines, the Task List shows five item\", \"s and the project builds.\\n\\nNext, the ViewModel folder, with its one class, is copied over. It\\u2019s an e\", \"asy one, and builds immediately.\\n\\nThe Services folder is copied over. This folder's classes depend o\", \"n Entity Framework classes from the Models folder, which is why it needed to be copied after that fo\", \"lder. Fortunately, it too builds without errors.\\n\\nfonts\\n\\nPics\\n\\nThat leaves the Controllers folder an\", \"d its two Controller classes. After copying the folder to the new project and building, there are se\", \"ven build errors. Four of them are related to ViewBag access and report an error of:\\n\\nMissing compil\", \"er required member 'Microsoft.CSharp.RuntimeBinder.CSharpArgumentInfo.Create'\\n\\nTo resolve this error\", \", add a NuGet package reference to C#:\\n\\n```\\n<PackageReference Include=\\\"Microsoft.CSharp\\\" Version=\\\"4.\", \"7.0\\\" />\\n```\\n\\nThe remaining three errors specify types that are defined in an assembly that isn't ref\", \"erenced. Specifically these types:\\n\\n- HttpServerUtilityBase\\n- RouteValueDictionary\\n- HttpRequestBase\", \"\\n\\nLet's look at each error one by one. The first error occurs while trying to reference the Server p\", \"roperty of Controller, which no longer exists. The goal of the operation is to get the path to an im\", \"age file in the app:\\n\\n```\\nif (item != null) { var webRoot = Server . MapPath(\\\"~/Pics\\\"); // compiler \", \"error on this line var path = Path . Combine(webRoot , item . PictureFileName); string imageFileExte\", \"nsion = Path . GetExtension(item . PictureFileName); string mimetype = GetImageMimeTypeFromImageFile\", \"Extension(imageFileExtension); var buffer = System . IO . File . ReadAllBytes(path); return File(buf\", \"fer , mimetype); }\\n```\\n\\nThere are two possible solutions to this problem. The first is to keep the f\", \"unctionality as it is. In this case, rather than using Server.MapPath, a fixed path referencing the \", \"image files' location in wwwroot should be used. Alternately, since the only purpose of this action \", \"method is to return a static image file, the references to this action in view files can be updated \", \"to reference the static files directly, which improves runtime performance. Since no processing is b\", \"eing done as part of this action, there's no reason not to just serve the files directly. If it's no\", \"t tenable to update all references to this action, the action could be rewritten to produce a redire\", \"ct to the static file's location.\\n\\nThe next two errors both occur in the same private method in the \", \"same line of code:\\n\\n```\\nprivate void AddUriPlaceHolder(CatalogItem item) { item . PictureUri = this \", \". Url . RouteUrl(PicController . GetPicRouteName , new { catalogItemId = item . Id }, this . Request\", \" . Url . Scheme); }\\n```\\n\\nBoth this.Url and this.Request cause compiler errors. Looking at how this c\", \"ode is used, its purpose is to build a link to the PicController action that renders image files. Th\", \"e same one we just discovered could probably be replaced with direct links to the static files locat\", \"ed in wwwroot. For now, it's worth commenting out this code and adding a TODO: comment to reference \", \"the pics another way.\\n\\nIt's worth noting that the base Controller class, used by the CatalogControll\", \"er class in which this code appears, is still referring to System.Web.Mvc.Controller. There will und\", \"oubtedly be more errors to fix once we update this to use ASP.NET Core. First, remove the using Syst\", \"em.Web.Mvc; line from the list of using statements in CatalogController. Next, add the NuGet package\", \" Microsoft.AspNetCore.Mvc. Finally, add a using Microsoft.AspNetCore.Mvc; statement, and build the a\", \"pp again.\\n\\nThis time, there are 16 errors:\\n\\n- Include is not a valid named attribute argument (2)\\n- \", \"HttpStatusCodeResult not found (3)\\n- HttpNotFound does not exist (3)\\n- SelectList not found (8)\\n\\nOnc\", \"e more, let's review these errors one by one. First, SelectList can be fixed by adding using Microso\", \"ft.AspNetCore.Mvc.Rendering;, which eliminates half of the errors.\\n\\nAll references to return HttpNot\", \"Found(); should be replaced with return NotFound();.\\n\\nAll references to return new HttpStatusCodeRes\", \"ult(HttpStatusCode.BadRequest); should be replaced with return BadRequest();.\\n\\nThat just leaves the \", \"use of Include with a [Bind] attribute on a couple of action methods that look like this:\\n\\n```\\n[Http\", \"Post] [ValidateAntiForgeryToken] public ActionResult Create([Bind(Include = \\\"Id,Name,Description,Pri\", \"ce,PictureFileName,CatalogTypeId,CatalogBrandId,AvailableStock,Rest ockThreshold,MaxStockThreshold,O\", \"nReorder\\\")] CatalogItem catalogItem) {\\n```\\n\\nThe preceding code restricts model binding to the proper\", \"ties listed in the Include string. In ASP.NET Core MVC, the [Bind] attribute still exists, but no lo\", \"nger needs the Include = argument. Pass the list of properties directly to the [Bind] attribute:\\n\\n``\", \"`\\n[HttpPost] [ValidateAntiForgeryToken] public ActionResult Create([Bind(\\\"Id,Name,Description,Price,\", \"PictureFileName,CatalogTypeId,CatalogBrandId,Availa bleStock,RestockThreshold,MaxStockThreshold,OnRe\", \"order\\\")] CatalogItem catalogItem) {\\n```\\n\\nWith these changes, the project compiles once more. It's ge\", \"nerally a better practice to use separate model types for controller inputs, rather than using model\", \" binding directly to your domain model or data model types.\\n\\n## Migrate views\\n\\nThe two biggest ASP.N\", \"ET Core MVC features related to views are Razor Pages and Tag Helpers. For the initial migration, we\", \" won't use either feature. You should, however, keep the features in mind if you continue supporting\", \" the app once it's been migrated. The next step is to copy the Views folder from the original projec\", \"t into the new one. After building, there are nine errors:\\n\\n- HttpContext does not exist (2)\\n- Scrip\", \"ts does not exist (5)\\n- Styles does not exist (1)\\n- HtmlString could not be found(1)\\n\\nInvestigating \", \"these errors finds that most of them are in the main *\\\\_Layout.cshtml, with several related to rende\", \"ring script and style tags, or displaying when the server hosting the app was last restarted. The fo\", \"llowing code listing shows problem areas in the \\\\_Layout.cshtml* file:\\n\\n```\\n// other lines omitted; \", \"only errors shown @Styles.Render(\\\"~/Content/css\\\") @Scripts.Render(\\\"~/bundles/modernizr\\\") @{ var sess\", \"ionInfo = new HtmlString($\\\"{HttpContext.Current.Session[\\\"MachineName\\\"]}, {HttpContext.Current.Sessio\", \"n[\\\"SessionStartTime\\\"]}\\\");} @Scripts.Render(\\\"~/bundles/jquery\\\") @Scripts.Render(\\\"~/bundles/bootstrap\\\"\", \")\\n```\\n\\nThe reference to Modernizr can be removed. The references to Bootstrap and jQuery can be repl\", \"aced with CDN links to the appropriate version.\\n\\nReplace @Styles.Render line with:\\n\\n```\\n<link rel=\\\"s\", \"tylesheet\\\" href=\\\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\\\" integrity\", \"=\\\"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\\\" crossorigin=\\\"anonymous\\\">\\n\", \"```\\n\\nReplace the last two Scripts.Render lines with:\\n\\n```\\n<script src=\\\"https://code.jquery.com/jquer\", \"y-3.3.1.slim.min.js\\\" integrity=\\\"sha384q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6ji\", \"zo\\\" crossorigin=\\\"anonymous\\\"></script> <script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/\", \"1.14.7/umd/popper.min.js\\\" integrity=\\\"sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86d\", \"IHNDz0W1\\\" crossorigin=\\\"anonymous\\\"></script> <script src=\\\"https://stackpath.bootstrapcdn.com/bootstra\", \"p/4.3.1/js/bootstrap.min.js\\\" integrity=\\\"sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x\", \"0xIM+B07jRM\\\" crossorigin=\\\"anonymous\\\"></script>\\n```\\n\\nFinally, after the Bootstrap &lt;link&gt;, add a\", \"dditional &lt;link&gt; elements for local styles your app uses. For eShop, the result is shown here:\", \"\\n\\n```\\n<link rel=\\\"stylesheet\\\" href=\\\"~/Content/custom.css\\\" /> <link rel=\\\"stylesheet\\\" href=\\\"~/Content/b\", \"ase.css\\\" /> <link rel=\\\"stylesheet\\\" href=\\\"~/Content/Site.css\\\" />\\n```\\n\\nTo determine the order in which\", \" the &lt;link&gt; elements should appear, look at your original app's rendered HTML. Alternatively, \", \"review BundleConfig.cs, which for the eShop sample includes this code indicating the appropriate seq\", \"uence:\\n\\n```\\nbundles . Add(new StyleBundle(\\\"~/Content/css\\\").Include( \\\"~/Content/bootstrap.css\\\" , \\\"~/C\", \"ontent/custom.css\\\" ,\\n```\\n\\n```\\n\\\"~/Content/base.css\\\" , \\\"~/Content/site.css\\\"));\\n```\\n\\nBuilding again rev\", \"eals one more error loading jQuery Validation on the Create and Edit views. Replace it with this scr\", \"ipt:\\n\\n```\\n<script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/jqueryvalidate/1.17.0/jquery.validate.\", \"min.js\\\" integrity=\\\"sha512O/nUTF5mdFkhEoQHFn9N5wmgYyW323JO6v8kr6ltSRKriZyTr/8417taVWeabVS4iONGk2V444Q\", \"D0P2cwhuTkg==\\\" crossorigin=\\\"anonymous\\\"></script>\\n```\\n\\nThe last thing to fix in the views is the refe\", \"rence to Session to display how long the app has been running, and on which machine. We can display \", \"this data directly in the site's *\\\\_Layout.cshtml* by using System.Environment.MachineName and Syste\", \"m.Diagnostics.Process.GetCurrentProcess().StartTime:\\n\\n```\\n<section class=\\\"col -sm-6\\\"> <img class=\\\"es\", \"h-app-footer-text hidden-xs\\\" src=\\\"~/images/main_footer_text.png\\\" width=\\\"335\\\" height=\\\"26\\\" alt=\\\"footer\", \" text image\\\" /> <br /> <small>@Environment.MachineName -@System.Diagnostics.Process.GetCurrentProces\", \"s().StartTime.ToString() UTC</small> </section>\\n```\\n\\nAt this point, the app once more builds success\", \"fully. However, trying to run it just yields Hello World! because the Empty ASP.NET Core template is\", \" only configured to display that in response to any request. In the next section, I complete the mig\", \"ration by configuring the app to use ASP.NET Core MVC, including dependency injection and configurat\", \"ion. Once that's in place, the app should run. Then it will be time to fix the TODO: tasks that were\", \" created earlier.\\n\\n## Migrate app startup components\\n\\nThe last migration step is to take the app sta\", \"rtup tasks from Global.asax, and the classes it calls, and migrate these to their ASP.NET Core equiv\", \"alents. These tasks include configuration of MVC itself, setting up dependency injection, and workin\", \"g with the new configuration system. In ASP.NET Core, these tasks are handled in the Startup.cs file\", \".\\n\\n## Configure MVC\\n\\nThe original ASP.NET MVC app has the following code in its Application\\\\_Start i\", \"n Global.asax, which runs when the app starts up:\\n\\n```\\nprotected void Application_Start() { containe\", \"r = RegisterContainer(); AreaRegistration . RegisterAllAreas(); FilterConfig . RegisterGlobalFilters\", \"(GlobalFilters . Filters); RouteConfig . RegisterRoutes(RouteTable . Routes); BundleConfig . Registe\", \"rBundles(BundleTable . Bundles); ConfigDataBase(); }\\n```\\n\\nLooking at these lines one by one, the Reg\", \"isterContainer method sets up dependency injection, which will be ported below. The next three lines\", \" configure different parts of MVC: areas, filters, and routes. Bundles are replaced by static files \", \"in the ported app. The last line sets up data access for the app, which will be shown in a later sec\", \"tion.\\n\\nSince this app isn't actually using areas, there's nothing that needs to be done to migrate t\", \"he area registration call. If your app does need to migrate areas, the docs specify how to configure\", \" areas in ASP.NET Core .\\n\\nThe call to register global filters invokes a helper on the FilterConfig c\", \"lass in the app's App\\\\_Start folder:\\n\\n```\\npublic static void RegisterGlobalFilters(GlobalFilterColle\", \"ction filters) { filters . Add(new HandleErrorAttribute()); }\\n```\\n\\nThe only attribute added to the a\", \"pp is the ASP.NET MVC filter, HandleErrorAttribute. This filter ensures that when an exception occur\", \"s as part of a request, a default action and view are displayed, rather than the exception details. \", \"In ASP.NET Core, this same functionality is performed by the UseExceptionHandler middleware. The det\", \"ailed error messages aren't enabled by default. They must be configured using the UseDeveloperExcept\", \"ionPage middleware. To configure this behavior to match the original app, the following code must be\", \" added to the start of the Configure method in Startup.cs:\\n\\n```\\npublic void Configure(IApplicationBu\", \"ilder app , IWebHostEnvironment env) { if (env . IsDevelopment()) { app.UseDeveloperExceptionPage();\", \" } else { app.UseExceptionHandler(\\\"/Error\\\"); } // ... }\\n```\\n\\nThis takes care of the only filter used\", \" by the eShop app, and in this case it was done by using built-in middleware. If you have global fil\", \"ters that must be configured in your app, this is done when MVC is added in Program.cs when you conf\", \"igure services, which is shown later in this chapter.\\n\\nThe last piece of MVC-related logic that need\", \"s to be migrated are the app's default routes. The call to RouteConfig.RegisterRoutes(RouteTable.Rou\", \"tes) passes the MVC route table to the RegisterRoutes helper method, where the following code is exe\", \"cuted when the app starts up:\\n\\n```\\npublic static void RegisterRoutes(RouteCollection routes) { route\", \"s . MapMvcAttributeRoutes(); routes . IgnoreRoute(\\\"{resource}.axd/{*pathInfo}\\\"); routes . MapRoute( \", \"name: \\\"Default\\\" , url: \\\"{controller}/{action}/{id}\\\" , defaults: new { controller = \\\"Catalog\\\" , actio\", \"n = \\\"Index\\\" , id = UrlParameter . Optional }\\n```\\n\\n```\\n); }\\n```\\n\\nTaking this code line-by-line, the f\", \"irst line sets up support for attribute routes. This is built into ASP.NET Core, so it's unnecessary\", \" to configure it separately. Likewise, {resource}.axd files aren't used with ASP.NET Core, so there'\", \"s no need to ignore such routes. The MapRoute method configures the default for MVC, which uses the \", \"typical {controller}/{action}/{id} route template. It also specifies the defaults for this template,\", \" such that the CatalogController is the default controller used and the Index method is the default \", \"action. Larger apps will frequently include more calls to MapRoute to set up additional routes.\\n\\nASP\", \".NET Core MVC supports conventional routing and attribute routing. Conventional routing is analogous\", \" to how the route table is configured in the RegisterRoutes method listed previously. To set up conv\", \"entional routing with a default route like the one used in the eShop app, add the following code to \", \"the bottom of the Configure method in Startup.cs:\\n\\n```\\napp.UseMvc(routes => { routes . MapRoute(\\\"def\", \"ault\\\" , \\\"{controller=Catalog}/{action=Index}/{id?}\\\"); });\\n```\\n\\n## Note\\n\\nWith ASP.NET Core 3.0 and la\", \"ter, this is changed to use endpoints. For the initial port to ASP.NET Core 2.2, this is the proper \", \"syntax for mapping conventional routes.\\n\\nWith these changes in place, the Configure method is almost\", \" done. The original template's app.Run method that prints Hello World! should be deleted. At this po\", \"int, the method is as shown here:\\n\\n```\\npublic void Configure(IApplicationBuilder app , IHostingEnvir\", \"onment env) { if (env . IsDevelopment()) { app.UseDeveloperExceptionPage(); } else { app.UseExceptio\", \"nHandler(\\\"/Home/Error\\\"); } app.UseStaticFiles(); app.UseMvc(routes => { routes . MapRoute(\\\"default\\\" \", \", \\\"{controller=Catalog}/{action=Index}/{id?}\\\"); }); }\\n```\\n\\nNow it's time to configure MVC services, \", \"followed by the rest of the app's support for dependency injection (DI). So far, the eShopPorted pro\", \"ject's Program.cs file hasn't added any service configuration. Now it's time to start adding necessa\", \"ry services.\\n\\nFirst, to get ASP.NET Core MVC to work properly, it needs to be added:\\n\\n```\\nbuilder . \", \"Services . AddMvc();\\n```\\n\\nThe preceding code is the minimal configuration required to get MVC featur\", \"es working. There are many additional features that can be configured from this call (some of which \", \"are detailed later in this chapter), but for now this will suffice to build the app. Running it now \", \"routes the default request properly, but since we've not yet configured DI, an error occurs while ac\", \"tivating CatalogController, because no implementation of type ICatalogService has been provided yet.\", \" We'll return to configure MVC further in a moment. For now, let's migrate the app's dependency inje\", \"ction.\\n\\n## Migrate dependency injection configuration\\n\\nThe original app\\u2019s Global.asax file defines t\", \"he following method, called when the app starts up:\\n\\n```\\nprotected IContainer RegisterContainer() { \", \"var builder = new ContainerBuilder(); builder . RegisterControllers(typeof(MvcApplication).Assembly)\", \"; var mockData = bool . Parse(ConfigurationManager . AppSettings[\\\"UseMockData\\\"]); builder . Register\", \"Module(new ApplicationModule(mockData)); var container = builder . Build(); DependencyResolver . Set\", \"Resolver(new AutofacDependencyResolver(container)); return container; }\\n```\\n\\nThis code configures an\", \" Autofac container, reads a config setting to determine whether real or mock data should be used, an\", \"d passes this setting into an Autofac module (found in the app's /Modules directory). Fortunately, A\", \"utofac supports .NET Core, so the module can be migrated directly. Copy the folder into the new proj\", \"ect and updates the class's namespace and it should compile.\\n\\nASP.NET Core has built -in support for\", \" dependency injection, but you can wire up a third-party container such as Autofac easily if necessa\", \"ry. In this case, since the app is already configured to use Autofac, the simplest solution is to ma\", \"intain its usage. In Program.cs, simply configure the builder to use the AutofacServiceProviderFacto\", \"ry as shown:\\n\\n```\\n// using Autofac.Extensions.DependencyInjection builder . Host . UseServiceProvide\", \"rFactory(new AutofacServiceProviderFactory()); // note: the factory calls builder.Populate so we don\", \"'t need to here bool useMockData = true; // TODO: read from config builder . Host . ConfigureContain\", \"er<ContainerBuilder>(builder => builder . RegisterModule(new ApplicationModule(useMockData)));\\n```\\n\\n\", \"For now, the setting for useMockData is set to true. This setting will be read from configuration in\", \" a moment. At this point, the app compiles and should load successfully when run, as shown in Figure\", \" 412.\\n\\nIF Index - Catalog manager (MVC) \\u00d7\\n\\n+ &gt; C\\u2022 localhost:44337\\n\\nCreate New\\n\\nNAME\\n\\n.NET Bot Bla\", \"ck Hoodie\\n\\n.NET Black &amp; White Mug\\n\\nPrism White T-Shirt\\n\\n.NET Foundation T-shirt\\n\\nRoslyn Red Shee\", \"t\\n\\nNET Blue Hoodie\\n\\nRoslyn Red T-Shirt\\n\\nKudu Purple Hoodie\\n\\nCupsT&gt; White Mug\\n\\n.NET Foundation She\", \"et\\n\\ne\\n\\neSHOP\\n\\nonCONTAINERS\\n\\nCatalog manage* (MVC)\\n\\nFigure 4 -12. Ported eShop app running locally wi\", \"th mock data.\\n\\n<!-- image -->\\n\\n## Migrate app settings\\n\\nASP.NET Core uses a new configuration system\", \", which by default uses an appsettings.json file. By using CreateDefaultBuilder in Program.cs, the d\", \"efault configuration is already set up in the app. To access configuration, classes just need to req\", \"uest it in their constructor. In Program.cs, configuration is accessible from builder.Configuration.\", \"\\n\\nThe original app referenced its settings using ConfigurationManager.AppSettings. A quick search fo\", \"r all references of this term yields the set of settings the new app needs. There are only two:\\n\\n- U\", \"seMockData\\n- UseCustomizationData\\n\\nIf your app has more complex configuration, especially if it's us\", \"ing custom configuration sections, you'll probably want to create and bind objects to different part\", \"s of your app's configuration. These types can then be accessed using the options pattern. However, \", \"as noted in the referenced doc, this pattern shouldn't be used in Program.cs (or Startup.ConfigureSe\", \"rvices). Instead the ported app will reference the UseMockData configuration value directly.\\n\\nFirst,\", \" modify the ported app\\u2019s appsettings.json file and add the two settings in the root:\\n\\n<!-- image -->\", \"\\n\\n+\\n\\n-\\n\\n| Guest\\n\\n```\\n\\\"LogLevel\\\": { \\\"Default\\\": \\\"Warning\\\" } }, \\\"AllowedHosts\\\": \\\"*\\\" , \\\"UseMockData\\\": \\\"t\", \"rue\\\" , \\\"UseCustomizationData\\\" : \\\"true\\\" }\\n```\\n\\nNow, modify Program.cs to access the UseMockData setti\", \"ng from the builder.Configuration property (where previously we set the value to true):\\n\\n```\\nbool us\", \"eMockData = builder . Configuration . GetValue<bool>(\\\"UseMockData\\\");\\n```\\n\\nAt this point, the setting\", \" is pulled from configuration. The other setting, UseCustomizationData, is used by the CatalogDBInit\", \"ializer class. When you first ported this class, you commented out the access to ConfigurationManage\", \"r.AppSettings[\\\"UseCustomizationData\\\"]. Now it's time to modify it to use ASP.NET Core configuration.\", \" Modify the constructor of CatalogDBInitializer as follows:\\n\\n```\\n// add using Microsoft.Extensions.C\", \"onfiguration public CatalogDBInitializer(CatalogItemHiLoGenerator indexGenerator , IConfiguration co\", \"nfiguration) { this . indexGenerator = indexGenerator; useCustomizationData = configuration . GetVal\", \"ue<bool>(\\\"UseCustomizationData\\\"); }\\n```\\n\\nAll access to configuration within the web app should be mo\", \"dified in this manner to use the new IConfiguration type. Dependencies that require access to .NET F\", \"ramework configuration can include such settings in an app.config file added to the web project. The\", \" dependent projects can work with ConfigurationManager to access settings, and shouldn't require any\", \" changes if they already use this approach. However, since ASP.NET Core apps run as their own execut\", \"able, they don't reference web.config but rather app.config. By migrating settings from the legacy a\", \"pp's web.config file to a new app.config file in the ASP.NET Core app, components that use Configura\", \"tionManager to access their settings will continue to function properly.\\n\\nThe app\\u2019s migration is nea\", \"rly complete. The only remaining task is data access configuration.\\n\\n## Data access considerations\\n\\n\", \"ASP.NET Core apps running on .NET Framework can continue to use Entity Framework (EF). If performing\", \" an incremental migration, getting the app working with EF 6 before trying to port its data access t\", \"o use EF Core may be worthwhile. In this way, any problems with the app's migration can be identifie\", \"d and addressed before another block of migration effort is begun.\\n\\nAs it happens, configuring EF 6 \", \"in the eShop sample migration doesn't require any special work, since this work was performed in the\", \" Autofac ApplicationModule. The only problem is that currently the CatalogDBContext class tries to r\", \"ead its connection string from web.config. To address this, the connection details need to be added \", \"to appsettings.json. Then the connection string must be passed into CatalogDBContext when it's creat\", \"ed.\\n\\nUpdate the appsettings.json to include the connection string. The full file is listed here:\\n\\n``\", \"`\\n{ \\\"ConnectionStrings\\\": { \\\"DefaultConnection\\\": \\\"Server=(localdb)\\\\\\\\mssqllocaldb;Database=eShopPorted\", \";Trusted_Connection=True;MultipleActive ResultSets=true\\\" }, \\\"Logging\\\": { \\\"LogLevel\\\": { \\\"Default\\\": \\\"W\", \"arning\\\" } }, \\\"AllowedHosts\\\": \\\"*\\\" , \\\"UseMockData\\\": \\\"false\\\" , \\\"UseCustomizationData\\\": \\\"true\\\" }\\n```\\n\\nTh\", \"e connection string must be passed into the constructor when the DbContext is created. Since the ins\", \"tances are created by Autofac, the change needs to be made in ApplicationModule. Modify the module t\", \"o take in a connectionString in its constructor and assign it to a field. Then modify the registrati\", \"on for CatalogDBContext to add connection string as a parameter:\\n\\n```\\nbuilder . RegisterType<Catalog\", \"DBContext>() . WithParameter(\\\"connectionString\\\" , _connectionString) . InstancePerLifetimeScope();\\n`\", \"``\\n\\nThe parameter must also be added to a new constructor overload in CatalogDBContext itself:\\n\\n```\\n\", \"public CatalogDBContext(string connectionString) : base(connectionString) { }\\n```\\n\\nFinally, Program.\", \"cs must read the connection string from Configuration and pass it into the ApplicationModule when it\", \" instantiates it:\\n\\n```\\nbool useMockData = Configuration . GetValue<bool>(\\\"UseMockData\\\"); string conn\", \"ectionString = Configuration . GetConnectionString(\\\"DefaultConnection\\\"); builder . RegisterModule(ne\", \"w ApplicationModule(useMockData , connectionString));\\n```\\n\\nWith this code in place, the app runs as \", \"it did before, connecting to a SQL Server database when UseMockData is false.\\n\\nThe app can be deploy\", \"ed and run in production at this point, converted to ASP.NET Core but still running on .NET Framewor\", \"k and EF 6. If desired, the app can be migrated to run on .NET Core and Entity Framework Core, which\", \" will bring additional advantages described in earlier chapters. Specific to Entity Framework, this \", \"documentation compares EF Core and EF 6 and includes a grid showing which library supports each of d\", \"ozens of individual features.\\n\\n## Migrate to Entity Framework Core\\n\\nAssuming a decision is made to m\", \"igrate to EF Core, the steps can be fairly straightforward, especially if the original app used a co\", \"de-based model approach. When preparing to port from EF 6 to EF Core , review the availability of fe\", \"atures in the destination version of EF Core you'll be using. Review the documentation on porting fr\", \"om and EDMX-based model versus porting from a code-based model .\\n\\nTo upgrade to EF Core 2.2, the bas\", \"ic steps involved are to add the appropriate NuGet package(s) and update namespaces. Then adjust how\", \" the connection string is passed to the DbContext type and how they're wired up for dependency injec\", \"tion.\\n\\nEF Core is added as a package reference to the project:\\n\\n```\\n<PackageReference Include=\\\"Micro\", \"soft.EntityFrameworkCore\\\" Version=\\\"2.2.6\\\" />\\n```\\n\\nThe reference to EF 6 is removed:\\n\\n```\\n<PackageRef\", \"erence Include=\\\"EntityFramework\\\" Version=\\\"6.2.0\\\" />\\n```\\n\\nThe compiler will report errors in CatalogD\", \"BContext and CatalogDBInitializer. CatalogDbContext needs to have the old namespaces removed and rep\", \"laced with Microsoft.EntityFrameworkCore. Its constructors can be removed. DbModelBuilder should be \", \"replaced with ModelBuilder. The helper methods for configuring types are moved to separate classes i\", \"mplementing\\n\\nIEntityTypeConfiguration&lt;T&gt;. Then the CatalogDBContext class's OnModelCreating me\", \"thod simply becomes:\\n\\n```\\nprotected override void OnModelCreating(ModelBuilder builder) { builder . \", \"ApplyConfigurationsFromAssembly(Assembly . GetExecutingAssembly()); base . OnModelCreating(builder);\", \" }\\n```\\n\\nOther changes involved include:\\n\\n- HasDatabaseGeneratedOption(DatabaseGeneratedOption.None) \", \"replaced with ValueGeneratedNever()\\n- HasRequired&lt;T&gt; replaced with HasOne&lt;T&gt;\\n- Installed\", \" Microsoft.EntityFrameworkCore.Relational package\\n- Add a constructor to CatalogDBContext taking DbC\", \"ontextOptions and passing it to the base constructor\\n\\nAn example configuration class for CatalogType\", \" is shown here:\\n\\n```\\nusing Microsoft . EntityFrameworkCore; using Microsoft . EntityFrameworkCore . \", \"Metadata . Builders; namespace eShopPorted . Models . Config { public class CatalogTypeConfig : IEnt\", \"ityTypeConfiguration<CatalogType> { public void Configure(EntityTypeBuilder<CatalogType> builder) { \", \"builder . ToTable(nameof(CatalogType)); builder . HasKey(ci => ci . Id); builder . Property(ci => ci\", \" . Id) . IsRequired(); builder . Property(cb => cb . Type) . IsRequired() . HasMaxLength(100);\\n```\\n\\n\", \"```\\n} } }\\n```\\n\\nThe CatalogDBInitializer and its base class, CreateDatabaseIfNotExists&lt;T&gt;, are \", \"incompatible with EF Core. The purpose of this class is to create and seed the database. Using EF Co\", \"re will create and drop the associated database for a DbContext using these methods:\\n\\n```\\ndbContext \", \". Database . EnsureDeleted(); dbContext . Database . EnsureCreated();\\n```\\n\\nSeeding data in EF Core c\", \"an be done with manual scripts, or as part of the type configuration. Along with other entity proper\", \"ties, seed data can be configured in IEntityTypeConfiguration classes by using builder.HasData(). Th\", \"e original app loaded seed data from CSV files in the Setup directory. Given that there are only a h\", \"andful of items, these data records can instead be added as part of the entity configuration. This a\", \"pproach works well for lookup data in tables that change infrequently. Adding the following to Catal\", \"ogTypeConfig's Configure method ensures the associated rows are present when the database is created\", \":\\n\\n```\\nbuilder . HasData( new CatalogType { Id = 1 , Type = \\\"Mug\\\" }, new CatalogType { Id = 2 , Type\", \" = \\\"T-Shirt\\\" }, new CatalogType { Id = 3 , Type = \\\"Sheet\\\" }, new CatalogType { Id = 4 , Type = \\\"USB \", \"Memory Stick\\\" } );\\n```\\n\\nThe initial app includes a PreconfiguredData class, which includes data for \", \"CatalogBrand and CatalogType, so using this method the HasData call reduces to:\\n\\n```\\nbuilder . HasDa\", \"ta( PreconfiguredData . GetPreconfiguredCatalogBrands() );\\n```\\n\\nThe CatalogItem data can also be pul\", \"led from PreconfiguredData, and assuming the associated images are kept in source control, that is t\", \"he last table needed for the app to function. The CatalogDBInitializer class can be removed, along w\", \"ith any references to it. The CatalogItemHiLoGenerator class and the SQL files in the Infrastructure\", \" directory are also removed, along with any references to them (in CatalogService, ApplicationModule\", \").\\n\\nWith the elimination of the special key generator classes for CatalogItem, this code now is remo\", \"ved from CatalogItemConfig:\\n\\n```\\nbuilder . Property(ci => ci . Id) . ValueGeneratedNever() . IsRequi\", \"red();\\n```\\n\\nWith these modifications, the ASP.NET Core app builds, but it doesn't yet work with EF C\", \"ore, which must still be configured for dependency injection. With EF Core, the simplest way to conf\", \"igure it is in Program.cs:\\n\\n```\\nbuilder . Services . AddMvc(); bool useMockData = builder . Configur\", \"ation . GetValue<bool>(\\\"UseMockData\\\"); if (!useMockData) {\\n```\\n\\n```\\nstring connectionString = builde\", \"r . Configuration . GetConnectionString(\\\"DefaultConnection\\\"); builder . Services . AddDbContext<Cata\", \"logDBContext>(options => options . UseSqlServer(connectionString) ); }\\n```\\n\\nThe final version of Aut\", \"ofac's ApplicationModule only configures one type, depending on whether the app is configured to use\", \" mock data:\\n\\n```\\npublic class ApplicationModule : Module { private bool _useMockData; public Applica\", \"tionModule(bool useMockData) { _useMockData = useMockData; } protected override void Load(ContainerB\", \"uilder builder) { if (_useMockData) { builder . RegisterType<CatalogServiceMock>() . As<ICatalogServ\", \"ice>() . SingleInstance(); } else { builder . RegisterType<CatalogService>() . As<ICatalogService>()\", \" . InstancePerLifetimeScope(); } } }\\n```\\n\\nThe ported app runs, but doesn't display any data if confi\", \"gured to use non-mock data. The seed data added through HasData is only inserted when migrations are\", \" applied. The source app didn't use migrations, and if it had, they wouldn't migrate as-is. The best\", \" approach is to start with a new migration script. To do this, add a package reference for Microsoft\", \".EntityFrameworkCore.Design and open a terminal window in the project root. Then run:\\n\\ndotnet ef mig\", \"rations add Initial\\n\\nDrop the existing eShopPorted database if it exists, then run:\\n\\ndotnet ef datab\", \"ase update\\n\\nThis creates and seeds the database. It\\u2019s now ready to run, with a few small updates lef\", \"t to address.\\n\\n## Fix all TODO tasks\\n\\nRunning the ported app at this point reveals that no pictures \", \"are shown on the page. This is because the PictureUri property of CatalogItem is never set. Looking \", \"at the list of TODO items we created\\n\\nusing Visual Studio's Task List, the only one that remains is \", \"in CatalogController, with a note to \\\"Reference pic from wwwroot.\\\" The code in question is:\\n\\n```\\npri\", \"vate void AddUriPlaceHolder(CatalogItem item) { //TODO: Reference pic from wwwroot //item.PictureUri\", \" = this.Url.RouteUrl(PicController.GetPicRouteName, new { catalogItemId = item.Id }, this.Request.Ur\", \"l.Scheme); }\\n```\\n\\nThe simplest fix is to reference the public image files in the site's public wwwro\", \"ot/Pics directory. This task can be accomplished by replacing the method with the following code:\\n\\n`\", \"``\\nprivate void AddUriPlaceHolder(CatalogItem item) { item . PictureUri = $\\\"/Pics/{item.Id}.png\\\"; }\\n\", \"```\\n\\nWith this change, running the app reveals the images work as before.\\n\\n## Additional MVC customi\", \"zations\\n\\nThe eShopLegacyMVC app is fairly simple, so there isn't much to configure in terms of defau\", \"lt MVC behavior. However, if you do need to configure additional MVC components, such as CORS, filte\", \"rs, and route constraints, you generally provide this information in Program.cs, where UseMvc is cal\", \"led. For example, the following code listing configures CORS and sets up a global action filter:\\n\\n``\", \"`\\nbuilder . Services . AddCors(options => { options . AddPolicy(MyAllowSpecificOrigins , builder => \", \"builder . WithOrigins(\\\"http://example.com\\\" , \\\"http://www.contoso.com\\\") . AllowAnyHeader() . AllowAny\", \"Method()); }); builder . Services . AddMvc(options => { options . Filters . Add(new SampleGlobalActi\", \"onFilter()); }).SetCompatibilityVersion(CompatibilityVersion . Version_2_2);\\n```\\n\\n## Note\\n\\nTo finish\", \" configuring CORS, you must also call app.UseCors() after building the application.\\n\\nOther advanced \", \"scenarios, like adding custom model binders, formatters, and more are covered in the detailed ASP.NE\", \"T Core docs. Generally these can be applied on an individual controller or action basis, or globally\", \" using the same options approach shown in the previous code listing.\\n\\n## Other dependencies\\n\\nDepende\", \"ncies that use .NET Framework features that had a dependency on the legacy configuration model, such\", \" as the WCF client type and tracing code, must be modified when ported. Rather than having these typ\", \"es pull in their configuration information directly, they should be configured in code. For example,\", \" a connection to a WCF service that was configured in an ASP.NET app's web.config to use basicHttpBi\", \"nding could instead be configured programmatically with the following code:\\n\\n```\\nvar binding = new B\", \"asicHttpBinding(); binding . MaxReceivedMessageSize = 2_000_000; var endpointAddress = new EndpointA\", \"ddress(\\\"http://localhost:9200/ExampleService\\\"); var myClient = new MyServiceClient(binding , endpoin\", \"tAddress);\\n```\\n\\nRather than relying on config files for its settings, WCF clients and other .NET Fra\", \"mework types should have their settings specified in code. Configured in this manner, these types ca\", \"n continue to work in ASP.NET Core 2.2 apps.\\n\\n## References\\n\\n- eShopModernizing GitHub repository\\n- \", \".NET Upgrade Assistant tool\\n- Your API and ViewModels Should Not Reference Domain Models\\n- Developer\", \" Exception Page Middleware\\n- Deep Dive into EF Core HasData\\n\\n## More migration scenarios\\n\\nThis secti\", \"on describes several different ASP.NET app scenarios, and offers specific techniques for solving eac\", \"h of them. You can use this section to identify scenarios applicable to your app, and evaluate which\", \" techniques will work for your app and its hosting environment.\\n\\n## Migrate ASP.NET MVC 5 and WebApi\", \" 2 to ASP.NET Core MVC\\n\\nA common scenario in ASP.NET MVC 5 and Web API 2 apps was for both products \", \"to be installed in the same application. This is a supported and relatively common approach used by \", \"many teams, but because the two products use different abstractions, there is some redundant effort \", \"needed. For example, setting up routes for ASP.NET MVC is done using methods on RouteCollection, suc\", \"h as MapMvcAttributeRoutes() and MapRoute(). But ASP.NET Web API 2 routing is managed with HttpConfi\", \"guration and methods like MapHttpAttributeRoutes() and MapHttpRoute().\\n\\nThe eShopLegacyMVC app inclu\", \"des both ASP.NET MVC and Web API, and includes methods in its App\\\\_Start folder for setting up route\", \"s for both. It also supports dependency injection using Autofac, which also requires two sets of sim\", \"ilar work to configure:\\n\\n```\\nprotected IContainer RegisterContainer() { var builder = new ContainerB\", \"uilder(); var thisAssembly = Assembly . GetExecutingAssembly(); builder . RegisterControllers(thisAs\", \"sembly); // MVC controllers builder . RegisterApiControllers(thisAssembly); // Web API controllers v\", \"ar mockData = bool . Parse(ConfigurationManager . AppSettings[\\\"UseMockData\\\"]); builder . RegisterMod\", \"ule(new ApplicationModule(mockData)); var container = builder . Build(); // set mvc resolver Depende\", \"ncyResolver . SetResolver(new AutofacDependencyResolver(container)); // set webapi resolver var reso\", \"lver = new AutofacWebApiDependencyResolver(container); GlobalConfiguration . Configuration . Depende\", \"ncyResolver = resolver; return container; }\\n```\\n\\nWhen upgrading these apps to use ASP.NET Core, this\", \" duplicate effort and the confusion that sometimes accompanies it is eliminated. ASP.NET Core MVC is\", \" a unified framework with one set of rules for routing, filters, and more. Dependency injection is b\", \"uilt into .NET Core itself. All of this can be configured in Program.cs, as is shown in the eShopPor\", \"ted app in the sample.\\n\\n## Migrate HttpResponseMessage to ASP.NET Core\\n\\nSome ASP.NET Web API apps ma\", \"y have action methods that return HttpResponseMessage. This type does not exist in ASP.NET Core. Bel\", \"ow is an example of its usage in a Delete action method, using the ResponseMessage helper method on \", \"the base ApiController:\\n\\n```\\n// DELETE api/<controller>/5 [HttpDelete] public IHttpActionResult Dele\", \"te(int id) { var brandToDelete = _service . GetCatalogBrands().FirstOrDefault(x => x . Id == id); if\", \" (brandToDelete == null) { return ResponseMessage(new HttpResponseMessage(HttpStatusCode . NotFound)\", \"); } // demo only -don't actually delete return ResponseMessage(new HttpResponseMessage(HttpStatusCo\", \"de . OK)); }\\n```\\n\\nIn ASP.NET Core MVC, there are helper methods available for all of the common HTTP\", \" response status codes, so the above method would be ported to the following code:\\n\\n```\\n[HttpDelete(\", \"\\\"{id}\\\")] public IActionResult Delete(int id) { var brandToDelete = _service . GetCatalogBrands().Fir\", \"stOrDefault(x => x . Id == id); if (brandToDelete == null) {\\n```\\n\\n```\\nreturn NotFound(); } // demo o\", \"nly -don't actually delete return Ok(); }\\n```\\n\\nIf you do find that you need to return a custom statu\", \"s code for which no helper exists, you can always use return StatusCode(int statusCode) to return an\", \"y numeric code you like.\\n\\n## Migrate content negotiation from ASP.NET Web API to ASP.NET Core\\n\\nASP.N\", \"ET Web API 2 supports content negotiation natively. The sample app includes a BrandsController that \", \"demonstrates this support by listing its results in either XML or JSON. This is based on the request\", \"'s Accept header, and changes when it includes application/xml or application/json.\\n\\nASP.NET MVC 5 a\", \"pps do not have content negotiation support built in.\\n\\nContent negotiation is preferable to returnin\", \"g a specific encoding type, as it is more flexible and makes the API available to a larger number of\", \" clients. If you currently have action methods that return a specific format, you should consider mo\", \"difying them to return a result type that supports content negotiation when you port the code to ASP\", \".NET Core.\\n\\nThe following code returns data in JSON format regardless of client Accept header conten\", \"t:\\n\\n```\\n[HttpGet] public ActionResult Index() { return Json(new { Message = \\\"Hello World!\\\" }); }\\n```\", \"\\n\\nASP.NET Core MVC supports content negotiation natively, provided an appropriate return type is use\", \"d. Content negotiation is implemented by [ObjectResult] which is returned by the status codespecific\", \" action results returned by the controller helper methods. The previous action method, implemented i\", \"n ASP.NET Core MVC and using content negotiation, would be:\\n\\n```\\npublic IActionResult Index() { retu\", \"rn Ok(new { Message = \\\"Hello World!\\\"} ); }\\n```\\n\\nThis will default to returning the data in JSON form\", \"at. XML and other formats will be used if the app has been configured with the appropriate formatter\", \" .\\n\\n## Custom model binding\\n\\nMost ASP.NET MVC and Web API apps make use of model binding. The defaul\", \"t model binding syntax migrates fairly seamlessly between these apps and ASP.NET Core MVC. However, \", \"in some cases customers have written custom model binders to support specific model types or usage s\", \"cenarios. Custom model binders in ASP.NET MVC and Web API projects use separate IModelBinder interfa\", \"ces defined in System.Web.Mvc and System.Web.Http namespaces, respectively. In both cases, the custo\", \"m\\n\\nbinder exposes a Bind method that accepts a controller or action context and a model binding cont\", \"ext as arguments.\\n\\nOnce the custom binder is created, it must be registered with the app. This step \", \"requires creating another type, a ModelBinderProvider, which acts as a factory and creates the model\", \" binder during a request. Binders can be added during ApplicationStart in MVC apps as shown:\\n\\n```\\nMo\", \"delBinderProviders . BinderProviders . Insert(0 , new MyCustomBinderProvider()); // MVC\\n```\\n\\nIn Web \", \"API apps, custom binders can be referenced using attributes. The ModelBinder attribute can be added \", \"to action method parameters or to the parameter's type definition, as shown:\\n\\n```\\n// attribute on ac\", \"tion method parameter public HttpResponseMessage([ModelBinder(typeof(MyCustomBinder))] CustomDTO cus\", \"tom) { } // attribute on type [ModelBinder(typeof(MyCustomBinder))] public class CustomDTO { }\\n```\\n\\n\", \"To register a model binder globally in ASP.NET Web API, its provider must be added during app startu\", \"p:\\n\\n```\\npublic static class WebApiConfig { public static void Register(HttpConfiguration config) { v\", \"ar provider = new CustomModelBinderProvider( typeof(CustomDTO), new CustomModelBinder()); config . S\", \"ervices . Insert(typeof(ModelBinderProvider), 0 , provider); // ... } }\\n```\\n\\nWhen migrating custom m\", \"odel providers to ASP.NET Core, the Web API pattern is closer to the ASP.NET Core approach than the \", \"ASP.NET MVC 5. The main differences between ASP.NET Core's IModelBinder interface and Web API's is t\", \"hat the ASP.NET Core method is async (BindModelAsync) and it only requires a single BindingModelCont\", \"ext parameter instead of two parameters like Web API's version required. In ASP.NET Core, you can us\", \"e a [ModelBinder] attribute on individual action method parameters or their associated types. You ca\", \"n also create a ModelBinderProvider that will be used globally within the app where appropriate. To \", \"configure such a provider, you would add code to Program.cs:\\n\\n```\\nbuilder . Services . AddController\", \"s(options => { options . ModelBinderProviders . Insert(0 , new CustomModelBinderProvider()); });\\n```\", \"\\n\\n## Media formatters\\n\\nASP.NET Web API supports multiple media formats and can be extended by using \", \"custom media formatters. The docs describe an example CSV Media Formatter that can be used to send d\", \"ata in a comma-separated value format. If your Web API app uses custom media formatters, you'll need\", \" to convert them to ASP.NET Core custom formatters .\\n\\nTo create a custom formatter in Web API 2, you\", \" inherited from an appropriate base class and then added the formatter to the Web API pipeline using\", \" the HttpConfiguration object:\\n\\n```\\npublic static void ConfigureApis(HttpConfiguration config) { con\", \"fig . Formatters . Add(new ProductCsvFormatter()); }\\n```\\n\\nIn ASP.NET Core, the process is similar. A\", \"SP.NET Core supports both input formatters (used by model binding) and output formatters (used to fo\", \"rmat responses). Adding a custom formatter to output responses in a specific way involves inheriting\", \" from an appropriate base class and adding the formatter to MVC in Program.cs:\\n\\n```\\nbuilder . Servic\", \"es . AddControllers(options => { options . InputFormatters . Insert(0 , new CustomInputFormatter());\", \" options . OutputFormatters . Insert(0 , new CustomOutputFormatter()); });\\n```\\n\\nYou\\u2019ll find a comple\", \"te list of base classes in the Microsoft.AspNetCore.Mvc.Formatters namespace.\\n\\nThe steps to migrate \", \"from a Web API formatter to an ASP.NET Core MVC formatter are:\\n\\n1. Identify an appropriate base clas\", \"s for the new formatter.\\n2. Create a new instance of the base class and implement its required metho\", \"ds.\\n3. Copy over the functionality from the Web API formatter to the new implementation.\\n4. Configur\", \"e MVC in the ASP.NET Core App's ConfigureServices method to use the new formatter.\\n\\n## Custom filter\", \"s\\n\\nFilters are used in ASP.NET Core apps to execute code before and/or after certain stages in the r\", \"equest processing pipeline. ASP.NET MVC and Web API also use filters in much the same way, but the d\", \"etails vary. For instance, ASP.NET MVC supports four kinds of filters. ASP.NET Web API 2 supports si\", \"milar filters, and both MVC and Web API included attributes to override filters .\\n\\nThe most common f\", \"ilter used in ASP.NET MVC and Web API apps is the action filter, which is defined by an IActionFilte\", \"r interface. This interface provides methods for before (OnActionExecuting) and after (OnActionExecu\", \"ted) which can be used to execute code before and/or after an action executes, as noted for each met\", \"hod.\\n\\nASP.NET Core continues to support filters, and its unification of MVC and Web API means there \", \"is only one approach to their implementation. The docs include detailed coverage of the five (5) kin\", \"ds of filters built into ASP.NET Core MVC. All of the filter variants supported in ASP.NET MVC and A\", \"SP.NET\\n\\nWeb API have associated versions in ASP.NET Core, so migration is generally just a matter of\", \" identifying the appropriate interface and/or base class and migrating the code over.\\n\\nIn addition t\", \"o the synchronous interfaces, ASP.NET Core also provides async interfaces like IAsyncActionFilter wh\", \"ich provide a single async method that can be used to incorporate code to run both before and after \", \"the action, as shown:\\n\\n```\\npublic class SampleAsyncActionFilter : IAsyncActionFilter { public async \", \"Task OnActionExecutionAsync( ActionExecutingContext context , ActionExecutionDelegate next) { // Do \", \"something before the action executes. // next() calls the action method. var resultContext = await n\", \"ext(); // resultContext.Result is set. // Do something after the action executes. } }\\n```\\n\\nWhen migr\", \"ating async code (or code that should be async), teams should consider leveraging the built in async\", \" types that are provided for this purpose.\\n\\nMost ASP.NET MVC and Web API apps do not use a large num\", \"ber of custom filters. Since the approach to filters in ASP.NET Core MVC is closely aligned with fil\", \"ters in ASP.NET MVC and Web API, the migration of custom filters is generally fairly straightforward\", \". Be sure to read the detailed documentation on filters in ASP.NET Core's docs, and once you're sure\", \" you have a good understanding of them, port the logic from the old system to the new system's filte\", \"rs.\\n\\n## Route constraints\\n\\nASP.NET Core uses route constraints to help ensure requests are routed pr\", \"operly to route a request. ASP.NET Core supports a large number of different route constraints for t\", \"his purpose. Route constraints can be applied in the route table, but most apps built with ASP.NET M\", \"VC 5 and/or ASP.NET Web API 2 use inline route constraints applied to attribute routes. Inline route\", \" constraints use a format like this one:\\n\\n```\\n[Route(\\\"/customer/{id:int}\\\")]\\n```\\n\\nThe :int after the \", \"id route parameter constrains the value to match the int type. One benefit of using route constraint\", \"s is that they allow for two otherwise-identical routes to exist where the parameters differ only by\", \" their type. This allows for the equivalent of method overloading of routes based solely on paramete\", \"r type.\\n\\nThe set of route constraints, their syntax, and usage is very similar between all three app\", \"roaches. Custom route constraints are fairly rare in customer applications. If your app uses a custo\", \"m route constraint and needs to port to ASP.NET Core, the docs include examples showing how to creat\", \"e custom route constraints in ASP.NET Core. Essentially all that's required is to implement IRouteCo\", \"nstraint and its Match method, and then add the custom constraint when configuring routing for the a\", \"pp:\\n\\n```\\nbuilder . Services . AddControllers(); builder . Services . AddRouting(options => { options\", \" . ConstraintMap . Add(\\\"customName\\\" , typeof(MyCustomConstraint)); });\\n```\\n\\nThis is very similar to \", \"how custom constraints are used in ASP.NET Web API, which uses IHttpRouteConstraint and configures i\", \"t using a resolver and a call to HttpConfiguration.MapHttpAttributeRoutes:\\n\\n```\\npublic static class \", \"WebApiConfig { public static void Register(HttpConfiguration config) { var constraintResolver = new \", \"DefaultInlineConstraintResolver(); constraintResolver . ConstraintMap . Add(\\\"nonzero\\\" , typeof(Custo\", \"mConstraint)); config . MapHttpAttributeRoutes(constraintResolver); } }\\n```\\n\\nASP.NET MVC 5 follows a\", \" very similar approach, using IRouteConstraint for its interface name and configuring the constraint\", \" as part of route configuration:\\n\\n```\\npublic class RouteConfig { public static void RegisterRoutes(R\", \"outeCollection routes) { routes . IgnoreRoute(\\\"{resource}.axd/{*pathInfo}\\\"); var constraintsResolver\", \" = new DefaultInlineConstraintResolver(); constraintsResolver . ConstraintMap . Add(\\\"values\\\" , typeo\", \"f(ValuesConstraint)); routes . MapMvcAttributeRoutes(constraintsResolver); } }\\n```\\n\\nMigrating route \", \"constraint usage as well as custom route constraints to ASP.NET Core is typically very straightforwa\", \"rd.\\n\\n## Custom route handlers\\n\\nAnother fairly advanced feature of ASP.NET MVC 5 is route handlers. C\", \"ustom route handlers implement IRouteHandler, which includes a single method that returns an IHttpHa\", \"ndler for a give request. The IHttpHandler, in turn, exposes an IsReusable property and a single Pro\", \"cessRequest method. In ASP.NET MVC 5, you can configure a particular route in the route table to use\", \" your custom handler:\\n\\n```\\npublic static void RegisterRoutes(RouteCollection routes) { routes . Igno\", \"reRoute(\\\"{resource}.axd/{*pathInfo}\\\"); routes . Add(new Route(\\\"custom\\\" , new CustomRouteHandler()));\", \" }\\n```\\n\\nTo migrate custom route handlers from ASP.NET MVC 5 to ASP.NET Core, you can either use a fi\", \"lter (such as an action filter) or a custom IRouter. The filter approach is relatively straightforwa\", \"rd, and can be added as a global filter when MVC is added to the app's services during startup:\\n\\n```\", \"\\nbuilder . Services . AddMvc(options => { options . Filters . Add(typeof(CustomActionFilter)); });\\n`\", \"``\\n\\nThe IRouter option requires implementing the interface's RouteAsync and GetVirtualPath methods. \", \"The custom router is added to the request pipeline during app startup.\\n\\n```\\n// ... app.UseMvc(routes\", \" => { routes . Routes . Add(new CustomRouter(routes . DefaultHandler)); });\\n```\\n\\nIn ASP.NET Web API,\", \" these handlers are referred to as custom message handlers, rather than route handlers. Message hand\", \"lers must derive from DelegatingHandler and override its SendAsync method. Message handlers can be c\", \"hained together to form a pipeline in a fashion that is very similar to ASP.NET Core middleware and \", \"its request pipeline.\\n\\nASP.NET Core has no DelegatingHandler type or separate message handler pipeli\", \"ne. Instead, such handlers should be migrated using global filters, custom IRouter instances (see ab\", \"ove), or custom middleware. ASP.NET Core MVC filters and IRouter types have the advantage of having \", \"built-in access to MVC constructs like controllers and actions, while middleware is a lower level ap\", \"proach that has no ties to MVC. This makes it more flexible but also requires more effort if you nee\", \"d to access MVC components.\\n\\n## CORS support\\n\\nCORS, or Cross-Origin Resource Sharing, is a W3C stand\", \"ard that allows servers to accept requests that don't originate from responses they've served. ASP.N\", \"ET MVC 5 and ASP.NET Web API 2 support CORS in different ways. The simplest way to enable CORS suppo\", \"rt in ASP.NET MVC 5 is with an action filter like this one:\\n\\n```\\npublic class AllowCrossSiteAttribut\", \"e : ActionFilterAttribute { public override void OnActionExecuting(ActionExecutingContext filterCont\", \"ext) { filterContext . RequestContext . HttpContext . Response . AddHeader( \\\"Access -Control -Allow \", \"-Origin\\\" , \\\"example.com\\\"); base . OnActionExecuting(filterContext); } }\\n```\\n\\nASP.NET Web API can als\", \"o use such a filter, but it has built -in support for enabling CORS as well:\\n\\n```\\npublic static clas\", \"s WebApiConfig { public static void Register(HttpConfiguration config) { config . EnableCors();\\n```\\n\", \"\\n```\\n// ... } }\\n```\\n\\nOnce this is added, you can configure allowed origins, headers, and methods usi\", \"ng the EnableCors attribute, like so:\\n\\n```\\n[EnableCors(origins: \\\"https://dot.net\\\" , headers: \\\"*\\\" , m\", \"ethods: \\\"*\\\")] public class TestController : ApiController { // Controller methods not shown... }\\n```\", \"\\n\\nBefore migrating your CORS implementation from ASP.NET MVC 5 or ASP.NET Web API 2, be sure to revi\", \"ew how CORS works and create some automated tests that demonstrate CORS is working as expected in yo\", \"ur current system.\\n\\nIn ASP.NET Core, there are three built-in ways to enable CORS:\\n\\n- Configured via\", \" policy in ConfigureServices\\n- Enabled with endpoint routing\\n- Enabled with the EnableCors attribute\", \"\\n\\nEach of these approaches is covered in detail in the docs, which are linked from the above options\", \". Which one you choose will largely depend on how your existing app supports CORS. If the app uses a\", \"ttributes, you can probably migrate to use the EnableCors attribute most easily. If your app uses fi\", \"lters, you could continue using that approach (though it's not the typical approach used in ASP.NET \", \"Core), or migrate to use attributes or policies. Endpoint routing is a relatively new feature introd\", \"uced with ASP.NET Core 3 and as such it doesn't have a close analog in ASP.NET MVC 5 or ASP.NET Web \", \"API 2 apps.\\n\\n## Custom areas\\n\\nMany ASP.NET MVC apps use Areas to organize the project. Areas typical\", \"ly reside in the root of the project in an Areas folder, and must be registered when the application\", \" starts, typically in Application\\\\_Start():\\n\\n```\\nAreaRegistration . RegisterAllAreas();\\n```\\n\\nAn alte\", \"rnative to registering all areas in startup is to use the RouteArea attribute on individual controll\", \"ers:\\n\\n```\\n[RouteArea(\\\"Admin\\\")] public class SomeController : Controller When using Areas, additional\", \" arguments are passed into HTML helper methods to generate links to actions in different areas: @Htm\", \"l.ActionLink(\\\"News\\\", \\\"Index\\\", \\\"News\\\", new { area = \\\"News\\\" }, null)\\n```\\n\\nASP.NET Web API apps don't t\", \"ypically use areas explicitly, since their controllers can be placed in any folder in the project. T\", \"eams can use any folder structure they like to organize their API controllers.\\n\\nAreas are supported \", \"in ASP.NET Core MVC. The approach used is nearly identical to the use of areas in ASP.NET MVC 5. Dev\", \"elopers migrating code using areas should keep in mind the following differences:\\n\\n- AreaRegistratio\", \"n.RegisterAllAreas is not used in ASP.NET Core MVC\\n- Areas are applied using the [Area(\\\"name\\\")] attr\", \"ibute (not RouteArea as in ASP.NET MVC 5)\\n- Areas can be added to the route table templates, if desi\", \"red (or they can use attribute routing)\\n\\nTo add area support to the route table in ASP.NET Core MVC,\", \" you would add the following during app startup:\\n\\n```\\napp.UseEndpoints(endpoints => { endpoints . Ma\", \"pControllerRoute( name: \\\"MyArea\\\" , pattern: \\\"{area:exists}/{controller=Home}/{action=Index}/{id?}\\\");\", \" endpoints . MapControllerRoute( name: \\\"default\\\" , pattern: \\\"{controller=Home}/{action=Index}/{id?}\\\"\", \"); });\\n```\\n\\nAreas can also be used with attribute routing, using the {area} keyword in the route def\", \"inition (it's one of several reserved routing names that can be used with route templates).\\n\\nTag hel\", \"pers support areas with the asp-area attribute, which can be used to generate links in Razor views a\", \"nd pages:\\n\\n```\\n<ul> <li> <a asp -area=\\\"Products\\\" asp-controller=\\\"Home\\\" asp-action=\\\"About\\\"> Products/\", \"Home/About </a> </li> <li> <a asp -area=\\\"Services\\\" asp-controller=\\\"Home\\\" asp-action=\\\"About\\\"> Service\", \"s About </a> </li> <li> <a asp -area=\\\"\\\" asp-controller=\\\"Home\\\" asp-action=\\\"About\\\"> /Home/About </a> <\", \"/li> </ul>\\n```\\n\\nIf you're migrating to Razor Pages you will need to use an Areas folder in your Page\", \"s folder. For more information, see Areas with Razor Pages .\\n\\nIn addition to the above guidance, tea\", \"ms should review how routing in ASP.NET Core works with areas as part of their migration planning pr\", \"ocess.\\n\\n## Integration tests for ASP.NET MVC and ASP.NET Web API\\n\\nIntegration tests are automated te\", \"sts that verify several different parts of an app work together correctly. Writing integration tests\", \" for ASP.NET MVC and ASP.NET Web API usually involved deploying\\n\\nthe app to a real web server, such \", \"as a local instance of IIS or IIS Express, and then making requests to this hosted application using\", \" an HTTP client. Some of these tests may interact with the client-side user interface using browser \", \"automation tools like Selenium, though often these are referred to as UI tests rather than integrati\", \"on tests.\\n\\nIf your migrated app shares the same behavior as its original version, whatever existing \", \"technology the team is using to perform integration tests (and UI tests) should continue to work jus\", \"t as it did before. These tests are usually indifferent to the underlying technology used to host th\", \"e app they're testing, and interact with it only through HTTP requests. Where things may get more ch\", \"allenging is with how the tests interact with the app to get it into a known good state prior to eac\", \"h test. This may require some migration effort, since configuration and startup are significantly di\", \"fferent in ASP.NET Core compared to ASP.NET MVC or ASP.NET Web API.\\n\\nTeams should strongly consider \", \"migrating their integration tests to use ASP.NET Core's built-in integration testing support. In ASP\", \".NET Core, apps can be tested by deploying them to a TestHost, which is configured using a WebApplic\", \"ationFactory. There's a little bit of setup required to host the app for testing, but once this is i\", \"n place, creating individual integration tests is very straightforward.\\n\\nOne of the best features of\", \" ASP.NET Core's integration testing support is that the app is hosted in memory. There's no need to \", \"configure a real webserver to host the app. There's no need to use a browser automation tool (if you\", \"'re only testing ASP.NET Core and not client-side behavior). Many of the problems that can be encoun\", \"tered when trying to use a real web server for automated integration tests, such as firewall issues \", \"or process start/stop issues, are eliminated with this approach. Since the requests are all made in \", \"memory with no network requirement, the tests also tend to run much faster than tests that must set \", \"up a separate webserver and communicate with it over the network (even if it's running on the same m\", \"achine).\\n\\nBelow you can see an example ASP.NET Core integration test (sometimes referred to as funct\", \"ional tests to distinguish them from lower-level integration tests) from the eShopOnWeb reference ap\", \"plication:\\n\\n```\\npublic class GetByIdEndpoint : IClassFixture<ApiTestFixture> { JsonSerializerOptions\", \" _jsonOptions = new JsonSerializerOptions { PropertyNameCaseInsensitive = true }; public GetByIdEndp\", \"oint(ApiTestFixture factory) { Client = factory . CreateClient(); } public HttpClient Client { get; \", \"} [Fact] public async Task ReturnsItemGivenValidId() { var response = await Client . GetAsync(\\\"api/c\", \"atalog-items/5\\\"); response.EnsureSuccessStatusCode(); var stringResponse = await response . Content \", \". ReadAsStringAsync(); var model = stringResponse . FromJson<GetByIdCatalogItemResponse>(); Assert .\", \" Equal(5 , model . CatalogItem . Id); Assert . Equal(\\\"Roslyn Red Sheet\\\" , model . CatalogItem . Name\", \");\\n```\\n\\n<!-- image -->\\n\\nIf the app being migrated has no integration tests, the migration process ca\", \"n be a great opportunity to add some. These tests can verify that the migrated app behaves as the te\", \"am expects. When such tests are in place early in a migration, they can ensure that later migration \", \"efforts do not break previously migrated portions of the app. Given how easy it is to set up and run\", \" integration tests in ASP.NET Core, the return on the investment spent setting up such tests is usua\", \"lly pretty high.\\n\\n## WCF client configuration\\n\\nIf your app currently relies on WCF services as a cli\", \"ent, this scenario is supported. However, you will need to migrate your configuration from web.confi\", \"g to use the new appsettings.json file. Another option is to add any necessary configuration to your\", \" clients programmatically when you create them. For example:\\n\\n<!-- image -->\\n\\nIf your organization h\", \"as extensive services built using WCF that your app relies on, consider migrating them to use gRPC i\", \"nstead. For more details on gRPC, why you may wish to migrate, and a detailed migration guide, consu\", \"lt the gRPC for WCF Developers eBook.\\n\\n## References\\n\\n- ASP.NET Web API Content Negotiation\\n- Format\", \" response data in ASP.NET Core Web API\\n- Custom Model Binders in ASP.NET Web API\\n- Custom Model Bind\", \"ers in ASP.NET Core\\n- Media Formatters in ASP.NET Web API 2\\n- Custom formatters in ASP.NET Core Web \", \"API\\n- Filters in ASP.NET Core\\n- Route constraints in ASP.NET Web API 2\\n- Route constraints in ASP.NE\", \"T MVC 5\\n- ASP.NET Core Route Constraint Reference\\n- Custom message handlers in ASP.NET Web API 2\\n- S\", \"imple CORS control in MVC 5 and Web API 2\\n- Enabling Cross-Origin Requests in Web API\\n- Enable Cross\", \" -Origin Requests (CORS) in ASP.NET Core\\n- Areas in ASP.NET Core\\n- Integration tests in ASP.NET Core\", \"\\n\\n## Deployment scenarios when migrating to ASP.NET Core\\n\\nExisting ASP.NET MVC and Web API apps run \", \"on IIS and Windows. Large apps may require a phased or side -by-side approach when porting to ASP.NE\", \"T Core. In previous chapters, you learned a number of strategies for migrating large .NET Framework \", \"apps to ASP.NET Core in phases. In this chapter, you will see how different deployment scenarios can\", \" be achieved when there is a need to maintain the original app in production while migrating portion\", \"s of it.\\n\\n## Split a large web app\\n\\nConsider the common scenario of a large web app that currently i\", \"s hosted on IIS in a single web site. Within the large app, functionality is segmented into differen\", \"t routes and/or directories. The app is a mix of MVC views and API endpoints. The MVC routes include\", \" many different paths based on functionality and all start from the root of the app using the standa\", \"rd /{controller}/{action}/{id?} route template. The API endpoints follow a similar pattern, but are \", \"all under an /api root.\\n\\nAssuming the task of porting the app is split such that either the MVC func\", \"tionality or the API functionality is migrated to ASP.NET Core first, how would the original site co\", \"ntinue to function seamlessly with the new ASP.NET Core app running somewhere else? Users of the sys\", \"tem should continue to see the same URLs they did prior to the migration, unless it's absolutely nec\", \"essary to change them.\\n\\nFortunately, IIS is a feature-rich web server, and two features it has are U\", \"RL Rewrite module and Application Request Routing. Using these features, IIS can act as a reverse pr\", \"oxy, routing client requests to the appropriate back-end web app. To configure IIS as a reverse prox\", \"y, check the Enable proxy checkbox in the Application Request Routing feature, then add a URL Rewrit\", \"e rule like this one:\\n\\n```\\n<rule name=\\\"NetCoreProxy\\\"> <match url=\\\"(.*)>\\\" /> <action type=\\\"Rewrite\\\" u\", \"rl=\\\"http://servername/{R:1}\\\" /> </rule>\\n```\\n\\nAs a reverse proxy, IIS can route traffic matching cert\", \"ain patterns to entirely separate apps, potentially on different servers.\\n\\nUsing just the URL Rewrit\", \"e module (perhaps combined with host headers), IIS can easily support multiple web sites, each poten\", \"tially running different versions of .NET. A large web app might be deployed as a collection of indi\", \"vidual sites, each responding to different IP addresses and/or host headers, or as a single web site\", \" with one or more sub-applications in it responding to certain URL paths (which doesn't even require\", \" URL Rewrite).\\n\\n| Important                                                                         \", \"                                                                                                    \", \"                                                                                                    \", \"                                                                                                    \", \"                          |\\n|-----------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"----------------------------------------------------------------------------------------------------\", \"--------------------------------------|\\n| Subdomains typically refer to the portion of a domain prec\", \"eding the top two levels. For example, in  the domain api.contoso.com, api is a subdomain of the con\", \"toso.com domain (which itself is  composed of the contoso domain name and the .com top-level domain \", \"or TLD). URL paths refer to  portion of the URL that follows the domain name, starting with a /. The\", \" URL https://contoso.com/api  has a path of /api. |\\n\\nThere are pros and cons to using the same or di\", \"fferent subdomains (and domains) to host a single app. Features like cookies and intra-app communica\", \"tion using mechanisms like CORS may require more configuration to work properly in distributed apps.\", \" However, apps that use different subdomains can more easily use DNS to route requests to entirely d\", \"ifferent network destinations, and so can more easily be deployed to many different servers (virtual\", \" or otherwise) without the need for IIS to act as a reverse proxy.\\n\\nIn the example described above, \", \"assume the API endpoints are designated as the first part of the app to be ported to ASP.NET Core. I\", \"n this case, a new ASP.NET Core app is created and hosted in IIS as a separate web application withi\", \"n the existing ASP.NET MVC web site. Since it will be added as a child of the original web site and \", \"will be named api, its default route should no longer begin with api/. Keeping this would result in \", \"it matching URLs of the form /api/api/endpoint.\\n\\nFigure 5-1 shows how the ASP.NET Core 2.1 api app a\", \"ppears in IIS Manager as a part of the existing DotNetMvcApp site.\\n\\nInternet Information Services (I\", \"IS) Manager\\n\\n\\u2022 NIGHTKING \\u2022 Sites \\u2022 DotNetMvcApp \\u2022\\n\\nFile View Help\\n\\nConnections v .6g NIGHTKING (NIGH\", \"TKING\\\\stev\\n\\n..a Application Pools\\n\\nSites\\n\\nDotNetMvcApp aspnet\\\\_client\\n\\nbin\\n\\nContent fonts\\n\\nScripts\\n\\n\", \"Views api\\n\\nActions\\n\\nFigure 5 -1. .NET Framework Site with .NET Core app in IIS.\\n\\n<!-- image -->\\n\\nThe\", \" DotNetMvcApp site is hosted as an MVC 5 app running on .NET Framework 4.7.2. It has its own IIS app\", \" pool configured in integrated mode and running .NET CLR version 4.0.30319. The api app is an ASP.NE\", \"T Core app running on .NET Framework 4.6.1 (net461). It was added to the DotNetMvcApp as a new IIS a\", \"pp and configured to use its own Application Pool. Its Application Pool is also running in integrate\", \"d mode but is configured with a .NET CLR version of No Managed Code since it will be executed using \", \"the ASP.NET Core Module. The version of the ASP.NET Core app is just an example. It could also be co\", \"nfigured to run on NET 5+. Though at that point, it would no longer be able to target .NET Framework\", \" libraries (see Choose the Right .NET Core Version)\\n\\nConfigured in this manner, the only change that\", \" must be made in order for the ASP.NET Core app's APIs to be routed properly is to change its defaul\", \"t route template from [Route(\\\"[api/controller]\\\")] to [Route(\\\"[controller]\\\")].\\n\\nAlternately the ASP.N\", \"ET Core app can be another top-level web site in IIS. In this case, you can configure the original s\", \"ite to use a rewrite rule (with URL Rewrite) that will redirect to the other app if the path starts \", \"with /api. The ASP.NET Core app can use a different host header for its route so that it doesn't con\", \"flict with the main app but can still respond to requests using root-based routes.\\n\\nAs an example, t\", \"he same ASP.NET Core app used in Figure 5-1 can be deployed to another folder configured as an IIS w\", \"eb site. The site should use an app pool configured just as before, with No\\n\\nReady\\n\\nDotNetMvcApp Hom\", \"e\\n\\nX\\n\\n-\\n\\n* Internet Information Services (IIS) Manager\\n\\n&lt; \\u2192\\n\\n6] \\u2022 NIGHTKING \\u00bb\\n\\nFile View\\n\\nHelp\\n\\nC\", \"onnections la Application Pools\\n\\nV\\n\\nEdit Inbound Rule\\n\\nActions\\n\\nEy Apply\\n\\nManaged Code. Configure it\", \"s bindings to respond to a unique host name on the server, such as api.contoso.com. To configure URL\", \" Rewrite to rewrite requests matching /api just add a new inbound rule at the IIS server (or individ\", \"ual site) level. Match the pattern ^/api(.*) and specify an Action type of Rewrite and a Rewrite URL\", \" of api.contoso.com/{R:1}. The combination of using (.*) in the matching pattern and {R:1} in the re\", \"write URL will ensure the rest of the path gets used with the new URL. With this in place, separate \", \"sites on the same IIS server can coexist running separate versions of .NET, but they can be made to \", \"appear to the Internet as one web app. Figure 5-2 shows the rewrite rule as configured in IIS with t\", \"he separate web site.\\n\\nSites\\n\\nConfiguration: 'localhost' applicationHost.config\\n\\nFigure 5 -2. Rewrit\", \"e rule to rewrite subfolder requests to another web site.\\n\\n<!-- image -->\\n\\nIf your app requires sing\", \"le sign-on between different sites or apps within IIS, refer to the documentation on how to share au\", \"thentication cookies among ASP.NET apps for detailed instructions on supporting this scenario.\\n\\nAnot\", \"her alternative to IIS Rewrite rules is the use of a reverse proxy like YARP, which can facilitate i\", \"ncremental ASP.NET to ASP.NET Core Migration .\\n\\n## Summary\\n\\nA common approach to porting large apps \", \"from .NET Framework to ASP.NET Core is to choose individual portions of the app to migrate one by on\", \"e. As each piece of the app is ported, the entire app remains running and usable, with some parts of\", \" it running in its original configuration and other parts running on some version of .NET Core. By f\", \"ollowing this approach, a large app migration can be performed incrementally. This approach results \", \"in limiting risk by providing more rapid feedback and\\n\\n\\u2022 0-\\n\\nreducing total surface area involved in\", \" testing. It also allows for more rapid realization of benefits of .NET Core, such as performance in\", \"creases. Although ASP.NET Core apps are no longer required to be hosted on IIS, IIS remains a very f\", \"lexible and powerful web server that can be configured to support a variety of hosting scenarios inv\", \"olving both .NET Framework and ASP.NET Core apps on the same IIS instance or even hosted on differen\", \"t servers.\\n\\n## References\\n\\n- Host ASP.NET Core on Windows with IIS\\n- URL Rewrite module and Applicat\", \"ion Request Routing\\n- URL Rewrite\\n- ASP.NET Core Module\\n- Share authentication cookies among ASP.NET\", \" apps\\n- Samples used in this section\\n- Incremental ASP.NET to ASP.NET Core Migration\\n\\nCHAPTER\\n\\n## Su\", \"mmary: Port existing ASP.NET Apps to .NET 7\\n\\nIn this book, you've been given the resources needed to\", \" decide whether it makes sense to port your organization's existing ASP.NET apps running on .NET Fra\", \"mework to ASP.NET Core. You've learned about important considerations for choosing when it makes sen\", \"se to migrate to .NET Core, and when it may be appropriate to keep (parts of) your app on .NET Frame\", \"work. There are differences between .NET Core versions and their capabilities and compatibilities wi\", \"th .NET Framework, and you learned how to choose the right version of .NET Core for your app .\\n\\nPort\", \"ing a large app often entails a fair amount of risk and effort. You learned how to mitigate this ris\", \"k by employing one or more incremental migration strategies along with several deployment strategies\", \" for keeping partially migrated apps running in production.\\n\\nThere are many architectural difference\", \"s between ASP.NET and ASP.NET Core. In chapter 2, you learned about many of these differences and ho\", \"w they relate to your app's migration. This chapter covered everything from app startup and low-leve\", \"l middleware to high-level controller and Web API differences and new features enabling much better \", \"testing scenarios .\\n\\nLarge apps are often comprised of many projects and packages, and dependencies \", \"can play a major role in determining how easy or difficult migration may be. Chapter 3 helped you id\", \"entify the sequence in which to migrate projects and how to understand and update your app's depende\", \"ncies. It also detailed additional strategies for migrating apps while keeping them running in produ\", \"ction .\\n\\nIn chapter 4, you saw how a real ASP.NET MVC reference app was migrated to ASP.NET Core. Th\", \"is chapter included a detailed breakdown of all the changes that were needed to take the existing ap\", \"p and port it over to run on ASP.NET Core. Refer back to it if you have specific questions about the\", \" porting process and some of its more specific details.\\n\\nFinally, chapter 5 detailed specific deploy\", \"ment scenarios focused on IIS. You saw how you can use your existing IIS web server to host parts of\", \" your app that have been ported to ASP.NET Core while keeping the app's public URLs consistent. IIS \", \"includes great support for URL rewriting and request routing that enables it to host multiple versio\", \"ns of your site side by side or even on different servers, with no change to the public-facing URLs \", \"the app exposes.\"]"