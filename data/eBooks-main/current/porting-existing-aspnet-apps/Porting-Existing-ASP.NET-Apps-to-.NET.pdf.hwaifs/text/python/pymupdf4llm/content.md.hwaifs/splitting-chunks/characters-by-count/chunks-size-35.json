"[\"PUBLISHED BY\\n\\n\\nMicrosoft Developer Division, .NET, and Visual Studio product teams\\n\\n\\nA division of M\", \"icrosoft Corporation\\n\\n\\nOne Microsoft Way\\n\\n\\nRedmond, Washington 98052-6399\\n\\n\\nCopyright \\u00a9 2023 by Micr\", \"osoft Corporation\\n\\n\\nAll rights reserved. No part of this book\\u2019s contents may be reproduced or transm\", \"itted in any form or\\nby any means without the written permission of the publisher.\\n\\n\\nThis book is pr\", \"ovided \\u201cas-is\\u201d and expresses the author\\u2019s views and opinions. The views, opinions, and\\ninformation e\", \"xpressed in this book, including URL and other Internet website references, may change\\nwithout notic\", \"e.\\n\\n\\nSome examples depicted herein are provided for illustration only and are fictitious. No real as\", \"sociation\\nor connection is intended or should be inferred.\\n\\n\\n[Microsoft and the trademarks listed at\", \" https://www.microsoft.com](https://www.microsoft.com/) on the \\u201cTrademarks\\u201d webpage are\\ntrademarks o\", \"f the Microsoft group of companies.\\n\\n\\nMac and macOS are trademarks of Apple Inc.\\n\\n\\nThe Docker whale \", \"logo is a registered trademark of Docker, Inc. Used by permission.\\n\\n\\nAll other marks and logos are p\", \"roperty of their respective owners.\\n\\n\\nAuthors:\\n\\n\\n**Steve \\u201cardalis\\u201d Smith** [, Software Architect and\", \" Trainer - Ardalis.com](https://ardalis.com/)\\n\\n\\nParticipants and Reviewers:\\n\\n\\n**Nish Anil**, Senior \", \"Program Manager, .NET team, Microsoft\\n\\n\\n**Mike Rousos**, Principal Software Engineer, .NET team, Mic\", \"rosoft\\n\\n\\n**Scott Addie**, Senior Content Developer, .NET team, Microsoft\\n\\n\\n**David Pine**, Senior Co\", \"ntent Developer, .NET team, Microsoft\\n### Version\\n\\n\\nThis guide covers **.NET 7** and updates related\", \" to the same technology \\u201cwave\\u201d (that is, Azure and other\\nthird-party technologies) coinciding in tim\", \"e with the .NET 7 release. This book covers migration of\\napps that are currently running on .NET Fra\", \"mework 4.x.\\n### Who should use this guide\\n\\n\\nThis guide\\u2019s audience is developers, development leads, \", \"and architects who are interested in\\nmigrating their existing apps written for ASP.NET MVC and Web A\", \"PI (.NET Framework 4.x) to the latest\\n\\n\\n.NET version. ASP.NET Web Forms developers will benefit from\", \" this guide but should also read the\\n[Blazor for ASP.NET Web Forms Developers e-book.](https://docs.\", \"microsoft.com/en-us/dotnet/architecture/blazor-for-web-forms-developers/)\\n\\n\\nA secondary audience is \", \"technical decision-makers planning when to move their apps to .NET 7.\\n\\n\\nThe target audience for this\", \" book is .NET developers with large, existing apps that run on ASP.NET\\nMVC and Web API. Apps built o\", \"n ASP.NET Web Forms are outside of the focus of this book, though\\nmuch of the information comparing \", \".NET Framework and .NET Core/latest may still be relevant.\\n### How you can use this guide\\n\\n\\nYou can \", \"read this book straight through, as we expect many readers to do. This book will provide you\\nfirst w\", \"ith considerations for whether you should port your app at all. That content is followed by\\narchitec\", \"tural differences between .NET Framework and .NET Core. From there, you\\u2019ll learn strategies\\nfor migr\", \"ating a large solution over time and how to port a real app. Next, the book includes\\ndeployment scen\", \"arios that address the need to run different apps while appearing as a single app to\\nusers. The book\", \" concludes with two case studies describing real apps that have migrated from\\nASP.NET MVC to ASP.NET\", \" Core.\\n\\n\\nWhether or not you choose to start from the first chapter, you can reference any of these c\", \"hapters to\\nlearn about specific concepts:\\n\\n\\n  - Architectural differences\\n\\n  - Migrate large solutio\", \"ns\\n\\n  - Sample migration\\n\\n  - Deployment scenarios\\n\\n[This guide is available both in PDF form](https\", \"://aka.ms/aspnet-porting-ebook) and online. Feel free to forward this document or links to its\\nonlin\", \"e version to your team to ensure a common understanding of these concepts.\\n\\n\\n## Contents\\n\\n**Introduc\", \"tion to porting apps to .NET 7 .....................................................................\", \"........... 1**\\n\\n\\nReferences .......................................................................\", \"....................................................................................................\", \"....... 2\\n\\n\\nMigration considerations ...............................................................\", \"....................................................................................... 2\\n\\n\\nIs migra\", \"tion to .NET Core appropriate? .....................................................................\", \"................................................ 2\\n\\n\\nWhen is .NET Framework appropriate? ...........\", \"....................................................................................................\", \"....... 3\\n\\n\\nReferences .............................................................................\", \"................................................................................................. 4\\n\", \"\\n\\nMigrate to ASP.NET Core 2.1 ......................................................................\", \"........................................................................ 4\\n\\n\\nShould apps run on .NET\", \" Framework with ASP.NET Core 2.1 ...................................................................\", \"........ 4\\n\\n\\nReferences ............................................................................\", \".................................................................................................. 5\", \"\\n\\n\\nChoose the right .NET Core version ..............................................................\", \"................................................................... 5\\n\\n\\nReferences .................\", \"....................................................................................................\", \"......................................................... 5\\n\\n\\nStrategies for migrating incrementally\", \" ...................................................................................................\", \"......................... 6\\n\\n\\nMigrating slice by slice .............................................\", \"....................................................................................................\", \"..... 6\\n\\n\\nMigrating layer by layer .................................................................\", \"................................................................................... 6\\n\\n\\nReferences .\", \"....................................................................................................\", \"......................................................................... 7\\n\\n\\nStrategies for migrati\", \"ng ASP.NET Web Forms apps ..........................................................................\", \"........................ 7\\n\\n\\nSeparate business logic and other concerns.............................\", \"............................................................................... 7\\n\\n\\nImplement client\", \" behavior and web APIs .............................................................................\", \"..................................... 8\\n\\n\\nConsider Blazor ..........................................\", \"....................................................................................................\", \"...................... 8\\n\\n\\nSummary .................................................................\", \"....................................................................................................\", \"............ 8\\n\\n\\nReferences ........................................................................\", \"....................................................................................................\", \".. 8\\n\\n\\nDeployment strategies .......................................................................\", \".................................................................................... 8\\n\\n\\nCross-platf\", \"orm options ........................................................................................\", \"............................................................. 8\\n\\n\\nCloud native development .........\", \"....................................................................................................\", \"................................. 9\\n\\n\\nLeverage containers ..........................................\", \"....................................................................................................\", \"............. 9\\n\\n\\nSide-by-side deployment options ..................................................\", \".............................................................................. 9\\n\\n\\nIIS on Windows ..\", \"....................................................................................................\", \".............................................................. 9\\n\\n\\nOther options on Windows ........\", \"....................................................................................................\", \"................................. 9\\n\\n\\ni Contents\\n\\n\\nReferences ......................................\", \"....................................................................................................\", \".................................... 9\\n\\n\\nAdditional migration resources ............................\", \"....................................................................................................\", \"....... 10\\n\\n\\nOfficial documentation ................................................................\", \".................................................................................. 10\\n\\n\\nGitHub .....\", \"....................................................................................................\", \"......................................................................... 10\\n\\n\\nStack Overflow ......\", \"....................................................................................................\", \"........................................................ 11\\n\\n\\nYouTube channels .....................\", \"....................................................................................................\", \"................................... 11\\n\\n\\nTwitter, Gitter, Slack, and other community channels ......\", \"................................................................................. 11\\n\\n\\nReferences ..\", \"....................................................................................................\", \"..................................................................... 11\\n\\n\\nArchitectural differences\", \" between ASP.NET MVC and ASP.NET Core ............................................... 12\\n\\n\\nBreaking \", \"changes ............................................................................................\", \"...................................................................... 12\\n\\n\\nApp startup differences \", \"between ASP.NET MVC and ASP.NET Core ...............................................................\", \" 12\\n\\n\\nASP.NET MVC Startup ..........................................................................\", \".......................................................................... 13\\n\\n\\nASP.NET Core Startup\", \" ...................................................................................................\", \".................................................. 13\\n\\n\\nPorting considerations .....................\", \"....................................................................................................\", \".......................... 14\\n\\n\\nReferences .........................................................\", \"....................................................................................................\", \".............. 14\\n\\n\\nHosting differences between ASP.NET MVC and ASP.NET Core .......................\", \"................................................ 14\\n\\n\\nReferences ...................................\", \"....................................................................................................\", \".................................... 15\\n\\n\\nServe static files in ASP.NET MVC and ASP.NET Core .......\", \"..................................................................................... 15\\n\\n\\nHost stat\", \"ic files in ASP.NET MVC ............................................................................\", \"................................................... 15\\n\\n\\nHost static files in ASP.NET Core .........\", \"....................................................................................................\", \"................... 15\\n\\n\\nReferences ................................................................\", \"....................................................................................................\", \"....... 16\\n\\n\\nDependency injection differences between ASP.NET MVC and ASP.NET Core .................\", \".......................... 16\\n\\n\\nDependency injection in ASP.NET Core ...............................\", \"................................................................................... 16\\n\\n\\nReferences \", \"....................................................................................................\", \"....................................................................... 17\\n\\n\\nCompare middleware to m\", \"odules and handlers ................................................................................\", \"...................... 17\\n\\n\\nASP.NET modules and handlers ...........................................\", \"...................................................................................... 17\\n\\n\\nASP.NET \", \"Core middleware ....................................................................................\", \"........................................................ 17\\n\\n\\nAccessing HttpContext.................\", \"....................................................................................................\", \".............................. 17\\n\\n\\nReferences .....................................................\", \"....................................................................................................\", \".................. 18\\n\\n\\nConfiguration differences between ASP.NET MVC and ASP.NET Core .............\", \".............................................. 18\\n\\n\\nASP.NET MVC configuration ......................\", \"....................................................................................................\", \".............. 19\\n\\n\\nASP.NET Core configuration .....................................................\", \"................................................................................... 19\\n\\n\\nii Contents\", \"\\n\\n\\nMigrate configuration ...........................................................................\", \"......................................................................... 20\\n\\n\\nReferences ..........\", \"....................................................................................................\", \"............................................................. 21\\n\\n\\nRouting differences between ASP.N\", \"ET MVC and ASP.NET Core ....................................................................... 21\\n\\n\", \"\\nRouting in ASP.NET MVC and Web API ................................................................\", \".................................................. 21\\n\\n\\nRoute table ................................\", \"....................................................................................................\", \"..................................... 21\\n\\n\\nRouting in .NET 7 .......................................\", \"....................................................................................................\", \".................. 23\\n\\n\\nReferences .................................................................\", \"....................................................................................................\", \"...... 24\\n\\n\\nLogging differences between ASP.NET MVC and ASP.NET Core ...............................\", \"....................................... 25\\n\\n\\nASP.NET MVC logging ...................................\", \"....................................................................................................\", \"............ 25\\n\\n\\nASP.NET Core logging .............................................................\", \"....................................................................................... 25\\n\\n\\nMigrate\", \" logging ...........................................................................................\", \"..................................................................... 26\\n\\n\\nReferences ..............\", \"....................................................................................................\", \"......................................................... 26\\n\\n\\nCompare Razor Pages to ASP.NET MVC ..\", \"....................................................................................................\", \"................ 26\\n\\n\\nReferences ...................................................................\", \"....................................................................................................\", \".... 27\\n\\n\\nCompare ASP.NET Web API 2 and ASP.NET Core ...............................................\", \".................................................... 27\\n\\n\\nReferences ...............................\", \"....................................................................................................\", \"........................................ 27\\n\\n\\nCompare authentication and authorization between ASP.N\", \"ET MVC and ASP.NET Core ........................ 27\\n\\n\\nAuthorization ................................\", \"....................................................................................................\", \"................................. 28\\n\\n\\nReferences ..................................................\", \"....................................................................................................\", \"..................... 28\\n\\n\\nCompare ASP.NET Identity and ASP.NET Core Identity ......................\", \".................................................................. 28\\n\\n\\nMigrate from OWIN / Katana .\", \"....................................................................................................\", \"................................. 29\\n\\n\\nReferences ..................................................\", \"....................................................................................................\", \"..................... 29\\n\\n\\nCompare controllers in ASP.NET MVC and Web API with controllers in ASP.NE\", \"T Core .......................... 29\\n\\n\\nReferences ..................................................\", \"....................................................................................................\", \"..................... 30\\n\\n\\nCompare Razor usage in ASP.NET MVC and ASP.NET Core .....................\", \"........................................................... 30\\n\\n\\nTag Helpers .......................\", \"....................................................................................................\", \".............................................. 30\\n\\n\\nRazor Pages ....................................\", \"....................................................................................................\", \"................................ 30\\n\\n\\nReferences ...................................................\", \"....................................................................................................\", \".................... 31\\n\\n\\nCompare ASP.NET SignalR and ASP.NET Core SignalR .........................\", \"................................................................ 31\\n\\n\\nFeature differences ..........\", \"....................................................................................................\", \"............................................ 31\\n\\n\\nReferences .......................................\", \"....................................................................................................\", \"................................ 31\\n\\n\\nCompare testing options between ASP.NET MVC and ASP.NET Core .\", \"........................................................... 32\\n\\n\\niii Contents\\n\\n\\nReferences .........\", \"....................................................................................................\", \".............................................................. 32\\n\\n\\nMigrate large solutions to ASP.N\", \"ET Core ............................................................................................\", \"......... 33\\n\\n\\nReferences ..........................................................................\", \"....................................................................................................\", \". 33\\n\\n\\nIdentify sequence of projects to migrate ....................................................\", \"................................................................ 33\\n\\n\\nUnit tests ...................\", \"....................................................................................................\", \"....................................................... 37\\n\\n\\nConsiderations for migrating many apps \", \"....................................................................................................\", \"........... 37\\n\\n\\nSummary ...........................................................................\", \"................................................................................................... \", \"38\\n\\n\\nReferences ....................................................................................\", \"....................................................................................... 38\\n\\n\\nUnderst\", \"and and update dependencies ........................................................................\", \"................................................ 38\\n\\n\\nUpdate class library dependencies.............\", \"....................................................................................................\", \"........... 38\\n\\n\\nUpdate NuGet package dependencies..................................................\", \".................................................................. 39\\n\\n\\nMigrate ASP.NET MVC projects\", \" ...................................................................................................\", \"............................... 40\\n\\n\\nReferences ....................................................\", \"....................................................................................................\", \"................... 40\\n\\n\\nStrategies for migrating while running in production ......................\", \"..................................................................... 40\\n\\n\\nRefactor the .NET Framewo\", \"rk solution ........................................................................................\", \"............................ 40\\n\\n\\nExtract front-end assets to a CDN ................................\", \"............................................................................................. 41\\n\\n\\nE\", \"xtract and migrate individual microservices ........................................................\", \"............................................... 41\\n\\n\\nDeploy multiple versions of the app side-by-sid\", \"e in IIS ................................................................................... 41\\n\\n\\nAp\", \"ply the Strangler pattern ..........................................................................\", \"............................................................... 41\\n\\n\\nMulti-targeting approaches ....\", \"....................................................................................................\", \"................................. 42\\n\\n\\nSummary .....................................................\", \"....................................................................................................\", \"..................... 42\\n\\n\\nReferences ..............................................................\", \"....................................................................................................\", \"......... 42\\n\\n\\nExample migration of eShop to ASP.NET Core ..........................................\", \"................................................ 43\\n\\n\\nRun _ApiPort_ to identify problematic APIs....\", \"....................................................................................................\", \"............ 44\\n\\n\\nUpdate project files and NuGet reference syntax ..................................\", \".................................................................. 47\\n\\n\\nCreate new ASP.NET Core proj\", \"ect ................................................................................................\", \".................................. 49\\n\\n\\nMigrating NuGet Packages ...................................\", \"....................................................................................................\", \"... 51\\n\\n\\nMigrate static files ......................................................................\", \"...................................................................................... 53\\n\\n\\nMigrate \", \"C# files ...........................................................................................\", \"...................................................................... 54\\n\\n\\nMigrate views ..........\", \"....................................................................................................\", \"........................................................... 56\\n\\n\\nMigrate app startup components ....\", \"....................................................................................................\", \".......................... 58\\n\\n\\nConfigure MVC ......................................................\", \"....................................................................................................\", \"........ 58\\n\\n\\niv Contents\\n\\n\\nData access considerations .............................................\", \".................................................................................................. 6\", \"3\\n\\n\\nMigrate to Entity Framework Core ...............................................................\", \"............................................................. 64\\n\\n\\nFix all TODO tasks ..............\", \"....................................................................................................\", \"............................................... 67\\n\\n\\nAdditional MVC customizations .................\", \"....................................................................................................\", \"................. 68\\n\\n\\nOther dependencies ..........................................................\", \".................................................................................................. 6\", \"9\\n\\n\\nReferences .....................................................................................\", \".......................................................................................... 69\\n\\n\\nMore\", \" migration scenarios ...............................................................................\", \".................................................................. 69\\n\\n\\nMigrate ASP.NET MVC 5 and We\", \"bApi 2 to ASP.NET Core MVC ................................................................... 69\\n\\n\\n\", \"Migrate HttpResponseMessage to ASP.NET Core ........................................................\", \"...................................... 70\\n\\n\\nMigrate content negotiation from ASP.NET Web API to ASP.\", \"NET Core .................................................... 71\\n\\n\\nCustom model binding ............\", \"....................................................................................................\", \".................................. 71\\n\\n\\nMedia formatters ...........................................\", \"....................................................................................................\", \"............... 73\\n\\n\\nCustom filters ................................................................\", \"....................................................................................................\", \". 73\\n\\n\\nRoute constraints ...........................................................................\", \".................................................................................. 74\\n\\n\\nCustom route\", \" handlers ..........................................................................................\", \"........................................................ 75\\n\\n\\nCORS support .........................\", \"....................................................................................................\", \"....................................... 76\\n\\n\\nCustom areas ..........................................\", \"....................................................................................................\", \"....................... 77\\n\\n\\nIntegration tests for ASP.NET MVC and ASP.NET Web API..................\", \"........................................................... 78\\n\\n\\nWCF client configuration ..........\", \"....................................................................................................\", \"................................. 80\\n\\n\\nReferences ..................................................\", \"....................................................................................................\", \"..................... 80\\n\\n\\nDeployment scenarios when migrating to ASP.NET Core .....................\", \"................................................ 81\\n\\n\\nSplit a large web app ........................\", \"....................................................................................................\", \"............................... 81\\n\\n\\nSummary .......................................................\", \"....................................................................................................\", \"....................... 84\\n\\n\\nReferences ............................................................\", \"....................................................................................................\", \"............... 85\\n\\n\\nSummary: Port existing ASP.NET Apps to .NET 7 .................................\", \"..................................................... 86\\n\\n\\nv Contents\\n\\n\\n**CHAPTER**\\n# 1\\n\\n## Introduc\", \"tion to porting apps to .NET 7\\n\\n\\n.NET Core and its latest version, .NET 7, represent a revolutionary\", \" step forward from .NET Framework.\\nIt offers a host of advantages over .NET Framework across the boa\", \"rd from productivity to\\nperformance, from cross-platform support to developer satisfaction. ASP.NET \", \"Core was even voted\\n[the most-loved web framework (tied with Svelte) in the 2021 Stack Overflow deve\", \"loper survey. Clearly](https://insights.stackoverflow.com/survey/2021#technology-most-loved-dreaded-\", \"and-wanted)\\nthere are strong reasons to consider migrating.\\n\\n\\n[Even before .NET 7 shipped, Microsoft\", \" was clear: .NET Core is the Future of .NET. To quote this article:](https://devblogs.microsoft.com/\", \"dotnet/net-core-is-the-future-of-net/)\\n\\n\\nNew apps should be built on .NET Core. .NET Core is where f\", \"uture investments in .NET will happen.\\nExisting apps are safe to remain on .NET Framework which will\", \" be supported. Existing apps that want\\nto take advantage of the new features in .NET should consider\", \" moving to .NET Core. As we plan into\\nthe future, we will be bringing in even more capabilities to t\", \"he platform.\\n\\n\\nToday, .NET 7 is what new apps should target, and if you\\u2019re migrating an existing app\", \" from .NET\\nFramework, .NET 7 is your ideal target framework.\\n\\n\\nHowever, upgrading your app to ASP.NE\", \"T Core will require some effort. That effort should be\\nbalanced against business value and goals. .N\", \"ET Framework apps have a long life ahead of them, with\\nsupport built into Windows for the foreseeabl\", \"e future. What are some of the questions you should\\nconsider before deciding migration to .NET 7 is \", \"appropriate? What are the expected advantages?\\nWhat are the tradeoffs? How much effort is involved? \", \"These obvious questions are just the beginning,\\nbut make for a great starting point as teams conside\", \"r how to support their customers\\u2019 needs with\\napps today and tomorrow.\\n\\n\\n  - Is migration to .NET 7 a\", \"ppropriate?\\n\\n  - When does it make sense to remain on .NET Framework?\\n\\n  - Should apps target ASP.NE\", \"T Core 2.1 as a stepping stone?\\n\\n  - How should teams choose the right .NET version to target?\\n\\n  - \", \"What strategies are recommended for incremental migration of large apps?\\n\\n  - What deployment strate\", \"gies should be considered when porting to .NET 7?\\n\\n  - Where can we find additional resources?\\n\\n\\nThi\", \"s introductory chapter addresses all of these questions and more before moving on to more\\nspecific a\", \"nd technical considerations in future chapters.\\n\\n\\n1 CHAPTER 1 | Introduction to porting apps to .NET\", \" 7\\n\\n\\n### References\\n\\n\\n  - [2021 Stack Overflow developer survey most loved web frameworks](https://i\", \"nsights.stackoverflow.com/survey/2021#technology-most-loved-dreaded-and-wanted)\\n\\n  - [.NET Core is t\", \"he Future of .NET](https://devblogs.microsoft.com/dotnet/net-core-is-the-future-of-net/)\\n\\n### Migrat\", \"ion considerations\\n\\n\\nThe most fundamental question teams must answer when it comes to porting their \", \"apps to .NET Core\\nis, should they port at all? In some cases, the best path forward is to remain on \", \".NET Framework using\\nASP.NET MVC and/or Web API. This chapter considers reasons why moving to .NET C\", \"ore makes sense.\\nThe chapter also considers scenarios and counterpoints for staying on .NET Framewor\", \"k.\\n\\n#### **Is migration to .NET Core appropriate?**\\n\\n\\nLet\\u2019s start with some of the reasons why you m\", \"ight want to move to .NET Core/.NET 7. There are quite\\na few, so don\\u2019t consider this list exhaustive\", \".\\n\\n\\n**Cross-platform support**\\n\\n\\nApps built on .NET Core are truly cross-platform and can run on Win\", \"dows, Linux, and macOS. Not only\\ncan your developers use whatever hardware they want, but you can al\", \"so host your app anywhere.\\nExamples range from local IIS to Azure in the cloud or from Linux Docker \", \"containers to IoT devices.\\n\\n\\n**Performance and scalability**\\n\\n\\n[Apps built with .NET Core are runnin\", \"g on one of the fastest tech stacks available anywhere. ASP.NET](https://www.techempower.com/benchma\", \"rks/#hw=ph&test=plaintext)\\nMVC apps often see performance improvements on ASP.NET Core, especially i\", \"f they\\u2019re updated to\\ntake advantage of some new features available in .NET Core.\\n\\n\\n**Cloud-native**\\n\", \"\\n\\nFor the above reasons and others, .NET Core apps are well-suited to running in cloud hosting\\nenvir\", \"onments. Lightweight and fast, .NET Core apps can be deployed to Azure App Services or\\ncontainers an\", \"d scaled horizontally as needed to meet immediate system demand.\\n\\n\\n**Maintainable**\\n\\n\\nFor many apps,\", \" while they\\u2019ve continued to meet customer and business needs, technical debt has\\naccumulated and mai\", \"ntaining the app has grown expensive. ASP.NET Core apps are more easily\\ntested than ASP.NET MVC apps\", \", making them easier to refactor and extend with confidence.\\n\\n\\n**Modular**\\n\\n\\nASP.NET Core is modular\", \", using NuGet packages as a first-class part of the framework. Apps built for\\n.NET Core all support \", \"dependency injection, making it easy to compose solutions from whatever\\nimplementations are needed f\", \"or a given environment. Building microservices with .NET Core is easier\\n\\n\\n2 CHAPTER 1 | Introduction\", \" to porting apps to .NET 7\\n\\n\\nthan with ASP.NET MVC with its dependency on IIS, which opens up additi\", \"onal options to break up\\nlarge apps into smaller modules.\\n\\n\\n**Modern**\\n\\n\\nStaying on a modern, active\", \"ly developed technology stack has a host of advantages. New features\\nand C# language features will o\", \"nly be added to .NET Core. The .NET Framework has had its last\\nrelease with version 4.8, and version\", \"s of C# beyond 8 won\\u2019t target .NET Framework. While ASP.NET\\nMVC will remain supported by Microsoft f\", \"or many years, the best and brightest .NET software\\ndevelopers are likely looking to use the more mo\", \"dern .NET Core framework, with all of the advantages\\nit offers (only some of which are summarized ab\", \"ove). Finding developers with the skills to maintain an\\nASP.NET MVC app will start to become a chall\", \"enge at some point, as will finding online training and\\ntroubleshooting assistance. There probably a\", \"ren\\u2019t that many new blog posts being written about\\nASP.NET MVC 5, while there are plenty being writt\", \"en for .NET 7, for example.\\n\\n\\nThere are many compelling reasons to consider migrating to .NET Core, \", \"which presumably is why\\nyou\\u2019re reading this book! But let\\u2019s consider some disadvantages and reasons \", \"why it may make more\\nsense to remain on the .NET Framework.\\n\\n#### **When is .NET Framework appropria\", \"te?**\\n\\n\\nThe biggest reason to stay on .NET Framework is when an app isn\\u2019t under active development a\", \"nd\\nwouldn\\u2019t benefit substantially from the advantages listed above. In that case, there probably isn\", \"\\u2019t a\\ngood business case to incur the cost of porting the app. If your app might benefit from the\\nadv\", \"antages .NET Core offers, you may still need to stay on .NET Framework if you need certain\\n[technolo\", \"gies that are unavailable on .NET Core. There are some .NET technologies that are unavailable](https\", \"://docs.microsoft.com/en-us/dotnet/core/porting/net-framework-tech-unavailable)\\n[on .NET Core, inclu\", \"ding AppDomains, Remoting, Code Access Security (CAS), Security Transparency,](https://docs.microsof\", \"t.com/en-us/dotnet/core/porting/net-framework-tech-unavailable)\\nand System.EnterpriseServices. A bri\", \"ef summary of these technologies and their alternatives is\\nincluded here. For more detailed guidance\", \", see the documentation.\\n\\n\\n**Application domains**\\n\\n\\nApplication domains (AppDomains) isolate apps f\", \"rom one another. AppDomains require runtime\\nsupport and can be expensive. Creating additional app do\", \"mains isn\\u2019t supported, and there are no\\nplans to add this capability to .NET Core in the future. For\", \" code isolation, use separate processes or\\ncontainers as an alternative. Some customers use AppDomai\", \"ns as a way of unloading assemblies. In\\n[.NET Core AssemblyLoadContext provides an alternative way t\", \"o unload assemblies.](https://docs.microsoft.com/en-us/dotnet/standard/assembly/unloadability)\\n\\n\\n**W\", \"CF**\\n\\n\\n[.NET Core and .NET 5+ support WCF clients. Server-side WCF is possible through CoreWCF, whic\", \"h is](https://www.nuget.org/profiles/corewcf)\\nofficially supported by Microsoft as of April 2022. Ap\", \"ps that require server-side WCF functionality can\\nalso consider a different communication technology\", \" (such as gRPC or REST) as part of a migration.\\n\\n\\n[There is a WCF client port available from the .NE\", \"T Foundation. It\\u2019s entirely open source, cross](https://docs.microsoft.com/en-us/dotnet/core/whats-n\", \"ew/dotnet-5#windows-communication-foundation)\\nplatform, and supported by Microsoft.\\n\\n\\n[To learn more\", \" about migrating from WCF to gRPC, consult the gRPC for WCF Developers ebook.](https://docs.microsof\", \"t.com/en-us/dotnet/architecture/grpc-for-wcf-developers/)\\n\\n\\n3 CHAPTER 1 | Introduction to porting ap\", \"ps to .NET 7\\n\\n\\n**Remoting**\\n\\n\\n.NET Remoting was identified as a problematic architecture. It\\u2019s used \", \"for cross-AppDomain\\ncommunication, which is no longer supported. Also, Remoting requires runtime sup\", \"port, which is\\nexpensive to maintain. For these reasons, .NET Remoting isn\\u2019t supported on .NET Core,\", \" and the\\nproduct team doesn\\u2019t plan on adding support for it in the future. There are several alterna\", \"tive\\nmessaging strategies and implementations you can use to replace remoting in your .NET Core apps\", \".\\n\\n\\n**Code Access Security (CAS) and Security Transparency**\\n\\n\\nNeither of these technologies are sup\", \"ported by .NET Core. Instead, the recommendation is to use\\nsecurity boundaries provided by the opera\", \"ting system. For example, virtualization, containers, or user\\naccounts. Run processes with the minim\", \"al set of privileges necessary.\\n\\n#### **References**\\n\\n\\n[.NET Framework Technologies Unavailable on .\", \"NET Core](https://docs.microsoft.com/en-us/dotnet/core/porting/net-framework-tech-unavailable)\\n\\n### \", \"Migrate to ASP.NET Core 2.1\\n\\n\\nASP.NET Core 2.1 is an interesting release because it\\u2019s the most recen\", \"tly supported ASP.NET Core\\nrelease that supported both .NET Core and .NET Framework runtimes. As suc\", \"h, it may offer an easier\\nupgrade path for some apps when compared to upgrading all parts of the app\", \" to .NET Core/.NET 7 at\\nonce. Although support for .NET Core 2.1 ended in August 2021, it may make s\", \"ense as an interim step\\nfor some apps. Also, support for ASP.NET Core 2.1 running on .NET Framework \", \"will continue for as\\n[long as its underlying .NET Framework is supported. A complete list of current\", \"ly supported ASP.NET](https://docs.microsoft.com/lifecycle/products/microsoft-net-framework)\\n[Core 2\", \".1 packages](https://dotnet.microsoft.com/platform/support/policy/aspnetcore-2.1) is available for r\", \"eference.\\n\\n#### **Should apps run on .NET Framework with ASP.NET Core 2.1**\\n\\n\\nASP.NET Core 2.2 and e\", \"arlier supported both .NET Core and .NET Framework runtimes. Does it make\\nsense to migrate some or a\", \"ll of an app to ASP.NET Core 2.1 as a stepping stone, before porting over\\ncompletely to .NET Core? A\", \"pps, or subsets of apps, could see their front-end ASP.NET logic ported to\\nuse ASP.NET Core, while s\", \"till consuming .NET Framework libraries for business logic and infrastructure\\nconsumption. This appr\", \"oach may make sense when there\\u2019s a relatively thin UI layer without much\\nbusiness logic, and a much \", \"larger set of functionality in class libraries.\\n\\n\\nThe main benefit of porting just the front-end web\", \" layer to ASP.NET Core 2.1 is that the existing .NET\\nclass libraries can remain as is during the ini\", \"tial migration. They may be in continued use by other\\n.NET apps or simply don\\u2019t need to be in scope \", \"for the first iteration of a planned full migration to .NET\\nCore. Reducing the scope of the initial \", \"migration for large apps helps provide incremental goals that\\nact as stepping stones toward the desi\", \"red end state, which is often a complete port to .NET Core.\\n\\n\\nIf you have an existing app that may u\", \"se this strategy, some things you can do today to help prepare\\nfor the process are to move as much b\", \"usiness logic, data access, and other non-UI logic out of the\\nASP.NET projects and into separate cla\", \"ss libraries as possible. It will also help if you have automated\\n\\n\\n4 CHAPTER 1 | Introduction to po\", \"rting apps to .NET 7\\n\\n\\ntest coverage of your system, so that you can verify behavior remains consist\", \"ent before and after the\\nmigration.\\n\\n\\nIf your app is so large that you can\\u2019t migrate the entire web \", \"app at once, and you need to be able to\\ndeploy the new ASP.NET Core app side-by-side with the existi\", \"ng ASP.NET app, there are deployment\\nstrategies that can be used to achieve this. These are covered \", \"in Chapter 5: Deployment Scenarios.\\n\\n\\nKeep in mind that ASP.NET Core 2.1 was the last LTS release of\", \" .NET Core that supported running on\\n.NET Framework and consuming .NET Framework libraries. Although\", \" the release is now unsupported\\non .NET Core, it continues to be supported for use with .NET Framewo\", \"rk. It will remain supported for\\n[as long as the specific .NET Framework version is supported. For m\", \"ore information, see ASP.NET Core](https://dotnet.microsoft.com/platform/support/policy/dotnet-core)\", \"\\n[2.1 on .NET Framework.](https://dotnet.microsoft.com/platform/support/policy/dotnet-core)\\n\\n#### **\", \"References**\\n\\n\\n[Migrating from ASP.NET to ASP.NET Core 2.1](https://docs.microsoft.com/aspnet/core/m\", \"igration/proper-to-2x/?preserve-view=true&view=aspnetcore-2.1) [ASP.NET Core 2.1 on .NET Framework](\", \"https://dotnet.microsoft.com/platform/support/policy/dotnet-core) [ASP.NET Core 2.1](https://dotnet.\", \"microsoft.com/en-us/platform/support/policy/aspnetcore-2.1)\\n[Supported Packages](https://dotnet.micr\", \"osoft.com/en-us/platform/support/policy/aspnetcore-2.1)\\n\\n### Choose the right .NET Core version\\n\\n\\nTh\", \"e largest consideration for most organizations when choosing which version of .NET to target is the\\n\", \"support lifecycle. Long Term Support (LTS) releases ship less frequently but have a longer support\\nw\", \"indow than Standard Term Support (STS) releases. Currently, LTS releases are scheduled to ship\\nevery\", \" other year. Customers can choose which releases to target, and can install different releases of\\n.N\", \"ET side by side on the same machine. LTS releases will receive only critical and compatible fixes\\nth\", \"roughout their lifecycle. STS releases will receive these same fixes and will also be updated with\\nc\", \"ompatible innovations and features. LTS releases are supported for three years after their initial\\nr\", \"elease. STS releases are supported for six months after a subsequent STS or LTS release.\\n\\n\\n.NET 7 is\", \" the latest STS release; .NET 6 is the latest LTS release.\\n\\n\\nCustomers looking to migrate a large .N\", \"ET Framework app to .NET today may be looking for a stable\\ndestination, given that they haven\\u2019t alre\", \"ady made the move to an earlier version of .NET Core. In this\\ncase, the best .NET version to target \", \"for the migration is .NET 6, which is the most recent LTS version.\\nWhile support for .NET Core 3.1 e\", \"nded in December 2022, support for .NET 6 will continue until\\nNovember 2024.\\n\\n\\nOther customers may w\", \"ant to ensure they\\u2019re upgrading to the latest supported version, so that postmigration they\\u2019re not a\", \"lready behind a version. These customers will want to target .NET 7 for the\\nmigration.\\n\\n\\nIn either c\", \"ase, there is very little difference in the migration process. This book assumes .NET\\nFramework apps\", \" will be upgraded to .NET 7.\\n\\n#### **References**\\n\\n\\n[.NET and .NET Core Support Policy](https://dotn\", \"et.microsoft.com/platform/support/policy/dotnet-core)\\n\\n\\n5 CHAPTER 1 | Introduction to porting apps t\", \"o .NET 7\\n\\n\\n### Strategies for migrating incrementally\\n\\nThe biggest challenge with migrating any larg\", \"e app is determining how to break the process into\\nsmaller tasks. There are several strategies that \", \"can be applied for this purpose, including breaking the\\napp into horizontal layers such as UI, data \", \"access, business logic, or breaking up the app into separate,\\nsmaller apps. Another strategy is to u\", \"pgrade some or all of the app to different framework versions on\\n[the way to a recent .NET Core rele\", \"ase. One approach you could use is to migrate vertical slices of the](https://deviq.com/practices/ve\", \"rtical-slices)\\napp, rather than attempting to migrate one horizontal layer at a time. Let\\u2019s consider\", \" each of these\\ndifferent approaches.\\n\\n#### **Migrating slice by slice**\\n\\n\\nOne successful approach to\", \" migrating is to identify vertical slices of functionality and migrate them to\\nthe target platform o\", \"ne by one. The first step is to create a new ASP.NET Core 7 app. Next, identify the\\nindividual page \", \"or API endpoint that will be migrated first. Build out just the necessary functionality to\\nsupport t\", \"his one route in the new ASP.NET Core app. Then use HTTP rewriting and/or a reverse proxy\\nto start s\", \"ending requests for these pages or endpoints to the new app rather than the ASP.NET app.\\nThis approa\", \"ch is well-suited to API projects, but can also work for many MVC apps.\\n\\n\\nWhen migrating slice by sl\", \"ice, the entire stack of the individual API endpoint or requested route is\\nrecreated in the new proj\", \"ect or solution. The very first such slice typically requires the most effort,\\nsince it will typical\", \"ly need several projects to be created and decisions to be made about data access\\nand solution organ\", \"ization. Once the first slice\\u2019s functionality mirrors the existing app\\u2019s, it can be\\ndeployed and the\", \" existing app can redirect to it or simply be removed. This approach is then repeated\\nuntil the enti\", \"re app has been ported to the new structure.\\n\\n\\nSome specific guidance on how to follow this strategy\", \" using IIS is covered in Chapter 5, Deployment\\nScenarios.\\n\\n#### **Migrating layer by layer**\\n\\n\\nConsi\", \"der the challenge of migrating a large ASP.NET 4.5 app. One approach is to migrate the entire\\napp di\", \"rectly from .NET Framework 4.5 to .NET 7. However, this approach needs to account for every\\nbreaking\", \" change between the two frameworks and versions, which are substantial. Performing this\\nwork on one \", \"project at a time provides a set of stepping stones so that the entire solution doesn\\u2019t\\nneed to be m\", \"oved at once.\\n\\n\\nOne piece of the .NET ecosystem that helps with interoperability between different .\", \"NET frameworks is\\n[.NET Standard. .NET Standard allows libraries to build against an agreed upon set\", \" of common APIs,](https://dotnet.microsoft.com/platform/dotnet-standard)\\nensuring they can be used i\", \"n any .NET app. .NET Standard 2.0 is notable because it covers most base\\nclass library functionality\", \" used by most .NET Framework and .NET Core apps. Unfortunately, the\\nearliest version of .NET with su\", \"pport for .NET Standard 2.0 is .NET Framework 4.6.1, and there are a\\nnumber of updates in .NET Frame\", \"work 4.8 that make it a compelling choice for initial upgrades.\\n\\n\\nOne approach to incrementally upgr\", \"ade a .NET Framework 4.5 system layer-by-layer is to first update\\nits class library dependencies to \", \".NET Framework 4.8. Then, modify these libraries to be .NET Standard\\nclass libraries. Use multi-targ\", \"eting and conditional compilation, if necessary. This step can be helpful\\n\\n\\n6 CHAPTER 1 | Introducti\", \"on to porting apps to .NET 7\\n\\n\\nin scenarios where app dependencies require .NET Framework and cannot\", \" easily be ported directly to\\nuse .NET Standard and .NET Core. Since .NET Framework libraries can be\", \" consumed by ASP.NET Core\\n2.1 apps, the next step is to migrate some or all of the web functionality\", \" of the app to ASP.NET Core\\n2.1 (as described in the previous chapter). This is a \\u201cbottom up\\u201d approa\", \"ch, starting with low level class\\nlibrary dependencies and working up to the web app entry point.\\n\\n\\n\", \"Once the app is running on ASP.NET Core 2.1, migrating it to .NET 7 in isolation is relatively\\nstrai\", \"ghtforward. The most likely challenge during this step is updating incompatible dependencies to\\nsupp\", \"ort .NET Core and possibly higher versions of .NET Standard. For apps that don\\u2019t have\\nproblematic de\", \"pendencies on .NET Framework-only libraries, there\\u2019s little reason to upgrade to\\nASP.NET Core 2.1. P\", \"orting directly to ASP.NET Core 7 makes more sense and requires less effort.\\n\\n\\n.NET 7 is the latest \", \"version of .NET and will be supported until six months after the next STS or LTS\\nrelease (scheduled \", \"for November 2023) - so most likely support will last at least until May 2024. Many\\nteams looking to\", \" migrate today will choose to upgrade to .NET 7.\\n\\n\\nInstead of a \\u201cbottom up\\u201d approach, another altern\", \"ative is to start with the web app (or even the entire\\n[solution) and use an automated tool to assis\", \"t with the upgrade. The .NET Upgrade Assistant tool can](https://aka.ms/dotnet-upgrade-assistant)\\nbe\", \" used to help upgrade .NET Framework apps to .NET Core / .NET 7. It automates many of the\\ncommon tas\", \"ks related to upgrading apps, such as modifying project file format, setting appropriate\\ntarget fram\", \"eworks, updating NuGet dependencies, and more.\\n\\n#### **References**\\n\\n\\n  - [What is .NET Standard?](h\", \"ttps://dotnet.microsoft.com/platform/dotnet-standard)\\n\\n  - [Migrate from ASP.NET Core 6.0 to 7.0](ht\", \"tps://docs.microsoft.com/aspnet/core/migration/60-70)\\n\\n  - [Announcing .NET 6 - The Fastest .NET Yet\", \"](https://devblogs.microsoft.com/dotnet/announcing-net-6/)\\n\\n  - [Introducing .NET 5](https://devblog\", \"s.microsoft.com/dotnet/introducing-net-5/)\\n\\n  - [Migrate from ASP.NET Core 3.1 to 6.0 LTS](https://d\", \"ocs.microsoft.com/aspnet/core/migration/31-to-60)\\n\\n  - [.NET Upgrade Assistant tool](https://aka.ms/\", \"dotnet-upgrade-assistant)\\n\\n### Strategies for migrating ASP.NET Web Forms apps\\n\\n\\nThis book offers gu\", \"idance for migrating large ASP.NET MVC and Web API apps to .NET Core. Some of\\nthese ASP.NET apps may\", \" also include Web Forms ( _.aspx_ ) pages that must be addressed. ASP.NET Web\\nForms isn\\u2019t supported \", \"in ASP.NET Core (nor are ASP.NET Web Pages). Typically, the functionality of\\nthese pages must be rew\", \"ritten when porting to ASP.NET Core. There are, however, some strategies\\nyou can apply before or dur\", \"ing such migration to help reduce the overall effort required.\\n\\n\\nWeb Forms will continue to be suppo\", \"rted for quite some time. One option may be to keep this\\nfunctionality in an ASP.NET 4.x app.\\n\\n#### \", \"**Separate business logic and other concerns**\\n\\n\\nThe less code in your ASP.NET Web Forms pages, the \", \"better. When possible, keep business logic and\\nother concerns like data access in separate classes, \", \"ideally in separate class libraries. These class\\nlibraries can be ported to .NET Standard and consum\", \"ed by any ASP.NET Core app.\\n\\n\\n7 CHAPTER 1 | Introduction to porting apps to .NET 7\\n\\n\\n#### **Implemen\", \"t client behavior and web APIs**\\n\\nConsider the choice between implementing logic in Web Forms or in \", \"the browser with the help of API\\ncalls. Favor the latter. Migrating APIs to ASP.NET Core is supporte\", \"d. Client-side behavior should be\\nindependent of the server-side stack your app is using. Using this\", \" approach has the added benefit of\\nproviding a more responsive user experience.\\n\\n#### **Consider Bla\", \"zor**\\n\\n\\nBlazor lets you build interactive web UIs with C# instead of JavaScript. It can run on the s\", \"erver or in\\nthe browser using WebAssembly. ASP.NET Web Forms apps may be ported page-by-page to Blaz\", \"or\\n[apps. For more information on porting Web Forms apps to Blazor, see Blazor for ASP.NET Web Forms\", \"](https://devblogs.microsoft.com/aspnet/blazor-aspnet-webforms-ebook/)\\n[Developers. In addition, man\", \"y Web Forms controls have been ported to Blazor as part of an open-](https://devblogs.microsoft.com/\", \"aspnet/blazor-aspnet-webforms-ebook/)\\n[source community project, Blazor Web Forms Components. With t\", \"hese components, you can more](https://fritzandfriends.github.io/BlazorWebFormsComponents/)\\neasily p\", \"ort Web Forms pages to Blazor even if they use the built-in Web Forms controls.\\n\\n#### **Summary**\\n\\n\\n\", \"Migrating directly from ASP.NET Web Forms to ASP.NET Core isn\\u2019t supported. However, there are\\nstrate\", \"gies to make moving to ASP.NET Core easier. You can migrate your Web Forms functionality to\\nASP.NET \", \"Core successfully by:\\n\\n\\n  - Keeping non-web functionality out of your projects.\\n\\n  - Using web APIs \", \"wherever possible.\\n\\n  - Considering Blazor as an option for a more modern UI.\\n\\n#### **References**\\n\\n\", \"\\n  - [Free e-book: Blazor for ASP.NET Web Forms Developers](https://devblogs.microsoft.com/aspnet/bl\", \"azor-aspnet-webforms-ebook/)\\n\\n  - [Blazor Web Forms Components (Community Project)](https://fritzand\", \"friends.github.io/BlazorWebFormsComponents/)\\n\\n### Deployment strategies\\n\\n\\nOne consideration as you p\", \"lan the migration of your large ASP.NET app to ASP.NET Core is how you\\u2019ll\\ndeploy the new app. With A\", \"SP.NET, deployment options were limited to IIS on Windows. With\\nASP.NET Core, a much wider array of \", \"deployment options is available.\\n\\n#### **Cross-platform options**\\n\\n\\nBecause .NET Core runs on Linux,\", \" you\\u2019ll find some hosting options available that weren\\u2019t a\\nconsideration previously. Linux-based hos\", \"ting may be preferable for the following reasons:\\n\\n\\n  - Your organization has infrastructure or expe\", \"rtise.\\n\\n  - Hosting providers offer attractive features or pricing for Linux-based hosting.\\n\\n\\n.NET C\", \"ore opens the door to these options.\\n\\n\\n8 CHAPTER 1 | Introduction to porting apps to .NET 7\\n\\n\\n#### *\", \"*Cloud native development**\\n\\nMost organizations today are using cloud platforms for at least some of\", \" their software capabilities.\\nWith an app migration to .NET Core, it\\u2019s a good time to consider wheth\", \"er the app should be\\npurposefully written with cloud hosting in mind. Such _cloud native_ apps are b\", \"etter able to apply cloud\\ncapabilities like serverless, microservices, and can be less concerned wit\", \"h the low-level details of how\\nand where they may be deployed.\\n\\n\\n[Learn more about cloud native app \", \"development in this free e-book, Architecting Cloud Native .NET](https://docs.microsoft.com/en-us/do\", \"tnet/architecture/cloud-native/)\\n[Applications for Azure.](https://docs.microsoft.com/en-us/dotnet/a\", \"rchitecture/cloud-native/)\\n\\n#### **Leverage containers**\\n\\n\\nModern apps often leverage containers as \", \"a means of reducing variation between hosting\\nenvironments. By deploying an app to a particular cont\", \"ainer, the container-hosted app will run the\\nsame whether it\\u2019s running on a developer\\u2019s laptop or in\", \" production. As part of a migration to .NET\\nCore, it may make sense to consider whether the app woul\", \"d benefit from deployment via container,\\neither as a full monolith or broken up into multiple smalle\", \"r containerized apps.\\n\\n#### **Side-by-side deployment options**\\n\\n\\nMigrating large .NET Framework app\", \"s to .NET Core often requires a substantial effort. Most\\norganizations will want to be able to break\", \" this effort up in some fashion, so that pieces of the app\\ncan be migrated and deployed in productio\", \"n before the entire migration is complete. Running both\\nthe original ASP.NET app and its newly-migra\", \"ted ASP.NET Core sub-app(s) side by side is a frequently\\ncited goal. This can be achieved through a \", \"number of mechanisms including leveraging IIS routing,\\nwhich is covered in chapter 5. Other options \", \"include leveraging app gateways or cloud design\\n[patterns like backends for frontends to manage sets\", \" of ASP.NET Web APIs and ASP.NET Core API](https://docs.microsoft.com/azure/architecture/patterns/ba\", \"ckends-for-frontends)\\nendpoints.\\n\\n#### **IIS on Windows**\\n\\n\\nYou can continue hosting your apps on II\", \"S running on Windows. This is a fine option for customers\\nwho want to take advantage of ASP.NET Core\", \" features without changing their current deployment\\nmodel. While moving to ASP.NET Core provides mor\", \"e options in terms of how and where to deploy\\nyour apps, it doesn\\u2019t require that you change from the\", \" status quo of using the proven combination of\\nIIS on Windows.\\n\\n#### **Other options on Windows**\\n\\n\\n\", \"You can host apps side-by-side apps on Windows using any combination of Kestrel, HTTP.sys, and IIS\\nh\", \"osts, in addition to Docker containers, if needed. If your app requires a combination of Windows and\", \"\\n[Linux services, hosting on a Windows server with WSL](https://docs.microsoft.com/windows/wsl/about\", \") and/or Linux Docker containers provides a\\nsingle server solution to hosting all parts of the app.\\n\", \"\\n#### **References**\\n\\n\\n  - [Host and deploy ASP.NET Core](https://docs.microsoft.com/aspnet/core/hos\", \"t-and-deploy/)\\n\\n\\n9 CHAPTER 1 | Introduction to porting apps to .NET 7\\n\\n\\n  - [Host ASP.NET Core on Wi\", \"ndows with IIS](https://docs.microsoft.com/aspnet/core/host-and-deploy/iis/)\\n\\n  - [Troubleshooting A\", \"SP.NET Core on Azure App Service and IIS](https://docs.microsoft.com/aspnet/core/test/troubleshoot-a\", \"zure-iis)\\n\\n### Additional migration resources\\n\\n\\nAs you\\u2019re planning and executing your migration from\", \" ASP.NET MVC and/or Web API to ASP.NET\\nCore, there are a number of resources available to help beyon\", \"d this book. Make a note of these and\\nleverage them where appropriate to help you overcome obstacles\", \" you encounter on your migration\\njourney.\\n\\n#### **Official documentation**\\n\\n\\n[The official documenta\", \"tion website, learn.microsoft.com, has the most up-to-date information](https://docs.microsoft.com/)\", \"\\navailable about versions, frameworks, breaking changes, and support options. You\\u2019ll find many links\", \" in\\nthis book to docs articles, but for any problem you\\u2019re facing it\\u2019s often worth at least doing a \", \"quick\\nsearch of the docs to see if there is already information covering the issue and offering a so\", \"lution or\\nworkaround.\\n\\n#### **GitHub**\\n\\n\\nBecause .NET Core is an open-source project, many issues ar\", \"e discovered, reported, discussed, and\\nfixed on GitHub. Microsoft has several GitHub organizations i\", \"n which you\\u2019ll find repositories that may\\nbe helpful. A partial list of these organizations and some\", \" of their public repositories are listed below:\\n\\n\\n  - [Microsoft](https://github.com/microsoft)\\n\\n   \", \"  - [ASP.NET API Versioning](https://github.com/microsoft/aspnet-api-versioning)\\n\\n  - [dotnet](https\", \"://github.com/dotnet)\\n\\n     - [ASP.NET Core](https://github.com/dotnet/aspnetcore)\\n\\n     - [.NET Run\", \"time](https://github.com/dotnet/runtime)\\n\\n     - [Entity Framework Core](https://github.com/dotnet/e\", \"fcore)\\n\\n     - [C# Language](https://github.com/dotnet/csharplang)\\n\\n     - [Docs](https://github.com\", \"/dotnet/docs)\\n\\n     - [Docs Samples](https://github.com/dotnet/samples)\\n\\n     - [Try Convert](https:\", \"//github.com/dotnet/try-convert)\\n\\n     - [.NET Upgrade Assistant tool](https://aka.ms/dotnet-upgrade\", \"-assistant)\\n\\n  - [.NET Architecture Reference Apps](https://github.com/dotnet-architecture)\\n\\n     - \", \"[eShopModernizing](https://github.com/dotnet-architecture/eShopModernizing)\\n\\n     - [eShopOnWeb](htt\", \"ps://github.com/dotnet-architecture/eShopOnWeb)\\n\\n     - [eShopOnContainers](https://github.com/dotne\", \"t-architecture/eShopOnContainers)\\n\\nIf you run into problems with your migration, these GitHub reposi\", \"tories are a good place to report\\nthem. The product teams watch the issues and typically respond qui\", \"ckly to bug reports (though \\u201chow\\nto\\u201d questions may be more appropriately directed to Stack Overflow)\", \".\\n\\n\\n10 CHAPTER 1 | Introduction to porting apps to .NET 7\\n\\n\\n#### **Stack Overflow**\\n\\n[Stack Overflow\", \"](https://stackoverflow.com/) has a wealth of information in the form of previous questions asked an\", \"d answers\\ngiven, with the most helpful answers listed first and marked if they solved the problem. I\", \"n addition to\\nsearching for an existing solution to a problem you may encounter, you can of course a\", \"lso ask a\\nquestion yourself and hope for some response from the .NET community. Don\\u2019t forget you can\", \" narrow\\ndown a search by using tags, and remember to use appropriate tags when you ask questions to\\n\", \"maximize the chances of someone with the experience needed noticing your question.\\n\\n#### **YouTube c\", \"hannels**\\n\\n\\nYouTube has a huge amount of .NET and .NET Core video content, which may include useful \", \"tutorials\\nor walkthroughs covering any scenario you may encounter. Consider searching it separately \", \"if your\\nother efforts to find help online come up short. Here are a few good places to get started:\\n\", \"\\n\\n  - [dotnet](https://www.youtube.com/dotnet)\\n\\n  - [Visual Studio](https://www.youtube.com/visualst\", \"udio)\\n\\n#### **Twitter, Gitter, Slack, and other community channels**\\n\\n\\n[You\\u2019ll find many other ways \", \"to connect with .NET developers on the .NET Community page. You can](https://dotnet.microsoft.com/pl\", \"atform/community)\\n[also join the DotNetEvolution Discord server. Additionally, many product teams an\", \"d team members](https://aka.ms/dotnet-discord)\\nare on Twitter as well as in various other communitie\", \"s. You can follow and communicate with the\\n[author of this book on Twitter as well.](https://twitter\", \".com/ardalis)\\n\\n#### **References**\\n\\n\\n  - [Overview of porting from .NET Framework to .NET Core](http\", \"s://docs.microsoft.com/en-us/dotnet/core/porting/)\\n\\n  - [.NET Upgrade Assistant tool](https://aka.ms\", \"/dotnet-upgrade-assistant)\\n\\n  - [Migrate from ASP.NET to ASP.NET Core](https://docs.microsoft.com/en\", \"-us/dotnet/core/porting/)\\n\\n  - [.NET Community Resources](https://dotnet.microsoft.com/platform/comm\", \"unity)\\n\\n\\n11 CHAPTER 1 | Introduction to porting apps to .NET 7\\n\\n\\n**CHAPTER**\\n# 2\\n\\n## Architectural d\", \"ifferences between ASP.NET MVC and ASP.NET Core\\n\\n\\nThere are many architectural differences between A\", \"SP.NET MVC on .NET Framework and ASP.NET\\nCore. It\\u2019s important to have a broad understanding of these\", \" differences as teams evaluate the work\\ninvolved in porting their ASP.NET MVC apps to ASP.NET Core. \", \"This chapter looks at each of the ways\\nin which ASP.NET Core differs substantially from ASP.NET MVC.\", \"\\n\\n### Breaking changes\\n\\n\\n[.NET Core is a cross-platform rewrite of .NET Framework. There are many br\", \"eaking changes between](https://docs.microsoft.com/en-us/dotnet/core/compatibility/fx-core)\\n[the two\", \" frameworks. The following sections identify specific differences between how ASP.NET MVC](https://d\", \"ocs.microsoft.com/en-us/dotnet/core/compatibility/fx-core)\\nand ASP.NET Core apps are designed and de\", \"veloped. Take care to also examine the documentation to\\ndetermine which framework libraries you\\u2019re u\", \"sing that may need to change. In many cases, a\\nreplacement NuGet package exists to fill in any gaps \", \"left between .NET Framework and .NET Core. In\\nrare cases, you may need to find a third-party solutio\", \"n or implement new custom code to address\\nincompatibilities.\\n\\n### App startup differences between AS\", \"P.NET MVC and ASP.NET Core\\n\\n\\nASP.NET MVC apps lived entirely within Internet Information Server (IIS\", \"), the primary web server\\navailable on Windows operating systems. Unlike ASP.NET MVC, ASP.NET Core a\", \"pps are executable\\napps. You can run them from the command line, using dotnet run. They have an entr\", \"y point method\\nlike all C# programs, typically public static void Main() or a similar variation (per\", \"haps with arguments\\nor async support). This is perhaps the biggest architectural difference between \", \"ASP.NET Core and\\nASP.NET MVC, and is one of several differences that allows ASP.NET Core to run on n\", \"on-Windows\\nsystems.\\n\\n\\n12 CHAPTER 2 | Architectural differences between ASP.NET MVC and ASP.NET Core\\n\", \"\\n\\n#### **ASP.NET MVC Startup**\\n\\nHosted within IIS, ASP.NET apps rely on IIS to instantiate certain o\", \"bjects and call certain methods\\nwhen a request arrives. ASP.NET creates an instance of the _Global.a\", \"sax_ file\\u2019s class, which derives from\\nHttpApplication. When the first request is received, before ha\", \"ndling the request itself, ASP.NET calls\\nthe Application_Start method in the _Global.asax_ file\\u2019s cl\", \"ass. Any logic that needs to run when the\\nASP.NET MVC app begins can be added to this method.\\n\\n\\n[Man\", \"y NuGet packages for ASP.NET MVC and Web API use the WebActivator](https://github.com/davidebbo/WebA\", \"ctivator) package to let them run\\nsome code during app startup. By convention, this code would typic\", \"ally be added to an _App_Start_\\nfolder and would be configured via attribute to run either immediate\", \"ly before or just after\\nApplication_Start.\\n\\n\\n[It\\u2019s also possible to use the Open Web Interface for .\", \"NET (OWIN) and Project Katana with ASP.NET](https://docs.microsoft.com/aspnet/aspnet/overview/owin-a\", \"nd-katana/getting-started-with-owin-and-katana)\\n[MVC. When doing so, the app will include a](https:/\", \"/docs.microsoft.com/aspnet/aspnet/overview/owin-and-katana/getting-started-with-owin-and-katana) _St\", \"artup.cs_ file that is responsible for setting up request\\nmiddleware in a way that\\u2019s very similar to\", \" how ASP.NET Core behaves.\\n\\n\\nIf you need to run code when your ASP.NET MVC app starts up, it will ty\", \"pically use one of these\\napproaches.\\n\\n#### **ASP.NET Core Startup**\\n\\n\\nAs noted previously, ASP.NET C\", \"ore apps are standalone programs. As such, they typically include a\\n_Program.cs_ file containing the\", \" entry point for the app. A typical example of this file is shown in Figure\\n2-1. Notice that in .NET\", \" 7, this file is streamlined by the use of implicit using statements and top-level\\nstatements, elimi\", \"nating the need for a lot of \\u201cboiler plate\\u201d code.\\n\\n\\n_Figure 2-1. A typical ASP.NET Core Program.cs f\", \"ile._\\n\\n\\n13 CHAPTER 2 | Architectural differences between ASP.NET MVC and ASP.NET Core\\n\\n\\nThe code sho\", \"wn in Figure 2-1 uses a builder to configure the host and its services. Then, it creates the\\nrequest\", \" pipeline for the app, which controls how every request to the app is handled.\\n\\n\\nPrevious versions o\", \"f .NET would use a separate _Startup.cs_ file, referenced by _Program.cs_ . This approach\\nis still s\", \"upported in .NET 7, but is no longer the default approach.\\n\\n\\nIn addition to code related to configur\", \"ing the app\\u2019s services and request pipeline, apps may have\\nother code that must run when the app beg\", \"ins. Such code is typically placed in _Program.cs_ or\\n[registered as an IHostedService, which will b\", \"e started by the generic host when the app starts.](https://docs.microsoft.com/aspnet/core/fundament\", \"als/host/generic-host)\\n\\n\\nThe IHostedService interface just exposes two methods, StartAsync and StopA\", \"sync. You register the\\ninterface when configuring the app\\u2019s services and the host does the rest, cal\", \"ling the StartAsync\\nmethod before the app starts up.\\n\\n#### **Porting considerations**\\n\\n\\nTeams lookin\", \"g to migrate their apps from ASP.NET MVC to ASP.NET Core need to identify what code\\nis being run whe\", \"n their app starts up and determine the appropriate location for such code in their\\nASP.NET Core app\", \". For custom code needed to run when the app starts up, especially async code, the\\nrecommended appro\", \"ach is typically to put such code into IHostedService implementations.\\n\\n#### **References**\\n\\n\\n  - [A\", \"SP.NET Application Life Cycle Overview for IIS 7](https://docs.microsoft.com/previous-versions/aspne\", \"t/bb470252(v=vs.100))\\n\\n  - [ASP.NET Application Life Cycle Overview for IIS 5 and 6](https://docs.mi\", \"crosoft.com/previous-versions/aspnet/ms178473(v=vs.100))\\n\\n  - [Getting Started with OWIN and Katana]\", \"(https://docs.microsoft.com/aspnet/aspnet/overview/owin-and-katana/getting-started-with-owin-and-kat\", \"ana)\\n\\n  - [WebActivator](https://github.com/davidebbo/WebActivator)\\n\\n  - [App Startup in ASP.NET Cor\", \"e](https://docs.microsoft.com/aspnet/core/fundamentals/startup)\\n\\n  - [.NET Generic Host in ASP.NET C\", \"ore](https://docs.microsoft.com/aspnet/core/fundamentals/host/generic-host)\\n\\n  - [IHostedService](ht\", \"tps://docs.microsoft.com/en-us/dotnet/architecture/microservices/multi-container-microservice-net-ap\", \"plications/background-tasks-with-ihostedservice)\\n\\n### Hosting differences between ASP.NET MVC and AS\", \"P.NET Core\\n\\n\\nASP.NET MVC apps are hosted in IIS, and may rely on IIS configuration for their behavio\", \"r. This often\\n[includes IIS modules. As part of reviewing an app to prepare to port it from ASP.NET \", \"MVC to ASP.NET](https://docs.microsoft.com/iis/get-started/introduction-to-iis/iis-modules-overview)\", \"\\nCore, teams should identify which modules, if any, they\\u2019re using from the list of IIS Modules insta\", \"lled\\non their server.\\n\\n\\n[ASP.NET Core apps can run on a number of different servers. The default cro\", \"ss platform server,](https://docs.microsoft.com/aspnet/core/fundamentals/servers/)\\nKestrel, is a goo\", \"d default choice. Apps running in Kestrel can be hosted by IIS, running in a separate\\nprocess. On Wi\", \"ndows, apps can also run in process on IIS or using HTTP.sys. Kestrel is generally\\nrecommended for b\", \"est performance. HTTP.sys can be used in scenarios where the app is exposed to\\nthe Internet and requ\", \"ired capabilities are supported by HTTP.sys but not Kestrel.\\n\\n\\n14 CHAPTER 2 | Architectural differen\", \"ces between ASP.NET MVC and ASP.NET Core\\n\\n\\nKestrel does not have an equivalent to IIS modules (thoug\", \"h apps hosted in IIS can still take advantage\\n[of IIS modules). To achieve equivalent behavior, midd\", \"leware](https://docs.microsoft.com/aspnet/core/fundamentals/middleware/) configured in the ASP.NET C\", \"ore app itself\\nis typically used.\\n\\n#### **References**\\n\\n\\n  - [IIS Modules](https://docs.microsoft.co\", \"m/iis/get-started/introduction-to-iis/iis-modules-overview)\\n\\n  - [ASP.NET Core Middleware](https://d\", \"ocs.microsoft.com/aspnet/core/fundamentals/middleware/)\\n\\n  - [ASP.NET Core Servers](https://docs.mic\", \"rosoft.com/aspnet/core/fundamentals/servers/)\\n\\n### Serve static files in ASP.NET MVC and ASP.NET Cor\", \"e\\n\\n\\nMost web apps involve a combination of server-side logic and static files that must be sent to t\", \"he\\nclient as-is. How should your migration from ASP.NET MVC to ASP.NET Core handle serving static\\nfi\", \"les?\\n\\n#### **Host static files in ASP.NET MVC**\\n\\n\\nASP.NET MVC apps, hosted by IIS, typically host st\", \"atic files directly from the app. ASP.NET MVC\\nsupports placing static files side by side with files \", \"that should be kept private on the server. IIS and\\nASP.NET require explicitly restricting certain fi\", \"les or file extensions from being served from the folder\\nin which an ASP.NET app is hosted.\\n\\n\\n[For m\", \"any static files, using a content delivery network (CDN) is a good practice. Static content hosting]\", \"(https://docs.microsoft.com/azure/architecture/patterns/static-content-hosting)\\nallows better perfor\", \"mance while reducing load and bandwidth from app servers.\\n\\n#### **Host static files in ASP.NET Core*\", \"*\\n\\n\\nIt may be surprising, but ASP.NET Core doesn\\u2019t have built-in support for static files. This feat\", \"ure that\\nhas always existed as just a part of ASP.NET, enabled by IIS, isn\\u2019t intrinsic to ASP.NET Co\", \"re or its\\n[Kestrel web server. To serve static files from an ASP.NET Core app, you must configure st\", \"atic files](https://docs.microsoft.com/aspnet/core/fundamentals/static-files)\\n[middleware.](https://\", \"docs.microsoft.com/aspnet/core/fundamentals/static-files)\\n\\n\\nWith static files middleware configured,\", \" an ASP.NET Core app will serve all files located in a certain\\nfolder (typically _/wwwroot_ ). No ot\", \"her files in the app or project folder are at risk of being accidentally\\nexposed by the server. No s\", \"pecial restrictions based on file names or extensions need to be\\nconfigured, as is the case with IIS\", \". Instead, developers explicitly choose to expose files publicly when\\nthey place them in the _wwwroo\", \"t_ folder. By default, files outside of this folder aren\\u2019t shared.\\n\\n\\nBecause support for static file\", \"s uses middleware, any other middleware can be applied as part of the\\nsame request pipeline. Example\", \"s of middleware include authentication, caching, and compression.\\n\\n\\nOf course, CDNs remain a good ch\", \"oice for ASP.NET Core apps for all the same reasons they\\u2019re used in\\nASP.NET MVC apps. As part of pre\", \"paring to migrate to .NET Core, if there are benefits your app could\\nrealize from using a CDN, it wo\", \"uld be good to move static files to a CDN before migrating to .NET\\nCore. Doing so reduces the migrat\", \"ion effort\\u2019s overall scope for static assets.\\n\\n\\n15 CHAPTER 2 | Architectural differences between ASP\", \".NET MVC and ASP.NET Core\\n\\n\\n#### **References**\\n\\n\\n  - [Static content hosting](https://docs.microsof\", \"t.com/azure/architecture/patterns/static-content-hosting)\\n\\n  - [Static files in ASP.NET Core](https:\", \"//docs.microsoft.com/aspnet/core/fundamentals/static-files)\\n\\n### Dependency injection differences be\", \"tween ASP.NET MVC and ASP.NET Core\\n\\n\\nAlthough dependency injection (DI) isn\\u2019t built into ASP.NET MVC\", \" or Web API, many apps enable it by\\nadding a NuGet package with an inversion of control (IOC) contai\", \"ner. These are sometimes referred to\\nas DI containers, for dependency injection (or inversion). Some\", \" of the most popular containers used in\\nASP.NET MVC apps include:\\n\\n\\n  - [Autofac](https://www.autofa\", \"c.org/)\\n\\n  - [Unity](https://unitycontainer.github.io/)\\n\\n  - [Ninject](http://www.ninject.org/)\\n\\n  -\", \" [StructureMap](http://structuremap.github.io/) _(deprecated)_\\n\\n  - [Castle Windsor](http://www.cast\", \"leproject.org/projects/windsor/)\\n\\n\\nIf your ASP.NET MVC app isn\\u2019t using DI, you will probably want to\", \" investigate the built-in support for\\nDI in ASP.NET Core. DI promotes loose coupling of modules in y\", \"our app and enables better testability\\n[and adherence to principles like SOLID.](https://www.weeklyd\", \"evtips.com/episodes/047)\\n\\n\\nIf your app does use DI, then probably your best course of action is to s\", \"ee if the container you\\u2019re\\nusing supports ASP.NET Core. If so, you may be able to continue using it \", \"and your custom\\nconfiguration rules describing your type mappings and lifetimes.\\n\\n\\nEither way, you s\", \"hould consider using the built-in support for DI that ships with ASP.NET Core, as it\\nmay meet your a\", \"pp\\u2019s needs.\\n\\n#### **Dependency injection in ASP.NET Core**\\n\\n\\nASP.NET Core assumes apps will use DI. \", \"It\\u2019s not just built into the framework, but is required in order\\nto bring support for framework feat\", \"ures into your ASP.NET Core apps. In app startup, calls are made\\nto configure services using the bui\", \"lder.Services property of the web host builder. This property works\\nwith the application\\u2019s DI contai\", \"ner (service collection/service provider) and is used to create and inject\\nservice dependencies with\", \"in the app. Built-in ASP.NET Core features like Entity Framework Core,\\nIdentity, and even MVC are br\", \"ought into the app by configuring them as services during application\\nstartup.\\n\\n\\nIn addition to usin\", \"g the default implementation, apps can still use custom containers. The\\n[documentation covers how to\", \" replace the default service container.](https://docs.microsoft.com/en-us/dotnet/core/extensions/dep\", \"endency-injection-guidelines#default-service-container-replacement)\\n\\n\\nDI is fundamental to ASP.NET C\", \"ore. If your team isn\\u2019t already well-versed in this practice, you\\u2019ll want\\nto understand it before po\", \"rting your app.\\n\\n\\n16 CHAPTER 2 | Architectural differences between ASP.NET MVC and ASP.NET Core\\n\\n\\n##\", \"## **References**\\n\\n\\n  - [Dependency Injection in .NET](https://docs.microsoft.com/en-us/dotnet/core/\", \"extensions/dependency-injection)\\n\\n  - [Dependency Injection in ASP.NET Core](https://docs.microsoft.\", \"com/aspnet/core/fundamentals/dependency-injection)\\n\\n### Compare middleware to modules and handlers\\n\\n\", \"\\nIf your existing ASP.NET MVC or Web API app uses OWIN/Katana, you\\u2019re most likely already familiar\\nw\", \"ith the concept of middleware and porting it to ASP.NET Core should be fairly straightforward.\\nHowev\", \"er, most ASP.NET apps rely on HTTP modules and HTTP handlers instead of middleware.\\nMigrating these \", \"to ASP.NET Core requires extra effort.\\n\\n#### **ASP.NET modules and handlers**\\n\\n\\n[HTTP modules and HT\", \"TP handlers are an integral part of the ASP.NET architecture. While a request is](https://docs.micro\", \"soft.com/troubleshoot/aspnet/http-modules-handlers)\\nbeing processed, each request is processed by mu\", \"ltiple HTTP modules (for example, the\\nauthentication module and the session module) and is then proc\", \"essed by a single HTTP handler. After\\nthe handler has processed the request, the request flows back \", \"through the HTTP modules.\\n\\n\\nIf your app is using custom HTTP modules or HTTP handlers, you\\u2019ll need a\", \" plan to migrate them to\\nASP.NET Core. The most likely replacement in ASP.NET Core is middleware.\\n\\n#\", \"### **ASP.NET Core middleware**\\n\\n\\nASP.NET Core defines a request pipeline in each app\\u2019s Configure me\", \"thod. This request pipeline\\ndefines how an incoming request is handled by the app, with each method \", \"in the pipeline calling the\\nnext method until eventually a method terminates, and the chain of _midd\", \"leware_ terminates and\\nreturns back up the stack. Middleware can target all requests, or can be conf\", \"igured to only map to\\ncertain requests based on the requested path or other factors. It can be confi\", \"gured wholly in the\\nConfigure method of an app, or implemented in a separate class.\\n\\n\\nBehavior in an\", \" ASP.NET MVC app that uses HTTP modules is probably best suited to custom\\n[middleware. Custom HTTP h\", \"andlers can be replaced with custom routes or endpoints that respond to](https://docs.microsoft.com/\", \"aspnet/core/fundamentals/middleware/?preserve-view=true&view=aspnetcore-3.1)\\nthe same path.\\n\\n#### **\", \"Accessing HttpContext**\\n\\n\\nMany .NET apps reference the current request\\u2019s context through HttpContext\", \".Current. This static\\naccess can be a common source of problems with testing and other code usage ou\", \"tside of individual\\nrequests. When building ASP.NET Core apps, access to the current HttpContext sho\", \"uld be provided as\\na method parameter on middleware, as this sample demonstrates:\\n\\n\\n17 CHAPTER 2 | A\", \"rchitectural differences between ASP.NET MVC and ASP.NET Core\\n\\n\\nSimilarly, ASP.NET Core filters pass\", \" a context argument to their methods, from which the current\\nHttpContext can be accessed:\\n\\n\\nIf you h\", \"ave components or services that require access to HttpContext, rather than using a static call\\nlike \", \"HttpContext.Current you should instead use constructor dependency injection and the\\n[IHttpContextAcc\", \"essor](https://docs.microsoft.com/dotnet/api/microsoft.aspnetcore.http.ihttpcontextaccessor) interfa\", \"ce:\\n\\n\\nThis approach eliminates the static coupling of the method to the current context while provid\", \"ing\\naccess in a testable fashion.\\n\\n#### **References**\\n\\n\\n  - [ASP.NET HTTP modules and HTTP handlers\", \"](https://docs.microsoft.com/troubleshoot/aspnet/http-modules-handlers)\\n\\n  - [ASP.NET Core middlewar\", \"e](https://docs.microsoft.com/aspnet/core/fundamentals/middleware/?preserve-view=true&view=aspnetcor\", \"e-3.1)\\n\\n### Configuration differences between ASP.NET MVC and ASP.NET Core\\n\\n\\nHow configuration value\", \"s are stored and read changed dramatically between ASP.NET and ASP.NET\\nCore.\\n\\n\\n18 CHAPTER 2 | Archit\", \"ectural differences between ASP.NET MVC and ASP.NET Core\\n\\n\\n#### **ASP.NET MVC configuration**\\n\\nIn AS\", \"P.NET apps, configuration uses the built-in .NET configuration files, _web.config_ in the app folder\", \"\\nand _machine.config_ on the server. Most ASP.NET MVC and Web API apps store their settings in the\\nc\", \"onfiguration file\\u2019s appSettings or connectionStrings elements. Some also use custom configuration\\nse\", \"ctions that can be mapped to a settings class.\\n\\n\\nConfiguration in a .NET Framework app is accessed u\", \"sing the\\nSystem.Configuration.ConfigurationManager class. Unfortunately, this class provides static \", \"access to\\nthe configuration elements. As a result, very few ASP.NET MVC apps tend to abstract access\", \" to their\\nconfiguration settings or inject them where needed. Instead, most .NET Framework apps tend\", \" to\\ndirectly access the configuration system anywhere the app needs to use a setting.\\n\\n\\nTypical ASP.\", \"NET MVC configuration access:\\n\\n#### **ASP.NET Core configuration**\\n\\n\\nIn ASP.NET Core apps, configura\", \"tion is, itself, configurable. However, most apps use a set of defaults\\nprovided as part of the stan\", \"dard project templates and the ConfigureWebHostDefaults method used\\nin them. The default settings us\", \"e JSON formatted files, with the ability to override settings in the base\\n_appsettings.json_ file wi\", \"th environment-specific files like _appsettings.Development.json_ . Additionally, the\\ndefault config\", \"uration system further overrides all file-based settings with any environment variable\\nthat exists f\", \"or the same named setting. This is useful in many scenarios and is especially useful when\\ndeploying \", \"to a hosting environment, since it eliminates the need to worry about whether deploying\\nconfiguratio\", \"n files will accidentally overwrite important production configuration settings.\\nConfiguration value\", \"s can also be provided as command line arguments.\\n\\n\\nAccessing configuration values can be done in ma\", \"ny ways in .NET Core. Because dependency injection\\nis built into .NET Core, configuration values are\", \" generally accessed through an interface that is\\n[injected into classes that need them. This can inv\", \"olve passing a interface like IConfiguration, but](https://docs.microsoft.com/dotnet/api/microsoft.e\", \"xtensions.configuration.iconfiguration)\\n[usually it\\u2019s better to pass just the settings required by t\", \"he class using the options pattern.](https://docs.microsoft.com/aspnet/core/fundamentals/configurati\", \"on/options)\\n\\n\\nFigure 2-2 shows how to pass IConfiguration into a Razor Page and access configuration\", \" settings from\\nit:\\n\\n\\n19 CHAPTER 2 | Architectural differences between ASP.NET MVC and ASP.NET Core\\n\\n\", \"\\n_Figure 2-2. Accessing configuration values with IConfiguration._\\n\\n\\n[Using the options pattern, set\", \"tings access is similar but is strongly typed and more specific to the](https://docs.microsoft.com/e\", \"n-us/dotnet/core/extensions/options)\\nsetting(s) needed by the consuming class, as Figure 2-3 demonst\", \"rates.\\n\\n\\n_Figure 2-3. Using the options pattern in ASP.NET Core._\\n\\n\\nFor the options pattern to work,\", \" the options type must be configured in ConfigureServices when the\\napp starts up:\\n\\n#### **Migrate co\", \"nfiguration**\\n\\n\\nWhen considering how to port an app\\u2019s configuration settings from .NET Framework to \", \".NET Core, the\\nfirst step is to identify all of the configuration settings that are being used. Most\", \" of these will be in the\\n_web.config_ file in the app\\u2019s root folder, but some apps expect settings t\", \"o be found in the shared\\n_machine.config_ file as well. These settings will include elements of the \", \"appSettings element, the\\nconnectionStrings element, and any custom configuration elements as well. I\", \"n .NET Core, all of these\\nsettings are typically stored in the _appsettings.json_ file.\\n\\n\\nOnce all s\", \"ettings in the config files have been cataloged, the next step should be to identify where\\nand how t\", \"he settings are used in the app itself. If some settings aren\\u2019t being used, these can probably\\nbe om\", \"itted from the migration. For each setting, note all of the places it\\u2019s being used so you can be\\nsur\", \"e you don\\u2019t miss any when you migrate the code.\\n\\n\\n20 CHAPTER 2 | Architectural differences between A\", \"SP.NET MVC and ASP.NET Core\\n\\n\\nIf you\\u2019re still maintaining the ASP.NET app, it may be helpful to avoi\", \"d static references to\\nConfigurationManager and replace them with access through interfaces. This wi\", \"ll ease the transition\\nto ASP.NET Core\\u2019s configuration system. In general, static access to external\", \" resources makes code\\nharder to test and maintain, so be on the lookout for anywhere else the app ma\", \"y be following this\\npattern.\\n\\n#### **References**\\n\\n\\n  - [Configuration in ASP.NET Core](https://docs\", \".microsoft.com/aspnet/core/fundamentals/configuration/)\\n\\n  - [Options pattern in ASP.NET Core](https\", \"://docs.microsoft.com/aspnet/core/fundamentals/configuration/options)\\n\\n  - [Migrate configuration to\", \" ASP.NET Core](https://docs.microsoft.com/aspnet/core/migration/configuration)\\n\\n  - [Refactoring Sta\", \"tic Config Access](https://ardalis.com/refactoring-static-config-access/)\\n\\n### Routing differences b\", \"etween ASP.NET MVC and ASP.NET Core\\n\\n\\nRouting is responsible for mapping incoming browser requests t\", \"o particular controller actions (or\\nRazor Pages handlers). This section covers how routing differs b\", \"etween ASP.NET MVC (and Web API)\\nand ASP.NET Core (MVC, Razor Pages, and otherwise).\\n\\n#### **Routing\", \" in ASP.NET MVC and Web API**\\n\\n\\nASP.NET MVC offers two approaches to routing:\\n\\n\\n1. The route table, \", \"which is a collection of routes that can be used to match incoming requests\\nto controller actions.\\n\\n\", \"2. Attribute routing, which performs the same function but is achieved by decorating the actions\\nthe\", \"mselves, rather than editing a global route table.\\n\\n#### **Route table**\\n\\n\\nThe route table is config\", \"ured when the app starts up. Typically, a static method call is used to\\nconfigure the global route c\", \"ollection, like so:\\n\\n\\n21 CHAPTER 2 | Architectural differences between ASP.NET MVC and ASP.NET Core\\n\", \"\\n\\nIn the preceding code, the route table is managed by the RouteCollection type, which is used to ad\", \"d\\nnew routes with MapRoute. Routes are named and include a route string, which can include\\nparameter\", \"s for controllers, actions, areas, and other placeholders. If an app follows a standard\\nconvention, \", \"most of its actions can be handled by this single default route, with any exceptions to this\\nconvent\", \"ion configured using additional routes.\\n\\n\\n**Attribute routing in ASP.NET MVC**\\n\\n\\nRoutes that are def\", \"ined with their actions may be easier to discover and reason about than routes\\ndefined in an externa\", \"l location. Using attribute routing, an individual action method can have its route\\ndefined with a [\", \"Route] attribute:\\n\\n\\n[Attribute routing in ASP.NET MVC 5 also supports defaults and prefixes, which c\", \"an be added at the](https://devblogs.microsoft.com/aspnet/attribute-routing-in-asp-net-mvc-5/)\\ncontr\", \"oller level (and which are applied to all actions within that controller). Refer to the\\ndocumentatio\", \"n for details.\\n\\n\\nSetting up attribute routing requires adding one line to the default route table co\", \"nfiguration:\\n\\n```\\nroutes.MapMvcAttributeRoutes();\\n\\n```\\n\\nAttribute routing can take advantage of rout\", \"e constraints, both built-in and custom, and supports\\nnamed routes and areas using the [RouteArea] a\", \"ttribute. If your app uses areas, you\\u2019ll need to\\nconfigure support for them in your route registrati\", \"on code by adding one more line:\\n\\n```\\nroutes.MapMvcAttributeRoutes();\\n\\nAreaRegistration.RegisterAllA\", \"reas();\\n\\n```\\n\\n**Attribute routing in ASP.NET Web API 2**\\n\\n\\n[Attribute routing in ASP.NET Web API 2 i\", \"s similar to routing in ASP.NET MVC 5, with minor differences.](https://docs.microsoft.com/aspnet/we\", \"b-api/overview/web-api-routing-and-actions/attribute-routing-in-web-api-2)\\nConfiguring Web API 2 is \", \"typically done in its own class, which is called during app startup. Attribute\\nrouting configuration\", \" is handled in this class:\\n\\n\\n22 CHAPTER 2 | Architectural differences between ASP.NET MVC and ASP.NE\", \"T Core\\n\\n\\nAs shown in the preceding code, attribute routing may be combined with convention-based rou\", \"ting\\nin Web API apps.\\n\\n\\n[In addition to attribute routing, ASP.NET Web API chooses which action to c\", \"all](https://docs.microsoft.com/aspnet/web-api/overview/web-api-routing-and-actions/routing-and-acti\", \"on-selection) based on the HTTP\\nmethod (for example, GET or POST), the {action} placeholder in a rou\", \"te (if any), and parameters of the\\naction. In many cases, the name of the action will help determine\", \" whether it\\u2019s matched, since prefixing\\nthe action name with \\u201cGet\\u201d or \\u201cPost\\u201d is used to match the app\", \"ropriate HTTP method to it.\\nAlternatively, actions can be decorated with an appropriate HTTP method \", \"attribute, like [HttpGet],\\nallowing the use of action names that aren\\u2019t prefixed with an HTTP method\", \".\\n\\n\\nGiven the above controller, an HTTP GET request to localhost:123/products/ matches the GetAll\\nac\", \"tion. An HTTP GET request to localhost:123/products?name=ardalis matches the\\nFindProductsByName acti\", \"on.\\n\\n#### **Routing in .NET 7**\\n\\n\\nIn ASP.NET Core, routing is handled by routing middleware, which m\", \"atches the URLs of incoming\\nrequests to actions or other endpoints. Controller actions are either co\", \"nventionally routed or\\nattribute-routed. Conventional routing is similar to the route table approach\", \" used in ASP.NET MVC\\nand Web API. Whether you\\u2019re using conventional, attribute, or both, you need to\", \" configure your app\\nto use the routing middleware. To use the middleware, add the following code to \", \"your _Program.cs_ file:\\n\\n```\\napp.UseRouting();\\n\\n```\\n\\n**Conventional routing**\\n\\n\\nWith conventional ro\", \"uting, you set up one or more conventions that will be used to match incoming\\nURLs to _endpoints_ in\", \" the app. In ASP.NET Core, these endpoints may be controller actions, like in\\nASP.NET MVC or Web API\", \". The endpoints could also be Razor Pages, Health Checks, or SignalR hubs.\\nAll of these routable fea\", \"tures are configured in a similar fashion using endpoints:\\n\\n\\n23 CHAPTER 2 | Architectural difference\", \"s between ASP.NET MVC and ASP.NET Core\\n\\n\\nThe preceding code is used (in addition to UseRouting) to c\", \"onfigure various endpoints, including\\nHealth Checks, controllers, and Razor Pages. For controllers, \", \"the above configuration specifies a\\ndefault routing convention, which is the fairly standard {contro\", \"ller}/{action}/{id?} pattern that\\u2019s been\\nrecommended since the first versions of ASP.NET MVC.\\n\\n\\n**At\", \"tribute routing**\\n\\n\\nAttribute routing in ASP.NET Core is the preferred approach for configuring rout\", \"ing in controllers. If\\nyou\\u2019re building APIs, the [ApiController] attribute should be applied to your\", \" controllers. Among other\\nthings, this attribute requires the use of attribute routing for actions i\", \"n such controller classes.\\n\\n\\nAttribute routing in ASP.NET Core behaves similarly in ASP.NET MVC and \", \"Web API. In addition to\\nsupporting the [Route] attribute, however, route information can also be spe\", \"cified as part of the HTTP\\nmethod attribute:\\n\\n\\nAs with previous versions, you can specify a default \", \"route with placeholders, and add this at the\\ncontroller class level or even on a base class. You use\", \" the same [Route] attribute for all of these cases.\\nFor example, a base API controller class might l\", \"ook like this:\\n\\n\\nUsing this attribute, classes inheriting from this type would route URLs to actions\", \" based on the\\ncontroller name, action name, and an optional integer id parameter.\\n\\n#### **References\", \"**\\n\\n\\n  - [ASP.NET MVC Routing Overview](https://docs.microsoft.com/aspnet/mvc/overview/older-version\", \"s-1/controllers-and-routing/asp-net-mvc-routing-overview-cs)\\n\\n  - [Attribute Routing in ASP.NET MVC \", \"5](https://devblogs.microsoft.com/aspnet/attribute-routing-in-asp-net-mvc-5/)\\n\\n  - [Attribute routin\", \"g in ASP.NET Web API 2](https://docs.microsoft.com/aspnet/web-api/overview/web-api-routing-and-actio\", \"ns/attribute-routing-in-web-api-2)\\n\\n  - [Routing and Action Selection in ASP.NET Web API](https://do\", \"cs.microsoft.com/aspnet/web-api/overview/web-api-routing-and-actions/routing-and-action-selection)\\n\\n\", \"  - [Routing in ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/routing)\\n\\n  - [Rou\", \"ting to controller actions in ASP.NET Core MVC](https://docs.microsoft.com/aspnet/core/mvc/controlle\", \"rs/routing)\\n\\n\\n24 CHAPTER 2 | Architectural differences between ASP.NET MVC and ASP.NET Core\\n\\n\\n### Lo\", \"gging differences between ASP.NET MVC and ASP.NET Core\\n\\nApplication logging provides important diagn\", \"ostic information, especially for apps running in\\nproduction. ASP.NET Core introduces a new system f\", \"or adding standardized logging to any app.\\nExisting ASP.NET MVC and Web API apps most likely use thi\", \"rd-party logging solutions, which likely\\ncontinue to be supported on ASP.NET Core.\\n\\n#### **ASP.NET M\", \"VC logging**\\n\\n\\nThere\\u2019s no built-in logging solution in ASP.NET MVC and Web API apps. Instead, most a\", \"pps use third[party logging solutions like log4net,](https://www.nuget.org/packages/log4net/) [NLog,\", \" or Serilog. Many teams also choose to roll their own](https://www.nuget.org/packages/NLog/)\\nlogging\", \" solution. Logging frameworks typically support multiple \\u201csinks\\u201d (or targets or appenders) for\\nlog o\", \"utput, such as text files, databases, or even emails. They use configuration to determine which\\nleve\", \"ls of log messages from which parts of the system are routed to different sinks. When considering\\nho\", \"w to migrate an app\\u2019s logging to .NET Core, review how logging is performed and configured in the\\nap\", \"p.\\n\\n#### **ASP.NET Core logging**\\n\\n\\n[In ASP.NET Core, logging is a built-in feature that can be conf\", \"igured and extended when the app](https://docs.microsoft.com/aspnet/core/fundamentals/logging/)\\nstar\", \"ts up. Third-party loggers, including those mentioned above, can be integrated with ASP.NET Core\\nto \", \"enhance its functionality.\\n\\n\\nASP.NET Core logging uses categories and levels to control what is logg\", \"ed and how. Classes typically\\nuse instances of the ILogger<T> interface, with the class\\u2019s type used \", \"as the generic T type. In this\\nscenario, the class\\u2019s fully qualified name is used as the category. L\", \"oggers can also be created with a\\ncustom category using an ILoggerFactory. Log levels range from the\", \" most detailed, Trace, to the most\\nimportant, Critical. Using configuration, apps can specify what m\", \"inimum level of logging should be\\nincluded on a per-category (with wildcards) basis.\\n\\n\\nA typical log\", \"ging configuration could log Information and above information by default, but only\\nWarning or above\", \" from Microsoft-prefixed categories:\\n\\n\\n[Support for logging in ASP.NET Core is extensive and flexibl\", \"e. For more detailed information, refer to](https://docs.microsoft.com/aspnet/core/fundamentals/logg\", \"ing/)\\n[the docs.](https://docs.microsoft.com/aspnet/core/fundamentals/logging/)\\n\\n\\n25 CHAPTER 2 | Arc\", \"hitectural differences between ASP.NET MVC and ASP.NET Core\\n\\n\\n#### **Migrate logging**\\n\\nHow you migr\", \"ate your .NET Framework app\\u2019s logging to .NET Core depends on how the app is\\nlogging now. If it\\u2019s us\", \"ing a third-party NuGet package, refer to the upgrade documentation for that\\npackage. Most likely th\", \"e upgrade path will be fairly straightforward. If you\\u2019re using your own logging\\nsolution, take one o\", \"f the following actions:\\n\\n\\n1. Migrate the logging solution yourself\\n\\n2. Migrate to a third-party log\", \"ging solution\\n\\n3. Use the built-in logging support in ASP.NET Core\\n\\n\\nYou can reference the Microsoft\", \".Extensions.Logging package from .NET Framework apps as long as\\nthey\\u2019re using NuGet 4.3 or later and\", \" are on .NET Framework 4.6.1 or later. Once your app has\\nreferenced this package, you can convert yo\", \"ur logging statements to use the new extensions before\\nmigrating the app to .NET Core. This can prov\", \"ide a stepping stone toward full migration, since the app\\ncan continue running on .NET Framework whi\", \"le logging using the newer extensions package.\\n\\n#### **References**\\n\\n\\n  - [Logging in .NET Core and \", \"ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/logging/)\\n\\n  - [Microsoft.Extensio\", \"ns.Logging NuGet Package](https://www.nuget.org/packages/microsoft.extensions.logging/)\\n\\n### Compare\", \" Razor Pages to ASP.NET MVC\\n\\n\\n[Razor Pages is the preferred way to create page- or form-based apps i\", \"n ASP.NET Core. From the docs,](https://docs.microsoft.com/aspnet/core/razor-pages/)\\n\\u201cRazor Pages ca\", \"n make coding page-focused scenarios easier and more productive than using\\ncontrollers and views.\\u201d I\", \"f your ASP.NET MVC app makes heavy use of views, you may want to consider\\nmigrating from actions and\", \" views to Razor Pages.\\n\\n\\nA typical strongly typed view-based MVC app will use a controller to contai\", \"n one or more actions. The\\ncontroller will interact with the domain or data model, and create an ins\", \"tance of a viewmodel class.\\nThen this viewmodel class is passed to the view associated with that act\", \"ion. Using this approach,\\ncoupled with the default folder structure of MVC apps, to add a new page t\", \"o an app requires\\nmodifying a controller in one folder, a view in a nested subfolder in another fold\", \"er, and a viewmodel\\nin yet another folder.\\n\\n\\nRazor Pages group together the action (now a _handler_ \", \") and the viewmodel (called a _PageModel_ ) in\\none class, and link this class to the view (called a \", \"Razor Page). All Razor Pages go into a _Pages_ folder in\\nthe root of the ASP.NET Core project. Razor\", \" Pages use a routing convention based on their name and\\nlocation within this folder. Handlers behave\", \" exactly like action methods but have the HTTP verb they\\nhandle in their name (for example, OnGet). \", \"They also don\\u2019t necessarily need to return, since by default\\nthey\\u2019re assumed to return the page they\", \"\\u2019re associated with. This tends to keep Razor Pages and their\\nhandlers smaller and more focused whil\", \"e at the same time making it easier to find and work with all of\\nthe files needed to add or modify a\", \" particular part of an app.\\n\\n\\nAs part of a move from ASP.NET MVC to ASP.NET Core, teams should consi\", \"der whether they want to\\nmigrate controllers and views to ASP.NET Core controllers and views, or to \", \"Razor Pages. The former\\n\\n\\n26 CHAPTER 2 | Architectural differences between ASP.NET MVC and ASP.NET C\", \"ore\\n\\n\\nwill most likely require slightly less overall effort, but won\\u2019t allow the team to take advant\", \"age of the\\nbenefits of Razor Pages over traditional view-based file organization.\\n\\n#### **References\", \"**\\n\\n\\n  - [Introduction to Razor Pages in ASP.NET Core](https://docs.microsoft.com/aspnet/core/razor-\", \"pages/)\\n\\n  - [Simpler ASP.NET Core Apps with Razor Pages](https://docs.microsoft.com/archive/msdn-ma\", \"gazine/2017/september/asp-net-core-simpler-asp-net-mvc-apps-with-razor-pages)\\n\\n### Compare ASP.NET W\", \"eb API 2 and ASP.NET Core\\n\\n\\nASP.NET Core offers iterative improvements to ASP.NET Web API 2, but sho\", \"uld feel familiar to\\ndevelopers who have used Web API 2. ASP.NET Web API 2 was developed and shipped\", \" alongside\\nASP.NET MVC. This meant the two approaches had similar-but-different approaches to things\", \" like\\nattribute routing and dependency injection. In ASP.NET Core, there\\u2019s no longer any distinction\", \"\\n[between MVC and Web APIs. There\\u2019s only ASP.NET Core, which includes support for view-based](https:\", \"//docs.microsoft.com/aspnet/core/introduction-to-aspnet-core)\\nscenarios, API endpoints, Razor Pages,\", \" health checks, SignalR, and more.\\n\\n\\nIn addition to being consistent and unified within ASP.NET Core\", \", APIs built in .NET Core are much\\neasier to test than those built on ASP.NET Web API 2. We\\u2019ll cover\", \" testing differences in more detail in\\na moment. The built-in support for hosting ASP.NET Core apps,\", \" in a test host that can create an\\nHttpClient that makes in-memory requests to the app, is a huge be\", \"nefit when it comes to automated\\ntesting.\\n\\n\\n[See Incremental ASP.NET to ASP.NET Core migration for a\", \"n incremental approach to migrating to](https://docs.microsoft.com/aspnet/core/migration/inc/overvie\", \"w)\\nASP.NET Core.\\n\\n#### **References**\\n\\n\\n  - [Migrate from ASP.NET Web API to ASP.NET Core](https://d\", \"ocs.microsoft.com/aspnet/core/migration/webapi)\\n\\n  - [Ardalis.ApiEndpoints NuGet package](https://ww\", \"w.nuget.org/packages/Ardalis.ApiEndpoints/)\\n\\n### Compare authentication and authorization between AS\", \"P.NET MVC and ASP.NET Core\\n\\n\\nIn ASP.NET MVC 5, authentication is configured in _Startup.Auth.cs_ in \", \"the _App_Start_ folder. In ASP.NET\\nCore MVC, this configuration occurs in _Startup.cs_ or _Program.c\", \"s_, as part of configuring the app\\u2019s\\nservices and middleware.\\n\\n\\nAuthentication and authorization are\", \" performed using middleware added to the request pipeline:\\n\\n\\n27 CHAPTER 2 | Architectural difference\", \"s between ASP.NET MVC and ASP.NET Core\\n\\n\\nIt\\u2019s important to add the auth middleware in the appropriat\", \"e order in the middleware pipeline. Only\\nrequests that make it to the middleware will be impacted by\", \" it. For instance, if a call to UseStaticFiles()\\nwere placed above the code shown here, it wouldn\\u2019t \", \"be protected by authentication and\\nauthorization.\\n\\n\\nIn ASP.NET MVC and Web API, apps often refer to \", \"the current user using the ClaimsPrincipal.Current\\nproperty. This property isn\\u2019t set in ASP.NET Core\", \", and any behavior in your app that depends on it will\\n[need to migrate from ClaimsPrincipal.Current\", \" by using the User property on ControllerBase or getting](https://docs.microsoft.com/aspnet/core/mig\", \"ration/claimsprincipal-current)\\naccess to the current HttpContext and referencing its User property.\", \" If neither of these solutions is an\\noption, services can request the User as an argument, in which \", \"case it must be supplied from\\nelsewhere in the app, or the IHttpContextAccessor can be requested and\", \" used to get the HttpContext.\\n\\n#### **Authorization**\\n\\n\\nAuthorization defines what a given user can \", \"do within the app. It\\u2019s separate from authentication,\\nwhich is concerned merely with identifying who\", \" the user is. ASP.NET Core provides a simple,\\ndeclarative role and a rich, policy-based model for au\", \"thorization. Specifying that a resource requires\\nauthorization is often as simple as adding the [Aut\", \"horize] attribute to the action or controller. If you\\u2019re\\n[migrating to Razor Pages from MVC views, y\", \"ou should specify conventions for authorization when](https://docs.microsoft.com/aspnet/core/securit\", \"y/authorization/razor-pages-authorization)\\n[you configure Razor Pages.](https://docs.microsoft.com/a\", \"spnet/core/security/authorization/razor-pages-authorization)\\n\\n\\nAuthorization in ASP.NET Core may be \", \"as simple as prohibiting anonymous users while allowing\\nauthenticated users. Or it can scale up to s\", \"upport role-based, claims-based, or policy-based\\nauthorization approaches. For more information on t\", \"hese approaches, see the documentation on\\n[authorization in ASP.NET Core. You\\u2019ll likely find that on\", \"e of them is closely aligned with your current](https://docs.microsoft.com/aspnet/core/security/auth\", \"orization/introduction)\\nauthorization approach.\\n\\n#### **References**\\n\\n\\n  - [Security, Authentication\", \", and Authorization with ASP.NET MVC](https://docs.microsoft.com/aspnet/mvc/overview/security/)\\n\\n  -\", \" [Migrate Authentication and Identity to ASP.NET Core](https://docs.microsoft.com/aspnet/mvc/overvie\", \"w/security/)\\n\\n  - [Migrate from ClaimsPrincipal.Current](https://docs.microsoft.com/aspnet/core/migr\", \"ation/claimsprincipal-current)\\n\\n  - [Introduction to Authorization in ASP.NET Core](https://docs.mic\", \"rosoft.com/aspnet/core/security/authorization/introduction)\\n\\n### Compare ASP.NET Identity and ASP.NE\", \"T Core Identity\\n\\n\\nIn ASP.NET MVC, identity features are typically configured in _IdentityConfig.cs_ \", \"in the _App_Start_ folder.\\n[Review how this is configured in the existing app, and compare it to the\", \" configuration required for](https://docs.microsoft.com/aspnet/core/security/authentication/identity\", \"-configuration)\\n[ASP.NET Core Identity](https://docs.microsoft.com/aspnet/core/security/authenticati\", \"on/identity-configuration) in _Program.cs_ .\\n\\n\\n28 CHAPTER 2 | Architectural differences between ASP.\", \"NET MVC and ASP.NET Core\\n\\n\\nASP.NET Identity is an API that supports user interface login functionali\", \"ty and manages users,\\npasswords, profile data, roles, claims, tokens, email confirmations, and more.\", \" It supports external login\\nproviders like Facebook, Google, Microsoft, and Twitter.\\n\\n\\n[If your ASP.\", \"NET MVC app is using ASP.NET Membership, you\\u2019ll find a guide to migrate from ASP.NET](https://docs.m\", \"icrosoft.com/aspnet/core/migration/proper-to-2x/membership-to-core-identity)\\n[Membership authenticat\", \"ion to ASP.NET Core 2.0 Identity. This is mainly a data migration exercise, at](https://docs.microso\", \"ft.com/aspnet/core/migration/proper-to-2x/membership-to-core-identity)\\nthe completion of which you s\", \"hould be able to use ASP.NET Core Identity with your migrated user\\nrecords.\\n\\n\\nIf you migrate your AS\", \"P.NET Identity users to ASP.NET Core Identity, you may need to update their\\npassword hashes, or trac\", \"k which passwords are hashed with the new ASP.NET Core Identity approach\\n[or the older ASP.NET Ident\", \"ity approach. This approach described on Stack Overflow provides some](https://stackoverflow.com/a/5\", \"7074910/13729)\\noptions for migrating user password hashes over time, rather than all at once.\\n\\n\\nOne \", \"of the biggest differences when it comes to ASP.NET Core Identity compared to ASP.NET Identity\\nis ho\", \"w little code you need to include in your project. ASP.NET Core Identity now ships as a Razor\\nClass \", \"Library, meaning its UI and logic are all available from a NuGet package. You can override the\\n[exis\", \"ting UI and logic by scaffolding the ASP.NET Core Identity files](https://docs.microsoft.com/aspnet/\", \"core/security/authentication/scaffold-identity) but even in this case you need only\\nscaffold the pag\", \"es you want to modify, not every one that exists.\\n\\n#### **Migrate from OWIN / Katana**\\n\\n\\nThe followi\", \"ng resources offer some guidance for migrating from OWIN / Katana:\\n\\n\\n  - [Migration](https://docs.mi\", \"crosoft.com/aspnet/core/migration/proper-to-2x/#globalasax-file-replacement)\\n\\n  - [Katana to ASPNET \", \"5](https://devblogs.microsoft.com/aspnet/katana-asp-net-5-and-bridging-the-gap/)\\n\\n#### **References*\", \"*\\n\\n\\n  - [Migrate Authentication and Identity to ASP.NET Core](https://docs.microsoft.com/aspnet/core\", \"/migration/identity)\\n\\n  - [Introduction to Identity on ASP.NET Core](https://docs.microsoft.com/aspn\", \"et/core/security/authorization/introduction)\\n\\n  - [Configure ASP.NET Core Identity](https://docs.mic\", \"rosoft.com/aspnet/core/security/authentication/identity-configuration)\\n\\n  - [Scaffold Identity in AS\", \"P.NET Core projects](https://docs.microsoft.com/aspnet/core/security/authentication/scaffold-identit\", \"y)\\n\\n### Compare controllers in ASP.NET MVC and Web API with controllers in ASP.NET Core\\n\\n\\nIn ASP.NET\", \" MVC 5 and Web API 2, there were two different Controller base types. MVC controllers\\ninherited from\", \" Controller; Web API controllers inherited from ApiController. In ASP.NET Core, this\\nobject hierarch\", \"y has been merged. It\\u2019s recommended that API controllers in ASP.NET Core inherit\\nfrom ControllerBase\", \" and add the [ApiController] attribute. Standard view-based MVC controllers\\nshould inherit from Cont\", \"roller.\\n\\n\\nIn both frameworks, controllers are used to organize sets of action methods. Filters and r\", \"outes can be\\napplied on a controller level in addition to at the action level. These conventions can\", \" be extended\\nfurther by using custom base Controller types with default behavior and attributes appl\", \"ied to them.\\n\\n\\n29 CHAPTER 2 | Architectural differences between ASP.NET MVC and ASP.NET Core\\n\\n\\nIn AS\", \"P.NET MVC, content negotiation isn\\u2019t supported. ASP.NET Web API 2 does support content\\n[negotiation,\", \" as does ASP.NET Core. Using content negotiation, the format of the content returned to a](https://d\", \"ocs.microsoft.com/aspnet/core/web-api/advanced/formatting)\\nrequest can be determined by headers the \", \"client provides indicating its preferred manner of receiving\\nthe content.\\n\\n\\nWhen migrating ASP.NET W\", \"eb API controllers to ASP.NET Core, a few components need to be\\nchanged if they exist. These include\", \" references to the ApiController base class, the System.Web.Http\\n[namespace, and the IHttpActionResu\", \"lt interface. Refer to the documentation for recommendations on](https://docs.microsoft.com/aspnet/c\", \"ore/migration/webapi)\\n[how to migrate these specific differences. Note that the preferred return typ\", \"e for API actions in](https://docs.microsoft.com/aspnet/core/migration/webapi)\\nASP.NET Core is Actio\", \"nResult<T>.\\n\\n\\nIn addition, the [ChildActionOnly] attribute isn\\u2019t supported in ASP.NET Core. In ASP.N\", \"ET Core, similar\\n[functionality is achieved using View Components.](https://docs.microsoft.com/aspne\", \"t/core/mvc/views/view-components)\\n\\n\\n[ASP.NET Core includes two new attributes: ConsumesAttribute](ht\", \"tps://docs.microsoft.com/dotnet/api/microsoft.aspnetcore.mvc.consumesattribute) [and ProducesAttribu\", \"te. These are used](https://docs.microsoft.com/dotnet/api/microsoft.aspnetcore.mvc.producesattribute\", \")\\nto specify the type an action consumes or produces, which can be helpful for routing and\\n[document\", \"ing the API using tools like Swagger/OpenAPI.](https://docs.microsoft.com/aspnet/core/tutorials/web-\", \"api-help-pages-using-swagger)\\n\\n#### **References**\\n\\n\\n  - [Format response data in ASP.NET Core Web A\", \"PI](https://docs.microsoft.com/aspnet/core/web-api/advanced/formatting)\\n\\n  - [Migrate from ASP.NET W\", \"eb API to ASP.NET Core](https://docs.microsoft.com/aspnet/core/migration/webapi)\\n\\n### Compare Razor \", \"usage in ASP.NET MVC and ASP.NET Core\\n\\n\\nThe basic syntax of Razor hasn\\u2019t changed substantially betwe\", \"en ASP.NET MVC and ASP.NET Core.\\n[However, there are certain differences, such as the introduction o\", \"f Tag Helpers](https://docs.microsoft.com/aspnet/core/mvc/views/tag-helpers/intro) and Razor Pages, \", \"that\\nshould be considered when migrating. If your app makes heavy use of custom Razor functionality,\", \"\\n[refer to the Razor syntax reference for ASP.NET Core to see what changes may be required when you]\", \"(https://docs.microsoft.com/aspnet/core/razor-pages)\\nmigrate to ASP.NET Core.\\n\\n#### **Tag Helpers**\\n\", \"\\n\\nTag Helpers enable server-side code to participate in creating and rendering HTML elements in Razo\", \"r\\nfiles. They offer many advantages over HTML Helpers and should be used in place of HTML Helpers\\nwh\", \"erever possible. They provide an HTML-friendly development experience, since they look like\\nstandard\", \" HTML and are ignored by most tooling designed to edit HTML. Within _Visual Studio_, there\\u2019s\\nrich In\", \"telliSense support for creating HTML and Razor markup with Tag Helpers. Tag Helpers can\\nprovide simp\", \"le or complex behavior from declarative markup in Razor files.\\n\\n#### **Razor Pages**\\n\\n\\nRazor Pages o\", \"ffer an alternative to controllers, actions, and views for page- and form-based apps.\\nRazor Pages we\", \"re compared to ASP.NET MVC earlier in this chapter.\\n\\n\\n30 CHAPTER 2 | Architectural differences betwe\", \"en ASP.NET MVC and ASP.NET Core\\n\\n\\n#### **References**\\n\\n\\n  - [Migrate from ASP.NET MVC to ASP.NET Cor\", \"e MVC: Controllers and Views](https://docs.microsoft.com/aspnet/core/migration/mvc#migrate-controlle\", \"rs-and-views)\\n\\n  - [Tag Helpers in ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/views/ta\", \"g-helpers/intro)\\n\\n  - [Introduction to Razor Pages in ASP.NET Core](https://docs.microsoft.com/aspne\", \"t/core/razor-pages)\\n\\n  - [Razor syntax reference for ASP.NET Core](https://docs.microsoft.com/aspnet\", \"/core/razor-pages)\\n\\n### Compare ASP.NET SignalR and ASP.NET Core SignalR\\n\\n\\nASP.NET Core SignalR is i\", \"ncompatible with clients or servers using ASP.NET SignalR. You\\u2019ll need to\\nupdate both clients and se\", \"rver to use ASP.NET Core SignalR. Some differences are described in this\\n[section, while the full li\", \"st is available in the docs. ASP.NET Core SignalR requires .NET Core 2.1 or](https://docs.microsoft.\", \"com/aspnet/core/signalr/version-differences)\\ngreater.\\n\\n#### **Feature differences**\\n\\n\\n  - ASP.NET Si\", \"gnalR automatically attempts to reconnect dropped connections; this behavior is\\nopt-in for ASP.NET C\", \"ore SignalR clients.\\n\\n  - Both frameworks support JSON; ASP.NET Core SignalR also supports a binary \", \"protocol based\\non MessagePack, and custom protocols can be created.\\n\\n  - The Forever Frame transport\", \", supported by ASP.NET SignalR, isn\\u2019t supported in ASP.NET Core\\nSignalR.\\n\\n  - ASP.NET Core SignalR m\", \"ust be configured by adding services.AddSignalR() and\\napp.UseEndpoints in _Program.cs_ .\\n\\n  - ASP.NE\", \"T Core SignalR requires sticky sessions; ASP.NET SignalR doesn\\u2019t.\\n\\n  - ASP.NET Core simplifies the c\", \"onnection model; connections are only made to a single hub.\\n\\n  - ASP.NET Core SignalR supports strea\", \"ming data from the hub to the client.\\n\\n  - ASP.NET Core SignalR doesn\\u2019t support passing state betwee\", \"n clients and the hub (but method\\ncalls still allow passing information between hubs and clients).\\n\\n\", \"  - The PersistentConnection class doesn\\u2019t exist in ASP.NET Core SignalR.\\n\\n  - ASP.NET SignalR suppo\", \"rts SQL Server and Redis. ASP.NET Core SignalR supports Azure\\nSignalR and Redis.\\n\\n#### **References*\", \"*\\n\\n\\n  - [Differences between ASP.NET SignalR and ASP.NET Core SignalR](https://docs.microsoft.com/as\", \"pnet/core/signalr/version-differences)\\n\\n  - [Azure SignalR Service](https://docs.microsoft.com/azure\", \"/azure-signalr/)\\n\\n\\n31 CHAPTER 2 | Architectural differences between ASP.NET MVC and ASP.NET Core\\n\\n\\n#\", \"## Compare testing options between ASP.NET MVC and ASP.NET Core\\n\\nASP.NET MVC apps support unit testi\", \"ng of controllers, but this approach often omits many MVC\\nfeatures like routing, authorization, mode\", \"l binding, model validation, filters, and more. To test these\\nMVC features in addition to the logic \", \"within the controller action itself, frequently the app would need\\nto be deployed and then tested wi\", \"th a tool like Selenium. These tests are substantially more\\nexpensive, more brittle, and slower than\", \" typical unit tests that can be run without the need for hosting\\nand running the entire app.\\n\\n\\n[ASP.\", \"NET Core controllers can be unit tested just like ASP.NET MVC controllers, but with the same](https:\", \"//docs.microsoft.com/aspnet/core/mvc/controllers/testing)\\n[limitations. However, ASP.NET Core suppor\", \"ts fast, easy-to-author integration tests](https://docs.microsoft.com/aspnet/core/test/integration-t\", \"ests) as well. Integration\\ntests are hosted by a TestHost class and are typically configured in a cu\", \"stom WebApplicationFactory\\nthat can override or replace app dependencies. For instance, frequently d\", \"uring integration tests the\\napp will target a different data source and may replace services that se\", \"nd emails with fake or mock\\nimplementations.\\n\\n\\nASP.NET MVC and Web API did not support anything like\", \" the integration testing scenarios available in\\nASP.NET Core. In any migration effort, you should al\", \"locate time to write some integration tests for\\nyour newly migrated system to ensure it\\u2019s working as\", \" expected and continues to do so. Even if you\\nweren\\u2019t writing tests of your web app logic before the\", \" migration, you should strongly consider doing\\nso as you move to ASP.NET Core.\\n\\n#### **References**\\n\", \"\\n\\n  - [Creating Unit Tests for ASP.NET MVC Applications](https://docs.microsoft.com/aspnet/mvc/overv\", \"iew/older-versions-1/unit-testing/creating-unit-tests-for-asp-net-mvc-applications-cs)\\n\\n  - [Unit te\", \"st controller logic in ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/controllers/testing)\", \"\\n\\n  - [Integration tests in ASP.NET Core](https://docs.microsoft.com/aspnet/core/test/integration-te\", \"sts)\\n\\n\\n32 CHAPTER 2 | Architectural differences between ASP.NET MVC and ASP.NET Core\\n\\n\\n**CHAPTER**\\n#\", \" 3\\n\\n## Migrate large solutions to ASP.NET Core\\n\\n\\nMigrating large solutions from .NET Framework to .N\", \"ET Core requires some planning. Dependencies\\nmust be migrated or updated before the projects that de\", \"pend on them. There are tools that can\\nidentify dependencies and offer help with migrating to .NET C\", \"ore. Depending on the app, its scope,\\nand current usage patterns, different strategies may be employ\", \"ed when migrating. Do you migrate it\\nall at once, or over time, side-by-side with the current system\", \"? Do you wrap the current system in the\\nnew one, and incrementally replace its functionality?\\n\\n\\nIn t\", \"his chapter, you\\u2019ll learn how create a migration plan for a large solution, how to use tools to help\", \"\\nwith the migration, and some strategies to consider for the migration itself.\\n\\n### References\\n\\n\\n  -\", \" [What topics are important to migrating large MVC and Web API apps to .NET Core?](https://twitter.c\", \"om/ardalis/status/1313669040859217921)\\n\\n  - [Porting from .NET Framework to .NET Core](https://docs.\", \"microsoft.com/en-us/dotnet/core/porting/)\\n\\n### Identify sequence of projects to migrate\\n\\n\\nFor soluti\", \"ons that involve multiple front-end apps, it\\u2019s best to migrate the apps one by one. For\\nexample, cre\", \"ate a solution that only includes one front-end app and its dependencies so you can\\neasily identify \", \"the scope of work involved. Solutions are lightweight, and you can include projects in\\nmultiple solu\", \"tions if needed. Take advantage of solutions as an organizational tool when migrating.\\n\\n\\nOnce you\\u2019ve\", \" identified the ASP.NET app to migrate and have its dependent projects located with it\\n(ideally in a\", \" solution), the next step is to identify framework and NuGet dependencies. Having\\nidentified all dep\", \"endencies, the simplest migration approach is a \\u201cbottom up\\u201d approach. With this\\napproach, the lowest\", \" level of dependencies is migrated first. Then the next level of dependencies is\\nmigrated, until eve\", \"ntually the only thing left is the front-end app. Figure 3-1 shows an example set of\\nprojects compos\", \"ing an app. The low-level class libraries are at the bottom, and the ASP.NET MVC\\nproject is at the t\", \"op.\\n\\n\\n33 CHAPTER 3 | Migrate large solutions to ASP.NET Core\\n\\n\\n_Figure 3-1. Project dependencies gra\", \"ph._\\n\\n\\nChoose a particular front-end app, an ASP.NET MVC 5 / Web API 2 project. Identify its depende\", \"ncies\\nin the solution, and map out their dependencies until you have a complete list. A diagram like\", \" the one\\nshown in Figure 3-1 may be useful when mapping out project dependencies. Visual Studio can\\n\", \"[produce a dependency diagram for your solution, depending on which edition you\\u2019re using. The .NET](\", \"https://docs.microsoft.com/visualstudio/modeling/create-layer-diagrams-from-your-code)\\n[Portability \", \"Analyzer](https://docs.microsoft.com/en-us/dotnet/standard/analyzers/portability-analyzer) can also \", \"produce dependency diagrams.\\n\\n\\n[Figure 3-2 shows the installer for the .NET Portability Analyzer Vis\", \"ual Studio extension:](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityA\", \"nalyzer)\\n\\n\\n34 CHAPTER 3 | Migrate large solutions to ASP.NET Core\\n\\n\\n_Figure 3-2. .NET Portability An\", \"alyzer installer._\\n\\n\\nThe extension currently supports Visual Studio 2017 and 2019. Visual Studio 202\", \"2 support is planned.\\n\\n\\nOnce installed, you configure it from the **Analyze** - **Portability Analyz\", \"er Settings** menu, as shown in\\nFigure 3-3.\\n\\n\\n35 CHAPTER 3 | Migrate large solutions to ASP.NET Core\", \"\\n\\n\\n_Figure 3-3. Configure the .NET Portability Analyzer._\\n\\n\\nThe analyzer produces a detailed report \", \"for each assembly. The report:\\n\\n\\n  - Describes how compatible each project is with a given target fr\", \"amework, such as .NET 7 or\\n.NET Standard 2.0.\\n\\n  - Helps teams assess the effort required to port a \", \"particular project to a particular target\\nframework.\\n\\n\\nThe details of this analysis are covered in t\", \"he next section.\\n\\n\\nOnce you\\u2019ve mapped out the projects and their relationships with one another, you\", \"\\u2019re ready to\\ndetermine the order in which you\\u2019ll migrate the projects. Begin with projects that have\", \" no\\ndependencies. Then, work your way up the tree to the projects that depend on these projects.\\n\\n\\nI\", \"n the example shown in Figure 3-1, you would start with the _Contoso.Utils_ project, since it doesn\\u2019\", \"t\\ndepend on any other projects. Next, _Contoso.Data_ since it only depends on \\u201cUtils\\u201d. Then migrate \", \"the\\n\\u201cBusinessLogic\\u201d library, and finally the front-end ASP.NET \\u201cWeb\\u201d project. Following this \\u201cbottom\", \" up\\u201d\\napproach works well for relatively small and well-factored apps that can be migrated as a unit \", \"once all\\nof their projects have migrated. Larger apps with more complexity, or more code that will t\", \"ake longer\\nto migrate, may need to consider more incremental strategies.\\n\\n\\n36 CHAPTER 3 | Migrate la\", \"rge solutions to ASP.NET Core\\n\\n\\n#### **Unit tests**\\n\\nMissing from the previous diagrams are unit tes\", \"t projects. Hopefully there are tests covering at least\\nsome of the existing behavior of the librari\", \"es being ported.\\n\\n\\nIf you have unit tests, it\\u2019s best to convert those projects first. You\\u2019ll want to\", \" continue testing changes\\nin the project you\\u2019re working on. Remember that porting to .NET Core is a \", \"significant change to your\\ncodebase.\\n\\n\\nMSTest, xUnit, and NUnit all work on .NET Core. If you don\\u2019t \", \"currently have tests for your app,\\nconsider building some characterization tests that verify the sys\", \"tem\\u2019s current behavior. The benefit is\\nthat once the migration is complete, you can confirm the app\\u2019\", \"s behavior remains unchanged.\\n\\n#### **Considerations for migrating many apps**\\n\\n\\nSome organizations \", \"will have many different apps to migrate, and migrating each one by hand may\\nrequire too many resour\", \"ces to be tenable. In these situations, some degree of automation is\\nrecommended. The steps followed\", \" in this chapter can be automated. Structural changes, like project\\nfile differences and updates to \", \"common packages, can be applied by scripts. These scripts can be\\nrefined as they\\u2019re run iteratively \", \"on more projects. On each run, examine whatever manual steps are\\nrequired for each project. Automate\", \" those manual steps, if possible. Using this approach, the\\norganization should grow faster and bette\", \"r at porting their apps over time, with improved automation\\nsupport each step of the way.\\n\\n\\n[Watch a\", \"n overview of how to employ this approach in this dotNetConf presentation by Lizzy](https://www.yout\", \"ube.com/watch?v=C-2haqb60No)\\n[Gallagher of Mastercard. The five phases employed in this presentation\", \" included:](https://www.youtube.com/watch?v=C-2haqb60No)\\n\\n\\n  - Migrate third-party NuGet dependencie\", \"s\\n\\n  - Migrate apps to use new _.csproj_ file format\\n\\n  - Update internal NuGet dependencies to .NET\", \" Standard\\n\\n  - Migrate apps to ASP.NET Core (targeting .NET Framework)\\n\\n  - Update all apps to targe\", \"t .NET 7\\n\\n\\nWhen automating a large suite of apps, it helps significantly if they follow consistent c\", \"oding\\nguidelines and project organization. Automation efforts rely on this consistency to be effecti\", \"ve. In\\naddition to parsing and migrating project files, common code patterns can be migrated automat\", \"ically.\\nSome code pattern examples include differences in how controller actions are declared or how\", \" they\\nreturn results.\\n\\n\\nFor example, a migration script could search files matching _Controller.cs_ \", \"for lines of code matching\\none of these patterns:\\n\\n\\nIn ASP.NET Core, either of the preceding lines o\", \"f code can be replaced with:\\n\\n```\\n  return Ok();\\n\\n```\\n\\n37 CHAPTER 3 | Migrate large solutions to ASP\", \".NET Core\\n\\n\\n#### **Summary**\\n\\nThe best approach to porting a large .NET Framework app to .NET Core i\", \"s to:\\n\\n\\n1. Identify project dependencies.\\n\\n2. Analyze what\\u2019s required to port each project.\\n\\n3. Star\", \"t from the bottom up.\\n\\n\\nYou can use the .NET Portability Analyzer to determine how compatible existi\", \"ng libraries may be with\\ntarget platforms. Automated tests will help ensure no breaking changes are \", \"introduced as the app is\\nported. These test projects should be among the first projects ported.\\n\\n###\", \"# **References**\\n\\n\\n  - [Porting from .NET Framework to .NET Core](https://docs.microsoft.com/en-us/d\", \"otnet/core/porting/)\\n\\n  - [The .NET Portability Analyzer](https://docs.microsoft.com/en-us/dotnet/st\", \"andard/analyzers/portability-analyzer)\\n\\n  - [2 Years, 200 Apps: A .NET Core Migration at Scale (Vide\", \"o)](https://www.youtube.com/watch?v=C-2haqb60No)\\n\\n### Understand and update dependencies\\n\\n\\nAfter ide\", \"ntifying the sequence in which the app\\u2019s individual projects must be migrated, the next step\\nis to u\", \"nderstand each project\\u2019s dependencies and update them if necessary. For platform\\n[dependencies, the \", \"best way to start is to run the .NET Portability Analyzer](https://docs.microsoft.com/en-us/dotnet/s\", \"tandard/analyzers/portability-analyzer) on the assembly in\\nquestion, and then look at the detailed r\", \"esults that are generated. You configure the tool to specify\\none or more target platforms, such as .\", \"NET 7 or .NET Standard 2.0. Results are provided with details\\nfor each platform targeted. Figure 3-4\", \" shows an example of the tool\\u2019s output.\\n\\n\\n_Figure 3-4. .NET Portability Analyzer report details._\\n\\n#\", \"### **Update class library dependencies**\\n\\n\\nLarge apps typically involve multiple projects, and most\", \" projects other than the ASP.NET MVC web\\nproject are likely to be class libraries. Class libraries t\", \"end to be the easiest to port between .NET\\n\\n\\n38 CHAPTER 3 | Migrate large solutions to ASP.NET Core\\n\", \"\\n\\nplatforms, especially compared to ASP.NET projects, which are among the most difficult (and typica\", \"lly\\nneed to be re-created).\\n\\n\\n[Teams can consider the try-convert tool or the .NET Upgrade Assistant\", \" tool](https://github.com/dotnet/try-convert) for migrating class\\nlibraries to .NET Core. These tool\", \"s analyze a .NET Framework project file and attempt to migrate it to\\nthe .NET Core project file form\", \"at, making any modifications it can safely perform in the process. The\\ntools may require some manual\", \" assistance to work with ASP.NET projects, but can usually help speed\\nup the process of migrating cl\", \"ass libraries.\\n\\n\\nThe try-convert and Upgrade Assistant tools are deployed as .NET Core command line \", \"tools. They only\\nrun on Windows, since they\\u2019re designed to work with .NET Framework apps. You can in\", \"stall tryconvert by running the following command from a command prompt:\\n\\n```\\ndotnet tool install -g\", \" try-convert\\n\\n```\\n\\nOnce you\\u2019ve successfully installed the tool, you can run try-convert in the folde\", \"r where the class\\nlibrary\\u2019s project file is located.\\n\\n\\nInstall the .NET Upgrade Assistant with the f\", \"ollowing command (after installing try-convert):\\n\\n```\\ndotnet tool install -g upgrade-assistant\\n\\n```\\n\", \"\\nRun the tool with the command upgrade-assistant upgrade <project> in the folder where the project\\nf\", \"ile is located.\\n\\n#### **Update NuGet package dependencies**\\n\\n\\nAnalyze your use of third-party NuGet \", \"packages and determine if any of them don\\u2019t yet support .NET\\n[Standard (or do support it but only wi\", \"th a new version). It can be helpful to update NuGet packages](https://docs.microsoft.com/nuget/cons\", \"ume-packages/migrate-packages-config-to-package-reference)\\n[to use <PackageReference> syntax using V\", \"isual Studio\\u2019s converter tool, so that top-level](https://docs.microsoft.com/nuget/consume-packages/\", \"migrate-packages-config-to-package-reference)\\ndependencies are visible. Next, check whether the curr\", \"ent or later versions of these packages support\\n.NET Core or .NET Standard. This information can be \", \"found on [nuget.org] or within Visual Studio for\\neach package.\\n\\n\\nIf support exists using the version\", \" of the package the app currently uses, great! If not, see if a more\\nrecent version of the package h\", \"as the support and research what would be involved in upgrading.\\nThere may be breaking changes in th\", \"e package, especially if the major version of the package changes\\nbetween your currently used versio\", \"n and the one to which you\\u2019re upgrading.\\n\\n\\nIn some cases, no version of a given package works with .\", \"NET Core. In that case, teams have a couple\\noptions. They can continue depending on the .NET Framewo\", \"rk version, but this has limitations. The\\napp may only run on Windows, and the team may want to run \", \"Portability Analyzer on the package\\u2019s\\nbinaries to see if there are any issues likely to be encounter\", \"ed. Certainly the team will want to test\\nthoroughly, since if .NET Framework packages are used that \", \"reference APIs not available in .NET Core,\\na runtime exception will occur. The other option is to fi\", \"nd a different package or, if the required\\npackage is open source, upgrade it to .NET Standard or .N\", \"ET Core themselves.\\n\\n\\n39 CHAPTER 3 | Migrate large solutions to ASP.NET Core\\n\\n\\n#### **Migrate ASP.NE\", \"T MVC projects**\\n\\nThe System.Web namespace and types don\\u2019t exist in .NET Core. When you\\u2019re analyzing\", \" dependencies\\nand using tools like try-convert, you\\u2019ll find they don\\u2019t offer many suggestions for au\", \"tomatic migration\\nof ASP.NET MVC projects and any code in them that references System.Web. For these\", \" projects, you\\u2019ll\\nneed to start with a new ASP.NET Core web project and manually migrate files to th\", \"is project.\\n\\n\\nIn general, it\\u2019s a good practice to minimize how much of an app\\u2019s business logic lives\", \" in its user\\ninterface layer. It\\u2019s also best to keep controllers and views small. Apps that have fol\", \"lowed this\\nguidance will be easier to port than those that have a significant amount of their logic \", \"in the ASP.NET\\nweb project. If you have an app you\\u2019re considering porting, but haven\\u2019t begun the pro\", \"cess yet, keep\\nthis in mind as you maintain it. Any effort you put toward minimizing how much code i\", \"s in the\\nASP.NET MVC or Web API project will likely result in less work when the time comes to port \", \"the app.\\n\\n\\nThe next chapter digs into details of how to migrate from ASP.NET MVC and Web API project\", \"s to\\nASP.NET Core projects. The previous chapter called out the biggest differences between the apps\", \".\\nOnce the basic project structure is in place, migrating individual controllers and views is usuall\", \"y\\nstraightforward, especially if they\\u2019re mainly focused on web responsibilities.\\n\\n#### **References*\", \"*\\n\\n\\n  - [.NET Upgrade Assistant tool](https://aka.ms/dotnet-upgrade-assistant)\\n\\n  - [try-convert too\", \"l](https://github.com/dotnet/try-convert)\\n\\n  - [apiport tool](https://github.com/microsoft/dotnet-ap\", \"iport)\\n\\n### Strategies for migrating while running in production\\n\\n\\nMany teams have .NET Framework ap\", \"ps they plan to migrate to .NET Core/.NET 7, but the app is so\\nlarge that the migration requires a s\", \"ignificant amount of time to complete. The original app needs to\\nlive on while the migration is done\", \" piece by piece. There needs to be a way for the old and new\\nversions of the app to work together si\", \"de-by-side, or for the old version to be migrated in-place, at\\nleast some of the way, without breaki\", \"ng it. Teams can employ many different strategies to support\\nthese goals.\\n\\n#### **Refactor the .NET \", \"Framework solution**\\n\\n\\nA good place to start if you plan to port a .NET Framework app to .NET Core i\", \"s to refactor it to work\\nbetter with .NET Core. This means updating individual class libraries to ta\", \"rget .NET Standard and\\nmoving as much logic out of your ASP.NET MVC projects and into these class li\", \"braries. Any code you\\nhave in .NET Standard libraries is immediately usable from both .NET Framework\", \" to .NET Core apps,\\nwhich is why this step is so valuable as part of a migration.\\n\\n\\nWhen refactoring\", \", make sure you\\u2019re following good refactoring fundamentals. For example, create\\ntests that verify wh\", \"at the system does before you start refactoring. Run these tests when you\\u2019re done\\nto confirm you did\", \"n\\u2019t change the system\\u2019s behavior. You may need to add characterization tests to the\\nsystem if you do\", \"n\\u2019t already have a good suite of automated tests you can rely on.\\n\\n\\n40 CHAPTER 3 | Migrate large sol\", \"utions to ASP.NET Core\\n\\n\\n#### **Extract front-end assets to a CDN**\\n\\nIf your .NET Framework apps inc\", \"lude a lot of static assets, like scripts, CSS files, or images, you may be\\nable to migrate these to\", \" a separate CDN. Then, update the existing app to reference the CDN links for\\nthese assets. When you\", \" port the app to .NET Core, these static files won\\u2019t be part of the migration,\\nand you\\u2019ll just conti\", \"nue referencing them from the CDN in the ASP.NET Core app.\\n\\n#### **Extract and migrate individual mi\", \"croservices**\\n\\n\\nLarge .NET Framework apps may already be comprised of separate front-end systems tha\", \"t can be\\nmigrated individually. Or they may be candidates for migration to a microservices architect\", \"ure, with\\nsome pieces of existing ASP.NET MVC apps being pulled out into new ASP.NET Core microservi\", \"ce\\nimplementations. You can learn more about microservices in the associated ebook, .NET\\n[Microservi\", \"ces: Architecture for Containerized .NET Applications.](https://aka.ms/microservicesebook)\\n\\n\\nFor exa\", \"mple, the existing app might have a set of features it uses related to user sign-in and\\nregistration\", \". These could be migrated to a separate microservice, which could be built and deployed\\nusing ASP.NE\", \"T Core and then integrated into the legacy .NET Framework app. Next, the app might\\nhave a few pages \", \"dedicated to tracking the individual user\\u2019s shopping cart. These pages could also be\\npulled out into\", \" their own separate microservice and again integrated into the existing app. In this way,\\nthe origin\", \"al .NET Framework app continues running in production, but with more and more of its\\nfeatures coming\", \" from modernized .NET Core microservices.\\n\\n#### **Deploy multiple versions of the app side-by-side i\", \"n IIS**\\n\\n\\nUsing a combination of host headers and redirects, an existing ASP.NET MVC app can be conf\", \"igured\\nto run side by side with an ASP.NET Core app on the same IIS server. As pieces of functionali\", \"ty, such\\nas individual controllers, are ported to ASP.NET Core, their routes and URLs are mapped wit\", \"hin IIS to\\ntarget the ASP.NET Core web site or sub-application (IIS virtual directories aren\\u2019t suppo\", \"rted with\\nASP.NET Core apps). An ASP.NET Core app can be hosted as an IIS sub-application (sub-app).\", \" The\\nsub-app\\u2019s path becomes part of the root app\\u2019s URL.\\n\\n#### **Apply the Strangler pattern**\\n\\n\\nLarg\", \"e ASP.NET MVC apps can be gradually replaced with a new ASP.NET Core app by incrementally\\n[migrating\", \" pieces of functionality. One approach to this is called the strangler pattern, named for](https://d\", \"ocs.microsoft.com/azure/architecture/patterns/strangler)\\nstrangler vines that strangle and eventuall\", \"y tear down trees. This approach relies on first\\nimplementing a facade layer over top of the existin\", \"g solution. This facade should be built using the\\nnew approach to the problem, or an off-the-shelf s\", \"olution such as an API gateway.\\n\\n\\nOnce the facade is in place, you can route part of it to a new ASP\", \".NET Core app. As you port more of\\nthe original .NET Framework app to .NET Core, you continue to upd\", \"ate the facade layer accordingly,\\nsending more of the facade\\u2019s total functionality to the new system\", \". Figure 3-5 shows the strangler\\npattern progression over time.\\n\\n\\n41 CHAPTER 3 | Migrate large solut\", \"ions to ASP.NET Core\\n\\n\\n_Figure 3-5. The Strangler pattern over time._\\n\\n\\nEventually, the entire facad\", \"e layer corresponds to the new, modern implementation. At this point,\\nboth the legacy system and the\", \" face layer can be retired. Microsoft has guidance on how to achieve\\n[incremental ASP.NET to ASP.NET\", \" Core migration using the YARP reverse proxy.](https://devblogs.microsoft.com/dotnet/incremental-asp\", \"-net-to-asp-net-core-migration/)\\n\\n#### **Multi-targeting approaches**\\n\\n\\nMulti-targeting is recommend\", \"ed for large apps that will be migrated over time and for teams\\napplying the Strangler pattern appro\", \"ach. This approach can address BindingRedirect and package\\n[restoration challenges that surface from\", \" mixing PackageReference](https://docs.microsoft.com/nuget/consume-packages/package-references-in-pr\", \"oject-files) [and packages.config restore styles.](https://docs.microsoft.com/nuget/reference/packag\", \"es-config)\\nThere are two options available for code that must run in both .NET Framework and .NET Co\", \"re\\nenvironments.\\n\\n\\n  - [Preprocessor directives (#if in C#](https://docs.microsoft.com/en-us/dotnet/\", \"csharp/language-reference/preprocessor-directives#conditional-compilation) [or #If in Visual Basic) \", \"allow you to implement different](https://docs.microsoft.com/dotnet/visual-basic/reference/language-\", \"specification/preprocessing-directives#conditional-compilation)\\nfunctionality or use different depen\", \"dencies when run in .NET Framework versus .NET Core.\\n\\n\\n  - [Project files can use conditional globbi\", \"ng patterns, such as *.core.cs, to include different sets](https://docs.microsoft.com/en-us/dotnet/c\", \"ore/project-sdk/overview#default-includes-and-excludes)\\nof files based on which framework is being t\", \"argeted.\\n\\n\\nTypically you only follow these recommendations for class libraries. These techniques all\", \"ow a single\\ncommon codebase to be maintained while new functionality is added and features of the ap\", \"p are\\nincrementally ported to use .NET Core.\\n\\n#### **Summary**\\n\\n\\nFrequently, large ASP.NET MVC and W\", \"eb API apps won\\u2019t be ported to ASP.NET Core all at once, but\\nwill migrate incrementally over time. T\", \"his section offers several strategies for performing this\\nincremental migration. Choose the one(s) t\", \"hat will work best for your organization and app.\\n\\n#### **References**\\n\\n\\n  - [.NET Microservices: Ar\", \"chitecture for Containerized .NET Applications](https://aka.ms/microservicesebook)\\n\\n  - [eShopOnCont\", \"ainers Reference Microservices Application](https://github.com/dotnet-architecture/eShopOnContainers\", \")\\n\\n  - [Host ASP.NET Core on Windows with IIS](https://docs.microsoft.com/aspnet/core/host-and-deplo\", \"y/iis/)\\n\\n  - [Strangler pattern](https://docs.microsoft.com/azure/architecture/patterns/strangler)\\n\\n\", \"  - [Incremental ASP.NET to ASP.NET Core Migration](https://devblogs.microsoft.com/dotnet/incrementa\", \"l-asp-net-to-asp-net-core-migration/)\\n\\n\\n42 CHAPTER 3 | Migrate large solutions to ASP.NET Core\\n\\n\\n**C\", \"HAPTER**\\n# 4\\n\\n## Example migration of eShop to ASP.NET Core\\n\\n\\nIn this chapter, you\\u2019ll see how to mig\", \"rate a .NET Framework app to .NET Core. The chapter examines a\\nsample online store app written for A\", \"SP.NET MVC 5. The app will use many of the concepts and tools\\ndescribed earlier in this book. You\\u2019ll\", \" find the starting point app in the _[eShopModernizing](https://github.com/dotnet-architecture/eShop\", \"Modernizing)_ GitHub\\n[repository. There are several different starting point apps. This chapter focu\", \"ses on the](https://github.com/dotnet-architecture/eShopModernizing)\\n_eShopLegacyMVCSolution_ .\\n\\n\\nTh\", \"e initial version of the project is shown in Figure 4-1. It\\u2019s a fairly standard ASP.NET MVC 5 app.\\n\\n\", \"\\n_Figure 4-1. The eShopModernizing MVC sample project structure._\\n\\n\\n43 CHAPTER 4 | Example migration\", \" of eShop to ASP.NET Core\\n\\n\\nThis chapter demonstrates how to perform many of the upgrade steps by ha\", \"nd. Alternatively, you can\\n[use the .NET Upgrade Assistant tool to perform many of the initial steps\", \", like converting the project](https://aka.ms/dotnet-upgrade-assistant)\\nfile, changing the target fr\", \"amework, and updating NuGet packages.\\n\\n### Run ApiPort to identify problematic APIs\\n\\n\\nThe first step\", \" in preparing to migrate is to run the _ApiPort_ tool. The tool identifies how many .NET\\nFramework A\", \"PIs the app calls and how many of these have .NET Standard or .NET Core equivalents.\\nFocus primarily\", \" on your own app\\u2019s logic, not third-party dependencies, and pay attention to\\nSystem.Web dependencies\", \" that will need to be ported. The ApiPort tool was introduced in the last\\nchapter on understanding a\", \"nd updating dependencies. Note that currently it requires Visual Studio\\n2019; Visual Studio 2022 sup\", \"port is planned.\\n\\n\\n[After installing and configuring the](https://docs.microsoft.com/en-us/dotnet/st\", \"andard/analyzers/portability-analyzer) _ApiPort_ tool, run the analysis from within Visual Studio, a\", \"s shown\\nin Figure 4-2.\\n\\n\\n44 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\n_Figure 4-2. An\", \"alyze assembly portability in Visual Studio._\\n\\n\\nChoose the web project\\u2019s assembly from the project\\u2019s\", \" _bin_ folder, as shown in Figure 4-3.\\n\\n\\n45 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\", \"\\n_Figure 4-3. Choose the project\\u2019s web assembly._\\n\\n\\nIf your solution includes several projects, you \", \"can choose all of them. The _eShop_ sample includes just a\\nsingle MVC project.\\n\\n\\nOnce the report is \", \"generated, open the file and review the results. The summary provides a high-level\\nview of what perc\", \"entage of .NET Framework calls your app is making have compatible versions. Figure\\n4-4 shows the sum\", \"mary for the _eShop_ MVC project.\\n\\n\\n_Figure 4-4. ApiPort summary._\\n\\n\\nFor this app, about 80 percent \", \"of the .NET Framework calls are compatible. 20 percent of the calls\\nneed to be addressed during the \", \"porting process. Viewing the details reveals that all of the\\nincompatible calls are part of System.W\", \"eb, which is an expected incompatibility. The dependencies on\\nSystem.Web calls will be addressed whe\", \"n the app\\u2019s controllers and related classes are migrated in a\\nlater step. Figure 4-5 lists some of t\", \"he specific types found by the tool:\\n\\n\\n46 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\n_\", \"Figure 4-5. ApiPort incompatible type details._\\n\\n\\nMost of the incompatible types refer to Controller\", \" and various related attributes that have equivalents\\nin ASP.NET Core.\\n\\n### Update project files and\", \" NuGet reference syntax\\n\\n\\nNext, migrate from the older _.csproj_ file structure to the newer, simple\", \"r structure introduced with .NET\\nCore. In doing so, you\\u2019ll also migrate from using a _packages.confi\", \"g_ file for NuGet references to using\\n<PackageReference> elements in the project file. Old-style pro\", \"ject files may also use\\n<PackageReference> elements, so it usually makes sense to migrate all NuGet \", \"package references to\\nthis format first, before upgrading to the new project file format.\\n\\n\\nThe orig\", \"inal project\\u2019s _eShopLegacyMVC.csproj_ file is 418 lines long. A sample of the project file is\\nshown\", \" in Figure 4-6. To offer a sense of its overall size and complexity, the right side of the image\\ncon\", \"tains a miniature view of the entire file.\\n\\n\\n47 CHAPTER 4 | Example migration of eShop to ASP.NET Co\", \"re\\n\\n\\n_Figure 4-6. The eShopLegacyMVC.csproj file structure._\\n\\n\\nA common way to create a new project \", \"file for an existing ASP.NET project is to create a new ASP.NET\\nCore app using dotnet new or **File*\", \"* - **New** - **Project** in Visual Studio. Then files can be copied from\\nthe old project to the new\", \" one to complete the migration.\\n\\n\\nIn addition to the C# project file, NuGet dependencies are stored \", \"in a separate 45-line _packages.config_\\nfile, as shown in Figure 4-7.\\n\\n\\n48 CHAPTER 4 | Example migra\", \"tion of eShop to ASP.NET Core\\n\\n\\n_Figure 4-7. The packages.config file._\\n\\n\\nYou can migrate _packages.\", \"config_ in class library projects using Visual Studio. This functionality doesn\\u2019t\\nwork with ASP.NET \", \"projects, however. Learn more about migrating _[packages.config](https://docs.microsoft.com/nuget/co\", \"nsume-packages/migrate-packages-config-to-package-reference)_ to\\n[<PackageReference> in Visual Studi\", \"o. If you have a large number of projects to migrate, this](https://docs.microsoft.com/nuget/consume\", \"-packages/migrate-packages-config-to-package-reference)\\n[community tool may help. If you\\u2019re using a \", \"tool to migrate the project file to the new format, you](https://github.com/MarkKharitonov/NuGetPCTo\", \"PRMigrator)\\nshould do that after you\\u2019ve finished migrating all NuGet references to use <PackageRefer\", \"ence>.\\n\\n### Create new ASP.NET Core project\\n\\n\\nAdd a new ASP.NET Core project to the existing app\\u2019s s\", \"olution to make moving files easier, as most of\\nthe work can be done from within Visual Studio\\u2019s **S\", \"olution Explorer** . In Visual Studio, right-click on\\nyour app\\u2019s solution and choose **Add New Proje\", \"ct** . Choose **ASP.NET Core web application**, and give\\nthe new project a name as shown in Figure 4\", \"-8.\\n\\n\\n49 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\n_Figure 4-8. Add new ASP.NET Core \", \"web application._\\n\\n\\nThe next dialog will ask you to choose which template to use. Select the **Empty\", \"** template. Be sure to\\nalso change the dropdown from **.NET Core** to **.NET Framework** . Select *\", \"*ASP.NET Core 2.2**, as shown\\nin Figure 4-9.\\n\\n\\n50 CHAPTER 4 | Example migration of eShop to ASP.NET \", \"Core\\n\\n\\n_Figure 4-9. Choose an Empty project template targeting .NET Framework with ASP.NET Core 2.2.\", \"_\\n\\n#### **Migrating NuGet Packages**\\n\\n\\nSince the built-in migration tool for migrating _packages.con\", \"fig_ to <PackageReference> doesn\\u2019t work\\n[on ASP.NET projects, you can use a community tool instead, \", \"or migrate by hand. A community tool](https://gist.github.com/tomkuijsten/2d75074d9a3c19c04ee8ea19a6\", \"289ddf)\\n[I\\u2019ve used](https://gist.github.com/tomkuijsten/2d75074d9a3c19c04ee8ea19a6289ddf) uses an XS\", \"L file to transform from one format to the other. To use it, first copy the\\n_packages.config_ file t\", \"o the newly created ASP.NET Core project folder. Make a backup of your files, as\\nthis script removes\", \" the _packages.config_ file from all folders under where you run the script. Then run\\nthese commands\", \" from the project folder (or for the entire solution if you prefer):\\n\\n```\\niwr\\nhttps://gist.githubuse\", \"rcontent.com/aienabled/0bce5e4b17118122f2772e7c9218bf9c/raw/7789\\n53f89882877a7124894b47dccfb1ba3e80a\", \"0/Convert-ToPackageReference.ps1 -OutFile ConvertToPackageReference.ps1\\niwr\\nhttps://gist.githubuserc\", \"ontent.com/aienabled/0bce5e4b17118122f2772e7c9218bf9c/raw/7789\\n53f89882877a7124894b47dccfb1ba3e80a0/\", \"Convert-ToPackageReference.xsl -OutFile ConvertToPackageReference.xsl\\n./Convert-ToPackageReference.p\", \"s1 | Out-Null\\n\\n```\\n\\nThe first two commands download files so that they exist locally. The last line \", \"runs the script. After\\nrunning it, try to build the new project. You\\u2019ll most likely get some errors.\", \" To resolve them, you\\u2019ll want\\nto eliminate some references (like most of the Microsoft.AspNet and Sy\", \"stem packages), and you may\\nneed to remove some xmlns attributes.\\n\\n\\n51 CHAPTER 4 | Example migration\", \" of eShop to ASP.NET Core\\n\\n\\nIn most ASP.NET MVC apps, many client-side dependencies like Bootstrap a\", \"nd jQuery were deployed\\nusing NuGet packages. In ASP.NET Core, NuGet packages are only used for serv\", \"er-side functionality.\\nClient files should be managed through other means. Review the list of <Packa\", \"geReference>\\nelements added and remove and make note of any that are for client libraries, including\", \":\\n\\n\\n  - Bootstrap\\n\\n  - jQuery\\n\\n  - jQuery.Validation\\n\\n  - Modernizr\\n\\n  - popper.js\\n\\n  - Respond\\n\\nThe\", \" static client files installed by NuGet for these packages will be copied over to the new project\\u2019s\\n\", \"_wwwroot_ folder and hosted from there. It\\u2019s worth considering whether these files are still needed \", \"by\\nthe app, and whether it makes sense to continue hosting them or to use a content delivery network\", \"\\n[(CDN) instead. These library versions can be managed at build time using tools like LibMan or npm.\", \"](https://docs.microsoft.com/aspnet/core/client-side/libman/)\\nFigure 4-10 shows the full _eShopPorte\", \"d.csproj_ file after migrating package references using the\\nconversion tool shown and removing unnec\", \"essary packages.\\n\\n\\n_Figure 4-10. Package references in the eShopPorted.csproj file._\\n\\n\\nThe package r\", \"eferences can be further compacted by making the <Version>1.0.0.0</Version>\\nelement a Version=1.0.0.\", \"0 attribute on <PackageReference>.\\n\\n\\n52 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\n###\", \"# **Migrate static files**\\n\\nAny static files the app uses, including third-party scripts and framewo\", \"rks but also custom images and\\nstylesheets, must be copied from the old project to the new one. In A\", \"SP.NET MVC apps, files were\\ntypically accessed based on their location within the project folder. In\", \" ASP.NET Core apps, these static\\nfiles will be accessed based on their location within the _wwwroot_\", \" folder. For the _eShop_ project, there\\nare static files in the following folders:\\n\\n\\n  - _Content_\\n\\n\", \"  - _fonts_\\n\\n  - _Images_\\n\\n  - _Pics_\\n\\n  - _Scripts_\\n\\n\\nThe **Empty** project template used in the pr\", \"evious step doesn\\u2019t include this folder by default, or the\\nmiddleware needed for it to work. You\\u2019ll \", \"need to add them.\\n\\n\\nAdd a _wwwroot_ folder to the root of the project.\\n\\n\\nAdd version 2.2.0 of the Mi\", \"crosoft.AspNetCore.StaticFiles NuGet package.\\n\\n\\nIn _Startup.cs_, add a call to app.UseStaticFiles() \", \"in the Configure method:\\n\\n\\nCopy the _Content_ folder from the ASP.NET MVC app to the new project\\u2019s _\", \"wwwroot_ folder.\\n\\n\\nRun the app and navigate to its _/Content/base.css_ folder to verify that the sta\", \"tic file is served correctly\\nfrom its expected path. Continue copying the rest of the folders contai\", \"ning static files to the new\\nproject. You\\u2019ll also want to copy the _favicon.ico_ file from the proje\", \"ct\\u2019s root to the _wwwroot_ folder.\\nFigure 4-11 shows the results after these files and their folders\", \" have all been copied.\\n\\n\\n53 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\n_Figure 4-11. S\", \"tatic folders copied over to wwwroot folder._\\n\\n#### **Migrate C# files**\\n\\n\\nNext, copy over the C# fi\", \"les used by the app, including standard MVC folders and their contents like\\n_Controllers_, _Models_,\", \" _ViewModel_, and _Services_ . There will most likely be some changes needed in these\\nfiles. It\\u2019s be\", \"st to copy one folder (or subfolder) at a time and compile to see what errors need to be\\naddressed a\", \"s you go.\\n\\n\\nFor the _eShop_ sample, the first folder I choose to migrate is the _Models_ folder, whi\", \"ch includes C#\\nentities and Entity Framework classes. This folder\\u2019s classes are used by most of the \", \"others, so they\\nwon\\u2019t work until these classes have been copied. After copying the folder and buildi\", \"ng, the compiler\\nrevealed errors related to missing namespace System.Web.Hosting, related access to\\n\", \"HostingEnvironment, and a reference to ConfigurationManager.AppSettings. The solution to these\\nissue\", \"s will be to pass in the necessary path data; for now the breaking lines are commented out and a\\nTOD\", \"O: comment is added to each one to track it. After changing five lines, the **Task List** shows five\", \"\\nitems and the project builds.\\n\\n\\nNext, the _ViewModel_ folder, with its one class, is copied over. I\", \"t\\u2019s an easy one, and builds immediately.\\n\\n\\nThe _Services_ folder is copied over. This folder\\u2019s class\", \"es depend on Entity Framework classes from the\\n_Models_ folder, which is why it needed to be copied \", \"after that folder. Fortunately, it too builds without\\nerrors.\\n\\n\\n54 CHAPTER 4 | Example migration of \", \"eShop to ASP.NET Core\\n\\n\\nThat leaves the _Controllers_ folder and its two Controller classes. After c\", \"opying the folder to the new\\nproject and building, there are seven build errors. Four of them are re\", \"lated to ViewBag access and\\nreport an error of:\\n\\n\\nMissing compiler required member 'Microsoft.CSharp\", \".RuntimeBinder.CSharpArgumentInfo.Create'\\n\\n\\nTo resolve this error, add a NuGet package reference to \", \"C#:\\n\\n```\\n< PackageReference Include=\\\"Microsoft.CSharp\\\" Version=\\\"4.7.0\\\" />\\n\\n```\\n\\nThe remaining three \", \"errors specify types that are defined in an assembly that isn\\u2019t referenced.\\nSpecifically these types\", \":\\n\\n\\n  - HttpServerUtilityBase\\n\\n  - RouteValueDictionary\\n\\n  - HttpRequestBase\\n\\n\\nLet\\u2019s look at each er\", \"ror one by one. The first error occurs while trying to reference the Server property\\nof Controller, \", \"which no longer exists. The goal of the operation is to get the path to an image file in\\nthe app:\\n\\n\\n\", \"There are two possible solutions to this problem. The first is to keep the functionality as it is. I\", \"n this\\ncase, rather than using Server.MapPath, a fixed path referencing the image files\\u2019 location in\", \" _wwwroot_\\nshould be used. Alternately, since the only purpose of this action method is to return a \", \"static image\\nfile, the references to this action in view files can be updated to reference the stati\", \"c files directly, which\\nimproves runtime performance. Since no processing is being done as part of t\", \"his action, there\\u2019s no\\nreason not to just serve the files directly. If it\\u2019s not tenable to update al\", \"l references to this action, the\\naction could be rewritten to produce a redirect to the static file\\u2019\", \"s location.\\n\\n\\nThe next two errors both occur in the same private method in the same line of code:\\n\\n\\n\", \"Both this.Url and this.Request cause compiler errors. Looking at how this code is used, its purpose \", \"is\\nto build a link to the PicController action that renders image files. The same one we just discov\", \"ered\\ncould probably be replaced with direct links to the static files located in _wwwroot_ . For now\", \", it\\u2019s worth\\ncommenting out this code and adding a TODO: comment to reference the pics another way.\\n\", \"\\n\\n55 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\nIt\\u2019s worth noting that the base Contro\", \"ller class, used by the CatalogController class in which this code\\nappears, is still referring to Sy\", \"stem.Web.Mvc.Controller. There will undoubtedly be more errors to fix\\nonce we update this to use ASP\", \".NET Core. First, remove the using System.Web.Mvc; line from the list\\nof using statements in Catalog\", \"Controller. Next, add the NuGet package Microsoft.AspNetCore.Mvc.\\nFinally, add a using Microsoft.Asp\", \"NetCore.Mvc; statement, and build the app again.\\n\\n\\nThis time, there are 16 errors:\\n\\n\\n  - Include is \", \"not a valid named attribute argument (2)\\n\\n  - HttpStatusCodeResult not found (3)\\n\\n  - HttpNotFound d\", \"oes not exist (3)\\n\\n  - SelectList not found (8)\\n\\n\\nOnce more, let\\u2019s review these errors one by one. F\", \"irst, SelectList can be fixed by adding using\\nMicrosoft.AspNetCore.Mvc.Rendering;, which eliminates \", \"half of the errors.\\n\\n\\nAll references to return HttpNotFound(); should be replaced with return NotFou\", \"nd();.\\n\\n\\nAll references to return new HttpStatusCodeResult(HttpStatusCode.BadRequest); should be rep\", \"laced\\nwith return BadRequest();.\\n\\n\\nThat just leaves the use of Include with a [Bind] attribute on a \", \"couple of action methods that look like\\nthis:\\n\\n\\nThe preceding code restricts model binding to the pr\", \"operties listed in the Include string. In ASP.NET\\nCore MVC, the [Bind] attribute still exists, but n\", \"o longer needs the Include = argument. Pass the list of\\nproperties directly to the [Bind] attribute:\", \"\\n\\n\\nWith these changes, the project compiles once more. It\\u2019s generally a better practice to use separ\", \"ate\\nmodel types for controller inputs, rather than using model binding directly to your domain model\", \" or\\ndata model types.\\n\\n### Migrate views\\n\\n\\n[The two biggest ASP.NET Core MVC features related to vie\", \"ws are Razor Pages and Tag Helpers. For](https://docs.microsoft.com/aspnet/core/razor-pages/)\\nthe in\", \"itial migration, we won\\u2019t use either feature. You should, however, keep the features in mind if\\nyou \", \"continue supporting the app once it\\u2019s been migrated. The next step is to copy the _Views_ folder\\nfro\", \"m the original project into the new one. After building, there are nine errors:\\n\\n\\n56 CHAPTER 4 | Exa\", \"mple migration of eShop to ASP.NET Core\\n\\n\\n  - HttpContext does not exist (2)\\n\\n  - Scripts does not e\", \"xist (5)\\n\\n  - Styles does not exist (1)\\n\\n  - HtmlString could not be found(1)\\n\\nInvestigating these e\", \"rrors finds that most of them are in the main *_Layout.cshtml _, with several related_\\n_to rendering\", \" script and style tags, or displaying when the server hosting the app was last restarted. The_\\n_foll\", \"owing code listing shows problem areas in the_ _Layout.cshtml* file:\\n\\n\\nThe reference to Modernizr ca\", \"n be removed. The references to Bootstrap and jQuery can be replaced\\nwith CDN links to the appropria\", \"te version.\\n\\n\\nReplace @Styles.Render line with:\\n\\n\\nReplace the last two Scripts.Render lines with:\\n\\n\\n\", \"Finally, after the Bootstrap <link>, add additional <link> elements for local styles your app uses. \", \"For\\n_eShop_, the result is shown here:\\n\\n\\nTo determine the order in which the <link> elements should \", \"appear, look at your original app\\u2019s\\nrendered HTML. Alternatively, review _BundleConfig.cs_, which fo\", \"r the _eShop_ sample includes this code\\nindicating the appropriate sequence:\\n\\n\\n57 CHAPTER 4 | Exampl\", \"e migration of eShop to ASP.NET Core\\n\\n\\nBuilding again reveals one more error loading jQuery Validati\", \"on on the _Create_ and _Edit_ views. Replace\\nit with this script:\\n\\n\\nThe last thing to fix in the vie\", \"ws is the reference to Session to display how long the app has been\\nrunning, and on which machine. W\", \"e can display this data directly in the site\\u2019s *_Layout.cshtml* by\\nusing System.Environment.MachineN\", \"ame and\\nSystem.Diagnostics.Process.GetCurrentProcess().StartTime:\\n\\n\\nAt this point, the app once more\", \" builds successfully. However, trying to run it just yields _Hello World!_\\nbecause the **Empty** ASP\", \".NET Core template is only configured to display that in response to any\\nrequest. In the next sectio\", \"n, I complete the migration by configuring the app to use ASP.NET Core\\nMVC, including dependency inj\", \"ection and configuration. Once that\\u2019s in place, the app should run.\\nThen it will be time to fix the \", \"TODO: tasks that were created earlier.\\n\\n### Migrate app startup components\\n\\n\\nThe last migration step\", \" is to take the app startup tasks from _Global.asax_, and the classes it calls, and\\nmigrate these to\", \" their ASP.NET Core equivalents. These tasks include configuration of MVC itself,\\nsetting up depende\", \"ncy injection, and working with the new configuration system. In ASP.NET Core,\\nthese tasks are handl\", \"ed in the _Startup.cs_ file.\\n\\n#### **Configure MVC**\\n\\n\\nThe original ASP.NET MVC app has the followin\", \"g code in its Application_Start in _Global.asax_, which\\nruns when the app starts up:\\n\\n\\n58 CHAPTER 4 \", \"| Example migration of eShop to ASP.NET Core\\n\\n\\nLooking at these lines one by one, the RegisterContai\", \"ner method sets up dependency injection, which\\nwill be ported below. The next three lines configure \", \"different parts of MVC: areas, filters, and routes.\\nBundles are replaced by static files in the port\", \"ed app. The last line sets up data access for the app,\\nwhich will be shown in a later section.\\n\\n\\nSin\", \"ce this app isn\\u2019t actually using areas, there\\u2019s nothing that needs to be done to migrate the area\\n[r\", \"egistration call. If your app does need to migrate areas, the docs specify how to configure areas in\", \"](https://docs.microsoft.com/aspnet/core/mvc/controllers/areas)\\n[ASP.NET Core.](https://docs.microso\", \"ft.com/aspnet/core/mvc/controllers/areas)\\n\\n\\nThe call to register global filters invokes a helper on \", \"the FilterConfig class in the app\\u2019s _App_Start_\\nfolder:\\n\\n\\nThe only attribute added to the app is the\", \" ASP.NET MVC filter, HandleErrorAttribute. This filter ensures\\nthat when an exception occurs as part\", \" of a request, a default action and view are displayed, rather\\nthan the exception details. In ASP.NE\", \"T Core, this same functionality is performed by the\\nUseExceptionHandler middleware. The detailed err\", \"or messages aren\\u2019t enabled by default. They must\\nbe configured using the UseDeveloperExceptionPage m\", \"iddleware. To configure this behavior to match\\nthe original app, the following code must be added to\", \" the start of the Configure method in _Startup.cs_ :\\n\\n\\nThis takes care of the only filter used by th\", \"e eShop app, and in this case it was done by using built-in\\nmiddleware. If you have global filters t\", \"hat must be configured in your app, this is done when MVC is\\nadded in _Program.cs_ when you configur\", \"e services, which is shown later in this chapter.\\n\\n\\nThe last piece of MVC-related logic that needs t\", \"o be migrated are the app\\u2019s default routes. The call to\\nRouteConfig.RegisterRoutes(RouteTable.Routes\", \") passes the MVC route table to the RegisterRoutes\\nhelper method, where the following code is execut\", \"ed when the app starts up:\\n\\n\\n59 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\nTaking this\", \" code line-by-line, the first line sets up support for attribute routes. This is built into\\nASP.NET \", \"Core, so it\\u2019s unnecessary to configure it separately. Likewise, _{resource}.axd_ files aren\\u2019t used\\nw\", \"ith ASP.NET Core, so there\\u2019s no need to ignore such routes. The MapRoute method configures the\\ndefau\", \"lt for MVC, which uses the typical {controller}/{action}/{id} route template. It also specifies the\\n\", \"defaults for this template, such that the CatalogController is the default controller used and the I\", \"ndex\\nmethod is the default action. Larger apps will frequently include more calls to MapRoute to set\", \" up\\nadditional routes.\\n\\n\\n[ASP.NET Core MVC supports conventional routing and attribute routing. Conv\", \"entional routing is](https://docs.microsoft.com/aspnet/core/mvc/controllers/routing?preserve-view=tr\", \"ue&view=aspnetcore-2.2)\\nanalogous to how the route table is configured in the RegisterRoutes method \", \"listed previously. To set\\nup conventional routing with a default route like the one used in the _eSh\", \"op_ app, add the following\\ncode to the bottom of the Configure method in _Startup.cs_ :\\n\\n\\n\\n\\n\\nWith th\", \"ese changes in place, the Configure method is almost done. The original template\\u2019s app.Run\\nmethod th\", \"at prints _Hello World!_ should be deleted. At this point, the method is as shown here:\\n\\n\\nNow it\\u2019s t\", \"ime to configure MVC services, followed by the rest of the app\\u2019s support for dependency\\ninjection (D\", \"I). So far, the _eShopPorted_ project\\u2019s _Program.cs_ file hasn\\u2019t added any service configuration.\\nNo\", \"w it\\u2019s time to start adding necessary services.\\n\\n\\nFirst, to get ASP.NET Core MVC to work properly, i\", \"t needs to be added:\\n\\n\\n60 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\n```\\nbuilder.Servi\", \"ces.AddMvc();\\n\\n```\\n\\nThe preceding code is the minimal configuration required to get MVC features wor\", \"king. There are\\nmany additional features that can be configured from this call (some of which are de\", \"tailed later in this\\nchapter), but for now this will suffice to build the app. Running it now routes\", \" the default request\\nproperly, but since we\\u2019ve not yet configured DI, an error occurs while activati\", \"ng CatalogController,\\nbecause no implementation of type ICatalogService has been provided yet. We\\u2019ll\", \" return to configure\\nMVC further in a moment. For now, let\\u2019s migrate the app\\u2019s dependency injection.\", \"\\n\\n\\n**Migrate dependency injection configuration**\\n\\n\\nThe original app\\u2019s _Global.asax_ file defines th\", \"e following method, called when the app starts up:\\n\\n\\n[This code configures an Autofac container, rea\", \"ds a config setting to determine whether real or mock](https://autofac.org/)\\ndata should be used, an\", \"d passes this setting into an Autofac module (found in the app\\u2019s _/Modules_\\ndirectory). Fortunately,\", \" Autofac supports .NET Core, so the module can be migrated directly. Copy the\\nfolder into the new pr\", \"oject and updates the class\\u2019s namespace and it should compile.\\n\\n\\nASP.NET Core has built-in support f\", \"or dependency injection, but you can wire up a third-party\\ncontainer such as Autofac easily if neces\", \"sary. In this case, since the app is already configured to use\\nAutofac, the simplest solution is to \", \"maintain its usage. In _Program.cs_, simply configure the builder to\\nuse the AutofacServiceProviderF\", \"actory as shown:\\n\\n\\nFor now, the setting for useMockData is set to true. This setting will be read fr\", \"om configuration in a\\nmoment. At this point, the app compiles and should load successfully when run,\", \" as shown in Figure 412.\\n\\n\\n61 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\n_Figure 4-12.\", \" Ported eShop app running locally with mock data._\\n\\n\\n**Migrate app settings**\\n\\n\\n[ASP.NET Core uses a\", \" new configuration system, which by default uses an](https://docs.microsoft.com/aspnet/core/fundamen\", \"tals/configuration/?preserve-view=true&view=aspnetcore-2.2) _appsettings.json_ file. By using\\nCreate\", \"DefaultBuilder in _Program.cs_, the default configuration is already set up in the app. To access\\nco\", \"nfiguration, classes just need to request it in their constructor. In _Program.cs_, configuration is\", \"\\naccessible from builder.Configuration.\\n\\n\\nThe original app referenced its settings using Configurati\", \"onManager.AppSettings. A quick search for\\nall references of this term yields the set of settings the\", \" new app needs. There are only two:\\n\\n\\n  - UseMockData\\n\\n  - UseCustomizationData\\n\\n\\nIf your app has mo\", \"re complex configuration, especially if it\\u2019s using custom configuration sections,\\nyou\\u2019ll probably wa\", \"nt to create and bind objects to different parts of your app\\u2019s configuration. These\\n[types can then \", \"be accessed using the options pattern. However, as noted in the referenced doc, this](https://docs.m\", \"icrosoft.com/en-us/dotnet/core/extensions/options)\\npattern shouldn\\u2019t be used in _Program.cs_ (or Sta\", \"rtup.ConfigureServices). Instead the ported app will\\nreference the UseMockData configuration value d\", \"irectly.\\n\\n\\nFirst, modify the ported app\\u2019s appsettings.json file and add the two settings in the root\", \":\\n\\n\\n62 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\nNow, modify _Program.cs_ to access t\", \"he UseMockData setting from the builder.Configuration property\\n(where previously we set the value to\", \" true):\\n\\n```\\nbool useMockData = builder.Configuration.GetValue<bool>(\\\"UseMockData\\\");\\n\\n```\\n\\nAt this p\", \"oint, the setting is pulled from configuration. The other setting, UseCustomizationData, is\\nused by \", \"the CatalogDBInitializer class. When you first ported this class, you commented out the access\\nto Co\", \"nfigurationManager.AppSettings[\\\"UseCustomizationData\\\"]. Now it\\u2019s time to modify it to use\\nASP.NET Co\", \"re configuration. Modify the constructor of CatalogDBInitializer as follows:\\n\\n\\nAll access to configu\", \"ration within the web app should be modified in this manner to use the new\\nIConfiguration type. Depe\", \"ndencies that require access to .NET Framework configuration can include\\nsuch settings in an _app.co\", \"nfig_ file added to the web project. The dependent projects can work with\\nConfigurationManager to ac\", \"cess settings, and shouldn\\u2019t require any changes if they already use this\\napproach. However, since A\", \"SP.NET Core apps run as their own executable, they don\\u2019t reference\\n_web.config_ but rather _app.conf\", \"ig_ . By migrating settings from the legacy app\\u2019s _web.config_ file to a new\\n_app.config_ file in th\", \"e ASP.NET Core app, components that use ConfigurationManager to access their\\nsettings will continue \", \"to function properly.\\n\\n\\nThe app\\u2019s migration is nearly complete. The only remaining task is data acce\", \"ss configuration.\\n\\n### Data access considerations\\n\\n\\nASP.NET Core apps running on .NET Framework can \", \"continue to use Entity Framework (EF). If\\nperforming an incremental migration, getting the app worki\", \"ng with EF 6 before trying to port its data\\naccess to use EF Core may be worthwhile. In this way, an\", \"y problems with the app\\u2019s migration can be\\nidentified and addressed before another block of migratio\", \"n effort is begun.\\n\\n\\nAs it happens, configuring EF 6 in the eShop sample migration doesn\\u2019t require a\", \"ny special work, since\\nthis work was performed in the Autofac ApplicationModule. The only problem is\", \" that currently the\\nCatalogDBContext class tries to read its connection string from _web.config_ . T\", \"o address this, the\\nconnection details need to be added to _appsettings.json_ . Then the connection \", \"string must be passed\\ninto CatalogDBContext when it\\u2019s created.\\n\\n\\nUpdate the _appsettings.json_ to in\", \"clude the connection string. The full file is listed here:\\n\\n\\n63 CHAPTER 4 | Example migration of eSh\", \"op to ASP.NET Core\\n\\n\\nThe connection string must be passed into the constructor when the DbContext is\", \" created. Since the\\ninstances are created by Autofac, the change needs to be made in ApplicationModu\", \"le. Modify the\\nmodule to take in a connectionString in its constructor and assign it to a field. The\", \"n modify the\\nregistration for CatalogDBContext to add connection string as a parameter:\\n\\n\\nThe parame\", \"ter must also be added to a new constructor overload in CatalogDBContext itself:\\n\\n\\nFinally, _Program\", \".cs_ must read the connection string from Configuration and pass it into the\\nApplicationModule when \", \"it instantiates it:\\n\\n\\nWith this code in place, the app runs as it did before, connecting to a SQL Se\", \"rver database when\\nUseMockData is false.\\n\\n\\nThe app can be deployed and run in production at this poi\", \"nt, converted to ASP.NET Core but still\\nrunning on .NET Framework and EF 6. If desired, the app can \", \"be migrated to run on .NET Core and\\nEntity Framework Core, which will bring additional advantages de\", \"scribed in earlier chapters. Specific\\n[to Entity Framework, this documentation compares EF Core and \", \"EF 6 and includes a grid showing](https://docs.microsoft.com/ef/efcore-and-ef6/)\\nwhich library suppo\", \"rts each of dozens of individual features.\\n\\n#### **Migrate to Entity Framework Core**\\n\\n\\nAssuming a d\", \"ecision is made to migrate to EF Core, the steps can be fairly straightforward, especially\\n[if the o\", \"riginal app used a code-based model approach. When preparing to port from EF 6 to EF Core,](https://\", \"docs.microsoft.com/ef/efcore-and-ef6/porting/)\\nreview the availability of features in the destinatio\", \"n version of EF Core you\\u2019ll be using. Review the\\n[documentation on porting from and EDMX-based model\", \"](https://docs.microsoft.com/ef/efcore-and-ef6/porting/port-edmx) [versus porting from a code-based \", \"model.](https://docs.microsoft.com/ef/efcore-and-ef6/porting/port-code)\\n\\n\\n64 CHAPTER 4 | Example mig\", \"ration of eShop to ASP.NET Core\\n\\n\\nTo upgrade to EF Core 2.2, the basic steps involved are to add the\", \" appropriate NuGet package(s) and\\nupdate namespaces. Then adjust how the connection string is passed\", \" to the DbContext type and how\\nthey\\u2019re wired up for dependency injection.\\n\\n\\nEF Core is added as a pa\", \"ckage reference to the project:\\n\\n```\\n< PackageReference Include=\\\"Microsoft.EntityFrameworkCore\\\" Vers\", \"ion=\\\"2.2.6\\\" />\\n\\n```\\n\\nThe reference to EF 6 is removed:\\n\\n```\\n< PackageReference Include=\\\"EntityFramew\", \"ork\\\" Version=\\\"6.2.0\\\" />\\n\\n```\\n\\nThe compiler will report errors in CatalogDBContext and CatalogDBIniti\", \"alizer. CatalogDbContext\\nneeds to have the old namespaces removed and replaced with Microsoft.Entity\", \"FrameworkCore. Its\\nconstructors can be removed. DbModelBuilder should be replaced with ModelBuilder.\", \" The helper\\nmethods for configuring types are moved to separate classes implementing\\nIEntityTypeConf\", \"iguration<T>. Then the CatalogDBContext class\\u2019s OnModelCreating method simply\\nbecomes:\\n\\n\\nOther chang\", \"es involved include:\\n\\n\\n  - HasDatabaseGeneratedOption(DatabaseGeneratedOption.None) replaced with\\nVa\", \"lueGeneratedNever()\\n\\n  - HasRequired<T> replaced with HasOne<T>\\n\\n  - Installed Microsoft.EntityFrame\", \"workCore.Relational package\\n\\n  - Add a constructor to CatalogDBContext taking DbContextOptions and p\", \"assing it to the base\\nconstructor\\n\\n\\nAn example configuration class for CatalogType is shown here:\\n\\n\\n\", \"65 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\nThe CatalogDBInitializer and its base cl\", \"ass, CreateDatabaseIfNotExists<T>, are incompatible with EF\\n[Core. The purpose of this class is to c\", \"reate and seed the database. Using EF Core will create and drop](https://docs.microsoft.com/ef/core/\", \"managing-schemas/ensure-created)\\n[the associated database for a DbContext using these methods:](http\", \"s://docs.microsoft.com/ef/core/managing-schemas/ensure-created)\\n\\n\\nSeeding data in EF Core can be don\", \"e with manual scripts, or as part of the type configuration. Along\\nwith other entity properties, see\", \"d data can be configured in IEntityTypeConfiguration classes by using\\nbuilder.HasData(). The origina\", \"l app loaded seed data from CSV files in the _Setup_ directory. Given that\\nthere are only a handful \", \"of items, these data records can instead be added as part of the entity\\nconfiguration. This approach\", \" works well for lookup data in tables that change infrequently. Adding the\\nfollowing to CatalogTypeC\", \"onfig\\u2019s Configure method ensures the associated rows are present when\\nthe database is created:\\n\\n\\nThe\", \" initial app includes a PreconfiguredData class, which includes data for CatalogBrand and\\nCatalogTyp\", \"e, so using this method the HasData call reduces to:\\n\\n\\nThe CatalogItem data can also be pulled from \", \"PreconfiguredData, and assuming the associated\\nimages are kept in source control, that is the last t\", \"able needed for the app to function. The\\nCatalogDBInitializer class can be removed, along with any r\", \"eferences to it. The\\nCatalogItemHiLoGenerator class and the SQL files in the Infrastructure director\", \"y are also removed,\\nalong with any references to them (in CatalogService, ApplicationModule).\\n\\n\\nWith\", \" the elimination of the special key generator classes for CatalogItem, this code now is removed\\nfrom\", \" CatalogItemConfig:\\n\\n\\nWith these modifications, the ASP.NET Core app builds, but it doesn\\u2019t yet work\", \" with EF Core, which\\nmust still be configured for dependency injection. With EF Core, the simplest w\", \"ay to configure it is in\\n_Program.cs_ :\\n\\n\\n66 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\", \"\\n\\nThe final version of Autofac\\u2019s ApplicationModule only configures one type, depending on whether th\", \"e\\napp is configured to use mock data:\\n\\n\\nThe ported app runs, but doesn\\u2019t display any data if configu\", \"red to use non-mock data. The seed data\\nadded through HasData is only inserted when migrations are a\", \"pplied. The source app didn\\u2019t use\\nmigrations, and if it had, they wouldn\\u2019t migrate as-is. The best a\", \"pproach is to start with a new\\nmigration script. To do this, add a package reference for Microsoft.E\", \"ntityFrameworkCore.Design and\\nopen a terminal window in the project root. Then run:\\n\\n```\\ndotnet ef m\", \"igrations add Initial\\n\\n```\\n\\nDrop the existing _eShopPorted_ database if it exists, then run:\\n\\n```\\ndo\", \"tnet ef database update\\n\\n```\\n\\nThis creates and seeds the database. It\\u2019s now ready to run, with a few\", \" small updates left to address.\\n\\n### Fix all TODO tasks\\n\\n\\nRunning the ported app at this point revea\", \"ls that no pictures are shown on the page. This is because\\nthe PictureUri property of CatalogItem is\", \" never set. Looking at the list of TODO items we created\\n\\n\\n67 CHAPTER 4 | Example migration of eShop\", \" to ASP.NET Core\\n\\n\\nusing Visual Studio\\u2019s **Task List**, the only one that remains is in CatalogContr\", \"oller, with a note to\\n\\u201cReference pic from wwwroot.\\u201d The code in question is:\\n\\n\\nThe simplest fix is t\", \"o reference the public image files in the site\\u2019s public _wwwroot/Pics_ directory. This\\ntask can be a\", \"ccomplished by replacing the method with the following code:\\n\\n\\nWith this change, running the app rev\", \"eals the images work as before.\\n\\n### Additional MVC customizations\\n\\n\\nThe _eShopLegacyMVC_ app is fai\", \"rly simple, so there isn\\u2019t much to configure in terms of default MVC\\nbehavior. However, if you do ne\", \"ed to configure additional MVC components, such as CORS, filters,\\nand route constraints, you general\", \"ly provide this information in _Program.cs_, where UseMvc is called.\\n[For example, the following cod\", \"e listing configures CORS](https://docs.microsoft.com/aspnet/core/security/cors?preserve-view=true&v\", \"iew=aspnetcore-2.2) and sets up a global action filter:\\n\\n\\n\\n\\n\\n\\n\\n[Other advanced scenarios, like addin\", \"g custom model binders, formatters, and more are covered in the](https://docs.microsoft.com/aspnet/c\", \"ore/mvc/advanced/custom-model-binding?preserve-view=true&view=aspnetcore-2.2)\\ndetailed ASP.NET Core \", \"docs. Generally these can be applied on an individual controller or action basis,\\nor globally using \", \"the same options approach shown in the previous code listing.\\n\\n\\n68 CHAPTER 4 | Example migration of \", \"eShop to ASP.NET Core\\n\\n\\n### Other dependencies\\n\\nDependencies that use .NET Framework features that h\", \"ad a dependency on the legacy configuration\\nmodel, such as the WCF client type and tracing code, mus\", \"t be modified when ported. Rather than\\nhaving these types pull in their configuration information di\", \"rectly, they should be configured in code.\\nFor example, a connection to a WCF service that was confi\", \"gured in an ASP.NET app\\u2019s _web.config_ to use\\nbasicHttpBinding could instead be configured programma\", \"tically with the following code:\\n\\n\\nRather than relying on config files for its settings, WCF clients\", \" and other .NET Framework types should\\nhave their settings specified in code. Configured in this man\", \"ner, these types can continue to work in\\nASP.NET Core 2.2 apps.\\n\\n### References\\n\\n\\n  - [eShopModerniz\", \"ing GitHub repository](https://github.com/dotnet-architecture/eShopModernizing)\\n\\n  - [.NET Upgrade A\", \"ssistant tool](https://aka.ms/dotnet-upgrade-assistant)\\n\\n  - [Your API and ViewModels Should Not Ref\", \"erence Domain Models](https://ardalis.com/your-api-and-view-models-should-not-reference-domain-model\", \"s/)\\n\\n  - [Developer Exception Page Middleware](https://docs.microsoft.com/aspnet/core/fundamentals/e\", \"rror-handling#developer-exception-page)\\n\\n  - [Deep Dive into EF Core HasData](https://docs.microsoft\", \".com/archive/msdn-magazine/2018/august/data-points-deep-dive-into-ef-core-hasdata-seeding)\\n\\n### More\", \" migration scenarios\\n\\n\\nThis section describes several different ASP.NET app scenarios, and offers sp\", \"ecific techniques for\\nsolving each of them. You can use this section to identify scenarios applicabl\", \"e to your app, and\\nevaluate which techniques will work for your app and its hosting environment.\\n\\n##\", \"## **Migrate ASP.NET MVC 5 and WebApi 2 to ASP.NET Core MVC**\\n\\n\\nA common scenario in ASP.NET MVC 5 a\", \"nd Web API 2 apps was for both products to be installed in\\nthe same application. This is a supported\", \" and relatively common approach used by many teams, but\\nbecause the two products use different abstr\", \"actions, there is some redundant effort needed. For\\nexample, setting up routes for ASP.NET MVC is do\", \"ne using methods on RouteCollection, such as\\nMapMvcAttributeRoutes() and MapRoute(). But ASP.NET Web\", \" API 2 routing is managed with\\nHttpConfiguration and methods like MapHttpAttributeRoutes() and MapHt\", \"tpRoute().\\n\\n\\nThe eShopLegacyMVC app includes both ASP.NET MVC and Web API, and includes methods in i\", \"ts\\nApp_Start folder for setting up routes for both. It also supports dependency injection using Auto\", \"fac,\\nwhich also requires two sets of similar work to configure:\\n\\n\\n69 CHAPTER 4 | Example migration o\", \"f eShop to ASP.NET Core\\n\\n\\nWhen upgrading these apps to use ASP.NET Core, this duplicate effort and t\", \"he confusion that\\nsometimes accompanies it is eliminated. ASP.NET Core MVC is a unified framework wi\", \"th one set of\\nrules for routing, filters, and more. Dependency injection is built into .NET Core its\", \"elf. All of this can be\\nconfigured in _Program.cs_, as is shown in the eShopPorted app in the sample\", \".\\n\\n#### **Migrate HttpResponseMessage to ASP.NET Core**\\n\\n\\nSome ASP.NET Web API apps may have action \", \"methods that return HttpResponseMessage. This type\\ndoes not exist in ASP.NET Core. Below is an examp\", \"le of its usage in a Delete action method, using the\\nResponseMessage helper method on the base ApiCo\", \"ntroller:\\n\\n\\nIn ASP.NET Core MVC, there are helper methods available for all of the common HTTP respo\", \"nse status\\ncodes, so the above method would be ported to the following code:\\n\\n\\n70 CHAPTER 4 | Exampl\", \"e migration of eShop to ASP.NET Core\\n\\n\\nIf you do find that you need to return a custom status code f\", \"or which no helper exists, you can always\\nuse return StatusCode(int statusCode) to return any numeri\", \"c code you like.\\n\\n#### **Migrate content negotiation from ASP.NET Web API to ASP.NET Core**\\n\\n\\n[ASP.N\", \"ET Web API 2 supports content negotiation](https://docs.microsoft.com/aspnet/web-api/overview/format\", \"s-and-model-binding/content-negotiation) natively. The sample app includes a\\nBrandsController that d\", \"emonstrates this support by listing its results in either XML or JSON. This is\\nbased on the request\\u2019\", \"s Accept header, and changes when it includes application/xml or\\napplication/json.\\n\\n\\nASP.NET MVC 5 a\", \"pps do not have content negotiation support built in.\\n\\n\\nContent negotiation is preferable to returni\", \"ng a specific encoding type, as it is more flexible and\\nmakes the API available to a larger number o\", \"f clients. If you currently have action methods that return\\na specific format, you should consider m\", \"odifying them to return a result type that supports content\\nnegotiation when you port the code to AS\", \"P.NET Core.\\n\\n\\nThe following code returns data in JSON format regardless of client Accept header cont\", \"ent:\\n\\n\\n[ASP.NET Core MVC supports content negotiation natively, provided an appropriate return type \", \"is](https://docs.microsoft.com/aspnet/core/web-api/advanced/formatting)\\nused. Content negotiation is\", \" implemented by [ObjectResult] which is returned by the status codespecific action results returned \", \"by the controller helper methods. The previous action method,\\nimplemented in ASP.NET Core MVC and us\", \"ing content negotiation, would be:\\n\\n\\n[This will default to returning the data in JSON format. XML an\", \"d other formats will be used if the app](https://docs.microsoft.com/aspnet/core/web-api/advanced/for\", \"matting)\\n[has been configured with the appropriate formatter.](https://docs.microsoft.com/aspnet/cor\", \"e/web-api/advanced/formatting)\\n\\n#### **Custom model binding**\\n\\n\\nMost ASP.NET MVC and Web API apps ma\", \"ke use of model binding. The default model binding syntax\\nmigrates fairly seamlessly between these a\", \"pps and ASP.NET Core MVC. However, in some cases\\n[customers have written custom model binders to sup\", \"port specific model types or usage scenarios.](https://docs.microsoft.com/aspnet/web-api/overview/fo\", \"rmats-and-model-binding/parameter-binding-in-aspnet-web-api#model-binders)\\nCustom model binders in A\", \"SP.NET MVC and Web API projects use separate IModelBinder interfaces\\ndefined in System.Web.Mvc and S\", \"ystem.Web.Http namespaces, respectively. In both cases, the custom\\n\\n\\n71 CHAPTER 4 | Example migratio\", \"n of eShop to ASP.NET Core\\n\\n\\nbinder exposes a Bind method that accepts a controller or action contex\", \"t and a model binding context\\nas arguments.\\n\\n\\nOnce the custom binder is created, it must be register\", \"ed with the app. This step requires creating\\nanother type, a ModelBinderProvider, which acts as a fa\", \"ctory and creates the model binder during a\\nrequest. Binders can be added during ApplicationStart in\", \" MVC apps as shown:\\n\\n```\\nModelBinderProviders.BinderProviders.Insert(0, new MyCustomBinderProvider()\", \"); // MVC\\n\\n```\\n\\nIn Web API apps, custom binders can be referenced using attributes. The ModelBinder \", \"attribute can\\nbe added to action method parameters or to the parameter\\u2019s type definition, as shown:\\n\", \"\\n\\nTo register a model binder globally in ASP.NET Web API, its provider must be added during app\\nstar\", \"tup:\\n\\n\\n[When migrating custom model providers to ASP.NET Core, the Web API pattern is closer to the]\", \"(https://docs.microsoft.com/aspnet/core/mvc/advanced/custom-model-binding#custom-model-binder-sample\", \")\\nASP.NET Core approach than the ASP.NET MVC 5. The main differences between ASP.NET Core\\u2019s\\nIModelBi\", \"nder interface and Web API\\u2019s is that the ASP.NET Core method is async (BindModelAsync)\\nand it only r\", \"equires a single BindingModelContext parameter instead of two parameters like Web\\nAPI\\u2019s version requ\", \"ired. In ASP.NET Core, you can use a [ModelBinder] attribute on individual action\\nmethod parameters \", \"or their associated types. You can also create a ModelBinderProvider that will be\\nused globally with\", \"in the app where appropriate. To configure such a provider, you would add code to\\n_Program.cs_ :\\n\\n\\n7\", \"2 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\n#### **Media formatters**\\n\\nASP.NET Web AP\", \"I supports multiple media formats and can be extended by using custom media\\n[formatters. The docs de\", \"scribe an example CSV Media Formatter](https://docs.microsoft.com/aspnet/web-api/overview/formats-an\", \"d-model-binding/media-formatters#example-creating-a-csv-media-formatter) that can be used to send da\", \"ta in a\\ncomma-separated value format. If your Web API app uses custom media formatters, you\\u2019ll need \", \"to\\n[convert them to ASP.NET Core custom formatters.](https://docs.microsoft.com/aspnet/core/web-api/\", \"advanced/custom-formatters)\\n\\n\\nTo create a custom formatter in Web API 2, you inherited from an appro\", \"priate base class and then\\nadded the formatter to the Web API pipeline using the HttpConfiguration o\", \"bject:\\n\\n\\nIn ASP.NET Core, the process is similar. ASP.NET Core supports both input formatters (used \", \"by model\\nbinding) and output formatters (used to format responses). Adding a custom formatter to out\", \"put\\nresponses in a specific way involves inheriting from an appropriate base class and adding the\\nfo\", \"rmatter to MVC in _Program.cs_ :\\n\\n\\n[You\\u2019ll find a complete list of base classes in the Microsoft.Asp\", \"NetCore.Mvc.Formatters](https://docs.microsoft.com/dotnet/api/microsoft.aspnetcore.mvc.formatters) n\", \"amespace.\\n\\n\\nThe steps to migrate from a Web API formatter to an ASP.NET Core MVC formatter are:\\n\\n\\n1.\", \" Identify an appropriate base class for the new formatter.\\n\\n2. Create a new instance of the base cla\", \"ss and implement its required methods.\\n\\n3. Copy over the functionality from the Web API formatter to\", \" the new implementation.\\n\\n4. Configure MVC in the ASP.NET Core App\\u2019s ConfigureServices method to use\", \" the new\\nformatter.\\n\\n#### **Custom filters**\\n\\n\\nFilters are used in ASP.NET Core apps to execute code\", \" before and/or after certain stages in the\\nrequest processing pipeline. ASP.NET MVC and Web API also\", \" use filters in much the same way, but the\\n[details vary. For instance, ASP.NET MVC supports four ki\", \"nds of filters. ASP.NET Web API 2 supports](https://docs.microsoft.com/aspnet/mvc/overview/older-ver\", \"sions-1/controllers-and-routing/understanding-action-filters-cs#the-different-types-of-filters)\\n[sim\", \"ilar filters, and both MVC and Web API included attributes to override filters.](https://docs.micros\", \"oft.com/dotnet/api/system.web.mvc.filters.ioverridefilter)\\n\\n\\nThe most common filter used in ASP.NET \", \"MVC and Web API apps is the action filter, which is defined\\n[by an IActionFilter interface. This int\", \"erface provides methods for before (OnActionExecuting) and after](https://docs.microsoft.com/dotnet/\", \"api/system.web.mvc.iactionfilter)\\n(OnActionExecuted) which can be used to execute code before and/or\", \" after an action executes, as\\nnoted for each method.\\n\\n\\nASP.NET Core continues to support filters, an\", \"d its unification of MVC and Web API means there is only\\n[one approach to their implementation. The \", \"docs include detailed coverage of the five (5) kinds of](https://docs.microsoft.com/aspnet/core/mvc/\", \"controllers/filters#filter-types)\\n[filters built into ASP.NET Core MVC. All of the filter variants s\", \"upported in ASP.NET MVC and ASP.NET](https://docs.microsoft.com/aspnet/core/mvc/controllers/filters#\", \"filter-types)\\n\\n\\n73 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\nWeb API have associated \", \"versions in ASP.NET Core, so migration is generally just a matter of\\nidentifying the appropriate int\", \"erface and/or base class and migrating the code over.\\n\\n\\nIn addition to the synchronous interfaces, A\", \"SP.NET Core also provides async interfaces like\\nIAsyncActionFilter which provide a single async meth\", \"od that can be used to incorporate code to run\\nboth before and after the action, as shown:\\n\\n\\nWhen mi\", \"grating async code (or code that should be async), teams should consider leveraging the\\nbuilt in asy\", \"nc types that are provided for this purpose.\\n\\n\\nMost ASP.NET MVC and Web API apps do not use a large \", \"number of custom filters. Since the\\napproach to filters in ASP.NET Core MVC is closely aligned with \", \"filters in ASP.NET MVC and Web API,\\nthe migration of custom filters is generally fairly straightforw\", \"ard. Be sure to read the detailed\\ndocumentation on filters in ASP.NET Core\\u2019s docs, and once you\\u2019re s\", \"ure you have a good\\nunderstanding of them, port the logic from the old system to the new system\\u2019s fi\", \"lters.\\n\\n#### **Route constraints**\\n\\n\\nASP.NET Core uses route constraints to help ensure requests are\", \" routed properly to route a request.\\n[ASP.NET Core supports a large number of different route constr\", \"aints for this purpose. Route](https://docs.microsoft.com/aspnet/core/fundamentals/routing#route-con\", \"straint-reference)\\nconstraints can be applied in the route table, but most apps built with ASP.NET M\", \"VC 5 and/or\\n[ASP.NET Web API 2](https://docs.microsoft.com/aspnet/web-api/overview/web-api-routing-a\", \"nd-actions/attribute-routing-in-web-api-2#route-constraints) use inline route constraints applied to\", \" attribute routes. Inline route constraints use\\na format like this one:\\n\\n```\\n[Route(\\\"/customer/{id:i\", \"nt}\\\")]\\n\\n```\\n\\nThe :int after the id route parameter constrains the value to match the int type. One b\", \"enefit of using\\nroute constraints is that they allow for two otherwise-identical routes to exist whe\", \"re the parameters\\n[differ only by their type. This allows for the equivalent of method overloading](\", \"https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/member-overloading) of routes bas\", \"ed solely\\non parameter type.\\n\\n\\nThe set of route constraints, their syntax, and usage is very similar\", \" between all three approaches.\\nCustom route constraints are fairly rare in customer applications. If\", \" your app uses a custom route\\n[constraint and needs to port to ASP.NET Core, the docs include exampl\", \"es showing how to create](https://docs.microsoft.com/aspnet/core/fundamentals/routing#custom-route-c\", \"onstraints)\\n[custom route constraints in ASP.NET Core. Essentially all that\\u2019s required is to impleme\", \"nt](https://docs.microsoft.com/aspnet/core/fundamentals/routing#custom-route-constraints)\\nIRouteCons\", \"traint and its Match method, and then add the custom constraint when configuring\\nrouting for the app\", \":\\n\\n\\n74 CHAPTER 4 | Example migration of eShop to ASP.NET Core\\n\\n\\nThis is very similar to how custom c\", \"onstraints are used in ASP.NET Web API, which uses\\nIHttpRouteConstraint and configures it using a re\", \"solver and a call to\\nHttpConfiguration.MapHttpAttributeRoutes:\\n\\n\\nASP.NET MVC 5 follows a very simila\", \"r approach, using IRouteConstraint for its interface name and\\nconfiguring the constraint as part of \", \"route configuration:\\n\\n\\nMigrating route constraint usage as well as custom route constraints to ASP.N\", \"ET Core is typically very\\nstraightforward.\\n\\n#### **Custom route handlers**\\n\\n\\nAnother fairly advanced\", \" feature of ASP.NET MVC 5 is route handlers. Custom route handlers\\nimplement IRouteHandler, which in\", \"cludes a single method that returns an IHttpHandler for a give\\nrequest. The IHttpHandler, in turn, e\", \"xposes an IsReusable property and a single ProcessRequest\\nmethod. In ASP.NET MVC 5, you can configur\", \"e a particular route in the route table to use your custom\\nhandler:\\n\\n\\n75 CHAPTER 4 | Example migrati\", \"on of eShop to ASP.NET Core\\n\\n\\nTo migrate custom route handlers from ASP.NET MVC 5 to ASP.NET Core, y\", \"ou can either use a filter\\n[(such as an action filter) or a custom IRouter. The filter approach is r\", \"elatively straightforward, and can](https://docs.microsoft.com/dotnet/api/microsoft.aspnetcore.routi\", \"ng.irouter)\\nbe added as a global filter when MVC is added to the app\\u2019s services during startup:\\n\\n\\nTh\", \"e IRouter option requires implementing the interface\\u2019s RouteAsync and GetVirtualPath methods.\\nThe cu\", \"stom router is added to the request pipeline during app startup.\\n\\n\\n[In ASP.NET Web API, these handle\", \"rs are referred to as custom message handlers, rather than](https://docs.microsoft.com/aspnet/web-ap\", \"i/overview/advanced/http-message-handlers#custom-message-handlers) _route_\\n_handlers_ . Message hand\", \"lers must derive from DelegatingHandler and override its SendAsync method.\\nMessage handlers can be c\", \"hained together to form a pipeline in a fashion that is very similar to\\nASP.NET Core middleware and \", \"its request pipeline.\\n\\n\\nASP.NET Core has no DelegatingHandler type or separate message handler pipel\", \"ine. Instead, such\\nhandlers should be migrated using global filters, custom IRouter instances (see a\", \"bove), or custom\\nmiddleware. ASP.NET Core MVC filters and IRouter types have the advantage of having\", \" built-in access\\nto MVC constructs like controllers and actions, while middleware is a lower level a\", \"pproach that has no\\nties to MVC. This makes it more flexible but also requires more effort if you ne\", \"ed to access MVC\\ncomponents.\\n\\n#### **CORS support**\\n\\n\\nCORS, or Cross-Origin Resource Sharing, is a W\", \"3C standard that allows servers to accept requests that\\ndon\\u2019t originate from responses they\\u2019ve serve\", \"d. ASP.NET MVC 5 and ASP.NET Web API 2 support CORS\\nin different ways. The simplest way to enable CO\", \"RS support in ASP.NET MVC 5 is with an action filter\\nlike this one:\\n\\n\\n[ASP.NET Web API can also use \", \"such a filter, but it has built-in support for enabling CORS](https://docs.microsoft.com/aspnet/web-\", \"api/overview/security/enabling-cross-origin-requests-in-web-api#enable-cors) as well:\\n\\n\\n76 CHAPTER 4\", \" | Example migration of eShop to ASP.NET Core\\n\\n\\nOnce this is added, you can configure allowed origin\", \"s, headers, and methods using the EnableCors\\nattribute, like so:\\n\\n\\nBefore migrating your CORS implem\", \"entation from ASP.NET MVC 5 or ASP.NET Web API 2, be sure to\\n[review how CORS works](https://docs.mi\", \"crosoft.com/aspnet/web-api/overview/security/enabling-cross-origin-requests-in-web-api#how-cors-work\", \"s) and create some automated tests that demonstrate CORS is working as\\nexpected in your current syst\", \"em.\\n\\n\\nIn ASP.NET Core, there are three built-in ways to enable CORS:\\n\\n\\n  - [Configured via policy in\", \" ConfigureServices](https://docs.microsoft.com/aspnet/core/security/cors?#cors-with-named-policy-and\", \"-middleware)\\n\\n  - [Enabled with endpoint routing](https://docs.microsoft.com/aspnet/core/security/co\", \"rs?#enable-cors-with-endpoint-routing)\\n\\n  - [Enabled with the EnableCors attribute](https://docs.mic\", \"rosoft.com/aspnet/core/security/cors#enable-cors-with-attributes)\\n\\n\\nEach of these approaches is cove\", \"red in detail in the docs, which are linked from the above options.\\nWhich one you choose will largel\", \"y depend on how your existing app supports CORS. If the app uses\\nattributes, you can probably migrat\", \"e to use the EnableCors attribute most easily. If your app uses\\nfilters, you could continue using th\", \"at approach (though it\\u2019s not the typical approach used in ASP.NET\\nCore), or migrate to use attribute\", \"s or policies. Endpoint routing is a relatively new feature introduced\\nwith ASP.NET Core 3 and as su\", \"ch it doesn\\u2019t have a close analog in ASP.NET MVC 5 or ASP.NET Web\\nAPI 2 apps.\\n\\n#### **Custom areas**\", \"\\n\\n\\nMany ASP.NET MVC apps use Areas to organize the project. Areas typically reside in the root of th\", \"e\\nproject in an _Areas_ folder, and must be registered when the application starts, typically in\\nApp\", \"lication_Start():\\n\\n```\\nAreaRegistration.RegisterAllAreas();\\n\\n```\\n\\nAn alternative to registering all \", \"areas in startup is to use the RouteArea attribute on individual\\ncontrollers:\\n\\n\\nASP.NET Web API apps\", \" don\\u2019t typically use areas explicitly, since their controllers can be placed in any\\nfolder in the pr\", \"oject. Teams can use any folder structure they like to organize their API controllers.\\n\\n\\n77 CHAPTER \", \"4 | Example migration of eShop to ASP.NET Core\\n\\n\\n[Areas](https://docs.microsoft.com/aspnet/core/mvc/\", \"controllers/areas) are supported in ASP.NET Core MVC. The approach used is nearly identical to the u\", \"se of areas\\nin ASP.NET MVC 5. Developers migrating code using areas should keep in mind the followin\", \"g\\ndifferences:\\n\\n\\n  - AreaRegistration.RegisterAllAreas is not used in ASP.NET Core MVC\\n\\n  - Areas ar\", \"e applied using the [Area(\\\"name\\\")] attribute (not RouteArea as in ASP.NET MVC 5)\\n\\n  - Areas can be a\", \"dded to the route table templates, if desired (or they can use attribute routing)\\n\\nTo add area suppo\", \"rt to the route table in ASP.NET Core MVC, you would add the following during app\\nstartup:\\n\\n\\nAreas c\", \"an also be used with attribute routing, using the {area} keyword in the route definition (it\\u2019s one\\n[\", \"of several reserved routing names that can be used with route templates).](https://docs.microsoft.co\", \"m/aspnet/core/mvc/controllers/routing#reserved-routing-names)\\n\\n\\nTag helpers support areas with the a\", \"sp-area attribute, which can be used to generate links in Razor\\nviews and pages:\\n\\n\\nIf you\\u2019re migrati\", \"ng to Razor Pages you will need to use an _Areas_ folder in your _Pages_ folder. For more\\n[informati\", \"on, see Areas with Razor Pages.](https://docs.microsoft.com/aspnet/core/mvc/controllers/areas#areas-\", \"with-razor-pages)\\n\\n\\n[In addition to the above guidance, teams should review how routing in ASP.NET C\", \"ore works with](https://docs.microsoft.com/aspnet/core/mvc/controllers/routing#areas)\\n[areas](https:\", \"//docs.microsoft.com/aspnet/core/mvc/controllers/routing#areas) as part of their migration planning \", \"process.\\n\\n#### **Integration tests for ASP.NET MVC and ASP.NET Web API**\\n\\n\\nIntegration tests are aut\", \"omated tests that verify several different parts of an app work together\\ncorrectly. Writing integrat\", \"ion tests for ASP.NET MVC and ASP.NET Web API usually involved deploying\\n\\n\\n78 CHAPTER 4 | Example mi\", \"gration of eShop to ASP.NET Core\\n\\n\\nthe app to a real web server, such as a local instance of IIS or \", \"IIS Express, and then making requests to\\nthis hosted application using an HTTP client. Some of these\", \" tests may interact with the client-side user\\n[interface using browser automation tools like Seleniu\", \"m, though often these are referred to as](https://www.selenium.dev/) _UI tests_\\nrather than integrat\", \"ion tests.\\n\\n\\nIf your migrated app shares the same behavior as its original version, whatever existin\", \"g technology\\nthe team is using to perform integration tests (and UI tests) should continue to work j\", \"ust as it did\\nbefore. These tests are usually indifferent to the underlying technology used to host \", \"the app they\\u2019re\\ntesting, and interact with it only through HTTP requests. Where things may get more \", \"challenging is\\nwith how the tests interact with the app to get it into a known good state prior to e\", \"ach test. This may\\nrequire some migration effort, since configuration and startup are significantly \", \"different in ASP.NET\\nCore compared to ASP.NET MVC or ASP.NET Web API.\\n\\n\\n[Teams should strongly consi\", \"der migrating their integration tests to use ASP.NET Core\\u2019s built-in](https://docs.microsoft.com/asp\", \"net/core/test/integration-tests)\\n[integration testing](https://docs.microsoft.com/aspnet/core/test/i\", \"ntegration-tests) support. In ASP.NET Core, apps can be tested by deploying them to a TestHost,\\nwhic\", \"h is configured using a WebApplicationFactory. There\\u2019s a little bit of setup required to host the\\nap\", \"p for testing, but once this is in place, creating individual integration tests is very straightforw\", \"ard.\\n\\n\\nOne of the best features of ASP.NET Core\\u2019s integration testing support is that the app is hos\", \"ted in\\nmemory. There\\u2019s no need to configure a real webserver to host the app. There\\u2019s no need to use\", \" a\\nbrowser automation tool (if you\\u2019re only testing ASP.NET Core and not client-side behavior). Many \", \"of\\nthe problems that can be encountered when trying to use a real web server for automated integrati\", \"on\\ntests, such as firewall issues or process start/stop issues, are eliminated with this approach. S\", \"ince the\\nrequests are all made in memory with no network requirement, the tests also tend to run muc\", \"h faster\\nthan tests that must set up a separate webserver and communicate with it over the network (\", \"even if\\nit\\u2019s running on the same machine).\\n\\n\\nBelow you can see an example ASP.NET Core integration t\", \"est (sometimes referred to as _functional_\\n_tests_ [to distinguish them from lower-level integration\", \" tests) from the eShopOnWeb reference](https://github.com/dotnet-architecture/eShopOnWeb)\\n[applicati\", \"on:](https://github.com/dotnet-architecture/eShopOnWeb)\\n\\n\\n79 CHAPTER 4 | Example migration of eShop \", \"to ASP.NET Core\\n\\n\\nIf the app being migrated has no integration tests, the migration process can be a\", \" great opportunity\\nto add some. These tests can verify that the migrated app behaves as the team exp\", \"ects. When such\\ntests are in place early in a migration, they can ensure that later migration effort\", \"s do not break\\npreviously migrated portions of the app. Given how easy it is to set up and run integ\", \"ration tests in\\nASP.NET Core, the return on the investment spent setting up such tests is usually pr\", \"etty high.\\n\\n#### **WCF client configuration**\\n\\n\\nIf your app currently relies on WCF services as a cl\", \"ient, this scenario is supported. However, you will\\n[need to migrate your configuration from](https:\", \"//docs.microsoft.com/aspnet/core/migration/configuration) _web.config_ to use the new _appsettings.j\", \"son_ file. Another\\noption is to add any necessary configuration to your clients programmatically whe\", \"n you create them.\\nFor example:\\n\\n\\nIf your organization has extensive services built using WCF that y\", \"our app relies on, consider migrating\\nthem to use gRPC instead. For more details on gRPC, why you ma\", \"y wish to migrate, and a detailed\\n[migration guide, consult the gRPC for WCF Developers](https://doc\", \"s.microsoft.com/en-us/dotnet/architecture/grpc-for-wcf-developers/) eBook.\\n\\n#### **References**\\n\\n\\n  \", \"- [ASP.NET Web API Content Negotiation](https://docs.microsoft.com/aspnet/web-api/overview/formats-a\", \"nd-model-binding/content-negotiation)\\n\\n  - [Format response data in ASP.NET Core Web API](https://do\", \"cs.microsoft.com/aspnet/core/web-api/advanced/formatting)\\n\\n  - [Custom Model Binders in ASP.NET Web \", \"API](https://docs.microsoft.com/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-\", \"in-aspnet-web-api#model-binders)\\n\\n  - [Custom Model Binders in ASP.NET Core](https://docs.microsoft.\", \"com/aspnet/core/mvc/advanced/custom-model-binding#custom-model-binder-sample)\\n\\n  - [Media Formatters\", \" in ASP.NET Web API 2](https://docs.microsoft.com/aspnet/web-api/overview/formats-and-model-binding/\", \"media-formatters)\\n\\n\\n  - [Custom formatters in ASP.NET Core Web API](https://docs.microsoft.com/aspne\", \"t/core/web-api/advanced/custom-formatters)\\n\\n  - [Filters in ASP.NET Core](https://docs.microsoft.com\", \"/aspnet/core/mvc/controllers/filters)\\n\\n  - [Route constraints in ASP.NET Web API 2](https://docs.mic\", \"rosoft.com/aspnet/web-api/overview/web-api-routing-and-actions/attribute-routing-in-web-api-2#route-\", \"constraints)\\n\\n  - [Route constraints in ASP.NET MVC 5](https://devblogs.microsoft.com/aspnet/attribu\", \"te-routing-in-asp-net-mvc-5/#route-constraints)\\n\\n  - [ASP.NET Core Route Constraint Reference](https\", \"://docs.microsoft.com/aspnet/core/fundamentals/routing#route-constraint-reference)\\n\\n  - [Custom mess\", \"age handlers in ASP.NET Web API 2](https://docs.microsoft.com/aspnet/web-api/overview/advanced/http-\", \"message-handlers#custom-message-handlers)\\n\\n  - [Simple CORS control in MVC 5 and Web API 2](https://\", \"stackoverflow.com/questions/6290053/setting-access-control-allow-origin-in-asp-net-mvc-simplest-poss\", \"ible-method)\\n\\n  - [Enabling Cross-Origin Requests in Web API](https://docs.microsoft.com/aspnet/web-\", \"api/overview/security/enabling-cross-origin-requests-in-web-api#enable-cors)\\n\\n  - [Enable Cross-Orig\", \"in Requests (CORS) in ASP.NET Core](https://docs.microsoft.com/aspnet/core/security/cors)\\n\\n  - [Area\", \"s in ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/controllers/areas)\\n\\n  - [Integration t\", \"ests in ASP.NET Core](https://docs.microsoft.com/aspnet/core/test/integration-tests)\\n\\n\\n80 CHAPTER 4 \", \"| Example migration of eShop to ASP.NET Core\\n\\n\\n**CHAPTER**\\n# 5\\n\\n## Deployment scenarios when migrati\", \"ng to ASP.NET Core\\n\\n\\nExisting ASP.NET MVC and Web API apps run on IIS and Windows. Large apps may re\", \"quire a phased\\nor side-by-side approach when porting to ASP.NET Core. In previous chapters, you lear\", \"ned a number\\nof strategies for migrating large .NET Framework apps to ASP.NET Core in phases. In thi\", \"s chapter, you\\nwill see how different deployment scenarios can be achieved when there is a need to m\", \"aintain the\\noriginal app in production while migrating portions of it.\\n\\n### Split a large web app\\n\\n\\n\", \"Consider the common scenario of a large web app that currently is hosted on IIS in a single web site\", \".\\nWithin the large app, functionality is segmented into different routes and/or directories. The app\", \" is a\\nmix of MVC views and API endpoints. The MVC routes include many different paths based on\\nfunct\", \"ionality and all start from the root of the app using the standard /{controller}/{action}/{id?} rout\", \"e\\ntemplate. The API endpoints follow a similar pattern, but are all under an /api root.\\n\\n\\nAssuming t\", \"he task of porting the app is split such that either the MVC functionality or the API\\nfunctionality \", \"is migrated to ASP.NET Core first, how would the original site continue to function\\nseamlessly with \", \"the new ASP.NET Core app running somewhere else? Users of the system should\\ncontinue to see the same\", \" URLs they did prior to the migration, unless it\\u2019s absolutely necessary to\\nchange them.\\n\\n\\n[Fortunate\", \"ly, IIS is a feature-rich web server, and two features it has are URL Rewrite module and](https://do\", \"cs.microsoft.com/iis/extensions/url-rewrite-module/url-rewrite-module-video-walkthrough)\\n[Applicatio\", \"n Request Routing. Using these features, IIS can act as a reverse proxy, routing client](https://doc\", \"s.microsoft.com/iis/extensions/planning-for-arr/application-request-routing-version-2-overview)\\nrequ\", \"ests to the appropriate back-end web app. To configure IIS as a reverse proxy, check the **Enable**\\n\", \"**proxy** checkbox in the Application Request Routing feature, then add a URL Rewrite rule like this\", \" one:\\n\\n\\nAs a reverse proxy, IIS can route traffic matching certain patterns to entirely separate app\", \"s, potentially\\non different servers.\\n\\n\\n81 CHAPTER 5 | Deployment scenarios when migrating to ASP.NET\", \" Core\\n\\n\\nUsing just the URL Rewrite module (perhaps combined with host headers), IIS can easily suppo\", \"rt\\nmultiple web sites, each potentially running different versions of .NET. A large web app might be\", \"\\ndeployed as a collection of individual sites, each responding to different IP addresses and/or host\", \"\\nheaders, or as a single web site with one or more sub-applications in it responding to certain URL\\n\", \"paths (which doesn\\u2019t even require URL Rewrite).\\n\\n\\n\\n\\n\\nThere are pros and cons to using the same or di\", \"fferent subdomains (and domains) to host a single\\n[app. Features like cookies and intra-app communic\", \"ation using mechanisms like CORS may require](https://docs.microsoft.com/aspnet/core/security/cors)\\n\", \"more configuration to work properly in distributed apps. However, apps that use different\\nsubdomains\", \" can more easily use DNS to route requests to entirely different network destinations, and\\nso can mo\", \"re easily be deployed to many different servers (virtual or otherwise) without the need for\\nIIS to a\", \"ct as a reverse proxy.\\n\\n\\nIn the example described above, assume the API endpoints are designated as \", \"the first part of the app\\nto be ported to ASP.NET Core. In this case, a new ASP.NET Core app is crea\", \"ted and hosted in IIS as a\\nseparate web _application_ within the existing ASP.NET MVC web _site_ . S\", \"ince it will be added as a child of\\nthe original web site and will be named _api_, its default route\", \" should no longer begin with api/.\\nKeeping this would result in it matching URLs of the form /api/ap\", \"i/endpoint.\\n\\n\\nFigure 5-1 shows how the ASP.NET Core 2.1 _api_ app appears in IIS Manager as a part o\", \"f the existing\\n_DotNetMvcApp_ site.\\n\\n\\n82 CHAPTER 5 | Deployment scenarios when migrating to ASP.NET \", \"Core\\n\\n\\n_Figure 5-1. .NET Framework Site with .NET Core app in IIS._\\n\\n\\nThe _DotNetMvcApp_ site is hos\", \"ted as an MVC 5 app running on .NET Framework 4.7.2. It has its own IIS\\napp pool configured in integ\", \"rated mode and running .NET CLR version 4.0.30319. The _api_ app is an\\nASP.NET Core app running on .\", \"NET Framework 4.6.1 (net461). It was added to the _DotNetMvcApp_ as a\\nnew IIS app and configured to \", \"use its own Application Pool. Its Application Pool is also running in\\nintegrated mode but is configu\", \"red with a .NET CLR version of **No Managed Code** since it will be\\n[executed using the ASP.NET Core\", \" Module. The version of the ASP.NET Core app is just an example. It](https://docs.microsoft.com/aspn\", \"et/core/host-and-deploy/aspnet-core-module)\\ncould also be configured to run on NET 5+. Though at tha\", \"t point, it would no longer be able to target\\n.NET Framework libraries (see Choose the Right .NET Co\", \"re Version)\\n\\n\\nConfigured in this manner, the only change that must be made in order for the ASP.NET \", \"Core app\\u2019s\\nAPIs to be routed properly is to change its default route template from [Route(\\\"[api/cont\", \"roller]\\\")] to\\n\\n[Route(\\\"[controller]\\\")].\\n\\n\\nAlternately the ASP.NET Core app can be another top-level \", \"web site in IIS. In this case, you can\\n[configure the original site to use a rewrite rule (with URL \", \"Rewrite) that will redirect to the other app if](https://www.iis.net/downloads/microsoft/url-rewrite\", \")\\nthe path starts with /api. The ASP.NET Core app can use a different host header for its route so t\", \"hat it\\ndoesn\\u2019t conflict with the main app but can still respond to requests using root-based routes.\", \"\\n\\n\\nAs an example, the same ASP.NET Core app used in Figure 5-1 can be deployed to another folder\\ncon\", \"figured as an IIS web site. The site should use an app pool configured just as before, with **No**\\n\\n\", \"\\n83 CHAPTER 5 | Deployment scenarios when migrating to ASP.NET Core\\n\\n\\n**Managed Code** . Configure i\", \"ts bindings to respond to a unique host name on the server, such as\\napi.contoso.com. To configure UR\", \"L Rewrite to rewrite requests matching /api just add a new inbound\\nrule at the IIS server (or indivi\", \"dual site) level. Match the pattern ^/api(.*) and specify an Action type of\\nRewrite and a Rewrite UR\", \"L of api.contoso.com/{R:1}. The combination of using (.*) in the matching\\npattern and {R:1} in the r\", \"ewrite URL will ensure the rest of the path gets used with the new URL. With\\nthis in place, separate\", \" sites on the same IIS server can coexist running separate versions of .NET, but\\nthey can be made to\", \" appear to the Internet as one web app. Figure 5-2 shows the rewrite rule as\\nconfigured in IIS with \", \"the separate web site.\\n\\n\\n_Figure 5-2. Rewrite rule to rewrite subfolder requests to another web site\", \"._\\n\\n\\nIf your app requires single sign-on between different sites or apps within IIS, refer to the\\n[d\", \"ocumentation on how to share authentication cookies among ASP.NET apps](https://docs.microsoft.com/a\", \"spnet/core/host-and-deploy/iis/) for detailed instructions\\non supporting this scenario.\\n\\n\\n[Another a\", \"lternative to IIS Rewrite rules is the use of a reverse proxy like YARP, which can facilitate](https\", \"://microsoft.github.io/reverse-proxy/)\\n[incremental ASP.NET to ASP.NET Core Migration.](https://devb\", \"logs.microsoft.com/dotnet/incremental-asp-net-to-asp-net-core-migration/)\\n\\n### Summary\\n\\n\\nA common ap\", \"proach to porting large apps from .NET Framework to ASP.NET Core is to choose\\nindividual portions of\", \" the app to migrate one by one. As each piece of the app is ported, the entire\\napp remains running a\", \"nd usable, with some parts of it running in its original configuration and other\\nparts running on so\", \"me version of .NET Core. By following this approach, a large app migration can be\\nperformed incremen\", \"tally. This approach results in limiting risk by providing more rapid feedback and\\n\\n\\n84 CHAPTER 5 | \", \"Deployment scenarios when migrating to ASP.NET Core\\n\\n\\nreducing total surface area involved in testin\", \"g. It also allows for more rapid realization of benefits of\\n.NET Core, such as performance increases\", \". Although ASP.NET Core apps are no longer required to be\\nhosted on IIS, IIS remains a very flexible\", \" and powerful web server that can be configured to support a\\nvariety of hosting scenarios involving \", \"both .NET Framework and ASP.NET Core apps on the same IIS\\ninstance or even hosted on different serve\", \"rs.\\n\\n### References\\n\\n\\n  - [Host ASP.NET Core on Windows with IIS](https://docs.microsoft.com/aspnet/\", \"core/host-and-deploy/iis/)\\n\\n  - [URL Rewrite module and Application Request Routing](https://docs.mi\", \"crosoft.com/iis/extensions/url-rewrite-module/reverse-proxy-with-url-rewrite-v2-and-application-requ\", \"est-routing)\\n\\n  - [URL Rewrite](https://www.iis.net/downloads/microsoft/url-rewrite)\\n\\n  - [ASP.NET C\", \"ore Module](https://docs.microsoft.com/aspnet/core/host-and-deploy/aspnet-core-module)\\n\\n  - [Share a\", \"uthentication cookies among ASP.NET apps](https://docs.microsoft.com/aspnet/core/security/cookie-sha\", \"ring)\\n\\n  - [Samples used in this section](https://github.com/ardalis/MigrateDotNetWithIIS)\\n\\n  - [Inc\", \"remental ASP.NET to ASP.NET Core Migration](https://devblogs.microsoft.com/dotnet/incremental-asp-ne\", \"t-to-asp-net-core-migration/)\\n\\n\\n85 CHAPTER 5 | Deployment scenarios when migrating to ASP.NET Core\\n\\n\", \"\\n**CHAPTER**\\n\\n\\n**CHAPTER**\\n\\n## Summary: Port existing ASP.NET Apps to .NET 7\\n\\n\\nIn this book, you\\u2019ve \", \"been given the resources needed to decide whether it makes sense to port your\\norganization\\u2019s existin\", \"g ASP.NET apps running on .NET Framework to ASP.NET Core. You\\u2019ve learned\\nabout important considerati\", \"ons for choosing when it makes sense to migrate to .NET Core, and when\\nit may be appropriate to keep\", \" (parts of) your app on .NET Framework. There are differences between\\n.NET Core versions and their c\", \"apabilities and compatibilities with .NET Framework, and you learned\\nhow to choose the right version\", \" of .NET Core for your app.\\n\\n\\nPorting a large app often entails a fair amount of risk and effort. Yo\", \"u learned how to mitigate this risk\\nby employing one or more incremental migration strategies along \", \"with several deployment strategies\\nfor keeping partially migrated apps running in production.\\n\\n\\nTher\", \"e are many architectural differences between ASP.NET and ASP.NET Core. In chapter 2, you\\nlearned abo\", \"ut many of these differences and how they relate to your app\\u2019s migration. This chapter\\ncovered every\", \"thing from app startup and low-level middleware to high-level controller and Web API\\ndifferences and\", \" new features enabling much better testing scenarios.\\n\\n\\nLarge apps are often comprised of many proje\", \"cts and packages, and dependencies can play a major\\nrole in determining how easy or difficult migrat\", \"ion may be. Chapter 3 helped you identify the\\nsequence in which to migrate projects and how to under\", \"stand and update your app\\u2019s dependencies. It\\nalso detailed additional strategies for migrating apps \", \"while keeping them running in production.\\n\\n\\nIn chapter 4, you saw how a real ASP.NET MVC reference a\", \"pp was migrated to ASP.NET Core. This\\nchapter included a detailed breakdown of all the changes that \", \"were needed to take the existing app\\nand port it over to run on ASP.NET Core. Refer back to it if yo\", \"u have specific questions about the\\nporting process and some of its more specific details.\\n\\n\\nFinally\", \", chapter 5 detailed specific deployment scenarios focused on IIS. You saw how you can use\\nyour exis\", \"ting IIS web server to host parts of your app that have been ported to ASP.NET Core while\\nkeeping th\", \"e app\\u2019s public URLs consistent. IIS includes great support for URL rewriting and request\\nrouting tha\", \"t enables it to host multiple versions of your site side by side or even on different servers,\\nwith \", \"no change to the public-facing URLs the app exposes.\\n\\n\\n86 CHAPTER 6 | Summary: Port existing ASP.NET\", \" Apps to .NET 7\\n\\n\\n\"]"