,0
0,public class DaprEventBus : IEventBus
1,{
2,"private const string DAPR_PUBSUB_NAME = ""pubsub"";"
3,
4,private readonly DaprClient _dapr;
5,private readonly ILogger _logger;
6,
7,"public DaprEventBus(DaprClient dapr, ILogger<DaprEventBus> logger)"
8,{
9,_dapr = dapr;
10,_logger = logger;
11,}
12,
13,public async Task PublishAsync(IntegrationEvent integrationEvent)
14,{
15,var topicName = integrationEvent.GetType().Name;
16,
17,_logger.LogInformation(
18,"""Publishing event {@Event} to {PubsubName}.{TopicName}"","
19,"integrationEvent,"
20,"DAPR_PUBSUB_NAME,"
21,topicName);
22,
23,"// We need to make sure that we pass the concrete type to PublishEventAsync,"
24,// which can be accomplished by casting the event to dynamic. This ensures
25,// that all event fields are properly serialized.
26,"await _dapr.PublishEventAsync(DAPR_PUBSUB_NAME, topicName,"
27,(object)integrationEvent);
28,}
29,}
