|    | 0                                                                               |
|---:|:--------------------------------------------------------------------------------|
|  0 | [HttpPost("OrderStatusChangedToAwaitingStockValidation")]                       |
|  1 | [Topic(DaprPubSubName,                                                          |
|  2 | nameof(OrderStatusChangedToAwaitingStockValidationIntegrationEvent))]           |
|  3 | public Task HandleAsync(                                                        |
|  4 | OrderStatusChangedToAwaitingStockValidationIntegrationEvent integrationEvent)   |
|  5 | {                                                                               |
|  6 | // Save the updated status in the read model and notify the client via SignalR. |
|  7 | return UpdateReadModelAndSendNotificationAsync(integrationEvent.OrderId,        |
|  8 | integrationEvent.OrderStatus, integrationEvent.Description,                     |
|  9 | integrationEvent.BuyerId);                                                      |
| 10 | }                                                                               |
| 11 |                                                                                 |
| 12 | private async Task UpdateReadModelAndSendNotificationAsync(                     |
| 13 | Guid orderId, string orderStatus, string description, string buyerId)           |
| 14 | {                                                                               |
| 15 | var order = await _orderRepository.GetOrderByIdAsync(orderId);                  |
| 16 | if (order is not null)                                                          |
| 17 | {                                                                               |
| 18 | order.OrderStatus = orderStatus;                                                |
| 19 | order.Description = description;                                                |
| 20 |                                                                                 |
| 21 | await _orderRepository.UpdateOrderAsync(order);                                 |
| 22 | await SendNotificationAsync(order.OrderNumber, orderStatus, buyerId);           |
| 23 | }                                                                               |
| 24 | }                                                                               |