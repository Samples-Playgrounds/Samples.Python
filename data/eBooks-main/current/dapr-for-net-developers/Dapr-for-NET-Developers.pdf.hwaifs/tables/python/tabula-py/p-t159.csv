,"[HttpPost(""OrderStatusChangedToSubmitted"")]"
0,"[Topic(DaprPubSubName, nameof(OrderStatusChangedToSubmittedIntegrationEvent))]"
1,public async Task HandleAsync(
2,"OrderStatusChangedToSubmittedIntegrationEvent integrationEvent,"
3,"[FromServices] IOptions<OrderingSettings> settings,"
4,[FromServices] IEmailService emailService)
5,{
6,// Gets the order details from Actor state.
7,var actorId = new ActorId(integrationEvent.OrderId.ToString());
8,var orderingProcess = _actorProxyFactory.CreateActorProxy<IOrderingProcessActor>(
9,"actorId,"
10,nameof(OrderingProcessActor));
11,//
12,var actorOrder = await orderingProcess.GetOrderDetailsAsync();
13,"var readModelOrder = new Order(integrationEvent.OrderId, actorOrder);"
14,
15,// Add the order to the read model so it can be queried from the API.
16,// It may already exist if this event has been handled before (at-least-once
17,semantics).
18,readModelOrder = await _orderRepository.AddOrGetOrderAsync(readModelOrder);
19,
20,// Send a SignalR notification to the client.
21,"await SendNotificationAsync(readModelOrder.OrderNumber, integrationEvent.OrderStatus,"
22,integrationEvent.BuyerId);
23,
24,// Send a confirmation e-mail if enabled.
25,if (settings.Value.SendConfirmationEmail)
26,{
27,await emailService.SendOrderConfirmationAsync(readModelOrder);
28,}
29,}
