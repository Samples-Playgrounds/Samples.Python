,public class DaprEventBus : IEventBus
0,{
1,"private const string DAPR_PUBSUB_NAME = ""pubsub"";"
2,
3,private readonly DaprClient _dapr;
4,private readonly ILogger _logger;
5,
6,"public DaprEventBus(DaprClient dapr, ILogger<DaprEventBus> logger)"
7,{
8,_dapr = dapr;
9,_logger = logger;
10,}
11,
12,public async Task PublishAsync(IntegrationEvent integrationEvent)
13,{
14,var topicName = integrationEvent.GetType().Name;
15,
16,_logger.LogInformation(
17,"""Publishing event {@Event} to {PubsubName}.{TopicName}"","
18,"integrationEvent,"
19,"DAPR_PUBSUB_NAME,"
20,topicName);
21,
22,"// We need to make sure that we pass the concrete type to PublishEventAsync,"
23,// which can be accomplished by casting the event to dynamic. This ensures
24,// that all event fields are properly serialized.
25,"await _dapr.PublishEventAsync(DAPR_PUBSUB_NAME, topicName,"
26,(object)integrationEvent);
27,}
28,}
