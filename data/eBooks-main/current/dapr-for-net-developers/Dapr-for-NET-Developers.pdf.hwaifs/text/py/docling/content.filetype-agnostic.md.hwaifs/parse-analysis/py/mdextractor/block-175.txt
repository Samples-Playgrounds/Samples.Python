if (data.Items is null || !data.Items . Any()) { basket = new(); } else { // Get the item details from the catalog API. var catalogItems = await _catalog.GetCatalogItemsAsync( data.Items . Select(x => x.ProductId)); if (catalogItems == null) { return BadRequest( "Catalog items were not available for the specified items in the basket."); } // Check item availability and prices; store results in basket object. basket = CreateValidatedBasket(data.Items, catalogItems); } // Save the updated shopping basket. await _basket.UpdateAsync(basket, authorization.Substring("Bearer " . Length)); return basket; } // ... }