[HttpPost("OrderStatusChangedToAwaitingStockValidation")] [Topic(DaprPubSubName, nameof(OrderStatusChangedToAwaitingStockValidationIntegrationEvent))] public Task HandleAsync( OrderStatusChangedToAwaitingStockValidationIntegrationEvent integrationEvent) { // Save the updated status in the read model and notify the client via SignalR. return UpdateReadModelAndSendNotificationAsync(integrationEvent.OrderId, integrationEvent.OrderStatus, integrationEvent.Description, integrationEvent.BuyerId); } private async Task UpdateReadModelAndSendNotificationAsync( Guid orderId, string orderStatus, string description, string buyerId) { var order = await _orderRepository.GetOrderByIdAsync(orderId); if (order is not null ) { order.OrderStatus = orderStatus; order.Description = description; await _orderRepository.UpdateOrderAsync(order); await SendNotificationAsync(order.OrderNumber, orderStatus, buyerId); } }