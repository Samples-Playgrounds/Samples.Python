"[\"**EDITION v4.0** - Updated to Azure Functions v4\\n\\n\\n[DOWNLOAD available at: https://aka.ms/serverless\", \"bookpdf](https://aka.ms/serverlessbookpdf)\\n\\n\\nPUBLISHED BY\\n\\n\\nMicrosoft Developer Division, .NET, and \", \"Visual Studio product teams\\n\\n\\nA division of Microsoft Corporation\\n\\n\\nOne Microsoft Way\\n\\n\\nRedmond, Was\", \"hington 98052-6399\\n\\n\\nCopyright \\u00a9 2018-2023 by Microsoft Corporation\\n\\n\\nAll rights reserved. No part o\", \"f the contents of this book may be reproduced or transmitted in any\\nform or by any means without the\", \" written permission of the publisher.\\n\\n\\nThis book is provided \\u201cas-is\\u201d and expresses the author\\u2019s vie\", \"ws and opinions. The views, opinions and\\ninformation expressed in this book, including URL and other\", \" Internet website references, may change\\nwithout notice.\\n\\n\\nSome examples depicted herein are provide\", \"d for illustration only and are fictitious. No real association\\nor connection is intended or should \", \"be inferred.\\n\\n\\n[Microsoft and the trademarks listed at https://www.microsoft.com](https://www.micros\", \"oft.com/) on the \\u201cTrademarks\\u201d webpage are\\ntrademarks of the Microsoft group of companies.\\n\\n\\nMac and \", \"macOS are trademarks of Apple Inc.\\n\\n\\nAll other marks and logos are property of their respective owne\", \"rs.\\n\\n\\nAuthor:\\n\\n\\n**[Jeremy Likness](https://twitter.com/jeremylikness)**, Senior .NET Data Program Ma\", \"nager, Microsoft Corp.\\n\\n\\nContributor:\\n\\n\\n**[Cecil Phillip](https://twitter.com/cecilphillip)**, Senio\", \"r Cloud Advocate, Microsoft Corp.\\n\\n\\nEditors:\\n\\n\\n**[Bill Wagner](https://twitter.com/billwagner)**, Se\", \"nior Content Developer, Microsoft Corp.\\n\\n\\n**[Maira Wenzel](https://twitter.com/mairacw)**, Senior Co\", \"ntent Developer, Microsoft Corp.\\n\\n\\nParticipants and reviewers:\\n\\n\\n**[Steve Smith](https://twitter.com\", \"/ardalis)**, Architect/Trainer, NimblePros.\\n### Introduction\\n\\n\\n[Serverless](https://azure.microsoft.\", \"com/solutions/serverless/) is the evolution of cloud platforms in the direction of pure cloud native\", \" code. Serverless\\nbrings developers closer to business logic while insulating them from infrastructu\", \"re concerns. It\\u2019s a\\npattern that doesn\\u2019t imply \\u201cno server\\u201d but rather, \\u201cless server.\\u201d Serverless cod\", \"e is event-driven. Code\\n\\n\\nmay be triggered by anything from a traditional HTTP web request to a time\", \"r or the result of\\nuploading a file. The infrastructure behind serverless allows for instant scale t\", \"o meet elastic demands\\nand offers micro-billing to truly \\u201cpay for what you use.\\u201d Serverless requires\", \" a new way of thinking and\\napproach to building applications and isn\\u2019t the right solution for every \", \"problem. As a developer, you\\nmust decide:\\n\\n\\n- What are the pros and cons of serverless?\\n\\n- Why shoul\", \"d you consider serverless for your own applications?\\n\\n- How can you build, test, deploy, and maintai\", \"n your serverless code?\\n\\n- Where does it make sense to migrate code to serverless in existing applic\", \"ations, and what is the\\nbest way to accomplish this transformation?\\n### About this guide\\n\\n\\nThis guid\", \"e focuses on cloud native development of applications that use serverless. The book\\nhighlights the b\", \"enefits and exposes the potential drawbacks of developing serverless apps and\\nprovides a survey of s\", \"erverless architectures. Many examples of how serverless can be used are\\nillustrated along with vari\", \"ous serverless design patterns.\\n\\n\\nThis guide explains the components of the Azure serverless platfor\", \"m and focuses specifically on\\n[implementation of serverless using Azure Functions. You\\u2019ll learn abou\", \"t triggers and bindings as well as](https://docs.microsoft.com/azure/azure-functions/functions-overv\", \"iew)\\nhow to implement serverless apps that rely on state using durable functions. Finally, business\\n\", \"examples and case studies will help provide context and a frame of reference to determine whether\\nse\", \"rverless is the right approach for your projects.\\n### Evolution of cloud platforms\\n\\n\\nServerless is t\", \"he culmination of several iterations of cloud platforms. The evolution began with\\nphysical metal in \", \"the data center and progressed through Infrastructure as a Service (IaaS) and\\nPlatform as a Service \", \"(PaaS).\\n\\n\\nBefore the cloud, a discernible boundary existed between development and operations. Deplo\", \"ying an\\napplication meant answering myriad questions like:\\n\\n\\n- What hardware should be installed?\\n\\n-\", \" How is physical access to the machine secured?\\n\\n\\n- Does the data center require an Uninterruptible \", \"Power Supply (UPS)?\\n\\n- Where are storage backups sent?\\n\\n- Should there be redundant power?\\n\\n\\nThe lis\", \"t goes on and the overhead was enormous. In many situations, IT departments were forced to\\ndeal with\", \" incredible waste. The waste was due to over-allocation of servers as backup machines for\\ndisaster r\", \"ecovery and standby servers to enable scale-out. Fortunately, the introduction of\\n[virtualization te\", \"chnology (like Hyper-V) with Virtual Machines (VMs) gave rise to Infrastructure as a](https://docs.m\", \"icrosoft.com/virtualization/hyper-v-on-windows/about/)\\nService (IaaS). Virtualized infrastructure al\", \"lowed operations to set up a standard set of servers as the\\nbackbone, leading to a flexible environm\", \"ent capable of provisioning unique servers \\u201con demand.\\u201d\\nMore important, virtualization set the stage\", \" for using the cloud to provide virtual machines \\u201cas a\\nservice.\\u201d Companies could easily get out of t\", \"he business of worrying about redundant power or\\nphysical machines. Instead, they focused on the vir\", \"tual environment.\\n\\n\\nIaaS still requires heavy overhead because operations is still responsible for v\", \"arious tasks. These tasks\\ninclude:\\n\\n\\n- Patching and backing up servers.\\n\\n- Installing packages.\\n\\n- K\", \"eeping the operating system up-to-date.\\n\\n- Monitoring the application.\\n\\n\\nThe next evolution reduced \", \"the overhead by providing Platform as a Service (PaaS). With PaaS, the\\ncloud provider handles operat\", \"ing systems, security patches, and even the required packages to\\nsupport a specific platform. Instea\", \"d of building a VM then configuring .NET and standing up Internet\\nInformation Services (IIS) servers\", \", developers simply choose a \\u201cplatform target\\u201d such as \\u201cweb\\napplication\\u201d or \\u201cAPI endpoint\\u201d and deplo\", \"y code directly. The infrastructure questions are reduced to:\\n\\n\\n- What size services are needed?\\n\\n- \", \"How do the services scale out (add more servers or nodes)?\\n\\n- How do the services scale up (increase\", \" the capacity of hosting servers or nodes)?\\n\\n\\nServerless further abstracts servers by focusing on ev\", \"ent-driven code. Instead of a platform,\\ndevelopers can focus on a microservice that does one thing. \", \"The two key questions for building the\\nserverless code are:\\n\\n\\n- What triggers the code?\\n\\n- What does\", \" the code do?\\n\\n\\nWith serverless, infrastructure is abstracted. In some cases, the developer no longe\", \"r worries about the\\nhost at all. Whether or not an instance of IIS, Kestrel, Apache, or some other w\", \"eb server is running to\\nmanage web requests, the developer focuses on an HTTP trigger. The trigger p\", \"rovides the standard,\\ncross-platform payload for the request. The payload not only simplifies the de\", \"velopment process, but\\nfacilitates testing and in some cases, makes the code easily portable across \", \"platforms.\\n\\n\\nAnother feature of serverless is micro-billing. It\\u2019s common for web applications to hos\", \"t Web API\\nendpoints. In traditional bare metal, IaaS and even PaaS implementations, the resources to\", \" host the\\nAPIs are paid for continuously. That means you pay to host the endpoints even when they ar\", \"en\\u2019t\\nbeing accessed. Often you\\u2019ll find one API is called more than others, so the entire system is s\", \"caled\\n\\n\\nbased on supporting the popular endpoints. Serverless enables you to scale each endpoint\\nind\", \"ependently and pay for usage, so no costs are incurred when the APIs aren\\u2019t being called.\\nMigration \", \"may in many circumstances dramatically reduce the ongoing cost to support the endpoints.\\n### What th\", \"is guide doesn\\u2019t cover\\n\\n\\nThis guide specifically emphasizes architecture approaches and design patte\", \"rns and isn\\u2019t a deep dive\\n[into the implementation details of Azure Functions, Logic Apps, or other \", \"serverless platforms. This](https://docs.microsoft.com/azure/logic-apps/logic-apps-what-are-logic-ap\", \"ps)\\nguide doesn\\u2019t cover, for example, advanced workflows with Logic Apps or features of Azure Functi\", \"ons\\nsuch as configuring Cross-Origin Resource Sharing (CORS), applying custom domains, or uploading\\n\", \"[SSL certificates. These details are available through the online Azure Functions documentation.](ht\", \"tps://docs.microsoft.com/azure/azure-functions/functions-reference)\\n#### **Additional resources**\\n\\n\\n\", \"- [Azure Architecture center](https://docs.microsoft.com/azure/architecture/)\\n\\n- [Best practices for\", \" cloud applications](https://docs.microsoft.com/azure/architecture/best-practices/api-design)\\n### Wh\", \"o should use the guide\\n\\n\\nThis guide was written for developers and solution architects who want to b\", \"uild enterprise\\napplications with .NET that may use serverless components either on premises or in t\", \"he cloud. It\\u2019s\\nuseful to developers, architects, and technical decision makers interested in:\\n\\n\\n- Un\", \"derstanding the pros and cons of serverless development\\n\\n- Learning how to approach serverless archi\", \"tecture\\n\\n- Example implementations of serverless apps\\n### How to use the guide\\n\\n\\nThe first part of t\", \"his guide examines why serverless is a viable option by comparing several different\\narchitecture app\", \"roaches. It examines both the technology and development lifecycle, because all\\naspects of software \", \"development are impacted by architecture decisions. The guide then examines\\nuse cases and design pat\", \"terns and includes reference implementations using Azure Functions. Each\\nsection contains additional\", \" resources to learn more about a particular area. The guide concludes with\\nresources for walkthrough\", \"s and hands-on exploration of serverless implementation.\\n### Send your feedback\\n\\n\\nThe guide and rela\", \"ted samples are constantly evolving, so your feedback is welcomed! If you have\\ncomments about how th\", \"is guide can be improved, use the feedback section at the bottom of any\\n[page built on GitHub issues\", \".](https://github.com/dotnet/docs/issues)\\n\\n\\n## Contents\\n\\nArchitecture approaches ...................\", \"....................................................................................................\", \"................ 1\\n\\n\\nArchitecture patterns .........................................................\", \"....................................................................................................\", \". 1\\n\\n\\nMonoliths ....................................................................................\", \"................................................................................................ 1\\n\\n\", \"\\nN-Layer applications ..............................................................................\", \"................................................................................. 2\\n\\n\\nMicroservices \", \"....................................................................................................\", \"......................................................................... 3\\n\\n\\nArchitecture deploymen\", \"t approaches .......................................................................................\", \"...................................... 4\\n\\n\\nN-Tier applications .....................................\", \"....................................................................................................\", \".................... 5\\n\\n\\nOn-premises and Infrastructure as a Service (IaaS) ........................\", \"....................................................................... 6\\n\\n\\nPlatform as a Service (P\", \"aaS) ...............................................................................................\", \"............................................. 7\\n\\n\\nSoftware as a Service (SaaS) .....................\", \"....................................................................................................\", \".................. 7\\n\\n\\nContainers and Functions as a Service (FaaS) ................................\", \".......................................................................... 8\\n\\n\\nServerless ..........\", \"....................................................................................................\", \".................................................................. 9\\n\\n\\nSummary .....................\", \"....................................................................................................\", \"..................................................... 10\\n\\n\\nRecommended resources ...................\", \"....................................................................................................\", \"...................... 11\\n\\n\\nServerless architecture ................................................\", \"......................................................................................... 12\\n\\n\\nFull \", \"serverless back end ................................................................................\", \"...................................................................... 13\\n\\n\\nMonoliths and \\u201cstarving \", \"the beast\\u201d .........................................................................................\", \"...................................... 13\\n\\n\\nWeb apps ...............................................\", \"....................................................................................................\", \".............................. 14\\n\\n\\nMobile back ends ...............................................\", \"....................................................................................................\", \"............... 14\\n\\n\\nInternet of Things (IoT) ......................................................\", \"................................................................................................. 15\", \"\\n\\n\\nServerless architecture considerations ..........................................................\", \"............................................................... 16\\n\\n\\nManaging state ................\", \"....................................................................................................\", \"............................................. 16\\n\\n\\nLong-running processes ..........................\", \"....................................................................................................\", \".................. 16\\n\\n\\nStartup time ...............................................................\", \"....................................................................................................\", \"..... 17\\n\\n\\nDatabase updates and migrations .........................................................\", \"................................................................... 17\\n\\n\\nScaling ...................\", \"....................................................................................................\", \"........................................................... 17\\n\\n\\nMonitoring, tracing, and logging...\", \"....................................................................................................\", \"........................ 18\\n\\n\\nInter-service dependencies ...........................................\", \"............................................................................................... 18\\n\\n\", \"\\ni Contents\\n\\n\\nManaging failure and providing resiliency ............................................\", \"................................................................ 18\\n\\n\\nVersioning and green/blue depl\", \"oyments ............................................................................................\", \"................... 19\\n\\n\\nServerless design examples ................................................\", \".............................................................................................. 19\\n\\n\\n\", \"Scheduling .........................................................................................\", \"................................................................................. 19\\n\\n\\nCommand and Q\", \"uery Responsibility Segregation (CQRS) .............................................................\", \"................. 19\\n\\n\\nEvent-based processing ......................................................\", \".......................................................................................... 20\\n\\n\\nFile\", \" triggers and transformations.......................................................................\", \"........................................................ 20\\n\\n\\nAsynchronous background processing and\", \" messaging ................................................................................... 21\\n\\n\\n\", \"Web apps and APIs ..................................................................................\", \"....................................................................... 21\\n\\n\\nData pipeline .........\", \"....................................................................................................\", \"......................................................... 22\\n\\n\\nStream processing ...................\", \"....................................................................................................\", \".................................... 22\\n\\n\\nAPI gateway ..............................................\", \"....................................................................................................\", \"...................... 23\\n\\n\\nRecommended resources ..................................................\", \"........................................................................................... 23\\n\\n\\nAzu\", \"re serverless platform .............................................................................\", \"...................................................... 24\\n\\n\\nAzure Functions ........................\", \"....................................................................................................\", \"......................................... 24\\n\\n\\nProgramming language support ........................\", \"....................................................................................................\", \"... 25\\n\\n\\nApp service plans .........................................................................\", \".................................................................................... 25\\n\\n\\nCreate you\", \"r first function ...................................................................................\", \"........................................................... 25\\n\\n\\nUnderstand triggers and bindings ..\", \"....................................................................................................\", \"...................... 26\\n\\n\\nTelemetry with Application Insights ....................................\", \".......................................................................................... 27\\n\\n\\nAzur\", \"e Logic Apps .......................................................................................\", \"........................................................................... 29\\n\\n\\nEvent Grid ........\", \"....................................................................................................\", \"..................................................................... 31\\n\\n\\nScenarios................\", \"....................................................................................................\", \".......................................................... 32\\n\\n\\nEvent Grid vs. other Azure messaging\", \" services ..........................................................................................\", \".......... 33\\n\\n\\nPerformance targets.................................................................\", \"....................................................................................... 34\\n\\n\\nEvent G\", \"rid schema .........................................................................................\", \".................................................................. 34\\n\\n\\nAzure resources ............\", \"....................................................................................................\", \"................................................ 35\\n\\n\\nConclusion ...................................\", \"....................................................................................................\", \"................................... 36\\n\\n\\nRecommended resources .....................................\", \"....................................................................................................\", \".... 36\\n\\n\\nDurable Azure Functions ..................................................................\", \".................................................................. 37\\n\\n\\nTriggering a stateful workfl\", \"ow .................................................................................................\", \"........................................ 37\\n\\n\\nWorking with the Orchestration client ................\", \"....................................................................................................\", \" 37\\n\\n\\nii Contents\\n\\n\\nThe orchestrator function ......................................................\", \"....................................................................................... 38\\n\\n\\nThe act\", \"ivity functions ....................................................................................\", \".................................................................. 39\\n\\n\\nRecommended resources ......\", \"....................................................................................................\", \"........................................ 39\\n\\n\\nOrchestration patterns ...............................\", \"....................................................................................................\", \"..................... 39\\n\\n\\nFunction chaining .......................................................\", \"....................................................................................................\", \".. 40\\n\\n\\nAsynchronous HTTP APIs .....................................................................\", \"......................................................................... 40\\n\\n\\nMonitoring ..........\", \"....................................................................................................\", \"............................................................ 41\\n\\n\\nRecommended resources ............\", \"....................................................................................................\", \"............................. 42\\n\\n\\nServerless business scenarios and use cases .....................\", \"......................................................................... 43\\n\\n\\nBig data processing .\", \"....................................................................................................\", \"......................................................... 43\\n\\n\\nCreate serverless applications: hands\", \"-on lab ............................................................................................\", \"................ 43\\n\\n\\nCustomer reviews..............................................................\", \"....................................................................................................\", \" 43\\n\\n\\nFile processing and validation ...............................................................\", \".......................................................................... 44\\n\\n\\nGame data visualizat\", \"ion ................................................................................................\", \"..................................................... 44\\n\\n\\nGraphQL .................................\", \"....................................................................................................\", \".............................................. 44\\n\\n\\nInternet of Things (IoT) reliable edge relay ...\", \"....................................................................................................\", \"......... 44\\n\\n\\nMicroservices reference architecture ................................................\", \"............................................................................ 44\\n\\n\\nServerless for mob\", \"ile ................................................................................................\", \"........................................................... 45\\n\\n\\nServerless messaging ..............\", \"....................................................................................................\", \"........................................ 45\\n\\n\\nRecommended resources ................................\", \"....................................................................................................\", \".............. 45\\n\\n\\nConclusion .....................................................................\", \"........................................................................................... 46\\n\\n\\niii\", \" Contents\\n\\n\\n**CHAPTER**\\n# **1**\\n\\n## Architecture approaches\\n\\n\\nUnderstanding existing approaches to a\", \"rchitecting enterprise apps helps clarify the role played by\\nserverless. There are many approaches a\", \"nd patterns that evolved over decades of software\\ndevelopment, and all have their own pros and cons.\", \" In many cases, the ultimate solution may not\\ninvolve deciding on a single approach but may integrat\", \"e several approaches. Migration scenarios\\noften involve shifting from one architecture approach to a\", \"nother through a hybrid approach.\\n\\n\\nThis chapter provides an overview of both logical and physical a\", \"rchitecture patterns for enterprise\\napplications.\\n\\n### Architecture patterns\\n\\n\\nModern business appli\", \"cations follow a variety of architecture patterns. This section represents a survey\\nof common patter\", \"ns. The patterns listed here aren\\u2019t necessarily all best practices, but illustrate\\ndifferent approac\", \"hes.\\n\\n\\n[For more information, see Azure application architecture guide.](https://docs.microsoft.com/\", \"azure/architecture/guide/)\\n\\n### Monoliths\\n\\n\\nMany business applications follow a monolith pattern. Le\", \"gacy applications are often implemented as\\nmonoliths. In the monolith pattern, all application conce\", \"rns are contained in a single deployment.\\nEverything from user interface to database calls is includ\", \"ed in the same codebase.\\n\\n\\n1 CHAPTER 1 | Architecture approaches\\n\\n\\nThere are several advantages to t\", \"he monolith approach. It\\u2019s often easy to pull down a single code\\nbase and start working. Ramp up tim\", \"e may be less, and creating test environments is as simple as\\nproviding a new copy. The monolith may\", \" be designed to include multiple components and\\napplications.\\n\\n\\nUnfortunately, the monolith pattern \", \"tends to break down at scale. Major disadvantages of the\\nmonolith approach include:\\n\\n\\n- Difficult to\", \" work in parallel in the same code base.\\n\\n- Any change, no matter how trivial, requires deploying a \", \"new version of the entire application.\\n\\n- Refactoring potentially impacts the entire application.\\n\\n-\", \" Often the only solution to scale is to create multiple, resource-intensive copies of the monolith.\\n\", \"\\n- As systems expand or other systems are acquired, integration can be difficult.\\n\\n- It may be diffi\", \"cult to test due to the need to configure the entire monolith.\\n\\n- Code reuse is challenging and ofte\", \"n other apps end up having their own copies of code.\\n\\n\\nMany businesses look to the cloud as an oppor\", \"tunity to migrate monolith applications and at the\\nsame time refactor them to more usable patterns. \", \"It\\u2019s common to break out the individual\\napplications and components to allow them to be maintained, \", \"deployed, and scaled separately.\\n\\n### N-Layer applications\\n\\n\\nN-layer application partition applicati\", \"on logic into specific layers. The most common layers include:\\n\\n\\n- User interface\\n\\n- Business logic\\n\", \"\\n- Data access\\n\\n\\n2 CHAPTER 1 | Architecture approaches\\n\\n\\nOther layers may include middleware, batch \", \"processing, and API. It\\u2019s important to note the layers are\\nlogical. Although they\\u2019re developed in is\", \"olation, they may all be deployed to the same target platform.\\n\\n\\nThere are several advantages to the\", \" N-Layer approach, including:\\n\\n\\n- Refactoring is isolated to a layer.\\n\\n- Teams can independently bui\", \"ld, test, deploy, and maintain separate layers.\\n\\n- Layers can be swapped out, for example the data l\", \"ayer may access multiple databases without\\nrequiring changes to the UI layer.\\n\\n\\nServerless may be us\", \"ed to implement one or more layers.\\n\\n### Microservices\\n\\n\\n**[Microservices](https://docs.microsoft.co\", \"m/azure/architecture/guide/architecture-styles/microservices)** architectures contain common charact\", \"eristics that include:\\n\\n\\n- Applications are composed of several small services.\\n\\n- Each service runs\", \" in its own process.\\n\\n- Services are aligned around business domains.\\n\\n- Services communicate over l\", \"ightweight APIs, typically using HTTP as the transport.\\n\\n- Services can be deployed and upgraded ind\", \"ependently.\\n\\n- Services aren\\u2019t dependent on a single data store.\\n\\n- The system is designed with fail\", \"ure in mind, and the app may still run even when certain services\\nfail.\\n\\n\\nMicroservices don\\u2019t have t\", \"o be mutually exclusive to other architecture approaches. For example, an\\nN-Tier architecture may us\", \"e microservices for the middle tier. It\\u2019s also possible to implement\\n\\n\\n3 CHAPTER 1 | Architecture ap\", \"proaches\\n\\n\\nmicroservices in a variety of ways, from virtual directories on IIS hosts to containers. \", \"The characteristics\\nof microservices make them especially ideal for serverless implementations.\\n\\n\\nTh\", \"e pros of microservices architectures include:\\n\\n\\n- Refactoring is often isolated to a single service\", \".\\n\\n- Services can be upgraded independently of each other.\\n\\n- Resiliency and elasticity can be tuned\", \" to the demands of individual services.\\n\\n- Development can happen in parallel across disparate teams\", \" and platforms.\\n\\n- It\\u2019s easier to write comprehensive tests for isolated services.\\n\\n\\nMicroservices c\", \"ome with their own challenges, including:\\n\\n\\n- Determining what services are available and how to cal\", \"l them.\\n\\n- Managing the lifecycle of services.\\n\\n- Understanding how services fit together in the ove\", \"rall application.\\n\\n- Full system testing of calls made across disparate services.\\n\\n\\nUltimately there\", \" are solutions to address all of these challenges, including tapping into the benefits of\\nserverless\", \" that are discussed later.\\n\\n### Architecture deployment approaches\\n\\n\\nRegardless of the architecture \", \"approach used to design a business application, the implementation, or\\ndeployment of those applicati\", \"ons may vary. Businesses host applications on everything from physical\\nhardware to serverless functi\", \"ons.\\n\\n\\n4 CHAPTER 1 | Architecture approaches\\n\\n\\n#### **N-Tier applications**\\n\\n[The N-Tier architectur\", \"e pattern is a mature architecture and simply refers to applications that separate](https://docs.mic\", \"rosoft.com/azure/architecture/guide/architecture-styles/n-tier)\\nvarious logical layers into separate\", \" physical tiers. N-Tier architecture is a physical implementation of\\nN-Layer architecture. The most \", \"common implementation of this architecture includes:\\n\\n\\n- A presentation tier, for example a web app.\", \"\\n\\n- An API or data access tier, such as a REST API.\\n\\n- A data tier, such as a SQL database.\\n\\n\\nN-tier\", \" solutions have the following characteristics:\\n\\n\\n- Projects are typically aligned with tiers.\\n\\n- Tes\", \"ting may be approached differently by tier.\\n\\n- Tiers provide layers of abstraction, for example the \", \"presentation tier is typically ignorant of the\\nimplementation details of the data tier.\\n\\n- Typically\", \", layers only interact with adjacent layers.\\n\\n- Releases are often managed at the project, and there\", \"fore tier, level. A simple API change may\\nrequire a new release of an entire middle tier.\\n\\n\\nThis app\", \"roach provides several benefits, including:\\n\\n\\n- Isolation of the database (often the front end doesn\", \"\\u2019t have direct access to the database back\\nend).\\n\\n- Reuse of the API (for example, mobile, desktop, \", \"and web app clients can all reuse the same APIs).\\n\\n\\n5 CHAPTER 1 | Architecture approaches\\n\\n\\n- Abilit\", \"y to scale out tiers independent of each other.\\n\\n- Refactoring isolation: one tier may be refactored\", \" without impacting other tiers.\\n\\n#### **On-premises and Infrastructure as a Service (IaaS)**\\n\\n\\nThe t\", \"raditional approach to hosting applications requires buying hardware and managing all of the\\nsoftwar\", \"e installations, including the operating system. Originally this involved expensive data centers\\nand\", \" physical hardware. The challenges that come with operating physical hardware are many,\\nincluding:\\n\\n\", \"\\n- The need to buy excess for \\u201cjust in case\\u201d or peak demand scenarios.\\n\\n- Securing physical access t\", \"o the hardware.\\n\\n- Responsibility for hardware failure (such as disk failure).\\n\\n- Cooling.\\n\\n- Config\", \"uring routers and load balancers.\\n\\n- Power redundancy.\\n\\n- Securing software access.\\n\\n\\nVirtualization\", \" of hardware, via \\u201cvirtual machines\\u201d enables Infrastructure as a Service (IaaS). Host\\nmachines are e\", \"ffectively partitioned to provide resources to instances with allocations for their own\\nmemory, CPU,\", \" and storage. The team provisions the necessary VMs and configures the associated\\nnetworks and acces\", \"s to storage.\\n\\n\\n[For more information, see virtual machine N-tier reference architecture.](https://d\", \"ocs.microsoft.com/azure/architecture/reference-architectures/virtual-machines-windows/n-tier)\\n\\n\\nAlth\", \"ough virtualization and Infrastructure as a Service (IaaS) address many concerns, it still leaves\\nmu\", \"ch responsibility in the hands of the infrastructure team. The team maintains operating system\\nversi\", \"ons, applies security patches, and installs third-party dependencies on the target machines. Apps\\nof\", \"ten behave differently on production machines compared to the test environment. Issues arise due\\nto \", \"different dependency versions and/or OS SKU levels. Although many organizations deploy N-Tier\\napplic\", \"ations to these targets, many companies benefit from deploying to a more cloud native model\\n\\n\\n6 CHAP\", \"TER 1 | Architecture approaches\\n\\n\\nsuch as Platform as a Service. Architectures with microservices ar\", \"e more challenging because of the\\nrequirements to scale out for elasticity and resiliency.\\n\\n\\n[For mo\", \"re information, see virtual machines.](https://docs.microsoft.com/azure/virtual-machines/)\\n\\n#### **P\", \"latform as a Service (PaaS)**\\n\\n\\nPlatform as a Service (PaaS) offers configured solutions that develo\", \"pers can plug into directly. PaaS is\\nanother term for managed hosting. It eliminates the need to man\", \"age the base operating system,\\nsecurity patches and in many cases any third-party dependencies. Exam\", \"ples of platforms include web\\napplications, databases, and mobile back ends.\\n\\n\\nPaaS addresses the ch\", \"allenges common to IaaS. PaaS allows the developer to focus on the code or\\ndatabase schema rather th\", \"an how it gets deployed. Benefits of PaaS include:\\n\\n\\n- Pay for use models that eliminate the overhea\", \"d of investing in idle machines.\\n\\n- Direct deployment and improved DevOps, continuous integration (C\", \"I), and continuous delivery\\n(CD) pipelines.\\n\\n- Automatic upgrades, updates, and security patches.\\n\\n-\", \" Push-button scale out and scale up (elastic scale).\\n\\n\\nThe main disadvantage of PaaS traditionally h\", \"as been vendor lock-in. For example, some PaaS\\nproviders only support ASP.NET, Node.js, or other spe\", \"cific languages and platforms. Products like\\nAzure App Service have evolved to address multiple plat\", \"forms and support a variety of languages and\\nframeworks for hosting web apps.\\n\\n#### **Software as a \", \"Service (SaaS)**\\n\\n\\nSoftware as a Service or SaaS is centrally hosted and available without local ins\", \"tallation or\\nprovisioning. SaaS often is hosted on top of PaaS as a platform for deploying software.\", \" SaaS provides\\nservices to run and connect with existing software. SaaS is often industry and vertic\", \"al specific. SaaS is\\noften licensed and typically provides a client/server model. Most modern SaaS o\", \"fferings use web\\n\\n7 CHAPTER 1 | Architecture approaches\\n\\n\\nbased apps for the client. Companies typic\", \"ally consider SaaS as a business solution to license\\nofferings. It isn\\u2019t often implemented as archit\", \"ecture consideration for scalability and maintainability of\\nan application. Indeed, most SaaS soluti\", \"ons are built on IaaS, PaaS, and/or serverless back ends.\\n\\n\\n[Learn more about SaaS through a sample \", \"application.](https://docs.microsoft.com/azure/sql-database/saas-tenancy-welcome-wingtip-tickets-app\", \")\\n\\n#### **Containers and Functions as a Service (FaaS)**\\n\\n\\nContainers are an interesting solution th\", \"at enables PaaS-like benefits without the IaaS overhead. A\\ncontainer is essentially a runtime that c\", \"ontains the bare essentials needed to run a unique application.\\nThe kernel or core part of the host \", \"operating system and services such as storage are shared across a\\nhost. The shared kernel enables co\", \"ntainers to be lightweight (some are mere megabytes in size,\\ncompared to the gigabyte size of typica\", \"l virtual machines). With hosts already running, containers can\\nbe started quickly, facilitating hig\", \"h availability. The ability to spin up containers quickly also provides\\nextra layers of resiliency. \", \"Docker is one of the more popular implementations of containers.\\n\\n\\nBenefits of containers include:\\n\\n\", \"\\n- Lightweight and portable\\n\\n- Self-contained so no need to install dependencies\\n\\n- Provide a consis\", \"tent environment regardless of the host (runs exactly same on a laptop as on a\\ncloud server)\\n\\n- Can \", \"be provisioned quickly for scale-out\\n\\n- Can be restarted quickly to recover from failure\\n\\n\\nA contain\", \"er runs on a container host (that in turn may run on a bare metal machine or a virtual\\nmachine). Mul\", \"tiple containers or instances of the same containers may run on a single host. For true\\nfailover and\", \" resiliency, containers must be scaled across hosts.\\n\\n\\n[For more information about Docker containers\", \", see What is Docker.](https://docs.microsoft.com/dotnet/architecture/microservices/container-docker\", \"-introduction/docker-defined)\\n\\n\\nManaging containers across hosts typically requires an orchestration\", \" tool such as Kubernetes.\\nConfiguring and managing orchestration solutions may add additional overhe\", \"ad and complexity to\\nprojects. Fortunately, many cloud providers provide orchestration services thro\", \"ugh PaaS solutions to\\nsimplify the management of containers.\\n\\n\\nThe following image illustrates an ex\", \"ample Kubernetes installation. Nodes in the installation address\\nscale out and failover. They run Do\", \"cker container instances that are managed by the primary server.\\nThe _kubelet_ is the client that re\", \"lays commands from Kubernetes to Docker.\\n\\n\\n8 CHAPTER 1 | Architecture approaches\\n\\n\\n[For more informa\", \"tion about orchestration, see Kubernetes on Azure.](https://docs.microsoft.com/azure/aks/intro-kuber\", \"netes)\\n\\n\\nFunctions as a Service (FaaS) is a specialized container service that is similar to serverl\", \"ess. A specific\\n[implementation of FaaS, called OpenFaaS, sits on top of containers to provide serve\", \"rless capabilities.](https://github.com/openfaas/faas)\\nOpenFaaS provides templates that package all \", \"of the container dependencies necessary to run a piece\\nof code. Using templates simplifies the proce\", \"ss of deploying code as a functional unit. OpenFaaS\\ntargets architectures that already include conta\", \"iners and orchestrators because it can use the existing\\ninfrastructure. Although it provides serverl\", \"ess functionality, it specifically requires you to use Docker\\nand an orchestrator.\\n\\n#### **Serverles\", \"s**\\n\\n\\nA serverless architecture provides a clear separation between the code and its hosting environ\", \"ment.\\nYou implement code in a _function_ that is invoked by a _trigger_ . After that function exits,\", \" all its needed\\nresources may be freed. The trigger might be manual, a timed process, an HTTP reques\", \"t, or a file\\nupload. The result of the trigger is the execution of code. Although serverless platfor\", \"ms vary, most\\nprovide access to pre-defined APIs and bindings to streamline tasks such as writing to\", \" a database or\\nqueueing results.\\n\\n\\nServerless is an architecture that relies heavily on abstracting \", \"away the host environment to focus on\\ncode. It can be thought of as _less server_ .\\n\\n\\nContainer solu\", \"tions provide developers existing build scripts to publish code to serverless-ready\\nimages. Other im\", \"plementations use existing PaaS solutions to provide a scalable architecture.\\n\\n\\nThe abstraction mean\", \"s the DevOps team doesn\\u2019t have to provision or manage servers, nor specific\\ncontainers. The serverle\", \"ss platform hosts code, either as script or packaged executables built with a\\nrelated SDK, and alloc\", \"ates the necessary resources for the code to scale.\\n\\n\\nThe following diagram illustrates four serverl\", \"ess components. An HTTP request causes the Checkout\\nAPI code to run. The Checkout API inserts code i\", \"nto a database, and the insert triggers several other\\nfunctions to run to perform tasks like computi\", \"ng tasks and fulfilling the order.\\n\\n\\n9 CHAPTER 1 | Architecture approaches\\n\\n\\nThe advantages of serve\", \"rless include:\\n\\n\\n- **High density.** Many instances of the same serverless code can run on the same \", \"host compared\\nto containers or virtual machines. The instances scale across multiple hosts addressin\", \"g scale out\\nand resiliency.\\n\\n- **Micro-billing.** Most serverless providers bill based on serverless\", \" executions, enabling massive\\ncost savings in certain scenarios.\\n\\n- **Instant scale.** Serverless ca\", \"n scale to match workloads automatically and quickly.\\n\\n- **Faster time to market.** Developers focus\", \" on code and deploy directly to the serverless platform.\\nComponents can be released independently of\", \" each other.\\n\\n\\nServerless is most often discussed in the context of compute, but can also apply to d\", \"ata. For example,\\n[Azure SQL](https://docs.microsoft.com/azure/sql-database) [and Cosmos DB both pro\", \"vide cloud databases that don\\u2019t require you to configure host](https://docs.microsoft.com/azure/cosm\", \"os-db)\\nmachines or clusters. This book focuses on serverless compute.\\n\\n#### **Summary**\\n\\n\\nThere\\u2019s a \", \"broad spectrum of available choices for architecture, including a hybrid approach. Serverless\\nsimpli\", \"fies the approach, management, and cost of application features at the expense of control and\\nportab\", \"ility. However, many serverless platforms do expose configuration to help fine-tune the\\nsolution. Go\", \"od programming practices can also lead to more portable code and less serverless\\nplatform lock-in. T\", \"he following table illustrates the architecture approaches side by side. Choose\\nserverless based on \", \"your scale needs, whether or not you want to manage the runtime, and how well\\nyou can break your wor\", \"kloads into small components. You\\u2019ll learn about potential challenges with\\nserverless and other deci\", \"sion points in the next chapter.\\n\\n|Col1|IaaS|PaaS|Container|Serverless|\\n|---|---|---|---|---|\\n|**Sca\", \"le**|VM|Instance|App|Function|\\n|**Abstracts**|Hardware|Platform|OS Host|Runtime|\\n|**Unit**|VM|Projec\", \"t|Image|Code|\\n\\n\\n\\n10 CHAPTER 1 | Architecture approaches\\n\\n\\n|Col1|IaaS|PaaS|Container|Serverless|\\n|---\", \"|---|---|---|---|\\n|**Lifetime**|Months|Days to Months|Minutes to Days|Milliseconds<br>to Minutes|\\n|*\", \"*Responsibility**|Applications,<br>dependencies, runtime,<br>and operating system|Applications and<b\", \"r>dependencies|Applications,<br>dependencies, and<br>runtime|Function|\\n\\n\\n\\n\\n- **Scale** refers to the\", \" unit that is used to scale the application\\n\\n- **Abstracts** refers to the layer that is abstracted \", \"by the implementation\\n\\n- **Unit** refers to the scope of what is deployed\\n\\n- **Lifetime** refers to \", \"the typical runtime of a specific instance\\n\\n- **Responsibility** refers to the overhead to build, de\", \"ploy, and maintain the application\\n\\n\\nThe next chapter will focus on serverless architecture, use cas\", \"es, and design patterns.\\n\\n#### **Recommended resources**\\n\\n\\n- [Azure application architecture guide](\", \"https://docs.microsoft.com/azure/architecture/guide/)\\n\\n- [Azure Cosmos DB](https://docs.microsoft.co\", \"m/azure/cosmos-db)\\n\\n- [Azure SQL](https://docs.microsoft.com/azure/sql-database)\\n\\n- [N-Tier architec\", \"ture pattern](https://docs.microsoft.com/azure/architecture/guide/architecture-styles/n-tier)\\n\\n- [Ku\", \"bernetes on Azure](https://docs.microsoft.com/azure/aks/intro-kubernetes)\\n\\n- [Microservices](https:/\", \"/docs.microsoft.com/azure/architecture/guide/architecture-styles/microservices)\\n\\n- [Virtual machine \", \"N-tier reference architecture](https://docs.microsoft.com/azure/architecture/reference-architectures\", \"/virtual-machines-windows/n-tier)\\n\\n- [Virtual machines](https://docs.microsoft.com/azure/virtual-mac\", \"hines/)\\n\\n- [What is Docker?](https://docs.microsoft.com/dotnet/architecture/microservices/container-\", \"docker-introduction/docker-defined)\\n\\n- [Wingtip Tickets SaaS application](https://docs.microsoft.com\", \"/azure/sql-database/saas-tenancy-welcome-wingtip-tickets-app)\\n\\n\\n11 CHAPTER 1 | Architecture approach\", \"es\\n\\n\\n**CHAPTER**\\n# **2**\\n\\n## Serverless architecture\\n\\n\\n[There are many approaches to using serverles\", \"s](https://azure.com/serverless) architectures. This chapter explores examples of\\ncommon architectur\", \"es that integrate serverless. It also covers concerns that may pose additional\\nchallenges or require\", \" extra consideration when implementing serverless. Finally, several design\\nexamples are provided tha\", \"t illustrate various serverless use cases.\\n\\n\\nServerless hosts often use an existing container-based \", \"or PaaS layer to manage the serverless\\n[instances. For example, Azure Functions is based on Azure Ap\", \"p Service. The App Service is used to](https://docs.microsoft.com/azure/app-service/)\\nscale out inst\", \"ances and manage the runtime that executes Azure Functions code. For Windows-based\\nfunctions, the ho\", \"st runs as PaaS and scales out the .NET runtime. For Linux-based functions, the host\\nleverages conta\", \"iners.\\n\\n\\nThe WebJobs Core provides an execution context for the function. The Language Runtime runs \", \"scripts,\\nexecutes libraries and hosts the framework for the target language. For example, Node.js is\", \" used to\\nrun JavaScript functions and the .NET Framework is used to run C# functions. You\\u2019ll learn m\", \"ore about\\nlanguage and platform options later in this chapter.\\n\\n\\nSome projects may benefit from taki\", \"ng an \\u201call-in\\u201d approach to serverless. Applications that rely heavily\\non microservices may implement\", \" all microservices using serverless technology. The majority of apps\\nare hybrid, following an N-tier\", \" design and using serverless for the components that make sense\\n\\n\\n12 CHAPTER 2 | Serverless architec\", \"ture\\n\\n\\nbecause the components are modular and independently scalable. To help make sense of these\\nsc\", \"enarios, this section walks through some common architecture examples that use serverless.\\n\\n### Full\", \" serverless back end\\n\\n\\nThe full serverless back end is ideal for several types of scenarios, especia\", \"lly when building new or\\n\\u201cgreen field\\u201d applications. An application with a large surface area of API\", \"s may benefit from\\nimplementing each API as a serverless function. Apps that are based on microservi\", \"ces architecture are\\nanother example that could be implemented as a full serverless back end. The mi\", \"croservices\\ncommunicate over various protocols with each other. Specific scenarios include:\\n\\n\\n- API-\", \"based SaaS products (example: financial payments processor).\\n\\n- Message-driven applications (example\", \": device monitoring solution).\\n\\n- Apps focused on integration between services (example: airline boo\", \"king application).\\n\\n- Processes that run periodically (example: timer-based database clean-up).\\n\\n- A\", \"pps focused on data transformation (example: import triggered by file upload).\\n\\n- Extract Transform \", \"and Load (ETL) processes.\\n\\n\\nThere are other, more specific use cases that are covered later in this \", \"document.\\n\\n### Monoliths and \\u201cstarving the beast\\u201d\\n\\n\\nA common challenge is migrating an existing mono\", \"lithic application to the cloud. The least risky\\napproach is to \\u201clift and shift\\u201d entirely onto virtu\", \"al machines. Many shops prefer to use the migration as\\nan opportunity to modernize their code base. \", \"A practical approach to migration is called \\u201cstarving the\\nbeast.\\u201d In this scenario, the monolith is \", \"migrated \\u201cas is\\u201d to start with. Then, selected services are\\nmodernized. In some cases, the signature\", \" of the service is identical to the original: it simply is hosted\\nas a function. Clients are updated\", \" to use the new service rather than the monolith endpoint. In the\\ninterim, steps such as database re\", \"plication enable microservices to host their own storage even when\\ntransactions are still handled by\", \" the monolith. Eventually, all clients are migrated onto the new\\nservices. The monolith is \\u201cstarved\\u201d\", \" (its services no longer called) until all functionality has been\\nreplaced. The combination of serve\", \"rless and proxies can facilitate much of this migration.\\n\\n\\n13 CHAPTER 2 | Serverless architecture\\n\\n\\n\", \"[To learn more about this approach, watch the video: Bring your app to the cloud with serverless Azu\", \"re](https://docs.microsoft.com/Events/Connect/2017/E102)\\n[Functions.](https://docs.microsoft.com/Eve\", \"nts/Connect/2017/E102)\\n\\n### Web apps\\n\\n\\nWeb apps are great candidates for serverless applications. Th\", \"ere are two common approaches to web\\napps today: server-driven, and client-driven (such as Single Pa\", \"ge Application or SPA). Server-driven\\nweb apps typically use a middleware layer to issue API calls t\", \"o render the web UI. SPA applications\\nmake REST API calls directly from the browser. In both scenari\", \"os, serverless can accommodate the\\nmiddleware or REST API request by providing the necessary busines\", \"s logic. A common architecture is\\nto stand up a lightweight static web server. The Single Page Appli\", \"cation (SPA) serves HTML, CSS,\\nJavaScript, and other browser assets. The web app then connects to a \", \"microservices back end.\\n\\n### Mobile back ends\\n\\n\\nThe event-driven paradigm of serverless apps makes t\", \"hem ideal as mobile back ends. The mobile\\ndevice triggers the events and the serverless code execute\", \"s to satisfy requests. Taking advantage of a\\nserverless model enables developers to enhance business\", \" logic without having to deploy a full\\napplication update. The serverless approach also enables team\", \"s to share endpoints and work in\\nparallel.\\n\\n\\nMobile developers can build business logic without beco\", \"ming experts on the server side. Traditionally,\\nmobile apps connected to on-premises services. Build\", \"ing the service layer required understanding the\\nserver platform and programming paradigm. Developer\", \"s worked with operations to provision servers\\n\\n\\n14 CHAPTER 2 | Serverless architecture\\n\\n\\nand configu\", \"re them appropriately. Sometimes days or even weeks were spent on building a\\ndeployment pipeline. Al\", \"l of these challenges are addressed by serverless.\\n\\n\\nServerless abstracts the server-side dependenci\", \"es and enables the developer to focus on business\\nlogic. For example, a mobile developer who builds \", \"apps using a JavaScript framework can build\\nserverless functions with JavaScript as well. The server\", \"less host manages the operating system, a\\nNode.js instance to host the code, package dependencies, a\", \"nd more. The developer is provided a\\nsimple set of inputs and a standard template for outputs. They \", \"then can focus on building and testing\\nthe business logic. They\\u2019re therefore able to use existing sk\", \"ills to build the back-end logic for the\\nmobile app without having to learn new platforms or become \", \"a \\u201cserver-side developer.\\u201d\\n\\n\\nMost cloud providers offer mobile-based serverless products that simpli\", \"fy the entire mobile\\ndevelopment lifecycle. The products may automate the provisioning of databases \", \"to persist data,\\nhandle DevOps concerns, provide cloud-based builds and testing frameworks and the a\", \"bility to script\\nbusiness processes using the developer\\u2019s preferred language. Following a mobile-cen\", \"tric serverless\\napproach can streamline the process. Serverless removes the tremendous overhead of p\", \"rovisioning,\\nconfiguring, and maintaining servers for the mobile back end.\\n\\n### Internet of Things (\", \"IoT)\\n\\n\\nIoT refers to physical objects that are networked together. They\\u2019re sometimes referred to as\\n\", \"\\u201cconnected devices\\u201d or \\u201csmart devices.\\u201d Everything from cars and vending machines may be\\nconnected a\", \"nd send information ranging from inventory to sensor data such as temperature and\\nhumidity. In the e\", \"nterprise, IoT provides business process improvements through monitoring and\\nautomation. IoT data ma\", \"y be used to regulate the climate in a large warehouse or track inventory\\nthrough the supply chain. \", \"IoT can sense chemical spills and call the fire department when smoke is\\ndetected.\\n\\n\\nThe sheer volum\", \"e of devices and information often dictates an event-driven architecture to route and\\nprocess messag\", \"es. Serverless is an ideal solution for several reasons:\\n\\n\\n- Enables scale as the volume of devices \", \"and data increases.\\n\\n- Accommodates adding new endpoints to support new devices and sensors.\\n\\n- Faci\", \"litates independent versioning so developers can update the business logic for a specific\\ndevice wit\", \"hout having to deploy the entire system.\\n\\n- Resiliency and less downtime.\\n\\n\\n15 CHAPTER 2 | Serverles\", \"s architecture\\n\\n\\nThe pervasiveness of IoT has resulted in several serverless products that focus spe\", \"cifically on IoT\\n[concerns, such as Azure IoT Hub. Serverless automates tasks such as device registr\", \"ation, policy](https://docs.microsoft.com/azure/iot-hub)\\nenforcement, tracking, and even deployment \", \"of code to devices at _the edge_ . The edge refers to\\ndevices like sensors and actuators that are co\", \"nnected to, but not an active part of, the Internet.\\n\\n### Serverless architecture considerations\\n\\n\\nA\", \"dopting a serverless architecture does come with certain challenges. This section explores some of\\nt\", \"he more common considerations to be aware of. All of these challenges have solutions. As with all\\nar\", \"chitecture choices, the decision to go serverless should be made only after carefully considering th\", \"e\\npros and cons. Depending on the needs of your application, you may decide a serverless\\nimplementat\", \"ion isn\\u2019t the right solution for certain components.\\n\\n#### **Managing state**\\n\\n\\nServerless functions\", \", as with microservices in general, are stateless by default. Avoiding state enables\\nserverless to b\", \"e ephemeral, to scale out, and to provide resiliency without a central point of failure. In\\nsome cir\", \"cumstances, business processes require state. If your process requires state, you have two\\noptions. \", \"You can adopt a model other than serverless, or interact with a separate service that provides\\nstate\", \". Adding state can complicate the solution and make it harder to scale, and potentially create a\\nsin\", \"gle point of failure. Carefully consider whether your function absolutely requires state. If the ans\", \"wer\\nis \\u201cyes,\\u201d determine whether it still makes sense to implement it with serverless.\\n\\n\\nThere are se\", \"veral solutions to adopt state without compromising the benefits of serverless. Some of\\nthe more pop\", \"ular solutions include:\\n\\n\\n- Use a temporary data store or distributed cache, like Redis\\n\\n- Store sta\", \"te in a database, like SQL or CosmosDB\\n\\n- [Handle state through a workflow engine like durable funct\", \"ions](https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-overview)\\n\\n\\nThe bot\", \"tom line is that you should be aware of the need for any state management within processes\\nyou\\u2019re co\", \"nsidering to implement with serverless.\\n\\n#### **Long-running processes**\\n\\n\\nMany benefits of serverle\", \"ss rely on the processes being ephemeral. Short run times make it easier for\\nthe serverless provider\", \" to free up resources as functions end and share functions across hosts. Most\\ncloud providers limit \", \"the total time your function can run to around 10 minutes. If your process may\\ntake longer, you migh\", \"t consider an alternative implementation.\\n\\n\\nThere are a few exceptions and solutions. One solution m\", \"ay be to break your process into smaller\\ncomponents that individually take less time to run. If your\", \" process runs long because of dependencies,\\nyou can also consider an asynchronous workflow using a s\", \"olution like durable functions. Durable\\nfunctions pause and maintain the state of your process while\", \" it\\u2019s waiting on an external process to\\nfinish. Asynchronous handling reduces the time the actual pr\", \"ocess runs.\\n\\n\\n16 CHAPTER 2 | Serverless architecture\\n\\n\\n#### **Startup time**\\n\\nOne potential concern \", \"with serverless implementations is startup time. To conserve resources, many\\nserverless providers cr\", \"eate infrastructure \\u201con demand.\\u201d When a serverless function is triggered after a\\nperiod of time, the\", \" resources to host the function may need to be created or restarted. In some\\nsituations, cold starts\", \" may result in delays of several seconds. Startup time varies across providers and\\nservice levels. T\", \"here are a few approaches to address startup time if it\\u2019s important to minimize for the\\nsuccess of t\", \"he app.\\n\\n\\n- Some providers allow users to pay for service levels that guarantee infrastructure is \\u201ca\", \"lways on\\u201d.\\n\\n- Implement a keep-alive mechanism (ping the endpoint to keep it \\u201cawake\\u201d).\\n\\n- Use orches\", \"tration like Kubernetes with a containerized function approach (the host is already\\nrunning so spinn\", \"ing up new instances is extremely fast).\\n\\n#### **Database updates and migrations**\\n\\n\\nAn advantage of\", \" serverless code is that you can release new functions without having to redeploy the\\nentire applica\", \"tion. This advantage can become a disadvantage when there\\u2019s a relational database\\ninvolved. Changes \", \"to database schemas are difficult to synchronize with serverless updates. Additional\\nchallenges are \", \"posed when things go wrong and the changes must be rolled back. Data integrity is\\none reason that a \", \"best practice for microservices and serverless functions is that they own their own\\ndata. It is poss\", \"ible to deploy changes as a single unit of compute and data. The reality is that many\\nlegacy systems\", \" feature a large back-end database that must be reconciled with the serverless\\narchitecture.\\n\\n\\nA pop\", \"ular approach to solve schema versioning is to never modify existing properties and columns,\\nbut ins\", \"tead add new information. For example, consider a change to move from a Boolean\\n\\u201ccompleted\\u201d flag for\", \" a todo list to a \\u201ccompleted date.\\u201d Instead of removing the old field, the database\\nchange will:\\n\\n\\n1\", \". Add a new \\u201ccompleted date\\u201d field.\\n\\n2. Transform the \\u201ccompleted\\u201d Boolean field to a computed functi\", \"on that evaluates whether the\\ncompleted date is after the current date.\\n\\n3. Add a trigger to set the\", \" completed date to the current date when the completed Boolean is set\\nto true.\\n\\n\\nThe sequence of cha\", \"nges ensures that legacy code continues to run \\u201cas is\\u201d while newer serverless\\nfunctions can take adv\", \"antage of the new field.\\n\\n\\n[For more information about data in serverless architectures, see Challen\", \"ges and solutions for](https://docs.microsoft.com/dotnet/architecture/microservices/architect-micros\", \"ervice-container-applications/distributed-data-management)\\n[distributed data management.](https://do\", \"cs.microsoft.com/dotnet/architecture/microservices/architect-microservice-container-applications/dis\", \"tributed-data-management)\\n\\n#### **Scaling**\\n\\n\\nIt\\u2019s a common misconception that serverless means \\u201cno \", \"server.\\u201d It\\u2019s in fact \\u201cless server.\\u201d The fact there\\nis a backing infrastructure is important to unde\", \"rstand when it comes to scaling. Most serverless\\nplatforms provide a set of controls to handle how t\", \"he infrastructure should scale when event density\\nincreases. You can choose from a variety of option\", \"s, but your strategy may vary depending on the\\n\\n\\n17 CHAPTER 2 | Serverless architecture\\n\\n\\nfunction. \", \"Furthermore, functions are typically run under a related host, so that functions on the same\\nhost ha\", \"ve the same scale options. Therefore it is necessary to organize and strategize which functions\\nare \", \"hosted together based on scale requirements.\\n\\n\\nRules often specify how to scale-up (increase the hos\", \"t resources) and scale-out (increase the number\\nof host instances) based on varying parameters. Trig\", \"gers for scales may include schedule, request\\nrates, CPU utilization, and memory usage. Higher perfo\", \"rmance often comes at a greater cost. The less\\nexpensive, consumption-based approaches may not scale\", \" as quickly when the request rate suddenly\\nincreases. There is a trade-off between paying up front \\u201c\", \"insurance cost\\u201d versus paying strictly \\u201cas you\\ngo\\u201d and risking slower responses due to sudden increa\", \"ses in demand.\\n\\n#### **Monitoring, tracing, and logging**\\n\\n\\nAn often overlooked aspect of DevOps is \", \"monitoring applications once deployed. It\\u2019s important to\\nhave a strategy for monitoring serverless f\", \"unctions. The biggest challenge is often correlation, or\\nrecognizing when a user calls multiple func\", \"tions as part of the same interaction. Most serverless\\nplatforms allow console logging that can be i\", \"mported into third-party tools. There are also options to\\nautomate collection of telemetry, generate\", \" and track correlation IDs, and monitor specific actions to\\n[provide detailed insights. Azure provid\", \"es the advanced Application Insights platform for monitoring](https://docs.microsoft.com/azure/azure\", \"-functions/functions-monitoring)\\nand analytics.\\n\\n#### **Inter-service dependencies**\\n\\n\\nA serverless \", \"architecture may include functions that rely on other functions. In fact, it isn\\u2019t uncommon\\nin a ser\", \"verless architecture to have multiple services call each other as part of an interaction or\\ndistribu\", \"ted transaction. To avoid strong coupling, it\\u2019s recommended that services don\\u2019t reference each\\nother\", \" directly. When the endpoint for a service needs to change, direct references could result in\\nmajor \", \"refactoring. A suggested solution is to provide a service discovery mechanism, such as a\\nregistry, t\", \"hat provides the appropriate end point for a request type. Another solution is to leverage\\nmessaging\", \" services like queues or topics for communication between services.\\n\\n#### **Managing failure and pro\", \"viding resiliency**\\n\\n\\nIt\\u2019s also important to consider the _circuit-breaker pattern_ : If, for some r\", \"eason, a service continues to\\nfail, it isn\\u2019t advisable to call that service repeatedly. Instead, an \", \"alternative service is called or a\\nmessage returned until the health of the dependent service is re-\", \"established. The serverless\\narchitecture needs to take into account the strategy for resolving and m\", \"anaging inter-service\\ndependencies.\\n\\n\\nTo continue the circuit-breaker pattern, services need to be f\", \"ault tolerant and resilient. Fault tolerance\\nrefers to the ability of your application to continue r\", \"unning even after unexpected exceptions or\\ninvalid states are encountered. Fault tolerance is typica\", \"lly a function of the code itself and how it\\u2019s\\nwritten to handle exceptions. Resiliency refers to ho\", \"w capable the app is at recovering from failures.\\nResiliency is often managed by the serverless plat\", \"form. The platform should be able to spin up a new\\nserverless function instance when the existing on\", \"e fails. The platform should also be intelligent\\nenough to stop spinning up new instances when every\", \" new instance fails.\\n\\n\\n18 CHAPTER 2 | Serverless architecture\\n\\n\\n[For more information, see Implement\", \"ing the Circuit Breaker pattern.](https://docs.microsoft.com/dotnet/architecture/microservices/imple\", \"ment-resilient-applications/implement-circuit-breaker-pattern)\\n\\n#### **Versioning and green/blue dep\", \"loyments**\\n\\n\\nA major benefit of serverless is the ability to upgrade a specific function without hav\", \"ing to redeploy\\nthe entire application. For upgrades to be successful, functions must be versioned s\", \"o that services\\ncalling them are routed to the correct version of code. A strategy for deploying new\", \" versions is also\\nimportant. A common approach is to use \\u201cgreen/blue deployments.\\u201d The green deploym\", \"ent is the\\ncurrent function. A new \\u201cblue\\u201d version is deployed to production and tested. When testing\", \" passes, the\\ngreen and blue versions are swapped so the new version comes live. If any issues are en\", \"countered,\\nthey can be swapped back. Supporting versioning and green/blue deployments requires a\\ncom\", \"bination of authoring the functions to accommodate version changes and working with the\\nserverless p\", \"latform to handle deployments.\\n\\n### Serverless design examples\\n\\n\\nThere are many design patterns that\", \" exist for serverless. This section captures some common\\nscenarios that use serverless. What all of \", \"the examples have in common is the fundamental\\ncombination of an event trigger and business logic.\\n\\n\", \"#### **Scheduling**\\n\\n\\nScheduling tasks is a common function. The following diagram shows a legacy da\", \"tabase that doesn\\u2019t\\nhave appropriate integrity checks. The database must be scrubbed periodically. T\", \"he serverless\\nfunction finds invalid data and cleans it. The trigger is a timer that runs the code o\", \"n a schedule.\\n\\n#### **Command and Query Responsibility Segregation (CQRS)**\\n\\n\\nCommand and Query Resp\", \"onsibility Segregation (CQRS) is a pattern that provides different interfaces\\nfor reading (or queryi\", \"ng) data and operations that modify data. It addresses several common\\nproblems. In traditional Creat\", \"e Read Update Delete (CRUD) based systems, conflicts can arise from\\nhigh volume of both reads and wr\", \"ites to the same data store. Locking may frequently occur and\\ndramatically slow down reads. Often, d\", \"ata is presented as a composite of several domain objects and\\nread operations must combine data from\", \" different entities.\\n\\n\\nUsing CQRS, a read might involve a special \\u201cflattened\\u201d entity that models dat\", \"a the way it\\u2019s consumed.\\nThe read is handled differently than how it\\u2019s stored. For example, although\", \" the database may store a\\ncontact as a header record with a child address record, the read could inv\", \"olve an entity with both\\n\\n\\n19 CHAPTER 2 | Serverless architecture\\n\\n\\nheader and address properties. T\", \"here are myriad approaches to creating the read model. It might be\\nmaterialized from views. Update o\", \"perations could be encapsulated as isolated events that then trigger\\nupdates to two different models\", \". Separate models exist for reading and writing.\\n\\n\\nServerless can accommodate the CQRS pattern by pr\", \"oviding the segregated endpoints. One serverless\\nfunction accommodates queries or reads, and a diffe\", \"rent serverless function or set of functions\\nhandles update operations. A serverless function may al\", \"so be responsible for keeping the read model\\n[up-to-date, and can be triggered by the database\\u2019s cha\", \"nge feed. Front-end development is simplified](https://docs.microsoft.com/azure/cosmos-db/change-fee\", \"d)\\nto connecting to the necessary endpoints. Processing of events is handled on the back end. This\\nm\", \"odel also scales well for large projects because different teams may work on different operations.\\n\\n\", \"#### **Event-based processing**\\n\\n\\nIn message-based systems, events are often collected in queues or \", \"publisher/subscriber topics to be\\nacted upon. These events can trigger serverless functions to execu\", \"te a piece of business logic. An\\nexample of event-based processing is event-sourced systems. An \\u201ceve\", \"nt\\u201d is raised to mark a task as\\ncomplete. A serverless function triggered by the event updates the a\", \"ppropriate database document. A\\n[second serverless function may use the event to update the read mod\", \"el for the system. Azure Event](https://docs.microsoft.com/azure/event-grid/overview)\\n[Grid](https:/\", \"/docs.microsoft.com/azure/event-grid/overview) provides a way to integrate events with functions as \", \"subscribers.\\n\\n\\n[Events are informational messages. For more information, see Event Sourcing pattern.\", \"](https://docs.microsoft.com/azure/architecture/patterns/event-sourcing)\\n\\n#### **File triggers and t\", \"ransformations**\\n\\n\\nExtract, Transform, and Load (ETL) is a common business function. Serverless is a\", \" great solution for ETL\\nbecause it allows code to be triggered as part of a pipeline. Individual cod\", \"e components can address\\nvarious aspects. One serverless function may download the file, another app\", \"lies the transformation,\\nand another loads the data. The code can be tested and deployed independent\", \"ly, making it easier to\\nmaintain and scale where needed.\\n\\n\\n20 CHAPTER 2 | Serverless architecture\\n\\n\\n\", \"[In the diagram, \\u201ccool storage\\u201d provides data that is parsed in Azure Stream Analytics. Any issues](\", \"https://docs.microsoft.com/azure/stream-analytics)\\nencountered in the data stream trigger an Azure F\", \"unction to address the anomaly.\\n\\n#### **Asynchronous background processing and messaging**\\n\\n\\nAsynchr\", \"onous messaging and background processing allow applications to kick off processes without\\nhaving to\", \" wait. An example of asynchronous processing is an OCR app. An image is submitted and\\nqueued for pro\", \"cessing. Scanning the image to extract text may take time, and once it\\u2019s finished a\\nnotification is \", \"sent. Serverless can handle both the invocation and the result in this scenario.\\n\\n#### **Web apps an\", \"d APIs**\\n\\n\\nA popular scenario for serverless is N-tier applications, most commonly ones where the UI\", \" layer is a\\nweb app. The popularity of Single Page Applications (SPA) has surged recently. SPA apps \", \"render a\\nsingle page, then rely on API calls and the returned data to dynamically render new UI with\", \"out\\nreloading a full page. Client-side rendering provides a much faster, more responsive application\", \" to the\\nend user.\\n\\n\\nServerless endpoints triggered by HTTP calls can be used to handle the API reque\", \"sts. For example, an\\nad services company may call a serverless function with user profile informatio\", \"n to request custom\\nadvertising. The serverless function returns the custom ad and the web page rend\", \"ers it.\\n\\n\\n21 CHAPTER 2 | Serverless architecture\\n\\n\\n#### **Data pipeline**\\n\\nServerless functions can \", \"be used to facilitate a data pipeline. In this example, a file triggers a function\\nto translate data\", \" in a CSV file to data rows in a table. The organized table allows a Power BI dashboard\\nto present a\", \"nalytics to the end user.\\n\\n#### **Stream processing**\\n\\n\\nDevices and sensors often generate streams o\", \"f data that must be processed in real time. There are a\\n[number of technologies that can capture mes\", \"sages and streams from Event Hubs](https://docs.microsoft.com/azure/event-hubs/event-hubs-what-is-ev\", \"ent-hubs) [and IoT Hub](https://docs.microsoft.com/azure/iot-hub) to\\n[Service Bus. Regardless of tra\", \"nsport, serverless is an ideal mechanism for processing the messages](https://docs.microsoft.com/azu\", \"re/service-bus)\\nand streams of data as they come in. Serverless can scale quickly to meet the demand\", \" of large\\nvolumes of data. The serverless code can apply business logic to parse the data and output\", \" in a\\nstructured format for action and analytics.\\n\\n\\n22 CHAPTER 2 | Serverless architecture\\n\\n\\n#### **\", \"API gateway**\\n\\nAn API gateway provides a single point of entry for clients and then intelligently ro\", \"utes requests to\\nback-end services. It\\u2019s useful to manage large sets of services. It can also handle\", \" versioning and\\nsimplify development by easily connecting clients to disparate environments. Serverl\", \"ess can handle\\nback-end scaling of individual microservices while presenting a single front end via \", \"an API gateway.\\n\\n#### **Recommended resources**\\n\\n\\n- [Azure Event Grid](https://docs.microsoft.com/az\", \"ure/event-grid/overview)\\n\\n- [Azure IoT Hub](https://docs.microsoft.com/azure/iot-hub)\\n\\n- [Challenges\", \" and solutions for distributed data management](https://docs.microsoft.com/dotnet/architecture/micro\", \"services/architect-microservice-container-applications/distributed-data-management)\\n\\n- [Designing mi\", \"croservices: identifying microservice boundaries](https://docs.microsoft.com/azure/architecture/micr\", \"oservices/microservice-boundaries)\\n\\n- [Event Hubs](https://docs.microsoft.com/azure/event-hubs/event\", \"-hubs-what-is-event-hubs)\\n\\n- [Event Sourcing pattern](https://docs.microsoft.com/azure/architecture/\", \"patterns/event-sourcing)\\n\\n- [Implementing the Circuit Breaker pattern](https://docs.microsoft.com/do\", \"tnet/architecture/microservices/implement-resilient-applications/implement-circuit-breaker-pattern)\\n\", \"\\n- [IoT Hub](https://docs.microsoft.com/azure/iot-hub)\\n\\n- [Service Bus](https://docs.microsoft.com/a\", \"zure/service-bus)\\n\\n- [Working with the change feed support in Azure Cosmos DB](https://docs.microsof\", \"t.com/azure/cosmos-db/change-feed)\\n\\n\\n23 CHAPTER 2 | Serverless architecture\\n\\n\\n**CHAPTER** **CHAPTER*\", \"*\\n# 3 3\\n\\n## Azure serverless platform\\n\\n\\nThe Azure serverless platform includes Azure Functions, Logi\", \"c Apps, and Event Grid. These services\\nwork together and connect with myriad other resources. The se\", \"rverless platform works with\\neverything from databases and storage to analytics and machine learning\", \"/artificial intelligence.\\n\\n\\nYou can also use Application Insights, a serverless platform for capturi\", \"ng diagnostic traces and\\ntelemetry. Application Insights are available to applications of all types \", \"(desktop, mobile, or web) as\\nwell as serverless implementations. The platform is visualized in the f\", \"ollowing diagram:\\n\\n\\nThis chapter breaks down the fundamentals of each component.\\n\\n### Azure Function\", \"s\\n\\n\\nAzure Functions provide a serverless compute experience. A function is invoked by a _trigger_ (s\", \"uch as\\naccess to an HTTP endpoint or a timer) and executes a block of code or business logic. Functi\", \"ons also\\nsupport specialized _bindings_ that connect to resources like storage and queues.\\n\\n\\n24 CHAP\", \"TER 3 | Azure serverless platform\\n\\n\\nThe current runtime version 4.0 supports cross-platform .NET 7.0\", \" applications. Additional languages\\nbesides C# such as JavaScript, F#, and Java are supported. Funct\", \"ions created in the portal provide a\\nrich scripting syntax. Functions created as standalone projects\", \" can be deployed with full platform\\nsupport and capabilities.\\n\\n\\n[For more information, see Azure Fun\", \"ctions documentation.](https://docs.microsoft.com/azure/azure-functions)\\n\\n#### **Programming languag\", \"e support**\\n\\n\\nThe following languages are all supported in general availability (GA).\\n\\n|Language|Sup\", \"ported runtimes for 4.x|\\n|---|---|\\n|**C#**|.NET 6.0, 7.0, .NET Framework 4.8|\\n|**JavaScript**|Node 1\", \"4, 16, 18|\\n|**F#**|.NET 6.0, 7.0|\\n|**Java**|Java 8, 11, 17|\\n|**Python**|Python 3.7, 3.8, 3.9, 3.10|\\n\", \"|**TypeScript**|Node 14, 16, 18 (via JavaScript)|\\n|**PowerShell**|PowerShell Core 7.2|\\n\\n\\n\\n[For more \", \"information on other runtime versions, see Supported languages.](https://docs.microsoft.com/azure/az\", \"ure-functions/supported-languages)\\n\\n#### **App service plans**\\n\\n\\nFunctions are backed by an _app ser\", \"vice plan_ . The plan defines the resources used by the functions\\napp. You can assign plans to a reg\", \"ion, determine the size and number of virtual machines that will be\\nused, and pick a pricing tier. F\", \"or a true serverless approach, function apps may use the **consumption**\\nplan. The consumption plan \", \"will scale the back end automatically based on load.\\n\\n\\n[Another hosting option for function apps is \", \"the Premium plan. This plan provides an \\u201calways on\\u201d](https://docs.microsoft.com/azure/azure-function\", \"s/functions-premium-plan)\\ninstance to avoid cold start, supports advanced features like VNet connect\", \"ivity, and runs on premium\\nhardware.\\n\\n\\n[For more information, see App service plans.](https://docs.m\", \"icrosoft.com/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview)\\n\\n#### **Create y\", \"our first function**\\n\\n\\nThere are three common ways you can create function apps.\\n\\n\\n- Script function\", \"s in the portal.\\n\\n- Create the necessary resources using the Azure CLI.\\n\\n- Build functions locally u\", \"sing your favorite IDE and publish them to Azure.\\n\\n\\n25 CHAPTER 3 | Azure serverless platform\\n\\n\\n[For \", \"more information on creating a scripted function in the portal, see Create your first function in th\", \"e](https://docs.microsoft.com/azure/azure-functions/functions-create-first-azure-function)\\n[Azure po\", \"rtal.](https://docs.microsoft.com/azure/azure-functions/functions-create-first-azure-function)\\n\\n\\n[To\", \" build from the Azure CLI, see Create your first function using the Azure CLI.](https://docs.microso\", \"ft.com/azure/azure-functions/functions-create-first-azure-function-azure-cli)\\n\\n\\n[To create a functio\", \"n from Visual Studio, see Create your first function using Visual Studio.](https://docs.microsoft.co\", \"m/azure/azure-functions/functions-create-your-first-function-visual-studio)\\n\\n#### **Understand trigg\", \"ers and bindings**\\n\\n\\nFunctions are invoked by a _trigger_ and can have exactly one. In addition to i\", \"nvoking the function,\\ncertain triggers also serve as bindings. You may also define multiple bindings\", \" in addition to the\\ntrigger. _Bindings_ provide a declarative way to connect data to your code. They\", \" can be passed in (input)\\nor receive data (output). Triggers and bindings make functions easy to wor\", \"k with. Bindings remove the\\noverhead of manually creating database or file system connections. All o\", \"f the information needed for\\nthe bindings is contained in a special _functions.json_ file for script\", \"s or declared with attributes in code.\\n\\n\\nSome common triggers include:\\n\\n\\n- Blob Storage: invoke your\", \" function when a file or folder is uploaded or changed in storage.\\n\\n- HTTP: invoke your function lik\", \"e a REST API.\\n\\n- Queue: invoke your function when items exist in a queue.\\n\\n- Timer: invoke your func\", \"tion on a regular cadence.\\n\\n\\nExamples of bindings include:\\n\\n\\n- CosmosDB: easily connect to the datab\", \"ase to load or save files.\\n\\n- Table Storage: work with key/value storage from your function app.\\n\\n- \", \"Queue Storage: easily retrieve items from a queue, or place new items on the queue.\\n\\nThe following e\", \"xample _functions.json_ file defines a trigger and a binding:\\n\\n\\nIn this example, the function is tri\", \"ggered by a change to blob storage in the `images` container. The\\ninformation for the file is passed\", \" in, so the trigger also acts as a binding. Another binding exists to put\\ninformation onto a queue n\", \"amed `images` .\\n\\n\\n26 CHAPTER 3 | Azure serverless platform\\n\\n\\nHere is the C# script for the function:\", \"\\n\\n\\nThe example is a simple function that takes the name of the file that was modified or uploaded to\", \"\\nblob storage, and places it on a queue for later processing.\\n\\n\\n[For a full list of triggers and bin\", \"dings, see Azure Functions triggers and bindings concepts.](https://docs.microsoft.com/azure/azure-f\", \"unctions/functions-triggers-bindings)\\n\\n### Telemetry with Application Insights\\n\\n\\n[Application Insigh\", \"ts](https://docs.microsoft.com/azure/application-insights) is a serverless diagnostics platform that\", \" enables developers to detect, triage, and\\ndiagnose issues in web apps, mobile apps, desktop apps, a\", \"nd microservices. You can turn on\\nApplication Insights for function apps simply by flipping a switch\", \" in the portal. Application Insights\\nprovides all of these capabilities without you having to config\", \"ure a server or set up your own\\ndatabase. All of Application Insights\\u2019 capabilities are provided as \", \"a service that automatically\\nintegrates with your apps.\\n\\n\\nAdding Application Insights to existing ap\", \"ps is as easy as adding an instrumentation key to your\\napplication\\u2019s settings. With Application Insi\", \"ghts you can:\\n\\n\\n- Create custom charts and alerts based on metrics such as number of function invoca\", \"tions, the\\ntime it takes to run a function, and exceptions\\n\\n- Analyze failures and server exceptions\", \"\\n\\n- Drill into performance by operation and measure the time it takes to call third-party\\ndependenci\", \"es\\n\\n- Monitor CPU usage, memory, and rates across all servers that host your function apps\\n\\n- View a\", \" live stream of metrics including request count and latency for your function apps\\n\\n- [Use Analytics\", \"](https://docs.microsoft.com/azure/application-insights/app-insights-analytics) to search, query, an\", \"d create custom charts over your function data\\n\\n\\n27 CHAPTER 3 | Azure serverless platform\\n\\n\\nIn addit\", \"ion to built-in telemetry, it\\u2019s also possible to generate custom telemetry. The following code\\nsnipp\", \"et creates a custom telemetry client using the instrumentation key set for the function app:\\n\\n\\n[The \", \"following code measures how long it takes to insert a new row into an Azure Table Storage](https://d\", \"ocs.microsoft.com/azure/cosmos-db/table-storage-overview)\\ninstance:\\n\\n\\nThe resulting performance grap\", \"h is shown:\\n\\n\\n28 CHAPTER 3 | Azure serverless platform\\n\\n\\nThe custom telemetry reveals the average ti\", \"me to insert a new row is 32.6 milliseconds.\\n\\n\\nApplication Insights provides a powerful, convenient \", \"way to log detailed telemetry about your\\nserverless applications. You have full control over the lev\", \"el of tracing and logging that is provided.\\nYou can track custom statistics such as events, dependen\", \"cies, and page view. Finally, the powerful\\nanalytics enable you to write queries that ask important \", \"questions and generate charts and advanced\\ninsights.\\n\\n\\n[For more information, see Monitor Azure Func\", \"tions.](https://docs.microsoft.com/azure/azure-functions/functions-monitoring)\\n\\n### Azure Logic Apps\", \"\\n\\n\\n[Azure Logic Apps](https://docs.microsoft.com/azure/logic-apps) provides a serverless engine to b\", \"uild automated workflows to integrate apps and\\ndata between cloud services and on-premises systems. \", \"You build workflows using a visual designer.\\nYou can trigger workflows based on events or timers and\", \" leverage connectors to integration\\napplications and facilitate business-to-business (B2B) communica\", \"tion. Logic Apps integrates\\nseamlessly with Azure Functions.\\n\\n\\nLogic Apps can do more than just conn\", \"ect your cloud services (like functions) with cloud resources\\n(like queues and databases). You can a\", \"lso orchestrate on-premises workflows with the on-premises\\ngateway. For example, you can use the Log\", \"ic App to trigger an on-premises SQL stored procedure in\\n[response to a cloud-based event or conditi\", \"onal logic in your workflow. Learn more about Connecting](https://docs.microsoft.com/azure/analysis-\", \"services/analysis-services-gateway)\\n[to on-premises data sources with Azure On-premises Data Gateway\", \".](https://docs.microsoft.com/azure/analysis-services/analysis-services-gateway)\\n\\n\\n29 CHAPTER 3 | Az\", \"ure serverless platform\\n\\n\\nLike Azure Functions, you kick off Logic App workflows with a trigger. The\", \"re are many triggers for you\\nto choose from. The following capture shows just a few of the more popu\", \"lar ones out of hundreds\\nthat are available.\\n\\n\\nOnce the app is triggered, you can use the visual des\", \"igner to build out steps, loops, conditions, and\\nactions. Any data ingested in a previous step is av\", \"ailable for you to use in subsequent steps. The\\nfollowing workflow loads URLs from a CosmosDB databa\", \"se. It finds the ones with a host of `t.co` then\\nsearches for them on Twitter. If it finds correspon\", \"ding tweets, it updates the documents with the\\nrelated tweets by calling a function.\\n\\n\\n30 CHAPTER 3 \", \"| Azure serverless platform\\n\\n\\nThe Logic Apps dashboard shows the history of running your workflows a\", \"nd whether each run\\ncompleted successfully or not. You can navigate into any given run and inspect t\", \"he data used by each\\nstep for troubleshooting. Logic Apps also provides existing templates you can e\", \"dit and are well suited\\nfor complex enterprise workflows.\\n\\n\\n[To learn more, see Azure Logic Apps.](h\", \"ttps://docs.microsoft.com/azure/logic-apps)\\n\\n### Event Grid\\n\\n\\n[Azure Event Grid](https://docs.micros\", \"oft.com/azure/event-grid/overview) provides serverless infrastructure for event-based applications. \", \"You can publish to\\nEvent Grid from any source and consume messages from any platform. Event Grid als\", \"o has built-in\\nsupport for events from Azure resources to streamline integration with your applicati\", \"ons. For example,\\nyou can subscribe to blob storage events to notify your app when a file is uploade\", \"d. Your application\\ncan then publish a custom event grid message that is consumed by other cloud or \", \"on-premises\\napplications. Event Grid was built to reliably handle massive scale. You get the benefit\", \"s of publishing\\nand subscribing to messages without the overhead of setting up the necessary infrast\", \"ructure.\\n\\n\\n31 CHAPTER 3 | Azure serverless platform\\n\\n\\nThe major features of event grid include:\\n\\n\\n- \", \"Fully managed event routing.\\n\\n- Near real-time event delivery at scale.\\n\\n- Broad coverage both insid\", \"e and outside of Azure.\\n\\n#### **Scenarios**\\n\\n\\nEvent Grid addresses several different scenarios. This\", \" section covers three of the most common ones.\\n\\n\\n**Ops automation**\\n\\n\\nEvent Grid can help speed auto\", \"mation and simplify policy enforcement by notifying Azure\\n[Automation](https://docs.microsoft.com/az\", \"ure/automation) when infrastructure is provisioned.\\n\\n\\n32 CHAPTER 3 | Azure serverless platform\\n\\n\\n**A\", \"pplication integration**\\n\\n\\nYou can use Event Grid to connect your app to other services. Using stand\", \"ard HTTP protocols, even\\nlegacy apps can be easily modified to publish Event Grid messages. Web hook\", \"s are available for other\\nservices and platforms to consume Event Grid messages.\\n\\n\\n**Serverless apps\", \"**\\n\\n\\nEvent Grid can trigger Azure Functions, Logic Apps, or your own custom code. A major benefit of\", \"\\nusing Event Grid is that it uses a _push_ mechanism to send messages when events occur. The push\\nar\", \"chitecture consumes fewer resources and scales better than _polling_ mechanisms. Polling must check\\n\", \"for updates on a regular interval.\\n\\n#### **Event Grid vs. other Azure messaging services**\\n\\n\\n[Azure \", \"provides several messaging services, including Event Hubs](https://docs.microsoft.com/azure/event-hu\", \"bs) [and Service Bus. Each is designed to](https://docs.microsoft.com/azure/service-bus-messaging)\\na\", \"ddress a specific set of use cases. The following diagram provides a high-level overview of the\\ndiff\", \"erences between the services.\\n\\n\\n33 CHAPTER 3 | Azure serverless platform\\n\\n\\n[For a more in-depth comp\", \"arison, see Compare messaging services.](https://docs.microsoft.com/azure/event-grid/compare-messagi\", \"ng-services)\\n\\n#### **Performance targets**\\n\\n\\nUsing Event Grid you can take advantage of the followin\", \"g performance guarantees:\\n\\n\\n- Subsecond end-to-end latency in the 99th percentile.\\n\\n- 99.99% availab\", \"ility.\\n\\n- 10 million events per second per region.\\n\\n- 100 million subscriptions per region.\\n\\n- 50-ms\", \" publisher latency.\\n\\n- 24-hour retry with exponential back-off for guaranteed delivery in the 1-day \", \"window.\\n\\n- Transparent regional failover.\\n\\n#### **Event Grid schema**\\n\\n\\nEvent Grid uses a standard s\", \"chema to wrap custom events. The schema is like an envelope that wraps\\nyour custom data element. Her\", \"e is an example Event Grid message:\\n\\n\\nEverything about the message is standard except the `data` pro\", \"perty. You can inspect the message and\\nuse the `eventType` and `dataVersion` to de-serialize the cus\", \"tom portion of the payload.\\n\\n\\n34 CHAPTER 3 | Azure serverless platform\\n\\n\\n#### **Azure resources**\\n\\nA\", \" major benefit of using Event Grid is the automatic messages produced by Azure. In Azure, resources\\n\", \"automatically publish to a _topic_ that allows you to subscribe for various events. The following ta\", \"ble\\nlists the resource types, message types, and events that are available automatically.\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\", \"\\n\\n|Azure<br>resource|Event type|Description|\\n|---|---|---|\\n|Azure<br>subscription|Microsoft.Resource\", \"s.ResourceWriteSuccess|Raised when a resource create or<br>update operation succeeds.|\\n||Microsoft.R\", \"esources.ResourceWriteFailure|Raised when a resource create or<br>update operation fails.|\\n||Microso\", \"ft.Resources.ResourceWriteCancel|Raised when a resource create or<br>update operation is canceled.|\\n\", \"||Microsoft.Resources.ResourceDeleteSuccess|Raised when a resource delete<br>operation succeeds.|\\n||\", \"Microsoft.Resources.ResourceDeleteFailure|Raised when a resource delete<br>operation fails.|\\n||Micro\", \"soft.Resources.ResourceDeleteCancel|Raised when a resource delete<br>operation is canceled. This eve\", \"nt<br>happens when a template deployment<br>is canceled.|\\n|Blob storage|Microsoft.Storage.BlobCreate\", \"d|Raised when a blob is created.|\\n||Microsoft.Storage.BlobDeleted|Raised when a blob is deleted.|\\n|E\", \"vent hubs|Microsoft.EventHub.CaptureFileCreated|Raised when a capture file is created.|\\n|IoT Hub|Mic\", \"rosoft.Devices.DeviceCreated|Published when a device is registered<br>to an IoT hub.|\\n||Microsoft.De\", \"vices.DeviceDeleted|Published when a device is deleted<br>from an IoT hub.|\\n|Resource<br>groups|Micr\", \"osoft.Resources.ResourceWriteSuccess|Raised when a resource create or<br>update operation succeeds.|\", \"\\n||Microsoft.Resources.ResourceWriteFailure|Raised when a resource create or<br>update operation fai\", \"ls.|\\n||Microsoft.Resources.ResourceWriteCancel|Raised when a resource create or<br>update operation \", \"is canceled.|\\n||Microsoft.Resources.ResourceDeleteSuccess|Raised when a resource delete<br>operation\", \" succeeds.|\\n||Microsoft.Resources.ResourceDeleteFailure|Raised when a resource delete<br>operation f\", \"ails.|\\n\\n\\n\\n35 CHAPTER 3 | Azure serverless platform\\n\\n\\n|Azure<br>resource|Event type|Description|\\n|---\", \"|---|---|\\n||Microsoft.Resources.ResourceDeleteCancel|Raised when a resource delete<br>operation is c\", \"anceled. This event<br>happens when a template deployment<br>is canceled.|\\n\\n\\n[For more information, \", \"see Azure Event Grid event schema.](https://docs.microsoft.com/azure/event-grid/event-schema)\\n\\n\\nYou \", \"can access Event Grid from any type of application, even one that runs on-premises.\\n\\n#### **Conclusi\", \"on**\\n\\n\\nIn this chapter you learned about the Azure serverless platform that is composed of Azure Fun\", \"ctions,\\nLogic Apps, and Event Grid. You can use these resources to build an entirely serverless app\\n\", \"architecture, or create a hybrid solution that interacts with other cloud resources and on-premises\\n\", \"[servers. Combined with a serverless data platform such as Azure SQL](https://docs.microsoft.com/azu\", \"re/sql-database) [or CosmosDB, you can build fully](https://docs.microsoft.com/azure/cosmos-db/intro\", \"duction)\\nmanaged cloud native applications.\\n\\n#### **Recommended resources**\\n\\n\\n- [App service plans](\", \"https://docs.microsoft.com/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview)\\n\\n-\", \" [Application Insights](https://docs.microsoft.com/azure/application-insights)\\n\\n- [Application Insig\", \"hts Analytics](https://docs.microsoft.com/azure/application-insights/app-insights-analytics)\\n\\n- [Azu\", \"re: Bring your app to the cloud with serverless Azure Functions](https://docs.microsoft.com/events/C\", \"onnect/2017/E102)\\n\\n- [Azure Event Grid](https://docs.microsoft.com/azure/event-grid/overview)\\n\\n- [Az\", \"ure Event Grid event schema](https://docs.microsoft.com/azure/event-grid/event-schema)\\n\\n- [Azure Eve\", \"nt Hubs](https://docs.microsoft.com/azure/event-hubs)\\n\\n- [Azure Functions documentation](https://doc\", \"s.microsoft.com/azure/azure-functions)\\n\\n- [Azure Functions triggers and bindings concepts](https://d\", \"ocs.microsoft.com/azure/azure-functions/functions-triggers-bindings)\\n\\n- [Azure Logic Apps](https://d\", \"ocs.microsoft.com/azure/logic-apps)\\n\\n- [Azure Service Bus](https://docs.microsoft.com/azure/service-\", \"bus-messaging)\\n\\n- [Azure Table Storage](https://docs.microsoft.com/azure/cosmos-db/table-storage-ove\", \"rview)\\n\\n- [Connecting to on-premises data sources with Azure On-premises Data Gateway](https://docs.\", \"microsoft.com/azure/analysis-services/analysis-services-gateway)\\n\\n- [Create your first function in t\", \"he Azure portal](https://docs.microsoft.com/azure/azure-functions/functions-create-first-azure-funct\", \"ion)\\n\\n- [Create your first function using the Azure CLI](https://docs.microsoft.com/azure/azure-func\", \"tions/functions-create-first-azure-function-azure-cli)\\n\\n- [Create your first function using Visual S\", \"tudio](https://docs.microsoft.com/azure/azure-functions/functions-create-your-first-function-visual-\", \"studio)\\n\\n- [Functions supported languages](https://docs.microsoft.com/azure/azure-functions/supporte\", \"d-languages)\\n\\n- [Monitor Azure Functions](https://docs.microsoft.com/azure/azure-functions/functions\", \"-monitoring)\\n\\n\\n36 CHAPTER 3 | Azure serverless platform\\n\\n\\n**CHAPTER** **CHAPTER**\\n# 4 4\\n\\n## Durable \", \"Azure Functions\\n\\n\\nWhen creating serverless applications with Azure Functions, your operations will t\", \"ypically be designed\\nto run in a stateless manner. The reason for this design choice is because as t\", \"he platform scales, it\\nbecomes difficult to know what servers the code is running on. It also become\", \"s difficult to know how\\nmany instances are active at any given point. However, there are classes of \", \"applications that require\\nthe current state of a process to be known. Consider the process of submit\", \"ting an order to an online\\nstore. The checkout operation might be a workflow that is composed of mul\", \"tiple operations that need\\nto know the state of the process. Such information may include the produc\", \"t inventory, if the customer\\nhas any credits on their account, and also the results of processing th\", \"e credit card. These operations\\ncould easily be their own internal workflows or even services from t\", \"hird-party systems.\\n\\n\\nVarious patterns exist today that assist with the coordination of application \", \"state between internal and\\nexternal systems. It\\u2019s common to come across solutions that rely on centr\", \"alized queuing systems,\\ndistributed key-value stores, or shared databases to manage that state. Howe\", \"ver, these are all\\nadditional resources that now need to be provisioned and managed. In a serverless\", \" environment, your\\ncode could become cumbersome trying to coordinate with these resources manually. \", \"Azure Functions\\noffers an alternative for creating stateful functions called Durable Functions.\\n\\n\\nDu\", \"rable Functions is an extension to the Azure Functions runtime that enables the definition of\\nstatef\", \"ul workflows in code. By breaking down workflows into activities, the Durable Functions\\nextension ca\", \"n manage state, create progress checkpoints, and handle the distribution of function calls\\nacross se\", \"rvers. In the background, it makes use of an Azure Storage account to persist execution\\nhistory, sch\", \"edule activity functions and retrieve responses. Your serverless code should never interact\\nwith per\", \"sisted information in that storage account, and is typically not something with which\\ndevelopers nee\", \"d to interact.\\n\\n### Triggering a stateful workflow\\n\\n\\nStateful workflows in Durable Functions can be \", \"broken down into two intrinsic components;\\norchestration and activity triggers. Triggers and binding\", \"s are core components used by Azure\\nFunctions to enable your serverless functions to be notified whe\", \"n to start, receive input, and return\\nresults.\\n\\n#### **Working with the Orchestration client**\\n\\n\\nOrc\", \"hestrations are unique when compared to other styles of triggered operations in Azure Functions.\\nDur\", \"able Functions enables the execution of functions that may take hours or even days to complete.\\nThat\", \" type of behavior comes with the need to able to check the status of a running orchestration,\\npreemp\", \"tively terminate, or send notifications of external events.\\n\\n\\n37 CHAPTER 4 | Durable Azure Functions\", \"\\n\\n\\nFor such cases, the Durable Functions extension provides the `DurableOrchestrationClient` class t\", \"hat\\nallows you to interact with orchestrated functions. You get access to the orchestration client b\", \"y using\\nthe `OrchestrationClientAttribute` binding. Generally, you would include this attribute with\", \" another\\ntrigger type, such as an `HttpTrigger` or `ServiceBusTrigger` . Once the source function ha\", \"s been\\ntriggered, the orchestration client can be used to start an orchestrator function.\\n\\n#### **Th\", \"e orchestrator function**\\n\\n\\nAnnotating a function with the OrchestrationTriggerAttribute in Azure Fu\", \"nctions marks that function\\nas an orchestrator function. It\\u2019s responsible for managing the various a\", \"ctivities that make up your\\nstateful workflow.\\n\\n\\nOrchestrator functions are unable to make use of bi\", \"ndings other than the\\nOrchestrationTriggerAttribute. This attribute can only be used with a paramete\", \"r type of\\nDurableOrchestrationContext. No other inputs can be used since deserialization of inputs i\", \"n the\\nfunction signature isn\\u2019t supported. To get inputs provided by the orchestration client, the\\nGe\", \"tInput<T> method must be used.\\n\\n\\nAlso, the return types of orchestration functions must be either vo\", \"id, Task, or a JSON serializable\\nvalue.\\n\\n\\n_Error handling code has been left out for brevity_\\n\\n\\nMult\", \"iple instances of an orchestration can be started and running at the same time. Calling the\\n\\n`StartN\", \"ewAsync` method on the `DurableOrchestrationClient` launches a new instance of the\\norchestration. Th\", \"e method returns a `Task<string>` that completes when the orchestration has started.\\n\\n\\n38 CHAPTER 4 \", \"| Durable Azure Functions\\n\\n\\nAn exception of type `TimeoutException` gets thrown if the orchestration\", \" hasn\\u2019t started within 30\\nseconds.\\n\\n\\nThe completed `Task<string>` from `StartNewAsync` should contai\", \"n the unique ID of the orchestration\\ninstance. This instance ID can be used to invoke operations on \", \"that specific orchestration. The\\norchestration can be queried for the status or sent event notificat\", \"ions.\\n\\n#### **The activity functions**\\n\\n\\nActivity functions are the discrete operations that get com\", \"posed together within an orchestration\\nfunction to create the workflow. Here is where most of actual\", \" work would take place. They represent\\nthe business logic, long running processes, and the puzzle pi\", \"eces to a larger solution.\\n\\nThe `ActivityTriggerAttribute` is used to annotate a function parameter \", \"of type\\n\\n`DurableActivityContext` . Using the annotation informs the runtime that the function is in\", \"tended to\\nbe used as an activity function. Input values to activity functions are retrieved using th\", \"e `GetInput<T>`\\nmethod of the `DurableActivityContext` parameter.\\n\\n\\nSimilar to orchestration functio\", \"ns, the return types of activity functions must be either void, Task, or a\\nJSON serializable value.\\n\", \"\\n\\nAny unhandled exceptions that get thrown within activity functions will get sent up to the calling\", \"\\norchestrator function and presented as a `TaskFailedException` . At this point, the error can be ca\", \"ught\\nand logged in the orchestrator, and the activity can be retried.\\n\\n### Recommended resources\\n\\n\\n-\", \" [Durable Functions](https://docs.microsoft.com/azure/azure-functions/durable-functions-overview)\\n\\n-\", \" [Bindings for Durable Functions](https://docs.microsoft.com/azure/azure-functions/durable-functions\", \"-bindings)\\n\\n- [Manage instances in Durable Functions](https://docs.microsoft.com/azure/azure-functio\", \"ns/durable-functions-instance-management)\\n\\n### Orchestration patterns\\n\\n\\nDurable Functions makes it e\", \"asier to create stateful workflows that are composed of discrete, long\\nrunning activities in a serve\", \"rless environment. Since Durable Functions can track the progress of your\\nworkflows and periodically\", \" checkpoints the execution history, it lends itself to implementing some\\ninteresting patterns.\\n\\n\\n39 \", \"CHAPTER 4 | Durable Azure Functions\\n\\n\\n#### **Function chaining**\\n\\nIn a typical sequential process, a\", \"ctivities need to execute one after the other in a particular order.\\nOptionally, the upcoming activi\", \"ty may require some output from the previous function. This\\ndependency on the ordering of activities\", \" creates a function chain of execution.\\n\\n\\nThe benefit of using Durable Functions to implement this w\", \"orkflow pattern comes from its ability to\\ndo checkpointing. If the server crashes, the network times\", \" out or some other issue occurs, Durable\\nfunctions can resume from the last known state and continue\", \" running your workflow even if it\\u2019s on\\nanother server.\\n\\n\\nIn the preceding code sample, the `CallActi\", \"vityAsync` function is responsible for running a given\\nactivity on a virtual machine in the data cen\", \"ter. When the await returns and the underlying Task\\ncompletes, the execution will be recorded to the\", \" history table. The code in the orchestrator function\\ncan make use of any of the familiar constructs\", \" of the Task Parallel Library and the async/await\\nkeywords.\\n\\n\\nThe following code is a simplified exa\", \"mple of what the `ProcessPayment` method may look like:\\n\\n#### **Asynchronous HTTP APIs**\\n\\n\\nIn some c\", \"ases, workflows may contain activities that take a relatively long period of time to complete.\\nImagi\", \"ne a process that kicks off the backup of media files into blob storage. Depending on the size\\nand q\", \"uantity of the media files, this backup process may take hours to complete.\\n\\n\\n40 CHAPTER 4 | Durable\", \" Azure Functions\\n\\n\\nIn this scenario, the `DurableOrchestrationClient` \\u2019s ability to check the status\", \" of a running workflow\\nbecomes useful. When using an `HttpTrigger` to start a workflow, the `CreateC\", \"heckStatusResponse`\\nmethod can be used to return an instance of `HttpResponseMessage` . This respons\", \"e provides the client\\nwith a URI in the payload that can be used to check the status of the running \", \"process.\\n\\n\\nThe sample result below shows the structure of the response payload.\\n\\n\\nUsing your preferr\", \"ed HTTP client, GET requests can be made to the URI in statusQueryGetUri to\\ninspect the status of th\", \"e running workflow. The returned status response should resemble the\\nfollowing code.\\n\\n\\nAs the proces\", \"s continues, the status response will change to either **Failed** or **Completed** . On\\nsuccessful c\", \"ompletion, the **output** property in the payload will contain any returned data.\\n\\n#### **Monitoring\", \"**\\n\\n\\nFor simple recurring tasks, Azure Functions provides the `TimerTrigger` that can be scheduled b\", \"ased\\non a CRON expression. The timer works well for simple, short-lived tasks, but there might be sc\", \"enarios\\nwhere more flexible scheduling is needed. This scenario is when the monitoring pattern and D\", \"urable\\nFunctions can help.\\n\\n\\nDurable Functions allows for flexible scheduling intervals, lifetime ma\", \"nagement, and the creation of\\nmultiple monitor processes from a single orchestration function. One u\", \"se case for this functionality\\nmight be to create watchers for stock price changes that complete onc\", \"e a certain threshold is met.\\n\\n\\n41 CHAPTER 4 | Durable Azure Functions\\n\\n\\n`DurableOrchestrationContex\", \"t` \\u2019s `CreateTimer` method sets up the schedule for the next invocation\\nof the loop to check for sto\", \"ck price changes. `DurableOrchestrationContext` also has a\\n\\n`CurrentUtcDateTime` property to get the\", \" current DateTime value in UTC. It\\u2019s better to use this\\nproperty instead of `DateTime.UtcNow` becaus\", \"e it\\u2019s easily mocked for testing.\\n\\n#### **Recommended resources**\\n\\n\\n- [Azure Durable Functions](http\", \"s://docs.microsoft.com/azure/azure-functions/durable-functions-overview)\\n\\n- [Unit Testing in .NET Co\", \"re and .NET Standard](https://docs.microsoft.com/dotnet/core/testing/)\\n\\n\\n42 CHAPTER 4 | Durable Azur\", \"e Functions\\n\\n\\n**CHAPTER** **CHAPTER**\\n# 5 5\\n\\n## Serverless business scenarios and use cases\\n\\n\\nThere \", \"are many use cases and scenarios for serverless applications. This chapter includes samples that\\nill\", \"ustrate the different scenarios. The scenarios include links to related documentation and public\\nsou\", \"rce code repositories. The samples in this chapter enable you to get started on your own building\\nan\", \"d implementing serverless solutions.\\n\\n### Big data processing\\n\\n\\nThis example uses serverless to do a\", \" map/reduce operation on a big data set. It determines the\\naverage speed of New York Yellow taxi tri\", \"ps per day in 2017.\\n\\n\\n[Big Data Processing: Serverless MapReduce on Azure](https://docs.microsoft.co\", \"m/samples/azure-samples/durablefunctions-mapreduce-dotnet/big-data-processing-serverless-mapreduce-o\", \"n-azure/)\\n\\n### Create serverless applications: hands-on lab\\n\\n\\nLearn how to use functions to execute \", \"server-side logic and build serverless architectures.\\n\\n\\n- Choosing the best Azure service for your b\", \"usiness\\n\\n- Creating Azure Functions\\n\\n- Using triggers\\n\\n- Chaining functions\\n\\n- Long-running workflow\", \"s\\n\\n- Monitoring\\n\\n- Development, testing, and deployment\\n\\n[Create serverless applications](https://do\", \"cs.microsoft.com/training/paths/create-serverless-applications/)\\n\\n### Customer reviews\\n\\n\\nThis sample\", \" showcases the new Azure Functions tooling for C# Class Libraries in Visual Studio. Create\\na website\", \" where customers submit product reviews that are stored in Azure storage blobs and\\n\\n\\n43 CHAPTER 5 | \", \"Serverless business scenarios and use cases\\n\\n\\nCosmosDB. Add an Azure Function to perform automated m\", \"oderation of the customer reviews using\\nAzure Cognitive Services. Use an Azure storage queue to deco\", \"uple the website from the function.\\n\\n\\n[Customer Reviews App with Cognitive Services](https://docs.mi\", \"crosoft.com/samples/azure-samples/functions-customer-reviews/customer-reviews-cognitive-services/)\\n\\n\", \"### File processing and validation\\n\\n\\nThis example parses a set of CSV files from hypothetical custom\", \"ers. It ensures that all files required for\\na customer \\u201cbatch\\u201d are ready, then validates the structu\", \"re of each file. Different solutions are\\npresented using Azure Functions, Logic Apps, and Durable Fu\", \"nctions.\\n\\n\\n[File processing and validation using Azure Functions, Logic Apps, and Durable Functions]\", \"(https://docs.microsoft.com/samples/azure-samples/serverless-file-validation/file-processing-and-val\", \"idation-using-azure-functions-logic-apps-and-durable-functions/)\\n\\n### Game data visualization\\n\\n\\nAn e\", \"xample of how a developer could implement an in-editor data visualization solution for their\\ngame. I\", \"n fact, an Unreal Engine 4 Plugin and Unity Plugin were developed using this sample as its\\nbackend. \", \"The service component is game engine agnostic.\\n\\n\\n[In-editor game telemetry visualization](https://do\", \"cs.microsoft.com/samples/azure-samples/gaming-in-editor-telemetry/in-editor-telemetry-visualization/\", \")\\n\\n### GraphQL\\n\\n\\nCreate a serverless function that exposes a GraphQL API.\\n\\n\\n[Serverless functions fo\", \"r GraphQL](https://github.com/softchris/graphql-workshop-dotnet/blob/master/docs/workshop/4.md)\\n\\n###\", \" Internet of Things (IoT) reliable edge relay\\n\\n\\nThis sample implements a new communication protocol \", \"to enable reliable upstream communication\\nfrom IoT devices. It automates data gap detection and back\", \"fill.\\n\\n\\n[IoT Reliable Edge Relay](https://docs.microsoft.com/samples/azure-samples/iot-reliable-edge\", \"-relay/iot-reliable-edge-relay/)\\n\\n### Microservices reference architecture\\n\\n\\nA reference architectur\", \"e that walks you through the decision-making process involved in designing,\\ndeveloping, and deliveri\", \"ng the Rideshare by Relecloud application (a fictitious company). It includes\\nhands-on instructions \", \"for configuring and deploying all of the architecture\\u2019s components.\\n\\n\\n44 CHAPTER 5 | Serverless busi\", \"ness scenarios and use cases\\n\\n\\n[Serverless Microservices reference architecture](https://docs.micros\", \"oft.com/samples/azure-samples/serverless-microservices-reference-architecture/serverless-microservic\", \"es-reference-architecture/)\\n\\n### Serverless for mobile\\n\\n\\nAzure Functions are easy to implement and m\", \"aintain, and accessible through HTTP. They are a great\\nway to implement an API for a mobile applicat\", \"ion. Microsoft offers great cross-platform tools for iOS,\\nAndroid, and Windows with Xamarin. As such\", \", Xamarin and Azure Functions are working great\\ntogether. This article shows how to implement an Azu\", \"re Function in the Azure portal or in Visual\\nStudio at first, and build a cross-platform client with\", \" Xamarin.Forms running on Android, iOS, and\\nWindows.\\n\\n\\n[Implementing a simple Azure Function with a \", \"Xamarin.Forms client](https://docs.microsoft.com/samples/azure-samples/functions-xamarin-getting-sta\", \"rted/implementing-a-simple-azure-function-with-a-xamarinforms-client/)\\n\\n### Serverless messaging\\n\\n\\nT\", \"his sample shows how to utilize Durable Functions\\u2019 fan-out pattern to load an arbitrary number of\\nme\", \"ssages across any number of sessions/partitions. It targets Service Bus, Event Hubs, or Storage\\nQueu\", \"es. The sample also adds the ability to consume those messages with another Azure Function\\nand load \", \"the resulting timing data in to another Event Hub. The data is then ingested into analytics\\nservices\", \" like Azure Data Explorer.\\n\\n\\n[Produce and Consume messages through Service Bus, Event Hubs, and Stor\", \"age Queues with Azure](https://docs.microsoft.com/samples/azure-samples/durable-functions-producer-c\", \"onsumer/product-consume-messages-az-functions/)\\n[Functions](https://docs.microsoft.com/samples/azure\", \"-samples/durable-functions-producer-consumer/product-consume-messages-az-functions/)\\n\\n### Recommende\", \"d resources\\n\\n\\n- [Big Data Processing: Serverless MapReduce on Azure](https://docs.microsoft.com/samp\", \"les/azure-samples/durablefunctions-mapreduce-dotnet/big-data-processing-serverless-mapreduce-on-azur\", \"e/)\\n\\n- [Create serverless applications](https://docs.microsoft.com/training/paths/create-serverless-\", \"applications/)\\n\\n- [Customer Reviews App with Cognitive Services](https://docs.microsoft.com/samples/\", \"azure-samples/functions-customer-reviews/customer-reviews-cognitive-services/)\\n\\n- [File processing a\", \"nd validation using Azure Functions, Logic Apps, and Durable Functions](https://docs.microsoft.com/s\", \"amples/azure-samples/serverless-file-validation/file-processing-and-validation-using-azure-functions\", \"-logic-apps-and-durable-functions/)\\n\\n- [Implementing a simple Azure Function with a Xamarin.Forms cl\", \"ient](https://docs.microsoft.com/samples/azure-samples/functions-xamarin-getting-started/implementin\", \"g-a-simple-azure-function-with-a-xamarinforms-client/)\\n\\n- [In-editor game telemetry visualization](h\", \"ttps://docs.microsoft.com/samples/azure-samples/gaming-in-editor-telemetry/in-editor-telemetry-visua\", \"lization/)\\n\\n- [IoT Reliable Edge Relay](https://docs.microsoft.com/samples/azure-samples/iot-reliabl\", \"e-edge-relay/iot-reliable-edge-relay/)\\n\\n- [Produce and Consume messages through Service Bus, Event H\", \"ubs, and Storage Queues with](https://docs.microsoft.com/samples/azure-samples/durable-functions-pro\", \"ducer-consumer/product-consume-messages-az-functions/)\\n[Azure Functions](https://docs.microsoft.com/\", \"samples/azure-samples/durable-functions-producer-consumer/product-consume-messages-az-functions/)\\n\\n-\", \" [Serverless functions for GraphQL](https://github.com/softchris/graphql-workshop-dotnet/blob/master\", \"/docs/workshop/4.md)\\n\\n- [Serverless Microservices reference architecture](https://docs.microsoft.com\", \"/samples/azure-samples/serverless-microservices-reference-architecture/serverless-microservices-refe\", \"rence-architecture/)\\n\\n\\n45 CHAPTER 5 | Serverless business scenarios and use cases\\n\\n\\n**CHAPTER** **CH\", \"APTER**\\n# 6 6\\n\\n## Conclusion\\n\\n\\nThe following key takeaways are the most important conclusions from t\", \"his guide.\\n\\n\\n**Benefits of using serverless.** Serverless solutions provide the important benefit of\", \" cost savings\\nbecause serverless is implemented in a pay-per-use model. Serverless makes it possible\", \" to\\nindependently scale, test, and deploy individual components of your application. Serverless is u\", \"niquely\\nsuited to implement microservices architectures and integrates fully into a DevOps pipeline.\", \"\\n\\n\\n**Code as a unit of deployment.** Serverless abstracts the hardware, OS, and runtime away from th\", \"e\\napplication. Serverless enables focusing on business logic in code as the unit of deployment.\\n\\n\\n**\", \"Triggers and bindings.** Serverless eases integration with storage, APIs, and other cloud resources.\", \"\\nAzure Functions provides triggers to execute code and bindings to interact with resources.\\n\\n\\n**Micr\", \"oservices.** The microservices architecture is becoming the preferred approach for distributed and\\nl\", \"arge or complex mission-critical applications that are based on multiple independent subsystems in\\nt\", \"he form of autonomous services. In a microservice-based architecture, the application is built as a\\n\", \"collection of services that can be developed, tested, versioned, deployed, and scaled independently.\", \"\\nServerless is an architecture well-suited for building these services.\\n\\n\\n**Serverless platforms.** \", \"Serverless isn\\u2019t just about the code. Platforms that support serverless\\narchitectures include server\", \"less workflows and orchestration, serverless messaging and event services,\\nand serverless databases.\", \"\\n\\n\\n**Serverless challenges.** Serverless introduces challenges related to distributed application\\nde\", \"velopment, such as fragmented and independent data models, resiliency, versioning, and service\\ndisco\", \"very. Serverless may not be ideally suited to long running processes or components that benefit\\nfrom\", \" tighter coupling.\\n\\n\\n**Serverless as a tool, not the toolbox.** Serverless is not the exclusive solu\", \"tion to application\\narchitecture. It is a tool that can be leveraged as part of a hybrid application\", \" that may contain\\ntraditional tiers, monolith back ends, and containers. Serverless can be used to e\", \"nhance existing\\nsolutions and is not an all-or-nothing approach to application development.\\n\\n\\n46 CHA\", \"PTER 6 | Conclusion\\n\\n\\n\"]"