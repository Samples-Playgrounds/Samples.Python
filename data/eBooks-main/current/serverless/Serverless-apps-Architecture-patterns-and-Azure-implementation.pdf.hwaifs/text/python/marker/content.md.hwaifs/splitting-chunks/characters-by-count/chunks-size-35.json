"[\"![](_page_0_Picture_0.jpeg)\\n\\n# Serverless apps: Architecture, patterns, and Azure implementation\\n\\n![\", \"](_page_0_Picture_2.jpeg)\\n\\nJeremy Likness Cecil Phillip\\n\\n![](_page_1_Picture_0.jpeg)\\n\\n**EDITION v4.0\", \"** - Updated to Azure Functions v4\\n\\nDOWNLOAD available at:<https://aka.ms/serverlessbookpdf>\\n\\nPUBLIS\", \"HED BY\\n\\nMicrosoft Developer Division, .NET, and Visual Studio product teams\\n\\nA division of Microsoft\", \" Corporation\\n\\nOne Microsoft Way\\n\\nRedmond, Washington 98052-6399\\n\\nCopyright \\u00a9 2018-2023 by Microsoft \", \"Corporation\\n\\nAll rights reserved. No part of the contents of this book may be reproduced or transmit\", \"ted in any form or by any means without the written permission of the publisher.\\n\\nThis book is provi\", \"ded \\\"as-is\\\" and expresses the author's views and opinions. The views, opinions and information expre\", \"ssed in this book, including URL and other Internet website references, may change without notice.\\n\\n\", \"Some examples depicted herein are provided for illustration only and are fictitious. No real associa\", \"tion or connection is intended or should be inferred.\\n\\nMicrosoft and the trademarks listed at [https\", \"://www.microsoft.com](https://www.microsoft.com/) on the \\\"Trademarks\\\" webpage are trademarks of the \", \"Microsoft group of companies.\\n\\nMac and macOS are trademarks of Apple Inc.\\n\\nAll other marks and logos\", \" are property of their respective owners.\\n\\nAuthor:\\n\\n**[Jeremy Likness](https://twitter.com/jeremylik\", \"ness)**, Senior .NET Data Program Manager, Microsoft Corp.\\n\\nContributor:\\n\\n**[Cecil Phillip](https://\", \"twitter.com/cecilphillip)**, Senior Cloud Advocate, Microsoft Corp.\\n\\nEditors:\\n\\n**[Bill Wagner](https\", \"://twitter.com/billwagner)**, Senior Content Developer, Microsoft Corp.\\n\\n**[Maira Wenzel](https://tw\", \"itter.com/mairacw)**, Senior Content Developer, Microsoft Corp.\\n\\nParticipants and reviewers:\\n\\n**[Ste\", \"ve Smith](https://twitter.com/ardalis)**, Architect/Trainer, NimblePros.\\n\\n# Introduction\\n\\n[Serverles\", \"s](https://azure.microsoft.com/solutions/serverless/) is the evolution of cloud platforms in the dir\", \"ection of pure cloud native code. Serverless brings developers closer to business logic while insula\", \"ting them from infrastructure concerns. It's a pattern that doesn't imply \\\"no server\\\" but rather, \\\"l\", \"ess server.\\\" Serverless code is event-driven. Code\\n\\n![](_page_2_Picture_0.jpeg)\\n\\nmay be triggered by\", \" anything from a traditional HTTP web request to a timer or the result of uploading a file. The infr\", \"astructure behind serverless allows for instant scale to meet elastic demands and offers micro-billi\", \"ng to truly \\\"pay for what you use.\\\" Serverless requires a new way of thinking and approach to buildi\", \"ng applications and isn't the right solution for every problem. As a developer, you must decide:\\n\\n- \", \"What are the pros and cons of serverless?\\n- Why should you consider serverless for your own applicat\", \"ions?\\n- How can you build, test, deploy, and maintain your serverless code?\\n- Where does it make sen\", \"se to migrate code to serverless in existing applications, and what is the best way to accomplish th\", \"is transformation?\\n\\n# About this guide\\n\\nThis guide focuses on cloud native development of applicatio\", \"ns that use serverless. The book highlights the benefits and exposes the potential drawbacks of deve\", \"loping serverless apps and provides a survey of serverless architectures. Many examples of how serve\", \"rless can be used are illustrated along with various serverless design patterns.\\n\\nThis guide explain\", \"s the components of the Azure serverless platform and focuses specifically on implementation of serv\", \"erless using [Azure Functions](https://docs.microsoft.com/azure/azure-functions/functions-overview).\", \" You'll learn about triggers and bindings as well as how to implement serverless apps that rely on s\", \"tate using durable functions. Finally, business examples and case studies will help provide context \", \"and a frame of reference to determine whether serverless is the right approach for your projects.\\n\\n#\", \" Evolution of cloud platforms\\n\\nServerless is the culmination of several iterations of cloud platform\", \"s. The evolution began with physical metal in the data center and progressed through Infrastructure \", \"as a Service (IaaS) and Platform as a Service (PaaS).\\n\\n![](_page_2_Picture_11.jpeg)\\n\\nBefore the clou\", \"d, a discernible boundary existed between development and operations. Deploying an application meant\", \" answering myriad questions like:\\n\\n- What hardware should be installed?\\n- How is physical access to \", \"the machine secured?\\n\\n![](_page_3_Picture_0.jpeg)\\n\\n- Does the data center require an Uninterruptible\", \" Power Supply (UPS)?\\n- Where are storage backups sent?\\n- Should there be redundant power?\\n\\nThe list \", \"goes on and the overhead was enormous. In many situations, IT departments were forced to deal with i\", \"ncredible waste. The waste was due to over-allocation of servers as backup machines for disaster rec\", \"overy and standby servers to enable scale-out. Fortunately, the introduction of virtualization techn\", \"ology (like [Hyper-V\\\\)](https://docs.microsoft.com/virtualization/hyper-v-on-windows/about/) with Vi\", \"rtual Machines (VMs) gave rise to Infrastructure as a Service (IaaS). Virtualized infrastructure all\", \"owed operations to set up a standard set of servers as the backbone, leading to a flexible environme\", \"nt capable of provisioning unique servers \\\"on demand.\\\" More important, virtualization set the stage \", \"for using the cloud to provide virtual machines \\\"as a service.\\\" Companies could easily get out of th\", \"e business of worrying about redundant power or physical machines. Instead, they focused on the virt\", \"ual environment.\\n\\nIaaS still requires heavy overhead because operations is still responsible for var\", \"ious tasks. These tasks include:\\n\\n- Patching and backing up servers.\\n- Installing packages.\\n- Keepin\", \"g the operating system up-to-date.\\n- Monitoring the application.\\n\\nThe next evolution reduced the ove\", \"rhead by providing Platform as a Service (PaaS). With PaaS, the cloud provider handles operating sys\", \"tems, security patches, and even the required packages to support a specific platform. Instead of bu\", \"ilding a VM then configuring .NET and standing up Internet Information Services (IIS) servers, devel\", \"opers simply choose a \\\"platform target\\\" such as \\\"web application\\\" or \\\"API endpoint\\\" and deploy code \", \"directly. The infrastructure questions are reduced to:\\n\\n- What size services are needed?\\n- How do th\", \"e services scale out (add more servers or nodes)?\\n- How do the services scale up (increase the capac\", \"ity of hosting servers or nodes)?\\n\\nServerless further abstracts servers by focusing on event-driven \", \"code. Instead of a platform, developers can focus on a microservice that does one thing. The two key\", \" questions for building the serverless code are:\\n\\n- What triggers the code?\\n- What does the code do?\", \"\\n\\nWith serverless, infrastructure is abstracted. In some cases, the developer no longer worries abou\", \"t the host at all. Whether or not an instance of IIS, Kestrel, Apache, or some other web server is r\", \"unning to manage web requests, the developer focuses on an HTTP trigger. The trigger provides the st\", \"andard, cross-platform payload for the request. The payload not only simplifies the development proc\", \"ess, but facilitates testing and in some cases, makes the code easily portable across platforms.\\n\\nAn\", \"other feature of serverless is micro-billing. It's common for web applications to host Web API endpo\", \"ints. In traditional bare metal, IaaS and even PaaS implementations, the resources to host the APIs \", \"are paid for continuously. That means you pay to host the endpoints even when they aren't being acce\", \"ssed. Often you'll find one API is called more than others, so the entire system is scaled\\n\\n![](_pag\", \"e_4_Picture_0.jpeg)\\n\\nbased on supporting the popular endpoints. Serverless enables you to scale each\", \" endpoint independently and pay for usage, so no costs are incurred when the APIs aren't being calle\", \"d. Migration may in many circumstances dramatically reduce the ongoing cost to support the endpoints\", \".\\n\\n# What this guide doesn't cover\\n\\nThis guide specifically emphasizes architecture approaches and d\", \"esign patterns and isn't a deep dive into the implementation details of Azure Functions, [Logic Apps\", \",](https://docs.microsoft.com/azure/logic-apps/logic-apps-what-are-logic-apps) or other serverless p\", \"latforms. This guide doesn't cover, for example, advanced workflows with Logic Apps or features of A\", \"zure Functions such as configuring Cross-Origin Resource Sharing (CORS), applying custom domains, or\", \" uploading SSL certificates. These details are available through the online [Azure Functions documen\", \"tation.](https://docs.microsoft.com/azure/azure-functions/functions-reference)\\n\\n### **Additional res\", \"ources**\\n\\n- [Azure Architecture center](https://docs.microsoft.com/azure/architecture/)\\n- [Best prac\", \"tices for cloud applications](https://docs.microsoft.com/azure/architecture/best-practices/api-desig\", \"n)\\n\\n# Who should use the guide\\n\\nThis guide was written for developers and solution architects who wa\", \"nt to build enterprise applications with .NET that may use serverless components either on premises \", \"or in the cloud. It's useful to developers, architects, and technical decision makers interested in:\", \"\\n\\n- Understanding the pros and cons of serverless development\\n- Learning how to approach serverless \", \"architecture\\n- Example implementations of serverless apps\\n\\n# How to use the guide\\n\\nThe first part of\", \" this guide examines why serverless is a viable option by comparing several different architecture a\", \"pproaches. It examines both the technology and development lifecycle, because all aspects of softwar\", \"e development are impacted by architecture decisions. The guide then examines use cases and design p\", \"atterns and includes reference implementations using Azure Functions. Each section contains addition\", \"al resources to learn more about a particular area. The guide concludes with resources for walkthrou\", \"ghs and hands-on exploration of serverless implementation.\\n\\n# Send your feedback\\n\\nThe guide and rela\", \"ted samples are constantly evolving, so your feedback is welcomed! If you have comments about how th\", \"is guide can be improved, use the feedback section at the bottom of any page built on [GitHub issues\", \".](https://github.com/dotnet/docs/issues)\\n\\n# Contents\\n\\n| Architecture approaches                    \", \"        |    |\\n|----------------------------------------------------|----|\\n| Architecture patterns  \", \"                            | 1  |\\n| Monoliths                                          | 1  |\\n| N-L\", \"ayer applications                               | 2  |\\n| Microservices                              \", \"        | 3  |\\n| Architecture deployment approaches                 | 4  |\\n| N-Tier applications    \", \"                            | 5  |\\n| On-premises and Infrastructure as a Service (IaaS) | 6  |\\n| Pla\", \"tform as a Service (PaaS)                       | 7  |\\n| Software as a Service (SaaS)               \", \"        | 7  |\\n| Containers and Functions as a Service (FaaS)       | 8  |\\n| Serverless             \", \"                            | 9  |\\n| Summary                                            | 10 |\\n| Rec\", \"ommended resources                              | 11 |\\n| Serverless architecture                    \", \"        | 12 |\\n| Full serverless back end                           | 13 |\\n| Monoliths and \\\"starving\", \" the beast\\\"                 | 13 |\\n| Web apps                                           |    |\\n| Mob\", \"ile back ends                                   | 14 |\\n| Internet of Things (IoT)                   \", \"        | 15 |\\n| Serverless architecture considerations             | 16 |\\n| Managing state         \", \"                            | 16 |\\n| Long-running processes                             | 16 |\\n| Sta\", \"rtup time                                       | 17 |\\n| Database updates and migrations            \", \"        | 17 |\\n| Scaling                                            | 17 |\\n| Monitoring, tracing, an\", \"d logging                   | 18 |\\n| Inter-service dependencies                         | 18 |\\n|    \", \"                                                |    |\\n\\n| Managing failure and providing resiliency \", \"          |    |\\n|-----------------------------------------------------|----|\\n| Versioning and green\", \"/blue deployments               | 19 |\\n| Serverless design examples                          | 19 |\\n\", \"| Scheduling                                          | 19 |\\n| Command and Query Responsibility Segr\", \"egation (CQRS) | 19 |\\n| Event-based processing                              | 20 |\\n| File triggers a\", \"nd transformations                   | 20 |\\n| Asynchronous background processing and messaging    | \", \"21 |\\n| Web apps and APIs                                   | 21 |\\n| Data pipeline                   \", \"                    | 22 |\\n| Stream processing                                   | 22 |\\n| API gatewa\", \"y                                         | 23 |\\n| Recommended resources                            \", \"   | 23 |\\n| Azure serverless platform                           | 24 |\\n| Azure Functions            \", \"                         | 24 |\\n| Programming language support                        | 25 |\\n| App s\", \"ervice plans                                   | 25 |\\n| Create your first function                  \", \"        | 25 |\\n| Understand triggers and bindings                    | 26 |\\n| Telemetry with Applica\", \"tion Insights                 | 27 |\\n| Azure Logic Apps                                    | 29 |\\n| \", \"Event Grid                                          | 31 |\\n| Scenarios                              \", \"             | 32 |\\n| Event Grid vs. other Azure messaging services       | 33 |\\n| Performance targe\", \"ts                                 | 34 |\\n| Event Grid schema                                   | 34\", \" |\\n| Azure resources                                     | 35 |\\n| Conclusion                        \", \"                  | 36 |\\n| Recommended resources                               | 36 |\\n| Durable Azur\", \"e Functions                             | 37 |\\n| Triggering a stateful workflow                     \", \" | 37 |\\n| Working with the Orchestration client               | 37 |\\n\\n| The orchestrator function   \", \"                 | 38 |\\n|----------------------------------------------|----|\\n| The activity functio\", \"ns                       | 39 |\\n| Recommended resources                        | 39 |\\n| Orchestratio\", \"n patterns                       | 39 |\\n| Function chaining                            | 40 |\\n| Asyn\", \"chronous HTTP APIs                       | 40 |\\n| Monitoring                                   | 41 \", \"|\\n| Recommended resources                        | 42 |\\n| Serverless business scenarios and use case\", \"s  | 43 |\\n| Big data processing                          | 43 |\\n| Create serverless applications: ha\", \"nds-on lab | 43 |\\n| Customer reviews                             | 43 |\\n| File processing and valida\", \"tion               | 44 |\\n| Game data visualization                      | 44 |\\n| GraphQL           \", \"                           | 44 |\\n| Internet of Things (IoT) reliable edge relay | 44 |\\n| Microservi\", \"ces reference architecture         | 44 |\\n| Serverless for mobile                        | 45 |\\n| Se\", \"rverless messaging                         | 45 |\\n| Recommended resources                        | 4\", \"5 |\\n| Conclusion                                   | 46 |\\n|                                         \", \"     |    |\\n\\n**CHAPTER** 1\\n\\n# <span id=\\\"page-8-0\\\"></span>Architecture approaches\\n\\nUnderstanding exis\", \"ting approaches to architecting enterprise apps helps clarify the role played by serverless. There a\", \"re many approaches and patterns that evolved over decades of software development, and all have thei\", \"r own pros and cons. In many cases, the ultimate solution may not involve deciding on a single appro\", \"ach but may integrate several approaches. Migration scenarios often involve shifting from one archit\", \"ecture approach to another through a hybrid approach.\\n\\nThis chapter provides an overview of both log\", \"ical and physical architecture patterns for enterprise applications.\\n\\n# <span id=\\\"page-8-1\\\"></span>A\", \"rchitecture patterns\\n\\nModern business applications follow a variety of architecture patterns. This s\", \"ection represents a survey of common patterns. The patterns listed here aren't necessarily all best \", \"practices, but illustrate different approaches.\\n\\n<span id=\\\"page-8-2\\\"></span>For more information, se\", \"e [Azure application architecture guide.](https://docs.microsoft.com/azure/architecture/guide/)\\n\\n# M\", \"onoliths\\n\\nMany business applications follow a monolith pattern. Legacy applications are often implem\", \"ented as monoliths. In the monolith pattern, all application concerns are contained in a single depl\", \"oyment. Everything from user interface to database calls is included in the same codebase.\\n\\n![](_pag\", \"e_9_Picture_0.jpeg)\\n\\nThere are several advantages to the monolith approach. It's often easy to pull \", \"down a single code base and start working. Ramp up time may be less, and creating test environments \", \"is as simple as providing a new copy. The monolith may be designed to include multiple components an\", \"d applications.\\n\\nUnfortunately, the monolith pattern tends to break down at scale. Major disadvantag\", \"es of the monolith approach include:\\n\\n- Difficult to work in parallel in the same code base.\\n- Any c\", \"hange, no matter how trivial, requires deploying a new version of the entire application.\\n- Refactor\", \"ing potentially impacts the entire application.\\n- Often the only solution to scale is to create mult\", \"iple, resource-intensive copies of the monolith.\\n- As systems expand or other systems are acquired, \", \"integration can be difficult.\\n- It may be difficult to test due to the need to configure the entire \", \"monolith.\\n- Code reuse is challenging and often other apps end up having their own copies of code.\\n\\n\", \"Many businesses look to the cloud as an opportunity to migrate monolith applications and at the same\", \" time refactor them to more usable patterns. It's common to break out the individual applications an\", \"d components to allow them to be maintained, deployed, and scaled separately.\\n\\n# <span id=\\\"page-9-0\\\"\", \"></span>N-Layer applications\\n\\nN-layer application partition application logic into specific layers. \", \"The most common layers include:\\n\\n- User interface\\n- Business logic\\n- Data access\\n\\nOther layers may i\", \"nclude middleware, batch processing, and API. It's important to note the layers are logical. Althoug\", \"h they're developed in isolation, they may all be deployed to the same target platform.\\n\\n![](_page_1\", \"0_Figure_1.jpeg)\\n\\nThere are several advantages to the N-Layer approach, including:\\n\\n- Refactoring is\", \" isolated to a layer.\\n- Teams can independently build, test, deploy, and maintain separate layers.\\n-\", \" Layers can be swapped out, for example the data layer may access multiple databases without requiri\", \"ng changes to the UI layer.\\n\\nServerless may be used to implement one or more layers.\\n\\n# <span id=\\\"pa\", \"ge-10-0\\\"></span>Microservices\\n\\n**[Microservices](https://docs.microsoft.com/azure/architecture/guide\", \"/architecture-styles/microservices)** architectures contain common characteristics that include:\\n\\n- \", \"Applications are composed of several small services.\\n- Each service runs in its own process.\\n- Servi\", \"ces are aligned around business domains.\\n- Services communicate over lightweight APIs, typically usi\", \"ng HTTP as the transport.\\n- Services can be deployed and upgraded independently.\\n- Services aren't d\", \"ependent on a single data store.\\n- The system is designed with failure in mind, and the app may stil\", \"l run even when certain services fail.\\n\\nMicroservices don't have to be mutually exclusive to other a\", \"rchitecture approaches. For example, an N-Tier architecture may use microservices for the middle tie\", \"r. It's also possible to implement\\n\\nmicroservices in a variety of ways, from virtual directories on \", \"IIS hosts to containers. The characteristics of microservices make them especially ideal for serverl\", \"ess implementations.\\n\\n![](_page_11_Picture_1.jpeg)\\n\\nThe pros of microservices architectures include:\", \"\\n\\n- Refactoring is often isolated to a single service.\\n- Services can be upgraded independently of e\", \"ach other.\\n- Resiliency and elasticity can be tuned to the demands of individual services.\\n- Develop\", \"ment can happen in parallel across disparate teams and platforms.\\n- It's easier to write comprehensi\", \"ve tests for isolated services.\\n\\nMicroservices come with their own challenges, including:\\n\\n- Determi\", \"ning what services are available and how to call them.\\n- Managing the lifecycle of services.\\n- Under\", \"standing how services fit together in the overall application.\\n- Full system testing of calls made a\", \"cross disparate services.\\n\\nUltimately there are solutions to address all of these challenges, includ\", \"ing tapping into the benefits of serverless that are discussed later.\\n\\n# <span id=\\\"page-11-0\\\"></span\", \">Architecture deployment approaches\\n\\nRegardless of the architecture approach used to design a busine\", \"ss application, the implementation, or deployment of those applications may vary. Businesses host ap\", \"plications on everything from physical hardware to serverless functions.\\n\\n### <span id=\\\"page-12-0\\\"><\", \"/span>**N-Tier applications**\\n\\nThe [N-Tier architecture pattern](https://docs.microsoft.com/azure/ar\", \"chitecture/guide/architecture-styles/n-tier) is a mature architecture and simply refers to applicati\", \"ons that separate various logical layers into separate physical tiers. N-Tier architecture is a phys\", \"ical implementation of N-Layer architecture. The most common implementation of this architecture inc\", \"ludes:\\n\\n- A presentation tier, for example a web app.\\n- An API or data access tier, such as a REST A\", \"PI.\\n- A data tier, such as a SQL database.\\n\\n![](_page_12_Picture_5.jpeg)\\n\\nN-tier solutions have the \", \"following characteristics:\\n\\n- Projects are typically aligned with tiers.\\n- Testing may be approached\", \" differently by tier.\\n- Tiers provide layers of abstraction, for example the presentation tier is ty\", \"pically ignorant of the implementation details of the data tier.\\n- Typically, layers only interact w\", \"ith adjacent layers.\\n- Releases are often managed at the project, and therefore tier, level. A simpl\", \"e API change may require a new release of an entire middle tier.\\n\\nThis approach provides several ben\", \"efits, including:\\n\\n- Isolation of the database (often the front end doesn't have direct access to th\", \"e database back end).\\n- Reuse of the API (for example, mobile, desktop, and web app clients can all \", \"reuse the same APIs).\\n\\n- Ability to scale out tiers independent of each other.\\n- Refactoring isolati\", \"on: one tier may be refactored without impacting other tiers.\\n\\n### <span id=\\\"page-13-0\\\"></span>**On-\", \"premises and Infrastructure as a Service (IaaS)**\\n\\nThe traditional approach to hosting applications \", \"requires buying hardware and managing all of the software installations, including the operating sys\", \"tem. Originally this involved expensive data centers and physical hardware. The challenges that come\", \" with operating physical hardware are many, including:\\n\\n- The need to buy excess for \\\"just in case\\\" \", \"or peak demand scenarios.\\n- Securing physical access to the hardware.\\n- Responsibility for hardware \", \"failure (such as disk failure).\\n- Cooling.\\n- Configuring routers and load balancers.\\n- Power redunda\", \"ncy.\\n- Securing software access.\\n\\n![](_page_13_Picture_11.jpeg)\\n\\nVirtualization of hardware, via \\\"vi\", \"rtual machines\\\" enables Infrastructure as a Service (IaaS). Host machines are effectively partitione\", \"d to provide resources to instances with allocations for their own memory, CPU, and storage. The tea\", \"m provisions the necessary VMs and configures the associated networks and access to storage.\\n\\nFor mo\", \"re information, see [virtual machine N-tier reference architecture.](https://docs.microsoft.com/azur\", \"e/architecture/reference-architectures/virtual-machines-windows/n-tier)\\n\\nAlthough virtualization and\", \" Infrastructure as a Service (IaaS) address many concerns, it still leaves much responsibility in th\", \"e hands of the infrastructure team. The team maintains operating system versions, applies security p\", \"atches, and installs third-party dependencies on the target machines. Apps often behave differently \", \"on production machines compared to the test environment. Issues arise due to different dependency ve\", \"rsions and/or OS SKU levels. Although many organizations deploy N-Tier applications to these targets\", \", many companies benefit from deploying to a more cloud native model\\n\\nsuch as [Platform as a Service\", \".](#page-14-0) Architectures with microservices are more challenging because of the requirements to \", \"scale out for elasticity and resiliency.\\n\\nFor more information, see [virtual machines.](https://docs\", \".microsoft.com/azure/virtual-machines/)\\n\\n### <span id=\\\"page-14-0\\\"></span>**Platform as a Service (Pa\", \"aS)**\\n\\nPlatform as a Service (PaaS) offers configured solutions that developers can plug into direct\", \"ly. PaaS is another term for managed hosting. It eliminates the need to manage the base operating sy\", \"stem, security patches and in many cases any third-party dependencies. Examples of platforms include\", \" web applications, databases, and mobile back ends.\\n\\nPaaS addresses the challenges common to IaaS. P\", \"aaS allows the developer to focus on the code or database schema rather than how it gets deployed. B\", \"enefits of PaaS include:\\n\\n- Pay for use models that eliminate the overhead of investing in idle mach\", \"ines.\\n- Direct deployment and improved DevOps, continuous integration (CI), and continuous delivery \", \"(CD) pipelines.\\n- Automatic upgrades, updates, and security patches.\\n- Push-button scale out and sca\", \"le up (elastic scale).\\n\\nThe main disadvantage of PaaS traditionally has been vendor lock-in. For exa\", \"mple, some PaaS providers only support ASP.NET, Node.js, or other specific languages and platforms. \", \"Products like Azure App Service have evolved to address multiple platforms and support a variety of \", \"languages and frameworks for hosting web apps.\\n\\n![](_page_14_Picture_10.jpeg)\\n\\n### <span id=\\\"page-14\", \"-1\\\"></span>**Software as a Service (SaaS)**\\n\\nSoftware as a Service or SaaS is centrally hosted and a\", \"vailable without local installation or provisioning. SaaS often is hosted on top of PaaS as a platfo\", \"rm for deploying software. SaaS provides services to run and connect with existing software. SaaS is\", \" often industry and vertical specific. SaaS is often licensed and typically provides a client/server\", \" model. Most modern SaaS offerings use webbased apps for the client. Companies typically consider Sa\", \"aS as a business solution to license offerings. It isn't often implemented as architecture considera\", \"tion for scalability and maintainability of an application. Indeed, most SaaS solutions are built on\", \" IaaS, PaaS, and/or serverless back ends.\\n\\nLearn more about SaaS through a [sample application.](htt\", \"ps://docs.microsoft.com/azure/sql-database/saas-tenancy-welcome-wingtip-tickets-app)\\n\\n### <span id=\\\"\", \"page-15-0\\\"></span>**Containers and Functions as a Service (FaaS)**\\n\\nContainers are an interesting so\", \"lution that enables PaaS-like benefits without the IaaS overhead. A container is essentially a runti\", \"me that contains the bare essentials needed to run a unique application. The kernel or core part of \", \"the host operating system and services such as storage are shared across a host. The shared kernel e\", \"nables containers to be lightweight (some are mere megabytes in size, compared to the gigabyte size \", \"of typical virtual machines). With hosts already running, containers can be started quickly, facilit\", \"ating high availability. The ability to spin up containers quickly also provides extra layers of res\", \"iliency. Docker is one of the more popular implementations of containers.\\n\\n#### Benefits of containe\", \"rs include:\\n\\n- Lightweight and portable\\n- Self-contained so no need to install dependencies\\n- Provid\", \"e a consistent environment regardless of the host (runs exactly same on a laptop as on a cloud serve\", \"r)\\n- Can be provisioned quickly for scale-out\\n- Can be restarted quickly to recover from failure\\n\\nA \", \"container runs on a container host (that in turn may run on a bare metal machine or a virtual machin\", \"e). Multiple containers or instances of the same containers may run on a single host. For true failo\", \"ver and resiliency, containers must be scaled across hosts.\\n\\nFor more information about Docker conta\", \"iners, see [What is Docker.](https://docs.microsoft.com/dotnet/architecture/microservices/container-\", \"docker-introduction/docker-defined)\\n\\nManaging containers across hosts typically requires an orchestr\", \"ation tool such as Kubernetes. Configuring and managing orchestration solutions may add additional o\", \"verhead and complexity to projects. Fortunately, many cloud providers provide orchestration services\", \" through PaaS solutions to simplify the management of containers.\\n\\nThe following image illustrates a\", \"n example Kubernetes installation. Nodes in the installation address scale out and failover. They ru\", \"n Docker container instances that are managed by the primary server. The *kubelet* is the client tha\", \"t relays commands from Kubernetes to Docker.\\n\\n![](_page_16_Figure_0.jpeg)\\n\\nFor more information abou\", \"t orchestration, see [Kubernetes on Azure.](https://docs.microsoft.com/azure/aks/intro-kubernetes)\\n\\n\", \"Functions as a Service (FaaS) is a specialized container service that is similar to serverless. A sp\", \"ecific implementation of FaaS, called [OpenFaaS,](https://github.com/openfaas/faas) sits on top of c\", \"ontainers to provide serverless capabilities. OpenFaaS provides templates that package all of the co\", \"ntainer dependencies necessary to run a piece of code. Using templates simplifies the process of dep\", \"loying code as a functional unit. OpenFaaS targets architectures that already include containers and\", \" orchestrators because it can use the existing infrastructure. Although it provides serverless funct\", \"ionality, it specifically requires you to use Docker and an orchestrator.\\n\\n### <span id=\\\"page-16-0\\\">\", \"</span>**Serverless**\\n\\nA serverless architecture provides a clear separation between the code and it\", \"s hosting environment. You implement code in a *function* that is invoked by a *trigger*. After that\", \" function exits, all its needed resources may be freed. The trigger might be manual, a timed process\", \", an HTTP request, or a file upload. The result of the trigger is the execution of code. Although se\", \"rverless platforms vary, most provide access to pre-defined APIs and bindings to streamline tasks su\", \"ch as writing to a database or queueing results.\\n\\nServerless is an architecture that relies heavily \", \"on abstracting away the host environment to focus on code. It can be thought of as *less server*.\\n\\nC\", \"ontainer solutions provide developers existing build scripts to publish code to serverless-ready ima\", \"ges. Other implementations use existing PaaS solutions to provide a scalable architecture.\\n\\nThe abst\", \"raction means the DevOps team doesn't have to provision or manage servers, nor specific containers. \", \"The serverless platform hosts code, either as script or packaged executables built with a related SD\", \"K, and allocates the necessary resources for the code to scale.\\n\\nThe following diagram illustrates f\", \"our serverless components. An HTTP request causes the Checkout API code to run. The Checkout API ins\", \"erts code into a database, and the insert triggers several other functions to run to perform tasks l\", \"ike computing tasks and fulfilling the order.\\n\\n![](_page_17_Picture_0.jpeg)\\n\\nThe advantages of serve\", \"rless include:\\n\\n- **High density.** Many instances of the same serverless code can run on the same h\", \"ost compared to containers or virtual machines. The instances scale across multiple hosts addressing\", \" scale out and resiliency.\\n- **Micro-billing.** Most serverless providers bill based on serverless e\", \"xecutions, enabling massive cost savings in certain scenarios.\\n- **Instant scale.** Serverless can s\", \"cale to match workloads automatically and quickly.\\n- **Faster time to market.** Developers focus on \", \"code and deploy directly to the serverless platform. Components can be released independently of eac\", \"h other.\\n\\nServerless is most often discussed in the context of compute, but can also apply to data. \", \"For example, [Azure SQL](https://docs.microsoft.com/azure/sql-database) and [Cosmos DB](https://docs\", \".microsoft.com/azure/cosmos-db) both provide cloud databases that don't require you to configure hos\", \"t machines or clusters. This book focuses on serverless compute.\\n\\n### <span id=\\\"page-17-0\\\"></span>**\", \"Summary**\\n\\nThere's a broad spectrum of available choices for architecture, including a hybrid approa\", \"ch. Serverless simplifies the approach, management, and cost of application features at the expense \", \"of control and portability. However, many serverless platforms do expose configuration to help fine-\", \"tune the solution. Good programming practices can also lead to more portable code and less serverles\", \"s platform lock-in. The following table illustrates the architecture approaches side by side. Choose\", \" serverless based on your scale needs, whether or not you want to manage the runtime, and how well y\", \"ou can break your workloads into small components. You'll learn about potential challenges with serv\", \"erless and other decision points in the next chapter.\\n\\n|           | IaaS     | PaaS     | Container\", \" | Serverless |\\n|-----------|----------|----------|-----------|------------|\\n| Scale     | VM       \", \"| Instance | App       | Function   |\\n| Abstracts | Hardware | Platform | OS Host   | Runtime    |\\n|\", \" Unit      | VM       | Project  | Image     | Code       |\\n\\n|                | IaaS                \", \"                                            | PaaS                             | Container          \", \"                           | Serverless                 |\\n|----------------|------------------------\", \"-----------------------------------------|----------------------------------|-----------------------\", \"------------------------|----------------------------|\\n| Lifetime       | Months                    \", \"                                      | Days to Months                   | Minutes to Days          \", \"                     | Milliseconds<br>to Minutes |\\n| Responsibility | Applications,<br>dependencies\", \", runtime,<br>and operating system | Applications and<br>dependencies | Applications,<br>dependencie\", \"s, and<br>runtime | Function                   |\\n\\n- **Scale** refers to the unit that is used to sca\", \"le the application\\n- **Abstracts** refers to the layer that is abstracted by the implementation\\n- **\", \"Unit** refers to the scope of what is deployed\\n- **Lifetime** refers to the typical runtime of a spe\", \"cific instance\\n- **Responsibility** refers to the overhead to build, deploy, and maintain the applic\", \"ation\\n\\nThe next chapter will focus on serverless architecture, use cases, and design patterns.\\n\\n### \", \"<span id=\\\"page-18-0\\\"></span>**Recommended resources**\\n\\n- [Azure application architecture guide](http\", \"s://docs.microsoft.com/azure/architecture/guide/)\\n- [Azure Cosmos DB](https://docs.microsoft.com/azu\", \"re/cosmos-db)\\n- [Azure SQL](https://docs.microsoft.com/azure/sql-database)\\n- [N-Tier architecture pa\", \"ttern](https://docs.microsoft.com/azure/architecture/guide/architecture-styles/n-tier)\\n- [Kubernetes\", \" on Azure](https://docs.microsoft.com/azure/aks/intro-kubernetes)\\n- [Microservices](https://docs.mic\", \"rosoft.com/azure/architecture/guide/architecture-styles/microservices)\\n- [Virtual machine N-tier ref\", \"erence architecture](https://docs.microsoft.com/azure/architecture/reference-architectures/virtual-m\", \"achines-windows/n-tier)\\n- [Virtual machines](https://docs.microsoft.com/azure/virtual-machines/)\\n- [\", \"What is Docker?](https://docs.microsoft.com/dotnet/architecture/microservices/container-docker-intro\", \"duction/docker-defined)\\n- [Wingtip Tickets SaaS application](https://docs.microsoft.com/azure/sql-da\", \"tabase/saas-tenancy-welcome-wingtip-tickets-app)\\n\\n# <span id=\\\"page-19-0\\\"></span>Serverless architect\", \"ure\\n\\nThere are many approaches to using [serverless](https://azure.com/serverless) architectures. Th\", \"is chapter explores examples of common architectures that integrate serverless. It also covers conce\", \"rns that may pose additional challenges or require extra consideration when implementing serverless.\", \" Finally, several design examples are provided that illustrate various serverless use cases.\\n\\nServer\", \"less hosts often use an existing container-based or PaaS layer to manage the serverless instances. F\", \"or example, Azure Functions is based on [Azure App Service.](https://docs.microsoft.com/azure/app-se\", \"rvice/) The App Service is used to scale out instances and manage the runtime that executes Azure Fu\", \"nctions code. For Windows-based functions, the host runs as PaaS and scales out the .NET runtime. Fo\", \"r Linux-based functions, the host leverages containers.\\n\\nThe WebJobs Core provides an execution cont\", \"ext for the function. The Language Runtime runs scripts, executes libraries and hosts the framework \", \"for the target language. For example, Node.js is used to run JavaScript functions and the .NET Frame\", \"work is used to run C# functions. You'll learn more about language and platform options later in thi\", \"s chapter.\\n\\nSome projects may benefit from taking an \\\"all-in\\\" approach to serverless. Applications t\", \"hat rely heavily on microservices may implement all microservices using serverless technology. The m\", \"ajority of apps are hybrid, following an N-tier design and using serverless for the components that \", \"make sense\\n\\nbecause the components are modular and independently scalable. To help make sense of the\", \"se scenarios, this section walks through some common architecture examples that use serverless.\\n\\n# <\", \"span id=\\\"page-20-0\\\"></span>Full serverless back end\\n\\nThe full serverless back end is ideal for sever\", \"al types of scenarios, especially when building new or \\\"green field\\\" applications. An application wi\", \"th a large surface area of APIs may benefit from implementing each API as a serverless function. App\", \"s that are based on microservices architecture are another example that could be implemented as a fu\", \"ll serverless back end. The microservices communicate over various protocols with each other. Specif\", \"ic scenarios include:\\n\\n- API-based SaaS products (example: financial payments processor).\\n- Message-\", \"driven applications (example: device monitoring solution).\\n- Apps focused on integration between ser\", \"vices (example: airline booking application).\\n- Processes that run periodically (example: timer-base\", \"d database clean-up).\\n- Apps focused on data transformation (example: import triggered by file uploa\", \"d).\\n- Extract Transform and Load (ETL) processes.\\n\\nThere are other, more specific use cases that are\", \" covered later in this document.\\n\\n# <span id=\\\"page-20-1\\\"></span>Monoliths and \\\"starving the beast\\\"\\n\\n\", \"A common challenge is migrating an existing monolithic application to the cloud. The least risky app\", \"roach is to \\\"lift and shift\\\" entirely onto virtual machines. Many shops prefer to use the migration \", \"as an opportunity to modernize their code base. A practical approach to migration is called \\\"starvin\", \"g the beast.\\\" In this scenario, the monolith is migrated \\\"as is\\\" to start with. Then, selected servi\", \"ces are modernized. In some cases, the signature of the service is identical to the original: it sim\", \"ply is hosted as a function. Clients are updated to use the new service rather than the monolith end\", \"point. In the interim, steps such as database replication enable microservices to host their own sto\", \"rage even when transactions are still handled by the monolith. Eventually, all clients are migrated \", \"onto the new services. The monolith is \\\"starved\\\" (its services no longer called) until all functiona\", \"lity has been replaced. The combination of serverless and proxies can facilitate much of this migrat\", \"ion.\\n\\n![](_page_21_Picture_0.jpeg)\\n\\nTo learn more about this approach, watch the video: [Bring your \", \"app to the cloud with serverless Azure](https://docs.microsoft.com/Events/Connect/2017/E102)  [Funct\", \"ions.](https://docs.microsoft.com/Events/Connect/2017/E102)\\n\\n# <span id=\\\"page-21-0\\\"></span>Web apps\\n\", \"\\nWeb apps are great candidates for serverless applications. There are two common approaches to web a\", \"pps today: server-driven, and client-driven (such as Single Page Application or SPA). Server-driven \", \"web apps typically use a middleware layer to issue API calls to render the web UI. SPA applications \", \"make REST API calls directly from the browser. In both scenarios, serverless can accommodate the mid\", \"dleware or REST API request by providing the necessary business logic. A common architecture is to s\", \"tand up a lightweight static web server. The Single Page Application (SPA) serves HTML, CSS, JavaScr\", \"ipt, and other browser assets. The web app then connects to a microservices back end.\\n\\n# <span id=\\\"p\", \"age-21-1\\\"></span>Mobile back ends\\n\\nThe event-driven paradigm of serverless apps makes them ideal as \", \"mobile back ends. The mobile device triggers the events and the serverless code executes to satisfy \", \"requests. Taking advantage of a serverless model enables developers to enhance business logic withou\", \"t having to deploy a full application update. The serverless approach also enables teams to share en\", \"dpoints and work in parallel.\\n\\nMobile developers can build business logic without becoming experts o\", \"n the server side. Traditionally, mobile apps connected to on-premises services. Building the servic\", \"e layer required understanding the server platform and programming paradigm. Developers worked with \", \"operations to provision servers\\n\\nand configure them appropriately. Sometimes days or even weeks were\", \" spent on building a deployment pipeline. All of these challenges are addressed by serverless.\\n\\nServ\", \"erless abstracts the server-side dependencies and enables the developer to focus on business logic. \", \"For example, a mobile developer who builds apps using a JavaScript framework can build serverless fu\", \"nctions with JavaScript as well. The serverless host manages the operating system, a Node.js instanc\", \"e to host the code, package dependencies, and more. The developer is provided a simple set of inputs\", \" and a standard template for outputs. They then can focus on building and testing the business logic\", \". They're therefore able to use existing skills to build the back-end logic for the mobile app witho\", \"ut having to learn new platforms or become a \\\"server-side developer.\\\"\\n\\n![](_page_22_Picture_2.jpeg)\\n\", \"\\nMost cloud providers offer mobile-based serverless products that simplify the entire mobile develop\", \"ment lifecycle. The products may automate the provisioning of databases to persist data, handle DevO\", \"ps concerns, provide cloud-based builds and testing frameworks and the ability to script business pr\", \"ocesses using the developer's preferred language. Following a mobile-centric serverless approach can\", \" streamline the process. Serverless removes the tremendous overhead of provisioning, configuring, an\", \"d maintaining servers for the mobile back end.\\n\\n# <span id=\\\"page-22-0\\\"></span>Internet of Things (Io\", \"T)\\n\\nIoT refers to physical objects that are networked together. They're sometimes referred to as \\\"co\", \"nnected devices\\\" or \\\"smart devices.\\\" Everything from cars and vending machines may be connected and \", \"send information ranging from inventory to sensor data such as temperature and humidity. In the ente\", \"rprise, IoT provides business process improvements through monitoring and automation. IoT data may b\", \"e used to regulate the climate in a large warehouse or track inventory through the supply chain. IoT\", \" can sense chemical spills and call the fire department when smoke is detected.\\n\\nThe sheer volume of\", \" devices and information often dictates an event-driven architecture to route and process messages. \", \"Serverless is an ideal solution for several reasons:\\n\\n- Enables scale as the volume of devices and d\", \"ata increases.\\n- Accommodates adding new endpoints to support new devices and sensors.\\n- Facilitates\", \" independent versioning so developers can update the business logic for a specific device without ha\", \"ving to deploy the entire system.\\n- Resiliency and less downtime.\\n\\nThe pervasiveness of IoT has resu\", \"lted in several serverless products that focus specifically on IoT concerns, such as [Azure IoT Hub.\", \"](https://docs.microsoft.com/azure/iot-hub) Serverless automates tasks such as device registration, \", \"policy enforcement, tracking, and even deployment of code to devices at *the edge*. The edge refers \", \"to devices like sensors and actuators that are connected to, but not an active part of, the Internet\", \".\\n\\n# <span id=\\\"page-23-0\\\"></span>Serverless architecture considerations\\n\\nAdopting a serverless archi\", \"tecture does come with certain challenges. This section explores some of the more common considerati\", \"ons to be aware of. All of these challenges have solutions. As with all architecture choices, the de\", \"cision to go serverless should be made only after carefully considering the pros and cons. Depending\", \" on the needs of your application, you may decide a serverless implementation isn't the right soluti\", \"on for certain components.\\n\\n### <span id=\\\"page-23-1\\\"></span>**Managing state**\\n\\nServerless functions\", \", as with microservices in general, are stateless by default. Avoiding state enables serverless to b\", \"e ephemeral, to scale out, and to provide resiliency without a central point of failure. In some cir\", \"cumstances, business processes require state. If your process requires state, you have two options. \", \"You can adopt a model other than serverless, or interact with a separate service that provides state\", \". Adding state can complicate the solution and make it harder to scale, and potentially create a sin\", \"gle point of failure. Carefully consider whether your function absolutely requires state. If the ans\", \"wer is \\\"yes,\\\" determine whether it still makes sense to implement it with serverless.\\n\\nThere are sev\", \"eral solutions to adopt state without compromising the benefits of serverless. Some of the more popu\", \"lar solutions include:\\n\\n- Use a temporary data store or distributed cache, like Redis\\n- Store state \", \"in a database, like SQL or CosmosDB\\n- Handle state through a workflow engine like [durable functions\", \"](https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-overview)\\n\\nThe bottom l\", \"ine is that you should be aware of the need for any state management within processes you're conside\", \"ring to implement with serverless.\\n\\n### <span id=\\\"page-23-2\\\"></span>**Long-running processes**\\n\\nMany\", \" benefits of serverless rely on the processes being ephemeral. Short run times make it easier for th\", \"e serverless provider to free up resources as functions end and share functions across hosts. Most c\", \"loud providers limit the total time your function can run to around 10 minutes. If your process may \", \"take longer, you might consider an alternative implementation.\\n\\nThere are a few exceptions and solut\", \"ions. One solution may be to break your process into smaller components that individually take less \", \"time to run. If your process runs long because of dependencies, you can also consider an asynchronou\", \"s workflow using a solution like durable functions. Durable functions pause and maintain the state o\", \"f your process while it's waiting on an external process to finish. Asynchronous handling reduces th\", \"e time the actual process runs.\\n\\n### <span id=\\\"page-24-0\\\"></span>**Startup time**\\n\\nOne potential con\", \"cern with serverless implementations is startup time. To conserve resources, many serverless provide\", \"rs create infrastructure \\\"on demand.\\\" When a serverless function is triggered after a period of time\", \", the resources to host the function may need to be created or restarted. In some situations, cold s\", \"tarts may result in delays of several seconds. Startup time varies across providers and service leve\", \"ls. There are a few approaches to address startup time if it's important to minimize for the success\", \" of the app.\\n\\n- Some providers allow users to pay for service levels that guarantee infrastructure i\", \"s \\\"always on\\\".\\n- Implement a keep-alive mechanism (ping the endpoint to keep it \\\"awake\\\").\\n- Use orch\", \"estration like Kubernetes with a containerized function approach (the host is already running so spi\", \"nning up new instances is extremely fast).\\n\\n### <span id=\\\"page-24-1\\\"></span>**Database updates and m\", \"igrations**\\n\\nAn advantage of serverless code is that you can release new functions without having to\", \" redeploy the entire application. This advantage can become a disadvantage when there's a relational\", \" database involved. Changes to database schemas are difficult to synchronize with serverless updates\", \". Additional challenges are posed when things go wrong and the changes must be rolled back. Data int\", \"egrity is one reason that a best practice for microservices and serverless functions is that they ow\", \"n their own data. It is possible to deploy changes as a single unit of compute and data. The reality\", \" is that many legacy systems feature a large back-end database that must be reconciled with the serv\", \"erless architecture.\\n\\nA popular approach to solve schema versioning is to never modify existing prop\", \"erties and columns, but instead add new information. For example, consider a change to move from a B\", \"oolean \\\"completed\\\" flag for a todo list to a \\\"completed date.\\\" Instead of removing the old field, th\", \"e database change will:\\n\\n- 1. Add a new \\\"completed date\\\" field.\\n- 2. Transform the \\\"completed\\\" Boole\", \"an field to a computed function that evaluates whether the completed date is after the current date.\", \"\\n- 3. Add a trigger to set the completed date to the current date when the completed Boolean is set \", \"to true.\\n\\nThe sequence of changes ensures that legacy code continues to run \\\"as is\\\" while newer serv\", \"erless functions can take advantage of the new field.\\n\\nFor more information about data in serverless\", \" architectures, see [Challenges and solutions for](https://docs.microsoft.com/dotnet/architecture/mi\", \"croservices/architect-microservice-container-applications/distributed-data-management)  [distributed\", \" data management.](https://docs.microsoft.com/dotnet/architecture/microservices/architect-microservi\", \"ce-container-applications/distributed-data-management)\\n\\n### <span id=\\\"page-24-2\\\"></span>**Scaling**\\n\", \"\\nIt's a common misconception that serverless means \\\"no server.\\\" It's in fact \\\"less server.\\\" The fact\", \" there is a backing infrastructure is important to understand when it comes to scaling. Most serverl\", \"ess platforms provide a set of controls to handle how the infrastructure should scale when event den\", \"sity increases. You can choose from a variety of options, but your strategy may vary depending on th\", \"e\\n\\nfunction. Furthermore, functions are typically run under a related host, so that functions on the\", \" same host have the same scale options. Therefore it is necessary to organize and strategize which f\", \"unctions are hosted together based on scale requirements.\\n\\nRules often specify how to scale-up (incr\", \"ease the host resources) and scale-out (increase the number of host instances) based on varying para\", \"meters. Triggers for scales may include schedule, request rates, CPU utilization, and memory usage. \", \"Higher performance often comes at a greater cost. The less expensive, consumption-based approaches m\", \"ay not scale as quickly when the request rate suddenly increases. There is a trade-off between payin\", \"g up front \\\"insurance cost\\\" versus paying strictly \\\"as you go\\\" and risking slower responses due to s\", \"udden increases in demand.\\n\\n### <span id=\\\"page-25-0\\\"></span>**Monitoring, tracing, and logging**\\n\\nAn\", \" often overlooked aspect of DevOps is monitoring applications once deployed. It's important to have \", \"a strategy for monitoring serverless functions. The biggest challenge is often correlation, or recog\", \"nizing when a user calls multiple functions as part of the same interaction. Most serverless platfor\", \"ms allow console logging that can be imported into third-party tools. There are also options to auto\", \"mate collection of telemetry, generate and track correlation IDs, and monitor specific actions to pr\", \"ovide detailed insights. Azure provides the advanced [Application Insights platform](https://docs.mi\", \"crosoft.com/azure/azure-functions/functions-monitoring) for monitoring and analytics.\\n\\n### <span id=\", \"\\\"page-25-1\\\"></span>**Inter-service dependencies**\\n\\nA serverless architecture may include functions t\", \"hat rely on other functions. In fact, it isn't uncommon in a serverless architecture to have multipl\", \"e services call each other as part of an interaction or distributed transaction. To avoid strong cou\", \"pling, it's recommended that services don't reference each other directly. When the endpoint for a s\", \"ervice needs to change, direct references could result in major refactoring. A suggested solution is\", \" to provide a service discovery mechanism, such as a registry, that provides the appropriate end poi\", \"nt for a request type. Another solution is to leverage messaging services like queues or topics for \", \"communication between services.\\n\\n### <span id=\\\"page-25-2\\\"></span>**Managing failure and providing re\", \"siliency**\\n\\nIt's also important to consider the *circuit-breaker pattern*: If, for some reason, a se\", \"rvice continues to fail, it isn't advisable to call that service repeatedly. Instead, an alternative\", \" service is called or a message returned until the health of the dependent service is re-established\", \". The serverless architecture needs to take into account the strategy for resolving and managing int\", \"er-service dependencies.\\n\\nTo continue the circuit-breaker pattern, services need to be fault toleran\", \"t and resilient. Fault tolerance refers to the ability of your application to continue running even \", \"after unexpected exceptions or invalid states are encountered. Fault tolerance is typically a functi\", \"on of the code itself and how it's written to handle exceptions. Resiliency refers to how capable th\", \"e app is at recovering from failures. Resiliency is often managed by the serverless platform. The pl\", \"atform should be able to spin up a new serverless function instance when the existing one fails. The\", \" platform should also be intelligent enough to stop spinning up new instances when every new instanc\", \"e fails.\\n\\nFor more information, see [Implementing the Circuit Breaker pattern.](https://docs.microso\", \"ft.com/dotnet/architecture/microservices/implement-resilient-applications/implement-circuit-breaker-\", \"pattern)\\n\\n### <span id=\\\"page-26-0\\\"></span>**Versioning and green/blue deployments**\\n\\nA major benefit\", \" of serverless is the ability to upgrade a specific function without having to redeploy the entire a\", \"pplication. For upgrades to be successful, functions must be versioned so that services calling them\", \" are routed to the correct version of code. A strategy for deploying new versions is also important.\", \" A common approach is to use \\\"green/blue deployments.\\\" The green deployment is the current function.\", \" A new \\\"blue\\\" version is deployed to production and tested. When testing passes, the green and blue \", \"versions are swapped so the new version comes live. If any issues are encountered, they can be swapp\", \"ed back. Supporting versioning and green/blue deployments requires a combination of authoring the fu\", \"nctions to accommodate version changes and working with the serverless platform to handle deployment\", \"s.\\n\\n# <span id=\\\"page-26-1\\\"></span>Serverless design examples\\n\\nThere are many design patterns that ex\", \"ist for serverless. This section captures some common scenarios that use serverless. What all of the\", \" examples have in common is the fundamental combination of an event trigger and business logic.\\n\\n###\", \" <span id=\\\"page-26-2\\\"></span>**Scheduling**\\n\\nScheduling tasks is a common function. The following di\", \"agram shows a legacy database that doesn't have appropriate integrity checks. The database must be s\", \"crubbed periodically. The serverless function finds invalid data and cleans it. The trigger is a tim\", \"er that runs the code on a schedule.\\n\\n![](_page_26_Picture_7.jpeg)\\n\\n### <span id=\\\"page-26-3\\\"></span>\", \"**Command and Query Responsibility Segregation (CQRS)**\\n\\nCommand and Query Responsibility Segregatio\", \"n (CQRS) is a pattern that provides different interfaces for reading (or querying) data and operatio\", \"ns that modify data. It addresses several common problems. In traditional Create Read Update Delete \", \"(CRUD) based systems, conflicts can arise from high volume of both reads and writes to the same data\", \" store. Locking may frequently occur and dramatically slow down reads. Often, data is presented as a\", \" composite of several domain objects and read operations must combine data from different entities.\\n\", \"\\nUsing CQRS, a read might involve a special \\\"flattened\\\" entity that models data the way it's consume\", \"d. The read is handled differently than how it's stored. For example, although the database may stor\", \"e a contact as a header record with a child address record, the read could involve an entity with bo\", \"th\\n\\nheader and address properties. There are myriad approaches to creating the read model. It might \", \"be materialized from views. Update operations could be encapsulated as isolated events that then tri\", \"gger updates to two different models. Separate models exist for reading and writing.\\n\\n![](_page_27_P\", \"icture_1.jpeg)\\n\\nServerless can accommodate the CQRS pattern by providing the segregated endpoints. O\", \"ne serverless function accommodates queries or reads, and a different serverless function or set of \", \"functions handles update operations. A serverless function may also be responsible for keeping the r\", \"ead model up-to-date, and can be triggered by the database's [change feed.](https://docs.microsoft.c\", \"om/azure/cosmos-db/change-feed) Front-end development is simplified to connecting to the necessary e\", \"ndpoints. Processing of events is handled on the back end. This model also scales well for large pro\", \"jects because different teams may work on different operations.\\n\\n### <span id=\\\"page-27-0\\\"></span>**E\", \"vent-based processing**\\n\\nIn message-based systems, events are often collected in queues or publisher\", \"/subscriber topics to be acted upon. These events can trigger serverless functions to execute a piec\", \"e of business logic. An example of event-based processing is event-sourced systems. An \\\"event\\\" is ra\", \"ised to mark a task as complete. A serverless function triggered by the event updates the appropriat\", \"e database document. A second serverless function may use the event to update the read model for the\", \" system. [Azure Event](https://docs.microsoft.com/azure/event-grid/overview)  [Grid](https://docs.mi\", \"crosoft.com/azure/event-grid/overview) provides a way to integrate events with functions as subscrib\", \"ers.\\n\\nEvents are informational messages. For more information, see [Event Sourcing pattern.](https:/\", \"/docs.microsoft.com/azure/architecture/patterns/event-sourcing)\\n\\n### <span id=\\\"page-27-1\\\"></span>**F\", \"ile triggers and transformations**\\n\\nExtract, Transform, and Load (ETL) is a common business function\", \". Serverless is a great solution for ETL because it allows code to be triggered as part of a pipelin\", \"e. Individual code components can address various aspects. One serverless function may download the \", \"file, another applies the transformation, and another loads the data. The code can be tested and dep\", \"loyed independently, making it easier to maintain and scale where needed.\\n\\n![](_page_28_Picture_0.jp\", \"eg)\\n\\nIn the diagram, \\\"cool storage\\\" provides data that is parsed in [Azure Stream Analytics.](https:\", \"//docs.microsoft.com/azure/stream-analytics) Any issues encountered in the data stream trigger an Az\", \"ure Function to address the anomaly.\\n\\n### <span id=\\\"page-28-0\\\"></span>**Asynchronous background proc\", \"essing and messaging**\\n\\nAsynchronous messaging and background processing allow applications to kick \", \"off processes without having to wait. An example of asynchronous processing is an OCR app. An image \", \"is submitted and queued for processing. Scanning the image to extract text may take time, and once i\", \"t's finished a notification is sent. Serverless can handle both the invocation and the result in thi\", \"s scenario.\\n\\n### <span id=\\\"page-28-1\\\"></span>**Web apps and APIs**\\n\\nA popular scenario for serverles\", \"s is N-tier applications, most commonly ones where the UI layer is a web app. The popularity of Sing\", \"le Page Applications (SPA) has surged recently. SPA apps render a single page, then rely on API call\", \"s and the returned data to dynamically render new UI without reloading a full page. Client-side rend\", \"ering provides a much faster, more responsive application to the end user.\\n\\nServerless endpoints tri\", \"ggered by HTTP calls can be used to handle the API requests. For example, an ad services company may\", \" call a serverless function with user profile information to request custom advertising. The serverl\", \"ess function returns the custom ad and the web page renders it.\\n\\n![](_page_29_Figure_0.jpeg)\\n\\n### <s\", \"pan id=\\\"page-29-0\\\"></span>**Data pipeline**\\n\\nServerless functions can be used to facilitate a data p\", \"ipeline. In this example, a file triggers a function to translate data in a CSV file to data rows in\", \" a table. The organized table allows a Power BI dashboard to present analytics to the end user.\\n\\n![]\", \"(_page_29_Figure_3.jpeg)\\n\\n### <span id=\\\"page-29-1\\\"></span>**Stream processing**\\n\\nDevices and sensors\", \" often generate streams of data that must be processed in real time. There are a number of technolog\", \"ies that can capture messages and streams from [Event Hubs](https://docs.microsoft.com/azure/event-h\", \"ubs/event-hubs-what-is-event-hubs) and [IoT Hub](https://docs.microsoft.com/azure/iot-hub) to [Servi\", \"ce Bus.](https://docs.microsoft.com/azure/service-bus) Regardless of transport, serverless is an ide\", \"al mechanism for processing the messages and streams of data as they come in. Serverless can scale q\", \"uickly to meet the demand of large volumes of data. The serverless code can apply business logic to \", \"parse the data and output in a structured format for action and analytics.\\n\\n![](_page_30_Figure_0.jp\", \"eg)\\n\\n### <span id=\\\"page-30-0\\\"></span>**API gateway**\\n\\nAn API gateway provides a single point of entr\", \"y for clients and then intelligently routes requests to back-end services. It's useful to manage lar\", \"ge sets of services. It can also handle versioning and simplify development by easily connecting cli\", \"ents to disparate environments. Serverless can handle back-end scaling of individual microservices w\", \"hile presenting a single front end via an API gateway.\\n\\n![](_page_30_Figure_3.jpeg)\\n\\n### <span id=\\\"p\", \"age-30-1\\\"></span>**Recommended resources**\\n\\n- [Azure Event Grid](https://docs.microsoft.com/azure/ev\", \"ent-grid/overview)\\n- [Azure IoT Hub](https://docs.microsoft.com/azure/iot-hub)\\n- [Challenges and sol\", \"utions for distributed data management](https://docs.microsoft.com/dotnet/architecture/microservices\", \"/architect-microservice-container-applications/distributed-data-management)\\n- [Designing microservic\", \"es: identifying microservice boundaries](https://docs.microsoft.com/azure/architecture/microservices\", \"/microservice-boundaries)\\n- [Event Hubs](https://docs.microsoft.com/azure/event-hubs/event-hubs-what\", \"-is-event-hubs)\\n- [Event Sourcing pattern](https://docs.microsoft.com/azure/architecture/patterns/ev\", \"ent-sourcing)\\n- [Implementing the Circuit Breaker pattern](https://docs.microsoft.com/dotnet/archite\", \"cture/microservices/implement-resilient-applications/implement-circuit-breaker-pattern)\\n- [IoT Hub](\", \"https://docs.microsoft.com/azure/iot-hub)\\n- [Service Bus](https://docs.microsoft.com/azure/service-b\", \"us)\\n- [Working with the change feed support in Azure Cosmos DB](https://docs.microsoft.com/azure/cos\", \"mos-db/change-feed)\\n\\n# <span id=\\\"page-31-0\\\"></span>Azure serverless platform\\n\\nThe Azure serverless p\", \"latform includes Azure Functions, Logic Apps, and Event Grid. These services work together and conne\", \"ct with myriad other resources. The serverless platform works with everything from databases and sto\", \"rage to analytics and machine learning/artificial intelligence.\\n\\nYou can also use Application Insigh\", \"ts, a serverless platform for capturing diagnostic traces and telemetry. Application Insights are av\", \"ailable to applications of all types (desktop, mobile, or web) as well as serverless implementations\", \". The platform is visualized in the following diagram:\\n\\n![](_page_31_Picture_4.jpeg)\\n\\n<span id=\\\"page\", \"-31-1\\\"></span>This chapter breaks down the fundamentals of each component.\\n\\n# Azure Functions\\n\\nAzure\", \" Functions provide a serverless compute experience. A function is invoked by a *trigger* (such as ac\", \"cess to an HTTP endpoint or a timer) and executes a block of code or business logic. Functions also \", \"support specialized *bindings* that connect to resources like storage and queues.\\n\\n![](_page_32_Pict\", \"ure_0.jpeg)\\n\\nThe current runtime version 4.0 supports cross-platform .NET 7.0 applications. Addition\", \"al languages besides C# such as JavaScript, F#, and Java are supported. Functions created in the por\", \"tal provide a rich scripting syntax. Functions created as standalone projects can be deployed with f\", \"ull platform support and capabilities.\\n\\nFor more information, see [Azure Functions documentation.](h\", \"ttps://docs.microsoft.com/azure/azure-functions)\\n\\n### <span id=\\\"page-32-0\\\"></span>**Programming lang\", \"uage support**\\n\\nThe following languages are all supported in general availability (GA).\\n\\n| Language \", \"  | Supported runtimes for 4.x        |\\n|------------|-----------------------------------|\\n| C#     \", \"    | .NET 6.0, 7.0, .NET Framework 4.8 |\\n| JavaScript | Node 14, 16, 18                   |\\n| F#   \", \"      | .NET 6.0, 7.0                     |\\n| Java       | Java 8, 11, 17                    |\\n| Pyt\", \"hon     | Python 3.7, 3.8, 3.9, 3.10        |\\n| TypeScript | Node 14, 16, 18 (via JavaScript)  |\\n| P\", \"owerShell | PowerShell Core 7.2               |\\n\\nFor more information on other runtime versions, see\", \" [Supported languages.](https://docs.microsoft.com/azure/azure-functions/supported-languages)\\n\\n### <\", \"span id=\\\"page-32-1\\\"></span>**App service plans**\\n\\nFunctions are backed by an *app service plan*. The\", \" plan defines the resources used by the functions app. You can assign plans to a region, determine t\", \"he size and number of virtual machines that will be used, and pick a pricing tier. For a true server\", \"less approach, function apps may use the **consumption** plan. The consumption plan will scale the b\", \"ack end automatically based on load.\\n\\nAnother hosting option for function apps is the [Premium plan]\", \"(https://docs.microsoft.com/azure/azure-functions/functions-premium-plan). This plan provides an \\\"al\", \"ways on\\\" instance to avoid cold start, supports advanced features like VNet connectivity, and runs o\", \"n premium hardware.\\n\\nFor more information, see [App service plans.](https://docs.microsoft.com/azure\", \"/app-service/azure-web-sites-web-hosting-plans-in-depth-overview)\\n\\n### <span id=\\\"page-32-2\\\"></span>*\", \"*Create your first function**\\n\\nThere are three common ways you can create function apps.\\n\\n- Script f\", \"unctions in the portal.\\n- Create the necessary resources using the Azure CLI.\\n- Build functions loca\", \"lly using your favorite IDE and publish them to Azure.\\n\\nFor more information on creating a scripted \", \"function in the portal, see [Create your first function in the](https://docs.microsoft.com/azure/azu\", \"re-functions/functions-create-first-azure-function)  [Azure portal.](https://docs.microsoft.com/azur\", \"e/azure-functions/functions-create-first-azure-function)\\n\\nTo build from the Azure CLI, see [Create y\", \"our first function using the Azure CLI.](https://docs.microsoft.com/azure/azure-functions/functions-\", \"create-first-azure-function-azure-cli)\\n\\nTo create a function from Visual Studio, see [Create your fi\", \"rst function using Visual Studio.](https://docs.microsoft.com/azure/azure-functions/functions-create\", \"-your-first-function-visual-studio)\\n\\n### <span id=\\\"page-33-0\\\"></span>**Understand triggers and bindi\", \"ngs**\\n\\nFunctions are invoked by a *trigger* and can have exactly one. In addition to invoking the fu\", \"nction, certain triggers also serve as bindings. You may also define multiple bindings in addition t\", \"o the trigger. *Bindings* provide a declarative way to connect data to your code. They can be passed\", \" in (input) or receive data (output). Triggers and bindings make functions easy to work with. Bindin\", \"gs remove the overhead of manually creating database or file system connections. All of the informat\", \"ion needed for the bindings is contained in a special *functions.json* file for scripts or declared \", \"with attributes in code.\\n\\nSome common triggers include:\\n\\n- Blob Storage: invoke your function when a\", \" file or folder is uploaded or changed in storage.\\n- HTTP: invoke your function like a REST API.\\n- Q\", \"ueue: invoke your function when items exist in a queue.\\n- Timer: invoke your function on a regular c\", \"adence.\\n\\nExamples of bindings include:\\n\\n- CosmosDB: easily connect to the database to load or save f\", \"iles.\\n- Table Storage: work with key/value storage from your function app.\\n- Queue Storage: easily r\", \"etrieve items from a queue, or place new items on the queue.\\n\\nThe following example *functions.json*\", \" file defines a trigger and a binding:\\n\\n```\\n{\\n \\\"bindings\\\": [\\n {\\n \\\"name\\\": \\\"myBlob\\\",\\n \\\"type\\\": \\\"blobTri\", \"gger\\\",\\n \\\"direction\\\": \\\"in\\\",\\n \\\"path\\\": \\\"images/{name}\\\",\\n \\\"connection\\\": \\\"AzureWebJobsStorage\\\"\\n },\\n {\\n \\\"n\", \"ame\\\": \\\"$return\\\",\\n \\\"type\\\": \\\"queue\\\",\\n \\\"direction\\\": \\\"out\\\",\\n \\\"queueName\\\": \\\"images\\\",\\n \\\"connection\\\": \\\"Azur\", \"eWebJobsStorage\\\"\\n }\\n ],\\n \\\"disabled\\\": false\\n}\\n```\\n\\nIn this example, the function is triggered by a ch\", \"ange to blob storage in the images container. The information for the file is passed in, so the trig\", \"ger also acts as a binding. Another binding exists to put information onto a queue named images.\\n\\nHe\", \"re is the C# script for the function:\\n\\n```\\npublic static string Run(Stream myBlob, string name, Trac\", \"eWriter log)\\n{\\n log.Info($\\\"C# Blob trigger function Processed blob\\\\n Name:{name} \\\\n Size: \\n{myBlob.L\", \"ength} Bytes\\\");\\n return name;\\n}\\n```\\n\\nThe example is a simple function that takes the name of the fil\", \"e that was modified or uploaded to blob storage, and places it on a queue for later processing.\\n\\nFor\", \" a full list of triggers and bindings, see [Azure Functions triggers and bindings concepts.](https:/\", \"/docs.microsoft.com/azure/azure-functions/functions-triggers-bindings)\\n\\n# <span id=\\\"page-34-0\\\"></spa\", \"n>Telemetry with Application Insights\\n\\n[Application Insights](https://docs.microsoft.com/azure/appli\", \"cation-insights) is a serverless diagnostics platform that enables developers to detect, triage, and\", \" diagnose issues in web apps, mobile apps, desktop apps, and microservices. You can turn on Applicat\", \"ion Insights for function apps simply by flipping a switch in the portal. Application Insights provi\", \"des all of these capabilities without you having to configure a server or set up your own database. \", \"All of Application Insights' capabilities are provided as a service that automatically integrates wi\", \"th your apps.\\n\\n![](_page_34_Picture_6.jpeg)\\n\\nAdding Application Insights to existing apps is as easy\", \" as adding an instrumentation key to your application's settings. With Application Insights you can:\", \"\\n\\n- Create custom charts and alerts based on metrics such as number of function invocations, the tim\", \"e it takes to run a function, and exceptions\\n- Analyze failures and server exceptions\\n- Drill into p\", \"erformance by operation and measure the time it takes to call third-party dependencies\\n- Monitor CPU\", \" usage, memory, and rates across all servers that host your function apps\\n- View a live stream of me\", \"trics including request count and latency for your function apps\\n- Use [Analytics](https://docs.micr\", \"osoft.com/azure/application-insights/app-insights-analytics) to search, query, and create custom cha\", \"rts over your function data\\n\\n![](_page_35_Figure_0.jpeg)\\n\\nIn addition to built-in telemetry, it's al\", \"so possible to generate custom telemetry. The following code snippet creates a custom telemetry clie\", \"nt using the instrumentation key set for the function app:\\n\\n```\\npublic static TelemetryClient teleme\", \"try = new TelemetryClient()\\n{\\n InstrumentationKey = \\nEnvironment.GetEnvironmentVariable(\\\"APPINSIGHTS\", \"_INSTRUMENTATIONKEY\\\")\\n};\\n```\\n\\nThe following code measures how long it takes to insert a new row into\", \" an [Azure Table Storage](https://docs.microsoft.com/azure/cosmos-db/table-storage-overview) instanc\", \"e:\\n\\n```\\nvar startTime = DateTime.UtcNow;\\nvar timer = System.Diagnostics.Stopwatch.StartNew();\\nawait \", \"tableClient.AddEntityAsync(entry);\\ntelemetry.TrackDependency(\\\"AzureTableStorageInsert\\\", \\\"Insert\\\", st\", \"artTime, timer.Elapsed, \\ntrue);\\n```\\n\\nThe resulting performance graph is shown:\\n\\n![](_page_36_Figure_\", \"0.jpeg)\\n\\nThe custom telemetry reveals the average time to insert a new row is 32.6 milliseconds.\\n\\nAp\", \"plication Insights provides a powerful, convenient way to log detailed telemetry about your serverle\", \"ss applications. You have full control over the level of tracing and logging that is provided. You c\", \"an track custom statistics such as events, dependencies, and page view. Finally, the powerful analyt\", \"ics enable you to write queries that ask important questions and generate charts and advanced insigh\", \"ts.\\n\\n<span id=\\\"page-36-0\\\"></span>For more information, see [Monitor Azure Functions.](https://docs.m\", \"icrosoft.com/azure/azure-functions/functions-monitoring)\\n\\n# Azure Logic Apps\\n\\n[Azure Logic Apps](htt\", \"ps://docs.microsoft.com/azure/logic-apps) provides a serverless engine to build automated workflows \", \"to integrate apps and data between cloud services and on-premises systems. You build workflows using\", \" a visual designer. You can trigger workflows based on events or timers and leverage connectors to i\", \"ntegration applications and facilitate business-to-business (B2B) communication. Logic Apps integrat\", \"es seamlessly with Azure Functions.\\n\\n![](_page_36_Picture_6.jpeg)\\n\\nLogic Apps can do more than just \", \"connect your cloud services (like functions) with cloud resources (like queues and databases). You c\", \"an also orchestrate on-premises workflows with the on-premises gateway. For example, you can use the\", \" Logic App to trigger an on-premises SQL stored procedure in response to a cloud-based event or cond\", \"itional logic in your workflow. Learn more about [Connecting](https://docs.microsoft.com/azure/analy\", \"sis-services/analysis-services-gateway)  [to on-premises data sources with Azure On-premises Data Ga\", \"teway.](https://docs.microsoft.com/azure/analysis-services/analysis-services-gateway)\\n\\n![](_page_37_\", \"Figure_0.jpeg)\\n\\nLike Azure Functions, you kick off Logic App workflows with a trigger. There are man\", \"y triggers for you to choose from. The following capture shows just a few of the more popular ones o\", \"ut of hundreds that are available.\\n\\n![](_page_37_Figure_2.jpeg)\\n\\nOnce the app is triggered, you can \", \"use the visual designer to build out steps, loops, conditions, and actions. Any data ingested in a p\", \"revious step is available for you to use in subsequent steps. The following workflow loads URLs from\", \" a CosmosDB database. It finds the ones with a host of t.co then searches for them on Twitter. If it\", \" finds corresponding tweets, it updates the documents with the related tweets by calling a function.\", \"\\n\\n![](_page_38_Figure_0.jpeg)\\n\\nThe Logic Apps dashboard shows the history of running your workflows \", \"and whether each run completed successfully or not. You can navigate into any given run and inspect \", \"the data used by each step for troubleshooting. Logic Apps also provides existing templates you can \", \"edit and are well suited for complex enterprise workflows.\\n\\nTo learn more, see [Azure Logic Apps.](h\", \"ttps://docs.microsoft.com/azure/logic-apps)\\n\\n# <span id=\\\"page-38-0\\\"></span>Event Grid\\n\\n[Azure Event \", \"Grid](https://docs.microsoft.com/azure/event-grid/overview) provides serverless infrastructure for e\", \"vent-based applications. You can publish to Event Grid from any source and consume messages from any\", \" platform. Event Grid also has built-in support for events from Azure resources to streamline integr\", \"ation with your applications. For example, you can subscribe to blob storage events to notify your a\", \"pp when a file is uploaded. Your application can then publish a custom event grid message that is co\", \"nsumed by other cloud or on-premises applications. Event Grid was built to reliably handle massive s\", \"cale. You get the benefits of publishing and subscribing to messages without the overhead of setting\", \" up the necessary infrastructure.\\n\\n![](_page_39_Picture_0.jpeg)\\n\\nThe major features of event grid in\", \"clude:\\n\\n- Fully managed event routing.\\n- Near real-time event delivery at scale.\\n- Broad coverage bo\", \"th inside and outside of Azure.\\n\\n### <span id=\\\"page-39-0\\\"></span>**Scenarios**\\n\\nEvent Grid addresses\", \" several different scenarios. This section covers three of the most common ones.\\n\\n#### **Ops automat\", \"ion**\\n\\n![](_page_39_Picture_8.jpeg)\\n\\nEvent Grid can help speed automation and simplify policy enforc\", \"ement by notifying [Azure](https://docs.microsoft.com/azure/automation)  [Automation](https://docs.m\", \"icrosoft.com/azure/automation) when infrastructure is provisioned.\\n\\n#### **Application integration**\", \"\\n\\n![](_page_40_Picture_1.jpeg)\\n\\nYou can use Event Grid to connect your app to other services. Using \", \"standard HTTP protocols, even legacy apps can be easily modified to publish Event Grid messages. Web\", \" hooks are available for other services and platforms to consume Event Grid messages.\\n\\n#### **Server\", \"less apps**\\n\\n![](_page_40_Picture_4.jpeg)\\n\\nEvent Grid can trigger Azure Functions, Logic Apps, or yo\", \"ur own custom code. A major benefit of using Event Grid is that it uses a *push* mechanism to send m\", \"essages when events occur. The push architecture consumes fewer resources and scales better than *po\", \"lling* mechanisms. Polling must check for updates on a regular interval.\\n\\n### <span id=\\\"page-40-0\\\"><\", \"/span>**Event Grid vs. other Azure messaging services**\\n\\nAzure provides several messaging services, \", \"including [Event Hubs](https://docs.microsoft.com/azure/event-hubs) and [Service Bus.](https://docs.\", \"microsoft.com/azure/service-bus-messaging) Each is designed to address a specific set of use cases. \", \"The following diagram provides a high-level overview of the differences between the services.\\n\\n![](_\", \"page_41_Figure_0.jpeg)\\n\\nFor a more in-depth comparison, see [Compare messaging services.](https://do\", \"cs.microsoft.com/azure/event-grid/compare-messaging-services)\\n\\n### <span id=\\\"page-41-0\\\"></span>**Per\", \"formance targets**\\n\\nUsing Event Grid you can take advantage of the following performance guarantees:\", \"\\n\\n- Subsecond end-to-end latency in the 99th percentile.\\n- 99.99% availability.\\n- 10 million events \", \"per second per region.\\n- 100 million subscriptions per region.\\n- 50-ms publisher latency.\\n- 24-hour \", \"retry with exponential back-off for guaranteed delivery in the 1-day window.\\n- Transparent regional \", \"failover.\\n\\n### <span id=\\\"page-41-1\\\"></span>**Event Grid schema**\\n\\nEvent Grid uses a standard schema \", \"to wrap custom events. The schema is like an envelope that wraps your custom data element. Here is a\", \"n example Event Grid message:\\n\\n```\\n[{\\n \\\"id\\\": \\\"03e24f21-a955-43cc-8921-1f61a6081ce0\\\",\\n \\\"eventType\\\": \\\"\", \"myCustomEvent\\\",\\n \\\"subject\\\": \\\"foo/bar/12\\\",\\n \\\"eventTime\\\": \\\"2018-09-22T10:36:01+00:00\\\",\\n \\\"data\\\": {\\n \\\"fa\", \"voriteColor\\\": \\\"blue\\\",\\n \\\"favoriteAnimal\\\": \\\"panther\\\",\\n \\\"favoritePlanet\\\": \\\"Jupiter\\\"\\n },\\n \\\"dataVersion\\\":\", \" \\\"1.0\\\"\\n}]\\n```\\n\\nEverything about the message is standard except the data property. You can inspect th\", \"e message and use the eventType and dataVersion to de-serialize the custom portion of the payload.\\n\\n\", \"### <span id=\\\"page-42-0\\\"></span>**Azure resources**\\n\\nA major benefit of using Event Grid is the auto\", \"matic messages produced by Azure. In Azure, resources automatically publish to a *topic* that allows\", \" you to subscribe for various events. The following table lists the resource types, message types, a\", \"nd events that are available automatically.\\n\\n| Azure<br>resource     | Event type                   \", \"             | Description                                                                          \", \"                                    |\\n|-----------------------|-------------------------------------\", \"------|---------------------------------------------------------------------------------------------\", \"-----------------------------|\\n| Azure<br>subscription | Microsoft.Resources.ResourceWriteSuccess  |\", \" Raised when a resource create or<br>update operation succeeds.                                     \", \"                      |\\n|                       | Microsoft.Resources.ResourceWriteFailure  | Raised\", \" when a resource create or<br>update operation fails.                                               \", \"               |\\n|                       | Microsoft.Resources.ResourceWriteCancel   | Raised when a\", \" resource create or<br>update operation is canceled.                                                \", \"        |\\n|                       | Microsoft.Resources.ResourceDeleteSuccess | Raised when a resour\", \"ce delete<br>operation succeeds.                                                                    \", \" |\\n|                       | Microsoft.Resources.ResourceDeleteFailure | Raised when a resource dele\", \"te<br>operation fails.                                                                        |\\n|   \", \"                    | Microsoft.Resources.ResourceDeleteCancel  | Raised when a resource delete<br>o\", \"peration is canceled. This event<br>happens when a template deployment<br>is canceled. |\\n| Blob stor\", \"age          | Microsoft.Storage.BlobCreated             | Raised when a blob is created.           \", \"                                                                                |\\n|                 \", \"      | Microsoft.Storage.BlobDeleted             | Raised when a blob is deleted.                  \", \"                                                                         |\\n| Event hubs            |\", \" Microsoft.EventHub.CaptureFileCreated     | Raised when a capture file is created.                 \", \"                                                                  |\\n| IoT Hub               | Micros\", \"oft.Devices.DeviceCreated           | Published when a device is registered<br>to an IoT hub.       \", \"                                                           |\\n|                       | Microsoft.Dev\", \"ices.DeviceDeleted           | Published when a device is deleted<br>from an IoT hub.               \", \"                                                    |\\n| Resource<br>groups    | Microsoft.Resources.\", \"ResourceWriteSuccess  | Raised when a resource create or<br>update operation succeeds.              \", \"                                             |\\n|                       | Microsoft.Resources.Resourc\", \"eWriteFailure  | Raised when a resource create or<br>update operation fails.                        \", \"                                      |\\n|                       | Microsoft.Resources.ResourceWriteC\", \"ancel   | Raised when a resource create or<br>update operation is canceled.                         \", \"                               |\\n|                       | Microsoft.Resources.ResourceDeleteSuccess\", \" | Raised when a resource delete<br>operation succeeds.                                             \", \"                        |\\n|                       | Microsoft.Resources.ResourceDeleteFailure | Rais\", \"ed when a resource delete<br>operation fails.                                                       \", \"                 |\\n\\n| Azure<br>resource | Event type                               | Description    \", \"                                                                                                    \", \"      |\\n|-------------------|------------------------------------------|----------------------------\", \"----------------------------------------------------------------------------------------------|\\n|   \", \"                | Microsoft.Resources.ResourceDeleteCancel | Raised when a resource delete<br>operat\", \"ion is canceled. This event<br>happens when a template deployment<br>is canceled. |\\n\\nFor more inform\", \"ation, see [Azure Event Grid event schema.](https://docs.microsoft.com/azure/event-grid/event-schema\", \")\\n\\nYou can access Event Grid from any type of application, even one that runs on-premises.\\n\\n### <spa\", \"n id=\\\"page-43-0\\\"></span>**Conclusion**\\n\\nIn this chapter you learned about the Azure serverless platf\", \"orm that is composed of Azure Functions, Logic Apps, and Event Grid. You can use these resources to \", \"build an entirely serverless app architecture, or create a hybrid solution that interacts with other\", \" cloud resources and on-premises servers. Combined with a serverless data platform such as [Azure SQ\", \"L](https://docs.microsoft.com/azure/sql-database) or [CosmosDB,](https://docs.microsoft.com/azure/co\", \"smos-db/introduction) you can build fully managed cloud native applications.\\n\\n### <span id=\\\"page-43-\", \"1\\\"></span>**Recommended resources**\\n\\n- [App service plans](https://docs.microsoft.com/azure/app-serv\", \"ice/azure-web-sites-web-hosting-plans-in-depth-overview)\\n- [Application Insights](https://docs.micro\", \"soft.com/azure/application-insights)\\n- [Application Insights Analytics](https://docs.microsoft.com/a\", \"zure/application-insights/app-insights-analytics)\\n- [Azure: Bring your app to the cloud with serverl\", \"ess Azure Functions](https://docs.microsoft.com/events/Connect/2017/E102)\\n- [Azure Event Grid](https\", \"://docs.microsoft.com/azure/event-grid/overview)\\n- [Azure Event Grid event schema](https://docs.micr\", \"osoft.com/azure/event-grid/event-schema)\\n- [Azure Event Hubs](https://docs.microsoft.com/azure/event\", \"-hubs)\\n- [Azure Functions documentation](https://docs.microsoft.com/azure/azure-functions)\\n- [Azure \", \"Functions triggers and bindings concepts](https://docs.microsoft.com/azure/azure-functions/functions\", \"-triggers-bindings)\\n- [Azure Logic Apps](https://docs.microsoft.com/azure/logic-apps)\\n- [Azure Servi\", \"ce Bus](https://docs.microsoft.com/azure/service-bus-messaging)\\n- [Azure Table Storage](https://docs\", \".microsoft.com/azure/cosmos-db/table-storage-overview)\\n- [Connecting to on-premises data sources wit\", \"h Azure On-premises Data Gateway](https://docs.microsoft.com/azure/analysis-services/analysis-servic\", \"es-gateway)\\n- [Create your first function in the Azure portal](https://docs.microsoft.com/azure/azur\", \"e-functions/functions-create-first-azure-function)\\n- [Create your first function using the Azure CLI\", \"](https://docs.microsoft.com/azure/azure-functions/functions-create-first-azure-function-azure-cli)\\n\", \"- [Create your first function using Visual Studio](https://docs.microsoft.com/azure/azure-functions/\", \"functions-create-your-first-function-visual-studio)\\n- [Functions supported languages](https://docs.m\", \"icrosoft.com/azure/azure-functions/supported-languages)\\n- [Monitor Azure Functions](https://docs.mic\", \"rosoft.com/azure/azure-functions/functions-monitoring)\\n\\n**CHAPTER** 4**CHAPTER** 4\\n\\n# <span id=\\\"page\", \"-44-0\\\"></span>Durable Azure Functions\\n\\nWhen creating serverless applications with Azure Functions, y\", \"our operations will typically be designed to run in a stateless manner. The reason for this design c\", \"hoice is because as the platform scales, it becomes difficult to know what servers the code is runni\", \"ng on. It also becomes difficult to know how many instances are active at any given point. However, \", \"there are classes of applications that require the current state of a process to be known. Consider \", \"the process of submitting an order to an online store. The checkout operation might be a workflow th\", \"at is composed of multiple operations that need to know the state of the process. Such information m\", \"ay include the product inventory, if the customer has any credits on their account, and also the res\", \"ults of processing the credit card. These operations could easily be their own internal workflows or\", \" even services from third-party systems.\\n\\nVarious patterns exist today that assist with the coordina\", \"tion of application state between internal and external systems. It's common to come across solution\", \"s that rely on centralized queuing systems, distributed key-value stores, or shared databases to man\", \"age that state. However, these are all additional resources that now need to be provisioned and mana\", \"ged. In a serverless environment, your code could become cumbersome trying to coordinate with these \", \"resources manually. Azure Functions offers an alternative for creating stateful functions called Dur\", \"able Functions.\\n\\nDurable Functions is an extension to the Azure Functions runtime that enables the d\", \"efinition of stateful workflows in code. By breaking down workflows into activities, the Durable Fun\", \"ctions extension can manage state, create progress checkpoints, and handle the distribution of funct\", \"ion calls across servers. In the background, it makes use of an Azure Storage account to persist exe\", \"cution history, schedule activity functions and retrieve responses. Your serverless code should neve\", \"r interact with persisted information in that storage account, and is typically not something with w\", \"hich developers need to interact.\\n\\n# <span id=\\\"page-44-1\\\"></span>Triggering a stateful workflow\\n\\nSta\", \"teful workflows in Durable Functions can be broken down into two intrinsic components; orchestration\", \" and activity triggers. Triggers and bindings are core components used by Azure Functions to enable \", \"your serverless functions to be notified when to start, receive input, and return results.\\n\\n### <spa\", \"n id=\\\"page-44-2\\\"></span>**Working with the Orchestration client**\\n\\nOrchestrations are unique when co\", \"mpared to other styles of triggered operations in Azure Functions. Durable Functions enables the exe\", \"cution of functions that may take hours or even days to complete. That type of behavior comes with t\", \"he need to able to check the status of a running orchestration, preemptively terminate, or send noti\", \"fications of external events.\\n\\nFor such cases, the Durable Functions extension provides the DurableO\", \"rchestrationClient class that allows you to interact with orchestrated functions. You get access to \", \"the orchestration client by using the OrchestrationClientAttribute binding. Generally, you would inc\", \"lude this attribute with another trigger type, such as an HttpTrigger or ServiceBusTrigger. Once the\", \" source function has been triggered, the orchestration client can be used to start an orchestrator f\", \"unction.\\n\\n```\\n[FunctionName(\\\"KickOff\\\")]\\npublic static async Task<HttpResponseMessage> Run(\\n [HttpTri\", \"gger(AuthorizationLevel.Function, \\\"POST\\\")]HttpRequestMessage req,\\n [OrchestrationClient ] DurableOrc\", \"hestrationClient<orchestrationClient>)\\n{\\n OrderRequestData data = await req.Content.ReadAsAsync<Orde\", \"rRequestData>();\\n string instanceId = await orchestrationClient.StartNewAsync(\\\"PlaceOrder\\\", data);\\n \", \"return orchestrationClient.CreateCheckStatusResponse(req, instanceId);\\n}\\n```\\n\\n### <span id=\\\"page-45-\", \"0\\\"></span>**The orchestrator function**\\n\\nAnnotating a function with the OrchestrationTriggerAttribut\", \"e in Azure Functions marks that function as an orchestrator function. It's responsible for managing \", \"the various activities that make up your stateful workflow.\\n\\nOrchestrator functions are unable to ma\", \"ke use of bindings other than the OrchestrationTriggerAttribute. This attribute can only be used wit\", \"h a parameter type of DurableOrchestrationContext. No other inputs can be used since deserialization\", \" of inputs in the function signature isn't supported. To get inputs provided by the orchestration cl\", \"ient, the GetInput<T> method must be used.\\n\\nAlso, the return types of orchestration functions must b\", \"e either void, Task, or a JSON serializable value.\\n\\n*Error handling code has been left out for brevi\", \"ty*\\n\\n```\\n[FunctionName(\\\"PlaceOrder\\\")]\\npublic static async Task<string> PlaceOrder([OrchestrationTrig\", \"ger] \\nDurableOrchestrationContext context)\\n{\\n OrderRequestData orderData = context.GetInput<OrderReq\", \"uestData>();\\n await context.CallActivityAsync<bool>(\\\"CheckAndReserveInventory\\\", orderData);\\n await c\", \"ontext.CallActivityAsync<string>(\\\"ProcessPayment\\\", orderData);\\n string trackingNumber = await contex\", \"t.CallActivityAsync<string>(\\\"ScheduleShipping\\\", \\norderData);\\n await context.CallActivityAsync<string\", \">(\\\"EmailCustomer\\\", trackingNumber);\\n return trackingNumber;\\n}\\n```\\n\\nMultiple instances of an orchestr\", \"ation can be started and running at the same time. Calling the StartNewAsync method on the DurableOr\", \"chestrationClient launches a new instance of the orchestration. The method returns a Task<string> th\", \"at completes when the orchestration has started. An exception of type TimeoutException gets thrown i\", \"f the orchestration hasn't started within 30 seconds.\\n\\nThe completed Task<string> from StartNewAsync\", \" should contain the unique ID of the orchestration instance. This instance ID can be used to invoke \", \"operations on that specific orchestration. The orchestration can be queried for the status or sent e\", \"vent notifications.\\n\\n### <span id=\\\"page-46-0\\\"></span>**The activity functions**\\n\\nActivity functions \", \"are the discrete operations that get composed together within an orchestration function to create th\", \"e workflow. Here is where most of actual work would take place. They represent the business logic, l\", \"ong running processes, and the puzzle pieces to a larger solution.\\n\\nThe ActivityTriggerAttribute is \", \"used to annotate a function parameter of type DurableActivityContext. Using the annotation informs t\", \"he runtime that the function is intended to be used as an activity function. Input values to activit\", \"y functions are retrieved using the GetInput<T> method of the DurableActivityContext parameter.\\n\\nSim\", \"ilar to orchestration functions, the return types of activity functions must be either void, Task, o\", \"r a JSON serializable value.\\n\\nAny unhandled exceptions that get thrown within activity functions wil\", \"l get sent up to the calling orchestrator function and presented as a TaskFailedException. At this p\", \"oint, the error can be caught and logged in the orchestrator, and the activity can be retried.\\n\\n```\\n\", \"[FunctionName(\\\"CheckAndReserveInventory\\\")]\\npublic static bool CheckAndReserveInventory([ActivityTrig\", \"ger] DurableActivityContext \\ncontext)\\n{\\n OrderRequestData orderData = context.GetInput<OrderRequestD\", \"ata>();\\n // Connect to inventory system and try to reserve items\\n return true;\\n}\\n```\\n\\n# <span id=\\\"pa\", \"ge-46-1\\\"></span>Recommended resources\\n\\n- [Durable Functions](https://docs.microsoft.com/azure/azure-\", \"functions/durable-functions-overview)\\n- [Bindings for Durable Functions](https://docs.microsoft.com/\", \"azure/azure-functions/durable-functions-bindings)\\n- <span id=\\\"page-46-2\\\"></span>\\u2022 [Manage instances \", \"in Durable Functions](https://docs.microsoft.com/azure/azure-functions/durable-functions-instance-ma\", \"nagement)\\n\\n# Orchestration patterns\\n\\nDurable Functions makes it easier to create stateful workflows \", \"that are composed of discrete, long running activities in a serverless environment. Since Durable Fu\", \"nctions can track the progress of your workflows and periodically checkpoints the execution history,\", \" it lends itself to implementing some interesting patterns.\\n\\n### <span id=\\\"page-47-0\\\"></span>**Funct\", \"ion chaining**\\n\\nIn a typical sequential process, activities need to execute one after the other in a\", \" particular order. Optionally, the upcoming activity may require some output from the previous funct\", \"ion. This dependency on the ordering of activities creates a function chain of execution.\\n\\nThe benef\", \"it of using Durable Functions to implement this workflow pattern comes from its ability to do checkp\", \"ointing. If the server crashes, the network times out or some other issue occurs, Durable functions \", \"can resume from the last known state and continue running your workflow even if it's on another serv\", \"er.\\n\\n```\\n[FunctionName(\\\"PlaceOrder\\\")]\\npublic static async Task<string> PlaceOrder([OrchestrationTrig\", \"ger] \\nDurableOrchestrationContext context)\\n{\\n OrderRequestData orderData = context.GetInput<OrderReq\", \"uestData>();\\n await context.CallActivityAsync<bool>(\\\"CheckAndReserveInventory\\\", orderData);\\n await c\", \"ontext.CallActivityAsync<bool>(\\\"ProcessPayment\\\", orderData);\\n string trackingNumber = await context.\", \"CallActivityAsync<string>(\\\"ScheduleShipping\\\", \\norderData);\\n await context.CallActivityAsync<string>(\", \"\\\"EmailCustomer\\\", trackingNumber);\\n return trackingNumber;\\n}\\n```\\n\\nIn the preceding code sample, the C\", \"allActivityAsync function is responsible for running a given activity on a virtual machine in the da\", \"ta center. When the await returns and the underlying Task completes, the execution will be recorded \", \"to the history table. The code in the orchestrator function can make use of any of the familiar cons\", \"tructs of the Task Parallel Library and the async/await keywords.\\n\\nThe following code is a simplifie\", \"d example of what the ProcessPayment method may look like:\\n\\n```\\n[FunctionName(\\\"ProcessPayment\\\")]\\npub\", \"lic static bool ProcessPayment([ActivityTrigger] DurableActivityContext context)\\n{\\n OrderRequestData\", \" orderData = context.GetInput<OrderRequestData>();\\n ApplyCoupons(orderData);\\n if(IssuePaymentRequest\", \"(orderData)) {\\n return true;\\n }\\n return false;\\n}\\n```\\n\\n### <span id=\\\"page-47-1\\\"></span>**Asynchronous\", \" HTTP APIs**\\n\\nIn some cases, workflows may contain activities that take a relatively long period of \", \"time to complete. Imagine a process that kicks off the backup of media files into blob storage. Depe\", \"nding on the size and quantity of the media files, this backup process may take hours to complete.\\n\\n\", \"In this scenario, the DurableOrchestrationClient's ability to check the status of a running workflow\", \" becomes useful. When using an HttpTrigger to start a workflow, the CreateCheckStatusResponse method\", \" can be used to return an instance of HttpResponseMessage. This response provides the client with a \", \"URI in the payload that can be used to check the status of the running process.\\n\\n```\\n[FunctionName(\\\"\", \"OrderWorkflow\\\")]\\npublic static async Task<HttpResponseMessage> Run(\\n [HttpTrigger(AuthorizationLevel\", \".Function, \\\"POST\\\")]HttpRequestMessage req,\\n [OrchestrationClient ] DurableOrchestrationClient orches\", \"trationClient)\\n{\\n OrderRequestData data = await req.Content.ReadAsAsync<OrderRequestData>();\\n string\", \" instanceId = await orchestrationClient.StartNewAsync(\\\"PlaceOrder\\\", data);\\n return orchestrationClie\", \"nt.CreateCheckStatusResponse(req, instanceId);\\n}\\n```\\n\\nThe sample result below shows the structure of\", \" the response payload.\\n\\n```\\n{\\n \\\"id\\\": \\\"instanceId\\\",\\n \\\"statusQueryGetUri\\\": \\\"http://host/statusUri\\\",\\n \\\"\", \"sendEventPostUri\\\": \\\"http://host/eventUri\\\",\\n \\\"terminatePostUri\\\": \\\"http://host/terminateUri\\\"\\n}\\n```\\n\\nUs\", \"ing your preferred HTTP client, GET requests can be made to the URI in statusQueryGetUri to inspect \", \"the status of the running workflow. The returned status response should resemble the following code.\", \"\\n\\n```\\n{\\n \\\"runtimeStatus\\\": \\\"Running\\\",\\n \\\"input\\\": {\\n \\\"$type\\\": \\\"DurableFunctionsDemos.OrderRequestData, \", \"DurableFunctionsDemos\\\"\\n },\\n \\\"output\\\": null,\\n \\\"createdTime\\\": \\\"2018-01-01T00:22:05Z\\\",\\n \\\"lastUpdatedTim\", \"e\\\": \\\"2018-01-01T00:22:09Z\\\"\\n}\\n```\\n\\nAs the process continues, the status response will change to eithe\", \"r **Failed** or **Completed**. On successful completion, the **output** property in the payload will\", \" contain any returned data.\\n\\n### <span id=\\\"page-48-0\\\"></span>**Monitoring**\\n\\nFor simple recurring ta\", \"sks, Azure Functions provides the TimerTrigger that can be scheduled based on a CRON expression. The\", \" timer works well for simple, short-lived tasks, but there might be scenarios where more flexible sc\", \"heduling is needed. This scenario is when the monitoring pattern and Durable Functions can help.\\n\\nDu\", \"rable Functions allows for flexible scheduling intervals, lifetime management, and the creation of m\", \"ultiple monitor processes from a single orchestration function. One use case for this functionality \", \"might be to create watchers for stock price changes that complete once a certain threshold is met.\\n\\n\", \"```\\n[FunctionName(\\\"CheckStockPrice\\\")]\\npublic static async Task CheckStockPrice([OrchestrationTrigger\", \"] DurableOrchestrationContext \\ncontext)\\n{\\n StockWatcherInfo stockInfo = context.GetInput<StockWatche\", \"rInfo>();\\n const int checkIntervalSeconds = 120;\\n StockPrice initialStockPrice = null;\\n DateTime fir\", \"eAt;\\n DateTime exitTime = context.CurrentUtcDateTime.Add(stockInfo.TimeLimit);\\n while (context.Curre\", \"ntUtcDateTime < exitTime)\\n {\\n StockPrice currentStockPrice = await \\ncontext.CallActivityAsync<StockP\", \"rice>(\\\"GetStockPrice\\\", stockInfo);\\n if (initialStockPrice == null)\\n {\\n initialStockPrice = currentSt\", \"ockPrice;\\n fireAt = context.CurrentUtcDateTime.AddSeconds(checkIntervalSeconds);\\n await context.Crea\", \"teTimer(fireAt, CancellationToken.None);\\n continue;\\n }\\n decimal percentageChange = (initialStockPric\", \"e.Price - currentStockPrice.Price) /\\n ((initialStockPrice.Price + currentStockPrice.Price) / 2);\\n if\", \" (Math.Abs(percentageChange) >= stockInfo.PercentageChange)\\n {\\n // Change threshold detected\\n await \", \"context.CallActivityAsync(\\\"NotifyStockPercentageChange\\\", \\ncurrentStockPrice);\\n break;\\n }\\n // Sleep t\", \"il next polling interval\\n fireAt = context.CurrentUtcDateTime.AddSeconds(checkIntervalSeconds);\\n awa\", \"it context.CreateTimer(fireAt, CancellationToken.None);\\n }\\n}\\n```\\n\\nDurableOrchestrationContext's Crea\", \"teTimer method sets up the schedule for the next invocation of the loop to check for stock price cha\", \"nges. DurableOrchestrationContext also has a CurrentUtcDateTime property to get the current DateTime\", \" value in UTC. It's better to use this property instead of DateTime.UtcNow because it's easily mocke\", \"d for testing.\\n\\n### <span id=\\\"page-49-0\\\"></span>**Recommended resources**\\n\\n- [Azure Durable Function\", \"s](https://docs.microsoft.com/azure/azure-functions/durable-functions-overview)\\n- [Unit Testing in .\", \"NET Core and .NET Standard](https://docs.microsoft.com/dotnet/core/testing/)\\n\\n**CHAPTER** 5**CHAPTER\", \"** 5\\n\\n# <span id=\\\"page-50-0\\\"></span>Serverless business scenarios and use cases\\n\\nThere are many use \", \"cases and scenarios for serverless applications. This chapter includes samples that illustrate the d\", \"ifferent scenarios. The scenarios include links to related documentation and public source code repo\", \"sitories. The samples in this chapter enable you to get started on your own building and implementin\", \"g serverless solutions.\\n\\n# <span id=\\\"page-50-1\\\"></span>Big data processing\\n\\nThis example uses server\", \"less to do a map/reduce operation on a big data set. It determines the average speed of New York Yel\", \"low taxi trips per day in 2017.\\n\\n[Big Data Processing: Serverless MapReduce on Azure](https://docs.m\", \"icrosoft.com/samples/azure-samples/durablefunctions-mapreduce-dotnet/big-data-processing-serverless-\", \"mapreduce-on-azure/)\\n\\n# <span id=\\\"page-50-2\\\"></span>Create serverless applications: hands-on lab\\n\\nLe\", \"arn how to use functions to execute server-side logic and build serverless architectures.\\n\\n- Choosin\", \"g the best Azure service for your business\\n- Creating Azure Functions\\n- Using triggers\\n- Chaining fu\", \"nctions\\n- Long-running workflows\\n- Monitoring\\n- Development, testing, and deployment\\n\\n[Create server\", \"less applications](https://docs.microsoft.com/training/paths/create-serverless-applications/)\\n\\n# <sp\", \"an id=\\\"page-50-3\\\"></span>Customer reviews\\n\\nThis sample showcases the new Azure Functions tooling for\", \" C# Class Libraries in Visual Studio. Create a website where customers submit product reviews that a\", \"re stored in Azure storage blobs and\\n\\nCosmosDB. Add an Azure Function to perform automated moderatio\", \"n of the customer reviews using Azure Cognitive Services. Use an Azure storage queue to decouple the\", \" website from the function.\\n\\n[Customer Reviews App with Cognitive Services](https://docs.microsoft.c\", \"om/samples/azure-samples/functions-customer-reviews/customer-reviews-cognitive-services/)\\n\\n# <span i\", \"d=\\\"page-51-0\\\"></span>File processing and validation\\n\\nThis example parses a set of CSV files from hyp\", \"othetical customers. It ensures that all files required for a customer \\\"batch\\\" are ready, then valid\", \"ates the structure of each file. Different solutions are presented using Azure Functions, Logic Apps\", \", and Durable Functions.\\n\\n[File processing and validation using Azure Functions, Logic Apps, and Dur\", \"able Functions](https://docs.microsoft.com/samples/azure-samples/serverless-file-validation/file-pro\", \"cessing-and-validation-using-azure-functions-logic-apps-and-durable-functions/)\\n\\n# <span id=\\\"page-51\", \"-1\\\"></span>Game data visualization\\n\\nAn example of how a developer could implement an in-editor data \", \"visualization solution for their game. In fact, an Unreal Engine 4 Plugin and Unity Plugin were deve\", \"loped using this sample as its backend. The service component is game engine agnostic.\\n\\n[In-editor g\", \"ame telemetry visualization](https://docs.microsoft.com/samples/azure-samples/gaming-in-editor-telem\", \"etry/in-editor-telemetry-visualization/)\\n\\n# <span id=\\\"page-51-2\\\"></span>GraphQL\\n\\nCreate a serverless\", \" function that exposes a GraphQL API.\\n\\n<span id=\\\"page-51-3\\\"></span>[Serverless functions for GraphQL\", \"](https://github.com/softchris/graphql-workshop-dotnet/blob/master/docs/workshop/4.md)\\n\\n# Internet o\", \"f Things (IoT) reliable edge relay\\n\\nThis sample implements a new communication protocol to enable re\", \"liable upstream communication from IoT devices. It automates data gap detection and backfill.\\n\\n<span\", \" id=\\\"page-51-4\\\"></span>[IoT Reliable Edge Relay](https://docs.microsoft.com/samples/azure-samples/io\", \"t-reliable-edge-relay/iot-reliable-edge-relay/)\\n\\n# Microservices reference architecture\\n\\nA reference\", \" architecture that walks you through the decision-making process involved in designing, developing, \", \"and delivering the Rideshare by Relecloud application (a fictitious company). It includes hands-on i\", \"nstructions for configuring and deploying all of the architecture's components.\\n\\n# <span id=\\\"page-52\", \"-0\\\"></span>Serverless for mobile\\n\\nAzure Functions are easy to implement and maintain, and accessible\", \" through HTTP. They are a great way to implement an API for a mobile application. Microsoft offers g\", \"reat cross-platform tools for iOS, Android, and Windows with Xamarin. As such, Xamarin and Azure Fun\", \"ctions are working great together. This article shows how to implement an Azure Function in the Azur\", \"e portal or in Visual Studio at first, and build a cross-platform client with Xamarin.Forms running \", \"on Android, iOS, and Windows.\\n\\n<span id=\\\"page-52-1\\\"></span>[Implementing a simple Azure Function wit\", \"h a Xamarin.Forms client](https://docs.microsoft.com/samples/azure-samples/functions-xamarin-getting\", \"-started/implementing-a-simple-azure-function-with-a-xamarinforms-client/)\\n\\n# Serverless messaging\\n\\n\", \"This sample shows how to utilize Durable Functions' fan-out pattern to load an arbitrary number of m\", \"essages across any number of sessions/partitions. It targets Service Bus, Event Hubs, or Storage Que\", \"ues. The sample also adds the ability to consume those messages with another Azure Function and load\", \" the resulting timing data in to another Event Hub. The data is then ingested into analytics service\", \"s like Azure Data Explorer.\\n\\n[Produce and Consume messages through Service Bus, Event Hubs, and Stor\", \"age Queues with Azure](https://docs.microsoft.com/samples/azure-samples/durable-functions-producer-c\", \"onsumer/product-consume-messages-az-functions/)  [Functions](https://docs.microsoft.com/samples/azur\", \"e-samples/durable-functions-producer-consumer/product-consume-messages-az-functions/)\\n\\n# <span id=\\\"p\", \"age-52-2\\\"></span>Recommended resources\\n\\n- [Big Data Processing: Serverless MapReduce on Azure](https\", \"://docs.microsoft.com/samples/azure-samples/durablefunctions-mapreduce-dotnet/big-data-processing-se\", \"rverless-mapreduce-on-azure/)\\n- [Create serverless applications](https://docs.microsoft.com/training\", \"/paths/create-serverless-applications/)\\n- [Customer Reviews App with Cognitive Services](https://doc\", \"s.microsoft.com/samples/azure-samples/functions-customer-reviews/customer-reviews-cognitive-services\", \"/)\\n- [File processing and validation using Azure Functions, Logic Apps, and Durable Functions](https\", \"://docs.microsoft.com/samples/azure-samples/serverless-file-validation/file-processing-and-validatio\", \"n-using-azure-functions-logic-apps-and-durable-functions/)\\n- [Implementing a simple Azure Function w\", \"ith a Xamarin.Forms client](https://docs.microsoft.com/samples/azure-samples/functions-xamarin-getti\", \"ng-started/implementing-a-simple-azure-function-with-a-xamarinforms-client/)\\n- [In-editor game telem\", \"etry visualization](https://docs.microsoft.com/samples/azure-samples/gaming-in-editor-telemetry/in-e\", \"ditor-telemetry-visualization/)\\n- [IoT Reliable Edge Relay](https://docs.microsoft.com/samples/azure\", \"-samples/iot-reliable-edge-relay/iot-reliable-edge-relay/)\\n- [Produce and Consume messages through S\", \"ervice Bus, Event Hubs, and Storage Queues with](https://docs.microsoft.com/samples/azure-samples/du\", \"rable-functions-producer-consumer/product-consume-messages-az-functions/)  [Azure Functions](https:/\", \"/docs.microsoft.com/samples/azure-samples/durable-functions-producer-consumer/product-consume-messag\", \"es-az-functions/)\\n- [Serverless functions for GraphQL](https://github.com/softchris/graphql-workshop\", \"-dotnet/blob/master/docs/workshop/4.md)\\n- [Serverless Microservices reference architecture](https://\", \"docs.microsoft.com/samples/azure-samples/serverless-microservices-reference-architecture/serverless-\", \"microservices-reference-architecture/)\\n\\n**CHAPTER** 6**CHAPTER** 6\\n\\n# <span id=\\\"page-53-0\\\"></span>Co\", \"nclusion\\n\\nThe following key takeaways are the most important conclusions from this guide.\\n\\n**Benefit\", \"s of using serverless.** Serverless solutions provide the important benefit of cost savings because \", \"serverless is implemented in a pay-per-use model. Serverless makes it possible to independently scal\", \"e, test, and deploy individual components of your application. Serverless is uniquely suited to impl\", \"ement microservices architectures and integrates fully into a DevOps pipeline.\\n\\n**Code as a unit of \", \"deployment.** Serverless abstracts the hardware, OS, and runtime away from the application. Serverle\", \"ss enables focusing on business logic in code as the unit of deployment.\\n\\n**Triggers and bindings.**\", \" Serverless eases integration with storage, APIs, and other cloud resources. Azure Functions provide\", \"s triggers to execute code and bindings to interact with resources.\\n\\n**Microservices.** The microser\", \"vices architecture is becoming the preferred approach for distributed and large or complex mission-c\", \"ritical applications that are based on multiple independent subsystems in the form of autonomous ser\", \"vices. In a microservice-based architecture, the application is built as a collection of services th\", \"at can be developed, tested, versioned, deployed, and scaled independently. Serverless is an archite\", \"cture well-suited for building these services.\\n\\n**Serverless platforms.** Serverless isn't just abou\", \"t the code. Platforms that support serverless architectures include serverless workflows and orchest\", \"ration, serverless messaging and event services, and serverless databases.\\n\\n**Serverless challenges.\", \"** Serverless introduces challenges related to distributed application development, such as fragment\", \"ed and independent data models, resiliency, versioning, and service discovery. Serverless may not be\", \" ideally suited to long running processes or components that benefit from tighter coupling.\\n\\n**Serve\", \"rless as a tool, not the toolbox.** Serverless is not the exclusive solution to application architec\", \"ture. It is a tool that can be leveraged as part of a hybrid application that may contain traditiona\", \"l tiers, monolith back ends, and containers. Serverless can be used to enhance existing solutions an\", \"d is not an all-or-nothing approach to application development.\"]"