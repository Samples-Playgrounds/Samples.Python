,0
0,runs-on: ubuntu-latest
1,
2,steps:
3,- uses: actions/checkout@v3
4,- name: 'Print manual run reason'
5,if: ${{ github.event_name == 'workflow_dispatch' }}
6,run: |
7,echo 'Reason: ${{ github.event.inputs.reason }}'
8,- name: Setup .NET
9,uses: actions/setup-dotnet@v3
10,with:
11,dotnet-version: 6.0.x
12,- name: Restore dependencies
13,run: dotnet restore
14,- name: Build
15,run: dotnet build --no-restore
16,- name: Test
17,run: dotnet test --no-build --verbosity normal
18,- name: Publish
19,run: dotnet publish SimpleFeedReader/SimpleFeedReader.csproj -c Release -o website
20,- name: Upload a Build Artifact
21,uses: actions/upload-artifact@v3
22,with:
23,name: website
24,path: SimpleFeedReader/website/**
25,if-no-files-found: error
26,
27,deploy_staging:
28,needs: build
29,runs-on: ubuntu-latest
30,
31,environment:
32,name: STAGING
33,url: ${{ steps.deploywebapp.outputs.webapp-url }}
34,
35,steps:
36,- name: Download a Build Artifact
37,uses: actions/download-artifact@v3
38,with:
39,name: website
40,path: website
41,
42,- name: Login via Azure CLI
43,uses: azure/login@v1
44,with:
45,creds: ${{ secrets.AZURE_CREDENTIALS }}
46,
47,- name: Deploy web app
48,id: deploywebapp
49,uses: azure/webapps-deploy@v2
50,with:
51,app-name: ${{ env.app-name }}
52,slot-name: staging
53,package: website
54,
55,- name: Update config
56,uses: Azure/appservice-settings@v1
57,with:
58,app-name: ${{ env.app-name }}
59,slot-name: staging
60,app-settings-json: |
