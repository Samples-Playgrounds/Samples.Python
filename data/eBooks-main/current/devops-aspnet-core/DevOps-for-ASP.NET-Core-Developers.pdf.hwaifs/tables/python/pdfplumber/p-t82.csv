,0
0,[
1,{
2,"""name"": ""UI:Index:Header"","
3,"""value"": ""${{ secrets.INDEX_HEADER }}"","
4,"""slotSetting"": true"
5,}
6,]
7,
8,- name: az cli logout
9,run: az logout
10,
11,deploy_prod:
12,needs: deploy_staging
13,runs-on: ubuntu-latest
14,
15,environment:
16,name: PROD
17,url: ${{ steps.slot_swap.outputs.url }}
18,
19,steps:
20,- name: Login via Azure CLI
21,uses: azure/login@v1
22,with:
23,creds: ${{ secrets.AZURE_CREDENTIALS }}
24,
25,- name: Swap staging slot into production
26,id: slot_swap
27,run: |
28,az webapp deployment slot swap -g ${{ env.rg-name }} -n ${{ env.app-name }} -s
29,staging
30,url=$(az webapp show -g ${{ env.rg-name }} -n ${{ env.app-name }} --query
31,"""defaultHostName"" -o tsv)"
32,"echo ""::set-output name=url::http://$url"""
33,
34,- name: Update config
35,uses: Azure/appservice-settings@v1
36,with:
37,app-name: ${{ env.app-name }}
38,app-settings-json: |
39,[
40,{
41,"""name"": ""UI:Index:Header"","
42,"""value"": ""${{ secrets.INDEX_HEADER }}"","
43,"""slotSetting"": true"
44,}
45,]
46,
47,- name: az cli logout
48,run: az logout
