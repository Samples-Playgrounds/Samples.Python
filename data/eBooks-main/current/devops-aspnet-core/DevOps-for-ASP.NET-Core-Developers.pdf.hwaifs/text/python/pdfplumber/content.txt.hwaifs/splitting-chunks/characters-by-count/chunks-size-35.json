"[\"EDITION v1.1.0\\nRefer changelog for the book updates and community contributions.\\nThis guide is avail\", \"able as a downloadable PDF e-book.\\nPUBLISHED BY\\nMicrosoft Developer Division, .NET, and Visual Studi\", \"o product teams\\nA division of Microsoft Corporation\\nOne Microsoft Way\\nRedmond, Washington 98052-6399\", \"\\nCopyright \\u00a9 2022 by Microsoft Corporation\\nAll rights reserved. No part of the contents of this book\", \" may be reproduced or transmitted in any\\nform or by any means without the written permission of the \", \"publisher.\\nThis book is provided \\u201cas-is\\u201d and expresses the author\\u2019s views and opinions. The views, o\", \"pinions, and\\ninformation expressed in this book, including URL and other Internet website references\", \", may change\\nwithout notice.\\nSome examples depicted herein are provided for illustration only and ar\", \"e fictitious. No real association\\nor connection is intended or should be inferred.\\nMicrosoft and the\", \" trademarks listed at https://www.microsoft.com on the \\u201cTrademarks\\u201d webpage are\\ntrademarks of the Mi\", \"crosoft group of companies.\\nMac and macOS are trademarks of Apple Inc.\\nThe Docker whale logo is a re\", \"gistered trademark of Docker, Inc. Used by permission.\\nAll other marks and logos are property of the\", \"ir respective owners.\\nCredits\\nAuthors:\\nCam Soper\\nScott Addie\\nColin Dembovsky\\nWelcome\\nWelcome to the \", \"Azure Development Lifecycle guide for .NET! This guide introduces the basic concepts\\nof building a d\", \"evelopment lifecycle around Azure using .NET tools and processes. After finishing this\\nguide, you\\u2019ll\", \" reap the benefits of a mature DevOps toolchain.\\nWho this guide is forYou should be an experienced A\", \"SP.NET Core developer (200-300 level). You don\\u2019t need to know\\nanything about Azure, as we\\u2019ll cover t\", \"hat in this introduction. This guide may also be useful for\\nDevOps engineers who are more focused on\", \" operations than development.\\nThis guide targets Windows developers. However, Linux and macOS are fu\", \"lly supported by .NET Core.\\nTo adapt this guide for Linux/macOS, watch for callouts for Linux/macOS \", \"differences.\\nWhat this guide doesn\\u2019t cover\\nThis guide is focused on an end-to-end continuous deploym\", \"ent experience for .NET developers. It\\u2019s\\nnot an exhaustive guide to all things Azure, and it doesn\\u2019t\", \" focus extensively on .NET APIs for Azure\\nservices. The emphasis is all around continuous integratio\", \"n, deployment, monitoring, and debugging.\\nNear the end of the guide, recommendations for next steps \", \"are offered. Included in the suggestions\\nare Azure platform services that are useful to ASP.NET Core\", \" developers.\\nWhat\\u2019s in this guide\\nTools and downloads\\nLearn where to acquire the tools used in this \", \"guide.\\nDeploy to App Service\\nLearn the various methods for deploying an ASP.NET Core app to Azure Ap\", \"p Service.\\nContinuous integration and deployment with Azure DevOps\\nBuild an end-to-end continuous in\", \"tegration and deployment solution for your ASP.NET Core app with\\nGitHub, Azure DevOps Services, and \", \"Azure.\\nContinuous integration and deployment with GitHub Actions\\nBuild an end-to-end continuous inte\", \"gration and deployment solution for your ASP.NET Core app with\\nGitHub, GitHub Actions, and Azure, in\", \"cluding code scanning for security and quality using CodeQL.\\nMonitor and debug\\nUse Azure\\u2019s tools to \", \"monitor, troubleshoot, and tune your application.\\nNext steps\\nOther learning paths for the ASP.NET Co\", \"re developer learning Azure.\\nAdditional introductory reading\\nIf this is your first exposure to cloud\", \" computing, these articles explain the basics.\\n\\u2022 What is Cloud Computing?\\n\\u2022 Examples of Cloud Comput\", \"ing\\u2022 What is IaaS?\\n\\u2022 What is PaaS?Contents\\nTools and downloads .....................................\", \"......................................................................... 1\\nPrerequisites ..........\", \"....................................................................................................\", \"................................................................ 1\\nRecommended tools (Windows only).\", \"....................................................................................................\", \"......................... 1\\nDeploy an app to App Service ...........................................\", \"..................................................... 3\\nDownload and test the app ..................\", \"....................................................................................................\", \"........................... 3\\nCreate the Azure App Service Web App .................................\", \"........................................................................................ 5\\nDeploymen\", \"t with Visual Studio ...............................................................................\", \"........................................................... 6\\nDeployment slots .....................\", \"....................................................................................................\", \"............................................ 8\\nSummary .............................................\", \"....................................................................................................\", \"................................. 10\\nAdditional reading ............................................\", \"....................................................................................................\", \"................ 10\\nContinuous integration and deployment with Azure DevOps ........................\", \"................. 11\\nPublish the app\\u2019s code to GitHub ..............................................\", \".................................................................................... 12\\nDisconnect l\", \"ocal Git deployment ................................................................................\", \"................................................... 12\\nCreate an Azure DevOps organization .........\", \"....................................................................................................\", \"............ 13\\nCreate a team project in Azure DevOps organization .................................\", \".......................................................... 13\\nConfigure a self-hosted agent if neces\", \"sary ...............................................................................................\", \"................. 13\\nConfigure the Azure Pipelines pipeline ........................................\", \"................................................................................ 14\\nGrant Azure DevO\", \"ps access to the GitHub repository .................................................................\", \"..................... 14\\nCreate the build definition ...............................................\", \"............................................................................................ 16\\nCrea\", \"te the release pipeline ............................................................................\", \"............................................................... 18\\nCommit changes to GitHub and auto\", \"matically deploy to Azure ....................................................................... 22\", \"\\nExamine the Azure Pipelines pipeline ..............................................................\", \"............................................................. 23\\nBuild definition ..................\", \"....................................................................................................\", \"............................................ 23\\nRelease pipeline ...................................\", \"....................................................................................................\", \"......................... 26\\nAdditional reading ....................................................\", \"....................................................................................................\", \"........ 29\\nContinuous integration and deployment with Azure DevOps ................................\", \"........................................... 30\\nPublish the app\\u2019s code to GitHub ....................\", \"....................................................................................................\", \"...... 30\\nDisconnect local Git deployment ..........................................................\", \"..................................................................... 31\\ni ContentsCreate an Azure D\", \"evOps organization .................................................................................\", \"................................... 31\\nCreate a team project in Azure DevOps organization ..........\", \"............................................................................. 32\\nConfigure a self-ho\", \"sted agent if necessary ............................................................................\", \"............................... 32\\nConfigure the Azure Pipelines pipeline ..........................\", \"......................................................................................... 32\\nCommit \", \"changes to GitHub and automatically deploy to Azure ................................................\", \".................. 40\\nExamine the Azure Pipelines pipeline .........................................\", \"............................................................................. 41\\nAdditional reading \", \"....................................................................................................\", \"....................................................... 47\\nContinuous integration and deployment wit\", \"h GitHub Actions .......................................................................... 48\\nGitHu\", \"b Actions ..........................................................................................\", \"........................................................................ 48\\nSecure code with CodeQL \", \"....................................................................................................\", \"........................................ 48\\nCompare and contrast GitHub Actions and Azure Pipelines \", \".......................................................................... 49\\nContinuous integration\", \" and deployment with GitHub Actions ................................................................\", \".......... 49\\nGitHub Actions .......................................................................\", \"........................................................................................... 49\\nSecur\", \"e code with CodeQL .................................................................................\", \"........................................................... 50\\nCompare and contrast GitHub Actions a\", \"nd Azure Pipelines .......................................................................... 50\\nCom\", \"pare and contrast GitHub Actions and Azure Pipelines ...............................................\", \"................................ 50\\nPipelines as code ..............................................\", \"....................................................................................................\", \"............ 50\\nAgents and runners .................................................................\", \"........................................................................................ 51\\nComparis\", \"on of GitHub Actions and Azure Pipelines ...........................................................\", \".............................. 52\\nBuild a .NET web app using GitHub Actions ........................\", \"...................................................................................... 55\\nWorkflow s\", \"tructure ...........................................................................................\", \"............................................................... 55\\nCreate a basic build workflow ...\", \"....................................................................................................\", \".............................. 56\\nDissect the workflow file ........................................\", \"....................................................................................................\", \"... 58\\nPublish the output ..........................................................................\", \"................................................................................. 59\\nDeploy a .NET w\", \"eb app using GitHub Actions ........................................................................\", \".................................. 61\\nEnvironments .................................................\", \"....................................................................................................\", \"................ 61\\nAzure authentication............................................................\", \"........................................................................................... 62\\nAdd e\", \"nvironments ........................................................................................\", \"................................................................... 63\\nDeploy to staging............\", \"....................................................................................................\", \"............................................. 65\\nDeploy to production ..............................\", \"....................................................................................................\", \"................... 68\\nAdd a manual queue option ...................................................\", \"..................................................................................... 70\\nHandle envi\", \"ronment configuration...............................................................................\", \"............................................ 71\\nii ContentsFinal workflow file .....................\", \"....................................................................................................\", \"................................... 73\\nSecure .NET Code with CodeQL and GitHub Actions .............\", \"................................................................................ 75\\nCreate the code \", \"scanning workflow ..................................................................................\", \"....................................... 76\\nCustomize CodeQL settings ...............................\", \"....................................................................................................\", \"...... 79\\nReview the security alerts ...............................................................\", \".............................................................................. 80\\nMonitor and debug \", \"....................................................................................................\", \"........... 83\\nBasic monitoring and troubleshooting ................................................\", \"........................................................................ 83\\nAdvanced monitoring ....\", \"....................................................................................................\", \"................................................. 84\\nProfile with Application Insights .............\", \"....................................................................................................\", \".................... 84\\nLogging ....................................................................\", \"....................................................................................................\", \"............. 87\\nLog streaming .....................................................................\", \"................................................................................................... \", \"87\\nAlerts ..........................................................................................\", \"................................................................................................ 88\\n\", \"Live debugging .....................................................................................\", \"................................................................................. 88\\nConclusion ....\", \"....................................................................................................\", \"....................................................................... 89\\nAdditional reading ......\", \"....................................................................................................\", \"...................................................... 89\\nNext steps ...............................\", \"............................................................................................... 90\\nS\", \"torage and databases ...............................................................................\", \"........................................................................ 90\\nIdentity ...............\", \"....................................................................................................\", \"................................................................... 90\\nMobile ......................\", \"....................................................................................................\", \"............................................................. 90\\nWeb infrastructure ................\", \"....................................................................................................\", \"............................................ 91\\niii Contents1\\nCHAPTER\\nTools and downloads\\nAzure has \", \"several interfaces for provisioning and managing resources, such as the Azure portal, Azure\\nCLI, Azu\", \"re PowerShell, Azure Cloud Shell, and Visual Studio. This guide takes a minimalist approach\\nand uses\", \" the Azure Cloud Shell whenever possible to reduce the steps required. However, the Azure\\nportal mus\", \"t be used for some portions.\\nPrerequisites\\nThe following subscriptions are required:\\n\\u2022 Azure \\u2014 If yo\", \"u don\\u2019t have an account, get a free trial.\\n\\u2022 Azure DevOps Services \\u2014 your Azure DevOps subscription \", \"and organization is created in\\nChapter 4.\\n\\u2022 GitHub \\u2014 If you don\\u2019t have an account, sign up for free.\", \"\\nThe following tools are required:\\n\\u2022 Git \\u2014 A fundamental understanding of Git is recommended for thi\", \"s guide. Review the Git\\ndocumentation, specifically git remote and git push.\\n\\u2022 .NET Core SDK \\u2014 Versi\", \"on 2.1.300 or later is required to build and run the sample app. If\\nVisual Studio is installed with \", \"the .NET Core cross-platform development workload, the\\n.NET Core SDK is already installed.\\nVerify yo\", \"ur .NET Core SDK installation. Open a command shell, and run the following\\ncommand:\\n:::{custom-style\", \"=CodeBox} dotnetcli dotnet --version :::\\nRecommended tools (Windows only)\\n\\u2022 Visual Studio\\u2019s robust A\", \"zure tools provide a GUI for most of the functionality described in this\\nguide. Any edition of Visua\", \"l Studio will work, including the free Visual Studio Community\\nEdition. The tutorials are written to\", \" demonstrate development, deployment, and DevOps both\\nwith and without Visual Studio.\\nConfirm that V\", \"isual Studio has the following workloads installed:\\n\\u2013 ASP.NET and web development\\n\\u2013 Azure developmen\", \"t\\n1 CHAPTER 1 | Tools and downloads\\u2013 .NET Core cross-platform development\\n2 CHAPTER 1 | Tools and do\", \"wnloads2\\nCHAPTER\\nDeploy an app to App\\nService\\nAzure App Service is Azure\\u2019s web hosting platform. Dep\", \"loying a web app to Azure App Service can be\\ndone manually or by an automated process. This section \", \"of the guide discusses deployment methods\\nthat can be triggered manually or by script using the comm\", \"and line, or triggered manually using\\nVisual Studio.\\nIn this section, you\\u2019ll accomplish the followin\", \"g tasks:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Download and build the sample app.\\n\\u2022 Create an Azure App Service\", \" Web App using the Azure Cloud Shell.\\n\\u2022 Deploy the sample app to Azure using Git.\\n\\u2022 Deploy a change \", \"to the app using Visual Studio.\\n\\u2022 Add a staging slot to the web app.\\n\\u2022 Deploy an update to the stagi\", \"ng slot.\\n\\u2022 Swap the staging and production slots.\\nDownload and test the app\\nThe app used in this gui\", \"de is a pre-built ASP.NET Core app, Simple Feed Reader. It\\u2019s an ASP.NET Core\\nRazor Pages app that us\", \"es the Microsoft.SyndicationFeed.ReaderWriter API to retrieve an RSS/Atom\\nfeed and display the news \", \"items in a list.\\nFeel free to review the code, but it\\u2019s important to understand that there\\u2019s nothing\", \" special about this\\napp. It\\u2019s just a simple ASP.NET Core app for illustrative purposes.\\nFrom a comma\", \"nd shell, download the code, build the project, and run it as follows.\\nNote\\nLinux and macOS users sh\", \"ould make appropriate changes for paths, for example, using forward slash\\n(/) rather than back slash\", \" (\\\\).*\\n1. Clone the code to a folder on your local machine.\\n3 CHAPTER 2 | Deploy an app to App Servi\", \"ce:::{custom-style=CodeBox} console git clone https://github.com/dotnet-architecture/simple-\\nfeed-re\", \"ader/ :::\\n2. Change your working folder to the simple-feed-reader folder that was created.\\n:::{custo\", \"m-style=CodeBox} console cd .\\\\simple-feed-reader\\\\SimpleFeedReader :::\\n3. Restore the packages, and b\", \"uild the solution.\\n:::{custom-style=CodeBox} dotnetcli dotnet build :::\\n4. Run the app.\\n:::{custom-s\", \"tyle=CodeBox} dotnetcli dotnet run :::\\n5. Open a browser and navigate to http://localhost:5000. The \", \"app allows you to type or paste a\\nsyndication feed URL and view a list of news items.\\n4 CHAPTER 2 | \", \"Deploy an app to App Service6. Once you\\u2019re satisfied the app is working correctly, shut it down by p\", \"ressing Ctrl+C in the\\ncommand shell.\\nCreate the Azure App Service Web App\\nTo deploy the app, you\\u2019ll \", \"need to create an App Service Web App. After creation of the Web App,\\nyou\\u2019ll deploy to it from your \", \"local machine using Git.\\n1. Sign in to the Azure Cloud Shell. Note: When you sign in for the first t\", \"ime, Cloud Shell\\nprompts to create a storage account for configuration files. Accept the defaults or\", \" provide a\\nunique name.\\n2. Use the Cloud Shell for the following steps.\\na. Declare a variable to sto\", \"re your web app\\u2019s name. The name must be unique to be\\nused in the default URL. Using the $RANDOM Bas\", \"h function to construct the name\\nguarantees uniqueness and results in the format webappname99999.\\n::\", \":{custom-style=CodeBox} console webappname=mywebapp$RANDOM :::\\nb. Create a resource group. Resource \", \"groups provide a means to aggregate Azure\\nresources to be managed as a group.\\n:::{custom-style=CodeB\", \"ox} azurecli az group create --location centralus --name AzureTutorial\\n:::\\nThe az command invokes th\", \"e Azure CLI. The CLI can be run locally, but using it in the Cloud\\nShell saves time and configuratio\", \"n.\\nc. Create an App Service plan in the S1 tier. An App Service plan is a grouping of web\\napps that \", \"share the same pricing tier. The S1 tier isn\\u2019t free, but it\\u2019s required for the\\nstaging slots feature\", \".\\n:::{custom-style=CodeBox} azurecli az appservice plan create --name $webappname --\\nresource-group \", \"AzureTutorial --sku S1 :::\\nd. Create the web app resource using the App Service plan in the same res\", \"ource group.\\n:::{custom-style=CodeBox} azurecli az webapp create --name $webappname --resource-\\ngrou\", \"p AzureTutorial --plan $webappname :::\\ne. Set the deployment branch to main in the appsettings confi\", \"guration.\\n:::{custom-style=CodeBox} azurecli az webapp config appsettings set --name $webappname -\\n-\", \"resource-group AzureTutorial --settings DEPLOYMENT_BRANCH=main :::\\nf. Set the deployment credentials\", \". These deployment credentials apply to all the web\\napps in your subscription. Don\\u2019t use special cha\", \"racters in the user name.\\n:::{custom-style=CodeBox} azurecli az webapp deployment user set --user-na\", \"me\\nREPLACE_WITH_USER_NAME --password REPLACE_WITH_PASSWORD :::\\n5 CHAPTER 2 | Deploy an app to App Se\", \"rviceg. Configure the web app to accept deployments from local Git and display the Git\\ndeployment UR\", \"L. Note this URL for reference later.\\n:::{custom-style=CodeBox} azurecli echo Git deployment URL: $(\", \"az webapp deployment\\nsource config-local-git --name $webappname --resource-group AzureTutorial --que\", \"ry url --\\noutput tsv) :::\\nh. Display the web app URL. Browse to this URL to see the blank web app. N\", \"ote this\\nURL for reference later.\\n:::{custom-style=CodeBox} console echo Web app URL:\\nhttp://$webapp\", \"name.azurewebsites.net :::\\n3. Using a command shell on your local machine, navigate to the web app\\u2019s\", \" project folder (for\\nexample, *.-feed-reader). Execute the following commands to set up Git to push \", \"to the\\ndeployment URL:\\na. Add the remote URL to the local repository.\\n:::{custom-style=CodeBox} cons\", \"ole git remote add azure-prod GIT_DEPLOYMENT_URL :::\\nb. Push the local default branch (main) to the \", \"azure-prod remote\\u2019s deployment branch\\n(main).\\n:::{custom-style=CodeBox} console git push azure-prod \", \"main :::\\nYou\\u2019ll be prompted for the deployment credentials you created earlier. Observe the output i\", \"n\\nthe command shell. Azure builds the ASP.NET Core app remotely.\\n4. In a browser, navigate to the We\", \"b app URL and note the app has been built and deployed.\\nAdditional changes can be committed to the l\", \"ocal Git repository with git commit. These\\nchanges are pushed to Azure with the preceding git push c\", \"ommand.\\nDeployment with Visual Studio\\nNote\\nThis section applies to Windows only. Linux and macOS use\", \"rs should make the change described in\\nstep 2 below. Save the file, and commit the change to the loc\", \"al repository with git commit. Finally,\\npush the change with git push, as in the first section.*\\nThe\", \" app has already been deployed from the command shell. Let\\u2019s use Visual Studio\\u2019s integrated tools\\nto\", \" deploy an update to the app. Behind the scenes, Visual Studio accomplishes the same thing as the\\nco\", \"mmand line tooling, but within Visual Studio\\u2019s familiar UI.\\n1. Open SimpleFeedReader.sln in Visual S\", \"tudio.\\n2. In Solution Explorer, open Pages.cshtml. Change <h2>Simple Feed Reader</h2> to\\n<h2>Simple \", \"Feed Reader - V2</h2>.\\n3. Press Ctrl+Shift+B to build the app.\\n4. In Solution Explorer, right-click \", \"on the project and click Publish.\\n6 CHAPTER 2 | Deploy an app to App Service5. Visual Studio can cre\", \"ate a new App Service resource, but this update will be published over\\nthe existing deployment. In t\", \"he Pick a publish target dialog, select App Service from the list\\non the left, and then select Selec\", \"t Existing. Click Publish.\\n6. In the App Service dialog, confirm that the Microsoft or Organizationa\", \"l account used to\\ncreate your Azure subscription is displayed in the upper right. If it\\u2019s not, click\", \" the drop-down\\nand add it.\\n7. Confirm that the correct Azure Subscription is selected. For View, sel\", \"ect Resource Group.\\nExpand the AzureTutorial resource group and then select the existing web app. Cl\", \"ick OK.\\nVisual Studio builds and deploys the app to Azure. Browse to the web app URL. Validate that \", \"the\\n<h2> element modification is live.\\n7 CHAPTER 2 | Deploy an app to App ServiceDeployment slots\\nDe\", \"ployment slots support the staging of changes without impacting the app running in production.\\nOnce \", \"the staged version of the app is validated by a quality assurance team, the production and\\nstaging s\", \"lots can be swapped. The app in staging is promoted to production in this manner. The\\nfollowing step\", \"s create a staging slot, deploy some changes to it, and swap the staging slot with\\nproduction after \", \"verification.\\n1. Sign in to the Azure Cloud Shell, if not already signed in.\\n2. Create the staging s\", \"lot.\\na. Create a deployment slot with the name staging.\\n:::{custom-style=CodeBox} azurecli az webapp\", \" deployment slot create --name $webappname\\n--resource-group AzureTutorial --slot staging :::\\nb. Set \", \"the deployment branch to main in the appsettings configuration.\\n:::{custom-style=CodeBox} azurecli a\", \"z webapp config appsettings set --name $webappname -\\n-resource-group AzureTutorial --slot staging --\", \"settings DEPLOYMENT_BRANCH=main :::\\nc. Configure the staging slot to use deployment from local Git a\", \"nd get the staging\\ndeployment URL. Note this URL for reference later.\\n:::{custom-style=CodeBox} azur\", \"ecli echo Git deployment URL for staging: $(az webapp\\ndeployment source config-local-git --name $web\", \"appname --resource-group AzureTutorial --\\nslot staging --query url --output tsv) :::\\nd. Display the \", \"staging slot\\u2019s URL. Browse to the URL to see the empty staging slot. Note\\nthis URL for reference lat\", \"er.\\n8 CHAPTER 2 | Deploy an app to App Service:::{custom-style=CodeBox} console echo Staging web app\", \" URL: http://$webappname-\\nstaging.azurewebsites.net :::\\n3. In a text editor or Visual Studio, modify\", \" Pages/Index.cshtml again so that the <h2> element\\nreads <h2>Simple Feed Reader - V3</h2> and save t\", \"he file.\\n4. Commit the file to the local Git repository, using either the Changes page in Visual Stu\", \"dio\\u2019s\\nTeam Explorer tab, or by entering the following using the local machine\\u2019s command shell:\\n:::{c\", \"ustom-style=CodeBox} console git commit -a -m \\\"upgraded to V3\\\" :::\\n5. Using the local machine\\u2019s comm\", \"and shell, add the staging deployment URL as a Git remote\\nand push the committed changes:\\na. Add the\", \" remote URL for staging to the local Git repository.\\n:::{custom-style=CodeBox} console git remote ad\", \"d azure-staging\\n<Git_staging_deployment_URL> :::\\nb. Push the local default branch (main) to the azur\", \"e-staging remote\\u2019s deployment\\nbranch (main).\\n:::{custom-style=CodeBox} console git push azure-stagin\", \"g main :::\\nWait while Azure builds and deploys the app.\\n6. To verify that V3 has been deployed to th\", \"e staging slot, open two browser windows. In one\\nwindow, navigate to the original web app URL. In th\", \"e other window, navigate to the staging\\nweb app URL. The production URL serves V2 of the app. The st\", \"aging URL serves V3 of the\\napp.\\n7. In the Cloud Shell, swap the verified/warmed-up staging slot into\", \" production.\\n9 CHAPTER 2 | Deploy an app to App Service:::{custom-style=CodeBox} azurecli az webapp \", \"deployment slot swap --name $webappname -\\n-resource-group AzureTutorial --slot staging :::\\n8. Verify\", \" that the swap occurred by refreshing the two browser windows.\\nSummary\\nIn this section, the followin\", \"g tasks were completed:\\n\\u2022 Downloaded and built the sample app.\\n\\u2022 Created an Azure App Service Web Ap\", \"p using the Azure Cloud Shell.\\n\\u2022 Deployed the sample app to Azure using Git.\\n\\u2022 Deployed a change to \", \"the app using Visual Studio.\\n\\u2022 Added a staging slot to the web app.\\n\\u2022 Deployed an update to the stag\", \"ing slot.\\n\\u2022 Swapped the staging and production slots.\\nIn the next section, you\\u2019ll learn how to build\", \" a DevOps pipeline with Azure Pipelines.\\nAdditional reading\\n\\u2022 Web Apps overview\\n\\u2022 Build a .NET Core \", \"and SQL Database web app in Azure App Service\\n\\u2022 Configure deployment credentials for Azure App Servi\", \"ce\\n\\u2022 Set up staging environments in Azure App Service\\n10 CHAPTER 2 | Deploy an app to App Service3\\nC\", \"HAPTER\\nContinuous integration\\nand deployment with\\nAzure DevOps\\nNote\\nThis section details continuous \", \"integration and deployment with Azure DevOps. You can achieve that\\nwith GitHub Actions as well. GitH\", \"ub Actions is a workflow engine built into GitHub that can also be\\nused for continuous integration a\", \"nd deployment. To follow the guide for building and deploying to\\nAzure using GitHub, complete the Pu\", \"blish the app\\u2019s code to GitHub and Disconnect local Git\\ndeployment sections below and then proceed t\", \"o the GitHub Actions section.\\nIn the previous chapter, you created a local Git repository for the Si\", \"mple Feed Reader app. In this\\nchapter, you\\u2019ll publish that code to a GitHub repository and construct\", \" an Azure DevOps Services\\npipeline using Azure Pipelines. The pipeline enables continuous builds and\", \" deployments of the app.\\nAny commit to the GitHub repository triggers a build and a deployment to th\", \"e Azure Web App\\u2019s\\nstaging slot.\\nIn this section, you\\u2019ll complete the following tasks:\\n[!div class=\\u201cc\", \"hecklist\\u201d]\\n\\u2022 Publish the app\\u2019s code to GitHub\\n\\u2022 Disconnect local Git deployment\\n\\u2022 Create an Azure De\", \"vOps organization\\n\\u2022 Create a team project in Azure DevOps organization\\n\\u2022 Configure a self-hosted age\", \"nt if necessary\\n\\u2022 Create a build definition\\n\\u2022 Create a release pipeline\\n\\u2022 Commit changes to GitHub a\", \"nd automatically deploy to Azure\\n\\u2022 Examine the Azure Pipelines pipeline\\n11 CHAPTER 3 | Continuous in\", \"tegration and deployment with Azure DevOpsPublish the app\\u2019s code to GitHub\\n1. Open a browser window,\", \" and navigate to https://github.com.\\n2. Click the + drop-down in the header, and select New reposito\", \"ry:\\n1. Select your account in the Owner drop-down, and enter simple-feed-reader in the Repository\\nna\", \"me textbox.\\n2. Click the Create repository button.\\n3. Open your local machine\\u2019s command shell. Navig\", \"ate to the directory in which the simple-feed-\\nreader Git repository is stored.\\n4. Rename the existi\", \"ng origin remote to upstream. Execute the following command:\\n:::{custom-style=CodeBox} console git r\", \"emote rename origin upstream :::\\n5. Add a new origin remote pointing to your copy of the repository \", \"on GitHub. Execute the\\nfollowing command:\\n:::{custom-style=CodeBox} console git remote add origin\\nht\", \"tps://github.com/<GitHub_username>/simple-feed-reader/ :::\\n6. Publish your local Git repository to t\", \"he newly created GitHub repository. Execute the following\\ncommand:\\n:::{custom-style=CodeBox} console\", \" git push -u origin main :::\\n7. Open a browser window, and navigate to https://github.com/<GitHub_us\", \"ername>/simple-\\nfeed-reader/. Validate that your code appears in the GitHub repository.\\nDisconnect l\", \"ocal Git deployment\\nRemove the local Git deployment with the following steps. Azure Pipelines (an Az\", \"ure DevOps service)\\nboth replaces and augments that functionality.\\n1. Open the Azure portal, and nav\", \"igate to the staging (mywebapp<unique_number>/staging)\\nWeb App. The Web App can be quickly located b\", \"y entering staging in the portal\\u2019s search box:\\n12 CHAPTER 3 | Continuous integration and deployment \", \"with Azure DevOpsClick Deployment Center. A new panel appears. Click Disconnect to remove the local \", \"Git\\nsource control configuration that was added in the previous chapter. Confirm the\\nremoval operati\", \"on by clicking the Yes button.\\n1. Navigate to the mywebapp App Service. As a reminder, the portal\\u2019s \", \"search box can be used to\\nquickly locate the App Service.\\n2. Click Deployment Center. A new panel ap\", \"pears. Click Disconnect to remove the local Git\\nsource control configuration that was added in the p\", \"revious chapter. Confirm the removal\\noperation by clicking the Yes button.\\nCreate an Azure DevOps or\", \"ganization\\n1. Open a browser, and navigate to the Azure DevOps organization creation page.\\n2. Select\", \" New organization\\n3. Confirm the information, and then select Continue.\\n4. Sign in to your organizat\", \"ion at any time, https://dev.azure.com/{yourorganization}\\nCreate a team project in Azure DevOps orga\", \"nization\\n1. Choose the organization, and then select New project.\\n2. Enter the project name as MyFir\", \"stProject and select the Visibility as Private\\n3. Select Create project.\\nFor more information, see C\", \"reate a project\\nConfigure a self-hosted agent if necessary\\nTo build your code or deploy your softwar\", \"e using Azure Pipelines, you need at least one agent. In\\nAzure Pipelines, you can run parallel jobs \", \"on either Microsoft-hosted or self-hosted agent. But with\\nthe recent change in Azure Pipelines free \", \"grant of parallel jobs is temporarily disable for the public\\nprojects.For more details, refer Config\", \"ure and pay for parallel jobs.\\nGo to Organization Settings and then Pipelines > Parallel jobs. If yo\", \"u see value 0 under Microsoft-\\nhosted that means you need a Self-hosted agent to run your pipeline.\\n\", \"13 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsYou can create that by followi\", \"ng details mentioned in Self-hosted agents. After successful\\nconfiguration, you\\u2019ll be able to see av\", \"ailable agent under Organization Settings > Agent pools >\\n{youragentname}\\nConfigure the Azure Pipeli\", \"nes pipeline\\nThere are three distinct steps to complete. Completing the steps in the following three\", \" sections results\\nin an operational DevOps pipeline.\\nGrant Azure DevOps access to the GitHub reposit\", \"ory\\n1. In your project, navigate to the Pipelines page. Then choose the action to create a new\\npipel\", \"ine:\\n14 CHAPTER 3 | Continuous integration and deployment with Azure DevOps1. Use Use the classic ed\", \"itor to create the pipeline.\\n1. Select the GitHub option from the Select a source section::\\n1. Autho\", \"rization is required before Azure DevOps can access your GitHub repository. Enter\\nGitHub connection \", \"in the Connection name textbox. For example:\\n1. If two-factor authentication is enabled on your GitH\", \"ub account, a personal access token is\\nrequired. In that case, click the Authorize with a GitHub per\", \"sonal access token link. See the\\nofficial GitHub personal access token creation instructions for hel\", \"p. Only the repo scope of\\npermissions is needed. Otherwise, click the Authorize using OAuth button.\\n\", \"15 CHAPTER 3 | Continuous integration and deployment with Azure DevOps2. When prompted, sign in to y\", \"our GitHub account. Then select Authorize to grant access to\\nyour Azure DevOps organization. If succ\", \"essful, a new service endpoint is created.\\n3. Click the ellipsis button next to the Repository butto\", \"n. Select the /simple-feed-reader\\nrepository from the list. Click the Select button.\\n4. Select the d\", \"efault branch (main) from the Default branch for manual and scheduled builds\\ndrop-down. Click the Co\", \"ntinue button. The template selection page appears.\\nCreate the build definition\\n1. From the template\", \" selection page, enter ASP.NET Core in the search box:\\n1. The template search results appear. Hover \", \"over the ASP.NET Core template, and click the\\nApply button.\\n2. The Tasks tab of the build definition\", \" appears. Select the self-hosted Agent pool if you have\\ncreated that in the earlier step.\\n> [!NOTE]\\n\", \"> If you are using MS-hosted agent then select the *Hosted > Azure Pipelines* from\\ndrop down.\\n16 CHA\", \"PTER 3 | Continuous integration and deployment with Azure DevOps1. Click the Triggers tab.\\n2. Check \", \"the Enable continuous integration box. Under the Branch filters section, confirm\\nthat the Type drop-\", \"down is set to Include. Set the Branch specification drop-down to main.\\nThese settings cause a build\", \" to trigger when any change is pushed to the default\\nbranch (*main*) of the GitHub repository. Conti\", \"nuous integration is tested in the\\n[Commit changes to GitHub and automatically deploy to Azure](#com\", \"mit-changes-to-\\ngithub-and-automatical) section.\\n1. Click the Save & queue button, and select the Sa\", \"ve option:\\n1. The following modal dialog appears:\\nUse the default folder of *\\\\\\\\*, and click the **Sa\", \"ve** button.\\n17 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsCreate the releas\", \"e pipeline\\n1. Click the Releases tab of your team project. Click the New pipeline button.\\nThe templa\", \"te selection pane appears.\\n1. From the template selection page, enter App Service Deployment in the \", \"search box:\\n1. The template search results appear. Hover over the Azure App Service Deployment with\\n\", \"Slot template, and click the Apply button. The Pipeline tab of the release pipeline appears.\\n18 CHAP\", \"TER 3 | Continuous integration and deployment with Azure DevOps1. Click the Add button in the Artifa\", \"cts box. The Add artifact panel appears:\\n1. Select the Build tile from the Source type section. This\", \" type allows for the linking of the\\nrelease pipeline to the build definition.\\n2. Select MyFirstProje\", \"ct from the Project drop-down.\\n3. Select the build definition name, MyFirstProject-ASP.NET Core-CI, \", \"from the Source (Build\\ndefinition) drop-down.\\n4. Select Latest from the Default version drop-down. T\", \"his option builds the artifacts produced\\nby the latest run of the build definition.\\n19 CHAPTER 3 | C\", \"ontinuous integration and deployment with Azure DevOps5. Replace the text in the Source alias textbo\", \"x with Drop.\\n6. Click the Add button. The Artifacts section updates to display the changes.\\n7. Click\", \" the lightning bolt icon to enable continuous deployments:\\nWith this option enabled, a deployment oc\", \"curs each time a new build is available.\\n1. A Continuous deployment trigger panel appears to the rig\", \"ht. Click the toggle button to\\nenable the feature. It isn\\u2019t necessary to enable the Pull request tri\", \"gger.\\n2. Click the Add drop-down in the Build branch filters section. Choose the Build Definition\\u2019s\\n\", \"default branch option. This filter causes the release to trigger only for a build from the\\nGitHub re\", \"pository\\u2019s default branch (main).\\n3. Click the Save button. Click the OK button in the resulting Sav\", \"e modal dialog.\\n4. Click the Stage 1 box. An Stage panel appears to the right. Change the Stage 1 te\", \"xt in the\\nStage name textbox to Production.\\n1. Click the 1 phase, 2 tasks link in the Production box\", \":\\n20 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsThe **Tasks** tab of the env\", \"ironment appears.\\n1. Click the Deploy Azure App Service to Slot task. Its settings appear in a panel\", \" to the right.\\n2. Select the Azure subscription associated with the App Service from the Azure subsc\", \"ription\\ndrop-down. Once selected, click the Authorize button.\\n3. Select Web App from the App type dr\", \"op-down.\\n4. Select mywebapp/ from the App service name drop-down.\\n5. Select AzureTutorial from the R\", \"esource group drop-down.\\n6. Select staging from the Slot drop-down.\\n7. Select Run on agent* under Ta\", \"sks. On the right pane, you\\u2019ll see Agent Job.\\n8. Select the self-hosted Agent pool if you have creat\", \"ed that in the earlier step.\\n> [!NOTE]\\n> If you are using MS-hosted agent then select the *Hosted > \", \"Azure Pipelines* from\\ndrop down.\\n1. Click the Save button.\\n2. Hover over the default release pipelin\", \"e name. Click the pencil icon to edit it. Use\\nMyFirstProject-ASP.NET Core-CD as the name.\\n21 CHAPTER\", \" 3 | Continuous integration and deployment with Azure DevOps1. Click the Save button.\\nCommit changes\", \" to GitHub and automatically\\ndeploy to Azure\\n1. Open SimpleFeedReader.sln in Visual Studio.\\n2. In So\", \"lution Explorer, open Pages.cshtml. Change <h2>Simple Feed Reader - V3</h2> to\\n<h2>Simple Feed Reade\", \"r - V4</h2>.\\n3. Press Ctrl+Shift+B to build the app.\\n4. Commit the file to the GitHub repository. Us\", \"e either the Changes page in Visual Studio\\u2019s\\nTeam Explorer tab, or execute the following using the l\", \"ocal machine\\u2019s command shell:\\n:::{custom-style=CodeBox} console git commit -a -m \\\"upgraded to V4\\\" ::\", \":\\n5. Push the change in the default branch (main) to the origin remote of your GitHub repository.\\nIn\", \" the following command, replace the placeholder {BRANCH} with the default branch (use\\nmain):\\n:::{cus\", \"tom-style=CodeBox} console git push origin {BRANCH} :::\\nThe commit appears in the GitHub repository\\u2019\", \"s default branch (main). You\\u2019ll be able to see the\\ncommit history in https://github.com/<GitHub_user\", \"name>/simple-feed-\\nreader/commits/main.\\nThe build is triggered, since continuous integration is enab\", \"led in the build definition\\u2019s\\nTriggers tab:\\n22 CHAPTER 3 | Continuous integration and deployment wit\", \"h Azure DevOps1. Navigate to the Pipelines. You\\u2019ll see the CI pipeline details and monitor each step\", \"s if you drill\\ndown Jobs details.\\n1. Similarly, go to the Releases tab to see the details of CD pipe\", \"line. You can always drill down\\nfurther to see more details of each step.\\n1. Once the build succeeds\", \", a deployment to Azure occurs. Navigate to the app in the browser.\\nNotice that the \\u201cV4\\u201d text appear\", \"s in the heading:\\nExamine the Azure Pipelines pipeline\\nBuild definition\\nA build definition was creat\", \"ed with the name MyFirstProject-ASP.NET Core-CI. Upon completion, the\\nbuild produces a .zip file inc\", \"luding the assets to be published. The release pipeline deploys those\\nassets to Azure.\\nThe build def\", \"inition\\u2019s Tasks tab lists the individual steps being used. There are five build tasks.\\n23 CHAPTER 3 \", \"| Continuous integration and deployment with Azure DevOps1. Restore \\u2014 Executes the dotnet restore co\", \"mmand to restore the app\\u2019s NuGet packages. The\\ndefault package feed used is nuget.org.\\n2. Build \\u2014 Ex\", \"ecutes the dotnet build --configuration release command to compile the app\\u2019s\\ncode. This --configurat\", \"ion option is used to produce an optimized version of the code, which\\nis suitable for deployment to \", \"a production environment. Modify the BuildConfiguration\\nvariable on the build definition\\u2019s Variables\", \" tab if, for example, a debug configuration is\\nneeded.\\n3. Test \\u2014 Executes the dotnet test --configur\", \"ation release --logger trx --results-directory\\n<local_path_on_build_agent> command to run the app\\u2019s \", \"unit tests. Unit tests are executed\\nwithin any C# project matching the **/Tests/.csproj glob pattern\", \". Test results are saved in a .trx\\nfile at the location specified by the --results-directory option.\", \" If any tests fail, the build fails\\nand isn\\u2019t deployed.\\n24 CHAPTER 3 | Continuous integration and de\", \"ployment with Azure DevOps[!NOTE] To verify the unit tests work, modify SimpleFeedReader.Tests.cs to\", \" purposefully break\\none of the tests. For example, change Assert.True(result.Count > 0); to\\nAssert.F\", \"alse(result.Count > 0); in the Returns_News_Stories_Given_Valid_Uri method. Commit\\nand push the chan\", \"ge to GitHub. The build is triggered and fails. The build pipeline status\\nchanges to failed. Revert \", \"the change, commit, and push again. The build succeeds.\\n4. Publish \\u2014 Executes the dotnet publish --c\", \"onfiguration release --output\\n<local_path_on_build_agent> command to produce a .zip file with the ar\", \"tifacts to be\\ndeployed. The --output option specifies the publish location of the .zip file. That lo\", \"cation is\\nspecified by passing a predefined variable named $(build.artifactstagingdirectory). That\\nv\", \"ariable expands to a local path, such as *c:_work\\\\1, on the build agent.\\n5. Publish Artifact \\u2014 Publi\", \"shes the .zip file produced by the Publish task. The task accepts the\\n.zip file location as a parame\", \"ter, which is the predefined variable\\n$(build.artifactstagingdirectory). The .zip file is published \", \"as a folder named drop.\\nClick the build definition\\u2019s Summary link to view a history of builds with t\", \"he definition:\\nOn the resulting page, click the individual build for more details.\\nA summary of this\", \" specific build is displayed. Click the published link, and notice the drop folder\\nproduced by the b\", \"uild is listed:\\n25 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsUse the ellips\", \"is and click on Downloads artifacts links to inspect the published artifacts.\\nRelease pipeline\\nA rel\", \"ease pipeline was created with the name MyFirstProject-ASP.NET Core-CD:\\nThe two major components of \", \"the release pipeline are the Artifacts and the Stages. Clicking the box\\nin the Artifacts section rev\", \"eals the following panel:\\n26 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsThe \", \"Source (Build definition) value represents the build definition to which this release pipeline is\\nli\", \"nked. The .zip file produced by a successful run of the build definition is provided to the Producti\", \"on\\nenvironment for deployment to Azure. Click the 1 phase, 2 tasks link in the Production environmen\", \"t\\nbox to view the release pipeline tasks:\\nThe release pipeline consists of two tasks: Deploy Azure A\", \"pp Service to Slot and Manage Azure App\\nService - Slot Swap. Clicking the first task reveals the fol\", \"lowing task configuration:\\n27 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsThe\", \" Azure subscription, service type, web app name, resource group, and deployment slot are defined\\nin \", \"the deployment task. The Package or folder textbox holds the .zip file path to be extracted and\\ndepl\", \"oyed to the staging slot of the mywebapp<unique_number> web app.\\nClicking the slot swap task reveals\", \" the following task configuration:\\n28 CHAPTER 3 | Continuous integration and deployment with Azure D\", \"evOpsThe subscription, resource group, service type, web app name, and deployment slot details are\\np\", \"rovided. The Swap with Production check box is checked. Consequently, the bits deployed to the\\nstagi\", \"ng slot are swapped into the production environment.\\nAdditional reading\\n\\u2022 Create your first pipeline\", \" with Azure Pipelines\\n\\u2022 Build and .NET Core project\\n\\u2022 Deploy a web app with Azure Pipelines\\n29 CHAPT\", \"ER 3 | Continuous integration and deployment with Azure DevOpsContinuous integration and deployment \", \"with Azure\\nDevOps\\nNote\\nThis section details continuous integration and deployment with Azure DevOps.\", \" You can achieve that\\nwith GitHub Actions as well. GitHub Actions is a workflow engine built into Gi\", \"tHub that can also be\\nused for continuous integration and deployment. To follow the guide for buildi\", \"ng and deploying to\\nAzure using GitHub, complete the Publish the app\\u2019s code to GitHub and Disconnect\", \" local Git\\ndeployment sections below and then proceed to the GitHub Actions section.\\nIn the previous\", \" chapter, you created a local Git repository for the Simple Feed Reader app. In this\\nchapter, you\\u2019ll\", \" publish that code to a GitHub repository and construct an Azure DevOps Services\\npipeline using Azur\", \"e Pipelines. The pipeline enables continuous builds and deployments of the app.\\nAny commit to the Gi\", \"tHub repository triggers a build and a deployment to the Azure Web App\\u2019s\\nstaging slot.\\nIn this secti\", \"on, you\\u2019ll complete the following tasks:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Publish the app\\u2019s code to GitHub\", \"\\n\\u2022 Disconnect local Git deployment\\n\\u2022 Create an Azure DevOps organization\\n\\u2022 Create a team project in \", \"Azure DevOps organization\\n\\u2022 Configure a self-hosted agent if necessary\\n\\u2022 Create a build definition\\n\\u2022\", \" Create a release pipeline\\n\\u2022 Commit changes to GitHub and automatically deploy to Azure\\n\\u2022 Examine th\", \"e Azure Pipelines pipeline\\nPublish the app\\u2019s code to GitHub\\n1. Open a browser window, and navigate t\", \"o https://github.com.\\n2. Click the + drop-down in the header, and select New repository:\\n30 CHAPTER \", \"3 | Continuous integration and deployment with Azure DevOps1. Select your account in the Owner drop-\", \"down, and enter simple-feed-reader in the Repository\\nname textbox.\\n2. Click the Create repository bu\", \"tton.\\n3. Open your local machine\\u2019s command shell. Navigate to the directory in which the simple-feed\", \"-\\nreader Git repository is stored.\\n4. Rename the existing origin remote to upstream. Execute the fol\", \"lowing command:\\n:::{custom-style=CodeBox} console git remote rename origin upstream :::\\n5. Add a new\", \" origin remote pointing to your copy of the repository on GitHub. Execute the\\nfollowing command:\\n:::\", \"{custom-style=CodeBox} console git remote add origin\\nhttps://github.com/<GitHub_username>/simple-fee\", \"d-reader/ :::\\n6. Publish your local Git repository to the newly created GitHub repository. Execute t\", \"he following\\ncommand:\\n:::{custom-style=CodeBox} console git push -u origin main :::\\n7. Open a browse\", \"r window, and navigate to https://github.com/<GitHub_username>/simple-\\nfeed-reader/. Validate that y\", \"our code appears in the GitHub repository.\\nDisconnect local Git deployment\\nRemove the local Git depl\", \"oyment with the following steps. Azure Pipelines (an Azure DevOps service)\\nboth replaces and augment\", \"s that functionality.\\n1. Open the Azure portal, and navigate to the staging (mywebapp<unique_number>\", \"/staging)\\nWeb App. The Web App can be quickly located by entering staging in the portal\\u2019s search box\", \":\\n1. Click Deployment Center. A new panel appears. Click Disconnect to remove the local Git\\nsource c\", \"ontrol configuration that was added in the previous chapter. Confirm the removal\\noperation by clicki\", \"ng the Yes button.\\n2. Navigate to the mywebapp App Service. As a reminder, the portal\\u2019s search box c\", \"an be used to\\nquickly locate the App Service.\\n3. Click Deployment Center. A new panel appears. Click\", \" Disconnect to remove the local Git\\nsource control configuration that was added in the previous chap\", \"ter. Confirm the removal\\noperation by clicking the Yes button.\\nCreate an Azure DevOps organization\\n1\", \". Open a browser, and navigate to the Azure DevOps organization creation page.\\n2. Select New organiz\", \"ation\\n3. Confirm the information, and then select Continue.\\n31 CHAPTER 3 | Continuous integration an\", \"d deployment with Azure DevOps4. Sign in to your organization at any time, https://dev.azure.com/{yo\", \"urorganization}\\nCreate a team project in Azure DevOps organization\\n1. Choose the organization, and t\", \"hen select New project.\\n2. Enter the project name as MyFirstProject and select the Visibility as Pri\", \"vate\\n3. Select Create project.\\nFor more information, see Create a project\\nConfigure a self-hosted ag\", \"ent if necessary\\nTo build your code or deploy your software using Azure Pipelines, you need at least\", \" one agent. In\\nAzure Pipelines, you can run parallel jobs on either Microsoft-hosted or self-hosted \", \"agent. But with\\nthe recent change in Azure Pipelines free grant of parallel jobs is temporarily disa\", \"ble for the public\\nprojects.For more details, refer Configure and pay for parallel jobs.\\nGo to Organ\", \"ization Settings and then Pipelines > Parallel jobs. If you see value 0 under Microsoft-\\nhosted that\", \" means you need a Self-hosted agent to run your pipeline.\\nYou can create that by following details m\", \"entioned in Self-hosted agents. After successful\\nconfiguration, you\\u2019ll be able to see available agen\", \"t under Organization Settings > Agent pools >\\n{youragentname}\\nConfigure the Azure Pipelines pipeline\", \"\\nThere are three distinct steps to complete. Completing the steps in the following three sections re\", \"sults\\nin an operational DevOps pipeline.\\n32 CHAPTER 3 | Continuous integration and deployment with A\", \"zure DevOpsGrant Azure DevOps access to the GitHub repository\\n1. In your project, navigate to the Pi\", \"pelines page. Then choose the action to create a new\\npipeline:\\n1. Use Use the classic editor to crea\", \"te the pipeline.\\n1. Select the GitHub option from the Select a source section::\\n1. Authorization is \", \"required before Azure DevOps can access your GitHub repository. Enter\\nGitHub connection in the Conne\", \"ction name textbox. For example:\\n33 CHAPTER 3 | Continuous integration and deployment with Azure Dev\", \"Ops1. If two-factor authentication is enabled on your GitHub account, a personal access token is\\nreq\", \"uired. In that case, click the Authorize with a GitHub personal access token link. See the\\nofficial \", \"GitHub personal access token creation instructions for help. Only the repo scope of\\npermissions is n\", \"eeded. Otherwise, click the Authorize using OAuth button.\\n2. When prompted, sign in to your GitHub a\", \"ccount. Then select Authorize to grant access to\\nyour Azure DevOps organization. If successful, a ne\", \"w service endpoint is created.\\n3. Click the ellipsis button next to the Repository button. Select th\", \"e /simple-feed-reader\\nrepository from the list. Click the Select button.\\n4. Select the default branc\", \"h (main) from the Default branch for manual and scheduled builds\\ndrop-down. Click the Continue butto\", \"n. The template selection page appears.\\nCreate the build definition\\n1. From the template selection p\", \"age, enter ASP.NET Core in the search box:\\nThe template search results appear. Hover over the ASP.NE\", \"T Core template, and click\\nthe Apply button.\\n1. The Tasks tab of the build definition appears. Selec\", \"t the self-hosted Agent pool if you have\\ncreated that in the earlier step.\\n34 CHAPTER 3 | Continuous\", \" integration and deployment with Azure DevOps> [!NOTE]\\n> If you are using MS-hosted agent then selec\", \"t the *Hosted > Azure Pipelines* from\\ndrop down.\\n1. Click the Triggers tab.\\n2. Check the Enable cont\", \"inuous integration box. Under the Branch filters section, confirm\\nthat the Type drop-down is set to \", \"Include. Set the Branch specification drop-down to main.\\nThese settings cause a build to trigger whe\", \"n any change is pushed to the default\\nbranch (*main*) of the GitHub repository. Continuous integrati\", \"on is tested in the\\n[Commit changes to GitHub and automatically deploy to Azure](#commit-changes-to-\", \"\\ngithub-and-automatical) section.\\n1. Click the Save & queue button, and select the Save option:\\n35 C\", \"HAPTER 3 | Continuous integration and deployment with Azure DevOps1. The following modal dialog appe\", \"ars:\\nUse the default folder of *\\\\\\\\*, and click the **Save** button.\\nCreate the release pipeline\\n1. C\", \"lick the Releases tab of your team project. Click the New pipeline button.\\n36 CHAPTER 3 | Continuous\", \" integration and deployment with Azure DevOpsThe template selection pane appears.\\n1. From the templa\", \"te selection page, enter App Service Deployment in the search box:\\n1. The template search results ap\", \"pear. Hover over the Azure App Service Deployment with\\nSlot template, and click the Apply button. Th\", \"e Pipeline tab of the release pipeline appears.\\n1. Click the Add button in the Artifacts box. The Ad\", \"d artifact panel appears:\\n37 CHAPTER 3 | Continuous integration and deployment with Azure DevOps1. S\", \"elect the Build tile from the Source type section. This type allows for the linking of the\\nrelease p\", \"ipeline to the build definition.\\n2. Select MyFirstProject from the Project drop-down.\\n3. Select the \", \"build definition name, MyFirstProject-ASP.NET Core-CI, from the Source (Build\\ndefinition) drop-down.\", \"\\n4. Select Latest from the Default version drop-down. This option builds the artifacts produced\\nby t\", \"he latest run of the build definition.\\n5. Replace the text in the Source alias textbox with Drop.\\n6.\", \" Click the Add button. The Artifacts section updates to display the changes.\\n7. Click the lightning \", \"bolt icon to enable continuous deployments:\\nWith this option enabled, a deployment occurs each time \", \"a new build is available.\\n1. A Continuous deployment trigger panel appears to the right. Click the t\", \"oggle button to\\nenable the feature. It isn\\u2019t necessary to enable the Pull request trigger.\\n2. Click \", \"the Add drop-down in the Build branch filters section. Choose the Build Definition\\u2019s\\ndefault branch \", \"option. This filter causes the release to trigger only for a build from the\\nGitHub repository\\u2019s defa\", \"ult branch (main).\\n3. Click the Save button. Click the OK button in the resulting Save modal dialog.\", \"\\n4. Click the Stage 1 box. An Stage panel appears to the right. Change the Stage 1 text in the\\nStage\", \" name textbox to Production.\\n38 CHAPTER 3 | Continuous integration and deployment with Azure DevOps1\", \". Click the 1 phase, 2 tasks link in the Production box:\\nThe **Tasks** tab of the environment appear\", \"s.\\n1. Click the Deploy Azure App Service to Slot task. Its settings appear in a panel to the right.\\n\", \"2. Select the Azure subscription associated with the App Service from the Azure subscription\\ndrop-do\", \"wn. Once selected, click the Authorize button.\\n3. Select Web App from the App type drop-down.\\n4. Sel\", \"ect mywebapp/ from the App service name drop-down.\\n5. Select AzureTutorial from the Resource group d\", \"rop-down.\\n6. Select staging from the Slot drop-down.\\n7. Select Run on agent* under Tasks. On the rig\", \"ht pane, you\\u2019ll see Agent Job.\\n8. Select the self-hosted Agent pool if you have created that in the \", \"earlier step.\\n39 CHAPTER 3 | Continuous integration and deployment with Azure DevOps> [!NOTE]\\n> If y\", \"ou are using MS-hosted agent then select the *Hosted > Azure Pipelines* from\\ndrop down.\\n1. Click the\", \" Save button.\\n2. Hover over the default release pipeline name. Click the pencil icon to edit it. Use\", \"\\nMyFirstProject-ASP.NET Core-CD as the name.\\n1. Click the Save button.\\nCommit changes to GitHub and \", \"automatically deploy to Azure\\n1. Open SimpleFeedReader.sln in Visual Studio.\\n2. In Solution Explorer\", \", open Pages.cshtml. Change <h2>Simple Feed Reader - V3</h2> to\\n<h2>Simple Feed Reader - V4</h2>.\\n3.\", \" Press Ctrl+Shift+B to build the app.\\n4. Commit the file to the GitHub repository. Use either the Ch\", \"anges page in Visual Studio\\u2019s\\nTeam Explorer tab, or execute the following using the local machine\\u2019s \", \"command shell:\\n:::{custom-style=CodeBox} console git commit -a -m \\\"upgraded to V4\\\" :::\\n5. Push the c\", \"hange in the default branch (main) to the origin remote of your GitHub repository.\\nIn the following \", \"command, replace the placeholder {BRANCH} with the default branch (use\\nmain):\\n:::{custom-style=CodeB\", \"ox} console git push origin {BRANCH} :::\\nThe commit appears in the GitHub repository\\u2019s default branc\", \"h (main). You\\u2019ll be able to see the\\ncommit history in https://github.com/<GitHub_username>/simple-fe\", \"ed-\\nreader/commits/main.\\nThe build is triggered, since continuous integration is enabled in the buil\", \"d definition\\u2019s\\nTriggers tab:\\n40 CHAPTER 3 | Continuous integration and deployment with Azure DevOps1\", \". Navigate to the Pipelines. You\\u2019ll see the CI pipeline details and monitor each steps if you drill\\n\", \"down Jobs details.\\n1. Similarly, go to the Releases tab to see the details of CD pipeline. You can a\", \"lways drill down\\nfurther to see more details of each step.\\n1. Once the build succeeds, a deployment \", \"to Azure occurs. Navigate to the app in the browser.\\nNotice that the \\u201cV4\\u201d text appears in the headin\", \"g:\\nExamine the Azure Pipelines pipeline\\nBuild definition\\nA build definition was created with the nam\", \"e MyFirstProject-ASP.NET Core-CI. Upon completion, the\\nbuild produces a .zip file including the asse\", \"ts to be published. The release pipeline deploys those\\nassets to Azure.\\nThe build definition\\u2019s Tasks\", \" tab lists the individual steps being used. There are five build tasks.\\n41 CHAPTER 3 | Continuous in\", \"tegration and deployment with Azure DevOps1. Restore \\u2014 Executes the dotnet restore command to restor\", \"e the app\\u2019s NuGet packages. The\\ndefault package feed used is nuget.org.\\n2. Build \\u2014 Executes the dotn\", \"et build --configuration release command to compile the app\\u2019s\\ncode. This --configuration option is u\", \"sed to produce an optimized version of the code, which\\nis suitable for deployment to a production en\", \"vironment. Modify the BuildConfiguration\\nvariable on the build definition\\u2019s Variables tab if, for ex\", \"ample, a debug configuration is\\nneeded.\\n3. Test \\u2014 Executes the dotnet test --configuration release -\", \"-logger trx --results-directory\\n<local_path_on_build_agent> command to run the app\\u2019s unit tests. Uni\", \"t tests are executed\\nwithin any C# project matching the **/Tests/.csproj glob pattern. Test results \", \"are saved in a .trx\\nfile at the location specified by the --results-directory option. If any tests f\", \"ail, the build fails\\nand isn\\u2019t deployed.\\n42 CHAPTER 3 | Continuous integration and deployment with A\", \"zure DevOps[!NOTE] To verify the unit tests work, modify SimpleFeedReader.Tests.cs to purposefully b\", \"reak\\none of the tests. For example, change Assert.True(result.Count > 0); to\\nAssert.False(result.Cou\", \"nt > 0); in the Returns_News_Stories_Given_Valid_Uri method. Commit\\nand push the change to GitHub. T\", \"he build is triggered and fails. The build pipeline status\\nchanges to failed. Revert the change, com\", \"mit, and push again. The build succeeds.\\n4. Publish \\u2014 Executes the dotnet publish --configuration re\", \"lease --output\\n<local_path_on_build_agent> command to produce a .zip file with the artifacts to be\\nd\", \"eployed. The --output option specifies the publish location of the .zip file. That location is\\nspeci\", \"fied by passing a predefined variable named $(build.artifactstagingdirectory). That\\nvariable expands\", \" to a local path, such as *c:_work\\\\1, on the build agent.\\n5. Publish Artifact \\u2014 Publishes the .zip f\", \"ile produced by the Publish task. The task accepts the\\n.zip file location as a parameter, which is t\", \"he predefined variable\\n$(build.artifactstagingdirectory). The .zip file is published as a folder nam\", \"ed drop.\\nClick the build definition\\u2019s Summary link to view a history of builds with the definition:\\n\", \"On the resulting page, click the individual build for more details.\\nA summary of this specific build\", \" is displayed. Click the published link, and notice the drop folder\\nproduced by the build is listed:\", \"\\n43 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsUse the ellipsis and click on\", \" Downloads artifacts links to inspect the published artifacts.\\nRelease pipeline\\nA release pipeline w\", \"as created with the name MyFirstProject-ASP.NET Core-CD:\\nThe two major components of the release pip\", \"eline are the Artifacts and the Stages. Clicking the box\\nin the Artifacts section reveals the follow\", \"ing panel:\\n44 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsThe Source (Build d\", \"efinition) value represents the build definition to which this release pipeline is\\nlinked. The .zip \", \"file produced by a successful run of the build definition is provided to the Production\\nenvironment \", \"for deployment to Azure. Click the 1 phase, 2 tasks link in the Production environment\\nbox to view t\", \"he release pipeline tasks:\\nThe release pipeline consists of two tasks: Deploy Azure App Service to S\", \"lot and Manage Azure App\\nService - Slot Swap. Clicking the first task reveals the following task con\", \"figuration:\\n45 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsThe Azure subscrip\", \"tion, service type, web app name, resource group, and deployment slot are defined\\nin the deployment \", \"task. The Package or folder textbox holds the .zip file path to be extracted and\\ndeployed to the sta\", \"ging slot of the mywebapp<unique_number> web app.\\nClicking the slot swap task reveals the following \", \"task configuration:\\n46 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsThe subscr\", \"iption, resource group, service type, web app name, and deployment slot details are\\nprovided. The Sw\", \"ap with Production check box is checked. Consequently, the bits deployed to the\\nstaging slot are swa\", \"pped into the production environment.\\nAdditional reading\\n\\u2022 Create your first pipeline with Azure Pip\", \"elines\\n\\u2022 Build and .NET Core project\\n\\u2022 Deploy a web app with Azure Pipelines\\n47 CHAPTER 3 | Continuo\", \"us integration and deployment with Azure DevOpsContinuous integration and deployment with\\nGitHub Act\", \"ions\\nGitHub has long been the home for millions of open-source developers around the globe. Most\\ndev\", \"elopers associate source control with GitHub. However, GitHub is an evolving platform that can be\\nus\", \"ed for more than just synchronizing Git repositories.\\nGitHub Actions\\nGitHub Actions is a workflow en\", \"gine that can automate workflows for nearly all events that occur on\\nGitHub. Actions is a great solu\", \"tion for Continuous Integration/Continuous Deployment (CI/CD)\\npipelines.\\nIn this section of articles\", \", you\\u2019ll learn how to create an Actions workflow. The workflow will build, test,\\nand deploy a .NET w\", \"eb app to Azure Web Apps.\\nNote\\nBefore you begin, complete the Publish the app\\u2019s code to GitHub and D\", \"isconnect local Git\\ndeployment sections of the Continuous integration and deployment with Azure DevO\", \"ps section to\\npublish your code to GitHub. Then proceed to the Build article.\\nIn the Build article, \", \"you\\u2019ll create the initial workflow to build and test the .NET app. You\\u2019ll:\\n[!div class=\\u201cchecklist\\u201d]\\n\", \"\\u2022 Learn the basic structure of a GitHub Action workflow YAML file.\\n\\u2022 Use a template to create a basi\", \"c build workflow that builds a .NET app and executes unit tests.\\n\\u2022 Publish the compiled app so that \", \"it\\u2019s ready for deployment.\\nIn the Deploy article, you\\u2019ll:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Learn about env\", \"ironments in GitHub Actions.\\n\\u2022 Create two environments and specify environment protection rules.\\n\\u2022 C\", \"reate environment secrets for managing environment-specific configuration.\\n\\u2022 Extend the workflow YAM\", \"L file to add deployment steps.\\n\\u2022 Add a manual dispatch trigger.\\nSecure code with CodeQL\\nIn addition\", \" to building and deploying code, GitHub Advanced Security offers tools for \\u201cshifting left\\u201d\\nwith secu\", \"rity. That is, integrating security early on in the software delivery lifecycle. CodeQL is a code\\nsc\", \"anning language that runs queries to find potential vulnerabilities or quality issues in your code.\\n\", \"CodeQL is run using an Actions workflow.\\nIn the CodeQL article, you\\u2019ll:\\n48 CHAPTER 3 | Continuous in\", \"tegration and deployment with Azure DevOps[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Create a Code Scanning Action.\\n\", \"\\u2022 Edit the workflow file to include custom scan settings.\\n\\u2022 See scanning results.\\nCompare and contra\", \"st GitHub Actions and Azure Pipelines\\nGitHub Actions and Azure Pipelines have a common lineage and a\", \"re similar in many respects.\\nHowever, you should understand the differences before selecting a platf\", \"orm for building, testing, and\\ndeploying apps. In the Comparison article, you\\u2019ll deep dive into thes\", \"e platforms and compare and\\ncontrast them. You\\u2019ll also learn how to select the correct platform for \", \"your CI/CD needs.\\nContinuous integration and deployment with\\nGitHub Actions\\nGitHub has long been the\", \" home for millions of open-source developers around the globe. Most\\ndevelopers associate source cont\", \"rol with GitHub. However, GitHub is an evolving platform that can be\\nused for more than just synchro\", \"nizing Git repositories.\\nGitHub Actions\\nGitHub Actions is a workflow engine that can automate workfl\", \"ows for nearly all events that occur on\\nGitHub. Actions is a great solution for Continuous Integrati\", \"on/Continuous Deployment (CI/CD)\\npipelines.\\nIn this section of articles, you\\u2019ll learn how to create \", \"an Actions workflow. The workflow will build, test,\\nand deploy a .NET web app to Azure Web Apps.\\nNot\", \"e\\nBefore you begin, complete the Publish the app\\u2019s code to GitHub and Disconnect local Git\\ndeploymen\", \"t sections of the Continuous integration and deployment with Azure DevOps section to\\npublish your co\", \"de to GitHub. Then proceed to the Build article.\\nIn the Build article, you\\u2019ll create the initial wor\", \"kflow to build and test the .NET app. You\\u2019ll:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Learn the basic structure o\", \"f a GitHub Action workflow YAML file.\\n\\u2022 Use a template to create a basic build workflow that builds \", \"a .NET app and executes unit tests.\\n\\u2022 Publish the compiled app so that it\\u2019s ready for deployment.\\nIn\", \" the Deploy article, you\\u2019ll:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Learn about environments in GitHub Actions.\\n\", \"49 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\u2022 Create two environments and \", \"specify environment protection rules.\\n\\u2022 Create environment secrets for managing environment-specific\", \" configuration.\\n\\u2022 Extend the workflow YAML file to add deployment steps.\\n\\u2022 Add a manual dispatch tri\", \"gger.\\nSecure code with CodeQL\\nIn addition to building and deploying code, GitHub Advanced Security o\", \"ffers tools for \\u201cshifting left\\u201d\\nwith security. That is, integrating security early on in the softwar\", \"e delivery lifecycle. CodeQL is a code\\nscanning language that runs queries to find potential vulnera\", \"bilities or quality issues in your code.\\nCodeQL is run using an Actions workflow.\\nIn the CodeQL arti\", \"cle, you\\u2019ll:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Create a Code Scanning Action.\\n\\u2022 Edit the workflow file to i\", \"nclude custom scan settings.\\n\\u2022 See scanning results.\\nCompare and contrast GitHub Actions and Azure P\", \"ipelines\\nGitHub Actions and Azure Pipelines have a common lineage and are similar in many respects.\\n\", \"However, you should understand the differences before selecting a platform for building, testing, an\", \"d\\ndeploying apps. In the Comparison article, you\\u2019ll deep dive into these platforms and compare and\\nc\", \"ontrast them. You\\u2019ll also learn how to select the correct platform for your CI/CD needs.\\nCompare and\", \" contrast GitHub Actions and Azure\\nPipelines\\nGitHub Actions and Azure Pipelines have a common histor\", \"y. In fact, the Actions agent is a fork of the\\nPipelines agent. There are many similarities between \", \"GitHub Actions and Azure Pipelines and it\\u2019s\\nworth comparing and contrasting them.\\nPipelines as code\\n\", \"Before you compare GitHub Actions and Azure Pipelines, you should consider the benefits of pipelines\", \"\\nas code. Pipelines as code:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Benefit from standard source control practic\", \"es (such as code reviews via pull request and\\nversioning).\\n\\u2022 Can be audited for changes just like an\", \"y other files in the repository.\\n\\u2022 Don\\u2019t require accessing a separate system or UI to edit.\\n\\u2022 Can fu\", \"lly codify the build, test, and deploy process for code.\\n50 CHAPTER 3 | Continuous integration and d\", \"eployment with Azure DevOps\\u2022 Can usually be templatized to empower teams to create standard processe\", \"s across multiple\\nrepositories.\\nNote\\nThe term \\u201cpipelines\\u201d can also be referred to by several differe\", \"nt interchangeable words: pipeline,\\nworkflow, and build are common terms. In this article, reference\", \"s to Azure Pipelines are referring to\\nYAML Pipelines, and not the older UI-based Classic Pipelines.\\n\", \"Agents and runners\\nBefore you examine pipelines themselves, you should consider how these pipelines \", \"execute. Both\\nGitHub Actions and Azure Pipelines are really orchestration engines. When a pipeline i\", \"s triggered, the\\nsystem finds an \\u201cagent\\u201d and tells the agent to execute the jobs defined in the pipe\", \"line file.\\nAzure Pipelines run on agents. The agent is written in .NET, so it will run wherever .NET\", \" can run:\\nWindows, macOS, and Linux. Agents can even run in containers. Agents are registered to a p\", \"ool in\\nAzure Pipelines or to a repository or organization in GitHub. Agents can be hosted or private\", \".\\nGitHub Workflows execute on runners. The runner code is essentially a fork of the Azure Pipelines\\n\", \"code, so it\\u2019s very similar. It\\u2019s also cross-platform and you can also use hosted or self-hosted runn\", \"ers.\\nHosted agents and runners\\nHosted agents (Azure Pipelines) and hosted runners (GitHub) are agent\", \"s that are spun up and\\nmanaged by Azure DevOps or GitHub respectively. You don\\u2019t need to maintain an\", \"y build\\ninfrastructure. When a pipeline triggers that targets a hosted agent, an instance of the spe\", \"cified agent\\nimage is created. The job is run by the agent on the instance, and once the job complet\", \"es, the\\ninstance is destroyed. The same applies for hosted runners running GitHub workflows.\\nNote\\nTh\", \"e list of software installed on Azure Pipelines images is listed in this repository. You can select \", \"the\\nplatform folder and examine the README.md files. You can find information on GitHub hosted\\nrunne\", \"rs.\\nPrivate agents and self-hosted runners\\nThere are times when you can\\u2019t use hosted images. For exa\", \"mple, when you:\\n\\u2022 Require SDKs or other software that isn\\u2019t installed on the images.\\n\\u2022 Need to acces\", \"s resources that aren\\u2019t public (such as an internal SonarQube server or an\\ninternal Artifactory inst\", \"ance).\\n\\u2022 Need to deploy to private networks.\\n\\u2022 Need to install licenses for third-party software req\", \"uired for building your code.\\n\\u2022 Need more storage or memory than is provided to the hosted agent ima\", \"ges.\\n\\u2022 Need more time than the maximum build time limit for hosted agents.\\n51 CHAPTER 3 | Continuous\", \" integration and deployment with Azure DevOpsImportant\\nIt\\u2019s possible to install tools and SDKs when \", \"running pipelines on hosted agents. If the install steps\\ndon\\u2019t take long, this is viable. However, i\", \"f the tools/software take a long time to install, then you may\\nbe better off with a private agent or\", \" self-hosted runner, since the install steps will need to execute for\\nevery run of the workflow.\\nAzu\", \"re DevOps agents\\nEvery Azure DevOps account has a hosted pool with a single agent that can run one j\", \"ob at a time.\\nAlso included is a set number of free build minutes. You may purchase additional \\u201chost\", \"ed pipelines\\u201d in\\nAzure DevOps. When you purchase an additional hosted pipeline, you\\u2019re really removi\", \"ng the build\\nminutes limit and adding concurrency. One pipeline can run one job at a time. Two pipel\", \"ines can run\\ntwo jobs simultaneously, and so on.\\nComparison of agents\\nFeature GitHub Azure Pipelines\", \" Links\\nHosted agents for Free Up to 10 free Microsoft-hosted parallel jobs Azure\\npublic that can run\", \" for up to 360 minutes (6 hours) Pipelines\\nrepos/projects each time with no overall time limit per G\", \"itHub\\nmonth. You aren\\u2019t given this free grant by\\ndefault, you have to submit a request\\nHosted agents\", \" for 2,000 minutes One free parallel job that can run for up to\\nprivate free per month, 60 minutes e\", \"ach time, until you\\u2019ve used\\nrepos/projects 3,000 minutes 1,800 minutes (30 hours) per month. You\\nfor\", \" Pro and can pay for additional capacity per parallel\\nTeam licenses, job. Paid parallel jobs remove \", \"the monthly\\n50,000 minutes time limit and allow you to run each job for\\nfor Enterprise up to 360 min\", \"utes (6 hours).\\nlicense.\\nAdditional\\nminutes may be\\npurchased.\\nCross-platform Yes Yes\\nScale set agent\", \"s No Yes Azure virtual\\nmachine\\nscale set\\nagents\\nComparison of GitHub Actions and Azure Pipelines\\nAzu\", \"re Pipelines (YAML pipelines) provide a mature set of features. Some of the features include:\\n\\u2022 Appr\", \"ovals\\n\\u2022 Artifact storage\\n52 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\u2022 Dep\", \"loyment jobs\\n\\u2022 Environments\\n\\u2022 Gates\\n\\u2022 Stages\\n\\u2022 Templates\\n\\u2022 Triggers\\n\\u2022 Variable groups\\nFor a full lis\", \"t of Azure Pipelines features, refer to the Feature availability table.\\nGitHub Actions are evolving \", \"rapidly and provide features such as triggers for almost all GitHub events,\\nartifact storage, enviro\", \"nments and environment rules, starter templates, and matrices. Read more\\nabout the entire feature se\", \"t refer GitHub Actions.\\nFeature comparison\\nThe following table is current as of January 2023 and is \", \"not an exhaustive list of features.\\nFeature Description GitHub Actions Azure Pipelines\\nApprovals Def\", \"ine approval Yes Yes\\nconditions before\\nmoving further in the\\npipeline\\nArtifacts Upload, store, and Y\", \"es Yes\\ndownload artifacts\\nfrom jobs\\nCaching Cache folders or files Yes Yes\\nfor subsequent runs\\nCondi\", \"tions Specify conditions Yes Yes\\nfor steps or jobs\\nContainer Run jobs inside a Yes Yes\\nJobs containe\", \"r\\nDemands Specify demands Yes Yes\\nthat must be met to\\nmatch jobs to agents\\nDependenci Specify Yes Ye\", \"s\\nes dependencies\\nbetween jobs or\\nstages\\nDeployment A logical set of target No Yes\\nGroups machines f\", \"or\\ndeployments\\nDeployment Job that targets a No Yes\\nJobs deployment group\\n53 CHAPTER 3 | Continuous \", \"integration and deployment with Azure DevOpsFeature Description GitHub Actions Azure Pipelines\\nEnvir\", \"onment A collection of Yes Yes\\ns resources to target\\nor a logical\\nenvironment\\nGates/Check Automatic \", \"collection Yes Yes\\ns and evaluation of\\nsignals to control\\ncontinuation\\nJobs Sequence of steps Yes Ye\", \"s\\nthat are executed on\\nan agent\\nService Manage the lifecycle Yes Yes\\nContainers of a containerized\\ns\", \"ervice instance\\navailable during a\\njob\\nService Abstract credentials No Yes\\nConnections to external s\", \"ystems\\nPasswordles Provide technologies Yes No\\ns and support use\\nconnections cases that reduce\\nto cl\", \"oud and potentially\\nproviders eliminate the use of\\npasswords\\nStages Group jobs in a No Yes\\npipeline\\n\", \"Templates Define reusable, Yes Yes\\nparameterized\\nbuilding blocks for\\nsteps, jobs, or\\nvariables\\nStart\", \"er Defines a starter Yes No\\nTemplates workflow based on\\nthe type of code\\ndetected in a\\nrepository\\nTr\", \"iggers Set of events that Yes Yes\\ncause the pipeline to\\ntrigger\\n54 CHAPTER 3 | Continuous integratio\", \"n and deployment with Azure DevOpsFeature Description GitHub Actions Azure Pipelines\\nVariables Varia\", \"bles that can be Yes Yes\\npassed in, statically\\nor dynamically\\ndefined\\nVariable Store values for use \", \"No Yes\\nGroups across multiple\\npipelines\\nImportant\\nGitHub Actions is rapidly evolving. Be sure to che\", \"ck documentation carefully before deciding which\\nplatform is right for you.\\nBuild a .NET web app usi\", \"ng GitHub Actions\\nGitHub Actions allow you to automate workflows in response to events that are trig\", \"gered in GitHub. A\\ncommon workflow is Continuous Integration (CI), but Actions can automate other pr\", \"ocesses. For\\nexample, sending welcome emails when people join a repository.\\nTo explore moving code t\", \"o the cloud, you\\u2019ll build a GitHub Actions workflow file. The workflow file will\\nbe used for the Sim\", \"ple Feed Reader app you\\u2019ve already deployed to Azure App Service.\\nIn this article, you will: > [!div\", \" class=\\u201cchecklist\\u201d] > > * Learn the basic structure of a GitHub Action\\nworkflow YAML file. > * Use a\", \" template to create a basic build workflow that builds the .NET app and\\nexecutes unit tests. > * Pub\", \"lish the compiled app so that it\\u2019s ready for deployment.\\nWorkflow structure\\nWorkflows are defined in\", \" YAML files, and contain several common nodes:\\n\\u2022 a name\\n\\u2022 a trigger, defined by an on section\\n\\u2022 one \", \"or more job sections composed of one or more steps\\n\\u2022 optional attributes such as environment variabl\", \"es\\nJobs are run on runners. You can use hosted runners, which are spun up by GitHub during the\\nworkf\", \"low and then thrown away. Hosted runners are great because you don\\u2019t have to maintain your\\nown build\", \" infrastructure. For workflows that require a specific build environment, or for running\\nworkflows o\", \"n a private network, you can also use private runners. To create a private runner, install the\\nrunne\", \"r on any machine that supports .NET.\\nEach job will specify what runner GitHub should use to execute \", \"the steps. You can also specify\\ndependencies between jobs using the needs attribute. Deployment jobs\", \" can also specify an\\nenvironment to target.\\n55 CHAPTER 3 | Continuous integration and deployment wit\", \"h Azure DevOpsThe steps node can be as easy as inline commands, or they can be actions. Most CI work\", \"flows will\\nhave a combination of run steps (for executing scripts) and actions. Individual actions a\", \"re pulled into\\nthe workflow by referencing the GitHub Action repository (and optionally a tag or com\", \"mit hash for\\nspecific versions) and specifying any parameters using the with keyword.\\nTip\\nFor more i\", \"nformation, see GitHub Actions YAML syntax.\\nFrom a workflow file, you\\u2019re able to run any of the avai\", \"lable .NET CLI commands. For example, if you\\u2019re\\nrequired to build, test, and deploy an ASP.NET Core \", \"Blazor WebAssembly app with Ahead-of-Time\\n(AoT) compilation, you\\u2019d use the following commands:\\n\\u2022 dot\", \"net workload install\\n\\u2022 dotnet restore\\n\\u2022 dotnet build\\n\\u2022 dotnet test\\n\\u2022 dotnet publish\\nThe .NET SDK is \", \"a workflow necessity\\nAll .NET workflows require the .NET SDK, and this can be set up by the actions/\", \"setup-dotnet GitHub\\nAction. This action sets up a .NET CLI environment for use in actions. Some GitH\", \"ub hosted runners\\nhave the .NET SDK preinstalled, but that\\u2019s subject to change. As a best practice, \", \"use the actions/setup-\\ndotnet action to ensure the proper version is available.\\nCreate a basic build\", \" workflow\\nA primary principle of effective DevOps is to \\u201cbuild once, and deploy many times\\u201d. You\\u2019ll \", \"start by\\ncreating a workflow to build a basic .NET app. In the next step, you\\u2019ll publish the output \", \"to prepare for\\ndeployment.\\n1. Navigate to your GitHub repository and select the Actions tab.\\n2. GitH\", \"ub detects that there\\u2019s .NET code in the repository and suggests a .NET workflow\\ntemplate. Select Se\", \"t up this workflow to create a new YAML workflow file:\\n**Figure 1**: Creating a new workflow.\\n56 CHA\", \"PTER 3 | Continuous integration and deployment with Azure DevOps1. Commit the file onto the main bra\", \"nch. Since you\\u2019ve defined a trigger condition for commits to\\nmain, this commit should trigger the wo\", \"rkflow to run.\\n**Figure 2**: Commit the YAML file.\\n1. Select the Actions tab again. You should see a\", \" running workflow. Once the workflow has\\ncompleted, you should see a successful run.\\n**Figure 3**: S\", \"uccessful build view.\\n1. Opening the logs, you can see that the .NET build succeeded and the tests r\", \"an and passed.\\n**Figure 4**: Checking the logs.\\n57 CHAPTER 3 | Continuous integration and deployment\", \" with Azure DevOpsNote\\nIf any of the tests fail, the workflow will fail.\\nDissect the workflow file\\nL\", \"et\\u2019s examine the workflow YAML file you have so far:\\nname: .NET\\non:\\npush:\\nbranches: [ main ]\\npull_re\", \"quest:\\nbranches: [ main ]\\njobs:\\nbuild:\\nruns-on: ubuntu-latest\\nsteps:\\n- uses: actions/checkout@v3\\n- n\", \"ame: Setup .NET\\nuses: actions/setup-dotnet@v3\\nwith:\\ndotnet-version: 6.0.x\\n- name: Restore dependenci\", \"es\\nrun: dotnet restore\\n- name: Build\\nrun: dotnet build --no-restore\\n- name: Test\\nrun: dotnet test --\", \"no-build --verbosity normal\\nNotice the following things:\\n1. There\\u2019s a name that names the workflow.\\n\", \"2. The on object specifies when this workflow should run. This workflow has two events that\\ntrigger \", \"it: push to main and pull_request to main. Each time someone commits to main or\\ncreates a pull reque\", \"st (PR) to main, this workflow will execute.\\n3. There\\u2019s a single job called build. This build should\", \" run on a hosted agent. ubuntu_latest\\nspecifies the most recent Ubuntu hosted agent.\\n4. There are fi\", \"ve steps:\\n1. actions/checkout@v3 is an action that checks out the code in the repository onto the\\nru\", \"nner.\\n2. actions/setup-dotnet@v3 is an action that sets up the .NET CLI. This step also\\nspecifies a \", \"name attribute for the logs and the dotnet-version parameter within the\\nwith object.\\n3. Three run st\", \"eps that execute dotnet restore, dotnet build, and dotnet test. name\\nattributes are also specified f\", \"or these run steps to make the logs look pretty.\\n58 CHAPTER 3 | Continuous integration and deploymen\", \"t with Azure DevOpsPublish the output\\nNow that you\\u2019ve successfully built and tested the code, add st\", \"eps that publish the output so you can\\ndeploy the web app.\\n1. Navigate to the .github/workflows/dotn\", \"et.yml file and select the pencil icon to edit\\n**Figure 5**: Edit the YAML file.\\n1. Add the followin\", \"g Publish step below the Test step. The step runs the dotnet publish\\ncommand to publish the web app:\", \"\\n:::{custom-style=CodeBox} ```yml\\n\\u2013 name: Test run: dotnet test \\u2013no-build \\u2013verbosity normal # <\\u2013 thi\", \"s is the current\\nbottom line\\n\\u2013 name: Publish run: dotnet publish SimpleFeedReader/SimpleFeedReader.c\", \"sproj -c\\nRelease -o website ``` :::\\n2. This publishes the web app to a folder on the hosted agent. N\", \"ow you\\u2019ll want to upload the\\nsite as a build artifact that can be deployed to Azure. To complete thi\", \"s activity, you\\u2019ll use an\\nexisting action.\\n3. On the list of actions in the Actions Helper pane on t\", \"he right, search for artifact. Select on\\nthe Upload a Build Artifact (By actions) action.\\n**Figure 6\", \"**: Accessing the snippet helper.\\n59 CHAPTER 3 | Continuous integration and deployment with Azure De\", \"vOps1. Edit the version to v2.2.2 to display a sample snippet. Select the clipboard icon to copy the\", \"\\nsnippet and paste it into the workflow below the publish step.\\n**Figure 7**: Copying a snippet.\\n1. \", \"Edit the YAML for this step to look as follows:\\n:::{custom-style=CodeBox} ```yml\\n\\u2013 name: Upload a Bu\", \"ild Artifact uses: actions/upload-artifact@v3 with: name: website\\npath: SimpleFeedReader/website/** \", \"if-no-files-found: error ``` :::\\n2. Commit the file.\\n3. Once the workflow completes, you\\u2019ll see the \", \"artifact from the Home tab:\\n**Figure 8**: Viewing artifacts in the summary page.\\n60 CHAPTER 3 | Cont\", \"inuous integration and deployment with Azure DevOpsFinal workflow file\\nThe final workflow file shoul\", \"d look something like this:\\nname: .NET\\non:\\npush:\\nbranches: [ main ]\\npull_request:\\nbranches: [ main ]\", \"\\njobs:\\nbuild:\\nruns-on: ubuntu-latest\\nsteps:\\n- uses: actions/checkout@v3\\n- name: Setup .NET\\nuses: act\", \"ions/setup-dotnet@v3\\nwith:\\ndotnet-version: 6.0.x\\n- name: Restore dependencies\\nrun: dotnet restore\\n- \", \"name: Build\\nrun: dotnet build --no-restore\\n- name: Test\\nrun: dotnet test --no-build --verbosity norm\", \"al\\n- name: Publish\\nrun: dotnet publish SimpleFeedReader/SimpleFeedReader.csproj -c Release -o websit\", \"e\\n- name: Upload a Build Artifact\\nuses: actions/upload-artifact@v3\\nwith:\\nname: website\\npath: SimpleF\", \"eedReader/website/**\\nif-no-files-found: error\\nDeploy a .NET web app using GitHub Actions\\nWarning\\nPle\", \"ase complete the Build tutorial before starting this lab.\\nIn this article, you\\u2019ll: > [!div class=\\u201cch\", \"ecklist\\u201d] > > * Learn about Environments in GitHub Actions. > *\\nCreate two environments and specify \", \"environment protection rules. > * Create environment secrets\\nfor managing environment-specific confi\", \"guration. > * Extend the workflow YAML file to add\\ndeployment steps. > * Add a manual dispatch trigg\", \"er.\\nEnvironments\\nNow that you\\u2019ve published an artifact that\\u2019s potentially deployable, you\\u2019ll add dep\", \"loyment jobs to the\\nworkflow. There\\u2019s nothing special about a deployment job, other than the fact th\", \"at it references an\\n61 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsenvironmen\", \"t. Environments are logical constructs that allow you to specify environment protection\\nrules, such \", \"as approvals, on any group of resources that you\\u2019re targeting.\\nIn this walkthrough, you\\u2019ll be deploy\", \"ing to two environments: PRE-PROD and PROD. In a typical\\ndevelopment lifecycle, you\\u2019ll want to deplo\", \"y the latest code to a soft environment (typically DEV) that\\nis expected to be a bit unstable. You\\u2019l\", \"l use PRE-PROD as this soft environment. The \\u201chigher\\u201d\\nenvironments (like UAT and PROD) are harder en\", \"vironments that are expected to be more stable. To\\nenforce this, you can build protection rules into\", \" higher environments. You\\u2019ll configure an approval\\nprotection rule on the PROD environment: whenever\", \" a deployment job targets an environment with\\nan approval rule, it will pause until approval is gran\", \"ted before executing.\\nGitHub environments are logical. They represent the physical (or virtual) reso\", \"urces that you\\u2019re\\ndeploying to. In this case, the PRE-PROD is just a deployment slot on the Azure We\", \"b App. PROD is the\\nproduction slot. The PRE-PROD deployment job will deploy the published .NET app t\", \"o the staging\\nslot. The PROD deployment job will swap the slots.\\nOnce you have these steps in place,\", \" you\\u2019ll update the workflow to handle environment-specific\\nconfiguration using environment secrets.\\n\", \"Note\\nFor more information, see GitHub Actions - Environments.\\nAzure authentication\\nTo perform action\", \"s such as deploying code to an Azure resource, you need the correct permissions.\\nFor deployment to A\", \"zure Web Apps, you can use a publishing profile. If you want to deploy to a\\nstaging slot, then you\\u2019l\", \"l need the publishing profile for the slot too. Instead, you can use a service\\nprincipal (SPN) and a\", \"ssign permission to this service principal. You can then authenticate using\\ncredentials for the SPN \", \"before using any commands that the SPN has permissions to perform.\\nOnce you have an SPN, you\\u2019ll crea\", \"te a repository secret to securely store the credentials. You can then\\nrefer to the secret whenever \", \"you need to authenticate. The secret is encrypted and once it has been\\nsaved, can never be viewed or\", \" edited (only deleted or re-created).\\nCreate an SPN\\n1. In your terminal or Cloud Shell, run the foll\", \"owing command to create a service principal with\\ncontributor permissions to the web app you created \", \"earlier:\\n:::{custom-style=CodeBox} azurecli az ad sp create-for-rbac --name \\\"{sp-name}\\\" --sdk-auth -\", \"-\\nrole contributor \\\\ --scopes /subscriptions/{subscription-id}/resourceGroups/{resource-\\ngroup}/prov\", \"iders/Microsoft.Web/sites/{webappname} :::\\n2. The command should output JSON that has credentials em\", \"bedded:\\n:::{custom-style=CodeBox} json { \\\"clientId\\\": \\\"<GUID>\\\", \\\"clientSecret\\\": \\\"<GUID>\\\",\\n\\\"subscripti\", \"onId\\\": \\\"<GUID>\\\", \\\"tenantId\\\": \\\"<GUID>\\\", ... } :::\\n62 CHAPTER 3 | Continuous integration and deploymen\", \"t with Azure DevOps3. Make sure to record the clientId, clientSecret, subscription, and tenantId. Yo\", \"u can also leave\\nthe terminal open for copy/paste later.\\nCreate a repository secret\\n1. Now you\\u2019re go\", \"ing to create an encrypted secret to store the credentials. You\\u2019ll create this\\nsecret at the reposit\", \"ory level.\\n2. Navigate to GitHub and select your repository Settings tab. Then select Secrets. Selec\", \"t New\\nrepository secret:\\n**Figure 1**: Create a secret.\\n1. Copy and paste the JSON from the az ad sp\", \" create-for-rbac command into the body of the\\nsecret. You can create this JSON by hand too if you ha\", \"ve the relevant fields for your SPN. The\\nsecret should be named AZURE_CREDENTIALS. Select Add secret\", \" to save the new secret:\\n**Figure 2**: Add Azure credentials.\\n1. You\\u2019ll consume this secret in a wor\", \"kflow in later steps. To access it, use the variable notation\\n${{}}. In this case, ${{ AZURE_CREDENT\", \"IAL }} will be populated with the JSON you saved.\\nAdd environments\\nEnvironments are used as a logica\", \"l boundary. You can add approvals to environments to ensure\\nquality. You can also track deployments \", \"to environments and specify environment-specific values\\n(secrets) for configuration.\\n63 CHAPTER 3 | \", \"Continuous integration and deployment with Azure DevOpsFor this example, you\\u2019re going to split the a\", \"ctual Azure environment into two logical environments\\ncalled PRE-PROD and PROD. When you deploy the \", \"web app, you\\u2019ll deploy to the staging slot of the\\nAzure web app, represented by the PRE-PROD environ\", \"ment. When you\\u2019re ready to deploy to PROD,\\nyou\\u2019ll just perform a slot swap.\\nIn this case, the only d\", \"ifference between the environments is the slot that you\\u2019re deploying to. In real\\nlife, there would t\", \"ypically be different web apps (and separate web app plans), separate resource\\ngroups, and even sepa\", \"rate subscriptions. Typically, there\\u2019s an SPN per environment. You may want to\\noverride the AZURE_CR\", \"EDENTIAL value that you saved as a repository secret by creating it as an\\nenvironment secret.\\nNote\\nP\", \"recedence works from Environment to repository. If a targeted environment has a secret called\\nMY_SEC\", \"RET, then that value is used. If not, the repository value of MY_SECRET (if any) is used.\\n1. Select \", \"Settings and then Environments in your repository. Select New Environment:\\n**Figure 3**: Create an e\", \"nvironment.\\n1. Enter PRE-PROD and select Configure environment:\\n**Figure 4**: Name the environment.\\n\", \"64 CHAPTER 3 | Continuous integration and deployment with Azure DevOps1. Since deploying to a stagin\", \"g slot doesn\\u2019t affect the web app, you can safely deploy to the slot\\nwithout requiring an approval f\", \"irst. A reviewer could be added if desired. For this example,\\nleave the Environment protection rules\", \" empty.\\n[!NOTE] If you target an environment in a workflow and it does not exist, an \\u201cempty\\u201d\\nenviron\", \"ment is created automatically. The environment would look exactly the same as the\\nPRE-PROD environme\", \"nt - it would exist, but would not have any protection rules enabled.\\n2. Select Environments again a\", \"nd again select New Environment. Now enter PROD as the\\nname and select Configure environment.\\n3. Che\", \"ck the Required reviewers rule and add yourself as a reviewer. Don\\u2019t forget to select\\nSave protectio\", \"n rules:\\n**Figure 5**: Add protection rules.\\nDeploy to staging\\nYou can now add additional jobs to th\", \"e workflow to deploy to the environments! You\\u2019ll start by\\nadding a deployment to the PRE-PROD enviro\", \"nment, which in this case is the web app staging slot.\\n1. Navigate to the .github/workflows/dotnet.y\", \"ml file and select the pencil icon to edit the file.\\n2. You\\u2019re going to use the web app name a few t\", \"imes in this workflow, and will need the name\\nof the resource group too. You\\u2019ll define the app and r\", \"esource group names as variables. With\\nthe variables, you can maintain the values in one place in th\", \"e workflow file.\\n3. Add this snippet below the on block and above the jobs block:\\n:::{custom-style=C\", \"odeBox} ```yml env: app-name: \\u201c\\u201d rg-name: \\u201c\\u201d\\njobs: # <\\u2013 this is the existing jobs line ``` :::\\n[!WAR\", \"NING] You\\u2019ll need to replace <name of your web app> with the actual name of your\\nweb app, and <name \", \"of your resource group> with the actual name of your resource group.\\n4. Add a new job below the buil\", \"d job as follows:\\n65 CHAPTER 3 | Continuous integration and deployment with Azure DevOps:::{custom-s\", \"tyle=CodeBox} ```yml if-no-files-found: error # <\\u2013 last line of build job: insert\\nbelow this line\\nde\", \"ploy_staging: needs: build runs-on: ubuntu-latest\\nenvironment:\\nname: PRE-PROD\\nurl: ${{ steps.deployw\", \"ebapp.outputs.webapp-url }}\\nsteps:\\n- name: Download a Build Artifact\\nuses: actions/download-artifact\", \"@v3\\nwith:\\nname: website\\npath: website\\n- name: Login via Azure CLI\\nuses: azure/login@v1\\nwith:\\ncreds: \", \"${{ secrets.AZURE_CREDENTIALS }}\\n- name: Deploy web app\\nid: deploywebapp\\nuses: azure/webapps-deploy@\", \"v2\\nwith:\\napp-name: ${{ env.app-name }}\\nslot-name: staging\\npackage: website\\n- name: az cli logout\\nrun\", \": az logout\\n``` :::\\nThe preceding workflow defines several steps:\\n1. You\\u2019re creating a new job calle\", \"d deploy_staging.\\n2. You specify a dependency using needs. This job needs the build job to complete\\n\", \"successfully before it starts.\\n3. This job also runs on the latest Ubuntu hosted agent, as specified\", \" with the runs-on\\nattribute.\\n4. You specify that this job is targeting the PRE-PROD environment usin\", \"g the\\nenvironment object. You also specify the url property. This URL will be displayed in\\nthe workf\", \"low diagram, giving users an easy way to navigate to the environment. The\\nvalue of this property is \", \"set as the output of the step with id deploywebapp, which is\\ndefined below.\\n5. You\\u2019re executing a do\", \"wnload-artifact step to download the artifact (compiled web\\napp) from the build job.\\n6. You then log\", \"in to Azure using the AZURE_CREDENTIALS secret you saved earlier.\\nNote the ${{ }} notation for deref\", \"erencing variables.\\n7. You then perform a webapp-deploy, specifying the app-name, slot-name, and pat\", \"h to\\nthe downloaded artifact (package). This action also defines an output parameter that\\nyou use to\", \" set the url of the environment above.\\n66 CHAPTER 3 | Continuous integration and deployment with Azu\", \"re DevOps8. Finally, you execute a logout to log out of the Azure context.\\n5. Commit the file.\\n6. Wh\", \"en the run completes, you should see two successful jobs. The URL for the PRE-PROD\\nstage has been se\", \"t and selecting it will navigate you to your web app staging slot:\\n**Figure 6**: Deployment to PRE-P\", \"ROD is successful.\\n1. Notice how the staging slot\\u2019s direct URL contains -staging:\\n**Figure 7**: The \", \"staging slot running.\\n1. You can also now see deployments. Navigate to https://{your repository url}\", \"/deployments to\\nview your deployments:\\n67 CHAPTER 3 | Continuous integration and deployment with Azu\", \"re DevOps**Figure 8**: View deployments.\\nDeploy to production\\nNow that you\\u2019ve deployed successfully \", \"to PRE-PROD, you\\u2019ll want to deploy to PROD. Deployment to\\nPROD will be slightly different since you \", \"don\\u2019t need to copy the website again - you just need to swap\\nthe staging slot with the production sl\", \"ot. You\\u2019ll do this using an Azure CLI (az) command.\\n1. Navigate to the .github/workflows/dotnet.yml \", \"file and select the pencil icon to edit the file.\\n2. Add a new job below the deploy_staging job as f\", \"ollows:\\n:::{custom-style=CodeBox} ```yml run: az logout # <\\u2013 last line of previous job: insert below\", \" this\\nline\\ndeploy_prod: needs: deploy_staging runs-on: ubuntu-latest\\nenvironment:\\nname: PROD\\nurl: ${\", \"{ steps.slot_swap.outputs.url }}\\nsteps:\\n- name: Login via Azure CLI\\nuses: azure/login@v1\\nwith:\\ncreds\", \": ${{ secrets.AZURE_CREDENTIALS }}\\n- name: Swap staging slot into production\\nid: slot_swap\\nrun: |\\naz\", \" webapp deployment slot swap -g ${{ env.rg-name }} -n ${{ env.app-name }} -s staging\\nurl=$(az webapp\", \" show -g ${{ env.rg-name }} -n ${{ env.app-name }} --query\\n\\\"defaultHostName\\\" -o tsv)\\necho \\\"::set-out\", \"put name=url::http://$url\\\"\\n- name: az cli logout\\nrun: az logout\\n``` :::\\nThe deployment to the PROD e\", \"nvironment workflow specifies several steps:\\n1. Once again, you specify a new job deploy_prod that n\", \"eeds deploy_staging to\\ncomplete before starting.\\n2. You\\u2019re targeting the PROD environment this time.\", \" Also, the url value is different from\\nbefore.\\n68 CHAPTER 3 | Continuous integration and deployment \", \"with Azure DevOps3. For the steps, you don\\u2019t need to download the artifact since you\\u2019re just going t\", \"o\\nperform a slot swap. You start by executing a login to the Azure context.\\n4. The Swap staging slot\", \" into production step is a multi-line run command (note the use\\nof the pipe symbol |). You also spec\", \"ify an id for this step so that you can refer to it\\n(you refer to it in the url property of the envi\", \"ronment). The first line executes the slot\\nswap using the variables you defined above in the workflo\", \"w. The second line uses an\\naz webapp show command to extract the URL of the target web app. This fin\", \"al line\\nuses ::set-output in an echo to create an output variable for this task, setting the value\\nt\", \"o the web app URL.\\n[!NOTE] The URL must start with http:// or https:// or it won\\u2019t render.\\n3. Commit\", \" the file.\\n4. Let the workflow run for a couple minutes until it has deployed to PRE-PROD. At this p\", \"oint,\\nthe workflow will pause and wait for the required approval since you\\u2019re targeting the PROD\\nenv\", \"ironment, which requires an approval as defined earlier:\\n**Figure 9**: Waiting for an approval.\\n1. S\", \"elect Review deployments, select the PROD checkbox, optionally add a comment, and then\\nselect Approv\", \"e and deploy to start the PROD job.\\n**Figure 10**: Approve the PROD deployment.\\n1. The deployment sh\", \"ould only take a few seconds. Once it has completed, the URL for the\\nPROD environment will update.\\n6\", \"9 CHAPTER 3 | Continuous integration and deployment with Azure DevOps**Figure 11**: PROD deployment \", \"completed.\\n1. Selecting the PROD URL will navigate you to the PROD site.\\n**Figure 12**: The PROD sit\", \"e.\\nAdd a manual queue option\\nYou now have an end-to-end build and deploy workflow, including approva\", \"ls. One more change you\\ncan make is to add a manual trigger to the workflow so that the workflow can\", \" be triggered from\\nwithin the Actions tab of the repository.\\n1. Navigate to the .github/workflows/do\", \"tnet.yml file and select the pencil icon to edit the file.\\n2. Add a new trigger between on and push \", \"on lines 3 and 4:\\n:::{custom-style=CodeBox} yml on: workflow_dispatch: # <-- this is the new line pu\", \"sh: :::\\n3. The workflow_dispatch trigger displays a Run workflow button in the Actions tab of the\\nre\", \"pository\\u2014but only if the trigger is defined in the default branch. However, once this trigger is\\ndef\", \"ined in the workflow, you can select the branch for the run.\\n4. Commit the file.\\n70 CHAPTER 3 | Cont\", \"inuous integration and deployment with Azure DevOps5. To see the Run workflow button, select the Act\", \"ions tab. Select the .NET workflow in the list\\nof workflows. At the top of the list of runs, you\\u2019ll \", \"see the Run workflow button. If you select\\nit, you can choose the branch to run the workflow against\", \" and queue it:\\n**Figure 13**: Manual dispatch.\\nHandle environment configuration\\nYour workflow is dep\", \"loying the same binary to each environment. This concept is important to ensure\\nthat the binaries yo\", \"u test in one environment are the same that you deploy to the next. However,\\nenvironments typically \", \"have different settings like database connection strings. You want to ensure\\nthat the DEV app is usi\", \"ng DEV settings and the PROD app is using PROD settings.\\nFor this simple app, there\\u2019s no database co\", \"nnection string. However, there\\u2019s an example configuration\\nsetting that you can modify for each envi\", \"ronment. If you open the simple-feed-\\nreader/SimpleFeedReader/appsettings.json file, you\\u2019ll see that\", \" the configuration includes a setting for\\nthe Header text on the Index page:\\n\\\"UI\\\": {\\n\\\"Index\\\": {\\n\\\"Hea\", \"der\\\": \\\"Simple News Reader\\\"\\n}\\n},\\nTo show how environment configuration can be handled, you\\u2019re going t\", \"o add a secret to each\\nenvironment and then substitute that value into the settings as you deploy.\\nA\", \"dd environment secrets\\n1. On your repository, select Settings > Environments > PRE-PROD.\\n2. Select A\", \"dd secret and add a secret called index_header with the value PRE PROD News\\nReader. Select Add secre\", \"t.\\n71 CHAPTER 3 | Continuous integration and deployment with Azure DevOps**Figure 14**: Add an envir\", \"onment secret.\\n1. Repeat these steps to add a secret called index_header with the value PROD News Re\", \"ader for\\nthe PROD environment.\\n2. If you select Settings > Secrets in the repository, you\\u2019ll see the\", \" changes. They should look\\nsomething like this:\\n**Figure 15**: View secrets.\\nUpdate the workflow to \", \"handle configuration\\n1. Navigate to the .github/workflows/dotnet.yml file and select the pencil icon\", \" to edit the file.\\n2. Add the following step before the az cli logout step in the deploy_staging job\", \":\\n:::{custom-style=CodeBox} ```yml - name: Update config uses: Azure/appservice-settings@v1\\nwith: ap\", \"p-name: ${{ env.app-name }} slot-name: staging app-settings-json: | [ { \\\"name\\\":\\n\\\"UI:Index:Header\\\", \\\"\", \"value\\\": \\\"${{ secrets.INDEX_HEADER }}\\u201c,\\u201dslotSetting\\u201d: true } ]\\n- name: az cli logout # <-- this exist\", \"s already\\n``` :::\\n72 CHAPTER 3 | Continuous integration and deployment with Azure DevOps3. Add almos\", \"t the same code to the deploy_prod job above its az cli logout step. The only\\ndifference is that you\", \" don\\u2019t specify a slot-name, since you\\u2019re targeting the production slot:\\n:::{custom-style=CodeBox} ``\", \"`yml - name: Update config uses: Azure/appservice-settings@v1\\nwith: app-name: ${{ env.app-name }} ap\", \"p-settings-json: | [ { \\\"name\\\": \\\"UI:Index:Header\\\",\\n\\\"value\\\": \\\"${{ secrets.INDEX_HEADER }}\\u201c,\\u201dslotSettin\", \"g\\u201d: true } ]\\n- name: az cli logout # <-- this exists already\\n``` :::\\n4. Commit the file.\\n5. Let the \", \"workflow run and approve the deployment to PROD once the approval is reached.\\n6. You should see the \", \"following headers on the index page for both sites:\\n**Figure 16**: Settings changed in the environme\", \"nts.\\nFinal workflow file\\nThe final workflow file should look like this:\\nname: .NET\\non:\\nworkflow_disp\", \"atch:\\ninputs:\\nreason:\\ndescription: 'The reason for running the workflow'\\nrequired: true\\ndefault: 'Ma\", \"nual build from GitHub UI'\\npush:\\nbranches: [ main ]\\npull_request:\\nbranches: [ main ]\\nenv:\\napp-name: \", \"\\\"cd-simplefeedreader\\\"\\nrg-name: \\\"cd-dotnetactions\\\"\\njobs:\\nbuild:\\n73 CHAPTER 3 | Continuous integration\", \" and deployment with Azure DevOpsruns-on: ubuntu-latest\\nsteps:\\n- uses: actions/checkout@v3\\n- name: '\", \"Print manual run reason'\\nif: ${{ github.event_name == 'workflow_dispatch' }}\\nrun: |\\necho 'Reason: ${\", \"{ github.event.inputs.reason }}'\\n- name: Setup .NET\\nuses: actions/setup-dotnet@v3\\nwith:\\ndotnet-versi\", \"on: 6.0.x\\n- name: Restore dependencies\\nrun: dotnet restore\\n- name: Build\\nrun: dotnet build --no-rest\", \"ore\\n- name: Test\\nrun: dotnet test --no-build --verbosity normal\\n- name: Publish\\nrun: dotnet publish \", \"SimpleFeedReader/SimpleFeedReader.csproj -c Release -o website\\n- name: Upload a Build Artifact\\nuses:\", \" actions/upload-artifact@v3\\nwith:\\nname: website\\npath: SimpleFeedReader/website/**\\nif-no-files-found:\", \" error\\ndeploy_staging:\\nneeds: build\\nruns-on: ubuntu-latest\\nenvironment:\\nname: STAGING\\nurl: ${{ steps\", \".deploywebapp.outputs.webapp-url }}\\nsteps:\\n- name: Download a Build Artifact\\nuses: actions/download-\", \"artifact@v3\\nwith:\\nname: website\\npath: website\\n- name: Login via Azure CLI\\nuses: azure/login@v1\\nwith:\", \"\\ncreds: ${{ secrets.AZURE_CREDENTIALS }}\\n- name: Deploy web app\\nid: deploywebapp\\nuses: azure/webapps\", \"-deploy@v2\\nwith:\\napp-name: ${{ env.app-name }}\\nslot-name: staging\\npackage: website\\n- name: Update co\", \"nfig\\nuses: Azure/appservice-settings@v1\\nwith:\\napp-name: ${{ env.app-name }}\\nslot-name: staging\\napp-s\", \"ettings-json: |\\n74 CHAPTER 3 | Continuous integration and deployment with Azure DevOps[\\n{\\n\\\"name\\\": \\\"U\", \"I:Index:Header\\\",\\n\\\"value\\\": \\\"${{ secrets.INDEX_HEADER }}\\\",\\n\\\"slotSetting\\\": true\\n}\\n]\\n- name: az cli logo\", \"ut\\nrun: az logout\\ndeploy_prod:\\nneeds: deploy_staging\\nruns-on: ubuntu-latest\\nenvironment:\\nname: PROD\\n\", \"url: ${{ steps.slot_swap.outputs.url }}\\nsteps:\\n- name: Login via Azure CLI\\nuses: azure/login@v1\\nwith\", \":\\ncreds: ${{ secrets.AZURE_CREDENTIALS }}\\n- name: Swap staging slot into production\\nid: slot_swap\\nru\", \"n: |\\naz webapp deployment slot swap -g ${{ env.rg-name }} -n ${{ env.app-name }} -s\\nstaging\\nurl=$(az\", \" webapp show -g ${{ env.rg-name }} -n ${{ env.app-name }} --query\\n\\\"defaultHostName\\\" -o tsv)\\necho \\\"::\", \"set-output name=url::http://$url\\\"\\n- name: Update config\\nuses: Azure/appservice-settings@v1\\nwith:\\napp\", \"-name: ${{ env.app-name }}\\napp-settings-json: |\\n[\\n{\\n\\\"name\\\": \\\"UI:Index:Header\\\",\\n\\\"value\\\": \\\"${{ secrets\", \".INDEX_HEADER }}\\\",\\n\\\"slotSetting\\\": true\\n}\\n]\\n- name: az cli logout\\nrun: az logout\\nSecure .NET Code wit\", \"h CodeQL and GitHub Actions\\nCodeQL is a static code analysis engine that can automate security and q\", \"uality checks. With CodeQL,\\nyou can perform variant analysis, which uses known vulnerabilities as se\", \"eds to find similar issues.\\nCodeQL is part of GitHub Advanced Security that includes:\\n[!div class=\\u201cc\", \"hecklist\\u201d]\\n75 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\u2022 Code scanning\\u2014fin\", \"d potential security vulnerabilities in your code.\\n\\u2022 Secret scanning\\u2014detect secrets and tokens that \", \"are committed.\\n\\u2022 Dependency scanning\\u2014detect vulnerabilities in packages that you consume.\\nCodeQL sup\", \"ports some of the most popular programming languages and compilers:\\n\\u2022 C/C++\\n\\u2022 Java\\n\\u2022 C#\\n\\u2022 Python\\n\\u2022 G\", \"o\\n\\u2022 JavaScript\\n\\u2022 TypeScript\\nCodeQL is a powerful language and security professionals can create cust\", \"om queries using CodeQL.\\nHowever, teams can benefit immensely from the large open-source collection \", \"of queries that the\\nsecurity community has created without having to write any custom CodeQL.\\nIn thi\", \"s article, you\\u2019ll set up a GitHub workflow that will scan code in your repository using CodeQL.\\nYou \", \"will:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Create a code scanning action.\\n\\u2022 Edit the workflow file to include \", \"custom scan settings.\\n\\u2022 See scanning results.\\nNote\\nTo see security alerts for your repository, you m\", \"ust be a repository owner.\\nCreate the code scanning workflow\\nYou can use a starter workflow for code\", \" scanning by navigating to the Security tab of your repository.\\n1. Navigate to your GitHub repositor\", \"y and select the Security > Code Scanning Alerts. The top\\nrecommended workflow should be CodeQL Anal\", \"ysis. Select Set up this workflow.\\n**Figure 1:** Create a new code scanning workflow.\\n76 CHAPTER 3 |\", \" Continuous integration and deployment with Azure DevOps1. A new workflow file is created in your .g\", \"ithub/workflows folder.\\n2. Select Start Commit on the upper right to save the default workflow. You \", \"can commit to the\\nmain branch.\\n**Figure 2:** Commit the file.\\n1. Select the Actions tab. In the left\", \"-hand tree, you\\u2019ll see a CodeQL node. Select this node to\\nfilter for CodeQL workflow runs.\\n**Figure \", \"3:** View the CodeQL workflow runs.\\nTake a look at the workflow file while it runs. If you remove th\", \"e comments from the file, you\\u2019ll see the\\nfollowing YAML:\\nname: \\\"CodeQL\\\"\\non:\\npush:\\nbranches: [ main ]\", \"\\npull_request:\\nbranches: [ main ]\\nschedule:\\n- cron: '40 14 * * 6'\\njobs:\\nanalyze:\\nname: Analyze\\nruns-\", \"on: ubuntu-latest\\nstrategy:\\nfail-fast: false\\n77 CHAPTER 3 | Continuous integration and deployment wi\", \"th Azure DevOpsmatrix:\\nlanguage: [ 'csharp' ]\\nsteps:\\n- name: Checkout repository\\nuses: actions/check\", \"out@v3\\n- name: Initialize CodeQL\\nuses: github/codeql-action/init@v1\\nwith:\\nlanguages: ${{ matrix.lang\", \"uage }}\\n- name: Autobuild\\nuses: github/codeql-action/autobuild@v1\\n- name: Perform CodeQL Analysis\\nus\", \"es: github/codeql-action/analyze@v1\\nNotice the following things:\\n1. The workflow name is CodeQL.\\n2. \", \"This workflow triggers on push and pull_request events to the main branch. There\\u2019s also a\\ncron trigg\", \"er. The cron trigger lets you define a schedule for triggering this workflow and is\\nrandomly generat\", \"ed for you. In this case, this workflow will run at 14:40 UTC every Saturday.\\n[!TIP] If you edit the\", \" workflow file and hover over the cron expression, a tooltip will show you\\nthe English text for the \", \"cron expression.\\n3. There\\u2019s a single job called analyze that runs on the ubuntu-latest hosted agent.\", \"\\n4. This workflow defines a strategy with a matrix on the array of language. In this case, there\\u2019s\\no\", \"nly csharp. If the repository contained other languages, you could add them to this array.\\nThis caus\", \"es the job to \\u201cfan out\\u201d and create an instance per value of the matrix.\\n5. There are four steps, sta\", \"rting with checkout.\\n6. The second step initializes the CodeQL scanner for the language this job is \", \"going to scan.\\nCodeQL intercepts calls to the compiler to build a database of the code while the cod\", \"e is\\nbeing built.\\n7. The Autobuild step will attempt to automatically build the source code using co\", \"mmon\\nconventions. If this step fails, you can replace it with your own custom build steps.\\n8. After \", \"building, the CodeQL analysis is performed, where suites of queries are run against the\\ncode databas\", \"e.\\n9. The run should complete successfully. However, there appear to be no issues.\\n78 CHAPTER 3 | Co\", \"ntinuous integration and deployment with Azure DevOps**Figure 4:** No results to the initial scan.\\nC\", \"ustomize CodeQL settings\\nThe CodeQL scan isn\\u2019t reporting any security issues. That\\u2019s expected with t\", \"his basic sample. CodeQL\\ncan also scan for quality issues. The current workflow is using the default\", \" security-extended suite. You\\ncan add quality scanning in by adding a configuration file to customiz\", \"e the scanning suites. In this\\nstep, you\\u2019ll configure CodeQL to use the security-and-quality suites.\", \"\\n[!INFORMATION] For other CodeQL configuration options, see Configuring CodeQL code scanning in\\nyour\", \" CI system.\\n1. Navigate to the .github folder in the Code tab and select Add File:\\n**Figure 5:** Cre\", \"ate a new file.\\n1. Enter codeql/codeql-config.yml as the name. This creates the file in a folder. Pa\", \"ste in the\\nfollowing code:\\n:::{custom-style=CodeBox} ```yml name: \\u201cSecurity and Quality\\u201d\\nqueries:\\n\\u2013 \", \"uses: security-and-quality ``` :::\\n79 CHAPTER 3 | Continuous integration and deployment with Azure D\", \"evOps**Figure 6:** Create the CodeQL configuration file.\\n1. Select Commit to main at bottom of the e\", \"ditor to commit the file.\\n2. Edit the CodeQL workflow to use the new configuration file. Navigate to\", \"\\n.github/workflows/codeql-analysis.yml and select the pencil icon. Add a new property to the\\nwith se\", \"ction as shown below:\\n:::{custom-style=CodeBox} yml - name: Initialize CodeQL uses: github/codeql-ac\", \"tion/init@v1\\nwith: languages: ${{ matrix.language }} config-file: ./.github/codeql/codeql-config.yml\", \" # <--\\nadd this line :::\\n1. Select Start Commit and commit to the main branch.\\nReview the security a\", \"lerts\\nImportant\\nYou must be a repository owner to view security alerts.\\nThis sample repository is sm\", \"all. As such, it doesn\\u2019t contain any major security or quality issues.\\nHowever, \\u201creal world\\u201d reposit\", \"ories will likely have some issues.\\nWhen the last CodeQL workflow run completes, you should see two \", \"issues in the Security tab:\\n80 CHAPTER 3 | Continuous integration and deployment with Azure DevOpsFi\", \"gure 7: View security alerts.\\n1. Select the first alert to open it.\\n2. In this case, the alert is fo\", \"r a generated file that isn\\u2019t committed to the repository. For that\\nreason, the preview is unavailab\", \"le.\\n3. Notice the tags that are applied. These tags can be used for filtering issues.\\n4. Select Show\", \" more under the rule information to show help and recommendations.\\n**Figure 8:** Open an alert.\\n1. S\", \"electing Dismiss will open options for dismissing this issue:\\n81 CHAPTER 3 | Continuous integration \", \"and deployment with Azure DevOps**Figure 9:** Dismiss an alert.\\n82 CHAPTER 3 | Continuous integratio\", \"n and deployment with Azure DevOps4\\nCHAPTER\\nMonitor and debug\\nHaving deployed the app and built a De\", \"vOps pipeline, it\\u2019s important to understand how to monitor\\nand troubleshoot the app.\\nIn this section\", \", you\\u2019ll complete the following tasks:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Find basic monitoring and troubles\", \"hooting data in the Azure portal\\n\\u2022 Learn how Azure Monitor provides a deeper look at metrics across \", \"all Azure services\\n\\u2022 Connect the web app with Application Insights for app profiling\\n\\u2022 Turn on loggi\", \"ng and learn where to download logs\\n\\u2022 Stream logs in real time\\n\\u2022 Learn where to set up alerts\\n\\u2022 Lear\", \"n about remote debugging Azure App Service web apps.\\nBasic monitoring and troubleshooting\\nApp Servic\", \"e web apps are easily monitored in real time. The Azure portal renders metrics in easy-to-\\nunderstan\", \"d charts and graphs.\\n1. Open the Azure portal, and then navigate to the mywebapp<unique_number> App \", \"Service.\\n2. The Overview tab displays useful \\u201cat-a-glance\\u201d information, including graphs displaying\\n\", \"recent metrics.\\n83 CHAPTER 4 | Monitor and debug* **Http 5xx**: Count of server-side errors, usually\", \" exceptions in ASP.NET Core code.\\n* **Data In**: Data ingress coming into your web app.\\n* **Data Out\", \"**: Data egress from your web app to clients.\\n* **Requests**: Count of HTTP requests.\\n* **Average Re\", \"sponse Time**: Average time for the web app to respond to HTTP requests.\\nSeveral self-service tools \", \"for troubleshooting and optimization are also found on this\\npage.\\n* **Diagnose and solve problems** \", \"is a self-service troubleshooter.\\n* **Application Insights** is for profiling performance and app be\", \"havior, and is\\ndiscussed later in this section.\\n* **App Service Advisor** makes recommendations to t\", \"une your app experience.\\nAdvanced monitoring\\nAzure Monitor is the centralized service for monitoring\", \" all metrics and setting alerts across Azure\\nservices. Within Azure Monitor, administrators can gran\", \"ularly track performance and identify trends.\\nEach Azure service offers its own set of metrics to Az\", \"ure Monitor.\\nProfile with Application Insights\\nApplication Insights is an Azure service for analyzin\", \"g the performance and stability of web apps and\\nhow users use them. The data from Application Insigh\", \"ts is broader and deeper than that of Azure\\nMonitor. The data can provide developers and administrat\", \"ors with key information for improving\\napps. Application Insights can be added to an Azure App Servi\", \"ce resource without code changes.\\n1. Open the Azure portal, and then navigate to the mywebapp<unique\", \"_number> App Service.\\n2. From the Overview tab, click the Application Insights tile.\\n84 CHAPTER 4 | \", \"Monitor and debug1. Select the Create new resource radio button. Use the default resource name, and \", \"select the\\nlocation for the Application Insights resource. The location doesn\\u2019t need to match that o\", \"f your\\nweb app.\\n1. For Runtime/Framework, select ASP.NET Core. Accept the default settings.\\n2. Selec\", \"t OK. If prompted to confirm, select Continue.\\n3. After the resource has been created, click the nam\", \"e of Application Insights resource to\\nnavigate directly to the Application Insights page.\\nAs the app\", \" is used, data accumulates. Select Refresh to reload the blade with new data.\\n85 CHAPTER 4 | Monitor\", \" and debugApplication Insights provides useful server-side information with no additional configurat\", \"ion. To get\\nthe most value from Application Insights, instrument your app with the Application Insig\", \"hts SDK.\\nWhen properly configured, the service provides end-to-end monitoring across the web server \", \"and\\n86 CHAPTER 4 | Monitor and debugbrowser, including client-side performance. For more information\", \", see the Application Insights\\ndocumentation.\\nLogging\\nWeb server and app logs are disabled by defaul\", \"t in Azure App Service. Enable the logs with the\\nfollowing steps:\\n1. Open the Azure portal, and navi\", \"gate to the mywebapp<unique_number> App Service.\\n2. In the menu to the left, scroll down to the Moni\", \"toring section. Select Diagnostics logs.\\n1. Turn on Application Logging (Filesystem). If prompted, c\", \"lick the box to install the\\nextensions to enable app logging in the web app.\\n2. Set Web server loggi\", \"ng to File System.\\n3. Enter the Retention Period in days. For example, 30.\\n4. Click Save.\\nASP.NET Co\", \"re and web server (App Service) logs are generated for the web app. They can be\\ndownloaded using the\", \" FTP/FTPS information displayed. The password is the same as the deployment\\ncredentials created earl\", \"ier in this guide. The logs can be streamed directly to your local machine with\\nPowerShell or Azure \", \"CLI. Logs can also be viewed in Application Insights.\\nLog streaming\\nApp and web server logs can be s\", \"treamed in real time through the portal.\\n1. Open the Azure portal, and navigate to the mywebapp<uniq\", \"ue_number> App Service.\\n2. In the menu to the left, scroll down to the Monitoring section and select\", \" Log stream.\\n87 CHAPTER 4 | Monitor and debugLogs can also be streamed via Azure CLI or Azure PowerS\", \"hell, including through the Cloud Shell.\\nAlerts\\nAzure Monitor also provides real time alerts based o\", \"n metrics, administrative events, and other\\ncriteria.\\nNote\\nCurrently alerting on web app metrics is \", \"only available in the Alerts (classic) service.\\nThe Alerts (classic) service can be found in Azure M\", \"onitor or under the Monitoring section of the App\\nService settings.\\nLive debugging\\nAzure App Service\", \" can be debugged remotely with Visual Studio when logs don\\u2019t provide enough\\ninformation. However, re\", \"mote debugging requires the app to be compiled with debug symbols.\\nDebugging shouldn\\u2019t be done in pr\", \"oduction, except as a last resort.\\n88 CHAPTER 4 | Monitor and debugConclusion\\nIn this section, you c\", \"ompleted the following tasks:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Find basic monitoring and troubleshooting d\", \"ata in the Azure portal\\n\\u2022 Learn how Azure Monitor provides a deeper look at metrics across all Azure\", \" services\\n\\u2022 Connect the web app with Application Insights for app profiling\\n\\u2022 Turn on logging and le\", \"arn where to download logs\\n\\u2022 Stream logs in real time\\n\\u2022 Learn where to set up alerts\\n\\u2022 Learn about r\", \"emote debugging Azure App Service web apps.\\nAdditional reading\\n\\u2022 Troubleshooting ASP.NET Core on Azu\", \"re App Service and IIS\\n\\u2022 Common errors reference for Azure App Service and IIS with ASP.NET Core\\n\\u2022 M\", \"onitor Azure web app performance with Application Insights\\n\\u2022 Enable diagnostics logging for web apps\", \" in Azure App Service\\n\\u2022 Troubleshoot a web app in Azure App Service using Visual Studio\\n\\u2022 Create cla\", \"ssic metric alerts in Azure Monitor for Azure services - Azure portal\\n89 CHAPTER 4 | Monitor and deb\", \"ug5\\nCHAPTER\\nNext steps\\nIn this guide, you created a DevOps pipeline for an ASP.NET Core sample app. \", \"Congratulations! We\\nhope you enjoyed learning to publish ASP.NET Core web apps to Azure App Service \", \"and automate the\\ncontinuous integration of changes.\\nBeyond web hosting and DevOps, Azure has a wide \", \"array of Platform-as-a-Service (PaaS) services\\nuseful to ASP.NET Core developers. This section gives\", \" a brief overview of some of the most commonly\\nused services.\\nStorage and databases\\nRedis Cache is h\", \"igh-throughput, low-latency data caching available as a service. It can be used for\\ncaching page out\", \"put, reducing database requests, and providing ASP.NET Core session state across\\nmultiple instances \", \"of an app.\\nAzure Storage is Azure\\u2019s massively scalable cloud storage. Developers can take advantage \", \"of Queue\\nStorage for reliable message queuing, and Table Storage is a NoSQL key-value store designed\", \" for\\nrapid development using massive, semi-structured data sets.\\nAzure SQL Database provides familia\", \"r relational database functionality as a service using the Microsoft\\nSQL Server Engine.\\nCosmos DB gl\", \"obally distributed, multi-model NoSQL database service. Multiple APIs are available,\\nincluding SQL A\", \"PI (formerly called DocumentDB), Cassandra, and MongoDB.\\nIdentity\\nAzure Active Directory and Azure A\", \"ctive Directory B2C are both identity services. Azure Active\\nDirectory is designed for enterprise sc\", \"enarios and enables Azure AD B2B (business-to-business)\\ncollaboration, while Azure Active Directory \", \"B2C is intended business-to-customer scenarios, including\\nsocial network sign-in.\\nMobile\\nNotificatio\", \"n Hubs is a multi-platform, scalable push-notification engine to quickly send millions of\\nmessages t\", \"o apps running on various types of devices.\\n90 CHAPTER 5 | Next stepsWeb infrastructure\\nAzure Contai\", \"ner Service manages your hosted Kubernetes environment, making it quick and easy to\\ndeploy and manag\", \"e containerized apps without container orchestration expertise.\\nAzure Search is used to create an en\", \"terprise search solution over private, heterogenous content.\\nService Fabric is a distributed systems\", \" platform that makes it easy to package, deploy, and manage\\nscalable and reliable microservices and \", \"containers.\\n91 CHAPTER 5 | Next steps\"]"