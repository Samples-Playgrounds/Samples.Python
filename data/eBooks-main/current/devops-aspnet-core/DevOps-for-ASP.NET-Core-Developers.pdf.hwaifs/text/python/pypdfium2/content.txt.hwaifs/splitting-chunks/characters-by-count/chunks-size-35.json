"[\"EDITION v1.1.0\\nRefer changelog for the book updates and community contributions.\\nThis guide is avail\", \"able as a downloadable PDF e-book.\\nPUBLISHED BY\\nMicrosoft Developer Division, .NET, and Visual Studi\", \"o product teams\\nA division of Microsoft Corporation\\nOne Microsoft Way\\nRedmond, Washington 98052-6399\", \"\\nCopyright \\u00a9 2022 by Microsoft Corporation\\nAll rights reserved. No part of the contents of this book\", \" may be reproduced or transmitted in any \\nform or by any means without the written permission of the\", \" publisher.\\nThis book is provided \\u201cas-is\\u201d and expresses the author\\u2019s views and opinions. The views, \", \"opinions, and \\ninformation expressed in this book, including URL and other Internet website referenc\", \"es, may change \\nwithout notice.\\nSome examples depicted herein are provided for illustration only and\", \" are fictitious. No real association \\nor connection is intended or should be inferred.\\nMicrosoft and\", \" the trademarks listed at https://www.microsoft.com on the \\u201cTrademarks\\u201d webpage are \\ntrademarks of t\", \"he Microsoft group of companies.\\nMac and macOS are trademarks of Apple Inc.\\nThe Docker whale logo is\", \" a registered trademark of Docker, Inc. Used by permission.\\nAll other marks and logos are property o\", \"f their respective owners.\\nCredits\\nAuthors:\\nCam Soper\\nScott Addie\\nColin Dembovsky\\nWelcome\\nWelcome to\", \" the Azure Development Lifecycle guide for .NET! This guide introduces the basic concepts \\nof buildi\", \"ng a development lifecycle around Azure using .NET tools and processes. After finishing this \\nguide,\", \" you\\u2019ll reap the benefits of a mature DevOps toolchain.\\nWho this guide is forYou should be an experi\", \"enced ASP.NET Core developer (200-300 level). You don\\u2019t need to know \\nanything about Azure, as we\\u2019ll\", \" cover that in this introduction. This guide may also be useful for \\nDevOps engineers who are more f\", \"ocused on operations than development.\\nThis guide targets Windows developers. However, Linux and mac\", \"OS are fully supported by .NET Core. \\nTo adapt this guide for Linux/macOS, watch for callouts for Li\", \"nux/macOS differences.\\nWhat this guide doesn\\u2019t cover\\nThis guide is focused on an end-to-end continuo\", \"us deployment experience for .NET developers. It\\u2019s \\nnot an exhaustive guide to all things Azure, and\", \" it doesn\\u2019t focus extensively on .NET APIs for Azure \\nservices. The emphasis is all around continuou\", \"s integration, deployment, monitoring, and debugging. \\nNear the end of the guide, recommendations fo\", \"r next steps are offered. Included in the suggestions \\nare Azure platform services that are useful t\", \"o ASP.NET Core developers.\\nWhat\\u2019s in this guide\\nTools and downloads\\nLearn where to acquire the tools\", \" used in this guide.\\nDeploy to App Service\\nLearn the various methods for deploying an ASP.NET Core a\", \"pp to Azure App Service.\\nContinuous integration and deployment with Azure DevOps\\nBuild an end-to-end\", \" continuous integration and deployment solution for your ASP.NET Core app with \\nGitHub, Azure DevOps\", \" Services, and Azure.\\nContinuous integration and deployment with GitHub Actions\\nBuild an end-to-end \", \"continuous integration and deployment solution for your ASP.NET Core app with \\nGitHub, GitHub Action\", \"s, and Azure, including code scanning for security and quality using CodeQL.\\nMonitor and debug\\nUse A\", \"zure\\u2019s tools to monitor, troubleshoot, and tune your application.\\nNext steps\\nOther learning paths fo\", \"r the ASP.NET Core developer learning Azure.\\nAdditional introductory reading\\nIf this is your first e\", \"xposure to cloud computing, these articles explain the basics.\\n\\u2022 What is Cloud Computing?\\n\\u2022 Examples\", \" of Cloud Computing\\u2022 What is IaaS?\\n\\u2022 What is PaaS?i Contents\\nContents\\nTools and downloads ..........\", \"....................................................................................................\", \" 1\\nPrerequisites ...................................................................................\", \"...........................................................................................1\\nRecomme\", \"nded tools (Windows only)...........................................................................\", \"...................................................1\\nDeploy an app to App Service...................\", \"............................................................................. 3\\nDownload and test th\", \"e app...............................................................................................\", \"..................................................3\\nCreate the Azure App Service Web App............\", \"....................................................................................................\", \".........5\\nDeployment with Visual Studio............................................................\", \"..............................................................................6\\nDeployment slots ...\", \"....................................................................................................\", \"..............................................................8\\nSummary ............................\", \"....................................................................................................\", \".................................................. 10\\nAdditional reading............................\", \"....................................................................................................\", \"................................ 10\\nContinuous integration and deployment with Azure DevOps ........\", \"................................. 11\\nPublish the app\\u2019s code to GitHub ..............................\", \"....................................................................................................\", \" 12\\nDisconnect local Git deployment ................................................................\", \"................................................................... 12\\nCreate an Azure DevOps organi\", \"zation..............................................................................................\", \"........................... 13\\nCreate a team project in Azure DevOps organization ..................\", \"......................................................................... 13\\nConfigure a self-hosted\", \" agent if necessary.................................................................................\", \"............................... 13\\nConfigure the Azure Pipelines pipeline...........................\", \"............................................................................................. 14\\nGra\", \"nt Azure DevOps access to the GitHub repository.....................................................\", \"................................. 14\\nCreate the build definition ...................................\", \"....................................................................................................\", \".... 16\\nCreate the release pipeline.................................................................\", \".......................................................................... 18\\nCommit changes to GitH\", \"ub and automatically deploy to Azure................................................................\", \"....... 22\\nExamine the Azure Pipelines pipeline.....................................................\", \"...................................................................... 23\\nBuild definition..........\", \"....................................................................................................\", \".................................................... 23\\nRelease pipeline............................\", \"....................................................................................................\", \"................................ 26\\nAdditional reading..............................................\", \"....................................................................................................\", \".............. 29\\nContinuous integration and deployment with Azure DevOps ..........................\", \"................................................. 30\\nPublish the app\\u2019s code to GitHub...............\", \"....................................................................................................\", \"........... 30\\nDisconnect local Git deployment......................................................\", \"......................................................................... 31ii Contents\\nCreate an Az\", \"ure DevOps organization ............................................................................\", \"........................................ 31\\nCreate a team project in Azure DevOps organization......\", \"................................................................................. 32\\nConfigure a sel\", \"f-hosted agent if necessary ........................................................................\", \"................................... 32\\nConfigure the Azure Pipelines pipeline.......................\", \"............................................................................................ 32\\nComm\", \"it changes to GitHub and automatically deploy to Azure..............................................\", \".................... 40\\nExamine the Azure Pipelines pipeline .......................................\", \"............................................................................... 41\\nAdditional readin\", \"g...................................................................................................\", \"........................................................ 47\\nContinuous integration and deployment wi\", \"th GitHub Actions.......................................................................... 48\\nGitHu\", \"b Actions ..........................................................................................\", \"........................................................................ 48\\nSecure code with CodeQL \", \"....................................................................................................\", \"........................................ 48\\nCompare and contrast GitHub Actions and Azure Pipelines \", \".......................................................................... 49\\nContinuous integration\", \" and deployment with GitHub Actions.................................................................\", \"......... 49\\nGitHub Actions ........................................................................\", \".......................................................................................... 49\\nSecure\", \" code with CodeQL ..................................................................................\", \".......................................................... 50\\nCompare and contrast GitHub Actions an\", \"d Azure Pipelines .......................................................................... 50\\nComp\", \"are and contrast GitHub Actions and Azure Pipelines.................................................\", \".............................. 50\\nPipelines as code.................................................\", \"....................................................................................................\", \"......... 50\\nAgents and runners.....................................................................\", \".................................................................................... 51\\nComparison o\", \"f GitHub Actions and Azure Pipelines ...............................................................\", \".......................... 52\\nBuild a .NET web app using GitHub Actions ............................\", \".................................................................................. 55\\nWorkflow struc\", \"ture................................................................................................\", \".......................................................... 55\\nCreate a basic build workflow.........\", \"....................................................................................................\", \"........................ 56\\nDissect the workflow file ..............................................\", \"................................................................................................. 58\", \"\\nPublish the output.................................................................................\", \".......................................................................... 59\\nDeploy a .NET web app \", \"using GitHub Actions................................................................................\", \".......................... 61\\nEnvironments .........................................................\", \"....................................................................................................\", \"........ 61\\nAzure authentication....................................................................\", \"................................................................................... 62\\nAdd environme\", \"nts ................................................................................................\", \"........................................................... 63\\nDeploy to staging....................\", \"....................................................................................................\", \"..................................... 65\\nDeploy to production ......................................\", \"....................................................................................................\", \"........... 68\\nAdd a manual queue option............................................................\", \"............................................................................ 70\\nHandle environment c\", \"onfiguration........................................................................................\", \"................................... 71iii Contents\\nFinal workflow file .............................\", \"....................................................................................................\", \"........................... 73\\nSecure .NET Code with CodeQL and GitHub Actions......................\", \"....................................................................... 75\\nCreate the code scanning \", \"workflow ...........................................................................................\", \".............................. 76\\nCustomize CodeQL settings.........................................\", \"................................................................................................ 79\\n\", \"Review the security alerts .........................................................................\", \".................................................................... 80\\nMonitor and debug...........\", \"....................................................................................................\", \" 83\\nBasic monitoring and troubleshooting ...........................................................\", \"............................................................. 83\\nAdvanced monitoring ...............\", \"....................................................................................................\", \"...................................... 84\\nProfile with Application Insights ........................\", \"....................................................................................................\", \"......... 84\\nLogging................................................................................\", \"....................................................................................................\", \". 87\\nLog streaming .................................................................................\", \"....................................................................................... 87\\nAlerts ..\", \"....................................................................................................\", \".................................................................................... 88\\nLive debuggi\", \"ng..................................................................................................\", \".................................................................... 88\\nConclusion .................\", \"....................................................................................................\", \".......................................................... 89\\nAdditional reading....................\", \"....................................................................................................\", \"........................................ 89\\nNext steps .............................................\", \"................................................................................. 90\\nStorage and dat\", \"abases .............................................................................................\", \".......................................................... 90\\nIdentity .............................\", \"....................................................................................................\", \"..................................................... 90\\nMobile ....................................\", \"....................................................................................................\", \"............................................... 90\\nWeb infrastructure...............................\", \"....................................................................................................\", \"............................. 911 CHAPTER 1 | Tools and downloads\\nCHAPTER 1\\nTools and downloads\\nAzur\", \"e has several interfaces for provisioning and managing resources, such as the Azure portal, Azure \\nC\", \"LI, Azure PowerShell, Azure Cloud Shell, and Visual Studio. This guide takes a minimalist approach \\n\", \"and uses the Azure Cloud Shell whenever possible to reduce the steps required. However, the Azure \\np\", \"ortal must be used for some portions.\\nPrerequisites\\nThe following subscriptions are required:\\n\\u2022 Azur\", \"e \\u2014 If you don\\u2019t have an account, get a free trial.\\n\\u2022 Azure DevOps Services \\u2014 your Azure DevOps subs\", \"cription and organization is created in \\nChapter 4.\\n\\u2022 GitHub \\u2014 If you don\\u2019t have an account, sign up\", \" for free.\\nThe following tools are required:\\n\\u2022 Git \\u2014 A fundamental understanding of Git is recommend\", \"ed for this guide. Review the Git \\ndocumentation, specifically git remote and git push.\\n\\u2022 .NET Core \", \"SDK \\u2014 Version 2.1.300 or later is required to build and run the sample app. If \\nVisual Studio is ins\", \"talled with the .NET Core cross-platform development workload, the \\n.NET Core SDK is already install\", \"ed.\\nVerify your .NET Core SDK installation. Open a command shell, and run the following \\ncommand:\\n::\", \":{custom-style=CodeBox} dotnetcli dotnet --version :::\\nRecommended tools (Windows only)\\n\\u2022 Visual Stu\", \"dio\\u2019s robust Azure tools provide a GUI for most of the functionality described in this \\nguide. Any e\", \"dition of Visual Studio will work, including the free Visual Studio Community \\nEdition. The tutorial\", \"s are written to demonstrate development, deployment, and DevOps both \\nwith and without Visual Studi\", \"o.\\nConfirm that Visual Studio has the following workloads installed:\\n\\u2013 ASP.NET and web development\\n\\u2013\", \" Azure development2 CHAPTER 1 | Tools and downloads\\n\\u2013 .NET Core cross-platform development3 CHAPTER \", \"2 | Deploy an app to App Service\\nCHAPTER 2\\nDeploy an app to App \\nService\\nAzure App Service is Azure\\u2019\", \"s web hosting platform. Deploying a web app to Azure App Service can be \\ndone manually or by an auto\", \"mated process. This section of the guide discusses deployment methods \\nthat can be triggered manuall\", \"y or by script using the command line, or triggered manually using \\nVisual Studio.\\nIn this section, \", \"you\\u2019ll accomplish the following tasks:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Download and build the sample app.\", \"\\n\\u2022 Create an Azure App Service Web App using the Azure Cloud Shell.\\n\\u2022 Deploy the sample app to Azure\", \" using Git.\\n\\u2022 Deploy a change to the app using Visual Studio.\\n\\u2022 Add a staging slot to the web app.\\n\\u2022\", \" Deploy an update to the staging slot.\\n\\u2022 Swap the staging and production slots.\\nDownload and test th\", \"e app\\nThe app used in this guide is a pre-built ASP.NET Core app, Simple Feed Reader. It\\u2019s an ASP.NE\", \"T Core \\nRazor Pages app that uses the Microsoft.SyndicationFeed.ReaderWriter API to retrieve an RSS/\", \"Atom \\nfeed and display the news items in a list.\\nFeel free to review the code, but it\\u2019s important to\", \" understand that there\\u2019s nothing special about this \\napp. It\\u2019s just a simple ASP.NET Core app for il\", \"lustrative purposes.\\nFrom a command shell, download the code, build the project, and run it as follo\", \"ws.\\nNote\\nLinux and macOS users should make appropriate changes for paths, for example, using forward\", \" slash \\n(/) rather than back slash (\\\\).*\\n1. Clone the code to a folder on your local machine.4 CHAPT\", \"ER 2 | Deploy an app to App Service\\n:::{custom-style=CodeBox} console git clone https://github.com/d\", \"otnet-architecture/simple\\u0002feed-reader/ :::\\n2. Change your working folder to the simple-feed-reader f\", \"older that was created.\\n:::{custom-style=CodeBox} console cd .\\\\simple-feed-reader\\\\SimpleFeedReader :\", \"::\\n3. Restore the packages, and build the solution.\\n:::{custom-style=CodeBox} dotnetcli dotnet build\", \" :::\\n4. Run the app.\\n:::{custom-style=CodeBox} dotnetcli dotnet run :::\\n \\n5. Open a browser and navi\", \"gate to http://localhost:5000. The app allows you to type or paste a \\nsyndication feed URL and view \", \"a list of news items.\\n 5 CHAPTER 2 | Deploy an app to App Service\\n6. Once you\\u2019re satisfied the app i\", \"s working correctly, shut it down by pressing Ctrl+C in the \\ncommand shell.\\nCreate the Azure App Ser\", \"vice Web App\\nTo deploy the app, you\\u2019ll need to create an App Service Web App. After creation of the \", \"Web App, \\nyou\\u2019ll deploy to it from your local machine using Git.\\n1. Sign in to the Azure Cloud Shell\", \". Note: When you sign in for the first time, Cloud Shell \\nprompts to create a storage account for co\", \"nfiguration files. Accept the defaults or provide a \\nunique name.\\n2. Use the Cloud Shell for the fol\", \"lowing steps.\\na. Declare a variable to store your web app\\u2019s name. The name must be unique to be \\nuse\", \"d in the default URL. Using the $RANDOM Bash function to construct the name \\nguarantees uniqueness a\", \"nd results in the format webappname99999.\\n:::{custom-style=CodeBox} console webappname=mywebapp$RAND\", \"OM :::\\nb. Create a resource group. Resource groups provide a means to aggregate Azure \\nresources to \", \"be managed as a group.\\n:::{custom-style=CodeBox} azurecli az group create --location centralus --nam\", \"e AzureTutorial \\n:::\\nThe az command invokes the Azure CLI. The CLI can be run locally, but using it \", \"in the Cloud \\nShell saves time and configuration.\\nc. Create an App Service plan in the S1 tier. An A\", \"pp Service plan is a grouping of web \\napps that share the same pricing tier. The S1 tier isn\\u2019t free,\", \" but it\\u2019s required for the \\nstaging slots feature.\\n:::{custom-style=CodeBox} azurecli az appservice \", \"plan create --name $webappname --\\nresource-group AzureTutorial --sku S1 :::\\nd. Create the web app re\", \"source using the App Service plan in the same resource group.\\n:::{custom-style=CodeBox} azurecli az \", \"webapp create --name $webappname --resource\\u0002group AzureTutorial --plan $webappname :::\\ne. Set the de\", \"ployment branch to main in the appsettings configuration.\\n:::{custom-style=CodeBox} azurecli az weba\", \"pp config appsettings set --name $webappname -\\n-resource-group AzureTutorial --settings DEPLOYMENT_B\", \"RANCH=main :::\\nf. Set the deployment credentials. These deployment credentials apply to all the web \", \"\\napps in your subscription. Don\\u2019t use special characters in the user name.\\n:::{custom-style=CodeBox}\", \" azurecli az webapp deployment user set --user-name \\nREPLACE_WITH_USER_NAME --password REPLACE_WITH_\", \"PASSWORD :::6 CHAPTER 2 | Deploy an app to App Service\\ng. Configure the web app to accept deployment\", \"s from local Git and display the Git \\ndeployment URL. Note this URL for reference later.\\n:::{custom-\", \"style=CodeBox} azurecli echo Git deployment URL: $(az webapp deployment \\nsource config-local-git --n\", \"ame $webappname --resource-group AzureTutorial --query url --\\noutput tsv) :::\\nh. Display the web app\", \" URL. Browse to this URL to see the blank web app. Note this \\nURL for reference later.\\n:::{custom-st\", \"yle=CodeBox} console echo Web app URL: \\nhttp://$webappname.azurewebsites.net :::\\n3. Using a command \", \"shell on your local machine, navigate to the web app\\u2019s project folder (for \\nexample, *.-feed-reader)\", \". Execute the following commands to set up Git to push to the \\ndeployment URL:\\na. Add the remote URL\", \" to the local repository.\\n:::{custom-style=CodeBox} console git remote add azure-prod GIT_DEPLOYMENT\", \"_URL :::\\nb. Push the local default branch (main) to the azure-prod remote\\u2019s deployment branch \\n(main\", \").\\n:::{custom-style=CodeBox} console git push azure-prod main :::\\nYou\\u2019ll be prompted for the deploym\", \"ent credentials you created earlier. Observe the output in \\nthe command shell. Azure builds the ASP.\", \"NET Core app remotely.\\n4. In a browser, navigate to the Web app URL and note the app has been built \", \"and deployed. \\nAdditional changes can be committed to the local Git repository with git commit. Thes\", \"e \\nchanges are pushed to Azure with the preceding git push command.\\nDeployment with Visual Studio\\nNo\", \"te\\nThis section applies to Windows only. Linux and macOS users should make the change described in \\n\", \"step 2 below. Save the file, and commit the change to the local repository with git commit. Finally,\", \" \\npush the change with git push, as in the first section.*\\nThe app has already been deployed from th\", \"e command shell. Let\\u2019s use Visual Studio\\u2019s integrated tools \\nto deploy an update to the app. Behind \", \"the scenes, Visual Studio accomplishes the same thing as the \\ncommand line tooling, but within Visua\", \"l Studio\\u2019s familiar UI.\\n1. Open SimpleFeedReader.sln in Visual Studio.\\n2. In Solution Explorer, open\", \" Pages.cshtml. Change <h2>Simple Feed Reader</h2> to \\n<h2>Simple Feed Reader - V2</h2>.\\n3. Press Ctr\", \"l+Shift+B to build the app.\\n4. In Solution Explorer, right-click on the project and click Publish.7 \", \"CHAPTER 2 | Deploy an app to App Service\\n \\n \\n5. Visual Studio can create a new App Service resource,\", \" but this update will be published over \\nthe existing deployment. In the Pick a publish target dialo\", \"g, select App Service from the list \\non the left, and then select Select Existing. Click Publish.\\n6.\", \" In the App Service dialog, confirm that the Microsoft or Organizational account used to \\ncreate you\", \"r Azure subscription is displayed in the upper right. If it\\u2019s not, click the drop-down \\nand add it.\\n\", \"7. Confirm that the correct Azure Subscription is selected. For View, select Resource Group. \\nExpand\", \" the AzureTutorial resource group and then select the existing web app. Click OK.\\n \\nVisual Studio bu\", \"ilds and deploys the app to Azure. Browse to the web app URL. Validate that the \\n<h2> element modifi\", \"cation is live.8 CHAPTER 2 | Deploy an app to App Service\\nDeployment slots\\nDeployment slots support \", \"the staging of changes without impacting the app running in production. \\nOnce the staged version of \", \"the app is validated by a quality assurance team, the production and \\nstaging slots can be swapped. \", \"The app in staging is promoted to production in this manner. The \\nfollowing steps create a staging s\", \"lot, deploy some changes to it, and swap the staging slot with \\nproduction after verification.\\n1. Si\", \"gn in to the Azure Cloud Shell, if not already signed in.\\n2. Create the staging slot.\\na. Create a de\", \"ployment slot with the name staging.\\n:::{custom-style=CodeBox} azurecli az webapp deployment slot cr\", \"eate --name $webappname \\n--resource-group AzureTutorial --slot staging :::\\nb. Set the deployment bra\", \"nch to main in the appsettings configuration.\\n:::{custom-style=CodeBox} azurecli az webapp config ap\", \"psettings set --name $webappname -\\n-resource-group AzureTutorial --slot staging --settings DEPLOYMEN\", \"T_BRANCH=main :::\\nc. Configure the staging slot to use deployment from local Git and get the staging\", \"\\ndeployment URL. Note this URL for reference later.\\n:::{custom-style=CodeBox} azurecli echo Git depl\", \"oyment URL for staging: $(az webapp \\ndeployment source config-local-git --name $webappname --resourc\", \"e-group AzureTutorial --\\nslot staging --query url --output tsv) :::\\nd. Display the staging slot\\u2019s UR\", \"L. Browse to the URL to see the empty staging slot. Note \\nthis URL for reference later.9 CHAPTER 2 |\", \" Deploy an app to App Service\\n:::{custom-style=CodeBox} console echo Staging web app URL: http://$we\", \"bappname\\u0002staging.azurewebsites.net :::\\n3. In a text editor or Visual Studio, modify Pages/Index.csht\", \"ml again so that the <h2> element \\nreads <h2>Simple Feed Reader - V3</h2> and save the file.\\n4. Comm\", \"it the file to the local Git repository, using either the Changes page in Visual Studio\\u2019s \\nTeam Expl\", \"orer tab, or by entering the following using the local machine\\u2019s command shell:\\n:::{custom-style=Cod\", \"eBox} console git commit -a -m \\\"upgraded to V3\\\" :::\\n5. Using the local machine\\u2019s command shell, add \", \"the staging deployment URL as a Git remote \\nand push the committed changes:\\na. Add the remote URL fo\", \"r staging to the local Git repository.\\n:::{custom-style=CodeBox} console git remote add azure-stagin\", \"g \\n<Git_staging_deployment_URL> :::\\nb. Push the local default branch (main) to the azure-staging rem\", \"ote\\u2019s deployment \\nbranch (main).\\n:::{custom-style=CodeBox} console git push azure-staging main :::\\nW\", \"ait while Azure builds and deploys the app.\\n6. To verify that V3 has been deployed to the staging sl\", \"ot, open two browser windows. In one \\nwindow, navigate to the original web app URL. In the other win\", \"dow, navigate to the staging \\nweb app URL. The production URL serves V2 of the app. The staging URL \", \"serves V3 of the \\napp.\\n7. In the Cloud Shell, swap the verified/warmed-up staging slot into producti\", \"on.10 CHAPTER 2 | Deploy an app to App Service\\n:::{custom-style=CodeBox} azurecli az webapp deployme\", \"nt slot swap --name $webappname -\\n-resource-group AzureTutorial --slot staging :::\\n8. Verify that th\", \"e swap occurred by refreshing the two browser windows.\\n \\nSummary\\nIn this section, the following task\", \"s were completed:\\n\\u2022 Downloaded and built the sample app.\\n\\u2022 Created an Azure App Service Web App usin\", \"g the Azure Cloud Shell.\\n\\u2022 Deployed the sample app to Azure using Git.\\n\\u2022 Deployed a change to the ap\", \"p using Visual Studio.\\n\\u2022 Added a staging slot to the web app.\\n\\u2022 Deployed an update to the staging sl\", \"ot.\\n\\u2022 Swapped the staging and production slots.\\nIn the next section, you\\u2019ll learn how to build a Dev\", \"Ops pipeline with Azure Pipelines.\\nAdditional reading\\n\\u2022 Web Apps overview\\n\\u2022 Build a .NET Core and SQ\", \"L Database web app in Azure App Service\\n\\u2022 Configure deployment credentials for Azure App Service\\n\\u2022 S\", \"et up staging environments in Azure App Service11 CHAPTER 3 | Continuous integration and deployment \", \"with Azure DevOps\\nCHAPTER 3\\nContinuous integration \\nand deployment with \\nAzure DevOps\\nNote\\nThis sect\", \"ion details continuous integration and deployment with Azure DevOps. You can achieve that \\nwith GitH\", \"ub Actions as well. GitHub Actions is a workflow engine built into GitHub that can also be \\nused for\", \" continuous integration and deployment. To follow the guide for building and deploying to \\nAzure usi\", \"ng GitHub, complete the Publish the app\\u2019s code to GitHub and Disconnect local Git \\ndeployment sectio\", \"ns below and then proceed to the GitHub Actions section.\\nIn the previous chapter, you created a loca\", \"l Git repository for the Simple Feed Reader app. In this \\nchapter, you\\u2019ll publish that code to a Git\", \"Hub repository and construct an Azure DevOps Services \\npipeline using Azure Pipelines. The pipeline \", \"enables continuous builds and deployments of the app. \\nAny commit to the GitHub repository triggers \", \"a build and a deployment to the Azure Web App\\u2019s \\nstaging slot.\\nIn this section, you\\u2019ll complete the \", \"following tasks:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Publish the app\\u2019s code to GitHub\\n\\u2022 Disconnect local Git \", \"deployment\\n\\u2022 Create an Azure DevOps organization\\n\\u2022 Create a team project in Azure DevOps organizatio\", \"n\\n\\u2022 Configure a self-hosted agent if necessary\\n\\u2022 Create a build definition\\n\\u2022 Create a release pipeli\", \"ne\\n\\u2022 Commit changes to GitHub and automatically deploy to Azure\\n\\u2022 Examine the Azure Pipelines pipeli\", \"ne12 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\nPublish the app\\u2019s code to G\", \"itHub\\n1. Open a browser window, and navigate to https://github.com.\\n2. Click the + drop-down in the \", \"header, and select New repository:\\n \\n \\n1. Select your account in the Owner drop-down, and enter simp\", \"le-feed-reader in the Repository \\nname textbox.\\n2. Click the Create repository button.\\n3. Open your \", \"local machine\\u2019s command shell. Navigate to the directory in which the simple-feed\\u0002reader Git reposit\", \"ory is stored.\\n4. Rename the existing origin remote to upstream. Execute the following command:\\n:::{\", \"custom-style=CodeBox} console git remote rename origin upstream :::\\n5. Add a new origin remote point\", \"ing to your copy of the repository on GitHub. Execute the \\nfollowing command:\\n:::{custom-style=CodeB\", \"ox} console git remote add origin \\nhttps://github.com/<GitHub_username>/simple-feed-reader/ :::\\n6. P\", \"ublish your local Git repository to the newly created GitHub repository. Execute the following \\ncomm\", \"and:\\n:::{custom-style=CodeBox} console git push -u origin main :::\\n7. Open a browser window, and nav\", \"igate to https://github.com/<GitHub_username>/simple\\u0002feed-reader/. Validate that your code appears i\", \"n the GitHub repository.\\nDisconnect local Git deployment\\nRemove the local Git deployment with the fo\", \"llowing steps. Azure Pipelines (an Azure DevOps service) \\nboth replaces and augments that functional\", \"ity.\\n1. Open the Azure portal, and navigate to the staging (mywebapp<unique_number>/staging)\\nWeb App\", \". The Web App can be quickly located by entering staging in the portal\\u2019s search box:13 CHAPTER 3 | C\", \"ontinuous integration and deployment with Azure DevOps\\nClick Deployment Center. A new panel appears.\", \" Click Disconnect to remove the local Git \\nsource control configuration that was added in the previo\", \"us chapter. Confirm the \\nremoval operation by clicking the Yes button.\\n1. Navigate to the mywebapp A\", \"pp Service. As a reminder, the portal\\u2019s search box can be used to \\nquickly locate the App Service.\\n2\", \". Click Deployment Center. A new panel appears. Click Disconnect to remove the local Git \\nsource con\", \"trol configuration that was added in the previous chapter. Confirm the removal \\noperation by clickin\", \"g the Yes button.\\nCreate an Azure DevOps organization\\n1. Open a browser, and navigate to the Azure D\", \"evOps organization creation page.\\n2. Select New organization\\n3. Confirm the information, and then se\", \"lect Continue.\\n4. Sign in to your organization at any time, https://dev.azure.com/{yourorganization}\", \"\\nCreate a team project in Azure DevOps organization\\n1. Choose the organization, and then select New \", \"project.\\n2. Enter the project name as MyFirstProject and select the Visibility as Private\\n3. Select \", \"Create project.\\nFor more information, see Create a project\\nConfigure a self-hosted agent if necessar\", \"y\\nTo build your code or deploy your software using Azure Pipelines, you need at least one agent. In \", \"\\nAzure Pipelines, you can run parallel jobs on either Microsoft-hosted or self-hosted agent. But wit\", \"h \\nthe recent change in Azure Pipelines free grant of parallel jobs is temporarily disable for the p\", \"ublic \\nprojects.For more details, refer Configure and pay for parallel jobs.\\nGo to Organization Sett\", \"ings and then Pipelines > Parallel jobs. If you see value 0 under Microsoft\\u0002hosted that means you ne\", \"ed a Self-hosted agent to run your pipeline.14 CHAPTER 3 | Continuous integration and deployment wit\", \"h Azure DevOps\\nYou can create that by following details mentioned in Self-hosted agents. After succe\", \"ssful \\nconfiguration, you\\u2019ll be able to see available agent under Organization Settings > Agent pool\", \"s > \\n{youragentname}\\nConfigure the Azure Pipelines pipeline\\nThere are three distinct steps to comple\", \"te. Completing the steps in the following three sections results \\nin an operational DevOps pipeline.\", \"\\nGrant Azure DevOps access to the GitHub repository\\n1. In your project, navigate to the Pipelines pa\", \"ge. Then choose the action to create a new \\npipeline:15 CHAPTER 3 | Continuous integration and deplo\", \"yment with Azure DevOps\\n1. Use Use the classic editor to create the pipeline.\\n \\n1. Select the GitHub\", \" option from the Select a source section::\\n \\n1. Authorization is required before Azure DevOps can ac\", \"cess your GitHub repository. Enter \\nGitHub connection in the Connection name textbox. For example:\\n \", \"\\n1. If two-factor authentication is enabled on your GitHub account, a personal access token is \\nrequ\", \"ired. In that case, click the Authorize with a GitHub personal access token link. See the \\nofficial \", \"GitHub personal access token creation instructions for help. Only the repo scope of \\npermissions is \", \"needed. Otherwise, click the Authorize using OAuth button.16 CHAPTER 3 | Continuous integration and \", \"deployment with Azure DevOps\\n2. When prompted, sign in to your GitHub account. Then select Authorize\", \" to grant access to \\nyour Azure DevOps organization. If successful, a new service endpoint is create\", \"d.\\n3. Click the ellipsis button next to the Repository button. Select the /simple-feed-reader\\nreposi\", \"tory from the list. Click the Select button.\\n4. Select the default branch (main) from the Default br\", \"anch for manual and scheduled builds\\ndrop-down. Click the Continue button. The template selection pa\", \"ge appears.\\nCreate the build definition\\n1. From the template selection page, enter ASP.NET Core in t\", \"he search box:\\n1. The template search results appear. Hover over the ASP.NET Core template, and clic\", \"k the \\nApply button.\\n2. The Tasks tab of the build definition appears. Select the self-hosted Agent \", \"pool if you have \\ncreated that in the earlier step.\\n \\n> [!NOTE]\\n> If you are using MS-hosted agent t\", \"hen select the *Hosted > Azure Pipelines* from \\ndrop down.17 CHAPTER 3 | Continuous integration and \", \"deployment with Azure DevOps\\n1. Click the Triggers tab.\\n2. Check the Enable continuous integration b\", \"ox. Under the Branch filters section, confirm \\nthat the Type drop-down is set to Include. Set the Br\", \"anch specification drop-down to main.\\nThese settings cause a build to trigger when any change is pus\", \"hed to the default \\nbranch (*main*) of the GitHub repository. Continuous integration is tested in th\", \"e \\n[Commit changes to GitHub and automatically deploy to Azure](#commit-changes-to\\u0002github-and-automa\", \"tical) section.\\n1. Click the Save & queue button, and select the Save option:\\n \\n1. The following mod\", \"al dialog appears:\\nUse the default folder of *\\\\\\\\*, and click the **Save** button.18 CHAPTER 3 | Cont\", \"inuous integration and deployment with Azure DevOps\\nCreate the release pipeline\\n1. Click the Release\", \"s tab of your team project. Click the New pipeline button.\\nThe template selection pane appears.\\n1. F\", \"rom the template selection page, enter App Service Deployment in the search box:\\n \\n1. The template s\", \"earch results appear. Hover over the Azure App Service Deployment with \\nSlot template, and click the\", \" Apply button. The Pipeline tab of the release pipeline appears.19 CHAPTER 3 | Continuous integratio\", \"n and deployment with Azure DevOps\\n1. Click the Add button in the Artifacts box. The Add artifact pa\", \"nel appears:\\n1. Select the Build tile from the Source type section. This type allows for the linking\", \" of the \\nrelease pipeline to the build definition.\\n2. Select MyFirstProject from the Project drop-do\", \"wn.\\n3. Select the build definition name, MyFirstProject-ASP.NET Core-CI, from the Source (Build \\ndef\", \"inition) drop-down.\\n4. Select Latest from the Default version drop-down. This option builds the arti\", \"facts produced \\nby the latest run of the build definition.20 CHAPTER 3 | Continuous integration and \", \"deployment with Azure DevOps\\n5. Replace the text in the Source alias textbox with Drop.\\n6. Click the\", \" Add button. The Artifacts section updates to display the changes.\\n7. Click the lightning bolt icon \", \"to enable continuous deployments:\\n \\nWith this option enabled, a deployment occurs each time a new bu\", \"ild is available.\\n1. A Continuous deployment trigger panel appears to the right. Click the toggle bu\", \"tton to \\nenable the feature. It isn\\u2019t necessary to enable the Pull request trigger.\\n2. Click the Add\", \" drop-down in the Build branch filters section. Choose the Build Definition\\u2019s \\ndefault branch option\", \". This filter causes the release to trigger only for a build from the \\nGitHub repository\\u2019s default b\", \"ranch (main).\\n3. Click the Save button. Click the OK button in the resulting Save modal dialog.\\n4. C\", \"lick the Stage 1 box. An Stage panel appears to the right. Change the Stage 1 text in the \\nStage nam\", \"e textbox to Production.\\n1. Click the 1 phase, 2 tasks link in the Production box:21 CHAPTER 3 | Con\", \"tinuous integration and deployment with Azure DevOps\\nThe **Tasks** tab of the environment appears.\\n1\", \". Click the Deploy Azure App Service to Slot task. Its settings appear in a panel to the right.\\n2. S\", \"elect the Azure subscription associated with the App Service from the Azure subscription\\ndrop-down. \", \"Once selected, click the Authorize button.\\n3. Select Web App from the App type drop-down.\\n4. Select \", \"mywebapp/ from the App service name drop-down.\\n5. Select AzureTutorial from the Resource group drop-\", \"down.\\n6. Select staging from the Slot drop-down.\\n7. Select Run on agent* under Tasks. On the right p\", \"ane, you\\u2019ll see Agent Job.\\n8. Select the self-hosted Agent pool if you have created that in the earl\", \"ier step.\\n> [!NOTE]\\n> If you are using MS-hosted agent then select the *Hosted > Azure Pipelines* fr\", \"om \\ndrop down.\\n1. Click the Save button.\\n2. Hover over the default release pipeline name. Click the \", \"pencil icon to edit it. Use \\nMyFirstProject-ASP.NET Core-CD as the name.22 CHAPTER 3 | Continuous in\", \"tegration and deployment with Azure DevOps\\n \\n1. Click the Save button.\\nCommit changes to GitHub and \", \"automatically \\ndeploy to Azure\\n1. Open SimpleFeedReader.sln in Visual Studio.\\n2. In Solution Explore\", \"r, open Pages.cshtml. Change <h2>Simple Feed Reader - V3</h2> to \\n<h2>Simple Feed Reader - V4</h2>.\\n\", \"3. Press Ctrl+Shift+B to build the app.\\n4. Commit the file to the GitHub repository. Use either the \", \"Changes page in Visual Studio\\u2019s \\nTeam Explorer tab, or execute the following using the local machine\", \"\\u2019s command shell:\\n:::{custom-style=CodeBox} console git commit -a -m \\\"upgraded to V4\\\" :::\\n5. Push th\", \"e change in the default branch (main) to the origin remote of your GitHub repository. \\nIn the follow\", \"ing command, replace the placeholder {BRANCH} with the default branch (use \\nmain):\\n:::{custom-style=\", \"CodeBox} console git push origin {BRANCH} :::\\nThe commit appears in the GitHub repository\\u2019s default \", \"branch (main). You\\u2019ll be able to see the \\ncommit history in https://github.com/<GitHub_username>/sim\", \"ple-feed\\u0002reader/commits/main.\\nThe build is triggered, since continuous integration is enabled in the\", \" build definition\\u2019s \\nTriggers tab:23 CHAPTER 3 | Continuous integration and deployment with Azure De\", \"vOps\\n1. Navigate to the Pipelines. You\\u2019ll see the CI pipeline details and monitor each steps if you \", \"drill \\ndown Jobs details.\\n1. Similarly, go to the Releases tab to see the details of CD pipeline. Yo\", \"u can always drill down \\nfurther to see more details of each step.\\n1. Once the build succeeds, a dep\", \"loyment to Azure occurs. Navigate to the app in the browser. \\nNotice that the \\u201cV4\\u201d text appears in t\", \"he heading:\\nExamine the Azure Pipelines pipeline\\nBuild definition\\nA build definition was created wit\", \"h the name MyFirstProject-ASP.NET Core-CI. Upon completion, the \\nbuild produces a .zip file includin\", \"g the assets to be published. The release pipeline deploys those \\nassets to Azure.\\nThe build definit\", \"ion\\u2019s Tasks tab lists the individual steps being used. There are five build tasks.24 CHAPTER 3 | Con\", \"tinuous integration and deployment with Azure DevOps\\n1. Restore \\u2014 Executes the dotnet restore comman\", \"d to restore the app\\u2019s NuGet packages. The \\ndefault package feed used is nuget.org.\\n2. Build \\u2014 Execu\", \"tes the dotnet build --configuration release command to compile the app\\u2019s \\ncode. This --configuratio\", \"n option is used to produce an optimized version of the code, which \\nis suitable for deployment to a\", \" production environment. Modify the BuildConfiguration\\nvariable on the build definition\\u2019s Variables \", \"tab if, for example, a debug configuration is \\nneeded.\\n3. Test \\u2014 Executes the dotnet test --configur\", \"ation release --logger trx --results-directory \\n<local_path_on_build_agent> command to run the app\\u2019s\", \" unit tests. Unit tests are executed \\nwithin any C# project matching the **/Tests/.csproj glob patte\", \"rn. Test results are saved in a .trx\\nfile at the location specified by the --results-directory optio\", \"n. If any tests fail, the build fails \\nand isn\\u2019t deployed.25 CHAPTER 3 | Continuous integration and \", \"deployment with Azure DevOps\\n[!NOTE] To verify the unit tests work, modify SimpleFeedReader.Tests.cs\", \" to purposefully break \\none of the tests. For example, change Assert.True(result.Count > 0); to \\nAss\", \"ert.False(result.Count > 0); in the Returns_News_Stories_Given_Valid_Uri method. Commit \\nand push th\", \"e change to GitHub. The build is triggered and fails. The build pipeline status \\nchanges to failed. \", \"Revert the change, commit, and push again. The build succeeds.\\n4. Publish \\u2014 Executes the dotnet publ\", \"ish --configuration release --output \\n<local_path_on_build_agent> command to produce a .zip file wit\", \"h the artifacts to be \\ndeployed. The --output option specifies the publish location of the .zip file\", \". That location is \\nspecified by passing a predefined variable named $(build.artifactstagingdirector\", \"y). That \\nvariable expands to a local path, such as *c:_work\\\\1, on the build agent.\\n5. Publish Artif\", \"act \\u2014 Publishes the .zip file produced by the Publish task. The task accepts the \\n.zip file location\", \" as a parameter, which is the predefined variable \\n$(build.artifactstagingdirectory). The .zip file \", \"is published as a folder named drop.\\nClick the build definition\\u2019s Summary link to view a history of \", \"builds with the definition:\\nOn the resulting page, click the individual build for more details.\\nA su\", \"mmary of this specific build is displayed. Click the published link, and notice the drop folder \\npro\", \"duced by the build is listed:26 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n\", \"Use the ellipsis and click on Downloads artifacts links to inspect the published artifacts.\\nRelease \", \"pipeline\\nA release pipeline was created with the name MyFirstProject-ASP.NET Core-CD:\\nThe two major \", \"components of the release pipeline are the Artifacts and the Stages. Clicking the box \\nin the Artifa\", \"cts section reveals the following panel:27 CHAPTER 3 | Continuous integration and deployment with Az\", \"ure DevOps\\nThe Source (Build definition) value represents the build definition to which this release\", \" pipeline is \\nlinked. The .zip file produced by a successful run of the build definition is provided\", \" to the Production\\nenvironment for deployment to Azure. Click the 1 phase, 2 tasks link in the Produ\", \"ction environment \\nbox to view the release pipeline tasks:\\nThe release pipeline consists of two task\", \"s: Deploy Azure App Service to Slot and Manage Azure App \\nService - Slot Swap. Clicking the first ta\", \"sk reveals the following task configuration:28 CHAPTER 3 | Continuous integration and deployment wit\", \"h Azure DevOps\\nThe Azure subscription, service type, web app name, resource group, and deployment sl\", \"ot are defined \\nin the deployment task. The Package or folder textbox holds the .zip file path to be\", \" extracted and \\ndeployed to the staging slot of the mywebapp<unique_number> web app.\\nClicking the sl\", \"ot swap task reveals the following task configuration:29 CHAPTER 3 | Continuous integration and depl\", \"oyment with Azure DevOps\\nThe subscription, resource group, service type, web app name, and deploymen\", \"t slot details are \\nprovided. The Swap with Production check box is checked. Consequently, the bits \", \"deployed to the \\nstaging slot are swapped into the production environment.\\nAdditional reading\\n\\u2022 Crea\", \"te your first pipeline with Azure Pipelines\\n\\u2022 Build and .NET Core project\\n\\u2022 Deploy a web app with Az\", \"ure Pipelines30 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\nContinuous integ\", \"ration and deployment with Azure \\nDevOps\\nNote\\nThis section details continuous integration and deploy\", \"ment with Azure DevOps. You can achieve that \\nwith GitHub Actions as well. GitHub Actions is a workf\", \"low engine built into GitHub that can also be \\nused for continuous integration and deployment. To fo\", \"llow the guide for building and deploying to \\nAzure using GitHub, complete the Publish the app\\u2019s cod\", \"e to GitHub and Disconnect local Git \\ndeployment sections below and then proceed to the GitHub Actio\", \"ns section.\\nIn the previous chapter, you created a local Git repository for the Simple Feed Reader a\", \"pp. In this \\nchapter, you\\u2019ll publish that code to a GitHub repository and construct an Azure DevOps \", \"Services \\npipeline using Azure Pipelines. The pipeline enables continuous builds and deployments of \", \"the app. \\nAny commit to the GitHub repository triggers a build and a deployment to the Azure Web App\", \"\\u2019s \\nstaging slot.\\nIn this section, you\\u2019ll complete the following tasks:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 P\", \"ublish the app\\u2019s code to GitHub\\n\\u2022 Disconnect local Git deployment\\n\\u2022 Create an Azure DevOps organizat\", \"ion\\n\\u2022 Create a team project in Azure DevOps organization\\n\\u2022 Configure a self-hosted agent if necessar\", \"y\\n\\u2022 Create a build definition\\n\\u2022 Create a release pipeline\\n\\u2022 Commit changes to GitHub and automatical\", \"ly deploy to Azure\\n\\u2022 Examine the Azure Pipelines pipeline\\nPublish the app\\u2019s code to GitHub\\n1. Open a\", \" browser window, and navigate to https://github.com.\\n2. Click the + drop-down in the header, and sel\", \"ect New repository:31 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n1. Select \", \"your account in the Owner drop-down, and enter simple-feed-reader in the Repository \\nname textbox.\\n2\", \". Click the Create repository button.\\n3. Open your local machine\\u2019s command shell. Navigate to the di\", \"rectory in which the simple-feed\\u0002reader Git repository is stored.\\n4. Rename the existing origin remo\", \"te to upstream. Execute the following command:\\n:::{custom-style=CodeBox} console git remote rename o\", \"rigin upstream :::\\n5. Add a new origin remote pointing to your copy of the repository on GitHub. Exe\", \"cute the \\nfollowing command:\\n:::{custom-style=CodeBox} console git remote add origin \\nhttps://github\", \".com/<GitHub_username>/simple-feed-reader/ :::\\n6. Publish your local Git repository to the newly cre\", \"ated GitHub repository. Execute the following \\ncommand:\\n:::{custom-style=CodeBox} console git push -\", \"u origin main :::\\n7. Open a browser window, and navigate to https://github.com/<GitHub_username>/sim\", \"ple\\u0002feed-reader/. Validate that your code appears in the GitHub repository.\\nDisconnect local Git dep\", \"loyment\\nRemove the local Git deployment with the following steps. Azure Pipelines (an Azure DevOps s\", \"ervice) \\nboth replaces and augments that functionality.\\n1. Open the Azure portal, and navigate to th\", \"e staging (mywebapp<unique_number>/staging)\\nWeb App. The Web App can be quickly located by entering \", \"staging in the portal\\u2019s search box:\\n1. Click Deployment Center. A new panel appears. Click Disconnec\", \"t to remove the local Git \\nsource control configuration that was added in the previous chapter. Conf\", \"irm the removal \\noperation by clicking the Yes button.\\n2. Navigate to the mywebapp App Service. As a\", \" reminder, the portal\\u2019s search box can be used to \\nquickly locate the App Service.\\n3. Click Deployme\", \"nt Center. A new panel appears. Click Disconnect to remove the local Git \\nsource control configurati\", \"on that was added in the previous chapter. Confirm the removal \\noperation by clicking the Yes button\", \".\\nCreate an Azure DevOps organization\\n1. Open a browser, and navigate to the Azure DevOps organizati\", \"on creation page.\\n2. Select New organization\\n3. Confirm the information, and then select Continue.32\", \" CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n4. Sign in to your organization\", \" at any time, https://dev.azure.com/{yourorganization}\\nCreate a team project in Azure DevOps organiz\", \"ation\\n1. Choose the organization, and then select New project.\\n2. Enter the project name as MyFirstP\", \"roject and select the Visibility as Private\\n3. Select Create project.\\nFor more information, see Crea\", \"te a project\\nConfigure a self-hosted agent if necessary\\nTo build your code or deploy your software u\", \"sing Azure Pipelines, you need at least one agent. In \\nAzure Pipelines, you can run parallel jobs on\", \" either Microsoft-hosted or self-hosted agent. But with \\nthe recent change in Azure Pipelines free g\", \"rant of parallel jobs is temporarily disable for the public \\nprojects.For more details, refer Config\", \"ure and pay for parallel jobs.\\nGo to Organization Settings and then Pipelines > Parallel jobs. If yo\", \"u see value 0 under Microsoft\\u0002hosted that means you need a Self-hosted agent to run your pipeline.\\nY\", \"ou can create that by following details mentioned in Self-hosted agents. After successful \\nconfigura\", \"tion, you\\u2019ll be able to see available agent under Organization Settings > Agent pools > \\n{youragentn\", \"ame}\\nConfigure the Azure Pipelines pipeline\\nThere are three distinct steps to complete. Completing t\", \"he steps in the following three sections results \\nin an operational DevOps pipeline.33 CHAPTER 3 | C\", \"ontinuous integration and deployment with Azure DevOps\\nGrant Azure DevOps access to the GitHub repos\", \"itory\\n1. In your project, navigate to the Pipelines page. Then choose the action to create a new \\npi\", \"peline:\\n1. Use Use the classic editor to create the pipeline.\\n1. Select the GitHub option from the S\", \"elect a source section::\\n1. Authorization is required before Azure DevOps can access your GitHub rep\", \"ository. Enter \\nGitHub connection in the Connection name textbox. For example:34 CHAPTER 3 | Continu\", \"ous integration and deployment with Azure DevOps\\n1. If two-factor authentication is enabled on your \", \"GitHub account, a personal access token is \\nrequired. In that case, click the Authorize with a GitHu\", \"b personal access token link. See the \\nofficial GitHub personal access token creation instructions f\", \"or help. Only the repo scope of \\npermissions is needed. Otherwise, click the Authorize using OAuth b\", \"utton.\\n2. When prompted, sign in to your GitHub account. Then select Authorize to grant access to \\ny\", \"our Azure DevOps organization. If successful, a new service endpoint is created.\\n3. Click the ellips\", \"is button next to the Repository button. Select the /simple-feed-reader\\nrepository from the list. Cl\", \"ick the Select button.\\n4. Select the default branch (main) from the Default branch for manual and sc\", \"heduled builds\\ndrop-down. Click the Continue button. The template selection page appears.\\nCreate the\", \" build definition\\n1. From the template selection page, enter ASP.NET Core in the search box:\\nThe tem\", \"plate search results appear. Hover over the ASP.NET Core template, and click \\nthe Apply button.\\n1. T\", \"he Tasks tab of the build definition appears. Select the self-hosted Agent pool if you have \\ncreated\", \" that in the earlier step.35 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n> [\", \"!NOTE]\\n> If you are using MS-hosted agent then select the *Hosted > Azure Pipelines* from \\ndrop down\", \".\\n1. Click the Triggers tab.\\n2. Check the Enable continuous integration box. Under the Branch filter\", \"s section, confirm \\nthat the Type drop-down is set to Include. Set the Branch specification drop-dow\", \"n to main.\\nThese settings cause a build to trigger when any change is pushed to the default \\nbranch \", \"(*main*) of the GitHub repository. Continuous integration is tested in the \\n[Commit changes to GitHu\", \"b and automatically deploy to Azure](#commit-changes-to\\u0002github-and-automatical) section.\\n1. Click th\", \"e Save & queue button, and select the Save option:36 CHAPTER 3 | Continuous integration and deployme\", \"nt with Azure DevOps\\n1. The following modal dialog appears:\\nUse the default folder of *\\\\\\\\*, and clic\", \"k the **Save** button.\\nCreate the release pipeline\\n1. Click the Releases tab of your team project. C\", \"lick the New pipeline button.37 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n\", \"The template selection pane appears.\\n1. From the template selection page, enter App Service Deployme\", \"nt in the search box:\\n1. The template search results appear. Hover over the Azure App Service Deploy\", \"ment with \\nSlot template, and click the Apply button. The Pipeline tab of the release pipeline appea\", \"rs.\\n1. Click the Add button in the Artifacts box. The Add artifact panel appears:38 CHAPTER 3 | Cont\", \"inuous integration and deployment with Azure DevOps\\n1. Select the Build tile from the Source type se\", \"ction. This type allows for the linking of the \\nrelease pipeline to the build definition.\\n2. Select \", \"MyFirstProject from the Project drop-down.\\n3. Select the build definition name, MyFirstProject-ASP.N\", \"ET Core-CI, from the Source (Build \\ndefinition) drop-down.\\n4. Select Latest from the Default version\", \" drop-down. This option builds the artifacts produced \\nby the latest run of the build definition.\\n5.\", \" Replace the text in the Source alias textbox with Drop.\\n6. Click the Add button. The Artifacts sect\", \"ion updates to display the changes.\\n7. Click the lightning bolt icon to enable continuous deployment\", \"s:\\nWith this option enabled, a deployment occurs each time a new build is available.\\n1. A Continuous\", \" deployment trigger panel appears to the right. Click the toggle button to \\nenable the feature. It i\", \"sn\\u2019t necessary to enable the Pull request trigger.\\n2. Click the Add drop-down in the Build branch fi\", \"lters section. Choose the Build Definition\\u2019s \\ndefault branch option. This filter causes the release \", \"to trigger only for a build from the \\nGitHub repository\\u2019s default branch (main).\\n3. Click the Save b\", \"utton. Click the OK button in the resulting Save modal dialog.\\n4. Click the Stage 1 box. An Stage pa\", \"nel appears to the right. Change the Stage 1 text in the \\nStage name textbox to Production.39 CHAPTE\", \"R 3 | Continuous integration and deployment with Azure DevOps\\n1. Click the 1 phase, 2 tasks link in \", \"the Production box:\\nThe **Tasks** tab of the environment appears.\\n1. Click the Deploy Azure App Serv\", \"ice to Slot task. Its settings appear in a panel to the right.\\n2. Select the Azure subscription asso\", \"ciated with the App Service from the Azure subscription\\ndrop-down. Once selected, click the Authoriz\", \"e button.\\n3. Select Web App from the App type drop-down.\\n4. Select mywebapp/ from the App service na\", \"me drop-down.\\n5. Select AzureTutorial from the Resource group drop-down.\\n6. Select staging from the \", \"Slot drop-down.\\n7. Select Run on agent* under Tasks. On the right pane, you\\u2019ll see Agent Job.\\n8. Sel\", \"ect the self-hosted Agent pool if you have created that in the earlier step.40 CHAPTER 3 | Continuou\", \"s integration and deployment with Azure DevOps\\n> [!NOTE]\\n> If you are using MS-hosted agent then sel\", \"ect the *Hosted > Azure Pipelines* from \\ndrop down.\\n1. Click the Save button.\\n2. Hover over the defa\", \"ult release pipeline name. Click the pencil icon to edit it. Use \\nMyFirstProject-ASP.NET Core-CD as \", \"the name.\\n1. Click the Save button.\\nCommit changes to GitHub and automatically deploy to Azure\\n1. Op\", \"en SimpleFeedReader.sln in Visual Studio.\\n2. In Solution Explorer, open Pages.cshtml. Change <h2>Sim\", \"ple Feed Reader - V3</h2> to \\n<h2>Simple Feed Reader - V4</h2>.\\n3. Press Ctrl+Shift+B to build the a\", \"pp.\\n4. Commit the file to the GitHub repository. Use either the Changes page in Visual Studio\\u2019s \\nTea\", \"m Explorer tab, or execute the following using the local machine\\u2019s command shell:\\n:::{custom-style=C\", \"odeBox} console git commit -a -m \\\"upgraded to V4\\\" :::\\n5. Push the change in the default branch (main\", \") to the origin remote of your GitHub repository. \\nIn the following command, replace the placeholder\", \" {BRANCH} with the default branch (use \\nmain):\\n:::{custom-style=CodeBox} console git push origin {BR\", \"ANCH} :::\\nThe commit appears in the GitHub repository\\u2019s default branch (main). You\\u2019ll be able to see\", \" the \\ncommit history in https://github.com/<GitHub_username>/simple-feed\\u0002reader/commits/main.\\nThe bu\", \"ild is triggered, since continuous integration is enabled in the build definition\\u2019s \\nTriggers tab:41\", \" CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n1. Navigate to the Pipelines. Y\", \"ou\\u2019ll see the CI pipeline details and monitor each steps if you drill \\ndown Jobs details.\\n1. Similar\", \"ly, go to the Releases tab to see the details of CD pipeline. You can always drill down \\nfurther to \", \"see more details of each step.\\n1. Once the build succeeds, a deployment to Azure occurs. Navigate to\", \" the app in the browser. \\nNotice that the \\u201cV4\\u201d text appears in the heading:\\nExamine the Azure Pipeli\", \"nes pipeline\\nBuild definition\\nA build definition was created with the name MyFirstProject-ASP.NET Co\", \"re-CI. Upon completion, the \\nbuild produces a .zip file including the assets to be published. The re\", \"lease pipeline deploys those \\nassets to Azure.\\nThe build definition\\u2019s Tasks tab lists the individual\", \" steps being used. There are five build tasks.42 CHAPTER 3 | Continuous integration and deployment w\", \"ith Azure DevOps\\n1. Restore \\u2014 Executes the dotnet restore command to restore the app\\u2019s NuGet package\", \"s. The \\ndefault package feed used is nuget.org.\\n2. Build \\u2014 Executes the dotnet build --configuration\", \" release command to compile the app\\u2019s \\ncode. This --configuration option is used to produce an optim\", \"ized version of the code, which \\nis suitable for deployment to a production environment. Modify the \", \"BuildConfiguration\\nvariable on the build definition\\u2019s Variables tab if, for example, a debug configu\", \"ration is \\nneeded.\\n3. Test \\u2014 Executes the dotnet test --configuration release --logger trx --results\", \"-directory \\n<local_path_on_build_agent> command to run the app\\u2019s unit tests. Unit tests are executed\", \" \\nwithin any C# project matching the **/Tests/.csproj glob pattern. Test results are saved in a .trx\", \"\\nfile at the location specified by the --results-directory option. If any tests fail, the build fail\", \"s \\nand isn\\u2019t deployed.43 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n[!NOTE]\", \" To verify the unit tests work, modify SimpleFeedReader.Tests.cs to purposefully break \\none of the t\", \"ests. For example, change Assert.True(result.Count > 0); to \\nAssert.False(result.Count > 0); in the \", \"Returns_News_Stories_Given_Valid_Uri method. Commit \\nand push the change to GitHub. The build is tri\", \"ggered and fails. The build pipeline status \\nchanges to failed. Revert the change, commit, and push \", \"again. The build succeeds.\\n4. Publish \\u2014 Executes the dotnet publish --configuration release --output\", \" \\n<local_path_on_build_agent> command to produce a .zip file with the artifacts to be \\ndeployed. The\", \" --output option specifies the publish location of the .zip file. That location is \\nspecified by pas\", \"sing a predefined variable named $(build.artifactstagingdirectory). That \\nvariable expands to a loca\", \"l path, such as *c:_work\\\\1, on the build agent.\\n5. Publish Artifact \\u2014 Publishes the .zip file produc\", \"ed by the Publish task. The task accepts the \\n.zip file location as a parameter, which is the predef\", \"ined variable \\n$(build.artifactstagingdirectory). The .zip file is published as a folder named drop.\", \"\\nClick the build definition\\u2019s Summary link to view a history of builds with the definition:\\nOn the r\", \"esulting page, click the individual build for more details.\\nA summary of this specific build is disp\", \"layed. Click the published link, and notice the drop folder \\nproduced by the build is listed:44 CHAP\", \"TER 3 | Continuous integration and deployment with Azure DevOps\\nUse the ellipsis and click on Downlo\", \"ads artifacts links to inspect the published artifacts.\\nRelease pipeline\\nA release pipeline was crea\", \"ted with the name MyFirstProject-ASP.NET Core-CD:\\nThe two major components of the release pipeline a\", \"re the Artifacts and the Stages. Clicking the box \\nin the Artifacts section reveals the following pa\", \"nel:45 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\nThe Source (Build definit\", \"ion) value represents the build definition to which this release pipeline is \\nlinked. The .zip file \", \"produced by a successful run of the build definition is provided to the Production\\nenvironment for d\", \"eployment to Azure. Click the 1 phase, 2 tasks link in the Production environment \\nbox to view the r\", \"elease pipeline tasks:\\nThe release pipeline consists of two tasks: Deploy Azure App Service to Slot \", \"and Manage Azure App \\nService - Slot Swap. Clicking the first task reveals the following task config\", \"uration:46 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\nThe Azure subscriptio\", \"n, service type, web app name, resource group, and deployment slot are defined \\nin the deployment ta\", \"sk. The Package or folder textbox holds the .zip file path to be extracted and \\ndeployed to the stag\", \"ing slot of the mywebapp<unique_number> web app.\\nClicking the slot swap task reveals the following t\", \"ask configuration:47 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\nThe subscri\", \"ption, resource group, service type, web app name, and deployment slot details are \\nprovided. The Sw\", \"ap with Production check box is checked. Consequently, the bits deployed to the \\nstaging slot are sw\", \"apped into the production environment.\\nAdditional reading\\n\\u2022 Create your first pipeline with Azure Pi\", \"pelines\\n\\u2022 Build and .NET Core project\\n\\u2022 Deploy a web app with Azure Pipelines48 CHAPTER 3 | Continuo\", \"us integration and deployment with Azure DevOps\\nContinuous integration and deployment with \\nGitHub A\", \"ctions\\nGitHub has long been the home for millions of open-source developers around the globe. Most \\n\", \"developers associate source control with GitHub. However, GitHub is an evolving platform that can be\", \" \\nused for more than just synchronizing Git repositories.\\nGitHub Actions\\nGitHub Actions is a workflo\", \"w engine that can automate workflows for nearly all events that occur on \\nGitHub. Actions is a great\", \" solution for Continuous Integration/Continuous Deployment (CI/CD) \\npipelines.\\nIn this section of ar\", \"ticles, you\\u2019ll learn how to create an Actions workflow. The workflow will build, test, \\nand deploy a\", \" .NET web app to Azure Web Apps.\\nNote\\nBefore you begin, complete the Publish the app\\u2019s code to GitHu\", \"b and Disconnect local Git \\ndeployment sections of the Continuous integration and deployment with Az\", \"ure DevOps section to \\npublish your code to GitHub. Then proceed to the Build article.\\nIn the Build \", \"article, you\\u2019ll create the initial workflow to build and test the .NET app. You\\u2019ll:\\n[!div class=\\u201cche\", \"cklist\\u201d]\\n\\u2022 Learn the basic structure of a GitHub Action workflow YAML file.\\n\\u2022 Use a template to crea\", \"te a basic build workflow that builds a .NET app and executes unit tests.\\n\\u2022 Publish the compiled app\", \" so that it\\u2019s ready for deployment.\\nIn the Deploy article, you\\u2019ll:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Learn \", \"about environments in GitHub Actions.\\n\\u2022 Create two environments and specify environment protection r\", \"ules.\\n\\u2022 Create environment secrets for managing environment-specific configuration.\\n\\u2022 Extend the wor\", \"kflow YAML file to add deployment steps.\\n\\u2022 Add a manual dispatch trigger.\\nSecure code with CodeQL\\nIn\", \" addition to building and deploying code, GitHub Advanced Security offers tools for \\u201cshifting left\\u201d \", \"\\nwith security. That is, integrating security early on in the software delivery lifecycle. CodeQL is\", \" a code \\nscanning language that runs queries to find potential vulnerabilities or quality issues in \", \"your code. \\nCodeQL is run using an Actions workflow.\\nIn the CodeQL article, you\\u2019ll:49 CHAPTER 3 | Co\", \"ntinuous integration and deployment with Azure DevOps\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Create a Code Scann\", \"ing Action.\\n\\u2022 Edit the workflow file to include custom scan settings.\\n\\u2022 See scanning results.\\nCompar\", \"e and contrast GitHub Actions and Azure Pipelines\\nGitHub Actions and Azure Pipelines have a common l\", \"ineage and are similar in many respects. \\nHowever, you should understand the differences before sele\", \"cting a platform for building, testing, and \\ndeploying apps. In the Comparison article, you\\u2019ll deep \", \"dive into these platforms and compare and \\ncontrast them. You\\u2019ll also learn how to select the correc\", \"t platform for your CI/CD needs.\\nContinuous integration and deployment with \\nGitHub Actions\\nGitHub h\", \"as long been the home for millions of open-source developers around the globe. Most \\ndevelopers asso\", \"ciate source control with GitHub. However, GitHub is an evolving platform that can be \\nused for more\", \" than just synchronizing Git repositories.\\nGitHub Actions\\nGitHub Actions is a workflow engine that c\", \"an automate workflows for nearly all events that occur on \\nGitHub. Actions is a great solution for C\", \"ontinuous Integration/Continuous Deployment (CI/CD) \\npipelines.\\nIn this section of articles, you\\u2019ll \", \"learn how to create an Actions workflow. The workflow will build, test, \\nand deploy a .NET web app t\", \"o Azure Web Apps.\\nNote\\nBefore you begin, complete the Publish the app\\u2019s code to GitHub and Disconnec\", \"t local Git \\ndeployment sections of the Continuous integration and deployment with Azure DevOps sect\", \"ion to \\npublish your code to GitHub. Then proceed to the Build article.\\nIn the Build article, you\\u2019ll\", \" create the initial workflow to build and test the .NET app. You\\u2019ll:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Lear\", \"n the basic structure of a GitHub Action workflow YAML file.\\n\\u2022 Use a template to create a basic buil\", \"d workflow that builds a .NET app and executes unit tests.\\n\\u2022 Publish the compiled app so that it\\u2019s r\", \"eady for deployment.\\nIn the Deploy article, you\\u2019ll:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Learn about environme\", \"nts in GitHub Actions.50 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n\\u2022 Creat\", \"e two environments and specify environment protection rules.\\n\\u2022 Create environment secrets for managi\", \"ng environment-specific configuration.\\n\\u2022 Extend the workflow YAML file to add deployment steps.\\n\\u2022 Ad\", \"d a manual dispatch trigger.\\nSecure code with CodeQL\\nIn addition to building and deploying code, Git\", \"Hub Advanced Security offers tools for \\u201cshifting left\\u201d \\nwith security. That is, integrating security\", \" early on in the software delivery lifecycle. CodeQL is a code \\nscanning language that runs queries \", \"to find potential vulnerabilities or quality issues in your code. \\nCodeQL is run using an Actions wo\", \"rkflow.\\nIn the CodeQL article, you\\u2019ll:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Create a Code Scanning Action.\\n\\u2022 E\", \"dit the workflow file to include custom scan settings.\\n\\u2022 See scanning results.\\nCompare and contrast \", \"GitHub Actions and Azure Pipelines\\nGitHub Actions and Azure Pipelines have a common lineage and are \", \"similar in many respects. \\nHowever, you should understand the differences before selecting a platfor\", \"m for building, testing, and \\ndeploying apps. In the Comparison article, you\\u2019ll deep dive into these\", \" platforms and compare and \\ncontrast them. You\\u2019ll also learn how to select the correct platform for \", \"your CI/CD needs.\\nCompare and contrast GitHub Actions and Azure \\nPipelines\\nGitHub Actions and Azure \", \"Pipelines have a common history. In fact, the Actions agent is a fork of the \\nPipelines agent. There\", \" are many similarities between GitHub Actions and Azure Pipelines and it\\u2019s \\nworth comparing and cont\", \"rasting them.\\nPipelines as code\\nBefore you compare GitHub Actions and Azure Pipelines, you should co\", \"nsider the benefits of pipelines \\nas code. Pipelines as code:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Benefit fro\", \"m standard source control practices (such as code reviews via pull request and \\nversioning).\\n\\u2022 Can b\", \"e audited for changes just like any other files in the repository.\\n\\u2022 Don\\u2019t require accessing a separ\", \"ate system or UI to edit.\\n\\u2022 Can fully codify the build, test, and deploy process for code.51 CHAPTER\", \" 3 | Continuous integration and deployment with Azure DevOps\\n\\u2022 Can usually be templatized to empower\", \" teams to create standard processes across multiple \\nrepositories.\\nNote\\nThe term \\u201cpipelines\\u201d can als\", \"o be referred to by several different interchangeable words: pipeline, \\nworkflow, and build are comm\", \"on terms. In this article, references to Azure Pipelines are referring to \\nYAML Pipelines, and not t\", \"he older UI-based Classic Pipelines.\\nAgents and runners\\nBefore you examine pipelines themselves, you\", \" should consider how these pipelines execute. Both \\nGitHub Actions and Azure Pipelines are really or\", \"chestration engines. When a pipeline is triggered, the \\nsystem finds an \\u201cagent\\u201d and tells the agent \", \"to execute the jobs defined in the pipeline file.\\nAzure Pipelines run on agents. The agent is writte\", \"n in .NET, so it will run wherever .NET can run: \\nWindows, macOS, and Linux. Agents can even run in \", \"containers. Agents are registered to a pool in \\nAzure Pipelines or to a repository or organization i\", \"n GitHub. Agents can be hosted or private.\\nGitHub Workflows execute on runners. The runner code is e\", \"ssentially a fork of the Azure Pipelines \\ncode, so it\\u2019s very similar. It\\u2019s also cross-platform and y\", \"ou can also use hosted or self-hosted runners.\\nHosted agents and runners\\nHosted agents (Azure Pipeli\", \"nes) and hosted runners (GitHub) are agents that are spun up and \\nmanaged by Azure DevOps or GitHub \", \"respectively. You don\\u2019t need to maintain any build \\ninfrastructure. When a pipeline triggers that ta\", \"rgets a hosted agent, an instance of the specified agent \\nimage is created. The job is run by the ag\", \"ent on the instance, and once the job completes, the \\ninstance is destroyed. The same applies for ho\", \"sted runners running GitHub workflows.\\nNote\\nThe list of software installed on Azure Pipelines images\", \" is listed in this repository. You can select the \\nplatform folder and examine the README.md files. \", \"You can find information on GitHub hosted \\nrunners.\\nPrivate agents and self-hosted runners\\nThere are\", \" times when you can\\u2019t use hosted images. For example, when you:\\n\\u2022 Require SDKs or other software tha\", \"t isn\\u2019t installed on the images.\\n\\u2022 Need to access resources that aren\\u2019t public (such as an internal \", \"SonarQube server or an \\ninternal Artifactory instance).\\n\\u2022 Need to deploy to private networks.\\n\\u2022 Need\", \" to install licenses for third-party software required for building your code.\\n\\u2022 Need more storage o\", \"r memory than is provided to the hosted agent images.\\n\\u2022 Need more time than the maximum build time l\", \"imit for hosted agents.52 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\nImport\", \"ant\\nIt\\u2019s possible to install tools and SDKs when running pipelines on hosted agents. If the install \", \"steps \\ndon\\u2019t take long, this is viable. However, if the tools/software take a long time to install, \", \"then you may \\nbe better off with a private agent or self-hosted runner, since the install steps will\", \" need to execute for \\nevery run of the workflow.\\nAzure DevOps agents\\nEvery Azure DevOps account has \", \"a hosted pool with a single agent that can run one job at a time. \\nAlso included is a set number of \", \"free build minutes. You may purchase additional \\u201chosted pipelines\\u201d in \\nAzure DevOps. When you purcha\", \"se an additional hosted pipeline, you\\u2019re really removing the build \\nminutes limit and adding concurr\", \"ency. One pipeline can run one job at a time. Two pipelines can run \\ntwo jobs simultaneously, and so\", \" on.\\nComparison of agents\\nFeature GitHub Azure Pipelines Links\\nHosted agents for \\npublic \\nrepos/proj\", \"ects\\nFree Up to 10 free Microsoft-hosted parallel jobs \\nthat can run for up to 360 minutes (6 hours)\", \" \\neach time with no overall time limit per \\nmonth. You aren\\u2019t given this free grant by \\ndefault, you\", \" have to submit a request\\nAzure \\nPipelines\\nGitHub\\nHosted agents for \\nprivate \\nrepos/projects\\n2,000 m\", \"inutes \\nfree per month, \\n3,000 minutes \\nfor Pro and \\nTeam licenses, \\n50,000 minutes \\nfor Enterprise \", \"\\nlicense. \\nAdditional \\nminutes may be \\npurchased.\\nOne free parallel job that can run for up to \\n60 m\", \"inutes each time, until you\\u2019ve used \\n1,800 minutes (30 hours) per month. You \\ncan pay for additional\", \" capacity per parallel \\njob. Paid parallel jobs remove the monthly \\ntime limit and allow you to run \", \"each job for \\nup to 360 minutes (6 hours).\\nCross-platform Yes Yes\\nScale set agents No Yes Azure virt\", \"ual \\nmachine \\nscale set \\nagents\\nComparison of GitHub Actions and Azure Pipelines\\nAzure Pipelines (YA\", \"ML pipelines) provide a mature set of features. Some of the features include:\\n\\u2022 Approvals\\n\\u2022 Artifact\", \" storage53 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n\\u2022 Deployment jobs\\n\\u2022 E\", \"nvironments\\n\\u2022 Gates\\n\\u2022 Stages\\n\\u2022 Templates\\n\\u2022 Triggers\\n\\u2022 Variable groups\\nFor a full list of Azure Pipel\", \"ines features, refer to the Feature availability table.\\nGitHub Actions are evolving rapidly and prov\", \"ide features such as triggers for almost all GitHub events, \\nartifact storage, environments and envi\", \"ronment rules, starter templates, and matrices. Read more \\nabout the entire feature set refer GitHub\", \" Actions.\\nFeature comparison\\nThe following table is current as of January 2023 and is not an exhaust\", \"ive list of features.\\nFeature Description GitHub Actions Azure Pipelines\\nApprovals Define approval \\n\", \"conditions before \\nmoving further in the \\npipeline\\nYes Yes\\nArtifacts Upload, store, and \\ndownload ar\", \"tifacts \\nfrom jobs\\nYes Yes\\nCaching Cache folders or files \\nfor subsequent runs\\nYes Yes\\nConditions Sp\", \"ecify conditions \\nfor steps or jobs\\nYes Yes\\nContainer \\nJobs\\nRun jobs inside a \\ncontainer\\nYes Yes\\nDem\", \"ands Specify demands \\nthat must be met to \\nmatch jobs to agents\\nYes Yes\\nDependenci\\nes\\nSpecify \\ndepen\", \"dencies \\nbetween jobs or \\nstages\\nYes Yes\\nDeployment \\nGroups\\nA logical set of target \\nmachines for \\nd\", \"eployments\\nNo Yes\\nDeployment \\nJobs\\nJob that targets a \\ndeployment group\\nNo Yes54 CHAPTER 3 | Continu\", \"ous integration and deployment with Azure DevOps\\nFeature Description GitHub Actions Azure Pipelines\\n\", \"Environment\\ns\\nA collection of \\nresources to target \\nor a logical \\nenvironment\\nYes Yes\\nGates/Check\\ns\\n\", \"Automatic collection \\nand evaluation of \\nsignals to control \\ncontinuation\\nYes Yes\\nJobs Sequence of s\", \"teps \\nthat are executed on \\nan agent\\nYes Yes\\nService \\nContainers\\nManage the lifecycle \\nof a containe\", \"rized \\nservice instance \\navailable during a \\njob\\nYes Yes\\nService \\nConnections\\nAbstract credentials \\n\", \"to external systems\\nNo Yes\\nPasswordles\\ns \\nconnections \\nto cloud \\nproviders\\nProvide technologies \\nand\", \" support use \\ncases that reduce \\nand potentially \\neliminate the use of \\npasswords\\nYes No\\nStages Grou\", \"p jobs in a \\npipeline\\nNo Yes\\nTemplates Define reusable, \\nparameterized \\nbuilding blocks for \\nsteps, \", \"jobs, or \\nvariables\\nYes Yes\\nStarter \\nTemplates\\nDefines a starter \\nworkflow based on \\nthe type of cod\", \"e \\ndetected in a \\nrepository\\nYes No\\nTriggers Set of events that \\ncause the pipeline to \\ntrigger\\nYes \", \"Yes55 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\nFeature Description GitHub\", \" Actions Azure Pipelines\\nVariables Variables that can be \\npassed in, statically \\nor dynamically \\ndef\", \"ined\\nYes Yes\\nVariable \\nGroups\\nStore values for use \\nacross multiple \\npipelines\\nNo Yes\\nImportant\\nGitH\", \"ub Actions is rapidly evolving. Be sure to check documentation carefully before deciding which \\nplat\", \"form is right for you.\\nBuild a .NET web app using GitHub Actions\\nGitHub Actions allow you to automat\", \"e workflows in response to events that are triggered in GitHub. A \\ncommon workflow is Continuous Int\", \"egration (CI), but Actions can automate other processes. For \\nexample, sending welcome emails when p\", \"eople join a repository.\\nTo explore moving code to the cloud, you\\u2019ll build a GitHub Actions workflow\", \" file. The workflow file will \\nbe used for the Simple Feed Reader app you\\u2019ve already deployed to Azu\", \"re App Service.\\nIn this article, you will: > [!div class=\\u201cchecklist\\u201d] > > * Learn the basic structur\", \"e of a GitHub Action \\nworkflow YAML file. > * Use a template to create a basic build workflow that b\", \"uilds the .NET app and \\nexecutes unit tests. > * Publish the compiled app so that it\\u2019s ready for dep\", \"loyment.\\nWorkflow structure\\nWorkflows are defined in YAML files, and contain several common nodes:\\n\\u2022\", \" a name\\n\\u2022 a trigger, defined by an on section\\n\\u2022 one or more job sections composed of one or more ste\", \"ps\\n\\u2022 optional attributes such as environment variables\\nJobs are run on runners. You can use hosted r\", \"unners, which are spun up by GitHub during the \\nworkflow and then thrown away. Hosted runners are gr\", \"eat because you don\\u2019t have to maintain your \\nown build infrastructure. For workflows that require a \", \"specific build environment, or for running \\nworkflows on a private network, you can also use private\", \" runners. To create a private runner, install the \\nrunner on any machine that supports .NET.\\nEach jo\", \"b will specify what runner GitHub should use to execute the steps. You can also specify \\ndependencie\", \"s between jobs using the needs attribute. Deployment jobs can also specify an \\nenvironment to target\", \".56 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\nThe steps node can be as eas\", \"y as inline commands, or they can be actions. Most CI workflows will \\nhave a combination of run step\", \"s (for executing scripts) and actions. Individual actions are pulled into \\nthe workflow by referenci\", \"ng the GitHub Action repository (and optionally a tag or commit hash for \\nspecific versions) and spe\", \"cifying any parameters using the with keyword.\\nTip\\nFor more information, see GitHub Actions YAML syn\", \"tax.\\nFrom a workflow file, you\\u2019re able to run any of the available .NET CLI commands. For example, i\", \"f you\\u2019re \\nrequired to build, test, and deploy an ASP.NET Core Blazor WebAssembly app with Ahead-of-T\", \"ime \\n(AoT) compilation, you\\u2019d use the following commands:\\n\\u2022 dotnet workload install\\n\\u2022 dotnet restore\", \"\\n\\u2022 dotnet build\\n\\u2022 dotnet test\\n\\u2022 dotnet publish\\nThe .NET SDK is a workflow necessity\\nAll .NET workflo\", \"ws require the .NET SDK, and this can be set up by the actions/setup-dotnet GitHub \\nAction. This act\", \"ion sets up a .NET CLI environment for use in actions. Some GitHub hosted runners\\nhave the .NET SDK \", \"preinstalled, but that\\u2019s subject to change. As a best practice, use the actions/setup\\u0002dotnet action \", \"to ensure the proper version is available.\\nCreate a basic build workflow\\nA primary principle of effe\", \"ctive DevOps is to \\u201cbuild once, and deploy many times\\u201d. You\\u2019ll start by \\ncreating a workflow to buil\", \"d a basic .NET app. In the next step, you\\u2019ll publish the output to prepare for \\ndeployment.\\n1. Navig\", \"ate to your GitHub repository and select the Actions tab.\\n2. GitHub detects that there\\u2019s .NET code i\", \"n the repository and suggests a .NET workflow \\ntemplate. Select Set up this workflow to create a new\", \" YAML workflow file:\\n**Figure 1**: Creating a new workflow.57 CHAPTER 3 | Continuous integration and\", \" deployment with Azure DevOps\\n1. Commit the file onto the main branch. Since you\\u2019ve defined a trigge\", \"r condition for commits to \\nmain, this commit should trigger the workflow to run.\\n**Figure 2**: Comm\", \"it the YAML file.\\n1. Select the Actions tab again. You should see a running workflow. Once the workf\", \"low has \\ncompleted, you should see a successful run.\\n**Figure 3**: Successful build view.\\n1. Opening\", \" the logs, you can see that the .NET build succeeded and the tests ran and passed.\\n**Figure 4**: Che\", \"cking the logs.58 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\nNote\\nIf any of\", \" the tests fail, the workflow will fail.\\nDissect the workflow file\\nLet\\u2019s examine the workflow YAML f\", \"ile you have so far:\\nname: .NET\\non:\\n push:\\n branches: [ main ]\\n pull_request:\\n branches: [ main ]\\njo\", \"bs:\\n build:\\n runs-on: ubuntu-latest\\n steps:\\n - uses: actions/checkout@v3\\n - name: Setup .NET\\n uses: \", \"actions/setup-dotnet@v3\\n with:\\n dotnet-version: 6.0.x\\n - name: Restore dependencies\\n run: dotnet res\", \"tore\\n - name: Build\\n run: dotnet build --no-restore\\n - name: Test\\n run: dotnet test --no-build --ver\", \"bosity normal\\nNotice the following things:\\n1. There\\u2019s a name that names the workflow.\\n2. The on obje\", \"ct specifies when this workflow should run. This workflow has two events that \\ntrigger it: push to m\", \"ain and pull_request to main. Each time someone commits to main or \\ncreates a pull request (PR) to m\", \"ain, this workflow will execute.\\n3. There\\u2019s a single job called build. This build should run on a ho\", \"sted agent. ubuntu_latest \\nspecifies the most recent Ubuntu hosted agent.\\n4. There are five steps:\\n1\", \". actions/checkout@v3 is an action that checks out the code in the repository onto the \\nrunner.\\n2. a\", \"ctions/setup-dotnet@v3 is an action that sets up the .NET CLI. This step also \\nspecifies a name attr\", \"ibute for the logs and the dotnet-version parameter within the \\nwith object.\\n3. Three run steps that\", \" execute dotnet restore, dotnet build, and dotnet test. name \\nattributes are also specified for thes\", \"e run steps to make the logs look pretty.59 CHAPTER 3 | Continuous integration and deployment with A\", \"zure DevOps\\nPublish the output\\nNow that you\\u2019ve successfully built and tested the code, add steps tha\", \"t publish the output so you can \\ndeploy the web app.\\n1. Navigate to the .github/workflows/dotnet.yml\", \" file and select the pencil icon to edit \\n**Figure 5**: Edit the YAML file.\\n1. Add the following Pub\", \"lish step below the Test step. The step runs the dotnet publish \\ncommand to publish the web app:\\n:::\", \"{custom-style=CodeBox} ```yml\\n\\u2013 name: Test run: dotnet test \\u2013no-build \\u2013verbosity normal # <\\u2013 this is\", \" the current \\nbottom line\\n\\u2013 name: Publish run: dotnet publish SimpleFeedReader/SimpleFeedReader.cspr\", \"oj -c \\nRelease -o website ``` :::\\n2. This publishes the web app to a folder on the hosted agent. Now\", \" you\\u2019ll want to upload the \\nsite as a build artifact that can be deployed to Azure. To complete this\", \" activity, you\\u2019ll use an \\nexisting action.\\n3. On the list of actions in the Actions Helper pane on t\", \"he right, search for artifact. Select on \\nthe Upload a Build Artifact (By actions) action.\\n \\n**Figur\", \"e 6**: Accessing the snippet helper.60 CHAPTER 3 | Continuous integration and deployment with Azure \", \"DevOps\\n1. Edit the version to v2.2.2 to display a sample snippet. Select the clipboard icon to copy \", \"the \\nsnippet and paste it into the workflow below the publish step.\\n**Figure 7**: Copying a snippet.\", \"\\n1. Edit the YAML for this step to look as follows:\\n:::{custom-style=CodeBox} ```yml\\n\\u2013 name: Upload \", \"a Build Artifact uses: actions/upload-artifact@v3 with: name: website \\npath: SimpleFeedReader/websit\", \"e/** if-no-files-found: error ``` :::\\n2. Commit the file.\\n3. Once the workflow completes, you\\u2019ll see\", \" the artifact from the Home tab:\\n**Figure 8**: Viewing artifacts in the summary page.61 CHAPTER 3 | \", \"Continuous integration and deployment with Azure DevOps\\nFinal workflow file\\nThe final workflow file \", \"should look something like this:\\nname: .NET\\non:\\n push:\\n branches: [ main ]\\n pull_request:\\n branches:\", \" [ main ]\\njobs:\\n build:\\n runs-on: ubuntu-latest\\n steps:\\n - uses: actions/checkout@v3\\n - name: Setup \", \".NET\\n uses: actions/setup-dotnet@v3\\n with:\\n dotnet-version: 6.0.x\\n - name: Restore dependencies\\n run\", \": dotnet restore\\n - name: Build\\n run: dotnet build --no-restore\\n - name: Test\\n run: dotnet test --no\", \"-build --verbosity normal\\n - name: Publish\\n run: dotnet publish SimpleFeedReader/SimpleFeedReader.cs\", \"proj -c Release -o website\\n - name: Upload a Build Artifact\\n uses: actions/upload-artifact@v3\\n with:\", \"\\n name: website\\n path: SimpleFeedReader/website/**\\n if-no-files-found: error\\nDeploy a .NET web app u\", \"sing GitHub Actions\\nWarning\\nPlease complete the Build tutorial before starting this lab.\\nIn this art\", \"icle, you\\u2019ll: > [!div class=\\u201cchecklist\\u201d] > > * Learn about Environments in GitHub Actions. > * \\nCrea\", \"te two environments and specify environment protection rules. > * Create environment secrets \\nfor ma\", \"naging environment-specific configuration. > * Extend the workflow YAML file to add \\ndeployment step\", \"s. > * Add a manual dispatch trigger.\\nEnvironments\\nNow that you\\u2019ve published an artifact that\\u2019s pote\", \"ntially deployable, you\\u2019ll add deployment jobs to the \\nworkflow. There\\u2019s nothing special about a dep\", \"loyment job, other than the fact that it references an 62 CHAPTER 3 | Continuous integration and dep\", \"loyment with Azure DevOps\\nenvironment. Environments are logical constructs that allow you to specify\", \" environment protection \\nrules, such as approvals, on any group of resources that you\\u2019re targeting.\\n\", \"In this walkthrough, you\\u2019ll be deploying to two environments: PRE-PROD and PROD. In a typical \\ndevel\", \"opment lifecycle, you\\u2019ll want to deploy the latest code to a soft environment (typically DEV) that \\n\", \"is expected to be a bit unstable. You\\u2019ll use PRE-PROD as this soft environment. The \\u201chigher\\u201d \\nenviro\", \"nments (like UAT and PROD) are harder environments that are expected to be more stable. To \\nenforce \", \"this, you can build protection rules into higher environments. You\\u2019ll configure an approval \\nprotect\", \"ion rule on the PROD environment: whenever a deployment job targets an environment with \\nan approval\", \" rule, it will pause until approval is granted before executing.\\nGitHub environments are logical. Th\", \"ey represent the physical (or virtual) resources that you\\u2019re \\ndeploying to. In this case, the PRE-PR\", \"OD is just a deployment slot on the Azure Web App. PROD is the \\nproduction slot. The PRE-PROD deploy\", \"ment job will deploy the published .NET app to the staging \\nslot. The PROD deployment job will swap \", \"the slots.\\nOnce you have these steps in place, you\\u2019ll update the workflow to handle environment-spec\", \"ific \\nconfiguration using environment secrets.\\nNote\\nFor more information, see GitHub Actions - Envir\", \"onments.\\nAzure authentication\\nTo perform actions such as deploying code to an Azure resource, you ne\", \"ed the correct permissions. \\nFor deployment to Azure Web Apps, you can use a publishing profile. If \", \"you want to deploy to a \\nstaging slot, then you\\u2019ll need the publishing profile for the slot too. Ins\", \"tead, you can use a service \\nprincipal (SPN) and assign permission to this service principal. You ca\", \"n then authenticate using \\ncredentials for the SPN before using any commands that the SPN has permis\", \"sions to perform.\\nOnce you have an SPN, you\\u2019ll create a repository secret to securely store the cred\", \"entials. You can then \\nrefer to the secret whenever you need to authenticate. The secret is encrypte\", \"d and once it has been \\nsaved, can never be viewed or edited (only deleted or re-created).\\nCreate an\", \" SPN\\n1. In your terminal or Cloud Shell, run the following command to create a service principal wit\", \"h \\ncontributor permissions to the web app you created earlier:\\n:::{custom-style=CodeBox} azurecli az\", \" ad sp create-for-rbac --name \\\"{sp-name}\\\" --sdk-auth --\\nrole contributor \\\\ --scopes /subscriptions/{\", \"subscription-id}/resourceGroups/{resource\\u0002group}/providers/Microsoft.Web/sites/{webappname} :::\\n2. T\", \"he command should output JSON that has credentials embedded:\\n:::{custom-style=CodeBox} json { \\\"clien\", \"tId\\\": \\\"<GUID>\\\", \\\"clientSecret\\\": \\\"<GUID>\\\", \\n\\\"subscriptionId\\\": \\\"<GUID>\\\", \\\"tenantId\\\": \\\"<GUID>\\\", ... } :\", \"::63 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n3. Make sure to record the \", \"clientId, clientSecret, subscription, and tenantId. You can also leave \\nthe terminal open for copy/p\", \"aste later.\\nCreate a repository secret\\n1. Now you\\u2019re going to create an encrypted secret to store th\", \"e credentials. You\\u2019ll create this \\nsecret at the repository level.\\n2. Navigate to GitHub and select \", \"your repository Settings tab. Then select Secrets. Select New \\nrepository secret:\\n \\n**Figure 1**: Cr\", \"eate a secret.\\n1. Copy and paste the JSON from the az ad sp create-for-rbac command into the body of\", \" the \\nsecret. You can create this JSON by hand too if you have the relevant fields for your SPN. The\", \" \\nsecret should be named AZURE_CREDENTIALS. Select Add secret to save the new secret:\\n \\n**Figure 2**\", \": Add Azure credentials.\\n1. You\\u2019ll consume this secret in a workflow in later steps. To access it, u\", \"se the variable notation \\n${{}}. In this case, ${{ AZURE_CREDENTIAL }} will be populated with the JS\", \"ON you saved.\\nAdd environments\\nEnvironments are used as a logical boundary. You can add approvals to\", \" environments to ensure \\nquality. You can also track deployments to environments and specify environ\", \"ment-specific values \\n(secrets) for configuration.64 CHAPTER 3 | Continuous integration and deployme\", \"nt with Azure DevOps\\nFor this example, you\\u2019re going to split the actual Azure environment into two l\", \"ogical environments \\ncalled PRE-PROD and PROD. When you deploy the web app, you\\u2019ll deploy to the sta\", \"ging slot of the \\nAzure web app, represented by the PRE-PROD environment. When you\\u2019re ready to deplo\", \"y to PROD, \\nyou\\u2019ll just perform a slot swap.\\nIn this case, the only difference between the environme\", \"nts is the slot that you\\u2019re deploying to. In real \\nlife, there would typically be different web apps\", \" (and separate web app plans), separate resource \\ngroups, and even separate subscriptions. Typically\", \", there\\u2019s an SPN per environment. You may want to \\noverride the AZURE_CREDENTIAL value that you save\", \"d as a repository secret by creating it as an \\nenvironment secret.\\nNote\\nPrecedence works from Enviro\", \"nment to repository. If a targeted environment has a secret called \\nMY_SECRET, then that value is us\", \"ed. If not, the repository value of MY_SECRET (if any) is used.\\n1. Select Settings and then Environm\", \"ents in your repository. Select New Environment:\\n \\n**Figure 3**: Create an environment.\\n1. Enter PRE\", \"-PROD and select Configure environment:\\n**Figure 4**: Name the environment.65 CHAPTER 3 | Continuous\", \" integration and deployment with Azure DevOps\\n1. Since deploying to a staging slot doesn\\u2019t affect th\", \"e web app, you can safely deploy to the slot \\nwithout requiring an approval first. A reviewer could \", \"be added if desired. For this example, \\nleave the Environment protection rules empty.\\n[!NOTE] If you\", \" target an environment in a workflow and it does not exist, an \\u201cempty\\u201d \\nenvironment is created autom\", \"atically. The environment would look exactly the same as the \\nPRE-PROD environment - it would exist,\", \" but would not have any protection rules enabled.\\n2. Select Environments again and again select New \", \"Environment. Now enter PROD as the \\nname and select Configure environment.\\n3. Check the Required rev\", \"iewers rule and add yourself as a reviewer. Don\\u2019t forget to select \\nSave protection rules:\\n \\n**Figur\", \"e 5**: Add protection rules.\\nDeploy to staging\\nYou can now add additional jobs to the workflow to de\", \"ploy to the environments! You\\u2019ll start by \\nadding a deployment to the PRE-PROD environment, which in\", \" this case is the web app staging slot.\\n1. Navigate to the .github/workflows/dotnet.yml file and sel\", \"ect the pencil icon to edit the file.\\n2. You\\u2019re going to use the web app name a few times in this wo\", \"rkflow, and will need the name \\nof the resource group too. You\\u2019ll define the app and resource group \", \"names as variables. With \\nthe variables, you can maintain the values in one place in the workflow fi\", \"le.\\n3. Add this snippet below the on block and above the jobs block:\\n:::{custom-style=CodeBox} ```ym\", \"l env: app-name: \\u201c\\u201d rg-name: \\u201c\\u201d\\njobs: # <\\u2013 this is the existing jobs line ``` :::\\n[!WARNING] You\\u2019ll \", \"need to replace <name of your web app> with the actual name of your \\nweb app, and <name of your reso\", \"urce group> with the actual name of your resource group.\\n4. Add a new job below the build job as fol\", \"lows:66 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n:::{custom-style=CodeBox\", \"} ```yml if-no-files-found: error # <\\u2013 last line of build job: insert \\nbelow this line\\ndeploy_stagin\", \"g: needs: build runs-on: ubuntu-latest\\nenvironment:\\n name: PRE-PROD\\n url: ${{ steps.deploywebapp.out\", \"puts.webapp-url }}\\nsteps:\\n- name: Download a Build Artifact\\n uses: actions/download-artifact@v3\\n wit\", \"h:\\n name: website\\n path: website\\n- name: Login via Azure CLI\\n uses: azure/login@v1\\n with:\\n creds: ${\", \"{ secrets.AZURE_CREDENTIALS }}\\n- name: Deploy web app\\n id: deploywebapp\\n uses: azure/webapps-deploy@\", \"v2\\n with:\\n app-name: ${{ env.app-name }}\\n slot-name: staging\\n package: website\\n- name: az cli logout\", \"\\n run: az logout\\n``` :::\\nThe preceding workflow defines several steps:\\n1. You\\u2019re creating a new job \", \"called deploy_staging.\\n2. You specify a dependency using needs. This job needs the build job to comp\", \"lete \\nsuccessfully before it starts.\\n3. This job also runs on the latest Ubuntu hosted agent, as spe\", \"cified with the runs-on \\nattribute.\\n4. You specify that this job is targeting the PRE-PROD environme\", \"nt using the \\nenvironment object. You also specify the url property. This URL will be displayed in \\n\", \"the workflow diagram, giving users an easy way to navigate to the environment. The \\nvalue of this pr\", \"operty is set as the output of the step with id deploywebapp, which is \\ndefined below.\\n5. You\\u2019re exe\", \"cuting a download-artifact step to download the artifact (compiled web \\napp) from the build job.\\n6. \", \"You then login to Azure using the AZURE_CREDENTIALS secret you saved earlier. \\nNote the ${{ }} notat\", \"ion for dereferencing variables.\\n7. You then perform a webapp-deploy, specifying the app-name, slot-\", \"name, and path to \\nthe downloaded artifact (package). This action also defines an output parameter t\", \"hat \\nyou use to set the url of the environment above.67 CHAPTER 3 | Continuous integration and deplo\", \"yment with Azure DevOps\\n8. Finally, you execute a logout to log out of the Azure context.\\n5. Commit \", \"the file.\\n6. When the run completes, you should see two successful jobs. The URL for the PRE-PROD \\ns\", \"tage has been set and selecting it will navigate you to your web app staging slot:\\n \\n**Figure 6**: D\", \"eployment to PRE-PROD is successful.\\n1. Notice how the staging slot\\u2019s direct URL contains -staging:\\n\", \" \\n**Figure 7**: The staging slot running.\\n1. You can also now see deployments. Navigate to https://{\", \"your repository url}/deployments to \\nview your deployments:68 CHAPTER 3 | Continuous integration and\", \" deployment with Azure DevOps\\n \\n**Figure 8**: View deployments.\\nDeploy to production\\nNow that you\\u2019ve\", \" deployed successfully to PRE-PROD, you\\u2019ll want to deploy to PROD. Deployment to \\nPROD will be sligh\", \"tly different since you don\\u2019t need to copy the website again - you just need to swap \\nthe staging sl\", \"ot with the production slot. You\\u2019ll do this using an Azure CLI (az) command.\\n1. Navigate to the .git\", \"hub/workflows/dotnet.yml file and select the pencil icon to edit the file.\\n2. Add a new job below th\", \"e deploy_staging job as follows:\\n:::{custom-style=CodeBox} ```yml run: az logout # <\\u2013 last line of p\", \"revious job: insert below this \\nline\\ndeploy_prod: needs: deploy_staging runs-on: ubuntu-latest\\nenvir\", \"onment:\\n name: PROD\\n url: ${{ steps.slot_swap.outputs.url }}\\nsteps:\\n- name: Login via Azure CLI\\n use\", \"s: azure/login@v1\\n with:\\n creds: ${{ secrets.AZURE_CREDENTIALS }}\\n- name: Swap staging slot into pro\", \"duction\\n id: slot_swap\\n run: |\\n az webapp deployment slot swap -g ${{ env.rg-name }} -n ${{ env.app-\", \"name }} -s staging\\n url=$(az webapp show -g ${{ env.rg-name }} -n ${{ env.app-name }} --query \\n\\\"defa\", \"ultHostName\\\" -o tsv)\\n echo \\\"::set-output name=url::http://$url\\\"\\n- name: az cli logout\\n run: az logou\", \"t\\n``` :::\\nThe deployment to the PROD environment workflow specifies several steps:\\n1. Once again, yo\", \"u specify a new job deploy_prod that needs deploy_staging to \\ncomplete before starting.\\n2. You\\u2019re ta\", \"rgeting the PROD environment this time. Also, the url value is different from \\nbefore.69 CHAPTER 3 |\", \" Continuous integration and deployment with Azure DevOps\\n3. For the steps, you don\\u2019t need to downloa\", \"d the artifact since you\\u2019re just going to \\nperform a slot swap. You start by executing a login to th\", \"e Azure context.\\n4. The Swap staging slot into production step is a multi-line run command (note the\", \" use \\nof the pipe symbol |). You also specify an id for this step so that you can refer to it \\n(you \", \"refer to it in the url property of the environment). The first line executes the slot \\nswap using th\", \"e variables you defined above in the workflow. The second line uses an \\naz webapp show command to ex\", \"tract the URL of the target web app. This final line \\nuses ::set-output in an echo to create an outp\", \"ut variable for this task, setting the value \\nto the web app URL.\\n[!NOTE] The URL must start with ht\", \"tp:// or https:// or it won\\u2019t render.\\n3. Commit the file.\\n4. Let the workflow run for a couple minut\", \"es until it has deployed to PRE-PROD. At this point, \\nthe workflow will pause and wait for the requi\", \"red approval since you\\u2019re targeting the PROD \\nenvironment, which requires an approval as defined ear\", \"lier:\\n \\n**Figure 9**: Waiting for an approval.\\n1. Select Review deployments, select the PROD checkbo\", \"x, optionally add a comment, and then \\nselect Approve and deploy to start the PROD job.\\n**Figure 10*\", \"*: Approve the PROD deployment.\\n1. The deployment should only take a few seconds. Once it has comple\", \"ted, the URL for the \\nPROD environment will update.70 CHAPTER 3 | Continuous integration and deploym\", \"ent with Azure DevOps\\n \\n**Figure 11**: PROD deployment completed.\\n1. Selecting the PROD URL will nav\", \"igate you to the PROD site.\\n \\n**Figure 12**: The PROD site.\\nAdd a manual queue option\\nYou now have a\", \"n end-to-end build and deploy workflow, including approvals. One more change you \\ncan make is to add\", \" a manual trigger to the workflow so that the workflow can be triggered from \\nwithin the Actions tab\", \" of the repository.\\n1. Navigate to the .github/workflows/dotnet.yml file and select the pencil icon \", \"to edit the file.\\n2. Add a new trigger between on and push on lines 3 and 4:\\n:::{custom-style=CodeBo\", \"x} yml on: workflow_dispatch: # <-- this is the new line push: :::\\n3. The workflow_dispatch trigger \", \"displays a Run workflow button in the Actions tab of the \\nrepository\\u2014but only if the trigger is defi\", \"ned in the default branch. However, once this trigger is \\ndefined in the workflow, you can select th\", \"e branch for the run.\\n4. Commit the file.71 CHAPTER 3 | Continuous integration and deployment with A\", \"zure DevOps\\n5. To see the Run workflow button, select the Actions tab. Select the .NET workflow in t\", \"he list \\nof workflows. At the top of the list of runs, you\\u2019ll see the Run workflow button. If you se\", \"lect \\nit, you can choose the branch to run the workflow against and queue it:\\n \\n**Figure 13**: Manua\", \"l dispatch.\\nHandle environment configuration\\nYour workflow is deploying the same binary to each envi\", \"ronment. This concept is important to ensure \\nthat the binaries you test in one environment are the \", \"same that you deploy to the next. However, \\nenvironments typically have different settings like data\", \"base connection strings. You want to ensure \\nthat the DEV app is using DEV settings and the PROD app\", \" is using PROD settings.\\nFor this simple app, there\\u2019s no database connection string. However, there\\u2019\", \"s an example configuration \\nsetting that you can modify for each environment. If you open the simple\", \"-feed\\u0002reader/SimpleFeedReader/appsettings.json file, you\\u2019ll see that the configuration includes a se\", \"tting for \\nthe Header text on the Index page:\\n \\\"UI\\\": {\\n \\\"Index\\\": {\\n \\\"Header\\\": \\\"Simple News Reader\\\"\\n \", \"}\\n },\\nTo show how environment configuration can be handled, you\\u2019re going to add a secret to each \\nen\", \"vironment and then substitute that value into the settings as you deploy.\\nAdd environment secrets\\n1.\", \" On your repository, select Settings > Environments > PRE-PROD.\\n2. Select Add secret and add a secre\", \"t called index_header with the value PRE PROD News \\nReader. Select Add secret.72 CHAPTER 3 | Continu\", \"ous integration and deployment with Azure DevOps\\n \\n**Figure 14**: Add an environment secret.\\n1. Repe\", \"at these steps to add a secret called index_header with the value PROD News Reader for \\nthe PROD env\", \"ironment.\\n2. If you select Settings > Secrets in the repository, you\\u2019ll see the changes. They should\", \" look \\nsomething like this:\\n \\n**Figure 15**: View secrets.\\nUpdate the workflow to handle configurati\", \"on\\n1. Navigate to the .github/workflows/dotnet.yml file and select the pencil icon to edit the file.\", \"\\n2. Add the following step before the az cli logout step in the deploy_staging job:\\n:::{custom-style\", \"=CodeBox} ```yml - name: Update config uses: Azure/appservice-settings@v1 \\nwith: app-name: ${{ env.a\", \"pp-name }} slot-name: staging app-settings-json: | [ { \\\"name\\\": \\n\\\"UI:Index:Header\\\", \\\"value\\\": \\\"${{ sec\", \"rets.INDEX_HEADER }}\\u201c,\\u201dslotSetting\\u201d: true } ]\\n- name: az cli logout # <-- this exists already\\n``` ::\", \":73 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n3. Add almost the same code \", \"to the deploy_prod job above its az cli logout step. The only \\ndifference is that you don\\u2019t specify \", \"a slot-name, since you\\u2019re targeting the production slot:\\n:::{custom-style=CodeBox} ```yml - name: Up\", \"date config uses: Azure/appservice-settings@v1 \\nwith: app-name: ${{ env.app-name }} app-settings-jso\", \"n: | [ { \\\"name\\\": \\\"UI:Index:Header\\\", \\n\\\"value\\\": \\\"${{ secrets.INDEX_HEADER }}\\u201c,\\u201dslotSetting\\u201d: true } ]\\n\", \"- name: az cli logout # <-- this exists already\\n``` :::\\n4. Commit the file.\\n5. Let the workflow run \", \"and approve the deployment to PROD once the approval is reached.\\n6. You should see the following hea\", \"ders on the index page for both sites:\\n \\n**Figure 16**: Settings changed in the environments.\\nFinal \", \"workflow file\\nThe final workflow file should look like this:\\nname: .NET\\non:\\n workflow_dispatch:\\n inp\", \"uts:\\n reason:\\n description: 'The reason for running the workflow'\\n required: true\\n default: 'Manual \", \"build from GitHub UI'\\n push:\\n branches: [ main ]\\n pull_request:\\n branches: [ main ]\\nenv:\\n app-name: \", \"\\\"cd-simplefeedreader\\\"\\n rg-name: \\\"cd-dotnetactions\\\"\\njobs:\\n build:74 CHAPTER 3 | Continuous integratio\", \"n and deployment with Azure DevOps\\n runs-on: ubuntu-latest\\n steps:\\n - uses: actions/checkout@v3\\n - n\", \"ame: 'Print manual run reason'\\n if: ${{ github.event_name == 'workflow_dispatch' }}\\n run: |\\n echo 'R\", \"eason: ${{ github.event.inputs.reason }}'\\n - name: Setup .NET\\n uses: actions/setup-dotnet@v3\\n with:\\n\", \" dotnet-version: 6.0.x\\n - name: Restore dependencies\\n run: dotnet restore\\n - name: Build\\n run: dotne\", \"t build --no-restore\\n - name: Test\\n run: dotnet test --no-build --verbosity normal\\n - name: Publish\\n\", \" run: dotnet publish SimpleFeedReader/SimpleFeedReader.csproj -c Release -o website\\n - name: Upload \", \"a Build Artifact\\n uses: actions/upload-artifact@v3\\n with:\\n name: website\\n path: SimpleFeedReader/web\", \"site/**\\n if-no-files-found: error\\n \\n deploy_staging:\\n needs: build\\n runs-on: ubuntu-latest\\n environm\", \"ent:\\n name: STAGING\\n url: ${{ steps.deploywebapp.outputs.webapp-url }}\\n steps:\\n - name: Download a B\", \"uild Artifact\\n uses: actions/download-artifact@v3\\n with:\\n name: website\\n path: website\\n - name: Logi\", \"n via Azure CLI\\n uses: azure/login@v1\\n with:\\n creds: ${{ secrets.AZURE_CREDENTIALS }}\\n - name: Deplo\", \"y web app\\n id: deploywebapp\\n uses: azure/webapps-deploy@v2\\n with:\\n app-name: ${{ env.app-name }}\\n sl\", \"ot-name: staging\\n package: website\\n - name: Update config\\n uses: Azure/appservice-settings@v1\\n with:\", \"\\n app-name: ${{ env.app-name }}\\n slot-name: staging\\n app-settings-json: |75 CHAPTER 3 | Continuous i\", \"ntegration and deployment with Azure DevOps\\n [\\n {\\n \\\"name\\\": \\\"UI:Index:Header\\\",\\n \\\"value\\\": \\\"${{ secrets\", \".INDEX_HEADER }}\\\",\\n \\\"slotSetting\\\": true\\n }\\n ]\\n - name: az cli logout\\n run: az logout\\n deploy_prod:\\n \", \"needs: deploy_staging\\n runs-on: ubuntu-latest\\n environment:\\n name: PROD\\n url: ${{ steps.slot_swap.ou\", \"tputs.url }}\\n steps:\\n - name: Login via Azure CLI\\n uses: azure/login@v1\\n with:\\n creds: ${{ secrets.A\", \"ZURE_CREDENTIALS }}\\n - name: Swap staging slot into production\\n id: slot_swap\\n run: |\\n az webapp dep\", \"loyment slot swap -g ${{ env.rg-name }} -n ${{ env.app-name }} -s \\nstaging\\n url=$(az webapp show -g \", \"${{ env.rg-name }} -n ${{ env.app-name }} --query \\n\\\"defaultHostName\\\" -o tsv)\\n echo \\\"::set-output nam\", \"e=url::http://$url\\\"\\n - name: Update config\\n uses: Azure/appservice-settings@v1\\n with:\\n app-name: ${{\", \" env.app-name }}\\n app-settings-json: |\\n [\\n {\\n \\\"name\\\": \\\"UI:Index:Header\\\",\\n \\\"value\\\": \\\"${{ secrets.INDE\", \"X_HEADER }}\\\",\\n \\\"slotSetting\\\": true\\n }\\n ]\\n - name: az cli logout\\n run: az logout\\nSecure .NET Code wit\", \"h CodeQL and GitHub Actions\\nCodeQL is a static code analysis engine that can automate security and q\", \"uality checks. With CodeQL, \\nyou can perform variant analysis, which uses known vulnerabilities as s\", \"eeds to find similar issues. \\nCodeQL is part of GitHub Advanced Security that includes:\\n[!div class=\", \"\\u201cchecklist\\u201d]76 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n\\u2022 Code scanning\\u2014f\", \"ind potential security vulnerabilities in your code.\\n\\u2022 Secret scanning\\u2014detect secrets and tokens tha\", \"t are committed.\\n\\u2022 Dependency scanning\\u2014detect vulnerabilities in packages that you consume.\\nCodeQL s\", \"upports some of the most popular programming languages and compilers:\\n\\u2022 C/C++\\n\\u2022 Java\\n\\u2022 C#\\n\\u2022 Python\\n\\u2022\", \" Go\\n\\u2022 JavaScript\\n\\u2022 TypeScript\\nCodeQL is a powerful language and security professionals can create cu\", \"stom queries using CodeQL. \\nHowever, teams can benefit immensely from the large open-source collecti\", \"on of queries that the \\nsecurity community has created without having to write any custom CodeQL.\\nIn\", \" this article, you\\u2019ll set up a GitHub workflow that will scan code in your repository using CodeQL. \", \"\\nYou will:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Create a code scanning action.\\n\\u2022 Edit the workflow file to inc\", \"lude custom scan settings.\\n\\u2022 See scanning results.\\nNote\\nTo see security alerts for your repository, \", \"you must be a repository owner.\\nCreate the code scanning workflow\\nYou can use a starter workflow for\", \" code scanning by navigating to the Security tab of your repository.\\n1. Navigate to your GitHub repo\", \"sitory and select the Security > Code Scanning Alerts. The top \\nrecommended workflow should be CodeQ\", \"L Analysis. Select Set up this workflow.\\n \\n**Figure 1:** Create a new code scanning workflow.77 CHAP\", \"TER 3 | Continuous integration and deployment with Azure DevOps\\n1. A new workflow file is created in\", \" your .github/workflows folder.\\n2. Select Start Commit on the upper right to save the default workfl\", \"ow. You can commit to the \\nmain branch.\\n \\n**Figure 2:** Commit the file.\\n1. Select the Actions tab. \", \"In the left-hand tree, you\\u2019ll see a CodeQL node. Select this node to \\nfilter for CodeQL workflow run\", \"s.\\n \\n**Figure 3:** View the CodeQL workflow runs.\\nTake a look at the workflow file while it runs. If\", \" you remove the comments from the file, you\\u2019ll see the \\nfollowing YAML:\\nname: \\\"CodeQL\\\"\\non:\\n push:\\n b\", \"ranches: [ main ]\\n pull_request:\\n branches: [ main ]\\n schedule:\\n - cron: '40 14 * * 6'\\njobs:\\n analyz\", \"e:\\n name: Analyze\\n runs-on: ubuntu-latest\\n strategy:\\n fail-fast: false78 CHAPTER 3 | Continuous inte\", \"gration and deployment with Azure DevOps\\n matrix:\\n language: [ 'csharp' ]\\n steps:\\n - name: Checkout \", \"repository\\n uses: actions/checkout@v3\\n - name: Initialize CodeQL\\n uses: github/codeql-action/init@v1\", \"\\n with:\\n languages: ${{ matrix.language }}\\n - name: Autobuild\\n uses: github/codeql-action/autobuild@\", \"v1\\n - name: Perform CodeQL Analysis\\n uses: github/codeql-action/analyze@v1\\nNotice the following thin\", \"gs:\\n1. The workflow name is CodeQL.\\n2. This workflow triggers on push and pull_request events to the\", \" main branch. There\\u2019s also a \\ncron trigger. The cron trigger lets you define a schedule for triggeri\", \"ng this workflow and is \\nrandomly generated for you. In this case, this workflow will run at 14:40 U\", \"TC every Saturday.\\n[!TIP] If you edit the workflow file and hover over the cron expression, a toolti\", \"p will show you \\nthe English text for the cron expression.\\n3. There\\u2019s a single job called analyze th\", \"at runs on the ubuntu-latest hosted agent.\\n4. This workflow defines a strategy with a matrix on the \", \"array of language. In this case, there\\u2019s \\nonly csharp. If the repository contained other languages, \", \"you could add them to this array. \\nThis causes the job to \\u201cfan out\\u201d and create an instance per value\", \" of the matrix.\\n5. There are four steps, starting with checkout.\\n6. The second step initializes the \", \"CodeQL scanner for the language this job is going to scan. \\nCodeQL intercepts calls to the compiler \", \"to build a database of the code while the code is \\nbeing built.\\n7. The Autobuild step will attempt t\", \"o automatically build the source code using common \\nconventions. If this step fails, you can replace\", \" it with your own custom build steps.\\n8. After building, the CodeQL analysis is performed, where sui\", \"tes of queries are run against the \\ncode database.\\n9. The run should complete successfully. However,\", \" there appear to be no issues.79 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\", \"\\n \\n**Figure 4:** No results to the initial scan.\\nCustomize CodeQL settings\\nThe CodeQL scan isn\\u2019t rep\", \"orting any security issues. That\\u2019s expected with this basic sample. CodeQL \\ncan also scan for qualit\", \"y issues. The current workflow is using the default security-extended suite. You \\ncan add quality sc\", \"anning in by adding a configuration file to customize the scanning suites. In this \\nstep, you\\u2019ll con\", \"figure CodeQL to use the security-and-quality suites.\\n[!INFORMATION] For other CodeQL configuration \", \"options, see Configuring CodeQL code scanning in \\nyour CI system.\\n1. Navigate to the .github folder \", \"in the Code tab and select Add File:\\n \\n**Figure 5:** Create a new file.\\n1. Enter codeql/codeql-confi\", \"g.yml as the name. This creates the file in a folder. Paste in the \\nfollowing code:\\n:::{custom-style\", \"=CodeBox} ```yml name: \\u201cSecurity and Quality\\u201d\\nqueries:\\n\\u2013 uses: security-and-quality ``` :::80 CHAPTE\", \"R 3 | Continuous integration and deployment with Azure DevOps\\n \\n**Figure 6:** Create the CodeQL conf\", \"iguration file.\\n1. Select Commit to main at bottom of the editor to commit the file.\\n2. Edit the Cod\", \"eQL workflow to use the new configuration file. Navigate to \\n.github/workflows/codeql-analysis.yml a\", \"nd select the pencil icon. Add a new property to the \\nwith section as shown below:\\n:::{custom-style=\", \"CodeBox} yml - name: Initialize CodeQL uses: github/codeql-action/init@v1 \\nwith: languages: ${{ matr\", \"ix.language }} config-file: ./.github/codeql/codeql-config.yml # <--\\nadd this line :::\\n1. Select Sta\", \"rt Commit and commit to the main branch.\\nReview the security alerts\\nImportant\\nYou must be a reposito\", \"ry owner to view security alerts.\\nThis sample repository is small. As such, it doesn\\u2019t contain any m\", \"ajor security or quality issues. \\nHowever, \\u201creal world\\u201d repositories will likely have some issues.\\nW\", \"hen the last CodeQL workflow run completes, you should see two issues in the Security tab:81 CHAPTER\", \" 3 | Continuous integration and deployment with Azure DevOps\\nFigure 7: View security alerts.\\n1. Sele\", \"ct the first alert to open it.\\n2. In this case, the alert is for a generated file that isn\\u2019t committ\", \"ed to the repository. For that \\nreason, the preview is unavailable.\\n3. Notice the tags that are appl\", \"ied. These tags can be used for filtering issues.\\n4. Select Show more under the rule information to \", \"show help and recommendations.\\n \\n**Figure 8:** Open an alert.\\n1. Selecting Dismiss will open options\", \" for dismissing this issue:82 CHAPTER 3 | Continuous integration and deployment with Azure DevOps\\n \\n\", \"**Figure 9:** Dismiss an alert.83 CHAPTER 4 | Monitor and debug\\nCHAPTER 4\\nMonitor and debug\\nHaving d\", \"eployed the app and built a DevOps pipeline, it\\u2019s important to understand how to monitor \\nand troubl\", \"eshoot the app.\\nIn this section, you\\u2019ll complete the following tasks:\\n[!div class=\\u201cchecklist\\u201d]\\n\\u2022 Fin\", \"d basic monitoring and troubleshooting data in the Azure portal\\n\\u2022 Learn how Azure Monitor provides a\", \" deeper look at metrics across all Azure services\\n\\u2022 Connect the web app with Application Insights fo\", \"r app profiling\\n\\u2022 Turn on logging and learn where to download logs\\n\\u2022 Stream logs in real time\\n\\u2022 Lear\", \"n where to set up alerts\\n\\u2022 Learn about remote debugging Azure App Service web apps.\\nBasic monitoring\", \" and troubleshooting\\nApp Service web apps are easily monitored in real time. The Azure portal render\", \"s metrics in easy-to\\u0002understand charts and graphs.\\n1. Open the Azure portal, and then navigate to th\", \"e mywebapp<unique_number> App Service.\\n2. The Overview tab displays useful \\u201cat-a-glance\\u201d information\", \", including graphs displaying \\nrecent metrics.\\n 84 CHAPTER 4 | Monitor and debug\\n* **Http 5xx**: Cou\", \"nt of server-side errors, usually exceptions in ASP.NET Core code.\\n* **Data In**: Data ingress comin\", \"g into your web app.\\n* **Data Out**: Data egress from your web app to clients.\\n* **Requests**: Count\", \" of HTTP requests.\\n* **Average Response Time**: Average time for the web app to respond to HTTP requ\", \"ests.\\nSeveral self-service tools for troubleshooting and optimization are also found on this \\npage.\\n\", \"* **Diagnose and solve problems** is a self-service troubleshooter.\\n* **Application Insights** is fo\", \"r profiling performance and app behavior, and is \\ndiscussed later in this section.\\n* **App Service A\", \"dvisor** makes recommendations to tune your app experience.\\nAdvanced monitoring\\nAzure Monitor is the\", \" centralized service for monitoring all metrics and setting alerts across Azure \\nservices. Within Az\", \"ure Monitor, administrators can granularly track performance and identify trends. \\nEach Azure servic\", \"e offers its own set of metrics to Azure Monitor.\\nProfile with Application Insights\\nApplication Insi\", \"ghts is an Azure service for analyzing the performance and stability of web apps and \\nhow users use \", \"them. The data from Application Insights is broader and deeper than that of Azure \\nMonitor. The data\", \" can provide developers and administrators with key information for improving \\napps. Application Ins\", \"ights can be added to an Azure App Service resource without code changes.\\n1. Open the Azure portal, \", \"and then navigate to the mywebapp<unique_number> App Service.\\n2. From the Overview tab, click the Ap\", \"plication Insights tile.85 CHAPTER 4 | Monitor and debug\\n1. Select the Create new resource radio but\", \"ton. Use the default resource name, and select the \\nlocation for the Application Insights resource. \", \"The location doesn\\u2019t need to match that of your \\nweb app.\\n \\n1. For Runtime/Framework, select ASP.NET\", \" Core. Accept the default settings.\\n2. Select OK. If prompted to confirm, select Continue.\\n3. After \", \"the resource has been created, click the name of Application Insights resource to \\nnavigate directly\", \" to the Application Insights page.\\nAs the app is used, data accumulates. Select Refresh to reload th\", \"e blade with new data.86 CHAPTER 4 | Monitor and debug\\nApplication Insights provides useful server-s\", \"ide information with no additional configuration. To get \\nthe most value from Application Insights, \", \"instrument your app with the Application Insights SDK. \\nWhen properly configured, the service provid\", \"es end-to-end monitoring across the web server and 87 CHAPTER 4 | Monitor and debug\\nbrowser, includi\", \"ng client-side performance. For more information, see the Application Insights \\ndocumentation.\\nLoggi\", \"ng\\nWeb server and app logs are disabled by default in Azure App Service. Enable the logs with the \\nf\", \"ollowing steps:\\n1. Open the Azure portal, and navigate to the mywebapp<unique_number> App Service.\\n2\", \". In the menu to the left, scroll down to the Monitoring section. Select Diagnostics logs.\\n \\n1. Turn\", \" on Application Logging (Filesystem). If prompted, click the box to install the \\nextensions to enabl\", \"e app logging in the web app.\\n2. Set Web server logging to File System.\\n3. Enter the Retention Perio\", \"d in days. For example, 30.\\n4. Click Save.\\nASP.NET Core and web server (App Service) logs are genera\", \"ted for the web app. They can be \\ndownloaded using the FTP/FTPS information displayed. The password \", \"is the same as the deployment \\ncredentials created earlier in this guide. The logs can be streamed d\", \"irectly to your local machine with \\nPowerShell or Azure CLI. Logs can also be viewed in Application \", \"Insights.\\nLog streaming\\nApp and web server logs can be streamed in real time through the portal.\\n1. \", \"Open the Azure portal, and navigate to the mywebapp<unique_number> App Service.\\n2. In the menu to th\", \"e left, scroll down to the Monitoring section and select Log stream.88 CHAPTER 4 | Monitor and debug\", \"\\n \\nLogs can also be streamed via Azure CLI or Azure PowerShell, including through the Cloud Shell.\\nA\", \"lerts\\nAzure Monitor also provides real time alerts based on metrics, administrative events, and othe\", \"r \\ncriteria.\\nNote\\nCurrently alerting on web app metrics is only available in the Alerts (classic) se\", \"rvice.\\nThe Alerts (classic) service can be found in Azure Monitor or under the Monitoring section of\", \" the App \\nService settings.\\nLive debugging\\nAzure App Service can be debugged remotely with Visual St\", \"udio when logs don\\u2019t provide enough \\ninformation. However, remote debugging requires the app to be c\", \"ompiled with debug symbols. \\nDebugging shouldn\\u2019t be done in production, except as a last resort.89 C\", \"HAPTER 4 | Monitor and debug\\nConclusion\\nIn this section, you completed the following tasks:\\n[!div cl\", \"ass=\\u201cchecklist\\u201d]\\n\\u2022 Find basic monitoring and troubleshooting data in the Azure portal\\n\\u2022 Learn how Az\", \"ure Monitor provides a deeper look at metrics across all Azure services\\n\\u2022 Connect the web app with A\", \"pplication Insights for app profiling\\n\\u2022 Turn on logging and learn where to download logs\\n\\u2022 Stream lo\", \"gs in real time\\n\\u2022 Learn where to set up alerts\\n\\u2022 Learn about remote debugging Azure App Service web \", \"apps.\\nAdditional reading\\n\\u2022 Troubleshooting ASP.NET Core on Azure App Service and IIS\\n\\u2022 Common errors\", \" reference for Azure App Service and IIS with ASP.NET Core\\n\\u2022 Monitor Azure web app performance with \", \"Application Insights\\n\\u2022 Enable diagnostics logging for web apps in Azure App Service\\n\\u2022 Troubleshoot a\", \" web app in Azure App Service using Visual Studio\\n\\u2022 Create classic metric alerts in Azure Monitor fo\", \"r Azure services - Azure portal90 CHAPTER 5 | Next steps\\nCHAPTER 5\\nNext steps\\nIn this guide, you cre\", \"ated a DevOps pipeline for an ASP.NET Core sample app. Congratulations! We \\nhope you enjoyed learnin\", \"g to publish ASP.NET Core web apps to Azure App Service and automate the \\ncontinuous integration of \", \"changes.\\nBeyond web hosting and DevOps, Azure has a wide array of Platform-as-a-Service (PaaS) servi\", \"ces \\nuseful to ASP.NET Core developers. This section gives a brief overview of some of the most comm\", \"only \\nused services.\\nStorage and databases\\nRedis Cache is high-throughput, low-latency data caching \", \"available as a service. It can be used for \\ncaching page output, reducing database requests, and pro\", \"viding ASP.NET Core session state across \\nmultiple instances of an app.\\nAzure Storage is Azure\\u2019s mas\", \"sively scalable cloud storage. Developers can take advantage of Queue \\nStorage for reliable message \", \"queuing, and Table Storage is a NoSQL key-value store designed for \\nrapid development using massive,\", \" semi-structured data sets.\\nAzure SQL Database provides familiar relational database functionality a\", \"s a service using the Microsoft \\nSQL Server Engine.\\nCosmos DB globally distributed, multi-model NoSQ\", \"L database service. Multiple APIs are available, \\nincluding SQL API (formerly called DocumentDB), Ca\", \"ssandra, and MongoDB.\\nIdentity\\nAzure Active Directory and Azure Active Directory B2C are both identi\", \"ty services. Azure Active \\nDirectory is designed for enterprise scenarios and enables Azure AD B2B (\", \"business-to-business) \\ncollaboration, while Azure Active Directory B2C is intended business-to-custo\", \"mer scenarios, including \\nsocial network sign-in.\\nMobile\\nNotification Hubs is a multi-platform, scal\", \"able push-notification engine to quickly send millions of \\nmessages to apps running on various types\", \" of devices.91 CHAPTER 5 | Next steps\\nWeb infrastructure\\nAzure Container Service manages your hosted\", \" Kubernetes environment, making it quick and easy to \\ndeploy and manage containerized apps without c\", \"ontainer orchestration expertise.\\nAzure Search is used to create an enterprise search solution over \", \"private, heterogenous content.\\nService Fabric is a distributed systems platform that makes it easy t\", \"o package, deploy, and manage \\nscalable and reliable microservices and containers.\"]"