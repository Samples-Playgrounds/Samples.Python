run: az logout # <– last line of previous job: insert below this
line


deploy_prod: needs: deploy_staging runs-on: ubuntu-latest


The deployment to the PROD environment workflow specifies several steps:


1. Once again, you specify a new job deploy_prod that needs deploy_staging to
complete before starting.

2. You’re targeting the PROD environment this time. Also, the url value is different from
before.


68 CHAPTER 3 | Continuous integration and deployment with Azure DevOps


3. For the steps, you don’t need to download the artifact since you’re just going to
perform a slot swap. You start by executing a login to the Azure context.

4. The Swap staging slot into production step is a multi-line run command (note the use
of the pipe symbol |). You also specify an id for this step so that you can refer to it
(you refer to it in the url property of the environment). The first line executes the slot
swap using the variables you defined above in the workflow. The second line uses an
az webapp show command to extract the URL of the target web app. This final line
uses ::set-output in an echo to create an output variable for this task, setting the value
to the web app URL.


[!NOTE] The URL _must_ start with http:// or https:// or it won’t render.


3. Commit the file.


4. Let the workflow run for a couple minutes until it has deployed to PRE-PROD. At this point,
the workflow will pause and wait for the required approval since you’re targeting the PROD
environment, which requires an approval as defined earlier: