|    | ANALYZING MALICIOUS DOCUMENTS oledump.py                                                    | List all OLE2 streams present   | Unnamed: 0   | /XObject can embed an image for phishing.                                                           |
|---:|:--------------------------------------------------------------------------------------------|:--------------------------------|:-------------|:----------------------------------------------------------------------------------------------------|
|  0 | in file.xls. This cheat sheet outlines tips and tools for analyzing file.xls -i             |                                 |              | Be mindful of obfuscation with hex codes, such as                                                   |
|  1 | malicious documents, such as Microsoft Office, RTF, oledump.py                              | Extract VBA source code         |              | /JavaScript vs. /J#61vaScript. (See examples.)                                                      |
|  2 | and PDF files. file.xls -s 3 -v                                                             | from stream 3 in file.xls.      |              | Useful PDF File Analysis Commands                                                                   |
|  3 | General Approach to Document Analysis xmldump.py pretty                                     | Format XML file supplied via    |              | pdfid.py  Display risky keywords present in                                                         |
|  4 |                                                                                             | STDIN for easier analysis.      |              | file.pdf -n file file.pdf.                                                                          |
|  5 | 1. Examine the document for anomalies, such as                                              |                                 |              |                                                                                                     |
|  6 | risky tags, scripts, and embedded artifacts. oledump.py file.xls -p                         | Find obfuscated URLs            |              | pdf-parser.py Show stats about keywords. Add                                                        |
|  7 | plugin_http_heuristics                                                                      | in file.xls macros.             |              | file.pdf -a “-O” to include object streams.                                                         |
|  8 | 2. Locate embedded code, such as shellcode,                                                 |                                 |              |                                                                                                     |
|  9 | macros, JavaScript, or other suspicious objects. vmonkey                                    | Emulate the execution of macros |              | pdf-parser.py Display contents of object id. Add                                                    |
| 10 | file.doc                                                                                    | in file.doc to analyze them.    |              | file.pdf -o id “-d” to dump object’s stream.                                                        |
| 11 | 3. Extract suspicious code or objects from the file.                                        |                                 |              |                                                                                                     |
| 12 | evilclippy -uu                                                                              | Remove the password prompt      |              | pdf-parser.py Display objects that                                                                  |
| 13 | 4. If relevant, deobfuscate and examine macros, file.ppt                                    | from macros in file.ppt.        |              | file.pdf -r id reference object id.                                                                 |
| 14 | JavaScript, or other embedded code.                                                         |                                 |              |                                                                                                     |
| 15 | msoffcrypto-tool                                                                            | Decrypt outfile.docm using      |              | qpdf --password=pass Decrypt infile.pdf using                                                       |
| 16 | 5. If relevant, emulate, disassemble and/or debug                                           |                                 |              |                                                                                                     |
| 17 | infile.docm                                                                                 | specified password to create    |              | --decrypt infile.pdf password pass to create                                                        |
| 18 | shellcode that you extracted from the document. outfile.docm -p                             | outfile.docm.                   |              | outfile.pdf outfile.pdf.                                                                            |
| 19 | 6. Understand the next steps in the infection chain.  pcodedmp                              | Disassemble VBA-stomped         |              | Shellcode and Other Analysis Commands                                                               |
| 20 | Microsoft Office Format Notes file.doc                                                      | p-code macro from file.doc.     |              | xorsearch -W  Locate shellcode patterns inside                                                      |
| 21 | Binary Microsoft Office document files (.doc, .xls, pcode2code                              | Decompile VBA-stomped           |              | -d 3 file.bin the binary file file.bin.                                                             |
| 22 | etc.) use the OLE2 (a.k.a. Structured Storage) format. file.doc                             | p-code macro from file.doc.     |              |                                                                                                     |
| 23 |                                                                                             |                                 |              | scdbgc /f Emulate execution of shellcode in                                                         |
| 24 | SRP streams in OLE2 documents sometimes store a rtfobj.py                                   | Extract objects embedded        |              | file.bin file.bin. Use “/off” to specify offset.                                                    |
| 25 | cached version of earlier VBA macro code. file.rtf                                          | into RTF file.rtf.              |              | runsc32 -f Execute shellcode in file.bin to                                                         |
| 26 | OOXML document files (.docx, .xlsm, etc.) supported rtfdump.py                              | List groups and structure of    |              | file.bin -n observe behavior in an isolated lab.                                                    |
| 27 | file.rtf by Microsoft Office are compressed zip archives.                                   | RTF file file.rtf.              |              | base64dump.py List Base64-encoded strings                                                           |
| 28 | VBA macros in OOXML documents are stored inside rtfdump.py                                  | Examine objects in RTF file     |              | file.txt present in file file.txt.                                                                  |
| 29 | file.rtf -O                                                                                 |                                 |              |                                                                                                     |
| 30 | an OLE2 binary file, which is within the zip archive.                                       | file.rtf.                       |              | numbers-to- Convert numbers that represent                                                          |
| 31 | Excel supports XLM macros that are embedded as rtfdump.py file.rtf                          | Extract hex contents from       |              | string.py file characters in file to a string.                                                      |
| 32 | -s 5 -H -d                                                                                  |                                 |              |                                                                                                     |
| 33 | formulas in sheets without the OLE2 binary file.                                            | group in RTF file file.rtf.     |              | Additional Document Analysis Tools                                                                  |
| 34 | RTF documents don’t support macros but can contain xlmdeobfuscator                          | Deobfuscate XLM (Excel 4)       |              |                                                                                                     |
| 35 | --file file.xlsm malicious embedded files and objects.                                      | macros in file.xlsm.            |              | SpiderMonkey, cscript, and box-js help deobfuscate JavaScript that you extract from document files. |
| 36 | Useful MS Office File Analysis Commands Risky PDF Keywords                                  |                                 |              | Use the debugger built into Microsoft Office to                                                     |
| 37 | zipdump.py Examine contents of OOXML /OpenAction and /AA specify the script or action to    |                                 |              | deobfuscate macros in an isolated lab.                                                              |
| 38 | file.pptx file file.pptx. run automatically.                                                |                                 |              |                                                                                                     |
| 39 |                                                                                             |                                 |              | Use AMSIScriptContentRetrieval.ps1 to observe                                                       |
| 40 | zipdump.py Extract file with index 3 from /JavaScript, /JS, /AcroForm, and /XFA can specify |                                 |              | Microsoft Office execute macros in an isolated lab.                                                 |
| 41 | file.pptx -s 3 -d file.pptx to STDOUT. JavaScript to run.                                   |                                 |              |                                                                                                     |
| 42 |                                                                                             |                                 |              | Some automated analysis sandboxes can analyze                                                       |
| 43 | olevba file.xlsm Locate and extract macros /URI accesses a URL, perhaps for phishing.       |                                 |              | aspects of malicious document files.                                                                |
| 44 | from file.xlsm. /SubmitForm and /GoToR can send data to URL.                                |                                 |              | REMnux distro includes many of the free document                                                    |